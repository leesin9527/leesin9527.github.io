<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>SpringSecurityåŸºç¡€çŸ¥è¯†</title>
      <link href="/post/42.html"/>
      <url>/post/42.html</url>
      
        <content type="html"><![CDATA[<h1 id="ä¸€-ç®€ä»‹"><a href="#ä¸€-ç®€ä»‹" class="headerlink" title="ä¸€. ç®€ä»‹"></a>ä¸€. ç®€ä»‹</h1><p>â€‹    <strong>Spring Security</strong> æ˜¯ Spring å®¶æ—ä¸­çš„ä¸€ä¸ªå®‰å…¨ç®¡ç†æ¡†æ¶ã€‚ç›¸æ¯”ä¸å¦å¤–ä¸€ä¸ªå®‰å…¨æ¡†æ¶<strong>Shiro</strong>ï¼Œå®ƒæä¾›äº†æ›´ä¸°å¯Œçš„åŠŸèƒ½ï¼Œç¤¾åŒºèµ„æºä¹Ÿæ¯”Shiroä¸°å¯Œã€‚</p><p>â€‹    ä¸€èˆ¬æ¥è¯´ä¸­å¤§å‹çš„é¡¹ç›®éƒ½æ˜¯ä½¿ç”¨ <strong>SpringSecurity</strong> æ¥åšå®‰å…¨æ¡†æ¶ã€‚å°é¡¹ç›®æœ‰ Shiro çš„æ¯”è¾ƒå¤šï¼Œå› ä¸ºç›¸æ¯”ä¸ SpringSecurityï¼ŒShiro çš„ä¸Šæ‰‹æ›´åŠ çš„ç®€å•ã€‚</p><p>â€‹     ä¸€èˆ¬ Web åº”ç”¨çš„éœ€è¦è¿›è¡Œ<strong>è®¤è¯</strong>å’Œ<strong>æˆæƒ</strong>ã€‚</p><p>â€‹        <strong>è®¤è¯ï¼šéªŒè¯å½“å‰è®¿é—®ç³»ç»Ÿçš„æ˜¯ä¸æ˜¯æœ¬ç³»ç»Ÿçš„ç”¨æˆ·ï¼Œå¹¶ä¸”è¦ç¡®è®¤å…·ä½“æ˜¯å“ªä¸ªç”¨æˆ·</strong></p><p>â€‹        <strong>æˆæƒï¼šç»è¿‡è®¤è¯ååˆ¤æ–­å½“å‰ç”¨æˆ·æ˜¯å¦æœ‰æƒé™è¿›è¡ŒæŸä¸ªæ“ä½œ</strong></p><p>â€‹    è€Œè®¤è¯å’Œæˆæƒä¹Ÿæ˜¯ SpringSecurity ä½œä¸ºå®‰å…¨æ¡†æ¶çš„æ ¸å¿ƒåŠŸèƒ½ã€‚</p><h1 id="äºŒ-è®¤è¯"><a href="#äºŒ-è®¤è¯" class="headerlink" title="äºŒ. è®¤è¯"></a>äºŒ. è®¤è¯</h1><h2 id="å…¥é—¨æ¡ˆä¾‹"><a href="#å…¥é—¨æ¡ˆä¾‹" class="headerlink" title="å…¥é—¨æ¡ˆä¾‹"></a>å…¥é—¨æ¡ˆä¾‹</h2><p>åœ¨ boot é¡¹ç›®é‡Œæ–°å»ºä¸€ä¸ª controller è¿›è¡Œæµ‹è¯•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line">    <span class="meta">@GetMapping(&quot;hi&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">hi</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;hi ğŸ˜Š&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æµ‹è¯•æˆåŠŸåï¼Œå¼•å…¥ Spring Security çš„ä¾èµ–</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--Spring Security--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-security<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>é‡å¯æµ‹è¯•ï¼ˆè´¦å·ä¸º user ï¼Œå¯†ç è¾“å‡ºåœ¨æ§åˆ¶å°äº†ï¼‰</p><h2 id="åŸç†åˆ†æ"><a href="#åŸç†åˆ†æ" class="headerlink" title="åŸç†åˆ†æ"></a>åŸç†åˆ†æ</h2><h3 id="è®¤è¯å®Œæ•´æµç¨‹"><a href="#è®¤è¯å®Œæ•´æµç¨‹" class="headerlink" title="è®¤è¯å®Œæ•´æµç¨‹"></a>è®¤è¯å®Œæ•´æµç¨‹</h3><p>SpringSecurity çš„åŸç†å…¶å®å°±æ˜¯ä¸€ä¸ªè¿‡æ»¤å™¨é“¾ï¼Œå†…éƒ¨åŒ…å«äº†æä¾›å„ç§åŠŸèƒ½çš„è¿‡æ»¤å™¨ã€‚è¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹çœ‹å…¥é—¨æ¡ˆä¾‹ä¸­çš„è¿‡æ»¤å™¨ã€‚</p><p><img src="http://cdn.leesin.fun/typora/macpro/img/image-20211214144425527.png" alt="image-20211214144425527"></p><p>â€‹    å›¾ä¸­åªå±•ç¤ºäº†æ ¸å¿ƒè¿‡æ»¤å™¨ï¼Œå…¶å®ƒçš„éæ ¸å¿ƒè¿‡æ»¤å™¨å¹¶æ²¡æœ‰åœ¨å›¾ä¸­å±•ç¤ºã€‚</p><p><strong>UsernamePasswordAuthenticationFilter</strong>: è´Ÿè´£å¤„ç†æˆ‘ä»¬åœ¨ç™»é™†é¡µé¢å¡«å†™äº†ç”¨æˆ·åå¯†ç åçš„ç™»é™†è¯·æ±‚ã€‚å…¥é—¨æ¡ˆä¾‹çš„è®¤è¯å·¥ä½œä¸»è¦æœ‰å®ƒè´Ÿè´£ã€‚</p><p><strong>ExceptionTranslationFilterï¼š</strong>å¤„ç†è¿‡æ»¤å™¨é“¾ä¸­æŠ›å‡ºçš„ä»»ä½• <code>AccessDeniedException</code> å’Œ <code>AuthenticationException</code> ã€‚</p><p><strong>FilterSecurityInterceptorï¼š</strong>è´Ÿè´£æƒé™æ ¡éªŒçš„è¿‡æ»¤å™¨ã€‚</p><p>â€‹    </p><p>â€‹    æˆ‘ä»¬å¯ä»¥é€šè¿‡ Debug æŸ¥çœ‹å½“å‰ç³»ç»Ÿä¸­ SpringSecurity è¿‡æ»¤å™¨é“¾ä¸­æœ‰å“ªäº›è¿‡æ»¤å™¨åŠå®ƒä»¬çš„é¡ºåºã€‚</p><p><img src="http://cdn.leesin.fun/typora/macpro/img/image-20211214145824903.png" alt="image-20211214145824903"></p><h3 id="è®¤è¯æµç¨‹è¯¦è§£"><a href="#è®¤è¯æµç¨‹è¯¦è§£" class="headerlink" title="è®¤è¯æµç¨‹è¯¦è§£"></a>è®¤è¯æµç¨‹è¯¦è§£</h3><p>è¿™é‡Œå°† UsernamePasswordAuthenticationFilter å±•å¼€åˆ†æã€‚</p><p><img src="http://cdn.leesin.fun/typora/macpro/img/image-20211214151515385.png" alt="image-20211214151515385"></p><p>æ¦‚å¿µé€ŸæŸ¥:</p><p>Authentication æ¥å£: å®ƒçš„å®ç°ç±»ï¼Œè¡¨ç¤ºå½“å‰è®¿é—®ç³»ç»Ÿçš„ç”¨æˆ·ï¼Œå°è£…äº†ç”¨æˆ·ç›¸å…³ä¿¡æ¯ã€‚</p><p>AuthenticationManager æ¥å£ï¼šå®šä¹‰äº†è®¤è¯ Authentication çš„æ–¹æ³• </p><p>UserDetailsService æ¥å£ï¼šåŠ è½½ç”¨æˆ·ç‰¹å®šæ•°æ®çš„æ ¸å¿ƒæ¥å£ã€‚é‡Œé¢å®šä¹‰äº†ä¸€ä¸ªæ ¹æ®ç”¨æˆ·åæŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯çš„æ–¹æ³•ã€‚</p><p>UserDetails æ¥å£ï¼šæä¾›æ ¸å¿ƒç”¨æˆ·ä¿¡æ¯ã€‚é€šè¿‡ UserDetailsService æ ¹æ®ç”¨æˆ·åè·å–å¤„ç†çš„ç”¨æˆ·ä¿¡æ¯è¦å°è£…æˆ UserDetails å¯¹è±¡è¿”å›ã€‚ç„¶åå°†è¿™äº›ä¿¡æ¯å°è£…åˆ° Authentication å¯¹è±¡ä¸­ã€‚</p><h2 id="ç™»é™†æ¡ˆä¾‹"><a href="#ç™»é™†æ¡ˆä¾‹" class="headerlink" title="ç™»é™†æ¡ˆä¾‹"></a>ç™»é™†æ¡ˆä¾‹</h2><h3 id="ç›®æ ‡"><a href="#ç›®æ ‡" class="headerlink" title="ç›®æ ‡"></a>ç›®æ ‡</h3><p>ç™»å½•</p><p>â€‹    â‘ è‡ªå®šä¹‰ç™»å½•æ¥å£  </p><p>â€‹                è°ƒç”¨ ProviderManager çš„æ–¹æ³•è¿›è¡Œè®¤è¯ å¦‚æœè®¤è¯é€šè¿‡ç”Ÿæˆ jwt</p><p>â€‹                æŠŠç”¨æˆ·ä¿¡æ¯å­˜å…¥ redis ä¸­</p><p>â€‹    â‘¡è‡ªå®šä¹‰ UserDetailsService </p><p>â€‹                åœ¨è¿™ä¸ªå®ç°ç±»ä¸­å»æŸ¥è¯¢æ•°æ®åº“</p><p>æ ¡éªŒï¼š</p><p>â€‹    â‘ å®šä¹‰ Jwt è®¤è¯è¿‡æ»¤å™¨</p><p>â€‹                è·å– token</p><p>â€‹                è§£æ token è·å–å…¶ä¸­çš„ userid</p><p>â€‹                ä» redis ä¸­è·å–ç”¨æˆ·ä¿¡æ¯</p><p>â€‹                å­˜å…¥ SecurityContextHolder</p><h3 id="å‡†å¤‡å·¥ä½œ"><a href="#å‡†å¤‡å·¥ä½œ" class="headerlink" title="å‡†å¤‡å·¥ä½œ"></a>å‡†å¤‡å·¥ä½œ</h3><p>å¼•å…¥åæ ‡</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--web--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--Spring Security--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-security<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--redisä¾èµ–--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--mybatis-plus--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-plus-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--mysqlé©±åŠ¨--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--test--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--jwtä¾èµ–--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.jsonwebtoken<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jjwt<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.9.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--é¡¹ç›®é€šç”¨åŒ…--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.lyf<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>app-common<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--fastjsonä¾èµ–--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>fastjson<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.33<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><p>å·¥å…·ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.jsonwebtoken.Claims;</span><br><span class="line"><span class="keyword">import</span> io.jsonwebtoken.JwtBuilder;</span><br><span class="line"><span class="keyword">import</span> io.jsonwebtoken.Jwts;</span><br><span class="line"><span class="keyword">import</span> io.jsonwebtoken.SignatureAlgorithm;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.crypto.SecretKey;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.spec.SecretKeySpec;</span><br><span class="line"><span class="keyword">import</span> java.util.Base64;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">import</span> java.util.UUID;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * JWTå·¥å…·ç±»</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JwtUtil</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æœ‰æ•ˆæœŸä¸º</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Long</span> <span class="variable">JWT_TTL</span> <span class="operator">=</span> <span class="number">60</span> * <span class="number">60</span> *<span class="number">1000L</span>;<span class="comment">// 60 * 60 *1000  ä¸€ä¸ªå°æ—¶</span></span><br><span class="line">    <span class="comment">//è®¾ç½®ç§˜é’¥æ˜æ–‡</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">JWT_KEY</span> <span class="operator">=</span> <span class="string">&quot;sangeng&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">getUUID</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> UUID.randomUUID().toString().replaceAll(<span class="string">&quot;-&quot;</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> token;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç”Ÿæˆjtw</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> subject tokenä¸­è¦å­˜æ”¾çš„æ•°æ®ï¼ˆjsonæ ¼å¼ï¼‰</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">createJWT</span><span class="params">(String subject)</span> &#123;</span><br><span class="line">        <span class="type">JwtBuilder</span> <span class="variable">builder</span> <span class="operator">=</span> getJwtBuilder(subject, <span class="literal">null</span>, getUUID());<span class="comment">// è®¾ç½®è¿‡æœŸæ—¶é—´</span></span><br><span class="line">        <span class="keyword">return</span> builder.compact();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç”Ÿæˆjtw</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> subject tokenä¸­è¦å­˜æ”¾çš„æ•°æ®ï¼ˆjsonæ ¼å¼ï¼‰</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> ttlMillis tokenè¶…æ—¶æ—¶é—´</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">createJWT</span><span class="params">(String subject, Long ttlMillis)</span> &#123;</span><br><span class="line">        <span class="type">JwtBuilder</span> <span class="variable">builder</span> <span class="operator">=</span> getJwtBuilder(subject, ttlMillis, getUUID());<span class="comment">// è®¾ç½®è¿‡æœŸæ—¶é—´</span></span><br><span class="line">        <span class="keyword">return</span> builder.compact();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> JwtBuilder <span class="title function_">getJwtBuilder</span><span class="params">(String subject, Long ttlMillis, String uuid)</span> &#123;</span><br><span class="line">        <span class="type">SignatureAlgorithm</span> <span class="variable">signatureAlgorithm</span> <span class="operator">=</span> SignatureAlgorithm.HS256;</span><br><span class="line">        <span class="type">SecretKey</span> <span class="variable">secretKey</span> <span class="operator">=</span> generalKey();</span><br><span class="line">        <span class="type">long</span> <span class="variable">nowMillis</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        <span class="type">Date</span> <span class="variable">now</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Date</span>(nowMillis);</span><br><span class="line">        <span class="keyword">if</span>(ttlMillis==<span class="literal">null</span>)&#123;</span><br><span class="line">            ttlMillis=JwtUtil.JWT_TTL;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">long</span> <span class="variable">expMillis</span> <span class="operator">=</span> nowMillis + ttlMillis;</span><br><span class="line">        <span class="type">Date</span> <span class="variable">expDate</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Date</span>(expMillis);</span><br><span class="line">        <span class="keyword">return</span> Jwts.builder()</span><br><span class="line">                .setId(uuid)              <span class="comment">//å”¯ä¸€çš„ID</span></span><br><span class="line">                .setSubject(subject)   <span class="comment">// ä¸»é¢˜  å¯ä»¥æ˜¯JSONæ•°æ®</span></span><br><span class="line">                .setIssuer(<span class="string">&quot;sg&quot;</span>)     <span class="comment">// ç­¾å‘è€…</span></span><br><span class="line">                .setIssuedAt(now)      <span class="comment">// ç­¾å‘æ—¶é—´</span></span><br><span class="line">                .signWith(signatureAlgorithm, secretKey) <span class="comment">//ä½¿ç”¨HS256å¯¹ç§°åŠ å¯†ç®—æ³•ç­¾å, ç¬¬äºŒä¸ªå‚æ•°ä¸ºç§˜é’¥</span></span><br><span class="line">                .setExpiration(expDate);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ›å»ºtoken</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> subject</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> ttlMillis</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">createJWT</span><span class="params">(String id, String subject, Long ttlMillis)</span> &#123;</span><br><span class="line">        <span class="type">JwtBuilder</span> <span class="variable">builder</span> <span class="operator">=</span> getJwtBuilder(subject, ttlMillis, id);<span class="comment">// è®¾ç½®è¿‡æœŸæ—¶é—´</span></span><br><span class="line">        <span class="keyword">return</span> builder.compact();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> <span class="string">&quot;eyJhbGciOiJIUzI1NiJ9.eyJqdGkiOiJjYWM2ZDVhZi1mNjVlLTQ0MDAtYjcxMi0zYWEwOGIyOTIwYjQiLCJzdWIiOiJzZyIsImlzcyI6InNnIiwiaWF0IjoxNjM4MTA2NzEyLCJleHAiOjE2MzgxMTAzMTJ9.JVsSbkP94wuczb4QryQbAke3ysBDIL5ou8fWsbt_ebg&quot;</span>;</span><br><span class="line">        <span class="type">Claims</span> <span class="variable">claims</span> <span class="operator">=</span> parseJWT(token);</span><br><span class="line">        System.out.println(claims);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç”ŸæˆåŠ å¯†åçš„ç§˜é’¥ secretKey</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> SecretKey <span class="title function_">generalKey</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">byte</span>[] encodedKey = Base64.getDecoder().decode(JwtUtil.JWT_KEY);</span><br><span class="line">        <span class="type">SecretKey</span> <span class="variable">key</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SecretKeySpec</span>(encodedKey, <span class="number">0</span>, encodedKey.length, <span class="string">&quot;AES&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> key;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è§£æ</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> jwt</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Claims <span class="title function_">parseJWT</span><span class="params">(String jwt)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">SecretKey</span> <span class="variable">secretKey</span> <span class="operator">=</span> generalKey();</span><br><span class="line">        <span class="keyword">return</span> Jwts.parser()</span><br><span class="line">                .setSigningKey(secretKey)</span><br><span class="line">                .parseClaimsJws(jwt)</span><br><span class="line">                .getBody();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®ä½“ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@TableName(value = &quot;sys_user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> -<span class="number">40356785423868312L</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * ä¸»é”®</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="meta">@TableId</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * ç”¨æˆ·å</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="meta">@TableField(value = &quot;user_name&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * å¯†ç </span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆ›å»ºè¡¨</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="comment">-- Table structure for sys_user</span></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> `sys_user`;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `sys_user` (</span><br><span class="line">  `id` <span class="type">bigint</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;ä¸»é”®&#x27;</span>,</span><br><span class="line">  `user_name` <span class="type">varchar</span>(<span class="number">64</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;NULL&#x27;</span> COMMENT <span class="string">&#x27;ç”¨æˆ·å&#x27;</span>,</span><br><span class="line">  `password` <span class="type">varchar</span>(<span class="number">64</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;NULL&#x27;</span> COMMENT <span class="string">&#x27;å¯†ç &#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB AUTO_INCREMENT<span class="operator">=</span><span class="number">5</span> <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb4 <span class="keyword">COLLATE</span><span class="operator">=</span>utf8mb4_0900_ai_ci COMMENT<span class="operator">=</span><span class="string">&#x27;ç”¨æˆ·è¡¨&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="comment">-- Records of sys_user</span></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="keyword">BEGIN</span>;</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `sys_user`  <span class="keyword">VALUES</span> (<span class="number">1</span>, <span class="string">&#x27;leesin&#x27;</span>, <span class="string">&#x27;&#123;noop&#125;1234&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `sys_user`  <span class="keyword">VALUES</span> (<span class="number">2</span>, <span class="string">&#x27;talon&#x27;</span>, <span class="string">&#x27;&#123;noop&#125;1234&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `sys_user`  <span class="keyword">VALUES</span> (<span class="number">3</span>, <span class="string">&#x27;ekko&#x27;</span>, <span class="string">&#x27;&#123;noop&#125;1234&#x27;</span>);</span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br></pre></td></tr></table></figure><p>ç„¶åé…ç½® mysql å’Œ redis çš„ä¿¡æ¯ï¼Œæ·»åŠ  Mapper å’Œ é…ç½®åŒ…æ‰«æï¼Œæœ€åæµ‹è¯• MP èƒ½å¦æ­£å¸¸ä½¿ç”¨</p><h3 id="æ­£å¼å·¥ä½œ"><a href="#æ­£å¼å·¥ä½œ" class="headerlink" title="æ­£å¼å·¥ä½œ"></a>æ­£å¼å·¥ä½œ</h3><h4 id="æ•°æ®åº“æ ¡éªŒç”¨æˆ·"><a href="#æ•°æ®åº“æ ¡éªŒç”¨æˆ·" class="headerlink" title="æ•°æ®åº“æ ¡éªŒç”¨æˆ·"></a>æ•°æ®åº“æ ¡éªŒç”¨æˆ·</h4><blockquote><p>å®ç°ç›®æ ‡ï¼šé€šè¿‡æŸ¥è¯¢æ•°æ®åº“æ¥æ ¡éªŒç”¨æˆ·å¯†ç ï¼Œè€Œä¸æ˜¯é€šè¿‡é»˜è®¤ç”Ÿæˆçš„è´¦å·å¯†ç </p></blockquote><p><em>è‡ªå®šä¹‰</em> <em>UserDetailsService</em> ï¼Œè¦†ç›–é»˜è®¤çš„å®ç°ï¼ˆ<strong>InMemoryUserDetailsManager</strong>ï¼‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserDetailsServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">UserDetailsService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserMapper userMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> UserDetails <span class="title function_">loadUserByUsername</span><span class="params">(String username)</span> <span class="keyword">throws</span> UsernameNotFoundException &#123;</span><br><span class="line">        LambdaQueryWrapper&lt;User&gt; wrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">        wrapper.eq(User::getUsername, username);</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userMapper.selectOne(wrapper);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (Objects.isNull(user)) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;ç”¨æˆ·åä¸å­˜åœ¨ï¼š&#123;&#125;&quot;</span>, username);</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;ç”¨æˆ·åä¸å­˜åœ¨ï¼&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// TODO æ ¹æ®ç”¨æˆ·æŸ¥è¯¢æƒé™ä¿¡æ¯ æ·»åŠ åˆ°LoginUserä¸­</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// å°è£…æˆ UserDetails å¯¹è±¡è¿”å›</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">LoginUser</span>(user);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è‡ªå®šä¹‰ç”¨æˆ·ç±»ï¼Œå®ç° <code>UserDetails</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoginUser</span> <span class="keyword">implements</span> <span class="title class_">UserDetails</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> User user;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Collection&lt;? <span class="keyword">extends</span> <span class="title class_">GrantedAuthority</span>&gt; getAuthorities() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getPassword</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> user.getPassword();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getUsername</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> user.getUsername();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isAccountNonExpired</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isAccountNonLocked</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isCredentialsNonExpired</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isEnabled</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é‡å¯æµ‹è¯• <code>/user/hi</code> ï¼Œä½¿ç”¨æ•°æ®åº“é‡Œçš„è´¦å·å¯†ç ç™»é™†ï½</p><blockquote><p>æ³¨æ„ï¼šå¦‚æœè¦æµ‹è¯•ï¼Œéœ€è¦å¾€ç”¨æˆ·è¡¨ä¸­å†™å…¥ç”¨æˆ·æ•°æ®ï¼Œå¹¶ä¸”å¦‚æœä½ æƒ³è®©ç”¨æˆ·çš„å¯†ç æ˜¯æ˜æ–‡å­˜å‚¨ï¼Œéœ€è¦åœ¨æ•°æ®åº“è¡¨è®°å½•çš„å¯†ç å‰åŠ <code>&#123;noop&#125;</code></p></blockquote><h5 id="é—®é¢˜ğŸŒŸ"><a href="#é—®é¢˜ğŸŒŸ" class="headerlink" title="é—®é¢˜ğŸŒŸ"></a>é—®é¢˜ğŸŒŸ</h5><blockquote><p>æ€è€ƒï¼šä¸ºä»€ä¹ˆæ³¨å…¥äº†ä¸€ä¸ªè‡ªå®šä¹‰çš„  UserDetailsService å®ç°ç±»ä¹‹åï¼ŒSpringSecurity å°±ä¼šä½¿ç”¨æˆ‘ä»¬è‡ªå®šä¹‰çš„æ¥å»åšèº«ä»½è®¤è¯äº†ï¼ŸåŸç†æ˜¯ä»€ä¹ˆï¼Ÿ</p></blockquote><p>æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ UserDetailsService çš„è‡ªåŠ¨é…ç½®æºç ï¼Œå°±æ¸…æ¥šäº†</p><h5 id="UserDetailServiceAutoConfigutation"><a href="#UserDetailServiceAutoConfigutation" class="headerlink" title="UserDetailServiceAutoConfigutation"></a>UserDetailServiceAutoConfigutation</h5><p>è¿™ä¸ªæºç éå¸¸å¤šï¼Œè¿™é‡Œæ¢³ç†äº†å…³é”®éƒ¨åˆ†ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration(proxyBeanMethods = false)</span></span><br><span class="line"><span class="meta">@ConditionalOnClass(AuthenticationManager.class)</span></span><br><span class="line"><span class="meta">@ConditionalOnBean(ObjectPostProcessor.class)</span></span><br><span class="line"><span class="meta">@ConditionalOnMissingBean(</span></span><br><span class="line"><span class="meta">value = &#123; AuthenticationManager.class, AuthenticationProvider.class, UserDetailsService.class,</span></span><br><span class="line"><span class="meta">AuthenticationManagerResolver.class &#125;,</span></span><br><span class="line"><span class="meta">type = &#123; &quot;org.springframework.security.oauth2.jwt.JwtDecoder&quot;,</span></span><br><span class="line"><span class="meta">&quot;org.springframework.security.oauth2.server.resource.introspection.OpaqueTokenIntrospector&quot;,</span></span><br><span class="line"><span class="meta">&quot;org.springframework.security.oauth2.client.registration.ClientRegistrationRepository&quot; &#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserDetailsServiceAutoConfiguration</span> &#123;</span><br><span class="line">  <span class="comment">//....</span></span><br><span class="line">  <span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@Lazy</span></span><br><span class="line"><span class="keyword">public</span> InMemoryUserDetailsManager <span class="title function_">inMemoryUserDetailsManager</span><span class="params">(SecurityProperties properties,</span></span><br><span class="line"><span class="params">ObjectProvider&lt;PasswordEncoder&gt; passwordEncoder)</span> &#123;</span><br><span class="line">SecurityProperties.<span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> properties.getUser();</span><br><span class="line">List&lt;String&gt; roles = user.getRoles();</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">InMemoryUserDetailsManager</span>(</span><br><span class="line">User.withUsername(user.getName()).password(getOrDeducePassword(user, passwordEncoder.getIfAvailable()))</span><br><span class="line">.roles(StringUtils.toStringArray(roles)).build());</span><br><span class="line">&#125;</span><br><span class="line">  <span class="comment">//...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>ç»“è®º</strong></p><p>åœ¨è‡ªå®šä¹‰ UserDetailsService å‰ï¼š</p><ol><li>ä»è‡ªåŠ¨é…ç½®æºç ä¸­å¾—çŸ¥å½“ classpath ä¸‹å­˜åœ¨ AuthenticationManager ç±»</li><li>å½“å‰é¡¹ç›®ä¸­ï¼Œç³»ç»Ÿæ²¡æœ‰æä¾› AuthenticationManager.classã€ AuthenticationProvider.classã€UserDetailsService.classã€<pre><code>AuthenticationManagerResolver.classå®ä¾‹</code></pre></li></ol><p>åœ¨è‡ªå®šä¹‰ UserDetailsService åï¼š</p><ol><li>å­˜åœ¨ UserDetailsService.classï¼Œæ‰€ä»¥ InMemoryUserDetailsManager å°±ä¸ä¼šè¢«åŠ è½½åˆ°å®¹å™¨ä¸­ã€‚</li></ol><h4 id="å¯†ç åŠ å¯†å­˜å‚¨"><a href="#å¯†ç åŠ å¯†å­˜å‚¨" class="headerlink" title="å¯†ç åŠ å¯†å­˜å‚¨"></a>å¯†ç åŠ å¯†å­˜å‚¨</h4><p>å¾…æ›´æ–°</p><h4 id="è‡ªå®šä¹‰ç™»é™†æ¥å£"><a href="#è‡ªå®šä¹‰ç™»é™†æ¥å£" class="headerlink" title="è‡ªå®šä¹‰ç™»é™†æ¥å£"></a>è‡ªå®šä¹‰ç™»é™†æ¥å£</h4><blockquote><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œæ‹¦æˆªçš„æ˜¯æ‰€æœ‰çš„è¯·æ±‚ï¼Œå³æ‰€æœ‰çš„è¯·æ±‚éƒ½éœ€è¦ç”¨æˆ·ç™»é™†ã€‚</p></blockquote><p>â€‹    æ¥ä¸‹æˆ‘ä»¬éœ€è¦è‡ªå®šä¹‰ç™»é™†æ¥å£ï¼Œç„¶åè®© SpringSecurity å¯¹è¿™ä¸ªæ¥å£æ”¾è¡Œï¼Œè®©ç”¨æˆ·è®¿é—®è¿™ä¸ªæ¥å£çš„æ—¶å€™ä¸ç”¨ç™»å½•ä¹Ÿèƒ½è®¿é—®ã€‚</p><p>â€‹    åœ¨æ¥å£ä¸­æˆ‘ä»¬é€šè¿‡ <code>AuthenticationManager</code> çš„ <code>authenticate</code> æ–¹æ³•æ¥è¿›è¡Œç”¨æˆ·è®¤è¯ï¼Œæ‰€ä»¥éœ€è¦åœ¨ SecurityConfig ä¸­é…ç½®æŠŠ <code>AuthenticationManager</code> æ³¨å…¥å®¹å™¨ã€‚</p><p>â€‹    è®¤è¯æˆåŠŸçš„è¯è¦ç”Ÿæˆä¸€ä¸ª jwtï¼Œæ”¾å…¥å“åº”ä¸­è¿”å›ã€‚å¹¶ä¸”ä¸ºäº†è®©ç”¨æˆ·ä¸‹å›è¯·æ±‚æ—¶èƒ½é€šè¿‡ jwt è¯†åˆ«å‡ºå…·ä½“çš„æ˜¯å“ªä¸ªç”¨æˆ·ï¼Œæˆ‘ä»¬éœ€è¦æŠŠç”¨æˆ·ä¿¡æ¯å­˜å…¥ redisï¼Œå¯ä»¥æŠŠç”¨æˆ· id ä½œä¸º keyã€‚</p><p>æ–°å¢æ¥å£</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> LoginService loginService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping(&quot;login&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">login</span><span class="params">(<span class="meta">@RequestBody</span> User user)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> loginService.login(user);</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="meta">@GetMapping(&quot;hi&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">hi</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;hi ğŸ˜Š&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ–°å¢é…ç½®æ–‡ä»¶</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SecurityConfig</span> <span class="keyword">extends</span> <span class="title class_">WebSecurityConfigurerAdapter</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        http</span><br><span class="line">                <span class="comment">// å…³é—­ csrf</span></span><br><span class="line">                .csrf().disable()</span><br><span class="line">                <span class="comment">// ä¸é€šè¿‡ Session è·å– SecurityContext</span></span><br><span class="line">                .sessionManagement().sessionCreationPolicy(SessionCreationPolicy.STATELESS)</span><br><span class="line">                .and()</span><br><span class="line">                .authorizeRequests()</span><br><span class="line">                <span class="comment">// å¯¹äºç™»å½•æ¥å£ å…è®¸åŒ¿åè®¿é—®</span></span><br><span class="line">                .antMatchers(<span class="string">&quot;/user/login&quot;</span>).anonymous()</span><br><span class="line">                <span class="comment">// é™¤ä¸Šé¢å¤–çš„æ‰€æœ‰è¯·æ±‚å…¨éƒ¨éœ€è¦é‰´æƒè®¤è¯</span></span><br><span class="line">                .anyRequest().authenticated();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> AuthenticationManager <span class="title function_">authenticationManagerBean</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">super</span>.authenticationManagerBean();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>LoginServiceImpl</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoginServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">LoginService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AuthenticationManager authenticationManager;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RedisTemplate redisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">login</span><span class="params">(User user)</span> &#123;</span><br><span class="line">        <span class="comment">// å°è£…æˆ Authentication</span></span><br><span class="line">        <span class="type">Authentication</span> <span class="variable">authentication</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UsernamePasswordAuthenticationToken</span>(user.getUsername(), user.getPassword());</span><br><span class="line">        <span class="comment">// è°ƒç”¨ AuthenticationManager çš„ authenticate æ–¹æ³• è¿›è¡Œèº«ä»½è®¤è¯</span></span><br><span class="line">        authentication = authenticationManager.authenticate(authentication);</span><br><span class="line">        <span class="keyword">if</span> (Objects.isNull(authentication)) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯ï¼ç”¨æˆ·åï¼š&#123;&#125;ï¼Œå¯†ç ï¼š&#123;&#125;&quot;</span>, user.getUsername(), user.getPassword());</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ä½¿ç”¨ userId ç”Ÿæˆ token</span></span><br><span class="line">        <span class="type">LoginUser</span> <span class="variable">loginUser</span> <span class="operator">=</span> (LoginUser) authentication.getPrincipal();</span><br><span class="line">        <span class="type">String</span> <span class="variable">userId</span> <span class="operator">=</span> loginUser.getUser().getId().toString();</span><br><span class="line">        <span class="type">String</span> <span class="variable">jwt</span> <span class="operator">=</span> JwtUtil.createJWT(userId);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ç”¨æˆ·ä¿¡æ¯å­˜å…¥redis é”®ä¸ºuserId å€¼ä¸ºloginUser</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> <span class="string">&quot;login:&quot;</span> + userId;</span><br><span class="line">        redisTemplate.opsForValue().set(key, loginUser);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æŠŠ token è¿”å›ç»™å‰ç«¯</span></span><br><span class="line">        Map&lt;String, String&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        map.put(<span class="string">&quot;token&quot;</span>, jwt);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Result</span>(map);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é‡å¯ï¼Œæµ‹è¯• <code>/user/login</code>æ¥å£ã€‚</p><h5 id="é—®é¢˜ğŸŒŸ-1"><a href="#é—®é¢˜ğŸŒŸ-1" class="headerlink" title="é—®é¢˜ğŸŒŸ"></a>é—®é¢˜ğŸŒŸ</h5><blockquote><p>ä½†æ˜¯æœ‰ä¸€ä¸ªé—®é¢˜å‡ºæ¥äº†ï¼Œä¹‹å‰â€œæ•°æ®åº“æ ¡éªŒç”¨æˆ·â€æ—¶ï¼Œå¯ä»¥æ­£å¸¸è®¿é—®çš„æ¥å£<code>/user/hi</code>ï¼Œæ­¤æ—¶å´è®¿é—®ä¸äº†äº†ï¼Œä¸ºä»€ä¹ˆå‘¢ï¼Ÿ</p><p>è§£ç­”ï¼šé»˜è®¤é…ç½®æ˜¯å¼€å¯ HttpBasic è®¤è¯çš„ï¼Œé‡å†™é…ç½®è¦†ç›–äº†é»˜è®¤çš„é…ç½®ã€‚å¦‚æœéœ€è¦ è¿˜å¯ä»¥é€šè¿‡ä»¥å‰çš„æ–¹å¼è®¿é—®<code>/user/hi</code>ï¼Œéœ€è¦æ‰‹åŠ¨æ·»åŠ  HttpBasic è®¤è¯çš„é…ç½®ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">  http</span><br><span class="line">    <span class="comment">// å…³é—­ csrf</span></span><br><span class="line">    .csrf().disable()</span><br><span class="line">    <span class="comment">// ä¸é€šè¿‡ Session è·å– SecurityContext</span></span><br><span class="line">    .sessionManagement().sessionCreationPolicy(SessionCreationPolicy.STATELESS)</span><br><span class="line">    .and()</span><br><span class="line">    .authorizeRequests()</span><br><span class="line">    <span class="comment">// å¯¹äºç™»å½•æ¥å£ å…è®¸åŒ¿åè®¿é—®</span></span><br><span class="line">    .antMatchers(<span class="string">&quot;/user/login&quot;</span>).anonymous()</span><br><span class="line">    <span class="comment">// é™¤ä¸Šé¢å¤–çš„æ‰€æœ‰è¯·æ±‚å…¨éƒ¨éœ€è¦é‰´æƒè®¤è¯</span></span><br><span class="line">    .anyRequest().authenticated()</span><br><span class="line">    .and().httpBasic()<span class="comment">// å¼€å¯ HttpBasic è®¤è¯</span></span><br><span class="line">    ;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>å³ï¼šæœ«å°¾è¿½åŠ <code>.and().httpBasic()</code></p></blockquote></blockquote><p><img src="http://cdn.leesin.fun/typora/macpro/img/image-20230609102059856.png" alt="image-20230609102059856"></p><p>å¦‚æœæ²¡æœ‰è‡ªå®šä¹‰ç±»ç»§æ‰¿ WebSecurityConfigurerAdapterï¼Œé‚£ä¹ˆï¼ŒSpringBoot å°†ä¼šå¸®æˆ‘ä»¬æ³¨å…¥é»˜è®¤çš„é…ç½®ç±»ã€‚</p><p>é»˜è®¤çš„é…ç½®å¦‚ä¸‹ï¼šï¼ˆæºç åœ¨ WebSecurityConfigurerAdapter ç±»é‡Œï¼‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">  http</span><br><span class="line">    .authorizeRequests()</span><br><span class="line">    .anyRequest().authenticated() <span class="comment">// é»˜è®¤æ‰€æœ‰çš„è¯·æ±‚éƒ½éœ€è¦è®¤è¯</span></span><br><span class="line">    .and()</span><br><span class="line">    .formLogin().and() <span class="comment">// é»˜è®¤å¼€å¯è¡¨å•è®¤è¯</span></span><br><span class="line">    .httpBasic(); <span class="comment">// é»˜è®¤å¼€å¯ HttpBasic è®¤è¯</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="è®¤è¯è¿‡æ»¤å™¨"><a href="#è®¤è¯è¿‡æ»¤å™¨" class="headerlink" title="è®¤è¯è¿‡æ»¤å™¨"></a>è®¤è¯è¿‡æ»¤å™¨</h4><p>â€‹    æˆ‘ä»¬éœ€è¦è‡ªå®šä¹‰ä¸€ä¸ªè¿‡æ»¤å™¨ï¼Œè¿™ä¸ªè¿‡æ»¤å™¨ä¼šå»è·å–è¯·æ±‚å¤´ä¸­çš„ tokenï¼Œå¯¹ token è¿›è¡Œè§£æå–å‡ºå…¶ä¸­çš„ userIdã€‚</p><p>â€‹    ä½¿ç”¨ userId å» redis ä¸­è·å–å¯¹åº”çš„ LoginUser å¯¹è±¡ã€‚</p><p>â€‹    ç„¶åå°è£… Authentication å¯¹è±¡å­˜å…¥ SecurityContextHolder</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JwtAuthenticationTokenFilter</span> <span class="keyword">extends</span> <span class="title class_">OncePerRequestFilter</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RedisTemplate redisTemplate;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doFilterInternal</span><span class="params">(HttpServletRequest request,</span></span><br><span class="line"><span class="params">                                    HttpServletResponse response,</span></span><br><span class="line"><span class="params">                                    FilterChain filterChain)</span></span><br><span class="line">            <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> request.getHeader(<span class="string">&quot;token&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (!StringUtils.hasText(token)) &#123;</span><br><span class="line">            <span class="comment">// æ²¡token  æ”¾è¡Œ</span></span><br><span class="line">            filterChain.doFilter(request, response);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        String userId;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">Claims</span> <span class="variable">claims</span> <span class="operator">=</span> JwtUtil.parseJWT(token);</span><br><span class="line">            userId = claims.getSubject();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;tokenéæ³•ï¼š&#123;&#125;&quot;</span>, token);</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;tokenéæ³•&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// è¯» redisè·å–ç”¨æˆ·ä¿¡æ¯</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> <span class="string">&quot;login:&quot;</span> + userId;</span><br><span class="line">        <span class="type">Object</span> <span class="variable">loginUser</span> <span class="operator">=</span> redisTemplate.opsForValue().get(key);</span><br><span class="line">        <span class="keyword">if</span> (Objects.isNull(loginUser)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;ç”¨æˆ·æœªç™»å½•&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å­˜å…¥SecurityContextHolder</span></span><br><span class="line">        <span class="comment">// TODO è·å–æƒé™ä¿¡æ¯å°è£…åˆ°Authenticationä¸­</span></span><br><span class="line"></span><br><span class="line">        <span class="type">Authentication</span> <span class="variable">authentication</span> <span class="operator">=</span></span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">UsernamePasswordAuthenticationToken</span>(loginUser,<span class="literal">null</span>,<span class="literal">null</span>);</span><br><span class="line">        <span class="comment">// é—®é¢˜ï¼šæ˜¯ä¸æ˜¯SecurityContextHolderæœ‰å†…å®¹ï¼Œåé¢è¿‡æ»¤å™¨å°±ä¼šé€šè¿‡äº†ï¼Ÿ</span></span><br><span class="line">        SecurityContextHolder.getContext().setAuthentication(authentication);</span><br><span class="line">        <span class="comment">//æ”¾è¡Œ</span></span><br><span class="line">        filterChain.doFilter(request, response);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>é…ç½®ç±» SecurityConfig ä¸­æ–°å¢è¿‡æ»¤å™¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> JwtAuthenticationTokenFilter jwtAuthenticationTokenFilter;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">  .</span><br><span class="line">  .</span><br><span class="line">  .</span><br><span class="line">  <span class="comment">//æŠŠtokenæ ¡éªŒè¿‡æ»¤å™¨æ·»åŠ åˆ°è¿‡æ»¤å™¨é“¾ä¸­</span></span><br><span class="line">  http.addFilterBefore(jwtAuthenticationTokenFilter, UsernamePasswordAuthenticationFilter.class);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é‡å¯æµ‹è¯• <code>/user/hi</code>å¹¶æºå¸¦ tokenï¼Œå°±èƒ½æ­£å¸¸è®¿é—®äº†ã€‚</p><h5 id="é—®é¢˜ğŸŒŸ-2"><a href="#é—®é¢˜ğŸŒŸ-2" class="headerlink" title="é—®é¢˜ğŸŒŸ"></a>é—®é¢˜ğŸŒŸ</h5><ol><li>ä¸ºä»€ä¹ˆ SecurityContextHolder æœ‰å†…å®¹ï¼Œåé¢è¿‡æ»¤å™¨å°±ä¼šé€šè¿‡äº†ï¼Ÿ</li></ol><h4 id="é€€å‡ºç™»é™†"><a href="#é€€å‡ºç™»é™†" class="headerlink" title="é€€å‡ºç™»é™†"></a>é€€å‡ºç™»é™†</h4><p>â€‹    æˆ‘ä»¬åªéœ€è¦å®šä¹‰ä¸€ä¸ªé€€å‡ºç™»é™†æ¥å£ï¼Œç„¶åè·å– SecurityContextHolder ä¸­çš„è®¤è¯ä¿¡æ¯ï¼Œåˆ é™¤ redis ä¸­å¯¹åº”çš„æ•°æ®å³å¯ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> LoginService loginService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping(&quot;logout&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">logout</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> loginService.logout();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>loginServiceæ·»åŠ æ–¹æ³•<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">logout</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">Authentication</span> <span class="variable">authentication</span> <span class="operator">=</span> SecurityContextHolder.getContext().getAuthentication();</span><br><span class="line">    <span class="keyword">if</span> (Objects.isNull(authentication)) &#123;</span><br><span class="line">        log.error(<span class="string">&quot;ç”¨æˆ·æœªç™»é™†ï¼&quot;</span>);</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;ç”¨æˆ·æœªç™»é™†ï¼&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">LoginUser</span> <span class="variable">loginUser</span> <span class="operator">=</span> (LoginUser) authentication.getPrincipal();</span><br><span class="line">    <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> loginUser.getUser().getId();</span><br><span class="line">    <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> <span class="string">&quot;login:&quot;</span> + userId;</span><br><span class="line">    redisTemplate.delete(key);</span><br><span class="line">    log.info(<span class="string">&quot;é€€å‡ºæˆåŠŸï¼š&#123;&#125;&quot;</span>, loginUser.getUser());</span><br><span class="line">    <span class="keyword">return</span> Result.success(<span class="string">&quot;é€€å‡ºæˆåŠŸï¼&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>é‡å¯æµ‹è¯•</p><h1 id="ä¸‰-æˆæƒ"><a href="#ä¸‰-æˆæƒ" class="headerlink" title="ä¸‰. æˆæƒ"></a>ä¸‰. æˆæƒ</h1><h2 id="æƒé™ç³»ç»Ÿçš„ä½œç”¨"><a href="#æƒé™ç³»ç»Ÿçš„ä½œç”¨" class="headerlink" title="æƒé™ç³»ç»Ÿçš„ä½œç”¨"></a>æƒé™ç³»ç»Ÿçš„ä½œç”¨</h2><p>â€‹    ä¾‹å¦‚ä¸€ä¸ªå­¦æ ¡å›¾ä¹¦é¦†çš„ç®¡ç†ç³»ç»Ÿï¼Œå¦‚æœæ˜¯æ™®é€šå­¦ç”Ÿç™»å½•å°±èƒ½çœ‹åˆ°å€Ÿä¹¦è¿˜ä¹¦ç›¸å…³çš„åŠŸèƒ½ï¼Œä¸å¯èƒ½è®©ä»–çœ‹åˆ°å¹¶ä¸”å»ä½¿ç”¨æ·»åŠ ä¹¦ç±ä¿¡æ¯ï¼Œåˆ é™¤ä¹¦ç±ä¿¡æ¯ç­‰åŠŸèƒ½ã€‚ä½†æ˜¯å¦‚æœæ˜¯ä¸€ä¸ªå›¾ä¹¦é¦†ç®¡ç†å‘˜çš„è´¦å·ç™»å½•äº†ï¼Œåº”è¯¥å°±èƒ½çœ‹åˆ°å¹¶ä½¿ç”¨æ·»åŠ ä¹¦ç±ä¿¡æ¯ï¼Œåˆ é™¤ä¹¦ç±ä¿¡æ¯ç­‰åŠŸèƒ½ã€‚</p><p>â€‹    æ€»ç»“èµ·æ¥å°±æ˜¯<strong>ä¸åŒçš„ç”¨æˆ·å¯ä»¥ä½¿ç”¨ä¸åŒçš„åŠŸèƒ½</strong>ã€‚è¿™å°±æ˜¯æƒé™ç³»ç»Ÿè¦å»å®ç°çš„æ•ˆæœã€‚</p><p>â€‹    æˆ‘ä»¬ä¸èƒ½åªä¾èµ–å‰ç«¯å»åˆ¤æ–­ç”¨æˆ·çš„æƒé™æ¥é€‰æ‹©æ˜¾ç¤ºå“ªäº›èœå•å“ªäº›æŒ‰é’®ã€‚å› ä¸ºå¦‚æœåªæ˜¯è¿™æ ·ï¼Œå¦‚æœæœ‰äººçŸ¥é“äº†å¯¹åº”åŠŸèƒ½çš„æ¥å£åœ°å€å°±å¯ä»¥ä¸é€šè¿‡å‰ç«¯ï¼Œç›´æ¥å»å‘é€è¯·æ±‚æ¥å®ç°ç›¸å…³åŠŸèƒ½æ“ä½œã€‚</p><p>â€‹    æ‰€ä»¥æˆ‘ä»¬è¿˜éœ€è¦åœ¨åå°è¿›è¡Œç”¨æˆ·æƒé™çš„åˆ¤æ–­ï¼Œåˆ¤æ–­å½“å‰ç”¨æˆ·æ˜¯å¦æœ‰ç›¸åº”çš„æƒé™ï¼Œå¿…é¡»å…·æœ‰æ‰€éœ€æƒé™æ‰èƒ½è¿›è¡Œç›¸åº”çš„æ“ä½œã€‚</p><p>â€‹    </p><h2 id="æˆæƒåŸºæœ¬æµç¨‹"><a href="#æˆæƒåŸºæœ¬æµç¨‹" class="headerlink" title="æˆæƒåŸºæœ¬æµç¨‹"></a>æˆæƒåŸºæœ¬æµç¨‹</h2><p>â€‹    åœ¨ SpringSecurity ä¸­ï¼Œä¼šä½¿ç”¨é»˜è®¤çš„ FilterSecurityInterceptor æ¥è¿›è¡Œæƒé™æ ¡éªŒã€‚åœ¨ FilterSecurityInterceptor ä¸­ä¼šä» SecurityContextHolder è·å–å…¶ä¸­çš„ Authenticationï¼Œç„¶åè·å–å…¶ä¸­çš„æƒé™ä¿¡æ¯ã€‚å½“å‰ç”¨æˆ·æ˜¯å¦æ‹¥æœ‰è®¿é—®å½“å‰èµ„æºæ‰€éœ€çš„æƒé™ã€‚</p><p>â€‹    æ‰€ä»¥æˆ‘ä»¬åœ¨é¡¹ç›®ä¸­åªéœ€è¦æŠŠå½“å‰ç™»å½•ç”¨æˆ·çš„æƒé™ä¿¡æ¯ä¹Ÿå­˜å…¥ Authenticationã€‚</p><p>â€‹    ç„¶åè®¾ç½®æˆ‘ä»¬çš„èµ„æºæ‰€éœ€è¦çš„æƒé™å³å¯ã€‚</p><h3 id="æˆæƒå®ç°"><a href="#æˆæƒå®ç°" class="headerlink" title="æˆæƒå®ç°"></a>æˆæƒå®ç°</h3><h4 id="é™åˆ¶è®¿é—®èµ„æºæ‰€éœ€æƒé™"><a href="#é™åˆ¶è®¿é—®èµ„æºæ‰€éœ€æƒé™" class="headerlink" title="é™åˆ¶è®¿é—®èµ„æºæ‰€éœ€æƒé™"></a>é™åˆ¶è®¿é—®èµ„æºæ‰€éœ€æƒé™</h4><p>â€‹    SpringSecurity ä¸ºæˆ‘ä»¬æä¾›äº†åŸºäºæ³¨è§£çš„æƒé™æ§åˆ¶æ–¹æ¡ˆï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ä»¬é¡¹ç›®ä¸­ä¸»è¦é‡‡ç”¨çš„æ–¹å¼ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ³¨è§£å»æŒ‡å®šè®¿é—®å¯¹åº”çš„èµ„æºæ‰€éœ€çš„æƒé™ã€‚</p><p>â€‹    ä½†æ˜¯è¦ä½¿ç”¨å®ƒæˆ‘ä»¬éœ€è¦å…ˆå¼€å¯ç›¸å…³é…ç½®ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¯åŠ¨ç±»ä¸ŠåŠ ä¸Šè¿™ä¸ªæ³¨è§£</span></span><br><span class="line"><span class="meta">@EnableGlobalMethodSecurity(prePostEnabled = true)</span></span><br></pre></td></tr></table></figure><p>â€‹    ç„¶åå°±å¯ä»¥åœ¨æ¥å£ä¸Šä½¿ç”¨å¯¹åº”çš„æ³¨è§£ã€‚@PreAuthorize</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;hi&quot;)</span></span><br><span class="line"><span class="meta">@PreAuthorize(&quot;hasAuthority(&#x27;system:A:list&#x27;)&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">hi</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&quot;hi ğŸ˜Š&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@GetMapping(&quot;hello&quot;)</span></span><br><span class="line"><span class="meta">@PreAuthorize(&quot;hasAuthority(&#x27;system:B:list&#x27;)&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">hello</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&quot;hello ğŸ˜Š&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="å°è£…æƒé™ä¿¡æ¯"><a href="#å°è£…æƒé™ä¿¡æ¯" class="headerlink" title="å°è£…æƒé™ä¿¡æ¯"></a>å°è£…æƒé™ä¿¡æ¯</h4><p>â€‹    æˆ‘ä»¬å‰é¢åœ¨å†™ UserDetailsServiceImpl çš„æ—¶å€™è¯´è¿‡ï¼Œåœ¨æŸ¥è¯¢å‡ºç”¨æˆ·åè¿˜è¦è·å–å¯¹åº”çš„æƒé™ä¿¡æ¯ï¼Œå°è£…åˆ° UserDetails ä¸­è¿”å›ã€‚</p><p>â€‹    æˆ‘ä»¬å…ˆç›´æ¥æŠŠæƒé™ä¿¡æ¯å†™æ­»å°è£…åˆ° UserDetails ä¸­è¿›è¡Œæµ‹è¯•ã€‚</p><p>â€‹    æˆ‘ä»¬ä¹‹å‰å®šä¹‰äº† UserDetails çš„å®ç°ç±» LoginUserï¼Œæƒ³è¦è®©å…¶èƒ½å°è£…æƒé™ä¿¡æ¯å°±è¦å¯¹å…¶è¿›è¡Œä¿®æ”¹ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoginUser</span> <span class="keyword">implements</span> <span class="title class_">UserDetails</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç”¨æˆ·ä¿¡æ¯</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> User user;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æƒé™ä¿¡æ¯</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;String&gt; permissions;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å­˜å‚¨ SpringSecurity æ‰€éœ€è¦çš„æƒé™ä¿¡æ¯çš„é›†åˆ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;GrantedAuthority&gt; authorities;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">LoginUser</span><span class="params">(User user, List&lt;String&gt; permissions)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.user = user;</span><br><span class="line">        <span class="built_in">this</span>.permissions = permissions;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Collection&lt;? <span class="keyword">extends</span> <span class="title class_">GrantedAuthority</span>&gt; getAuthorities() &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (authorities == <span class="literal">null</span> || authorities.size() == <span class="number">0</span>) &#123;</span><br><span class="line">            authorities = permissions</span><br><span class="line">                    .stream()</span><br><span class="line">                    .map(SimpleGrantedAuthority::<span class="keyword">new</span>)</span><br><span class="line">                    .collect(Collectors.toList());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> authorities;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getPassword</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> user.getPassword();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getUsername</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> user.getUsername();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isAccountNonExpired</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isAccountNonLocked</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isCredentialsNonExpired</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isEnabled</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹        LoginUser ä¿®æ”¹å®Œåæˆ‘ä»¬å°±å¯ä»¥åœ¨ UserDetailsServiceImpl ä¸­å»æŠŠæƒé™ä¿¡æ¯å°è£…åˆ° LoginUser ä¸­äº†ã€‚æˆ‘ä»¬å†™æ­»æƒé™è¿›è¡Œæµ‹è¯•ï¼Œåé¢æˆ‘ä»¬å†ä»æ•°æ®åº“ä¸­æŸ¥è¯¢æƒé™ä¿¡æ¯ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: è‡ªå®šä¹‰ UserDetailsService ï¼Œè¦†ç›–é»˜è®¤çš„å®ç°ï¼ˆInMemoryUserDetailsManagerï¼‰ã€‚</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: Liu Yuefeng</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2023/6/7 11:24</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserDetailsServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">UserDetailsService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserMapper userMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> UserDetails <span class="title function_">loadUserByUsername</span><span class="params">(String username)</span> <span class="keyword">throws</span> UsernameNotFoundException &#123;</span><br><span class="line">        LambdaQueryWrapper&lt;User&gt; wrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">        wrapper.eq(User::getUsername, username);</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userMapper.selectOne(wrapper);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (Objects.isNull(user)) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;ç”¨æˆ·åä¸å­˜åœ¨ï¼š&#123;&#125;&quot;</span>, username);</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;ç”¨æˆ·åä¸å­˜åœ¨ï¼&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// TODO æ ¹æ®ç”¨æˆ·æŸ¥è¯¢æƒé™ä¿¡æ¯ æ·»åŠ åˆ°LoginUserä¸­</span></span><br><span class="line">        List&lt;String&gt; permissions = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        permissions.add(<span class="string">&quot;system:A:list&quot;</span>);</span><br><span class="line">        <span class="comment">// å°è£…æˆ UserDetails å¯¹è±¡è¿”å›</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">LoginUser</span>(user, permissions);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é‡å¯æµ‹è¯•ï¼Œ<code>/user/hi</code>å¯ä»¥è®¿é—®ï¼Œä½†æ˜¯<code>/user/hello</code>æ²¡æƒé™è®¿é—®ï¼Œæµ‹è¯•æˆåŠŸï¼</p><h4 id="ä»æ•°æ®åº“æŸ¥è¯¢æƒé™ä¿¡æ¯"><a href="#ä»æ•°æ®åº“æŸ¥è¯¢æƒé™ä¿¡æ¯" class="headerlink" title="ä»æ•°æ®åº“æŸ¥è¯¢æƒé™ä¿¡æ¯"></a>ä»æ•°æ®åº“æŸ¥è¯¢æƒé™ä¿¡æ¯</h4><h5 id="RBACæƒé™æ¨¡å‹"><a href="#RBACæƒé™æ¨¡å‹" class="headerlink" title="RBACæƒé™æ¨¡å‹"></a>RBACæƒé™æ¨¡å‹</h5><p>RBACæƒé™æ¨¡å‹ï¼ˆRole-Based Access Controlï¼‰å³ï¼šåŸºäºè§’è‰²çš„æƒé™æ§åˆ¶ã€‚è¿™æ˜¯ç›®å‰æœ€å¸¸è¢«å¼€å‘è€…ä½¿ç”¨ä¹Ÿæ˜¯ç›¸å¯¹æ˜“ç”¨ã€é€šç”¨æƒé™æ¨¡å‹ã€‚</p><p>â€‹    <img src="http://cdn.leesin.fun/typora/macpro/img/image-20211222110249727.png" alt="image-20211222110249727"></p><h5 id="å‡†å¤‡å·¥ä½œ-1"><a href="#å‡†å¤‡å·¥ä½œ-1" class="headerlink" title="å‡†å¤‡å·¥ä½œ"></a>å‡†å¤‡å·¥ä½œ</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="comment">-- Table structure for sys_user</span></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> `sys_user`;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `sys_user` (</span><br><span class="line">  `id` <span class="type">bigint</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;ä¸»é”®&#x27;</span>,</span><br><span class="line">  `user_name` <span class="type">varchar</span>(<span class="number">64</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;NULL&#x27;</span> COMMENT <span class="string">&#x27;ç”¨æˆ·å&#x27;</span>,</span><br><span class="line">  `password` <span class="type">varchar</span>(<span class="number">64</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;NULL&#x27;</span> COMMENT <span class="string">&#x27;å¯†ç &#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB AUTO_INCREMENT<span class="operator">=</span><span class="number">5</span> <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb4 <span class="keyword">COLLATE</span><span class="operator">=</span>utf8mb4_0900_ai_ci COMMENT<span class="operator">=</span><span class="string">&#x27;ç”¨æˆ·è¡¨&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="comment">-- Records of sys_user</span></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="keyword">BEGIN</span>;</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `sys_user`  <span class="keyword">VALUES</span> (<span class="number">1</span>, <span class="string">&#x27;leesin&#x27;</span>, <span class="string">&#x27;&#123;noop&#125;1234&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `sys_user`  <span class="keyword">VALUES</span> (<span class="number">2</span>, <span class="string">&#x27;talon&#x27;</span>, <span class="string">&#x27;&#123;noop&#125;1234&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `sys_user`  <span class="keyword">VALUES</span> (<span class="number">3</span>, <span class="string">&#x27;ekko&#x27;</span>, <span class="string">&#x27;&#123;noop&#125;1234&#x27;</span>);</span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="comment">-- Table structure for sys_role</span></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> `sys_role`;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `sys_role` (</span><br><span class="line">  `id` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  `name` <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `nameZh` <span class="type">varchar</span>(<span class="number">100</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;ä¸­æ–‡å&#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB AUTO_INCREMENT<span class="operator">=</span><span class="number">3</span> <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb4 COMMENT<span class="operator">=</span><span class="string">&#x27;è§’è‰²è¡¨&#x27;</span>;</span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="comment">-- Records of sys_role</span></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="keyword">BEGIN</span>;</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `sys_role`  <span class="keyword">VALUES</span> (<span class="number">1</span>, <span class="string">&#x27;ROLE_ADMIN&#x27;</span>, <span class="string">&#x27;ç³»ç»Ÿç®¡ç†å‘˜&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `sys_role`  <span class="keyword">VALUES</span> (<span class="number">2</span>, <span class="string">&#x27;ROLE_USER&#x27;</span>, <span class="string">&#x27;æ™®é€šç”¨æˆ·&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `sys_role`  <span class="keyword">VALUES</span> (<span class="number">3</span>, <span class="string">&#x27;ROLE_GUEST&#x27;</span>, <span class="string">&#x27;æ¸¸å®¢&#x27;</span>);</span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="comment">-- Table structure for sys_menu</span></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> `sys_menu`;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `sys_menu` (</span><br><span class="line">  `id` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  `menu_name` <span class="type">varchar</span>(<span class="number">64</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;NULL&#x27;</span> COMMENT <span class="string">&#x27;èœå•å&#x27;</span>,</span><br><span class="line">  `permission` <span class="type">varchar</span>(<span class="number">100</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;æƒé™æ ‡è¯†&#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB AUTO_INCREMENT<span class="operator">=</span><span class="number">2</span> <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb4 COMMENT<span class="operator">=</span><span class="string">&#x27;èœå•è¡¨&#x27;</span>;</span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="comment">-- Records of sys_menu</span></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="keyword">BEGIN</span>;</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `sys_menu`  <span class="keyword">VALUES</span> (<span class="number">1</span>, <span class="string">&#x27;Aæƒé™&#x27;</span>, <span class="string">&#x27;system:A:list&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `sys_menu`  <span class="keyword">VALUES</span> (<span class="number">2</span>, <span class="string">&#x27;Bæƒé™&#x27;</span>, <span class="string">&#x27;system:B:list&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `sys_menu`  <span class="keyword">VALUES</span> (<span class="number">3</span>, <span class="string">&#x27;Cæƒé™&#x27;</span>, <span class="string">&#x27;system:C:list&#x27;</span>);</span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="comment">-- Table structure for sys_user_role</span></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> `sys_user_role`;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `sys_user_role` (</span><br><span class="line">  `id` <span class="type">bigint</span>(<span class="number">200</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  `user_id` <span class="type">bigint</span>(<span class="number">200</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;ç”¨æˆ·id&#x27;</span>,</span><br><span class="line">  `role_id` <span class="type">bigint</span>(<span class="number">200</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0&#x27;</span> COMMENT <span class="string">&#x27;è§’è‰²id&#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb4;</span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="comment">-- Records of sys_user_role</span></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="keyword">BEGIN</span>;</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `sys_user_role`  <span class="keyword">VALUES</span> (<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `sys_user_role`  <span class="keyword">VALUES</span> (<span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `sys_user_role`  <span class="keyword">VALUES</span> (<span class="number">3</span>, <span class="number">3</span>, <span class="number">3</span>);</span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="comment">-- Table structure for sys_role_menu</span></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> `sys_role_menu`;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `sys_role_menu` (</span><br><span class="line">  `id` <span class="type">bigint</span>(<span class="number">200</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  `role_id` <span class="type">bigint</span>(<span class="number">200</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;è§’è‰²ID&#x27;</span>,</span><br><span class="line">  `menu_id` <span class="type">bigint</span>(<span class="number">200</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0&#x27;</span> COMMENT <span class="string">&#x27;èœå•id&#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB AUTO_INCREMENT<span class="operator">=</span><span class="number">2</span> <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb4;</span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="comment">-- Records of sys_role_menu</span></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="keyword">BEGIN</span>;</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `sys_role_menu`  <span class="keyword">VALUES</span> (<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `sys_role_menu`  <span class="keyword">VALUES</span> (<span class="number">2</span>, <span class="number">1</span>, <span class="number">2</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `sys_role_menu`  <span class="keyword">VALUES</span> (<span class="number">3</span>, <span class="number">1</span>, <span class="number">3</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `sys_role_menu`  <span class="keyword">VALUES</span> (<span class="number">4</span>, <span class="number">2</span>, <span class="number">2</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `sys_role_menu`  <span class="keyword">VALUES</span> (<span class="number">5</span>, <span class="number">2</span>, <span class="number">3</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `sys_role_menu`  <span class="keyword">VALUES</span> (<span class="number">6</span>, <span class="number">3</span>, <span class="number">3</span>);</span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">SELECT </span><br><span class="line">DISTINCT menu.`permission`</span><br><span class="line">FROM</span><br><span class="line">sys_user_role ur</span><br><span class="line">LEFT JOIN `sys_role` role ON ur.`role_id` = role.`id`</span><br><span class="line">LEFT JOIN `sys_role_menu` rm ON ur.`role_id` = rm.`role_id`</span><br><span class="line">LEFT JOIN `sys_menu` menu ON menu.`id` = rm.`menu_id`</span><br><span class="line">WHERE</span><br><span class="line">user_id = 2</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@TableName(&quot;sys_menu&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Menu</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> -<span class="number">54979041104113736L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@TableId(type = IdType.AUTO)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * èœå•å</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String menuName;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æƒé™æ ‡è¯†</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String permission;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@TableName(&quot;sys_role&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Role</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> -<span class="number">54979041104113726L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@TableId(type = IdType.AUTO)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è§’è‰²å</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è§’è‰²åï¼ˆä¸­æ–‡ï¼‰</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String nameZh;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="ä»£ç å®ç°"><a href="#ä»£ç å®ç°" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h5><p>â€‹    æˆ‘ä»¬åªéœ€è¦æ ¹æ®ç”¨æˆ· id å»æŸ¥è¯¢åˆ°å…¶æ‰€å¯¹åº”çš„æƒé™ä¿¡æ¯å³å¯ã€‚</p><p>â€‹    æ‰€ä»¥æˆ‘ä»¬å¯ä»¥å…ˆå®šä¹‰ä¸ªmapperï¼Œå…¶ä¸­æä¾›ä¸€ä¸ªæ–¹æ³•å¯ä»¥æ ¹æ®useridæŸ¥è¯¢æƒé™ä¿¡æ¯ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">MenuMapper</span> <span class="keyword">extends</span> <span class="title class_">BaseMapper</span>&lt;Menu&gt; &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ ¹æ® userId æŸ¥è¯¢å‡ºè¯¥ç”¨æˆ·æ‰€æœ‰çš„æƒé™</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    List&lt;String&gt; <span class="title function_">selectPermsByUserId</span><span class="params">(<span class="meta">@Param(&quot;userId&quot;)</span> Long userId)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®šä¹‰å¯¹åº”çš„ sql è¯­å¥</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span> <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span> &gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.lyf.security.mapper.MenuMapper&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectPermsByUserId&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;java.lang.String&quot;</span>&gt;</span></span><br><span class="line">        SELECT</span><br><span class="line">            DISTINCT menu.`permission`</span><br><span class="line">        FROM</span><br><span class="line">            sys_user_role ur</span><br><span class="line">                LEFT JOIN `sys_role` role ON ur.`role_id` = role.`id`</span><br><span class="line">                LEFT JOIN `sys_role_menu` rm ON ur.`role_id` = rm.`role_id`</span><br><span class="line">                LEFT JOIN `sys_menu` menu ON menu.`id` = rm.`menu_id`</span><br><span class="line">        WHERE</span><br><span class="line">            user_id = #&#123;userId&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure><p>â€‹    ç„¶åæˆ‘ä»¬å¯ä»¥åœ¨ UserDetailsServiceImpl ä¸­å»è°ƒç”¨è¯¥ mapper çš„æ–¹æ³•æŸ¥è¯¢æƒé™ä¿¡æ¯å°è£…åˆ° LoginUser å¯¹è±¡ä¸­å³å¯ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: è‡ªå®šä¹‰ UserDetailsService ï¼Œè¦†ç›–é»˜è®¤çš„å®ç°ï¼ˆInMemoryUserDetailsManagerï¼‰ã€‚</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: Liu Yuefeng</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2023/6/7 11:24</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserDetailsServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">UserDetailsService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserMapper userMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> MenuMapper menuMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> UserDetails <span class="title function_">loadUserByUsername</span><span class="params">(String username)</span> <span class="keyword">throws</span> UsernameNotFoundException &#123;</span><br><span class="line">        LambdaQueryWrapper&lt;User&gt; wrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">        wrapper.eq(User::getUsername, username);</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userMapper.selectOne(wrapper);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (Objects.isNull(user)) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;ç”¨æˆ·åä¸å­˜åœ¨ï¼š&#123;&#125;&quot;</span>, username);</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;ç”¨æˆ·åä¸å­˜åœ¨ï¼&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ä»æ•°æ®åº“æŸ¥è¯¢ç”¨æˆ·æ‰€å…·å¤‡çš„æƒé™ä¿¡æ¯</span></span><br><span class="line">        List&lt;String&gt; permissions = menuMapper.selectPermsByUserId(user.getId());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å°è£…æˆ UserDetails å¯¹è±¡è¿”å›</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">LoginUser</span>(user, permissions);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é‡å¯æµ‹è¯•ï¼Œåˆ†åˆ«ç”¨ leesinï¼Œtalon å’Œ ekko ç™»é™†æµ‹è¯• <code>hi</code> å’Œ <code>hello</code> æ¥å£ã€‚</p><p>æµ‹è¯•ç»“æœæ˜¯ï¼šleesin å¯ä»¥è®¿é—®ä¸¤ä¸ªæ¥å£ï¼Œtalon åªå¯ä»¥è®¿é—® hello æ¥å£ï¼Œ ekko ä¸¤ä¸ªæ¥å£éƒ½æ— æ³•è®¿é—®ã€‚</p><h2 id="åŸºäºé…ç½®çš„æƒé™æ§åˆ¶"><a href="#åŸºäºé…ç½®çš„æƒé™æ§åˆ¶" class="headerlink" title="åŸºäºé…ç½®çš„æƒé™æ§åˆ¶"></a>åŸºäºé…ç½®çš„æƒé™æ§åˆ¶</h2><p>â€‹    æˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨é…ç½®ç±»ä¸­ä½¿ç”¨ä½¿ç”¨é…ç½®çš„æ–¹å¼å¯¹èµ„æºè¿›è¡Œæƒé™æ§åˆ¶ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">  http</span><br><span class="line">    <span class="comment">// å…³é—­ csrf</span></span><br><span class="line">    .csrf().disable()</span><br><span class="line">    <span class="comment">// ä¸é€šè¿‡ Session è·å– SecurityContext</span></span><br><span class="line">    .sessionManagement().sessionCreationPolicy(SessionCreationPolicy.STATELESS)</span><br><span class="line">    .and()</span><br><span class="line">    .authorizeRequests()</span><br><span class="line">    <span class="comment">// å¯¹äºç™»å½•æ¥å£ å…è®¸åŒ¿åè®¿é—®</span></span><br><span class="line">    .antMatchers(<span class="string">&quot;/user/login&quot;</span>).anonymous()</span><br><span class="line">    <span class="comment">// é…ç½® /test çš„æ‰€æœ‰å­æ¥å£æ‹¥æœ‰ system:A:listæƒé™ æ‰èƒ½è®¿é—®</span></span><br><span class="line">    .antMatchers(<span class="string">&quot;/test/**&quot;</span>).hasAuthority(<span class="string">&quot;system:A:list&quot;</span>)</span><br><span class="line">    <span class="comment">// é…ç½® /admin çš„æ‰€æœ‰å­æ¥å£æ‹¥æœ‰ ADMINè§’è‰² æ‰èƒ½è®¿é—®</span></span><br><span class="line">    .antMatchers(<span class="string">&quot;/admin/**&quot;</span>).hasRole(<span class="string">&quot;ADMIN&quot;</span>)</span><br><span class="line">    <span class="comment">// é™¤ä¸Šé¢å¤–çš„æ‰€æœ‰è¯·æ±‚å…¨éƒ¨éœ€è¦é‰´æƒè®¤è¯</span></span><br><span class="line">    .anyRequest().authenticated()</span><br><span class="line">    <span class="comment">// å¼€å¯ HttpBasic è®¤è¯</span></span><br><span class="line">    .and().httpBasic();</span><br><span class="line"></span><br><span class="line">  <span class="comment">//æŠŠtokenæ ¡éªŒè¿‡æ»¤å™¨æ·»åŠ åˆ°è¿‡æ»¤å™¨é“¾ä¸­</span></span><br><span class="line">  http.addFilterBefore(jwtAuthenticationTokenFilter, UsernamePasswordAuthenticationFilter.class);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>åŸºäºè§’è‰²çš„æƒé™è®¤è¯ï¼Œåœ¨æœ¬æ¬¡å­¦ä¹ ä¸­è¿˜æ²¡å®ç°ã€‚ï¼ˆå¾…å­¦ä¹ â€¦ï¼‰</p></blockquote><h2 id="æƒé™è¡¨è¾¾å¼"><a href="#æƒé™è¡¨è¾¾å¼" class="headerlink" title="æƒé™è¡¨è¾¾å¼"></a>æƒé™è¡¨è¾¾å¼</h2><p><img src="http://cdn.leesin.fun/typora/macpro/img/image-20220523153200373.png" alt="image-20220523153200373"></p><div class="table-container"><table><thead><tr><th>æ–¹æ³•</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>hasAuthority(String authority)</td><td>å½“å‰ç”¨æˆ·æ˜¯å¦å…·å¤‡æŒ‡å®šæƒé™</td></tr><tr><td>hasAnyAuthority(Stringâ€¦ authorities)</td><td>å½“å‰ç”¨æˆ·æ˜¯å¦å…·å¤‡æŒ‡å®šæƒé™ä¸­ä»»æ„ä¸€ä¸ª</td></tr><tr><td>hasRole(String role)</td><td>å½“å‰ç”¨æˆ·æ˜¯å¦å…·å¤‡æŒ‡å®šè§’è‰²</td></tr><tr><td>hasAnyRole(Stringâ€¦ roles);</td><td>å½“å‰ç”¨æˆ·æ˜¯å¦å…·å¤‡æŒ‡å®šè§’è‰²ä¸­ä»»æ„ä¸€ä¸ª</td></tr><tr><td>permitAll();</td><td>æ”¾è¡Œæ‰€æœ‰è¯·æ±‚/è°ƒç”¨</td></tr><tr><td>denyAll();</td><td>æ‹’ç»æ‰€æœ‰è¯·æ±‚/è°ƒç”¨</td></tr><tr><td>isAnonymous();</td><td>å½“å‰ç”¨æˆ·æ˜¯å¦æ˜¯ä¸€ä¸ªåŒ¿åç”¨æˆ·</td></tr><tr><td>isAuthenticated();</td><td>å½“å‰ç”¨æˆ·æ˜¯å¦å·²ç»è®¤è¯æˆåŠŸ</td></tr><tr><td>isRememberMe();</td><td>å½“å‰ç”¨æˆ·æ˜¯å¦é€šè¿‡ Remember-Me è‡ªåŠ¨ç™»å½•</td></tr><tr><td>isFullyAuthenticated();</td><td>å½“å‰ç”¨æˆ·æ˜¯å¦æ—¢ä¸æ˜¯åŒ¿åç”¨æˆ·åˆä¸æ˜¯é€šè¿‡ Remember-Me è‡ªåŠ¨ç™»å½•çš„</td></tr><tr><td>hasPermission(Object targetId, Object permission);</td><td>å½“å‰ç”¨æˆ·æ˜¯å¦å…·å¤‡æŒ‡å®šç›®æ ‡çš„æŒ‡å®šæƒé™ä¿¡æ¯</td></tr><tr><td>hasPermission(Object targetId, String targetType, Object permission);</td><td>å½“å‰ç”¨æˆ·æ˜¯å¦å…·å¤‡æŒ‡å®šç›®æ ‡çš„æŒ‡å®šæƒé™ä¿¡æ¯</td></tr></tbody></table></div><h1 id="å››-è‡ªå®šä¹‰å¤±è´¥å¤„ç†"><a href="#å››-è‡ªå®šä¹‰å¤±è´¥å¤„ç†" class="headerlink" title="å››. è‡ªå®šä¹‰å¤±è´¥å¤„ç†"></a>å››. è‡ªå®šä¹‰å¤±è´¥å¤„ç†</h1><p>â€‹    æˆ‘ä»¬è¿˜å¸Œæœ›åœ¨è®¤è¯å¤±è´¥æˆ–è€…æ˜¯æˆæƒå¤±è´¥çš„æƒ…å†µä¸‹ä¹Ÿèƒ½å’Œæˆ‘ä»¬çš„æ¥å£ä¸€æ ·è¿”å›ç›¸åŒç»“æ„çš„ jsonï¼Œè¿™æ ·å¯ä»¥è®©å‰ç«¯èƒ½å¯¹å“åº”è¿›è¡Œç»Ÿä¸€çš„å¤„ç†ã€‚è¦å®ç°è¿™ä¸ªåŠŸèƒ½æˆ‘ä»¬éœ€è¦çŸ¥é“ SpringSecurity çš„å¼‚å¸¸å¤„ç†æœºåˆ¶ã€‚</p><p>â€‹    åœ¨ SpringSecurity ä¸­ï¼Œå¦‚æœæˆ‘ä»¬åœ¨è®¤è¯æˆ–è€…æˆæƒçš„è¿‡ç¨‹ä¸­å‡ºç°äº†å¼‚å¸¸ä¼šè¢« ExceptionTranslationFilter æ•è·åˆ°ã€‚åœ¨ ExceptionTranslationFilter ä¸­ä¼šå»åˆ¤æ–­æ˜¯è®¤è¯å¤±è´¥è¿˜æ˜¯æˆæƒå¤±è´¥å‡ºç°çš„å¼‚å¸¸ã€‚</p><p>â€‹    å¦‚æœæ˜¯è®¤è¯è¿‡ç¨‹ä¸­å‡ºç°çš„å¼‚å¸¸ä¼šè¢«å°è£…æˆ AuthenticationException ç„¶åè°ƒç”¨ <strong>AuthenticationEntryPoint</strong> å¯¹è±¡çš„æ–¹æ³•å»è¿›è¡Œå¼‚å¸¸å¤„ç†ã€‚</p><p>â€‹    å¦‚æœæ˜¯æˆæƒè¿‡ç¨‹ä¸­å‡ºç°çš„å¼‚å¸¸ä¼šè¢«å°è£…æˆ AccessDeniedException ç„¶åè°ƒç”¨ <strong>AccessDeniedHandler</strong> å¯¹è±¡çš„æ–¹æ³•å»è¿›è¡Œå¼‚å¸¸å¤„ç†ã€‚</p><p>â€‹    æ‰€ä»¥å¦‚æœæˆ‘ä»¬éœ€è¦è‡ªå®šä¹‰å¼‚å¸¸å¤„ç†ï¼Œæˆ‘ä»¬åªéœ€è¦è‡ªå®šä¹‰ AuthenticationEntryPoint å’Œ AccessDeniedHandler ç„¶åé…ç½®ç»™ SpringSecurity å³å¯ã€‚</p><p>â‘ è‡ªå®šä¹‰å®ç°ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AuthenticationEntryPointImpl</span> <span class="keyword">implements</span> <span class="title class_">AuthenticationEntryPoint</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">commence</span><span class="params">(HttpServletRequest request, HttpServletResponse response, AuthenticationException e)</span> &#123;</span><br><span class="line">        <span class="type">Result</span> <span class="variable">result</span> <span class="operator">=</span> Result.fail(HttpStatus.UNAUTHORIZED.value(), <span class="string">&quot;è®¤è¯å¤±è´¥ï¼Œè¯·æ£€æŸ¥è´¦å·å¯†ç ï¼&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">json</span> <span class="operator">=</span> JSON.toJSONString(result);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            response.setStatus(<span class="number">200</span>);</span><br><span class="line">            response.setContentType(<span class="string">&quot;application/json&quot;</span>);</span><br><span class="line">            response.setCharacterEncoding(<span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line">            response.getWriter().print(json);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException ioException) &#123;</span><br><span class="line">            ioException.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AccessDeniedHandlerImpl</span> <span class="keyword">implements</span> <span class="title class_">AccessDeniedHandler</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, AccessDeniedException e)</span>&#123;</span><br><span class="line">        <span class="type">Result</span> <span class="variable">result</span> <span class="operator">=</span> Result.fail(HttpStatus.FORBIDDEN.value(), <span class="string">&quot;æƒé™ä¸è¶³&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">json</span> <span class="operator">=</span> JSON.toJSONString(result);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            response.setStatus(<span class="number">200</span>);</span><br><span class="line">            response.setContentType(<span class="string">&quot;application/json&quot;</span>);</span><br><span class="line">            response.setCharacterEncoding(<span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line">            response.getWriter().print(json);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException ioException) &#123;</span><br><span class="line">            ioException.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â‘¡é…ç½® SecurityConfig</p><p>â€‹    </p><p>â€‹    å…ˆæ³¨å…¥å¯¹åº”çš„å¤„ç†å™¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> AuthenticationEntryPoint authenticationEntryPoint;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> AccessDeniedHandler accessDeniedHandler;</span><br></pre></td></tr></table></figure><p>â€‹    ç„¶åæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ HttpSecurity å¯¹è±¡çš„æ–¹æ³•å»é…ç½®ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">  http</span><br><span class="line">    <span class="comment">// å…³é—­ csrf</span></span><br><span class="line">    .csrf().disable()</span><br><span class="line">    <span class="comment">// ä¸é€šè¿‡ Session è·å– SecurityContext</span></span><br><span class="line">    .sessionManagement().sessionCreationPolicy(SessionCreationPolicy.STATELESS)</span><br><span class="line">    .and()</span><br><span class="line">    .authorizeRequests()</span><br><span class="line">    <span class="comment">// å¯¹äºç™»å½•æ¥å£ å…è®¸åŒ¿åè®¿é—®</span></span><br><span class="line">    .antMatchers(<span class="string">&quot;/user/login&quot;</span>).anonymous()</span><br><span class="line">    <span class="comment">// é…ç½® /test çš„æ‰€æœ‰å­æ¥å£æ‹¥æœ‰ system:A:listæƒé™ æ‰èƒ½è®¿é—®</span></span><br><span class="line">    .antMatchers(<span class="string">&quot;/test/**&quot;</span>).hasAuthority(<span class="string">&quot;system:A:list&quot;</span>)</span><br><span class="line">    <span class="comment">// é…ç½® /admin çš„æ‰€æœ‰å­æ¥å£æ‹¥æœ‰ ADMINè§’è‰² æ‰èƒ½è®¿é—®</span></span><br><span class="line">    .antMatchers(<span class="string">&quot;/admin/**&quot;</span>).hasRole(<span class="string">&quot;ADMIN&quot;</span>)</span><br><span class="line">    <span class="comment">// é™¤ä¸Šé¢å¤–çš„æ‰€æœ‰è¯·æ±‚å…¨éƒ¨éœ€è¦é‰´æƒè®¤è¯</span></span><br><span class="line">    .anyRequest().authenticated()</span><br><span class="line">    <span class="comment">// å¼€å¯ HttpBasic è®¤è¯</span></span><br><span class="line">    .and().httpBasic();</span><br><span class="line"></span><br><span class="line">  <span class="comment">//æŠŠtokenæ ¡éªŒè¿‡æ»¤å™¨æ·»åŠ åˆ°è¿‡æ»¤å™¨é“¾ä¸­</span></span><br><span class="line">  http.addFilterBefore(jwtAuthenticationTokenFilter, UsernamePasswordAuthenticationFilter.class);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// é…ç½®å¼‚å¸¸å¤„ç†å™¨</span></span><br><span class="line">  http</span><br><span class="line">    .exceptionHandling()</span><br><span class="line">    <span class="comment">// é…ç½®è‡ªå®šä¹‰è®¤è¯å¤±è´¥</span></span><br><span class="line">    .authenticationEntryPoint(authenticationEntryPoint)</span><br><span class="line">    <span class="comment">// é…ç½®è‡ªå®šä¹‰æˆæƒå¤±è´¥</span></span><br><span class="line">    .accessDeniedHandler(accessDeniedHandler);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨æ­¤ä¹‹å‰çš„è®¤è¯å¤±è´¥ï¼Œæ˜¯æ²¡æœ‰è¿”å›ç»“æœçš„ï¼Œåªè¿”å›401</p><p>é…ç½®è‡ªå®šä¹‰çš„å¤±è´¥å¤„ç†åï¼Œæ˜¯è¿™æ ·çš„ï¼š</p><p><img src="http://cdn.leesin.fun/typora/macpro/img/image-20230609170319354.png" alt="image-20230609170319354" style="zoom:50%;"></p><p>åœ¨æ­¤ä¹‹å‰çš„æˆæƒå¤±è´¥è¿”å›ç»“æœæ˜¯è¿™æ ·çš„ï¼š</p><p><img src="http://cdn.leesin.fun/typora/macpro/img/a418684d-2c77-43f1-9f9a-505a77777303.jpeg" alt="a418684d-2c77-43f1-9f9a-505a77777303" style="zoom:50%;"></p><p>é…ç½®äº†è‡ªå®šä¹‰æˆæƒå¤±è´¥å¤„ç†åï¼Œæ˜¯è¿™æ ·çš„ï¼š</p><p><img src="http://cdn.leesin.fun/typora/macpro/img/image-20230609165936183.png" alt="image-20230609165936183" style="zoom:50%;"></p><h1 id="äº”-è·¨åŸŸ"><a href="#äº”-è·¨åŸŸ" class="headerlink" title="äº”. è·¨åŸŸ"></a>äº”. è·¨åŸŸ</h1><p>â€‹    æµè§ˆå™¨å‡ºäºå®‰å…¨çš„è€ƒè™‘ï¼Œä½¿ç”¨ XMLHttpRequest å¯¹è±¡å‘èµ· HTTP è¯·æ±‚æ—¶å¿…é¡»éµå®ˆåŒæºç­–ç•¥ï¼Œå¦åˆ™å°±æ˜¯è·¨åŸŸçš„ HTTP è¯·æ±‚ï¼Œé»˜è®¤æƒ…å†µä¸‹æ˜¯è¢«ç¦æ­¢çš„ã€‚ åŒæºç­–ç•¥è¦æ±‚æºç›¸åŒæ‰èƒ½æ­£å¸¸è¿›è¡Œé€šä¿¡ï¼Œå³åè®®ã€åŸŸåã€ç«¯å£å·éƒ½å®Œå…¨ä¸€è‡´ã€‚ </p><p>â€‹    å‰åç«¯åˆ†ç¦»é¡¹ç›®ï¼Œå‰ç«¯é¡¹ç›®å’Œåç«¯é¡¹ç›®ä¸€èˆ¬éƒ½ä¸æ˜¯åŒæºçš„ï¼Œæ‰€ä»¥è‚¯å®šä¼šå­˜åœ¨è·¨åŸŸè¯·æ±‚çš„é—®é¢˜ã€‚</p><p>â€‹    æ‰€ä»¥æˆ‘ä»¬å°±è¦å¤„ç†ä¸€ä¸‹ï¼Œè®©å‰ç«¯èƒ½è¿›è¡Œè·¨åŸŸè¯·æ±‚ã€‚</p><p>â‘ å…ˆå¯¹ SpringBoot é…ç½®ï¼Œè¿è¡Œè·¨åŸŸè¯·æ±‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CorsConfig</span> <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addCorsMappings</span><span class="params">(CorsRegistry registry)</span> &#123;</span><br><span class="line">      <span class="comment">// è®¾ç½®å…è®¸è·¨åŸŸçš„è·¯å¾„</span></span><br><span class="line">        registry.addMapping(<span class="string">&quot;/**&quot;</span>)</span><br><span class="line">                <span class="comment">// è®¾ç½®å…è®¸è·¨åŸŸè¯·æ±‚çš„åŸŸå</span></span><br><span class="line">                .allowedOriginPatterns(<span class="string">&quot;*&quot;</span>)</span><br><span class="line">                <span class="comment">// æ˜¯å¦å…è®¸cookie</span></span><br><span class="line">                .allowCredentials(<span class="literal">true</span>)</span><br><span class="line">                <span class="comment">// è®¾ç½®å…è®¸çš„è¯·æ±‚æ–¹å¼</span></span><br><span class="line">                .allowedMethods(<span class="string">&quot;GET&quot;</span>, <span class="string">&quot;POST&quot;</span>, <span class="string">&quot;DELETE&quot;</span>, <span class="string">&quot;PUT&quot;</span>)</span><br><span class="line">                <span class="comment">// è®¾ç½®å…è®¸çš„headerå±æ€§</span></span><br><span class="line">                .allowedHeaders(<span class="string">&quot;*&quot;</span>)</span><br><span class="line">                <span class="comment">// è·¨åŸŸå…è®¸æ—¶é—´</span></span><br><span class="line">                .maxAge(<span class="number">3600</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â‘¡å¼€å¯ SpringSecurity çš„è·¨åŸŸè®¿é—®</p><p>ç”±äºæˆ‘ä»¬çš„èµ„æºéƒ½ä¼šæ”¶åˆ° SpringSecurity çš„ä¿æŠ¤ï¼Œæ‰€ä»¥æƒ³è¦è·¨åŸŸè®¿é—®è¿˜è¦è®© SpringSecurity è¿è¡Œè·¨åŸŸè®¿é—®ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">  http</span><br><span class="line">    <span class="comment">// å…³é—­ csrf</span></span><br><span class="line">    .csrf().disable()</span><br><span class="line">    <span class="comment">// ä¸é€šè¿‡ Session è·å– SecurityContext</span></span><br><span class="line">    .sessionManagement().sessionCreationPolicy(SessionCreationPolicy.STATELESS)</span><br><span class="line">    .and()</span><br><span class="line">    .authorizeRequests()</span><br><span class="line">    <span class="comment">// å¯¹äºç™»å½•æ¥å£ å…è®¸åŒ¿åè®¿é—®</span></span><br><span class="line">    .antMatchers(<span class="string">&quot;/user/login&quot;</span>).anonymous()</span><br><span class="line">    <span class="comment">// é…ç½® /test çš„æ‰€æœ‰å­æ¥å£æ‹¥æœ‰ system:A:listæƒé™ æ‰èƒ½è®¿é—®</span></span><br><span class="line">    .antMatchers(<span class="string">&quot;/test/**&quot;</span>).hasAuthority(<span class="string">&quot;system:A:list&quot;</span>)</span><br><span class="line">    <span class="comment">// é…ç½® /admin çš„æ‰€æœ‰å­æ¥å£æ‹¥æœ‰ ADMINè§’è‰² æ‰èƒ½è®¿é—®</span></span><br><span class="line">    .antMatchers(<span class="string">&quot;/admin/**&quot;</span>).hasRole(<span class="string">&quot;ADMIN&quot;</span>)</span><br><span class="line">    <span class="comment">// é™¤ä¸Šé¢å¤–çš„æ‰€æœ‰è¯·æ±‚å…¨éƒ¨éœ€è¦é‰´æƒè®¤è¯</span></span><br><span class="line">    .anyRequest().authenticated()</span><br><span class="line">    <span class="comment">// å¼€å¯ HttpBasic è®¤è¯</span></span><br><span class="line">    .and().httpBasic();</span><br><span class="line"></span><br><span class="line">  <span class="comment">//æŠŠtokenæ ¡éªŒè¿‡æ»¤å™¨æ·»åŠ åˆ°è¿‡æ»¤å™¨é“¾ä¸­</span></span><br><span class="line">  http.addFilterBefore(jwtAuthenticationTokenFilter, UsernamePasswordAuthenticationFilter.class);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// é…ç½®å¼‚å¸¸å¤„ç†å™¨</span></span><br><span class="line">  http</span><br><span class="line">    .exceptionHandling()</span><br><span class="line">    <span class="comment">// é…ç½®è‡ªå®šä¹‰è®¤è¯å¤±è´¥</span></span><br><span class="line">    .authenticationEntryPoint(authenticationEntryPoint)</span><br><span class="line">    <span class="comment">// é…ç½®è‡ªå®šä¹‰æˆæƒå¤±è´¥</span></span><br><span class="line">    .accessDeniedHandler(accessDeniedHandler);</span><br><span class="line"></span><br><span class="line">  <span class="comment">//å…è®¸è·¨åŸŸ</span></span><br><span class="line">  http.cors();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="å…­-è¿‡æ»¤å™¨"><a href="#å…­-è¿‡æ»¤å™¨" class="headerlink" title="å…­. è¿‡æ»¤å™¨"></a>å…­. è¿‡æ»¤å™¨</h1><h2 id="SecurityContextPersistenceFilter"><a href="#SecurityContextPersistenceFilter" class="headerlink" title="SecurityContextPersistenceFilter"></a>SecurityContextPersistenceFilter</h2><p>è¿™ä¸ªè¿‡æ»¤å™¨æœ‰ä¸¤ä¸ªä½œç”¨ï¼š</p><ul><li>ç”¨æˆ·å‘é€è¯·æ±‚æ—¶ï¼Œä» session å¯¹è±¡æå–ç”¨æˆ·ä¿¡æ¯ï¼Œä¿å­˜åˆ° SecurityContextHolder çš„ securitycontext ä¸­</li><li>å½“å‰è¯·æ±‚å“åº”ç»“æŸæ—¶ï¼ŒæŠŠ SecurityContextHolder çš„ securitycontext ä¿å­˜çš„ç”¨æˆ·ä¿¡æ¯æ”¾åˆ° sessionï¼Œä¾¿äºä¸‹æ¬¡è¯·æ±‚æ—¶å…±äº«æ•°æ®ï¼›åŒæ—¶å°† SecurityContextHolder çš„ securitycontext æ¸…ç©º</li></ul><p>ç”±äºç¦ç”¨ session åŠŸèƒ½ï¼Œæ‰€ä»¥è¯¥è¿‡æ»¤å™¨åªå‰©ä¸€ä¸ªä½œç”¨å³æŠŠ SecurityContextHolder çš„ securitycontext æ¸…ç©ºã€‚</p><p>ä¸¾ä¾‹æ¥è¯´æ˜ä¸ºä½•è¦æ¸…ç©º securitycontextï¼šç”¨æˆ·1å‘é€ä¸€ä¸ªè¯·æ±‚ï¼Œç”±çº¿ç¨‹Må¤„ç†ï¼Œå½“å“åº”å®Œæˆçº¿ç¨‹Mæ”¾å›çº¿ç¨‹æ± ï¼›ç”¨æˆ·2å‘é€ä¸€ä¸ªè¯·æ±‚ï¼Œæœ¬æ¬¡è¯·æ±‚åŒæ ·ç”±çº¿ç¨‹Må¤„ç†ï¼Œç”±äº securitycontext æ²¡æœ‰æ¸…ç©ºï¼Œç†åº”å‚¨å­˜ç”¨æˆ·2çš„ä¿¡æ¯ä½†æ­¤æ—¶å‚¨å­˜çš„æ˜¯ç”¨æˆ·1çš„ä¿¡æ¯ï¼Œé€ æˆç”¨æˆ·ä¿¡æ¯ä¸ç¬¦</p><h1 id="å‚è€ƒ-æ¥æº"><a href="#å‚è€ƒ-æ¥æº" class="headerlink" title="å‚è€ƒ/æ¥æº"></a>å‚è€ƒ/æ¥æº</h1><blockquote><p><a href="https://www.bilibili.com/video/BV1mm4y1X7Hc/">https://www.bilibili.com/video/BV1mm4y1X7Hc/</a></p><p><a href="https://www.cnblogs.com/crazymakercircle/p/14488160.html#autoid-h3-9-2-0">https://www.cnblogs.com/crazymakercircle/p/14488160.html#autoid-h3-9-2-0</a></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> åç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SpringSecurity </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Streamæµæ“ä½œ</title>
      <link href="/post/41.html"/>
      <url>/post/41.html</url>
      
        <content type="html"><![CDATA[<p>Stream çš„æ“ä½œä¸‰ä¸ªæ­¥éª¤</p><ol><li><p>åˆ›å»º Stream<br>ä¸€ä¸ªæ•°æ®æºï¼ˆå¦‚ï¼šé›†åˆã€æ•°ç»„ï¼‰ï¼Œè·å–ä¸€ä¸ªæµ</p></li><li><p>ä¸­é—´æ“ä½œ<br>ä¸€ä¸ªä¸­é—´æ“ä½œé“¾ï¼Œå¯¹æ•°æ®æºçš„æ•°æ®è¿›è¡Œå¤„ç†</p></li><li><p>ç»ˆæ­¢æ“ä½œï¼ˆç»ˆç«¯æ“ä½œï¼‰<br>ä¸€æ—¦æ‰§è¡Œç»ˆæ­¢æ“ä½œï¼Œå°±æ‰§è¡Œä¸­é—´æ“ä½œé“¾ï¼Œå¹¶äº§ç”Ÿç»“æœã€‚ä¹‹åï¼Œä¸ä¼šå†è¢«ä½¿ç”¨</p></li></ol><p>æ³¨æ„ç‚¹ï¼š<br>â‘ Stream è‡ªå·±ä¸ä¼šå­˜å‚¨å…ƒç´ ã€‚<br>â‘¡Stream ä¸ä¼šæ”¹å˜æºå¯¹è±¡ã€‚ç›¸åï¼Œä»–ä»¬ä¼šè¿”å›ä¸€ä¸ªæŒæœ‰ç»“æœçš„æ–° Streamã€‚<br>â‘¢Stream æ“ä½œæ˜¯å»¶è¿Ÿæ‰§è¡Œçš„ã€‚è¿™æ„å‘³ç€ä»–ä»¬ä¼šç­‰åˆ°éœ€è¦ç»“æœçš„æ—¶å€™æ‰æ‰§è¡Œã€‚</p><h1 id="åˆ›å»ºStream"><a href="#åˆ›å»ºStream" class="headerlink" title="åˆ›å»ºStream"></a>åˆ›å»ºStream</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å®ä¾‹åŒ–æ–¹å¼ä¸€ï¼šé€šè¿‡é›†åˆ</span></span><br><span class="line">List&lt;String&gt; lists = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;String&gt;()&#123;&#123;</span><br><span class="line">  add(<span class="string">&quot;Amy&quot;</span>);</span><br><span class="line">  add(<span class="string">&quot;Tom&quot;</span>);</span><br><span class="line">  add(<span class="string">&quot;Jine&quot;</span>);</span><br><span class="line">&#125;&#125;;</span><br><span class="line"><span class="comment">//è¿”å›ä¸€ä¸ªé¡ºåºæµ</span></span><br><span class="line">Stream&lt;String&gt; stream = lists.stream();</span><br><span class="line"><span class="comment">//è¿”å›ä¸€ä¸ªå¹¶è¡Œæµ</span></span><br><span class="line">Stream&lt;String&gt; stream2 = lists.parallelStream();</span><br><span class="line"></span><br><span class="line"><span class="comment">//å®ä¾‹åŒ–æ–¹å¼äºŒï¼šé€šè¿‡æ•°ç»„</span></span><br><span class="line"><span class="type">int</span>[] nums = &#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">56</span>&#125;;</span><br><span class="line"><span class="type">IntStream</span> <span class="variable">arrStream</span> <span class="operator">=</span> Arrays.stream(nums);</span><br><span class="line"></span><br><span class="line"><span class="comment">//å®ä¾‹åŒ–æ–¹å¼ä¸‰ï¼šé€šè¿‡Streamçš„of()</span></span><br><span class="line">Stream&lt;Integer&gt; integerStream = Stream.of(<span class="number">12</span>, <span class="number">34</span>, <span class="number">45</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//å®ä¾‹åŒ–æ–¹å¼å››ï¼šåˆ›å»ºæ— é™æµ</span></span><br><span class="line"><span class="comment">//éå†å‰10ä¸ªå¶æ•°</span></span><br><span class="line"><span class="comment">//è¿­ä»£</span></span><br><span class="line">Stream.iterate(<span class="number">0</span>,t -&gt; t + <span class="number">2</span>).limit(<span class="number">10</span>).forEach(System.out::println);</span><br><span class="line"></span><br><span class="line"><span class="comment">//ç”Ÿæˆ</span></span><br><span class="line">Stream.generate(Math::random).limit(<span class="number">10</span>).forEach(System.out::println);</span><br></pre></td></tr></table></figure><h1 id="å¸¸ç”¨ä¸­é—´æ“ä½œ"><a href="#å¸¸ç”¨ä¸­é—´æ“ä½œ" class="headerlink" title="å¸¸ç”¨ä¸­é—´æ“ä½œ"></a>å¸¸ç”¨ä¸­é—´æ“ä½œ</h1><h2 id="1-ç­›é€‰ä¸åˆ‡ç‰‡"><a href="#1-ç­›é€‰ä¸åˆ‡ç‰‡" class="headerlink" title="1-ç­›é€‰ä¸åˆ‡ç‰‡"></a>1-ç­›é€‰ä¸åˆ‡ç‰‡</h2><div class="table-container"><table><thead><tr><th style="text-align:left">æ–¹æ³•</th><th style="text-align:left">æè¿°</th></tr></thead><tbody><tr><td style="text-align:left"><code>filter(Predicate p)</code></td><td style="text-align:left">æ¥æ”¶Lambdaï¼Œä»æµä¸­æ’å‡ºæŸäº›å…ƒç´ </td></tr><tr><td style="text-align:left"><code>distinct()</code></td><td style="text-align:left">ç­›é€‰ï¼Œé€šè¿‡æµæ‰€ç”Ÿæˆå…ƒç´ çš„ <code>hashCode()</code> å’Œ <code>equals()</code> å»é™¤é‡å¤å…ƒç´ </td></tr><tr><td style="text-align:left"><code>limit(long maxSize)</code></td><td style="text-align:left">æˆªæ–­æµï¼Œä½¿å…¶å…ƒç´ ä¸è¶…è¿‡ç»™å®šæ•°é‡</td></tr><tr><td style="text-align:left"><code>skip(long n)</code></td><td style="text-align:left">è·³è¿‡å…ƒç´ ï¼Œè¿”å›ä¸€ä¸ªæ‰”æ‰äº†å‰ n ä¸ªå…ƒç´ çš„æµã€‚è‹¥æµä¸­å…ƒç´ ä¸è¶³ n ä¸ªï¼Œåˆ™è¿”å›ä¸€ä¸ªç©ºæµã€‚ä¸ <code>limit(n)</code> äº’è¡¥</td></tr></tbody></table></div><h2 id="2-æ˜ å°„"><a href="#2-æ˜ å°„" class="headerlink" title="2-æ˜ å°„"></a>2-æ˜ å°„</h2><div class="table-container"><table><thead><tr><th>æ–¹æ³•</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>map(Function f)</code></td><td>æ¥æ”¶ä¸€ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œè¯¥å‡½æ•°ä¼šè¢«åº”ç”¨åˆ°æ¯ä¸ªå…ƒç´ ä¸Šï¼Œå¹¶å°†å…¶æ˜ å°„æˆä¸€ä¸ªæ–°çš„å…ƒç´ </td></tr><tr><td><code>mapToDouble(ToDoubleFunction f)</code></td><td>æ¥æ”¶ä¸€ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œè¯¥å‡½æ•°ä¼šè¢«åº”ç”¨åˆ°æ¯ä¸ªå…ƒç´ ä¸Šï¼Œå¹¶äº§ç”Ÿä¸€ä¸ªæ–°çš„ DoubleStream</td></tr><tr><td><code>mapToInt(ToIntFunction f)</code></td><td>æ¥æ”¶ä¸€ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œè¯¥å‡½æ•°ä¼šè¢«åº”ç”¨åˆ°æ¯ä¸ªå…ƒç´ ä¸Šï¼Œå¹¶äº§ç”Ÿä¸€ä¸ªæ–°çš„ IntStream</td></tr><tr><td><code>mapToLong(ToLongFunction f)</code></td><td>æ¥æ”¶ä¸€ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œè¯¥å‡½æ•°ä¼šè¢«åº”ç”¨åˆ°æ¯ä¸ªå…ƒç´ ä¸Šï¼Œå¹¶äº§ç”Ÿä¸€ä¸ªæ–°çš„ LongStream</td></tr><tr><td><code>flatMap(Function f)</code></td><td>æ¥æ”¶ä¸€ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œå°†æµä¸­çš„æ¯ä¸ªå€¼éƒ½æ¢æˆå¦ä¸€ä¸ªæµï¼Œç„¶åæŠŠæ‰€æœ‰è¿æ¥æˆä¸€ä¸ªæµ</td></tr></tbody></table></div><h2 id="3-æ’åº"><a href="#3-æ’åº" class="headerlink" title="3-æ’åº"></a>3-æ’åº</h2><div class="table-container"><table><thead><tr><th>æ–¹æ³•</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>sorted()</code></td><td>äº§ç”Ÿä¸€ä¸ªæ–°æµï¼Œå…¶ä¸­æŒ‰è‡ªç„¶é¡ºåºæ’åº</td></tr><tr><td><code>sorted(Comparator com)</code></td><td>äº§ç”Ÿä¸€ä¸ªæ–°æµï¼Œå…¶ä¸­æŒ‰æ¯”è¾ƒå™¨é¡ºåºæ’åº</td></tr></tbody></table></div><h1 id="å¸¸è§ç»ˆæ­¢æ“ä½œ"><a href="#å¸¸è§ç»ˆæ­¢æ“ä½œ" class="headerlink" title="å¸¸è§ç»ˆæ­¢æ“ä½œ"></a>å¸¸è§ç»ˆæ­¢æ“ä½œ</h1><h2 id="1-åŒ¹é…ä¸æŸ¥æ‰¾"><a href="#1-åŒ¹é…ä¸æŸ¥æ‰¾" class="headerlink" title="1-åŒ¹é…ä¸æŸ¥æ‰¾"></a>1-åŒ¹é…ä¸æŸ¥æ‰¾</h2><div class="table-container"><table><thead><tr><th>æ–¹æ³•</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>allMatch(Predicate p)</code></td><td>æ£€æŸ¥æ˜¯å¦åŒ¹é…æ‰€æœ‰å…ƒç´ </td></tr><tr><td><code>anyMatch(Predicate p)</code></td><td>æ£€æŸ¥æ˜¯å¦è‡³å°‘åŒ¹é…ä¸€ä¸ªå…ƒç´ </td></tr><tr><td><code>noneMatch(Predicate p)</code></td><td>æ£€æŸ¥æ˜¯å¦æ²¡æœ‰åŒ¹é…æ‰€æœ‰å…ƒç´ </td></tr><tr><td><code>findFirst()</code></td><td>è¿”å›ç¬¬ä¸€ä¸ªå…ƒç´ </td></tr><tr><td><code>findAny()</code></td><td>è¿”å›å½“å‰æµä¸­çš„ä»»æ„å…ƒç´ </td></tr><tr><td><code>count()</code></td><td>è¿”å›æµä¸­å…ƒç´ æ€»æ•°</td></tr><tr><td><code>max(Comparator c)</code></td><td>è¿”å›æµä¸­æœ€å¤§å€¼</td></tr><tr><td><code>min(Comparator c)</code></td><td>è¿”å›æµä¸­æœ€å°å€¼</td></tr><tr><td><code>forEach(Consumer c)</code></td><td><strong>å†…éƒ¨è¿­ä»£</strong>ï¼ˆä½¿ç”¨ Collection æ¥å£éœ€è¦ç”¨æˆ·å»åšè¿­ä»£ï¼Œç§°ä¸ºå¤–éƒ¨è¿­ä»£ã€‚ï¼‰</td></tr></tbody></table></div><h2 id="2-è§„çº¦"><a href="#2-è§„çº¦" class="headerlink" title="2-è§„çº¦"></a>2-è§„çº¦</h2><div class="table-container"><table><thead><tr><th>æ–¹æ³•</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>reduce(T iden, BinaryOperator b)</code></td><td>å¯ä»¥å°†æµä¸­çš„å…ƒç´ åå¤ç»“åˆèµ·æ¥ï¼Œå¾—åˆ°ä¸€ä¸ªå€¼ã€‚è¿”å› T</td></tr><tr><td><code>reduce(BinaryOperator b)</code></td><td>å¯ä»¥å°†æµä¸­å…ƒç´ åå¤ç»“åˆèµ·æ¥ï¼Œå¾—åˆ°ä¸€ä¸ªå€¼ã€‚è¿”å› <code>Optional&lt;T&gt;</code></td></tr></tbody></table></div><h2 id="3-æ”¶é›†"><a href="#3-æ”¶é›†" class="headerlink" title="3-æ”¶é›†"></a>3-æ”¶é›†</h2><div class="table-container"><table><thead><tr><th>æ–¹æ³•</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>collect(Collector c)</code></td><td>å°†æµè½¬æ¢ä¸ºå…¶ä»–å½¢å¼ã€‚æ¥æ”¶ä¸€ä¸ª Collector æ¥å£çš„å®ç°ï¼Œç”¨äºç»™ Stream ä¸­å…ƒç´ åšæ±‡æ€»çš„æ–¹æ³•ã€‚</td></tr></tbody></table></div><h1 id="ä½¿ç”¨æ¡ˆä¾‹"><a href="#ä½¿ç”¨æ¡ˆä¾‹" class="headerlink" title="ä½¿ç”¨æ¡ˆä¾‹"></a>ä½¿ç”¨æ¡ˆä¾‹</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserEntity</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserVO</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="keyword">private</span> String role;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å»é‡ä¸”è·å–å¯¹åº”çš„å¹³æ–¹æ•°"><a href="#å»é‡ä¸”è·å–å¯¹åº”çš„å¹³æ–¹æ•°" class="headerlink" title="å»é‡ä¸”è·å–å¯¹åº”çš„å¹³æ–¹æ•°"></a>å»é‡ä¸”è·å–å¯¹åº”çš„å¹³æ–¹æ•°</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Integer&gt; list = Arrays.asList(<span class="number">3</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">5</span>, <span class="number">6</span>);</span><br><span class="line">List&lt;Integer&gt; squaresList = list.stream().distinct().map(i -&gt; i * i).collect(Collectors.toList());</span><br><span class="line">System.out.println(squaresList); <span class="comment">// [9, 4, 1, 25, 36]</span></span><br></pre></td></tr></table></figure><h2 id="æå–ç”¨æˆ·id"><a href="#æå–ç”¨æˆ·id" class="headerlink" title="æå–ç”¨æˆ·id"></a>æå–ç”¨æˆ·id</h2><p>å°†<code>List&lt;UserEntity&gt; userList</code> ç±»å‹è½¬ä¸º <code>List&lt;Long&gt; idList</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">List&lt;UserEntity&gt; userList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">userList.add(<span class="keyword">new</span> <span class="title class_">UserEntity</span>(<span class="number">1L</span>, <span class="string">&quot;leesin&quot;</span>, <span class="string">&quot;1234&quot;</span>));</span><br><span class="line">userList.add(<span class="keyword">new</span> <span class="title class_">UserEntity</span>(<span class="number">2L</span>, <span class="string">&quot;talon&quot;</span>, <span class="string">&quot;1234&quot;</span>));</span><br><span class="line">userList.add(<span class="keyword">new</span> <span class="title class_">UserEntity</span>(<span class="number">3L</span>, <span class="string">&quot;ekko&quot;</span>, <span class="string">&quot;1234&quot;</span>));</span><br><span class="line"></span><br><span class="line">List&lt;Long&gt; idList = userList.stream().map(userEntity -&gt; userEntity.getId()).collect(Collectors.toList());</span><br><span class="line">System.out.println(idList); <span class="comment">// [1, 2, 3]</span></span><br></pre></td></tr></table></figure><h2 id="å°†ç”¨æˆ·å®ä½“å¯¹è±¡è½¬ä¸ºVOå¯¹è±¡"><a href="#å°†ç”¨æˆ·å®ä½“å¯¹è±¡è½¬ä¸ºVOå¯¹è±¡" class="headerlink" title="å°†ç”¨æˆ·å®ä½“å¯¹è±¡è½¬ä¸ºVOå¯¹è±¡"></a>å°†ç”¨æˆ·å®ä½“å¯¹è±¡è½¬ä¸ºVOå¯¹è±¡</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">List&lt;UserEntity&gt; userList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">userList.add(<span class="keyword">new</span> <span class="title class_">UserEntity</span>(<span class="number">1L</span>, <span class="string">&quot;leesin&quot;</span>, <span class="string">&quot;1234&quot;</span>));</span><br><span class="line">userList.add(<span class="keyword">new</span> <span class="title class_">UserEntity</span>(<span class="number">2L</span>, <span class="string">&quot;talon&quot;</span>, <span class="string">&quot;1234&quot;</span>));</span><br><span class="line">userList.add(<span class="keyword">new</span> <span class="title class_">UserEntity</span>(<span class="number">3L</span>, <span class="string">&quot;ekko&quot;</span>, <span class="string">&quot;1234&quot;</span>));</span><br><span class="line"></span><br><span class="line">List&lt;UserVO&gt; userVOList = userList</span><br><span class="line">  .stream()</span><br><span class="line">  .map(userEntity -&gt; <span class="keyword">new</span> <span class="title class_">UserVO</span>(</span><br><span class="line">    userEntity.getId(),</span><br><span class="line">    userEntity.getUsername(),</span><br><span class="line">    userEntity.getId() == <span class="number">1</span> ? <span class="string">&quot;admin&quot;</span> : <span class="string">&quot;normal&quot;</span>))</span><br><span class="line">  .collect(Collectors.toList());</span><br><span class="line"></span><br><span class="line">System.out.println(userVOList);</span><br><span class="line"><span class="comment">// [</span></span><br><span class="line"><span class="comment">// UserVO(id=1, username=leesin, role=admin), </span></span><br><span class="line"><span class="comment">// UserVO(id=2, username=talon, role=normal), </span></span><br><span class="line"><span class="comment">//UserVO(id=3, username=ekko, role=normal)</span></span><br><span class="line"><span class="comment">// ]</span></span><br></pre></td></tr></table></figure><h2 id="ç»Ÿè®¡ç©ºå­—ç¬¦ä¸²çš„æ•°é‡"><a href="#ç»Ÿè®¡ç©ºå­—ç¬¦ä¸²çš„æ•°é‡" class="headerlink" title="ç»Ÿè®¡ç©ºå­—ç¬¦ä¸²çš„æ•°é‡"></a>ç»Ÿè®¡ç©ºå­—ç¬¦ä¸²çš„æ•°é‡</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">List&lt;String&gt; stringList = Arrays.asList(<span class="string">&quot;abc&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="string">&quot;bc&quot;</span>, <span class="string">&quot;efg&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="string">&quot;jkl&quot;</span>);</span><br><span class="line"><span class="type">long</span> <span class="variable">count</span> <span class="operator">=</span> stringList.stream().filter(str -&gt; str.isEmpty()).count();</span><br><span class="line">System.out.println(count); <span class="comment">// 2</span></span><br></pre></td></tr></table></figure><h2 id="æŸ¥æ‰¾usernameé•¿åº¦ä¸ºå¶æ•°çš„ç”¨æˆ·id"><a href="#æŸ¥æ‰¾usernameé•¿åº¦ä¸ºå¶æ•°çš„ç”¨æˆ·id" class="headerlink" title="æŸ¥æ‰¾usernameé•¿åº¦ä¸ºå¶æ•°çš„ç”¨æˆ·id"></a>æŸ¥æ‰¾usernameé•¿åº¦ä¸ºå¶æ•°çš„ç”¨æˆ·id</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">List&lt;UserEntity&gt; userList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">userList.add(<span class="keyword">new</span> <span class="title class_">UserEntity</span>(<span class="number">1L</span>, <span class="string">&quot;leesin&quot;</span>, <span class="string">&quot;1234&quot;</span>));</span><br><span class="line">userList.add(<span class="keyword">new</span> <span class="title class_">UserEntity</span>(<span class="number">2L</span>, <span class="string">&quot;talon&quot;</span>, <span class="string">&quot;1234&quot;</span>));</span><br><span class="line">userList.add(<span class="keyword">new</span> <span class="title class_">UserEntity</span>(<span class="number">3L</span>, <span class="string">&quot;ekko&quot;</span>, <span class="string">&quot;1234&quot;</span>));</span><br><span class="line"></span><br><span class="line">List&lt;Long&gt; idList = userList</span><br><span class="line">  .stream()</span><br><span class="line">  .filter(userEntity -&gt; userEntity.getUsername().length() % <span class="number">2</span> == <span class="number">0</span>)</span><br><span class="line">  .map(userEntity -&gt; userEntity.getId())</span><br><span class="line">  .collect(Collectors.toList());</span><br><span class="line"></span><br><span class="line">System.out.println(idList); <span class="comment">// [1, 3]</span></span><br></pre></td></tr></table></figure><h2 id="limitå’Œskip"><a href="#limitå’Œskip" class="headerlink" title="limitå’Œskip"></a>limitå’Œskip</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">List&lt;String&gt; strings = Arrays.asList(<span class="string">&quot;abc&quot;</span>, <span class="string">&quot;dd&quot;</span>, <span class="string">&quot;bc&quot;</span>, <span class="string">&quot;efg&quot;</span>, <span class="string">&quot;abcd&quot;</span>,<span class="string">&quot;cc&quot;</span>, <span class="string">&quot;jkl&quot;</span>);</span><br><span class="line">strings.stream().limit(<span class="number">2</span>).forEach(System.out::println);</span><br><span class="line"><span class="comment">//è¾“å‡º abc dd</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">List&lt;String&gt; strings = Arrays.asList(<span class="string">&quot;abc&quot;</span>, <span class="string">&quot;dd&quot;</span>, <span class="string">&quot;bc&quot;</span>, <span class="string">&quot;efg&quot;</span>, <span class="string">&quot;abcd&quot;</span>,<span class="string">&quot;cc&quot;</span>, <span class="string">&quot;jkl&quot;</span>);</span><br><span class="line">strings.stream().skip(<span class="number">4</span>).forEach(System.out::println);</span><br><span class="line"><span class="comment">//è¾“å‡º abcd cc jkl</span></span><br></pre></td></tr></table></figure><h2 id="å°†å­—ç¬¦ä¸²è½¬ä¸ºå¤§å†™"><a href="#å°†å­—ç¬¦ä¸²è½¬ä¸ºå¤§å†™" class="headerlink" title="å°†å­—ç¬¦ä¸²è½¬ä¸ºå¤§å†™"></a>å°†å­—ç¬¦ä¸²è½¬ä¸ºå¤§å†™</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">List&lt;String&gt; list = Arrays.asList(<span class="string">&quot;dev&quot;</span>, <span class="string">&quot;test&quot;</span>, <span class="string">&quot;Prod&quot;</span>);</span><br><span class="line">List&lt;String&gt; newList = list.stream().map(String::toUpperCase).collect(Collectors.toList());</span><br><span class="line">System.out.println(newList); <span class="comment">// [DEV, TEST, PROD]</span></span><br></pre></td></tr></table></figure><h2 id="æ’åº"><a href="#æ’åº" class="headerlink" title="æ’åº"></a>æ’åº</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Integer&gt; list = Arrays.asList(<span class="number">2</span>, <span class="number">8</span>, <span class="number">6</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">1</span>, <span class="number">9</span>);</span><br><span class="line"><span class="comment">// è‡ªç„¶åºæ’åº</span></span><br><span class="line">list.stream().sorted().forEach(System.out::print); <span class="comment">// 123456789</span></span><br><span class="line">System.out.println();</span><br><span class="line"><span class="comment">// é€†åºæ’åº</span></span><br><span class="line">list.stream().sorted(Comparator.reverseOrder()).forEach(System.out::print); <span class="comment">// 987654321</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> åç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>GatewayåŸºç¡€çŸ¥è¯†</title>
      <link href="/post/39.html"/>
      <url>/post/39.html</url>
      
        <content type="html"><![CDATA[<h2 id="ä¸ºä»€ä¹ˆéœ€è¦ç½‘å…³"><a href="#ä¸ºä»€ä¹ˆéœ€è¦ç½‘å…³" class="headerlink" title="ä¸ºä»€ä¹ˆéœ€è¦ç½‘å…³"></a>ä¸ºä»€ä¹ˆéœ€è¦ç½‘å…³</h2><p>Gatewayç½‘å…³æ˜¯æˆ‘ä»¬æœåŠ¡çš„å®ˆé—¨ç¥ï¼Œæ‰€æœ‰å¾®æœåŠ¡çš„ç»Ÿä¸€å…¥å£ã€‚</p><p>ç½‘å…³çš„<strong>æ ¸å¿ƒåŠŸèƒ½ç‰¹æ€§</strong>ï¼š</p><ul><li>è¯·æ±‚è·¯ç”±</li><li>æƒé™æ§åˆ¶</li><li>é™æµ</li></ul><p>æ¶æ„å›¾ï¼š</p><p><img src="http://cdn.leesin.fun/typora/macpro/img/image-20210714210131152.png" alt="image-20210714210131152"></p><p><strong>æƒé™æ§åˆ¶</strong>ï¼šç½‘å…³ä½œä¸ºå¾®æœåŠ¡å…¥å£ï¼Œéœ€è¦æ ¡éªŒç”¨æˆ·æ˜¯æ˜¯å¦æœ‰è¯·æ±‚èµ„æ ¼ï¼Œå¦‚æœæ²¡æœ‰åˆ™è¿›è¡Œæ‹¦æˆªã€‚</p><p><strong>è·¯ç”±å’Œè´Ÿè½½å‡è¡¡</strong>ï¼šä¸€åˆ‡è¯·æ±‚éƒ½å¿…é¡»å…ˆç»è¿‡ gatewayï¼Œä½†ç½‘å…³ä¸å¤„ç†ä¸šåŠ¡ï¼Œè€Œæ˜¯æ ¹æ®æŸç§è§„åˆ™ï¼ŒæŠŠè¯·æ±‚è½¬å‘åˆ°æŸä¸ªå¾®æœåŠ¡ï¼Œè¿™ä¸ªè¿‡ç¨‹å«åšè·¯ç”±ã€‚å½“ç„¶è·¯ç”±çš„ç›®æ ‡æœåŠ¡æœ‰å¤šä¸ªæ—¶ï¼Œè¿˜éœ€è¦åšè´Ÿè½½å‡è¡¡ã€‚</p><p><strong>é™æµ</strong>ï¼šå½“è¯·æ±‚æµé‡è¿‡é«˜æ—¶ï¼Œåœ¨ç½‘å…³ä¸­æŒ‰ç…§ä¸‹æµçš„å¾®æœåŠ¡èƒ½å¤Ÿæ¥å—çš„é€Ÿåº¦æ¥æ”¾è¡Œè¯·æ±‚ï¼Œé¿å…æœåŠ¡å‹åŠ›è¿‡å¤§ã€‚</p><p>åœ¨ SpringCloud ä¸­ç½‘å…³çš„å®ç°åŒ…æ‹¬ä¸¤ç§ï¼š</p><ul><li>gateway</li><li>zuul</li></ul><p>Zuul æ˜¯åŸºäº Servlet çš„å®ç°ï¼Œå±äºé˜»å¡å¼ç¼–ç¨‹ã€‚è€Œ SpringCloud Gateway åˆ™æ˜¯åŸºäº Spring5 ä¸­æä¾›çš„ WebFluxï¼Œå±äºå“åº”å¼ç¼–ç¨‹çš„å®ç°ï¼Œå…·å¤‡æ›´å¥½çš„æ€§èƒ½ã€‚</p><h2 id="gatewayå¿«é€Ÿå…¥é—¨"><a href="#gatewayå¿«é€Ÿå…¥é—¨" class="headerlink" title="gatewayå¿«é€Ÿå…¥é—¨"></a>gatewayå¿«é€Ÿå…¥é—¨</h2><p>ä¸‹é¢ï¼Œæˆ‘ä»¬å°±æ¼”ç¤ºä¸‹ç½‘å…³çš„åŸºæœ¬è·¯ç”±åŠŸèƒ½ã€‚åŸºæœ¬æ­¥éª¤å¦‚ä¸‹ï¼š</p><ol><li>åˆ›å»ºSpringBootå·¥ç¨‹gatewayï¼Œå¼•å…¥ç½‘å…³ä¾èµ–</li><li>ç¼–å†™å¯åŠ¨ç±»</li><li>ç¼–å†™åŸºç¡€é…ç½®å’Œè·¯ç”±è§„åˆ™</li><li>å¯åŠ¨ç½‘å…³æœåŠ¡è¿›è¡Œæµ‹è¯•</li></ol><h3 id="1ï¼‰åˆ›å»ºgatewayæ¨¡å—ï¼Œå¼•å…¥ä¾èµ–"><a href="#1ï¼‰åˆ›å»ºgatewayæ¨¡å—ï¼Œå¼•å…¥ä¾èµ–" class="headerlink" title="1ï¼‰åˆ›å»ºgatewayæ¨¡å—ï¼Œå¼•å…¥ä¾èµ–"></a>1ï¼‰åˆ›å»ºgatewayæ¨¡å—ï¼Œå¼•å…¥ä¾èµ–</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--ç½‘å…³--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-gateway<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--nacosæœåŠ¡å‘ç°ä¾èµ–--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="2ï¼‰ç¼–å†™å¯åŠ¨ç±»"><a href="#2ï¼‰ç¼–å†™å¯åŠ¨ç±»" class="headerlink" title="2ï¼‰ç¼–å†™å¯åŠ¨ç±»"></a>2ï¼‰ç¼–å†™å¯åŠ¨ç±»</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GatewayApp</span> &#123;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">SpringApplication.run(GatewayApp.class, args);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3ï¼‰ç¼–å†™åŸºç¡€é…ç½®å’Œè·¯ç”±è§„åˆ™"><a href="#3ï¼‰ç¼–å†™åŸºç¡€é…ç½®å’Œè·¯ç”±è§„åˆ™" class="headerlink" title="3ï¼‰ç¼–å†™åŸºç¡€é…ç½®å’Œè·¯ç”±è§„åˆ™"></a>3ï¼‰ç¼–å†™åŸºç¡€é…ç½®å’Œè·¯ç”±è§„åˆ™</h3><p>åˆ›å»ºapplication.ymlæ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">10010</span> <span class="comment"># ç½‘å…³ç«¯å£</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">gateway</span> <span class="comment"># æœåŠ¡åç§°</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">server-addr:</span> <span class="string">localhost:8848</span> <span class="comment"># nacosåœ°å€</span></span><br><span class="line">    <span class="attr">gateway:</span></span><br><span class="line">      <span class="attr">routes:</span> <span class="comment"># ç½‘å…³è·¯ç”±é…ç½®</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">user-service</span> <span class="comment"># è·¯ç”±idï¼Œè‡ªå®šä¹‰ï¼Œåªè¦å”¯ä¸€å³å¯</span></span><br><span class="line">          <span class="comment"># uri: http://127.0.0.1:8081 # è·¯ç”±çš„ç›®æ ‡åœ°å€ httpå°±æ˜¯å›ºå®šåœ°å€</span></span><br><span class="line">          <span class="attr">uri:</span> <span class="string">lb://userservice</span> <span class="comment"># è·¯ç”±çš„ç›®æ ‡åœ°å€ lbå°±æ˜¯è´Ÿè½½å‡è¡¡ï¼Œåé¢è·ŸæœåŠ¡åç§°</span></span><br><span class="line">          <span class="attr">predicates:</span> <span class="comment"># è·¯ç”±æ–­è¨€ï¼Œä¹Ÿå°±æ˜¯åˆ¤æ–­è¯·æ±‚æ˜¯å¦ç¬¦åˆè·¯ç”±è§„åˆ™çš„æ¡ä»¶</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">Path=/user/**</span> <span class="comment"># è¿™ä¸ªæ˜¯æŒ‰ç…§è·¯å¾„åŒ¹é…ï¼Œåªè¦ä»¥/user/å¼€å¤´å°±ç¬¦åˆè¦æ±‚</span></span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å°†ç¬¦åˆ<code>Path</code> è§„åˆ™çš„ä¸€åˆ‡è¯·æ±‚ï¼Œéƒ½ä»£ç†åˆ° <code>uri</code>å‚æ•°æŒ‡å®šçš„åœ°å€ã€‚</p><p>æœ¬ä¾‹ä¸­ï¼Œæˆ‘ä»¬å°† <code>/user/**</code>å¼€å¤´çš„è¯·æ±‚ï¼Œä»£ç†åˆ°<code>lb://userservice</code>ï¼Œlbæ˜¯è´Ÿè½½å‡è¡¡ï¼Œæ ¹æ®æœåŠ¡åæ‹‰å–æœåŠ¡åˆ—è¡¨ï¼Œå®ç°è´Ÿè½½å‡è¡¡ã€‚</p><h3 id="4ï¼‰é‡å¯æµ‹è¯•"><a href="#4ï¼‰é‡å¯æµ‹è¯•" class="headerlink" title="4ï¼‰é‡å¯æµ‹è¯•"></a>4ï¼‰é‡å¯æµ‹è¯•</h3><p>é‡å¯ç½‘å…³ï¼Œè®¿é—® <a href="http://localhost:10010/user/1">http://localhost:10010/user/1</a> æ—¶ï¼Œç¬¦åˆ <code>/user/**</code> è§„åˆ™ï¼Œè¯·æ±‚è½¬å‘åˆ° uriï¼š<a href="http://userservice/user/1">http://userservice/user/1</a></p><h3 id="5ï¼‰ç½‘å…³è·¯ç”±çš„æµç¨‹å›¾"><a href="#5ï¼‰ç½‘å…³è·¯ç”±çš„æµç¨‹å›¾" class="headerlink" title="5ï¼‰ç½‘å…³è·¯ç”±çš„æµç¨‹å›¾"></a>5ï¼‰ç½‘å…³è·¯ç”±çš„æµç¨‹å›¾</h3><p>æ•´ä¸ªè®¿é—®çš„æµç¨‹å¦‚ä¸‹ï¼š</p><p><img src="http://cdn.leesin.fun/typora/macpro/img/image-20210714211742956.png" alt="image-20210714211742956"></p><h2 id="æ–­è¨€å·¥å‚âœ¨"><a href="#æ–­è¨€å·¥å‚âœ¨" class="headerlink" title="æ–­è¨€å·¥å‚âœ¨"></a>æ–­è¨€å·¥å‚âœ¨</h2><p>æˆ‘ä»¬åœ¨é…ç½®æ–‡ä»¶ä¸­å†™çš„æ–­è¨€è§„åˆ™åªæ˜¯å­—ç¬¦ä¸²ï¼Œè¿™äº›å­—ç¬¦ä¸²ä¼šè¢« Predicate Factory è¯»å–å¹¶å¤„ç†ï¼Œè½¬å˜ä¸ºè·¯ç”±åˆ¤æ–­çš„æ¡ä»¶</p><p>ä¾‹å¦‚ Path=/user/** æ˜¯æŒ‰ç…§è·¯å¾„åŒ¹é…ï¼Œè¿™ä¸ªè§„åˆ™æ˜¯ç”±</p><p><code>org.springframework.cloud.gateway.handler.predicate.PathRoutePredicateFactory</code> ç±»æ¥</p><p>å¤„ç†çš„ï¼Œåƒè¿™æ ·çš„æ–­è¨€å·¥å‚åœ¨ SpringCloudGateway è¿˜æœ‰åå‡ ä¸ª:</p><div class="table-container"><table><thead><tr><th><strong>åç§°</strong></th><th><strong>è¯´æ˜</strong></th><th><strong>ç¤ºä¾‹</strong></th></tr></thead><tbody><tr><td>After</td><td>æ˜¯æŸä¸ªæ—¶é—´ç‚¹åçš„è¯·æ±‚</td><td>-  After=2037-01-20T17:42:47.789-07:00[America/Denver]</td></tr><tr><td>Before</td><td>æ˜¯æŸä¸ªæ—¶é—´ç‚¹ä¹‹å‰çš„è¯·æ±‚</td><td>-  Before=2031-04-13T15:14:47.433+08:00[Asia/Shanghai]</td></tr><tr><td>Between</td><td>æ˜¯æŸä¸¤ä¸ªæ—¶é—´ç‚¹ä¹‹å‰çš„è¯·æ±‚</td><td>-  Between=2037-01-20T17:42:47.789-07:00[America/Denver],  2037-01-21T17:42:47.789-07:00[America/Denver]</td></tr><tr><td>Cookie</td><td>è¯·æ±‚å¿…é¡»åŒ…å«æŸäº›cookie</td><td>- Cookie=chocolate, ch.p</td></tr><tr><td>Header</td><td>è¯·æ±‚å¿…é¡»åŒ…å«æŸäº›header</td><td>- Header=X-Request-Id, \d+</td></tr><tr><td>Host</td><td>è¯·æ±‚å¿…é¡»æ˜¯è®¿é—®æŸä¸ªhostï¼ˆåŸŸåï¼‰</td><td>-  Host=<strong>.somehost.org,</strong>.anotherhost.org</td></tr><tr><td>Method</td><td>è¯·æ±‚æ–¹å¼å¿…é¡»æ˜¯æŒ‡å®šæ–¹å¼</td><td>- Method=GET,POST</td></tr><tr><td>Path</td><td>è¯·æ±‚è·¯å¾„å¿…é¡»ç¬¦åˆæŒ‡å®šè§„åˆ™</td><td>- Path=/red/{segment},/blue/**</td></tr><tr><td>Query</td><td>è¯·æ±‚å‚æ•°å¿…é¡»åŒ…å«æŒ‡å®šå‚æ•°</td><td>- Query=name, Jackæˆ–è€…-  Query=name</td></tr><tr><td>RemoteAddr</td><td>è¯·æ±‚è€…çš„ipå¿…é¡»æ˜¯æŒ‡å®šèŒƒå›´</td><td>- RemoteAddr=192.168.1.1/24</td></tr><tr><td>Weight</td><td>æƒé‡å¤„ç†</td></tr></tbody></table></div><blockquote><p>æˆ‘ä»¬åªéœ€è¦æŒæ¡Pathè¿™ç§è·¯ç”±å·¥ç¨‹å°±å¯ä»¥äº†ã€‚</p></blockquote><h2 id="è¿‡æ»¤å™¨å·¥å‚âœ¨"><a href="#è¿‡æ»¤å™¨å·¥å‚âœ¨" class="headerlink" title="è¿‡æ»¤å™¨å·¥å‚âœ¨"></a>è¿‡æ»¤å™¨å·¥å‚âœ¨</h2><p>GatewayFilter æ˜¯ç½‘å…³ä¸­æä¾›çš„ä¸€ç§è¿‡æ»¤å™¨ï¼Œå¯ä»¥å¯¹è¿›å…¥ç½‘å…³çš„ <strong>è¯·æ±‚</strong> å’Œå¾®æœåŠ¡è¿”å›çš„ <strong>å“åº”</strong> åšå¤„ç†ï¼š</p><p><img src="http://cdn.leesin.fun/typora/macpro/img/image-20210714212312871.png" alt="image-20210714212312871"></p><h3 id="è·¯ç”±è¿‡æ»¤å™¨çš„ç§ç±»"><a href="#è·¯ç”±è¿‡æ»¤å™¨çš„ç§ç±»" class="headerlink" title="è·¯ç”±è¿‡æ»¤å™¨çš„ç§ç±»"></a>è·¯ç”±è¿‡æ»¤å™¨çš„ç§ç±»</h3><p>Spring æä¾›äº† 31 ç§ä¸åŒçš„è·¯ç”±è¿‡æ»¤å™¨å·¥å‚ã€‚ä¾‹å¦‚ï¼š</p><div class="table-container"><table><thead><tr><th><strong>åç§°</strong></th><th><strong>è¯´æ˜</strong></th></tr></thead><tbody><tr><td>AddRequestHeader</td><td>ç»™å½“å‰è¯·æ±‚æ·»åŠ ä¸€ä¸ªè¯·æ±‚å¤´</td></tr><tr><td>RemoveRequestHeader</td><td>ç§»é™¤è¯·æ±‚ä¸­çš„ä¸€ä¸ªè¯·æ±‚å¤´</td></tr><tr><td>AddResponseHeader</td><td>ç»™å“åº”ç»“æœä¸­æ·»åŠ ä¸€ä¸ªå“åº”å¤´</td></tr><tr><td>RemoveResponseHeader</td><td>ä»å“åº”ç»“æœä¸­ç§»é™¤æœ‰ä¸€ä¸ªå“åº”å¤´</td></tr><tr><td>RequestRateLimiter</td><td>é™åˆ¶è¯·æ±‚çš„æµé‡</td></tr></tbody></table></div><h3 id="è¯·æ±‚å¤´è¿‡æ»¤å™¨"><a href="#è¯·æ±‚å¤´è¿‡æ»¤å™¨" class="headerlink" title="è¯·æ±‚å¤´è¿‡æ»¤å™¨"></a>è¯·æ±‚å¤´è¿‡æ»¤å™¨</h3><p>ä¸‹é¢æˆ‘ä»¬ä»¥ AddRequestHeader ä¸ºä¾‹æ¥è®²è§£ã€‚</p><blockquote><p><strong>éœ€æ±‚</strong>ï¼šç»™æ‰€æœ‰è¿›å…¥ user-service çš„è¯·æ±‚æ·»åŠ ä¸€ä¸ªè¯·æ±‚å¤´ï¼šsource=Fox-Api</p></blockquote><p>åªéœ€è¦ä¿®æ”¹ gateway æœåŠ¡çš„ application.yml æ–‡ä»¶ï¼Œæ·»åŠ è·¯ç”±è¿‡æ»¤å³å¯ï¼š(åªæœ‰æœ€åº•ä¸‹ä¸¤è¡Œæ˜¯æ–°åŠ çš„)</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">10010</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">gateway</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">server-addr:</span> <span class="string">localhost:8848</span></span><br><span class="line">    <span class="attr">gateway:</span></span><br><span class="line">      <span class="attr">routes:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">user-service</span> <span class="comment"># è·¯ç”±idï¼Œè‡ªå®šä¹‰ï¼Œåªè¦å”¯ä¸€å³å¯</span></span><br><span class="line">          <span class="attr">uri:</span> <span class="string">lb://user-service</span> <span class="comment"># è·¯ç”±çš„ç›®æ ‡åœ°å€ lbå°±æ˜¯è´Ÿè½½å‡è¡¡ï¼Œåé¢è·ŸæœåŠ¡åç§°</span></span><br><span class="line">          <span class="attr">predicates:</span> <span class="comment"># è·¯ç”±æ–­è¨€ï¼Œä¹Ÿå°±æ˜¯åˆ¤æ–­è¯·æ±‚æ˜¯å¦ç¬¦åˆè·¯ç”±è§„åˆ™çš„æ¡ä»¶</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">Path=/user/**</span> <span class="comment"># è¿™ä¸ªæ˜¯æŒ‰ç…§è·¯å¾„åŒ¹é…ï¼Œåªè¦ä»¥/user/å¼€å¤´å°±ç¬¦åˆè¦æ±‚</span></span><br><span class="line">          <span class="attr">filters:</span> <span class="comment"># è¿‡æ»¤å™¨</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">AddRequestHeader=source,</span> <span class="string">Fox-Api</span> <span class="comment"># æ·»åŠ è¯·æ±‚å¤´</span></span><br></pre></td></tr></table></figure><p>å½“å‰è¿‡æ»¤å™¨å†™åœ¨ user-service è·¯ç”±ä¸‹ï¼Œå› æ­¤ä»…ä»…å¯¹è®¿é—® user-service çš„è¯·æ±‚æœ‰æ•ˆã€‚</p><p>ç¼–å†™æµ‹è¯•æ¥å£ï¼Œå¹¶æµ‹è¯•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;&#123;userId&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> User <span class="title function_">queryUserById</span><span class="params">(<span class="meta">@PathVariable(&quot;userId&quot;)</span> Long userId, </span></span><br><span class="line"><span class="params">                          <span class="meta">@RequestHeader(value = &quot;source&quot;, required = false)</span> String source)</span> &#123;</span><br><span class="line">  System.out.println(source);</span><br><span class="line">  <span class="keyword">return</span> userService.queryById(userId);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="é»˜è®¤è¿‡æ»¤å™¨"><a href="#é»˜è®¤è¿‡æ»¤å™¨" class="headerlink" title="é»˜è®¤è¿‡æ»¤å™¨"></a>é»˜è®¤è¿‡æ»¤å™¨</h3><p>å¦‚æœè¦å¯¹æ‰€æœ‰çš„è·¯ç”±éƒ½ç”Ÿæ•ˆï¼Œåˆ™å¯ä»¥å°†è¿‡æ»¤å™¨å·¥å‚å†™åˆ° default ä¸‹ã€‚æ ¼å¼å¦‚ä¸‹ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">gateway:</span></span><br><span class="line">      <span class="attr">routes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">user-service</span> </span><br><span class="line">        <span class="attr">uri:</span> <span class="string">lb://userservice</span> </span><br><span class="line">        <span class="attr">predicates:</span> </span><br><span class="line">        <span class="bullet">-</span> <span class="string">Path=/user/**</span></span><br><span class="line">      <span class="attr">default-filters:</span> <span class="comment"># é»˜è®¤è¿‡æ»¤é¡¹</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">AddRequestHeader=source,</span> <span class="string">Fox-Api</span> <span class="comment"># æ·»åŠ è¯·æ±‚å¤´</span></span><br></pre></td></tr></table></figure><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>è¿‡æ»¤å™¨çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ</p><p>â‘  å¯¹è·¯ç”±çš„è¯·æ±‚æˆ–å“åº”åšåŠ å·¥å¤„ç†ï¼Œæ¯”å¦‚æ·»åŠ è¯·æ±‚å¤´</p><p>â‘¡ é…ç½®åœ¨è·¯ç”±ä¸‹çš„è¿‡æ»¤å™¨åªå¯¹å½“å‰è·¯ç”±çš„è¯·æ±‚ç”Ÿæ•ˆ</p><p>defaultFilters çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ</p><p>â‘  å¯¹æ‰€æœ‰è·¯ç”±éƒ½ç”Ÿæ•ˆçš„è¿‡æ»¤å™¨</p><blockquote><p>AddRequestHeader çš„å·¥å‚æ˜¯ AddRequestHeaderGatewayFilterFactorï¼Œ ä»–æ˜¯ä¸€ä¸ª GatewayFilter ç±»å‹</p></blockquote><h2 id="å…¨å±€è¿‡æ»¤å™¨âœ¨"><a href="#å…¨å±€è¿‡æ»¤å™¨âœ¨" class="headerlink" title="å…¨å±€è¿‡æ»¤å™¨âœ¨"></a>å…¨å±€è¿‡æ»¤å™¨âœ¨</h2><p>ä¸Šä¸€èŠ‚å­¦ä¹ çš„è¿‡æ»¤å™¨ï¼Œç½‘å…³æä¾›äº†31ç§ï¼Œä½†æ¯ä¸€ç§è¿‡æ»¤å™¨çš„ä½œç”¨éƒ½æ˜¯å›ºå®šçš„ã€‚å¦‚æœæˆ‘ä»¬å¸Œæœ›æ‹¦æˆªè¯·æ±‚ï¼Œåšè‡ªå·±çš„ä¸šåŠ¡é€»è¾‘åˆ™æ²¡åŠæ³•å®ç°ã€‚</p><h3 id="å…¨å±€è¿‡æ»¤å™¨ä½œç”¨"><a href="#å…¨å±€è¿‡æ»¤å™¨ä½œç”¨" class="headerlink" title="å…¨å±€è¿‡æ»¤å™¨ä½œç”¨"></a>å…¨å±€è¿‡æ»¤å™¨ä½œç”¨</h3><p>å…¨å±€è¿‡æ»¤å™¨çš„ä½œç”¨ä¹Ÿæ˜¯å¤„ç†ä¸€åˆ‡è¿›å…¥ç½‘å…³çš„è¯·æ±‚å’Œå¾®æœåŠ¡å“åº”ï¼Œä¸ GatewayFilter çš„ä½œç”¨ä¸€æ ·ã€‚åŒºåˆ«åœ¨äº GatewayFilter é€šè¿‡é…ç½®å®šä¹‰ï¼Œå¤„ç†é€»è¾‘æ˜¯å›ºå®šçš„ï¼›è€Œ GlobalFilter çš„é€»è¾‘éœ€è¦è‡ªå·±å†™ä»£ç å®ç°ã€‚</p><p>å®šä¹‰æ–¹å¼æ˜¯å®ç° GlobalFilter æ¥å£ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">GlobalFilter</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *  å¤„ç†å½“å‰è¯·æ±‚ï¼Œæœ‰å¿…è¦çš„è¯é€šè¿‡&#123;<span class="doctag">@link</span> GatewayFilterChain&#125;å°†è¯·æ±‚äº¤ç»™ä¸‹ä¸€ä¸ªè¿‡æ»¤å™¨å¤„ç†</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> exchange è¯·æ±‚ä¸Šä¸‹æ–‡ï¼Œé‡Œé¢å¯ä»¥è·å–Requestã€Responseç­‰ä¿¡æ¯</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> chain ç”¨æ¥æŠŠè¯·æ±‚å§”æ‰˜ç»™ä¸‹ä¸€ä¸ªè¿‡æ»¤å™¨ </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> &#123;<span class="doctag">@code</span> Mono&lt;Void&gt;&#125; è¿”å›æ ‡ç¤ºå½“å‰è¿‡æ»¤å™¨ä¸šåŠ¡ç»“æŸ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    Mono&lt;Void&gt; <span class="title function_">filter</span><span class="params">(ServerWebExchange exchange, GatewayFilterChain chain)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ filter ä¸­ç¼–å†™è‡ªå®šä¹‰é€»è¾‘ï¼Œå¯ä»¥å®ç°ä¸‹åˆ—åŠŸèƒ½ï¼šâœ¨</p><ul><li>ç™»å½•çŠ¶æ€åˆ¤æ–­</li><li>æƒé™æ ¡éªŒ</li><li>è¯·æ±‚é™æµç­‰</li></ul><h3 id="è‡ªå®šä¹‰å…¨å±€è¿‡æ»¤å™¨"><a href="#è‡ªå®šä¹‰å…¨å±€è¿‡æ»¤å™¨" class="headerlink" title="è‡ªå®šä¹‰å…¨å±€è¿‡æ»¤å™¨"></a>è‡ªå®šä¹‰å…¨å±€è¿‡æ»¤å™¨</h3><p>éœ€æ±‚ï¼šå®šä¹‰å…¨å±€è¿‡æ»¤å™¨ï¼Œæ‹¦æˆªè¯·æ±‚ï¼Œåˆ¤æ–­è¯·æ±‚çš„å‚æ•°æ˜¯å¦æ»¡è¶³ä¸‹é¢æ¡ä»¶ï¼š</p><ul><li><p>å‚æ•°ä¸­æ˜¯å¦æœ‰ authorizationï¼Œ</p></li><li><p>authorization å‚æ•°å€¼æ˜¯å¦ä¸º admin</p></li></ul><p>å¦‚æœåŒæ—¶æ»¡è¶³åˆ™æ”¾è¡Œï¼Œå¦åˆ™æ‹¦æˆª</p><p>å®ç°ï¼š</p><p>åœ¨ gateway ä¸­å®šä¹‰ä¸€ä¸ªè¿‡æ»¤å™¨ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Order(-1)</span> <span class="comment">// å€¼è¶Šå°ï¼Œä¼˜å…ˆçº§è¶Šé«˜</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AuthorizeFilter</span> <span class="keyword">implements</span> <span class="title class_">GlobalFilter</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Mono&lt;Void&gt; <span class="title function_">filter</span><span class="params">(ServerWebExchange exchange, GatewayFilterChain chain)</span> &#123;</span><br><span class="line">        <span class="type">HttpHeaders</span> <span class="variable">headers</span> <span class="operator">=</span> exchange.getRequest().getHeaders();</span><br><span class="line">        <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> headers.getFirst(<span class="string">&quot;authorization&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (<span class="string">&quot;admin&quot;</span>.equals(token)) &#123;</span><br><span class="line">            <span class="comment">// æ”¾è¡Œ</span></span><br><span class="line">            <span class="keyword">return</span> chain.filter(exchange);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// æ‹¦æˆª</span></span><br><span class="line">        exchange.getResponse().setStatusCode(HttpStatus.FORBIDDEN);</span><br><span class="line">        <span class="keyword">return</span> exchange.getResponse().setComplete();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é‡å¯æµ‹è¯•ã€‚</p><h2 id="è¿‡æ»¤å™¨æ‰§è¡Œé¡ºåº"><a href="#è¿‡æ»¤å™¨æ‰§è¡Œé¡ºåº" class="headerlink" title="è¿‡æ»¤å™¨æ‰§è¡Œé¡ºåº"></a>è¿‡æ»¤å™¨æ‰§è¡Œé¡ºåº</h2><p>è¯·æ±‚è¿›å…¥ç½‘å…³ä¼šç¢°åˆ°ä¸‰ç±»è¿‡æ»¤å™¨ï¼šå½“å‰è·¯ç”±çš„è¿‡æ»¤å™¨ã€DefaultFilterã€GlobalFilter</p><p>è¯·æ±‚è·¯ç”±åï¼Œä¼šå°†å½“å‰è·¯ç”±è¿‡æ»¤å™¨å’Œ DefaultFilterã€GlobalFilterï¼Œåˆå¹¶åˆ°ä¸€ä¸ªè¿‡æ»¤å™¨é“¾ï¼ˆé›†åˆï¼‰ä¸­ï¼Œæ’åºåä¾æ¬¡æ‰§è¡Œæ¯ä¸ªè¿‡æ»¤å™¨ï¼š</p><p><img src="http://cdn.leesin.fun/typora/macpro/img/image-20210714214228409.png" alt="image-20210714214228409"></p><p>æ’åºçš„è§„åˆ™æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p><ul><li>æ¯ä¸€ä¸ªè¿‡æ»¤å™¨éƒ½å¿…é¡»æŒ‡å®šä¸€ä¸ª int ç±»å‹çš„ order å€¼ï¼Œ<strong>order å€¼è¶Šå°ï¼Œä¼˜å…ˆçº§è¶Šé«˜ï¼Œæ‰§è¡Œé¡ºåºè¶Šé å‰</strong>ã€‚</li><li>GlobalFilter é€šè¿‡å®ç° Ordered æ¥å£ï¼Œæˆ–è€…æ·»åŠ  @Order æ³¨è§£æ¥æŒ‡å®š order å€¼ï¼Œç”±æˆ‘ä»¬è‡ªå·±æŒ‡å®š</li><li>è·¯ç”±è¿‡æ»¤å™¨å’Œ defaultFilter çš„ order ç”± Spring æŒ‡å®šï¼Œé»˜è®¤æ˜¯æŒ‰ç…§å£°æ˜é¡ºåºä» 1 é€’å¢ã€‚</li><li>å½“è¿‡æ»¤å™¨çš„ order å€¼ä¸€æ ·æ—¶ï¼Œä¼šæŒ‰ç…§ defaultFilter &gt; è·¯ç”±è¿‡æ»¤å™¨ &gt; GlobalFilter çš„é¡ºåºæ‰§è¡Œã€‚</li></ul><p>è¯¦ç»†å†…å®¹ï¼Œå¯ä»¥æŸ¥çœ‹æºç ï¼š</p><p><code>org.springframework.cloud.gateway.route.RouteDefinitionRouteLocator#getFilters()</code> æ–¹æ³•æ˜¯å…ˆåŠ è½½ defaultFiltersï¼Œç„¶åå†åŠ è½½æŸä¸ª routeçš„filtersï¼Œç„¶ååˆå¹¶ã€‚</p><p><code>org.springframework.cloud.gateway.handler.FilteringWebHandler#handle()</code> æ–¹æ³•ä¼šåŠ è½½å…¨å±€è¿‡æ»¤å™¨ï¼Œä¸å‰é¢çš„è¿‡æ»¤å™¨åˆå¹¶åæ ¹æ® order æ’åºï¼Œç»„ç»‡è¿‡æ»¤å™¨é“¾</p><h3 id="é€‚é…å™¨æ¨¡å¼âœ¨âœ¨âœ¨"><a href="#é€‚é…å™¨æ¨¡å¼âœ¨âœ¨âœ¨" class="headerlink" title="é€‚é…å™¨æ¨¡å¼âœ¨âœ¨âœ¨"></a>é€‚é…å™¨æ¨¡å¼âœ¨âœ¨âœ¨</h3><p>è·¯ç”±è¿‡æ»¤å™¨å’Œé»˜è®¤è¿‡æ»¤å™¨æ˜¯ GateWay æä¾›ç»™æˆ‘ä»¬ä½¿ç”¨çš„ï¼Œä»–çš„ç±»å‹æ˜¯ <code>org.springframework.cloud.gateway.filter.GatewayFilter</code> </p><p>å…¨å±€è¿‡æ»¤å™¨æ˜¯æˆ‘ä»¬è‡ªå·±å®šä¹‰çš„ï¼Œç±»å‹æ˜¯ <code>org.springframework.cloud.gateway.filter.GlobalFilter</code></p><p><code>org.springframework.cloud.gateway.handler.FilteringWebHandler</code>  é‡Œé¢æœ‰ä¸ªå†…éƒ¨é™æ€ç±» GatewayFilterAdapter å®ç°äº† GatewayFilterï¼Œ ç„¶åæœ‰ä¸ªå±æ€§æ˜¯ GlobalFilter ç±»å‹çš„ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">GatewayFilterAdapter</span> <span class="keyword">implements</span> <span class="title class_">GatewayFilter</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> GlobalFilter delegate;</span><br><span class="line"></span><br><span class="line">  GatewayFilterAdapter(GlobalFilter delegate) &#123;</span><br><span class="line">    <span class="built_in">this</span>.delegate = delegate;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> Mono&lt;Void&gt; <span class="title function_">filter</span><span class="params">(ServerWebExchange exchange, GatewayFilterChain chain)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.delegate.filter(exchange, chain);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç›¸å½“äºæ˜¯å°† GlobalFilter é€‚é…ä¸ºäº† GatewayFilter ç±»å‹</p><h2 id="é™æµè¿‡æ»¤å™¨"><a href="#é™æµè¿‡æ»¤å™¨" class="headerlink" title="é™æµè¿‡æ»¤å™¨"></a>é™æµè¿‡æ»¤å™¨</h2><p><strong>é™æµ</strong>ï¼šå¯¹åº”ç”¨æœåŠ¡å™¨çš„è¯·æ±‚åšé™åˆ¶ï¼Œé¿å…å› è¿‡å¤šè¯·æ±‚è€Œå¯¼è‡´æœåŠ¡å™¨è¿‡è½½ç”šè‡³å®•æœºã€‚é™æµç®—æ³•å¸¸è§çš„åŒ…æ‹¬ä¸¤ç§ï¼š</p><ul><li>è®¡æ•°å™¨ç®—æ³•ï¼ŒåˆåŒ…æ‹¬çª—å£è®¡æ•°å™¨ç®—æ³•ã€æ»‘åŠ¨çª—å£è®¡æ•°å™¨ç®—æ³•</li><li>æ¼æ¡¶ç®—æ³•(Leaky Bucket)</li><li>ä»¤ç‰Œæ¡¶ç®—æ³•ï¼ˆToken Bucketï¼‰</li></ul><h2 id="è·¨åŸŸé—®é¢˜"><a href="#è·¨åŸŸé—®é¢˜" class="headerlink" title="è·¨åŸŸé—®é¢˜"></a>è·¨åŸŸé—®é¢˜</h2><h3 id="ä»€ä¹ˆæ˜¯è·¨åŸŸé—®é¢˜"><a href="#ä»€ä¹ˆæ˜¯è·¨åŸŸé—®é¢˜" class="headerlink" title="ä»€ä¹ˆæ˜¯è·¨åŸŸé—®é¢˜"></a>ä»€ä¹ˆæ˜¯è·¨åŸŸé—®é¢˜</h3><p>è·¨åŸŸï¼šåŸŸåä¸ä¸€è‡´å°±æ˜¯è·¨åŸŸï¼Œä¸»è¦åŒ…æ‹¬ï¼š</p><ul><li><p>åŸŸåä¸åŒï¼š www.taobao.com å’Œ  www.taobao.org å’Œ www.jd.com å’Œ miaosha.jd.com</p></li><li><p>åŸŸåç›¸åŒï¼Œç«¯å£ä¸åŒï¼šlocalhost:8080 å’Œl ocalhost8081</p></li></ul><p>è·¨åŸŸé—®é¢˜ï¼šæµè§ˆå™¨ç¦æ­¢è¯·æ±‚çš„å‘èµ·è€…ä¸æœåŠ¡ç«¯å‘ç”Ÿè·¨åŸŸ ajax è¯·æ±‚ï¼Œè¯·æ±‚è¢«æµè§ˆå™¨æ‹¦æˆªçš„é—®é¢˜</p><p>è§£å†³æ–¹æ¡ˆï¼šCORSï¼Œè¿™ä¸ªä»¥å‰åº”è¯¥å­¦ä¹ è¿‡ï¼Œè¿™é‡Œä¸å†èµ˜è¿°äº†ã€‚ä¸çŸ¥é“çš„å°ä¼™ä¼´å¯ä»¥æŸ¥çœ‹<a href="https://www.ruanyifeng.com/blog/2016/04/cors.html">https://www.ruanyifeng.com/blog/2016/04/cors.html</a></p><h3 id="è§£å†³è·¨åŸŸé—®é¢˜"><a href="#è§£å†³è·¨åŸŸé—®é¢˜" class="headerlink" title="è§£å†³è·¨åŸŸé—®é¢˜"></a>è§£å†³è·¨åŸŸé—®é¢˜</h3><p>åœ¨ gateway æœåŠ¡çš„ application.yml æ–‡ä»¶ä¸­ï¼Œæ·»åŠ ä¸‹é¢çš„é…ç½®ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">gateway:</span></span><br><span class="line">      <span class="comment"># ã€‚ã€‚ã€‚</span></span><br><span class="line">      <span class="attr">globalcors:</span> <span class="comment"># å…¨å±€çš„è·¨åŸŸå¤„ç†</span></span><br><span class="line">        <span class="attr">add-to-simple-url-handler-mapping:</span> <span class="literal">true</span> <span class="comment"># è§£å†³optionsè¯·æ±‚è¢«æ‹¦æˆªé—®é¢˜</span></span><br><span class="line">        <span class="attr">corsConfigurations:</span></span><br><span class="line">          <span class="string">&#x27;[/**]&#x27;</span><span class="string">:</span></span><br><span class="line">            <span class="attr">allowedOrigins:</span> <span class="comment"># å…è®¸å“ªäº›ç½‘ç«™çš„è·¨åŸŸè¯·æ±‚ </span></span><br><span class="line">              <span class="bullet">-</span> <span class="string">&quot;http://localhost:8090&quot;</span></span><br><span class="line">            <span class="attr">allowedMethods:</span> <span class="comment"># å…è®¸çš„è·¨åŸŸajaxçš„è¯·æ±‚æ–¹å¼</span></span><br><span class="line">              <span class="bullet">-</span> <span class="string">&quot;GET&quot;</span></span><br><span class="line">              <span class="bullet">-</span> <span class="string">&quot;POST&quot;</span></span><br><span class="line">              <span class="bullet">-</span> <span class="string">&quot;DELETE&quot;</span></span><br><span class="line">              <span class="bullet">-</span> <span class="string">&quot;PUT&quot;</span></span><br><span class="line">              <span class="bullet">-</span> <span class="string">&quot;OPTIONS&quot;</span></span><br><span class="line">            <span class="attr">allowedHeaders:</span> <span class="string">&quot;*&quot;</span> <span class="comment"># å…è®¸åœ¨è¯·æ±‚ä¸­æºå¸¦çš„å¤´ä¿¡æ¯</span></span><br><span class="line">            <span class="attr">allowCredentials:</span> <span class="literal">true</span> <span class="comment"># æ˜¯å¦å…è®¸æºå¸¦cookie</span></span><br><span class="line">            <span class="attr">maxAge:</span> <span class="number">360000</span> <span class="comment"># è¿™æ¬¡è·¨åŸŸæ£€æµ‹çš„æœ‰æ•ˆæœŸ</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> åç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> clound </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>RabbitMQåŸºç¡€çŸ¥è¯†</title>
      <link href="/post/40.html"/>
      <url>/post/40.html</url>
      
        <content type="html"><![CDATA[<h1 id="åˆè¯†MQ"><a href="#åˆè¯†MQ" class="headerlink" title="åˆè¯†MQ"></a>åˆè¯†MQ</h1><h2 id="åŒæ­¥å’Œå¼‚æ­¥é€šè®¯"><a href="#åŒæ­¥å’Œå¼‚æ­¥é€šè®¯" class="headerlink" title="åŒæ­¥å’Œå¼‚æ­¥é€šè®¯"></a>åŒæ­¥å’Œå¼‚æ­¥é€šè®¯</h2><p>å¾®æœåŠ¡é—´é€šè®¯æœ‰åŒæ­¥å’Œå¼‚æ­¥ä¸¤ç§æ–¹å¼ï¼š</p><p>åŒæ­¥é€šè®¯ï¼šå°±åƒæ‰“ç”µè¯ï¼Œéœ€è¦å®æ—¶å“åº”ã€‚</p><p>å¼‚æ­¥é€šè®¯ï¼šå°±åƒå‘é‚®ä»¶ï¼Œä¸éœ€è¦é©¬ä¸Šå›å¤ã€‚</p><p>ä¸¤ç§æ–¹å¼å„æœ‰ä¼˜åŠ£ï¼Œæ‰“ç”µè¯å¯ä»¥ç«‹å³å¾—åˆ°å“åº”ï¼Œä½†æ˜¯ä½ å´ä¸èƒ½è·Ÿå¤šä¸ªäººåŒæ—¶é€šè¯ã€‚å‘é€é‚®ä»¶å¯ä»¥åŒæ—¶ä¸å¤šä¸ªäººæ”¶å‘é‚®ä»¶ï¼Œä½†æ˜¯å¾€å¾€å“åº”ä¼šæœ‰å»¶è¿Ÿã€‚</p><h3 id="åŒæ­¥é€šè®¯"><a href="#åŒæ­¥é€šè®¯" class="headerlink" title="åŒæ­¥é€šè®¯"></a>åŒæ­¥é€šè®¯</h3><p>æˆ‘ä»¬ä¹‹å‰å­¦ä¹ çš„ Feign è°ƒç”¨å°±å±äºåŒæ­¥æ–¹å¼ï¼Œè™½ç„¶è°ƒç”¨å¯ä»¥å®æ—¶å¾—åˆ°ç»“æœï¼Œä½†å­˜åœ¨ä¸‹é¢çš„é—®é¢˜ï¼š</p><p><img src="http://cdn.leesin.fun/typora/macpro/img/image-20210717162004285.png" alt="image-20210717162004285"></p><p>æ€»ç»“ï¼š</p><p>åŒæ­¥è°ƒç”¨çš„ä¼˜ç‚¹ï¼š</p><ul><li>æ—¶æ•ˆæ€§è¾ƒå¼ºï¼Œå¯ä»¥ç«‹å³å¾—åˆ°ç»“æœ</li></ul><p>åŒæ­¥è°ƒç”¨çš„é—®é¢˜ï¼š</p><ul><li>è€¦åˆåº¦é«˜</li><li>æ€§èƒ½å’Œååèƒ½åŠ›ä¸‹é™</li><li>æœ‰é¢å¤–çš„èµ„æºæ¶ˆè€—</li><li>æœ‰çº§è”å¤±è´¥é—®é¢˜</li></ul><h3 id="å¼‚æ­¥é€šè®¯"><a href="#å¼‚æ­¥é€šè®¯" class="headerlink" title="å¼‚æ­¥é€šè®¯"></a>å¼‚æ­¥é€šè®¯</h3><p>å¼‚æ­¥è°ƒç”¨åˆ™å¯ä»¥é¿å…ä¸Šè¿°é—®é¢˜ï¼š</p><p>æˆ‘ä»¬ä»¥è´­ä¹°å•†å“ä¸ºä¾‹ï¼Œç”¨æˆ·æ”¯ä»˜åéœ€è¦è°ƒç”¨è®¢å•æœåŠ¡å®Œæˆè®¢å•çŠ¶æ€ä¿®æ”¹ï¼Œè°ƒç”¨ç‰©æµæœåŠ¡ï¼Œä»ä»“åº“åˆ†é…å“åº”çš„åº“å­˜å¹¶å‡†å¤‡å‘è´§ã€‚</p><p>åœ¨äº‹ä»¶æ¨¡å¼ä¸­ï¼Œæ”¯ä»˜æœåŠ¡æ˜¯äº‹ä»¶å‘å¸ƒè€…ï¼ˆpublisherï¼‰ï¼Œåœ¨æ”¯ä»˜å®Œæˆååªéœ€è¦å‘å¸ƒä¸€ä¸ªæ”¯ä»˜æˆåŠŸçš„äº‹ä»¶ï¼ˆeventï¼‰ï¼Œäº‹ä»¶ä¸­å¸¦ä¸Šè®¢å•idã€‚</p><p>è®¢å•æœåŠ¡å’Œç‰©æµæœåŠ¡æ˜¯äº‹ä»¶è®¢é˜…è€…ï¼ˆConsumerï¼‰ï¼Œè®¢é˜…æ”¯ä»˜æˆåŠŸçš„äº‹ä»¶ï¼Œç›‘å¬åˆ°äº‹ä»¶åå®Œæˆè‡ªå·±ä¸šåŠ¡å³å¯ã€‚</p><p>ä¸ºäº†è§£é™¤äº‹ä»¶å‘å¸ƒè€…ä¸è®¢é˜…è€…ä¹‹é—´çš„è€¦åˆï¼Œä¸¤è€…å¹¶ä¸æ˜¯ç›´æ¥é€šä¿¡ï¼Œè€Œæ˜¯æœ‰ä¸€ä¸ªä¸­é—´äººï¼ˆBrokerï¼‰ã€‚å‘å¸ƒè€…å‘å¸ƒäº‹ä»¶åˆ° Brokerï¼Œä¸å…³å¿ƒè°æ¥è®¢é˜…äº‹ä»¶ã€‚è®¢é˜…è€…ä» Broker è®¢é˜…äº‹ä»¶ï¼Œä¸å…³å¿ƒè°å‘æ¥çš„æ¶ˆæ¯ã€‚</p><p><img src="http://cdn.leesin.fun/typora/macpro/img/image-20210422095356088.png" alt="image-20210422095356088"></p><p>Broker æ˜¯ä¸€ä¸ªåƒæ•°æ®æ€»çº¿ä¸€æ ·çš„ä¸œè¥¿ï¼Œæ‰€æœ‰çš„æœåŠ¡è¦æ¥æ”¶æ•°æ®å’Œå‘é€æ•°æ®éƒ½å‘åˆ°è¿™ä¸ªæ€»çº¿ä¸Šï¼Œè¿™ä¸ªæ€»çº¿å°±åƒåè®®ä¸€æ ·ï¼Œè®©æœåŠ¡é—´çš„é€šè®¯å˜å¾—æ ‡å‡†å’Œå¯æ§ã€‚</p><p>å¥½å¤„ï¼š</p><ul><li><p>ååé‡æå‡ï¼šæ— éœ€ç­‰å¾…è®¢é˜…è€…å¤„ç†å®Œæˆï¼Œå“åº”æ›´å¿«é€Ÿ</p></li><li><p>æ•…éšœéš”ç¦»ï¼šæœåŠ¡æ²¡æœ‰ç›´æ¥è°ƒç”¨ï¼Œä¸å­˜åœ¨çº§è”å¤±è´¥é—®é¢˜</p></li><li>è°ƒç”¨é—´æ²¡æœ‰é˜»å¡ï¼Œä¸ä¼šé€ æˆæ— æ•ˆçš„èµ„æºå ç”¨</li><li>è€¦åˆåº¦æä½ï¼Œæ¯ä¸ªæœåŠ¡éƒ½å¯ä»¥çµæ´»æ’æ‹”ï¼Œå¯æ›¿æ¢</li><li>æµé‡å‰Šå³°ï¼šä¸ç®¡å‘å¸ƒäº‹ä»¶çš„æµé‡æ³¢åŠ¨å¤šå¤§ï¼Œéƒ½ç”± Broker æ¥æ”¶ï¼Œè®¢é˜…è€…å¯ä»¥æŒ‰ç…§è‡ªå·±çš„é€Ÿåº¦å»å¤„ç†äº‹ä»¶</li></ul><p>ç¼ºç‚¹ï¼š</p><ul><li>æ¶æ„å¤æ‚äº†ï¼Œä¸šåŠ¡æ²¡æœ‰æ˜æ˜¾çš„æµç¨‹çº¿ï¼Œä¸å¥½ç®¡ç†</li><li>éœ€è¦ä¾èµ–äº Broker çš„å¯é ã€å®‰å…¨ã€æ€§èƒ½</li></ul><p>å¥½åœ¨ç°åœ¨å¼€æºè½¯ä»¶æˆ–äº‘å¹³å°ä¸Š Broker çš„è½¯ä»¶æ˜¯éå¸¸æˆç†Ÿçš„ï¼Œæ¯”è¾ƒå¸¸è§çš„ä¸€ç§å°±æ˜¯æˆ‘ä»¬ä»Šå¤©è¦å­¦ä¹ çš„MQæŠ€æœ¯ã€‚</p><h2 id="æŠ€æœ¯å¯¹æ¯”"><a href="#æŠ€æœ¯å¯¹æ¯”" class="headerlink" title="æŠ€æœ¯å¯¹æ¯”"></a>æŠ€æœ¯å¯¹æ¯”</h2><p>MQï¼Œä¸­æ–‡æ˜¯æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆMessageQueueï¼‰ï¼Œå­—é¢æ¥çœ‹å°±æ˜¯å­˜æ”¾æ¶ˆæ¯çš„é˜Ÿåˆ—ã€‚ä¹Ÿå°±æ˜¯äº‹ä»¶é©±åŠ¨æ¶æ„ä¸­çš„ Brokerã€‚</p><p>å‡ ç§å¸¸è§ MQ çš„å¯¹æ¯”ï¼š</p><div class="table-container"><table><thead><tr><th></th><th><strong>RabbitMQ</strong></th><th><strong>ActiveMQ</strong></th><th><strong>RocketMQ</strong></th><th><strong>Kafka</strong></th></tr></thead><tbody><tr><td>å…¬å¸/ç¤¾åŒº</td><td>Rabbit</td><td>Apache</td><td>é˜¿é‡Œ</td><td>Apache</td></tr><tr><td>å¼€å‘è¯­è¨€</td><td>Erlang</td><td>Java</td><td>Java</td><td>Scala&amp;Java</td></tr><tr><td>åè®®æ”¯æŒ</td><td>AMQPï¼ŒXMPPï¼ŒSMTPï¼ŒSTOMP</td><td>OpenWire,STOMPï¼ŒREST,XMPP,AMQP</td><td>è‡ªå®šä¹‰åè®®</td><td>è‡ªå®šä¹‰åè®®</td></tr><tr><td>å¯ç”¨æ€§</td><td>é«˜</td><td>ä¸€èˆ¬</td><td>é«˜</td><td>é«˜</td></tr><tr><td>å•æœºååé‡</td><td>ä¸€èˆ¬</td><td>å·®</td><td>é«˜</td><td>éå¸¸é«˜</td></tr><tr><td>æ¶ˆæ¯å»¶è¿Ÿ</td><td>å¾®ç§’çº§</td><td>æ¯«ç§’çº§</td><td>æ¯«ç§’çº§</td><td>æ¯«ç§’ä»¥å†…</td></tr><tr><td>æ¶ˆæ¯å¯é æ€§</td><td>é«˜</td><td>ä¸€èˆ¬</td><td>é«˜</td><td>ä¸€èˆ¬</td></tr></tbody></table></div><p>è¿½æ±‚å¯ç”¨æ€§ï¼šKafkaã€ RocketMQ ã€RabbitMQ</p><p>è¿½æ±‚å¯é æ€§ï¼šRabbitMQã€RocketMQ</p><p>è¿½æ±‚ååèƒ½åŠ›ï¼šRocketMQã€Kafka</p><p>è¿½æ±‚æ¶ˆæ¯ä½å»¶è¿Ÿï¼šRabbitMQã€Kafka</p><h1 id="å¿«é€Ÿå…¥é—¨"><a href="#å¿«é€Ÿå…¥é—¨" class="headerlink" title="å¿«é€Ÿå…¥é—¨"></a>å¿«é€Ÿå…¥é—¨</h1><h2 id="dokerå®‰è£…RabbitMQ"><a href="#dokerå®‰è£…RabbitMQ" class="headerlink" title="dokerå®‰è£…RabbitMQ"></a>dokerå®‰è£…RabbitMQ</h2><p>æ‹‰é•œåƒ</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull rabbitmq:3-management</span><br></pre></td></tr></table></figure><p>å¼€å¯å®¹å™¨</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">docker run \</span><br><span class="line"> -e RABBITMQ_DEFAULT_USER=root \</span><br><span class="line"> -e RABBITMQ_DEFAULT_PASS=root \</span><br><span class="line"> --name mq \</span><br><span class="line"> --hostname mq1 \</span><br><span class="line"> -p 15672:15672 \</span><br><span class="line"> -p 5672:5672 \</span><br><span class="line"> -d \</span><br><span class="line"> rabbitmq:3-management</span><br></pre></td></tr></table></figure><blockquote><p>æµè§ˆå™¨è®¿é—®åœ°å€ï¼š<a href="http://localhost:15672/">http://localhost:15672/</a></p></blockquote><h2 id="MQåŸºæœ¬ç»“æ„"><a href="#MQåŸºæœ¬ç»“æ„" class="headerlink" title="MQåŸºæœ¬ç»“æ„"></a>MQåŸºæœ¬ç»“æ„</h2><p>MQçš„åŸºæœ¬ç»“æ„ï¼š</p><p><img src="http://cdn.leesin.fun/typora/macpro/img/image-20210717162752376.png" alt="image-20210717162752376"></p><p>RabbitMQ ä¸­çš„ä¸€äº›è§’è‰²ï¼š</p><ul><li>publisherï¼šç”Ÿäº§è€…</li><li>consumerï¼šæ¶ˆè´¹è€…</li><li>exchangeï¼šäº¤æ¢æœºï¼Œè´Ÿè´£æ¶ˆæ¯è·¯ç”±</li><li>queueï¼šé˜Ÿåˆ—ï¼Œå­˜å‚¨æ¶ˆæ¯</li><li>virtualHostï¼šè™šæ‹Ÿä¸»æœºï¼Œéš”ç¦»ä¸åŒç§Ÿæˆ·çš„ exchangeã€queueã€æ¶ˆæ¯çš„éš”ç¦»</li></ul><h2 id="RabbitMQæ¶ˆæ¯æ¨¡å‹"><a href="#RabbitMQæ¶ˆæ¯æ¨¡å‹" class="headerlink" title="RabbitMQæ¶ˆæ¯æ¨¡å‹"></a>RabbitMQæ¶ˆæ¯æ¨¡å‹</h2><p>RabbitMQ å®˜æ–¹æä¾›äº†5ä¸ªä¸åŒçš„ Demo ç¤ºä¾‹ï¼Œå¯¹åº”äº†ä¸åŒçš„æ¶ˆæ¯æ¨¡å‹ï¼š</p><p><img src="http://cdn.leesin.fun/typora/macpro/img/image-20210717163332646.png" alt="image-20210717163332646"></p><h2 id="ç¯å¢ƒæ­å»º"><a href="#ç¯å¢ƒæ­å»º" class="headerlink" title="ç¯å¢ƒæ­å»º"></a>ç¯å¢ƒæ­å»º</h2><p>åœ¨ cloud-demo ä¸‹å»ºç«‹ä¸¤ä¸ªå­—æ¨¡å—ï¼šplusher å’Œ consumer</p><p>pomæ–‡ä»¶</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--lombok--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--AMQPä¾èµ–ï¼ŒåŒ…å«RabbitMQ--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-amqp<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--å•å…ƒæµ‹è¯•--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="åŸå§‹æ“ä½œâ€”ç®€å•é˜Ÿåˆ—æ¨¡å‹"><a href="#åŸå§‹æ“ä½œâ€”ç®€å•é˜Ÿåˆ—æ¨¡å‹" class="headerlink" title="åŸå§‹æ“ä½œâ€”ç®€å•é˜Ÿåˆ—æ¨¡å‹"></a>åŸå§‹æ“ä½œâ€”ç®€å•é˜Ÿåˆ—æ¨¡å‹</h2><p>ç®€å•é˜Ÿåˆ—æ¨¡å¼çš„æ¨¡å‹å›¾ï¼š</p><p> <img src="http://cdn.leesin.fun/typora/macpro/img/image-20210717163434647.png" alt="image-20210717163434647"></p><p>å®˜æ–¹çš„HelloWorldæ˜¯åŸºäºæœ€åŸºç¡€çš„æ¶ˆæ¯é˜Ÿåˆ—æ¨¡å‹æ¥å®ç°çš„ï¼ŒåªåŒ…æ‹¬ä¸‰ä¸ªè§’è‰²ï¼š</p><ul><li>publisherï¼šæ¶ˆæ¯å‘å¸ƒè€…ï¼Œå°†æ¶ˆæ¯å‘é€åˆ°é˜Ÿåˆ—queue</li><li>queueï¼šæ¶ˆæ¯é˜Ÿåˆ—ï¼Œè´Ÿè´£æ¥å—å¹¶ç¼“å­˜æ¶ˆæ¯</li><li>consumerï¼šè®¢é˜…é˜Ÿåˆ—ï¼Œå¤„ç†é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯</li></ul><h3 id="æ¶ˆæ¯å‘é€"><a href="#æ¶ˆæ¯å‘é€" class="headerlink" title="æ¶ˆæ¯å‘é€"></a>æ¶ˆæ¯å‘é€</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PublisherTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSendMessage</span><span class="params">()</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        <span class="comment">// 1.å»ºç«‹è¿æ¥</span></span><br><span class="line">        <span class="type">ConnectionFactory</span> <span class="variable">factory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ConnectionFactory</span>();</span><br><span class="line">        <span class="comment">// 1.1.è®¾ç½®è¿æ¥å‚æ•°ï¼Œåˆ†åˆ«æ˜¯ï¼šä¸»æœºåã€ç«¯å£å·ã€vhostã€ç”¨æˆ·åã€å¯†ç </span></span><br><span class="line">        factory.setHost(<span class="string">&quot;localhost&quot;</span>);</span><br><span class="line">        factory.setPort(<span class="number">5672</span>);</span><br><span class="line">        factory.setVirtualHost(<span class="string">&quot;/&quot;</span>);</span><br><span class="line">        factory.setUsername(<span class="string">&quot;root&quot;</span>);</span><br><span class="line">        factory.setPassword(<span class="string">&quot;root&quot;</span>);</span><br><span class="line">        <span class="comment">// 1.2.å»ºç«‹è¿æ¥</span></span><br><span class="line">        <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> factory.newConnection();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2.åˆ›å»ºé€šé“Channel</span></span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> connection.createChannel();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3.åˆ›å»ºé˜Ÿåˆ—</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">queueName</span> <span class="operator">=</span> <span class="string">&quot;simple.queue&quot;</span>;</span><br><span class="line">        channel.queueDeclare(queueName, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4.å‘é€æ¶ˆæ¯</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> <span class="string">&quot;hello, rabbitmq!&quot;</span>;</span><br><span class="line">        channel.basicPublish(<span class="string">&quot;&quot;</span>, queueName, <span class="literal">null</span>, message.getBytes());</span><br><span class="line">        log.info(<span class="string">&quot;å‘é€æ¶ˆæ¯æˆåŠŸï¼š&#123;&#125;&quot;</span>, message);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 5.å…³é—­é€šé“å’Œè¿æ¥</span></span><br><span class="line">        channel.close();</span><br><span class="line">        connection.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ¶ˆæ¯æ¥æ”¶"><a href="#æ¶ˆæ¯æ¥æ”¶" class="headerlink" title="æ¶ˆæ¯æ¥æ”¶"></a>æ¶ˆæ¯æ¥æ”¶</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConsumerTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        <span class="comment">// 1.å»ºç«‹è¿æ¥</span></span><br><span class="line">        <span class="type">ConnectionFactory</span> <span class="variable">factory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ConnectionFactory</span>();</span><br><span class="line">        <span class="comment">// 1.1.è®¾ç½®è¿æ¥å‚æ•°ï¼Œåˆ†åˆ«æ˜¯ï¼šä¸»æœºåã€ç«¯å£å·ã€vhostã€ç”¨æˆ·åã€å¯†ç </span></span><br><span class="line">        factory.setHost(<span class="string">&quot;localhost&quot;</span>);</span><br><span class="line">        factory.setPort(<span class="number">5672</span>);</span><br><span class="line">        factory.setVirtualHost(<span class="string">&quot;/&quot;</span>);</span><br><span class="line">        factory.setUsername(<span class="string">&quot;root&quot;</span>);</span><br><span class="line">        factory.setPassword(<span class="string">&quot;root&quot;</span>);</span><br><span class="line">        <span class="comment">// 1.2.å»ºç«‹è¿æ¥</span></span><br><span class="line">        <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> factory.newConnection();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2.åˆ›å»ºé€šé“Channel</span></span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> connection.createChannel();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3.åˆ›å»ºé˜Ÿåˆ—</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">queueName</span> <span class="operator">=</span> <span class="string">&quot;simple.queue&quot;</span>;</span><br><span class="line">        channel.queueDeclare(queueName, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4.è®¢é˜…æ¶ˆæ¯</span></span><br><span class="line">        channel.basicConsume(queueName, <span class="literal">true</span>, <span class="keyword">new</span> <span class="title class_">DefaultConsumer</span>(channel) &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handleDelivery</span><span class="params">(String consumerTag, Envelope envelope,</span></span><br><span class="line"><span class="params">                                       AMQP.BasicProperties properties, <span class="type">byte</span>[] body)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">                <span class="comment">// 5.å¤„ç†æ¶ˆæ¯</span></span><br><span class="line">                <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(body);</span><br><span class="line">                log.info(<span class="string">&quot;æ¥æ”¶åˆ°çš„æ¶ˆæ¯ï¼š&#123;&#125;&quot;</span>, message);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        log.info(<span class="string">&quot;ç­‰å¾…æ¥æ”¶æ¶ˆæ¯....&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="SpringAMQP"><a href="#SpringAMQP" class="headerlink" title="SpringAMQP"></a>SpringAMQP</h1><p>SpringAMQP æ˜¯åŸºäº RabbitMQ å°è£…çš„ä¸€å¥—æ¨¡æ¿ï¼Œå¹¶ä¸”è¿˜åˆ©ç”¨ SpringBoot å¯¹å…¶å®ç°äº†è‡ªåŠ¨è£…é…ï¼Œä½¿ç”¨èµ·æ¥éå¸¸æ–¹ä¾¿ã€‚</p><p>SpringAmqp çš„å®˜æ–¹åœ°å€ï¼š<a href="https://spring.io/projects/spring-amqp">https://spring.io/projects/spring-amqp</a></p><p>SpringAMQP æä¾›äº†ä¸‰ä¸ªåŠŸèƒ½ï¼š</p><ul><li>è‡ªåŠ¨å£°æ˜é˜Ÿåˆ—ã€äº¤æ¢æœºåŠå…¶ç»‘å®šå…³ç³»</li><li>åŸºäºæ³¨è§£çš„ç›‘å¬å™¨æ¨¡å¼ï¼Œå¼‚æ­¥æ¥æ”¶æ¶ˆæ¯</li><li>å°è£…äº† RabbitTemplate å·¥å…·ï¼Œç”¨äºå‘é€æ¶ˆæ¯ </li></ul><h2 id="ç®€å•é˜Ÿåˆ—æ¨¡å‹"><a href="#ç®€å•é˜Ÿåˆ—æ¨¡å‹" class="headerlink" title="ç®€å•é˜Ÿåˆ—æ¨¡å‹"></a>ç®€å•é˜Ÿåˆ—æ¨¡å‹</h2><h3 id="æ¶ˆæ¯å‘é€-1"><a href="#æ¶ˆæ¯å‘é€-1" class="headerlink" title="æ¶ˆæ¯å‘é€"></a>æ¶ˆæ¯å‘é€</h3><p>é¦–å…ˆé…ç½® MQ åœ°å€ï¼Œåœ¨ publisher æœåŠ¡çš„ application.yml ä¸­æ·»åŠ é…ç½®ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">rabbitmq:</span></span><br><span class="line">    <span class="attr">host:</span> <span class="string">localhost</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">5672</span></span><br><span class="line">    <span class="attr">virtual-host:</span> <span class="string">/</span> <span class="comment"># è™šæ‹Ÿä¸»æœº</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">root</span></span><br></pre></td></tr></table></figure><p>ç„¶ååœ¨ publisher æœåŠ¡ä¸­ç¼–å†™æµ‹è¯•ç±» SpringAmqpTestï¼Œå¹¶åˆ©ç”¨ RabbitTemplate å®ç°æ¶ˆæ¯å‘é€ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RunWith(SpringRunner.class)</span></span><br><span class="line"><span class="meta">@SpringBootTest(classes = &#123;PublisherApp.class&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringAmqpTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RabbitTemplate rabbitTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSimpleQueue</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// é˜Ÿåˆ—åç§°</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">queueName</span> <span class="operator">=</span> <span class="string">&quot;simple.queue&quot;</span>;</span><br><span class="line">        <span class="comment">// æ¶ˆæ¯</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> <span class="string">&quot;hello, spring amqp!&quot;</span>;</span><br><span class="line">        <span class="comment">// å‘é€æ¶ˆæ¯</span></span><br><span class="line">        rabbitTemplate.convertAndSend(queueName, message);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ¶ˆæ¯æ¥æ”¶-1"><a href="#æ¶ˆæ¯æ¥æ”¶-1" class="headerlink" title="æ¶ˆæ¯æ¥æ”¶"></a>æ¶ˆæ¯æ¥æ”¶</h3><p>é¦–å…ˆé…ç½® MQ åœ°å€ï¼Œåœ¨ consumer æœåŠ¡çš„ application.yml ä¸­æ·»åŠ é…ç½®ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">rabbitmq:</span></span><br><span class="line">    <span class="attr">host:</span> <span class="string">localhost</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">5672</span></span><br><span class="line">    <span class="attr">virtual-host:</span> <span class="string">/</span> <span class="comment"># è™šæ‹Ÿä¸»æœº</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">root</span></span><br></pre></td></tr></table></figure><p>ç„¶ååœ¨ consumer æœåŠ¡ä¸­æ–°å»ºä¸€ä¸ªç±» RabbitMQListenerï¼Œä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RabbitMQListener</span> &#123;</span><br><span class="line">    <span class="meta">@RabbitListener(queues = &#123;&quot;simple.queue&quot;&#125;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">listenSimpleQueueMessage</span><span class="params">(String msg)</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;æ¥æ”¶åˆ°çš„æ¶ˆæ¯æ˜¯ï¼š&#123;&#125;&quot;</span>, msg);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h3><p>å¯åŠ¨ consumer æœåŠ¡ï¼Œç„¶ååœ¨ publisher æœåŠ¡ä¸­è¿è¡Œæµ‹è¯•ä»£ç ï¼Œå‘é€ MQ æ¶ˆæ¯</p><h2 id="WorkQueue"><a href="#WorkQueue" class="headerlink" title="WorkQueue"></a>WorkQueue</h2><p>Work queuesï¼Œä¹Ÿè¢«ç§°ä¸ºï¼ˆTask queuesï¼‰ï¼Œä»»åŠ¡æ¨¡å‹ã€‚ç®€å•æ¥è¯´å°±æ˜¯<strong>è®©å¤šä¸ªæ¶ˆè´¹è€…ç»‘å®šåˆ°ä¸€ä¸ªé˜Ÿåˆ—ï¼Œå…±åŒæ¶ˆè´¹é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯</strong>ã€‚</p><p><img src="http://cdn.leesin.fun/typora/macpro/img/image-20210717164238910.png" alt="image-20210717164238910"></p><p>å½“æ¶ˆæ¯å¤„ç†æ¯”è¾ƒè€—æ—¶çš„æ—¶å€™ï¼Œå¯èƒ½ç”Ÿäº§æ¶ˆæ¯çš„é€Ÿåº¦ä¼šè¿œè¿œå¤§äºæ¶ˆæ¯çš„æ¶ˆè´¹é€Ÿåº¦ã€‚é•¿æ­¤ä»¥å¾€ï¼Œæ¶ˆæ¯å°±ä¼šå †ç§¯è¶Šæ¥è¶Šå¤šï¼Œæ— æ³•åŠæ—¶å¤„ç†ã€‚</p><p>æ­¤æ—¶å°±å¯ä»¥ä½¿ç”¨ work æ¨¡å‹ï¼Œå¤šä¸ªæ¶ˆè´¹è€…å…±åŒå¤„ç†æ¶ˆæ¯å¤„ç†ï¼Œé€Ÿåº¦å°±èƒ½å¤§å¤§æé«˜äº†ã€‚</p><h3 id="æ¶ˆæ¯å‘é€-2"><a href="#æ¶ˆæ¯å‘é€-2" class="headerlink" title="æ¶ˆæ¯å‘é€"></a>æ¶ˆæ¯å‘é€</h3><p>è¿™æ¬¡æˆ‘ä»¬å¾ªç¯å‘é€ï¼Œæ¨¡æ‹Ÿå¤§é‡æ¶ˆæ¯å †ç§¯ç°è±¡ã€‚</p><p>åœ¨ publisher æœåŠ¡ä¸­çš„ SpringAmqpTest ç±»ä¸­æ·»åŠ ä¸€ä¸ªæµ‹è¯•æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * workQueue</span></span><br><span class="line"><span class="comment">     * å‘é˜Ÿåˆ—ä¸­ä¸åœå‘é€æ¶ˆæ¯ï¼Œæ¨¡æ‹Ÿæ¶ˆæ¯å †ç§¯ã€‚</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testWorkQueue</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">    <span class="comment">// é˜Ÿåˆ—åç§°</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">queueName</span> <span class="operator">=</span> <span class="string">&quot;simple.queue&quot;</span>;</span><br><span class="line">    <span class="comment">// æ¶ˆæ¯</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> <span class="string">&quot;hello, message_&quot;</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">50</span>; i++) &#123;</span><br><span class="line">        <span class="comment">// å‘é€æ¶ˆæ¯</span></span><br><span class="line">        rabbitTemplate.convertAndSend(queueName, message + i);</span><br><span class="line">        Thread.sleep(<span class="number">20</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ¶ˆæ¯æ¥æ”¶-2"><a href="#æ¶ˆæ¯æ¥æ”¶-2" class="headerlink" title="æ¶ˆæ¯æ¥æ”¶"></a>æ¶ˆæ¯æ¥æ”¶</h3><p>consumer æœåŠ¡ç¼–å†™ MQ é…ç½®ç±»ï¼Œåˆ›å»º <code>work.queue</code> é˜Ÿåˆ—</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MQConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Queue <span class="title function_">workQueue</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Queue</span>(<span class="string">&quot;work.queue&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¦æ¨¡æ‹Ÿå¤šä¸ªæ¶ˆè´¹è€…ç»‘å®šåŒä¸€ä¸ªé˜Ÿåˆ—ï¼Œæˆ‘ä»¬åœ¨ consumer æœåŠ¡çš„ RabbitMQListener ä¸­æ·»åŠ  2 ä¸ªæ–°çš„æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *  æ¯æ¬¡ä¼‘çœ 20æ¯«ç§’</span></span><br><span class="line"><span class="comment"> *  ç›¸å½“äºæ¯ç§’èƒ½å¤„ç† 50 æ¡æ¶ˆæ¯</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RabbitListener(queues = &quot;work.queue&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">listenWorkQueue1</span><span class="params">(String msg)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">  System.out.println(<span class="string">&quot;æ¶ˆè´¹è€…1æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€&quot;</span> + msg + <span class="string">&quot;ã€‘&quot;</span> + LocalTime.now());</span><br><span class="line">  Thread.sleep(<span class="number">20</span>); <span class="comment">// ä¼‘çœ æ¨¡æ‹Ÿæ¶ˆè´¹èƒ½åŠ›</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *  æ¯æ¬¡ä¼‘çœ 200æ¯«ç§’</span></span><br><span class="line"><span class="comment"> *  ç›¸å½“äºæ¯ç§’èƒ½å¤„ç† 5 æ¡æ¶ˆæ¯</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RabbitListener(queues = &quot;work.queue&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">listenWorkQueue2</span><span class="params">(String msg)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">  System.err.println(<span class="string">&quot;æ¶ˆè´¹è€…2........æ¥æ”¶åˆ°æ¶ˆæ¯ï¼šã€&quot;</span> + msg + <span class="string">&quot;ã€‘&quot;</span> + LocalTime.now());</span><br><span class="line">  Thread.sleep(<span class="number">200</span>); <span class="comment">// ä¼‘çœ æ¨¡æ‹Ÿæ¶ˆè´¹èƒ½åŠ›</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æµ‹è¯•-1"><a href="#æµ‹è¯•-1" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h3><p>é‡å¯ ConsumerApp åï¼Œåœ¨æ‰§è¡Œ publisher æœåŠ¡ä¸­åˆšåˆšç¼–å†™çš„å‘é€æµ‹è¯•æ–¹æ³• testWorkQueueã€‚</p><p>å¯ä»¥çœ‹åˆ°æ¶ˆè´¹è€…1å¾ˆå¿«å®Œæˆäº†è‡ªå·±çš„ 25 æ¡æ¶ˆæ¯ã€‚æ¶ˆè´¹è€… 2 å´åœ¨ç¼“æ…¢çš„å¤„ç†è‡ªå·±çš„ 25 æ¡æ¶ˆæ¯ã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´æ¶ˆæ¯æ˜¯å¹³å‡åˆ†é…ç»™æ¯ä¸ªæ¶ˆè´¹è€…ï¼Œå¹¶æ²¡æœ‰è€ƒè™‘åˆ°æ¶ˆè´¹è€…çš„å¤„ç†èƒ½åŠ›ã€‚è¿™æ ·æ˜¾ç„¶æ˜¯æœ‰é—®é¢˜çš„ã€‚</p><p>è¿™æ˜¯å› ä¸ºï¼Œåœ¨ Spring AMQP ä¸­ï¼Œæ¯ä¸ª listener ä¼šé¢„å–æ¶ˆæ¯ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨å¯åŠ¨ consumer æ—¶å°±ä¼šæ‹‰å–ä¸€å®šæ•°é‡çš„æ¶ˆæ¯åˆ°æœ¬åœ°ç¼“å­˜ï¼Œä»¥ä¾¿èƒ½å¤Ÿå¿«é€Ÿå¤„ç†ä¸‹ä¸€ä¸ªæ¶ˆæ¯ã€‚</p><h3 id="èƒ½è€…å¤šåŠ³"><a href="#èƒ½è€…å¤šåŠ³" class="headerlink" title="èƒ½è€…å¤šåŠ³"></a>èƒ½è€…å¤šåŠ³</h3><p>åœ¨ spring ä¸­æœ‰ä¸€ä¸ªç®€å•çš„é…ç½®ï¼Œå¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚æˆ‘ä»¬ä¿®æ”¹ consumer æœåŠ¡çš„ application.yml æ–‡ä»¶ï¼Œæ·»åŠ é…ç½®ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">rabbitmq:</span></span><br><span class="line">    <span class="attr">listener:</span></span><br><span class="line">      <span class="attr">simple:</span></span><br><span class="line">        <span class="attr">prefetch:</span> <span class="number">1</span> <span class="comment"># æ¯æ¬¡åªèƒ½è·å–ä¸€æ¡æ¶ˆæ¯ï¼Œå¤„ç†å®Œæˆæ‰èƒ½è·å–ä¸‹ä¸€ä¸ªæ¶ˆæ¯</span></span><br></pre></td></tr></table></figure><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>Work æ¨¡å‹çš„ä½¿ç”¨ï¼š</p><ul><li>å¤šä¸ªæ¶ˆè´¹è€…ç»‘å®šåˆ°ä¸€ä¸ªé˜Ÿåˆ—ï¼ŒåŒä¸€æ¡æ¶ˆæ¯åªä¼šè¢«ä¸€ä¸ªæ¶ˆè´¹è€…å¤„ç†</li><li>é€šè¿‡è®¾ç½®prefetchæ¥æ§åˆ¶æ¶ˆè´¹è€…é¢„å–çš„æ¶ˆæ¯æ•°é‡</li></ul><h2 id="å‘å¸ƒ-è®¢é˜…"><a href="#å‘å¸ƒ-è®¢é˜…" class="headerlink" title="å‘å¸ƒ/è®¢é˜…"></a>å‘å¸ƒ/è®¢é˜…</h2><p>å‘å¸ƒè®¢é˜…çš„æ¨¡å‹å¦‚å›¾ï¼š</p><p><img src="http://cdn.leesin.fun/typora/macpro/img/image-20210717165309625.png" alt="image-20210717165309625"></p><p>å¯ä»¥çœ‹åˆ°ï¼Œåœ¨è®¢é˜…æ¨¡å‹ä¸­ï¼Œå¤šäº†ä¸€ä¸ª exchange è§’è‰²ï¼Œè€Œä¸”è¿‡ç¨‹ç•¥æœ‰å˜åŒ–ï¼š</p><ul><li>Publisherï¼šç”Ÿäº§è€…ï¼Œä¹Ÿå°±æ˜¯è¦å‘é€æ¶ˆæ¯çš„ç¨‹åºï¼Œä½†æ˜¯ä¸å†å‘é€åˆ°é˜Ÿåˆ—ä¸­ï¼Œè€Œæ˜¯å‘ç»™Xï¼ˆäº¤æ¢æœºï¼‰</li><li>Exchangeï¼šäº¤æ¢æœºï¼Œå›¾ä¸­çš„Xã€‚ä¸€æ–¹é¢ï¼Œæ¥æ”¶ç”Ÿäº§è€…å‘é€çš„æ¶ˆæ¯ã€‚å¦ä¸€æ–¹é¢ï¼ŒçŸ¥é“å¦‚ä½•å¤„ç†æ¶ˆæ¯ï¼Œä¾‹å¦‚é€’äº¤ç»™æŸä¸ªç‰¹åˆ«é˜Ÿåˆ—ã€é€’äº¤ç»™æ‰€æœ‰é˜Ÿåˆ—ã€æˆ–æ˜¯å°†æ¶ˆæ¯ä¸¢å¼ƒã€‚åˆ°åº•å¦‚ä½•æ“ä½œï¼Œå–å†³äº Exchange çš„ç±»å‹ã€‚Exchange æœ‰ä»¥ä¸‹ 3 ç§ç±»å‹ï¼š<ul><li>Fanoutï¼šå¹¿æ’­ï¼Œå°†æ¶ˆæ¯äº¤ç»™æ‰€æœ‰ç»‘å®šåˆ°äº¤æ¢æœºçš„é˜Ÿåˆ—</li><li>Directï¼šå®šå‘ï¼ŒæŠŠæ¶ˆæ¯äº¤ç»™ç¬¦åˆæŒ‡å®š routing key çš„é˜Ÿåˆ—</li><li>Topicï¼šé€šé…ç¬¦ï¼ŒæŠŠæ¶ˆæ¯äº¤ç»™ç¬¦åˆ routing patternï¼ˆè·¯ç”±æ¨¡å¼ï¼‰ çš„é˜Ÿåˆ—</li></ul></li><li>Consumerï¼šæ¶ˆè´¹è€…ï¼Œä¸ä»¥å‰ä¸€æ ·ï¼Œè®¢é˜…é˜Ÿåˆ—ï¼Œæ²¡æœ‰å˜åŒ–</li><li>Queueï¼šæ¶ˆæ¯é˜Ÿåˆ—ä¹Ÿä¸ä»¥å‰ä¸€æ ·ï¼Œæ¥æ”¶æ¶ˆæ¯ã€ç¼“å­˜æ¶ˆæ¯ã€‚</li></ul><p><strong>Exchangeï¼ˆäº¤æ¢æœºï¼‰åªè´Ÿè´£è½¬å‘æ¶ˆæ¯ï¼Œä¸å…·å¤‡å­˜å‚¨æ¶ˆæ¯çš„èƒ½åŠ›</strong>ï¼Œå› æ­¤å¦‚æœæ²¡æœ‰ä»»ä½•é˜Ÿåˆ—ä¸ Exchange ç»‘å®šï¼Œæˆ–è€…æ²¡æœ‰ç¬¦åˆè·¯ç”±è§„åˆ™çš„é˜Ÿåˆ—ï¼Œé‚£ä¹ˆæ¶ˆæ¯ä¼šä¸¢å¤±ï¼</p><h3 id="Fanout"><a href="#Fanout" class="headerlink" title="Fanout"></a>Fanout</h3><p>Fanoutï¼Œè‹±æ–‡ç¿»è¯‘æ˜¯æ‰‡å‡ºï¼Œæˆ‘è§‰å¾—åœ¨ MQ ä¸­å«å¹¿æ’­æ›´åˆé€‚ã€‚</p><p><img src="http://cdn.leesin.fun/typora/macpro/img/image-20210717165438225.png" alt="image-20210717165438225"></p><p>åœ¨å¹¿æ’­æ¨¡å¼ä¸‹ï¼Œæ¶ˆæ¯å‘é€æµç¨‹æ˜¯è¿™æ ·çš„ï¼š</p><ul><li>1ï¼‰  å¯ä»¥æœ‰å¤šä¸ªé˜Ÿåˆ—</li><li>2ï¼‰  æ¯ä¸ªé˜Ÿåˆ—éƒ½è¦ç»‘å®šåˆ° Exchangeï¼ˆäº¤æ¢æœºï¼‰</li><li>3ï¼‰  ç”Ÿäº§è€…å‘é€çš„æ¶ˆæ¯ï¼Œåªèƒ½å‘é€åˆ°äº¤æ¢æœºï¼Œäº¤æ¢æœºæ¥å†³å®šè¦å‘ç»™å“ªä¸ªé˜Ÿåˆ—ï¼Œç”Ÿäº§è€…æ— æ³•å†³å®š</li><li>4ï¼‰  äº¤æ¢æœºæŠŠæ¶ˆæ¯å‘é€ç»™ç»‘å®šè¿‡çš„æ‰€æœ‰é˜Ÿåˆ—</li><li>5ï¼‰  è®¢é˜…é˜Ÿåˆ—çš„æ¶ˆè´¹è€…éƒ½èƒ½æ‹¿åˆ°æ¶ˆæ¯</li></ul><p>æˆ‘ä»¬çš„è®¡åˆ’æ˜¯è¿™æ ·çš„ï¼š</p><ul><li>åˆ›å»ºä¸€ä¸ªäº¤æ¢æœº itcast.fanoutï¼Œç±»å‹æ˜¯Fanout</li><li>åˆ›å»ºä¸¤ä¸ªé˜Ÿåˆ— fanout.queue1 å’Œ fanout.queue2ï¼Œç»‘å®šåˆ°äº¤æ¢æœº itcast.fanout</li></ul><p><img src="http://cdn.leesin.fun/typora/macpro/img/image-20210717165509466.png" alt="image-20210717165509466"></p><h4 id="å£°æ˜é˜Ÿåˆ—å’Œäº¤æ¢æœº"><a href="#å£°æ˜é˜Ÿåˆ—å’Œäº¤æ¢æœº" class="headerlink" title="å£°æ˜é˜Ÿåˆ—å’Œäº¤æ¢æœº"></a>å£°æ˜é˜Ÿåˆ—å’Œäº¤æ¢æœº</h4><p>Spring æä¾›äº†ä¸€ä¸ªæ¥å£ Exchangeï¼Œæ¥è¡¨ç¤ºæ‰€æœ‰ä¸åŒç±»å‹çš„äº¤æ¢æœºï¼š</p><p><img src="http://cdn.leesin.fun/typora/macpro/img/image-20210717165552676.png" alt="image-20210717165552676"></p><p>åœ¨ consumer ä¸­åˆ›å»ºä¸€ä¸ªç±»ï¼Œå£°æ˜é˜Ÿåˆ—å’Œäº¤æ¢æœºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FanoutConfig</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å£°æ˜äº¤æ¢æœº</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> Fanoutç±»å‹äº¤æ¢æœº</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> FanoutExchange <span class="title function_">fanoutExchange</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">FanoutExchange</span>(<span class="string">&quot;itcast.fanout&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç¬¬1ä¸ªé˜Ÿåˆ—</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Queue <span class="title function_">fanoutQueue1</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Queue</span>(<span class="string">&quot;fanout.queue1&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç»‘å®šé˜Ÿåˆ—å’Œäº¤æ¢æœº</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Binding <span class="title function_">bindingQueue1</span><span class="params">(Queue fanoutQueue1, FanoutExchange fanoutExchange)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> BindingBuilder.bind(fanoutQueue1).to(fanoutExchange);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç¬¬2ä¸ªé˜Ÿåˆ—</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Queue <span class="title function_">fanoutQueue2</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Queue</span>(<span class="string">&quot;fanout.queue2&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç»‘å®šé˜Ÿåˆ—å’Œäº¤æ¢æœº</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Binding <span class="title function_">bindingQueue2</span><span class="params">(Queue fanoutQueue2, FanoutExchange fanoutExchange)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> BindingBuilder.bind(fanoutQueue2).to(fanoutExchange);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æ¶ˆæ¯å‘é€-3"><a href="#æ¶ˆæ¯å‘é€-3" class="headerlink" title="æ¶ˆæ¯å‘é€"></a>æ¶ˆæ¯å‘é€</h4><p>åœ¨ publisher æœåŠ¡çš„ SpringAmqpTest ç±»ä¸­æ·»åŠ æµ‹è¯•æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testFanoutExchange</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// é˜Ÿåˆ—åç§°</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">exchangeName</span> <span class="operator">=</span> <span class="string">&quot;itcast.fanout&quot;</span>;</span><br><span class="line">    <span class="comment">// æ¶ˆæ¯</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> <span class="string">&quot;hello, everyone!&quot;</span>;</span><br><span class="line">    rabbitTemplate.convertAndSend(exchangeName, <span class="string">&quot;&quot;</span>, message);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æ¶ˆæ¯æ¥æ”¶-3"><a href="#æ¶ˆæ¯æ¥æ”¶-3" class="headerlink" title="æ¶ˆæ¯æ¥æ”¶"></a>æ¶ˆæ¯æ¥æ”¶</h4><p>åœ¨ consumer æœåŠ¡çš„ RabbitMQListener ä¸­æ·»åŠ ä¸¤ä¸ªæ–¹æ³•ï¼Œä½œä¸ºæ¶ˆè´¹è€…ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RabbitListener(queues = &quot;fanout.queue1&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">listenFanoutQueue1</span><span class="params">(String msg)</span> &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;æ¶ˆè´¹è€…1æ¥æ”¶åˆ°Fanoutæ¶ˆæ¯ï¼šã€&quot;</span> + msg + <span class="string">&quot;ã€‘&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RabbitListener(queues = &quot;fanout.queue2&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">listenFanoutQueue2</span><span class="params">(String msg)</span> &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;æ¶ˆè´¹è€…2æ¥æ”¶åˆ°Fanoutæ¶ˆæ¯ï¼šã€&quot;</span> + msg + <span class="string">&quot;ã€‘&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æ€»ç»“-1"><a href="#æ€»ç»“-1" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h4><p>äº¤æ¢æœºçš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ</p><ul><li>æ¥æ”¶ publisher å‘é€çš„æ¶ˆæ¯</li><li>å°†æ¶ˆæ¯æŒ‰ç…§è§„åˆ™è·¯ç”±åˆ°ä¸ä¹‹ç»‘å®šçš„é˜Ÿåˆ—</li><li>ä¸èƒ½ç¼“å­˜æ¶ˆæ¯ï¼Œè·¯ç”±å¤±è´¥ï¼Œæ¶ˆæ¯ä¸¢å¤±</li><li>FanoutExchange çš„ä¼šå°†æ¶ˆæ¯è·¯ç”±åˆ°æ¯ä¸ªç»‘å®šçš„é˜Ÿåˆ—</li></ul><p>å£°æ˜é˜Ÿåˆ—ã€äº¤æ¢æœºã€ç»‘å®šå…³ç³»çš„Beanæ˜¯ä»€ä¹ˆï¼Ÿ</p><ul><li>Queue</li><li>FanoutExchange</li><li>Binding</li></ul><h3 id="Direct"><a href="#Direct" class="headerlink" title="Direct"></a>Direct</h3><p>åœ¨ Fanout æ¨¡å¼ä¸­ï¼Œä¸€æ¡æ¶ˆæ¯ï¼Œä¼šè¢«æ‰€æœ‰è®¢é˜…çš„é˜Ÿåˆ—éƒ½æ¶ˆè´¹ã€‚ä½†æ˜¯ï¼Œåœ¨æŸäº›åœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬å¸Œæœ›ä¸åŒçš„æ¶ˆæ¯è¢«ä¸åŒçš„é˜Ÿåˆ—æ¶ˆè´¹ã€‚è¿™æ—¶å°±è¦ç”¨åˆ° Direct ç±»å‹çš„ Exchangeã€‚</p><p><img src="http://cdn.leesin.fun/typora/macpro/img/image-20210717170041447.png" alt="image-20210717170041447"></p><p> åœ¨ Direct æ¨¡å‹ä¸‹ï¼š</p><ul><li>é˜Ÿåˆ—ä¸äº¤æ¢æœºçš„ç»‘å®šï¼Œä¸èƒ½æ˜¯ä»»æ„ç»‘å®šäº†ï¼Œè€Œæ˜¯è¦æŒ‡å®šä¸€ä¸ª<code>RoutingKey</code>ï¼ˆè·¯ç”±keyï¼‰</li><li>æ¶ˆæ¯çš„å‘é€æ–¹åœ¨ å‘ Exchange å‘é€æ¶ˆæ¯æ—¶ï¼Œä¹Ÿå¿…é¡»æŒ‡å®šæ¶ˆæ¯çš„ <code>RoutingKey</code>ã€‚</li><li>Exchange ä¸å†æŠŠæ¶ˆæ¯äº¤ç»™æ¯ä¸€ä¸ªç»‘å®šçš„é˜Ÿåˆ—ï¼Œè€Œæ˜¯æ ¹æ®æ¶ˆæ¯çš„ <code>Routing Key</code> è¿›è¡Œåˆ¤æ–­ï¼Œåªæœ‰é˜Ÿåˆ—çš„ <code>Routingkey</code> ä¸æ¶ˆæ¯çš„  <code>Routing key</code> å®Œå…¨ä¸€è‡´ï¼Œæ‰ä¼šæ¥æ”¶åˆ°æ¶ˆæ¯</li></ul><p><strong>æ¡ˆä¾‹éœ€æ±‚å¦‚ä¸‹</strong>ï¼š</p><ol><li><p>åˆ©ç”¨ @RabbitListener å£°æ˜ Exchangeã€Queueã€RoutingKey</p></li><li><p>åœ¨ consumer æœåŠ¡ä¸­ï¼Œç¼–å†™ä¸¤ä¸ªæ¶ˆè´¹è€…æ–¹æ³•ï¼Œåˆ†åˆ«ç›‘å¬ direct.queue1 å’Œ direct.queue2</p></li><li><p>åœ¨ publisher ä¸­ç¼–å†™æµ‹è¯•æ–¹æ³•ï¼Œå‘ itcast. direct å‘é€æ¶ˆæ¯</p></li></ol><p><img src="http://cdn.leesin.fun/typora/macpro/img/image-20210717170223317.png" alt="image-20210717170223317"></p><h4 id="åŸºäºæ³¨è§£å£°æ˜é˜Ÿåˆ—å’Œäº¤æ¢æœº"><a href="#åŸºäºæ³¨è§£å£°æ˜é˜Ÿåˆ—å’Œäº¤æ¢æœº" class="headerlink" title="åŸºäºæ³¨è§£å£°æ˜é˜Ÿåˆ—å’Œäº¤æ¢æœº"></a>åŸºäºæ³¨è§£å£°æ˜é˜Ÿåˆ—å’Œäº¤æ¢æœº</h4><p>åŸºäº @Bean çš„æ–¹å¼å£°æ˜é˜Ÿåˆ—å’Œäº¤æ¢æœºæ¯”è¾ƒéº»çƒ¦ï¼ŒSpring è¿˜æä¾›äº†åŸºäºæ³¨è§£æ–¹å¼æ¥å£°æ˜ã€‚</p><p>åœ¨ consumer çš„ RabbitMQListener ä¸­æ·»åŠ ä¸¤ä¸ªæ¶ˆè´¹è€…ï¼ŒåŒæ—¶åŸºäºæ³¨è§£æ¥å£°æ˜é˜Ÿåˆ—å’Œäº¤æ¢æœºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RabbitListener(bindings = @QueueBinding(</span></span><br><span class="line"><span class="meta">    value = @Queue(name = &quot;direct.queue1&quot;),</span></span><br><span class="line"><span class="meta">    exchange = @Exchange(name = &quot;itcast.direct&quot;, type = ExchangeTypes.DIRECT),</span></span><br><span class="line"><span class="meta">    key = &#123;&quot;red&quot;, &quot;blue&quot;&#125;</span></span><br><span class="line"><span class="meta">))</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">listenDirectQueue1</span><span class="params">(String msg)</span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;æ¶ˆè´¹è€…æ¥æ”¶åˆ°direct.queue1çš„æ¶ˆæ¯ï¼šã€&quot;</span> + msg + <span class="string">&quot;ã€‘&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RabbitListener(bindings = @QueueBinding(</span></span><br><span class="line"><span class="meta">    value = @Queue(name = &quot;direct.queue2&quot;),</span></span><br><span class="line"><span class="meta">    exchange = @Exchange(name = &quot;itcast.direct&quot;, type = ExchangeTypes.DIRECT),</span></span><br><span class="line"><span class="meta">    key = &#123;&quot;red&quot;, &quot;yellow&quot;&#125;</span></span><br><span class="line"><span class="meta">))</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">listenDirectQueue2</span><span class="params">(String msg)</span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;æ¶ˆè´¹è€…æ¥æ”¶åˆ°direct.queue2çš„æ¶ˆæ¯ï¼šã€&quot;</span> + msg + <span class="string">&quot;ã€‘&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æ¶ˆæ¯å‘é€-4"><a href="#æ¶ˆæ¯å‘é€-4" class="headerlink" title="æ¶ˆæ¯å‘é€"></a>æ¶ˆæ¯å‘é€</h4><p>åœ¨ publisher æœåŠ¡çš„ SpringAmqpTest ç±»ä¸­æ·»åŠ æµ‹è¯•æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSendDirectExchange</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// äº¤æ¢æœºåç§°</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">exchangeName</span> <span class="operator">=</span> <span class="string">&quot;itcast.direct&quot;</span>;</span><br><span class="line">    <span class="comment">// æ¶ˆæ¯</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> <span class="string">&quot;çº¢è‰²è­¦æŠ¥ï¼æ—¥æœ¬ä¹±æ’æ ¸åºŸæ°´ï¼Œå¯¼è‡´æµ·æ´‹ç”Ÿç‰©å˜å¼‚ï¼ŒæƒŠç°å“¥æ–¯æ‹‰ï¼&quot;</span>;</span><br><span class="line">    <span class="comment">// å‘é€æ¶ˆæ¯</span></span><br><span class="line">    rabbitTemplate.convertAndSend(exchangeName, <span class="string">&quot;red&quot;</span>, message);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>ç„¶åå¯ä»¥è¯•è¯•å‘é€ <code>&quot;blue&quot;</code> å’Œ <code>&quot;yellow&quot;</code>  </p></blockquote><h4 id="æ€»ç»“-2"><a href="#æ€»ç»“-2" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h4><p>æè¿°ä¸‹ Direct äº¤æ¢æœºä¸ Fanout äº¤æ¢æœºçš„å·®å¼‚ï¼Ÿ</p><ul><li>Fanout äº¤æ¢æœºå°†æ¶ˆæ¯è·¯ç”±ç»™æ¯ä¸€ä¸ªä¸ä¹‹ç»‘å®šçš„é˜Ÿåˆ—</li><li>Direct äº¤æ¢æœºæ ¹æ® RoutingKey åˆ¤æ–­è·¯ç”±ç»™å“ªä¸ªé˜Ÿåˆ—</li><li>å¦‚æœå¤šä¸ªé˜Ÿåˆ—å…·æœ‰ç›¸åŒçš„ RoutingKeyï¼Œåˆ™ä¸ Fanout åŠŸèƒ½ç±»ä¼¼</li></ul><p>åŸºäº @RabbitListener æ³¨è§£å£°æ˜é˜Ÿåˆ—å’Œäº¤æ¢æœºæœ‰å“ªäº›å¸¸è§æ³¨è§£ï¼Ÿ</p><ul><li>@Queue</li><li>@Exchange</li></ul><h3 id="Topic"><a href="#Topic" class="headerlink" title="Topic"></a>Topic</h3><h4 id="è¯´æ˜"><a href="#è¯´æ˜" class="headerlink" title="è¯´æ˜"></a>è¯´æ˜</h4><p><code>Topic</code> ç±»å‹çš„ <code>Exchange</code>  ä¸ <code>Direct</code> ç›¸æ¯”ï¼Œéƒ½æ˜¯å¯ä»¥æ ¹æ® <code>RoutingKey</code>  æŠŠæ¶ˆæ¯è·¯ç”±åˆ°ä¸åŒçš„é˜Ÿåˆ—ã€‚åªä¸è¿‡ <code>Topic</code> ç±»å‹ <code>Exchange</code> å¯ä»¥è®©é˜Ÿåˆ—åœ¨ç»‘å®š <code>Routing key</code>  çš„æ—¶å€™ä½¿ç”¨é€šé…ç¬¦ï¼</p><p><code>Routingkey</code>  ä¸€èˆ¬éƒ½æ˜¯æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªå•è¯ç»„æˆï¼Œå¤šä¸ªå•è¯ä¹‹é—´ä»¥ â€.â€ åˆ†å‰²ï¼Œä¾‹å¦‚ï¼š <code>item.insert</code></p><p> é€šé…ç¬¦è§„åˆ™ï¼š</p><p><code>#</code>ï¼šåŒ¹é…ä¸€ä¸ªæˆ–å¤šä¸ªè¯</p><p><code>*</code>ï¼šåŒ¹é…ä¸å¤šä¸å°‘æ°å¥½1ä¸ªè¯</p><p>ä¸¾ä¾‹ï¼š</p><p><code>item.#</code>ï¼šèƒ½å¤ŸåŒ¹é…<code>item.spu.insert</code> æˆ–è€… <code>item.spu</code></p><p><code>item.*</code>ï¼šåªèƒ½åŒ¹é…<code>item.spu</code></p><p>â€‹     </p><p>å›¾ç¤ºï¼š</p><p> <img src="http://cdn.leesin.fun/typora/macpro/img/image-20210717170705380.png" alt="image-20210717170705380"></p><p>è§£é‡Šï¼š</p><ul><li>Queue1ï¼šç»‘å®šçš„æ˜¯<code>china.#</code> ï¼Œå› æ­¤å‡¡æ˜¯ä»¥ <code>china.</code>å¼€å¤´çš„<code>routing key</code> éƒ½ä¼šè¢«åŒ¹é…åˆ°ã€‚åŒ…æ‹¬ china.news å’Œ china.weather</li><li>Queue2ï¼šç»‘å®šçš„æ˜¯<code>#.news</code> ï¼Œå› æ­¤å‡¡æ˜¯ä»¥ <code>.news</code>ç»“å°¾çš„ <code>routing key</code> éƒ½ä¼šè¢«åŒ¹é…ã€‚åŒ…æ‹¬ china.news å’Œ japan.news</li></ul><p>æ¡ˆä¾‹éœ€æ±‚ï¼š</p><p>å®ç°æ€è·¯å¦‚ä¸‹ï¼š</p><ol><li><p>å¹¶åˆ©ç”¨ @RabbitListener å£°æ˜ Exchangeã€Queueã€RoutingKey</p></li><li><p>åœ¨ consumer æœåŠ¡ä¸­ï¼Œç¼–å†™ä¸¤ä¸ªæ¶ˆè´¹è€…æ–¹æ³•ï¼Œåˆ†åˆ«ç›‘å¬ topic.queue1 å’Œ topic.queue2</p></li><li><p>åœ¨ publisher ä¸­ç¼–å†™æµ‹è¯•æ–¹æ³•ï¼Œå‘ itcast. topic å‘é€æ¶ˆæ¯</p></li></ol><p><img src="http://cdn.leesin.fun/typora/macpro/img/image-20210717170829229.png" alt="image-20210717170829229"></p><h4 id="æ¶ˆæ¯å‘é€-5"><a href="#æ¶ˆæ¯å‘é€-5" class="headerlink" title="æ¶ˆæ¯å‘é€"></a>æ¶ˆæ¯å‘é€</h4><p>åœ¨ publisher æœåŠ¡çš„ SpringAmqpTest ç±»ä¸­æ·»åŠ æµ‹è¯•æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* topicExchange</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSendTopicExchange</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// äº¤æ¢æœºåç§°</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">exchangeName</span> <span class="operator">=</span> <span class="string">&quot;itcast.topic&quot;</span>;</span><br><span class="line">    <span class="comment">// æ¶ˆæ¯</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> <span class="string">&quot;å–œæŠ¥ï¼å­™æ‚Ÿç©ºå¤§æˆ˜å“¥æ–¯æ‹‰ï¼Œèƒœ!&quot;</span>;</span><br><span class="line">    <span class="comment">// å‘é€æ¶ˆæ¯</span></span><br><span class="line">    rabbitTemplate.convertAndSend(exchangeName, <span class="string">&quot;china.news&quot;</span>, message);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>å°† <code>china.news</code>  æ”¹ä¸º <code>japan.news</code>  å’Œ  <code>china.xxx.xxx</code> åˆ†åˆ«è¯•è¯•</p></blockquote><h4 id="æ¶ˆæ¯æ¥æ”¶-4"><a href="#æ¶ˆæ¯æ¥æ”¶-4" class="headerlink" title="æ¶ˆæ¯æ¥æ”¶"></a>æ¶ˆæ¯æ¥æ”¶</h4><p>åœ¨ consumer æœåŠ¡çš„ RabbitMQListener ä¸­æ·»åŠ æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RabbitListener(bindings = @QueueBinding(</span></span><br><span class="line"><span class="meta">    value = @Queue(name = &quot;topic.queue1&quot;),</span></span><br><span class="line"><span class="meta">    exchange = @Exchange(name = &quot;itcast.topic&quot;, type = ExchangeTypes.TOPIC),</span></span><br><span class="line"><span class="meta">    key = &quot;china.#&quot;</span></span><br><span class="line"><span class="meta">))</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">listenTopicQueue1</span><span class="params">(String msg)</span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;æ¶ˆè´¹è€…æ¥æ”¶åˆ°topic.queue1çš„æ¶ˆæ¯ï¼šã€&quot;</span> + msg + <span class="string">&quot;ã€‘&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RabbitListener(bindings = @QueueBinding(</span></span><br><span class="line"><span class="meta">    value = @Queue(name = &quot;topic.queue2&quot;),</span></span><br><span class="line"><span class="meta">    exchange = @Exchange(name = &quot;itcast.topic&quot;, type = ExchangeTypes.TOPIC),</span></span><br><span class="line"><span class="meta">    key = &quot;#.news&quot;</span></span><br><span class="line"><span class="meta">))</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">listenTopicQueue2</span><span class="params">(String msg)</span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;æ¶ˆè´¹è€…æ¥æ”¶åˆ°topic.queue2çš„æ¶ˆæ¯ï¼šã€&quot;</span> + msg + <span class="string">&quot;ã€‘&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æ€»ç»“-3"><a href="#æ€»ç»“-3" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h4><p>æè¿°ä¸‹ Direct äº¤æ¢æœºä¸ Topic äº¤æ¢æœºçš„å·®å¼‚ï¼Ÿ</p><ul><li>Topic äº¤æ¢æœºæ¥æ”¶çš„æ¶ˆæ¯ RoutingKey å¿…é¡»æ˜¯å¤šä¸ªå•è¯ï¼Œä»¥ <code>**.**</code> åˆ†å‰²</li><li>Topic äº¤æ¢æœºä¸é˜Ÿåˆ—ç»‘å®šæ—¶çš„ bindingKey å¯ä»¥æŒ‡å®šé€šé…ç¬¦</li><li><code>#</code>ï¼šä»£è¡¨0ä¸ªæˆ–å¤šä¸ªè¯</li><li><code>*</code>ï¼šä»£è¡¨1ä¸ªè¯</li></ul>]]></content>
      
      
      <categories>
          
          <category> åç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> clound </tag>
            
            <tag> MQ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>OpenFeignåŸºç¡€çŸ¥è¯†</title>
      <link href="/post/38.html"/>
      <url>/post/38.html</url>
      
        <content type="html"><![CDATA[<h1 id="OpenFeignæ›¿ä»£RestTemplate"><a href="#OpenFeignæ›¿ä»£RestTemplate" class="headerlink" title="OpenFeignæ›¿ä»£RestTemplate"></a>OpenFeignæ›¿ä»£RestTemplate</h1><p>å°† Feign çš„ Client æŠ½å–ä¸ºç‹¬ç«‹æ¨¡å—ï¼Œå¹¶ä¸”æŠŠé»˜è®¤çš„ Feign é…ç½®éƒ½æ”¾åˆ°è¿™ä¸ªæ¨¡å—ä¸­ï¼Œæä¾›ç»™æ‰€æœ‰æ¶ˆè´¹è€…ä½¿ç”¨ã€‚</p><p>ä¾‹å¦‚ï¼Œå°† UserClientã€Feign çš„é»˜è®¤é…ç½®éƒ½æŠ½å–åˆ°ä¸€ä¸ª feign-api åŒ…ä¸­ï¼Œæ‰€æœ‰å¾®æœåŠ¡å¼•ç”¨è¯¥ä¾èµ–åŒ…ï¼Œå³å¯ç›´æ¥ä½¿ç”¨ã€‚</p><p><img src="http://cdn.leesin.fun/typora/s3/img/image-20210714214041796.png" alt="image-20210714214041796"></p><h2 id="æ–°å¢å…¬å…±æ¨¡å—feign-api"><a href="#æ–°å¢å…¬å…±æ¨¡å—feign-api" class="headerlink" title="æ–°å¢å…¬å…±æ¨¡å—feign-api"></a>æ–°å¢å…¬å…±æ¨¡å—feign-api</h2><p>åœ¨æœåŠ¡æä¾›æ–¹çš„é¡¹ç›®é‡Œï¼Œæ–°å¢æ¨¡å— feign-apiï¼Œå¹¶å¯¼å…¥ openfeign ä¾èµ–ã€‚</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--openfeign--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-openfeign<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--å¼•å…¥å®ä½“ç±»æ¨¡å—--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.lyf<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>base<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><p>æ–°å¢ FeignClient</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@FeignClient(&quot;user-service&quot;)</span> <span class="comment">//user-service æ˜¯æœåŠ¡åç§°</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserClient</span> &#123;</span><br><span class="line">    <span class="meta">@GetMapping(&quot;/user/&#123;id&#125;&quot;)</span> <span class="comment">// æœåŠ¡è¯·æ±‚è·¯å¾„</span></span><br><span class="line">    User <span class="title function_">queryById</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ä¿®æ”¹order-serviceæ¨¡å—"><a href="#ä¿®æ”¹order-serviceæ¨¡å—" class="headerlink" title="ä¿®æ”¹order-serviceæ¨¡å—"></a>ä¿®æ”¹order-serviceæ¨¡å—</h2><p>1ï¼‰å¼•å…¥ä¾èµ–</p><p>æˆ‘ä»¬åœ¨ order-service æœåŠ¡çš„ pom æ–‡ä»¶ä¸­å¼•å…¥ openfeign çš„ä¾èµ–ï¼Œå’Œ feignClient ä¾èµ–</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--openfeign--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-openfeign<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--è‡ªå·±å®šä¹‰çš„ FeignClient æ¨¡å—--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.lyf<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>feign-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>2ï¼‰æ·»åŠ æ³¨è§£</p><p>åœ¨ order-service çš„å¯åŠ¨ç±»æ·»åŠ æ³¨è§£å¼€å¯ Feign çš„åŠŸèƒ½ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@MapperScan(&quot;com.lyf.order.mapper&quot;)</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableFeignClients(clients = &#123;UserClient.class&#125;)</span> <span class="comment">// æŒ‡å®šåŠ è½½å“ªä¸ª FeignClient åˆ° Spring å®¹å™¨ä¸­</span></span><br><span class="line"><span class="comment">// @EnableFeignClients(basePackages = &quot;com.lyf.feign.clients&quot;) // æŒ‡å®š Feign åº”è¯¥æ‰«æçš„åŒ…</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderApplication</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(OrderApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>OpenFeign æ‰«æ Client æœ‰ä¸¤ç§æ–¹å¼ï¼š</p><ol><li>æŒ‡å®šéœ€è¦åŠ è½½çš„ Client æ¥å£ï¼š<code>@EnableFeignClients(clients = &#123;UserClient.class&#125;)</code></li><li>æŒ‡å®š Feign åº”è¯¥æ‰«æçš„åŒ…ï¼š<code>@EnableFeignClients(basePackages = &quot;com.lyf.feign.clients&quot;)</code></li></ol><p>æ¨èä½¿ç”¨ç¬¬ 1 ç§æ–¹å¼ï¼Œç”¨å¤šå°‘åŠ è½½å¤šå°‘ã€‚</p></blockquote><p>3ï¼‰ç¼–å†™æµ‹è¯•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> OrderMapper orderMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserClient userClient;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Order <span class="title function_">queryOrderById</span><span class="params">(Long orderId)</span> &#123;</span><br><span class="line">        <span class="type">Order</span> <span class="variable">order</span> <span class="operator">=</span> orderMapper.selectById(orderId);</span><br><span class="line">        <span class="comment">// String url = &quot;http://user-service/user/&quot; + order.getUserId();</span></span><br><span class="line">        <span class="comment">// User user = restTemplate.getForObject(url, User.class);</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userClient.queryById(order.getUserId());</span><br><span class="line">        order.setUser(user);</span><br><span class="line">        <span class="keyword">return</span> order;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="OpenFeignçš„è‡ªå®šä¹‰é…ç½®"><a href="#OpenFeignçš„è‡ªå®šä¹‰é…ç½®" class="headerlink" title="OpenFeignçš„è‡ªå®šä¹‰é…ç½®"></a>OpenFeignçš„è‡ªå®šä¹‰é…ç½®</h1><p>OpenFeign å¯ä»¥æ”¯æŒå¾ˆå¤šçš„è‡ªå®šä¹‰é…ç½®ï¼Œå¦‚ä¸‹è¡¨æ‰€ç¤ºï¼š</p><div class="table-container"><table><thead><tr><th>ç±»å‹</th><th>ä½œç”¨</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><strong>feign.Logger.Level</strong></td><td>ä¿®æ”¹æ—¥å¿—çº§åˆ«</td><td>åŒ…å«å››ç§ä¸åŒçš„çº§åˆ«ï¼šNONEã€BASICã€HEADERSã€FULL</td></tr><tr><td>feign.codec.Decoder</td><td>å“åº”ç»“æœçš„è§£æå™¨</td><td>httpè¿œç¨‹è°ƒç”¨çš„ç»“æœåšè§£æï¼Œä¾‹å¦‚è§£æjsonå­—ç¬¦ä¸²ä¸ºjavaå¯¹è±¡</td></tr><tr><td>feign.codec.Encoder</td><td>è¯·æ±‚å‚æ•°ç¼–ç </td><td>å°†è¯·æ±‚å‚æ•°ç¼–ç ï¼Œä¾¿äºé€šè¿‡httpè¯·æ±‚å‘é€</td></tr><tr><td>feign. Contract</td><td>æ”¯æŒçš„æ³¨è§£æ ¼å¼</td><td>é»˜è®¤æ˜¯SpringMVCçš„æ³¨è§£</td></tr><tr><td>feign. Retryer</td><td>å¤±è´¥é‡è¯•æœºåˆ¶</td><td>è¯·æ±‚å¤±è´¥çš„é‡è¯•æœºåˆ¶ï¼Œé»˜è®¤æ˜¯æ²¡æœ‰ï¼Œä¸è¿‡ä¼šä½¿ç”¨Ribbonçš„é‡è¯•</td></tr></tbody></table></div><blockquote><p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œ<strong>é»˜è®¤å€¼å°±èƒ½æ»¡è¶³æˆ‘ä»¬ä½¿ç”¨</strong>ï¼Œå¦‚æœè¦è‡ªå®šä¹‰æ—¶ï¼Œåªéœ€è¦åˆ›å»ºè‡ªå®šä¹‰çš„ @Bean è¦†ç›–é»˜è®¤ Bean å³å¯ã€‚</p></blockquote><p>ä¸‹é¢ä»¥æ—¥å¿—ä¸ºä¾‹æ¥æ¼”ç¤ºå¦‚ä½•è‡ªå®šä¹‰é…ç½®ã€‚</p><h2 id="1-é…ç½®æ–‡ä»¶æ–¹å¼"><a href="#1-é…ç½®æ–‡ä»¶æ–¹å¼" class="headerlink" title="1)é…ç½®æ–‡ä»¶æ–¹å¼"></a>1)é…ç½®æ–‡ä»¶æ–¹å¼</h2><p>åŸºäºé…ç½®æ–‡ä»¶ä¿®æ”¹feignçš„æ—¥å¿—çº§åˆ«å¯ä»¥é’ˆå¯¹å•ä¸ªæœåŠ¡ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">feign:</span>  </span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">config:</span> </span><br><span class="line">      <span class="attr">user-service:</span> <span class="comment"># é’ˆå¯¹æŸä¸ªå¾®æœåŠ¡çš„é…ç½®</span></span><br><span class="line">        <span class="attr">loggerLevel:</span> <span class="string">FULL</span> <span class="comment">#  æ—¥å¿—çº§åˆ« </span></span><br></pre></td></tr></table></figure><p>ä¹Ÿå¯ä»¥é’ˆå¯¹æ‰€æœ‰æœåŠ¡ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">feign:</span>  </span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">config:</span> </span><br><span class="line">      <span class="attr">default:</span> <span class="comment"># è¿™é‡Œç”¨defaultå°±æ˜¯å…¨å±€é…ç½®ï¼Œå¦‚æœæ˜¯å†™æœåŠ¡åç§°ï¼Œåˆ™æ˜¯é’ˆå¯¹æŸä¸ªå¾®æœåŠ¡çš„é…ç½®</span></span><br><span class="line">        <span class="attr">loggerLevel:</span> <span class="string">FULL</span> <span class="comment">#  æ—¥å¿—çº§åˆ« </span></span><br></pre></td></tr></table></figure><p>è€Œæ—¥å¿—çš„çº§åˆ«åˆ†ä¸ºå››ç§ï¼š</p><ul><li>NONEï¼šä¸è®°å½•ä»»ä½•æ—¥å¿—ä¿¡æ¯ï¼Œè¿™æ˜¯é»˜è®¤å€¼ã€‚</li><li>BASICï¼šä»…è®°å½•è¯·æ±‚çš„æ–¹æ³•ï¼ŒURL ä»¥åŠå“åº”çŠ¶æ€ç å’Œæ‰§è¡Œæ—¶é—´</li><li>HEADERSï¼šåœ¨ BASIC çš„åŸºç¡€ä¸Šï¼Œé¢å¤–è®°å½•äº†è¯·æ±‚å’Œå“åº”çš„å¤´ä¿¡æ¯</li><li>FULLï¼šè®°å½•æ‰€æœ‰è¯·æ±‚å’Œå“åº”çš„æ˜ç»†ï¼ŒåŒ…æ‹¬å¤´ä¿¡æ¯ã€è¯·æ±‚ä½“ã€å…ƒæ•°æ®ã€‚</li></ul><h2 id="2-Javaä»£ç æ–¹å¼"><a href="#2-Javaä»£ç æ–¹å¼" class="headerlink" title="2)Javaä»£ç æ–¹å¼"></a>2)Javaä»£ç æ–¹å¼</h2><p>ä¹Ÿå¯ä»¥åŸºäº Java ä»£ç æ¥ä¿®æ”¹æ—¥å¿—çº§åˆ«ï¼Œå…ˆå£°æ˜ä¸€ä¸ªç±»ï¼Œç„¶åå£°æ˜ä¸€ä¸ª Logger.Level çš„å¯¹è±¡ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DefaultFeignConfiguration</span>  &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Logger.Level <span class="title function_">feignLogLevel</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Logger.Level.BASIC; <span class="comment">// æ—¥å¿—çº§åˆ«ä¸ºBASIC</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœè¦<strong>å…¨å±€ç”Ÿæ•ˆ</strong>ï¼Œå°†å…¶æ”¾åˆ°å¯åŠ¨ç±»çš„ @EnableFeignClients è¿™ä¸ªæ³¨è§£ä¸­ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableFeignClients(defaultConfiguration = DefaultFeignConfiguration .class)</span> </span><br></pre></td></tr></table></figure><p>å¦‚æœæ˜¯<strong>å±€éƒ¨ç”Ÿæ•ˆ</strong>ï¼Œåˆ™æŠŠå®ƒæ”¾åˆ°å¯¹åº”çš„ @FeignClient è¿™ä¸ªæ³¨è§£ä¸­ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@FeignClient(value = &quot;userservice&quot;, configuration = DefaultFeignConfiguration .class)</span> </span><br></pre></td></tr></table></figure><h1 id="OpenFeignä½¿ç”¨ä¼˜åŒ–"><a href="#OpenFeignä½¿ç”¨ä¼˜åŒ–" class="headerlink" title="OpenFeignä½¿ç”¨ä¼˜åŒ–"></a>OpenFeignä½¿ç”¨ä¼˜åŒ–</h1><p>OpenFeign åº•å±‚å‘èµ· http è¯·æ±‚ï¼Œä¾èµ–äºå…¶å®ƒçš„æ¡†æ¶ã€‚å…¶åº•å±‚å®¢æˆ·ç«¯å®ç°åŒ…æ‹¬ï¼š</p><p>â€¢URLConnectionï¼šé»˜è®¤å®ç°ï¼Œä¸æ”¯æŒè¿æ¥æ± </p><p>â€¢Apache HttpClient ï¼šæ”¯æŒè¿æ¥æ± </p><p>â€¢OKHttpï¼šæ”¯æŒè¿æ¥æ± </p><p>å› æ­¤æé«˜ Feign çš„æ€§èƒ½ä¸»è¦æ‰‹æ®µå°±æ˜¯ä½¿ç”¨<strong>è¿æ¥æ± </strong>ä»£æ›¿é»˜è®¤çš„ URLConnectionã€‚</p><p>è¿™é‡Œæˆ‘ä»¬ç”¨ Apache çš„ HttpClient æ¥æ¼”ç¤ºã€‚</p><p>1ï¼‰å¼•å…¥ä¾èµ–</p><p>åœ¨order-serviceçš„pomæ–‡ä»¶ä¸­å¼•å…¥Apacheçš„HttpClientä¾èµ–ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--httpClientçš„ä¾èµ– --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.github.openfeign<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>feign-httpclient<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>2ï¼‰é…ç½®è¿æ¥æ± </p><p>åœ¨ order-service çš„ application.yml ä¸­æ·»åŠ é…ç½®ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">feign:</span></span><br><span class="line">  <span class="attr">httpclient:</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">true</span> <span class="comment"># å¼€å¯feignå¯¹HttpClientçš„æ”¯æŒ</span></span><br><span class="line">    <span class="attr">max-connections:</span> <span class="number">200</span> <span class="comment"># æœ€å¤§çš„è¿æ¥æ•°</span></span><br><span class="line">    <span class="attr">max-connections-per-route:</span> <span class="number">50</span> <span class="comment"># æ¯ä¸ªè·¯å¾„çš„æœ€å¤§è¿æ¥æ•°</span></span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥ï¼Œåœ¨ FeignClientFactoryBean ä¸­çš„ loadBalance æ–¹æ³•ä¸­æ‰“æ–­ç‚¹ï¼š</p><p><img src="http://cdn.leesin.fun/typora/s3/img/image-20210714185925910.png" alt="image-20210714185925910"></p><p>Debug æ–¹å¼å¯åŠ¨ order-service æœåŠ¡ï¼Œå¯ä»¥çœ‹åˆ°è¿™é‡Œçš„ clientï¼Œåº•å±‚å°±æ˜¯ Apache HttpClientï¼š</p><p><img src="http://cdn.leesin.fun/typora/s3/img/image-20210714190041542.png" alt="image-20210714190041542"></p>]]></content>
      
      
      <categories>
          
          <category> åç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> clound </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>nacosåŸºç¡€çŸ¥è¯†</title>
      <link href="/post/37.html"/>
      <url>/post/37.html</url>
      
        <content type="html"><![CDATA[<h1 id="nacosæ³¨å†Œå‘ç°ä¸­å¿ƒ"><a href="#nacosæ³¨å†Œå‘ç°ä¸­å¿ƒ" class="headerlink" title="nacosæ³¨å†Œå‘ç°ä¸­å¿ƒ"></a>nacosæ³¨å†Œå‘ç°ä¸­å¿ƒ</h1><h2 id="å¯¼å…¥åæ ‡ä¸é…ç½®"><a href="#å¯¼å…¥åæ ‡ä¸é…ç½®" class="headerlink" title="å¯¼å…¥åæ ‡ä¸é…ç½®"></a>å¯¼å…¥åæ ‡ä¸é…ç½®</h2><p>åœ¨çˆ¶å·¥ç¨‹çš„ pom æ–‡ä»¶ä¸­çš„ <code>&lt;dependencyManagement&gt;</code> ä¸­å¼•å…¥ SpringCloudAlibaba çš„ä¾èµ–ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-alibaba-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.6.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>åœ¨å­å·¥ç¨‹ä¸­çš„ pom æ–‡ä»¶ä¸­å¼•å…¥ nacos <strong>æ³¨å†Œå‘ç°ä¸­å¿ƒ</strong>ä¾èµ–ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- nacos æ³¨å†Œå‘ç°ä¸­å¿ƒ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>æ³¨å†Œå‘ç°ä¸­å¿ƒé…ç½®</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">server-addr:</span> <span class="string">localhost:8848</span></span><br></pre></td></tr></table></figure><blockquote><p>å¦‚æœçˆ¶å·¥ç¨‹pomçˆ†çº¢äº†ï¼Œä¸è¦æ…Œï¼Œè¿‡ä¸€æ®µæ—¶é—´å†åˆ·æ–°ï¼Œå¯èƒ½æ˜¯ç½‘ç»œé—®é¢˜æˆ–è€…æ˜¯é•œåƒæºçš„é—®é¢˜ã€‚</p></blockquote><h2 id="æœåŠ¡é›†ç¾¤çš„ä½¿ç”¨â­"><a href="#æœåŠ¡é›†ç¾¤çš„ä½¿ç”¨â­" class="headerlink" title="æœåŠ¡é›†ç¾¤çš„ä½¿ç”¨â­"></a>æœåŠ¡é›†ç¾¤çš„ä½¿ç”¨â­</h2><blockquote><p>order-service æ˜¯æœåŠ¡è°ƒç”¨æ–¹ï¼Œuser-service æ˜¯æœåŠ¡æä¾›æ–¹ã€‚</p><p>order-service ===&gt; â€œSZâ€ é›†ç¾¤</p><p>user-service1  ===&gt; â€œSZâ€ é›†ç¾¤</p><p>user-service2  ===&gt; â€œSZâ€ é›†ç¾¤</p><p>user-service3  ===&gt; â€œHZâ€ é›†ç¾¤</p></blockquote><p>é…ç½® order-service å’Œ user-service1 å’Œ user-service2 ä¸º â€œSZâ€ é›†ç¾¤</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">cluster-name:</span> <span class="string">SZ</span> <span class="comment"># é›†ç¾¤åç§°</span></span><br></pre></td></tr></table></figure><p>é…ç½® user-service3 ä¸º â€œHZâ€  é›†ç¾¤</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">cluster-name:</span> <span class="string">HZ</span> <span class="comment"># é›†ç¾¤åç§°</span></span><br></pre></td></tr></table></figure><p>åœ¨nacos ä¸ŠæŸ¥çœ‹ user-service çš„ 3 ä¸ªå®ä¾‹é›†ç¾¤åˆ†å¸ƒ</p><p><img src="http://cdn.leesin.fun/typora/s3/img/image-20230528123913533.png" alt="image-20230528123913533"></p><h3 id="åŒé›†ç¾¤ä¼˜å…ˆçš„è´Ÿè½½å‡è¡¡"><a href="#åŒé›†ç¾¤ä¼˜å…ˆçš„è´Ÿè½½å‡è¡¡" class="headerlink" title="åŒé›†ç¾¤ä¼˜å…ˆçš„è´Ÿè½½å‡è¡¡"></a>åŒé›†ç¾¤ä¼˜å…ˆçš„è´Ÿè½½å‡è¡¡</h3><p>é»˜è®¤çš„ <code>ZoneAvoidanceRule</code> å¹¶ä¸èƒ½å®ç°æ ¹æ®åŒé›†ç¾¤ä¼˜å…ˆæ¥å®ç°è´Ÿè½½å‡è¡¡</p><p>æ‰€ä»¥åœ¨ä¸Šé¢çš„é…ç½®ä¸‹ï¼Œorder-service çš„è¯·æ±‚ä»ç„¶æ˜¯è½®è¯¢æ‰“åˆ° 3 ä¸ª user-service å®ä¾‹ä¸Š</p><p>å› æ­¤ Nacos ä¸­æä¾›äº†ä¸€ä¸ª <code>NacosRule</code> çš„å®ç°ï¼Œå¯ä»¥ä¼˜å…ˆä»åŒé›†ç¾¤ä¸­æŒ‘é€‰å®ä¾‹ã€‚</p><p>åœ¨æœåŠ¡è°ƒç”¨æ–¹ order-service ä¸­é…ç½® nacos çš„è´Ÿè½½å‡è¡¡è§„åˆ™ã€‚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">userservice:</span></span><br><span class="line">  <span class="attr">ribbon:</span></span><br><span class="line">    <span class="attr">NFLoadBalancerRuleClassName:</span> <span class="string">com.alibaba.cloud.nacos.ribbon.NacosRule</span> <span class="comment"># è´Ÿè½½å‡è¡¡è§„åˆ™ </span></span><br></pre></td></tr></table></figure><blockquote><p>ä¹Ÿå¯é…ç½®å…¨å±€çš„è´Ÿè½½å‡è¡¡è§„åˆ™ï¼Œè¯¦æƒ…å‚è§ <a href="https://leesin9527.github.io/post/36.html">https://leesin9527.github.io/post/36.html</a></p></blockquote><p>é‡å¯ order-service æœåŠ¡å¹¶æµ‹è¯•ï¼Œæœ€ç»ˆä½äº â€œSZâ€ é›†ç¾¤çš„ order-service çš„å®ä¾‹ï¼Œè¯·æ±‚ä¼šåœ¨ ä½äº â€œSZâ€ é›†ç¾¤çš„ä¸¤ä¸ª user-service å®ä¾‹ä¸Š <strong>éšæœºè´Ÿè½½å‡è¡¡</strong> ï¼Œè€Œä¸ä¼šè®¿é—®åˆ° â€œHZâ€ çš„ user-service å®ä¾‹ã€‚</p><p>å¦‚æœæ­¤æ—¶æŠŠ â€œSZâ€ çš„ä¸¤ä¸ªæœåŠ¡å®ä¾‹åœæ‰ï¼Œæ–°è¯·æ±‚å°±åªèƒ½æ‰“åˆ° â€œHZâ€ çš„å®ä¾‹ä¸Šäº†ï¼Œæ­¤æ—¶æ§åˆ¶å°ä¼šæ‰“å°ä¸€ä¸ªè­¦å‘Š <code>A cross-cluster call occurs...</code></p><h2 id="æƒé‡é…ç½®"><a href="#æƒé‡é…ç½®" class="headerlink" title="æƒé‡é…ç½®"></a>æƒé‡é…ç½®</h2><p>åœ¨nacosæ§åˆ¶å°ï¼Œæ‰¾åˆ°user-serviceçš„å®ä¾‹åˆ—è¡¨ï¼Œç‚¹å‡»ç¼–è¾‘ï¼Œå³å¯ä¿®æ”¹æƒé‡ï¼š</p><p><img src="http://cdn.leesin.fun/typora/s3/img/image-20210713235133225.png" alt="image-20210713235133225"></p><blockquote><p><strong>æ³¨æ„</strong>ï¼šå¦‚æœæƒé‡ä¿®æ”¹ä¸º0ï¼Œåˆ™è¯¥å®ä¾‹æ°¸è¿œä¸ä¼šè¢«è®¿é—®ã€‚</p><p>â€‹    ==<strong>å¯ä»¥å®ç°åˆ†æ‰¹ä¸Šçº¿åŠŸèƒ½</strong>==</p></blockquote><h2 id="ç¯å¢ƒéš”ç¦»"><a href="#ç¯å¢ƒéš”ç¦»" class="headerlink" title="ç¯å¢ƒéš”ç¦»"></a>ç¯å¢ƒéš”ç¦»</h2><p>Nacos æä¾›äº† namespace æ¥å®ç°ç¯å¢ƒéš”ç¦»åŠŸèƒ½ã€‚</p><ul><li>nacos ä¸­å¯ä»¥æœ‰å¤šä¸ª namespace</li><li>namespace ä¸‹å¯ä»¥æœ‰ groupã€service ç­‰</li><li>ä¸åŒ namespace ä¹‹é—´ç›¸äº’éš”ç¦»ï¼Œä¾‹å¦‚ä¸åŒ namespace çš„æœåŠ¡äº’ç›¸ä¸å¯è§</li></ul><h3 id="åˆ›å»ºnamespace"><a href="#åˆ›å»ºnamespace" class="headerlink" title="åˆ›å»ºnamespace"></a>åˆ›å»ºnamespace</h3><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œæ‰€æœ‰serviceã€dataã€groupéƒ½åœ¨åŒä¸€ä¸ªnamespaceï¼Œåä¸ºpublicï¼š</p><p><img src="http://cdn.leesin.fun/typora/s3/img/image-20210714000414781.png" alt="image-20210714000414781"></p><p>æˆ‘ä»¬å¯ä»¥ç‚¹å‡»é¡µé¢æ–°å¢æŒ‰é’®ï¼Œæ·»åŠ ä¸€ä¸ªnamespaceï¼š</p><p><img src="http://cdn.leesin.fun/typora/s3/img/image-20210714000440143.png" alt="image-20210714000440143"></p><p>ç„¶åï¼Œå¡«å†™è¡¨å•ï¼š</p><p><img src="http://cdn.leesin.fun/typora/s3/img/image-20210714000505928.png" alt="image-20210714000505928"></p><p>å°±èƒ½åœ¨é¡µé¢çœ‹åˆ°ä¸€ä¸ªæ–°çš„namespaceï¼š</p><p><img src="http://cdn.leesin.fun/typora/s3/img/image-20210714000522913.png" alt="image-20210714000522913"></p><h3 id="ç»™å¾®æœåŠ¡é…ç½®namespace"><a href="#ç»™å¾®æœåŠ¡é…ç½®namespace" class="headerlink" title="ç»™å¾®æœåŠ¡é…ç½®namespace"></a>ç»™å¾®æœåŠ¡é…ç½®namespace</h3><p>ç»™å¾®æœåŠ¡é…ç½®namespaceåªèƒ½é€šè¿‡ä¿®æ”¹é…ç½®æ¥å®ç°ã€‚</p><p>ä¾‹å¦‚ï¼Œä¿®æ”¹order-serviceçš„application.ymlæ–‡ä»¶ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">server-addr:</span> <span class="string">localhost:8848</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">cluster-name:</span> <span class="string">HZ</span></span><br><span class="line">        <span class="attr">namespace:</span> <span class="string">492a7d5d-237b-46a1-a99a-fa8e98e4b0f9</span> <span class="comment"># å‘½åç©ºé—´ï¼Œå¡«ID</span></span><br></pre></td></tr></table></figure><p>é‡å¯order-serviceåï¼Œè®¿é—®æ§åˆ¶å°ï¼Œå¯ä»¥çœ‹åˆ°ä¸‹é¢çš„ç»“æœï¼š</p><p><img src="http://cdn.leesin.fun/typora/s3/img/image-20210714000830703.png" alt="image-20210714000830703"></p><p><img src="http://cdn.leesin.fun/typora/s3/img/image-20210714000837140.png" alt="image-20210714000837140"></p><p>æ­¤æ—¶è®¿é—® order-serviceï¼Œå› ä¸º namespace ä¸åŒï¼Œä¼šå¯¼è‡´æ‰¾ä¸åˆ° user-serviceï¼Œæ§åˆ¶å°ä¼šæŠ¥é”™ï¼š</p><p><img src="http://cdn.leesin.fun/typora/s3/img/image-20210714000941256.png" alt="image-20210714000941256"></p><blockquote><p><strong>æ³¨æ„ï¼š</strong>å®é™…å·¥ä½œä¸­ï¼Œonlineã€devã€test ç¯å¢ƒæ˜¯åˆ†å¼€çš„ï¼Œåˆ†åˆ«æœ‰è‡ªå·±çš„ nacosã€‚</p></blockquote><h2 id="nacosä¸´æ—¶å®ä¾‹ï¼ˆå»ºè®®ä¸è¦æ”¹ï¼‰"><a href="#nacosä¸´æ—¶å®ä¾‹ï¼ˆå»ºè®®ä¸è¦æ”¹ï¼‰" class="headerlink" title="nacosä¸´æ—¶å®ä¾‹ï¼ˆå»ºè®®ä¸è¦æ”¹ï¼‰"></a>nacosä¸´æ—¶å®ä¾‹ï¼ˆå»ºè®®ä¸è¦æ”¹ï¼‰</h2><p>Nacosçš„æœåŠ¡å®ä¾‹åˆ†ä¸ºä¸¤ç§ç±»å‹ï¼š</p><ul><li><p>ä¸´æ—¶å®ä¾‹ï¼šå¦‚æœå®ä¾‹å®•æœºè¶…è¿‡ä¸€å®šæ—¶é—´ï¼Œä¼šä»æœåŠ¡åˆ—è¡¨å‰”é™¤ï¼Œ<strong>é»˜è®¤çš„ç±»å‹</strong>ã€‚</p></li><li><p>éä¸´æ—¶å®ä¾‹ï¼šå¦‚æœå®ä¾‹å®•æœºï¼Œä¸ä¼šä»æœåŠ¡åˆ—è¡¨å‰”é™¤ï¼Œä¹Ÿå¯ä»¥å«æ°¸ä¹…å®ä¾‹ã€‚</p></li></ul><p>é…ç½®ä¸€ä¸ªæœåŠ¡å®ä¾‹ä¸ºæ°¸ä¹…å®ä¾‹ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">ephemeral:</span> <span class="literal">false</span> <span class="comment"># è®¾ç½®ä¸ºéä¸´æ—¶å®ä¾‹</span></span><br></pre></td></tr></table></figure><blockquote><p>é¦–å…ˆéœ€è¦äº†è§£çš„èƒŒæ™¯æ˜¯ï¼šå½“ä¸€ä¸ª<strong>ä»¥å‰æ˜¯</strong>ä¸´æ—¶å®ä¾‹çš„å®ä¾‹ï¼Œç›´æ¥ä¿®æ”¹ä¸ºéä¸´æ—¶å®ä¾‹ï¼Œåœ¨ nacos ä¸­ï¼Œæ˜¯<strong>ä¸å…è®¸</strong>çš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œnacos å‘ç°ä½ çš„è¿™äº› ip å’Œç«¯å£ä¿¡æ¯ä»€ä¹ˆéƒ½å’Œä»¥å‰ä¸€æ ·ï¼Œç°åœ¨æƒ³ç›´æ¥æ³¨å†Œä¸ºéä¸´æ—¶å®ä¾‹ï¼š</p><p>nacosï¼šæ¬¸ä½ ä»¥å‰æ˜¯ä¸´æ—¶å®ä¾‹ï¼Œä¸ç»™è¿›ä¸ç»™è¿›ï¼ï¼ˆå½“åœºæŠ“è·ï¼‰</p></blockquote><p>æ­¤æ—¶çš„è§£å†³æ–¹æ³•ï¼š</p><p>1.åœæ‰nacos</p><p>2.æ‰¾åˆ°ä½ åœ¨ä¸´æ—¶å®ä¾‹ä¸‹çš„å‰ç§‘è®°å½•ï¼Œå°†å…¶é”€æ¯â€”â€”æ¥åˆ° nacos ç›®å½•ä¸‹ \data\protocol\raftï¼Œé‡Œé¢æœ‰ä½ åº”ç”¨å®ä¾‹çš„å…ƒæ•°æ®ä¿¡æ¯ï¼Œåƒ</p><p><img src="https://pic3.zhimg.com/80/v2-4a530fa2b50eca226e62b1e126deadf2_720w.webp" alt="img"></p><p>å°†è¿™é‡Œçš„æ–‡ä»¶æ¸…ç©º</p><p>3.é‡å¯ nacos å’Œåº”ç”¨</p><blockquote><p>è§£å†³åŠæ³•å‡ºå¤„ï¼š<a href="https://zhuanlan.zhihu.com/p/571875080">https://zhuanlan.zhihu.com/p/571875080</a></p></blockquote><h2 id="Nacosä¸Eurekaçš„åŒºåˆ«"><a href="#Nacosä¸Eurekaçš„åŒºåˆ«" class="headerlink" title="Nacosä¸Eurekaçš„åŒºåˆ«"></a>Nacosä¸Eurekaçš„åŒºåˆ«</h2><p>Nacoså’ŒEurekaæ•´ä½“ç»“æ„ç±»ä¼¼ï¼ŒæœåŠ¡æ³¨å†Œã€æœåŠ¡æ‹‰å–ã€å¿ƒè·³ç­‰å¾…ï¼Œä½†æ˜¯ä¹Ÿå­˜åœ¨ä¸€äº›å·®å¼‚ï¼š</p><p><img src="http://cdn.leesin.fun/typora/s3/img/image-20210714001728017.png" alt="image-20210714001728017"></p><ul><li><p>Nacosä¸eurekaçš„å…±åŒç‚¹</p><ul><li>éƒ½æ”¯æŒæœåŠ¡æ³¨å†Œå’ŒæœåŠ¡æ‹‰å–</li><li>éƒ½æ”¯æŒæœåŠ¡æä¾›è€…å¿ƒè·³æ–¹å¼åšå¥åº·æ£€æµ‹</li></ul></li><li><p>Nacosä¸Eurekaçš„åŒºåˆ«</p><ul><li>Nacosæ”¯æŒæœåŠ¡ç«¯ä¸»åŠ¨æ£€æµ‹æä¾›è€…çŠ¶æ€ï¼šä¸´æ—¶å®ä¾‹é‡‡ç”¨å¿ƒè·³æ¨¡å¼ï¼Œéä¸´æ—¶å®ä¾‹é‡‡ç”¨ä¸»åŠ¨æ£€æµ‹æ¨¡å¼</li><li>ä¸´æ—¶å®ä¾‹å¿ƒè·³ä¸æ­£å¸¸ä¼šè¢«å‰”é™¤ï¼Œéä¸´æ—¶å®ä¾‹åˆ™ä¸ä¼šè¢«å‰”é™¤</li><li>Nacosæ”¯æŒæœåŠ¡åˆ—è¡¨å˜æ›´çš„æ¶ˆæ¯æ¨é€æ¨¡å¼ï¼ŒæœåŠ¡åˆ—è¡¨æ›´æ–°æ›´åŠæ—¶</li><li>==<strong>Nacosé›†ç¾¤é»˜è®¤é‡‡ç”¨APæ–¹å¼ï¼Œå½“é›†ç¾¤ä¸­å­˜åœ¨éä¸´æ—¶å®ä¾‹æ—¶ï¼Œé‡‡ç”¨CPæ¨¡å¼ï¼›Eurekaé‡‡ç”¨APæ–¹å¼</strong>==</li></ul></li></ul><h1 id="nacosé…ç½®ä¸­å¿ƒ"><a href="#nacosé…ç½®ä¸­å¿ƒ" class="headerlink" title="nacosé…ç½®ä¸­å¿ƒ"></a>nacosé…ç½®ä¸­å¿ƒ</h1><h2 id="å¯¼å…¥åæ ‡ä¸é…ç½®-1"><a href="#å¯¼å…¥åæ ‡ä¸é…ç½®-1" class="headerlink" title="å¯¼å…¥åæ ‡ä¸é…ç½®"></a>å¯¼å…¥åæ ‡ä¸é…ç½®</h2><p>åœ¨çˆ¶å·¥ç¨‹çš„ pom æ–‡ä»¶ä¸­çš„ <code>&lt;dependencyManagement&gt;</code> ä¸­å¼•å…¥ SpringCloudAlibaba çš„ä¾èµ–ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-alibaba-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.6.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>åœ¨å­å·¥ç¨‹ä¸­çš„ pom æ–‡ä»¶ä¸­å¼•å…¥ nacos <strong>é…ç½®ä¸­å¿ƒ</strong>ä¾èµ–ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--nacosé…ç½®ç®¡ç†ä¾èµ–--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-config<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>é…ç½®ä¸­å¿ƒé…ç½®ï¼Œåœ¨bootstrap.ymlä¸­é…ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">user-service</span> <span class="comment"># æœåŠ¡åç§°</span></span><br><span class="line">  <span class="attr">profiles:</span></span><br><span class="line">    <span class="attr">active:</span> <span class="string">online</span> <span class="comment"># çº¿ä¸Šç¯å¢ƒ</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">server-addr:</span> <span class="string">localhost:8848</span> <span class="comment"># Nacosåœ°å€</span></span><br><span class="line">      <span class="attr">config:</span></span><br><span class="line">        <span class="attr">file-extension:</span> <span class="string">yaml</span> <span class="comment"># æ–‡ä»¶åç¼€å</span></span><br></pre></td></tr></table></figure><p>è¿™é‡Œä¼šæ ¹æ®spring.cloud.nacos.server-addrè·å–nacosåœ°å€ï¼Œå†æ ¹æ®</p><p><code>$&#123;spring.application.name&#125;-$&#123;spring.profiles.active&#125;.$&#123;spring.cloud.nacos.config.file-extension&#125;</code>ä½œä¸ºæ–‡ä»¶idï¼Œæ¥è¯»å–é…ç½®ã€‚</p><p>æœ¬ä¾‹ä¸­ï¼Œå°±æ˜¯å»è¯»å–<code>user-service-online.yaml</code></p><p>ç„¶ååœ¨ nacos ä¸Šæ–°å¢ç›¸åº”çš„é…ç½®æ–‡ä»¶å³å¯ï¼š</p><p><img src="http://cdn.leesin.fun/typora/s3/img/image-20230528162525366.png" alt="image-20230528162525366"></p><p>ç¼–å†™æµ‹è¯•æ¥å£å¹¶æµ‹è¯•æˆåŠŸï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;pattern.dateformat&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String dateformat;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@GetMapping(&quot;now&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">now</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> LocalDateTime.now().format(DateTimeFormatter.ofPattern(dateformat));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="é…ç½®æ–‡ä»¶åŠ è½½é¡ºåºâ­"><a href="#é…ç½®æ–‡ä»¶åŠ è½½é¡ºåºâ­" class="headerlink" title="é…ç½®æ–‡ä»¶åŠ è½½é¡ºåºâ­"></a>é…ç½®æ–‡ä»¶åŠ è½½é¡ºåºâ­</h2><p>å¾®æœåŠ¡è¦æ‹‰å– nacos ä¸­ç®¡ç†çš„é…ç½®ï¼Œå¹¶ä¸”ä¸æœ¬åœ°çš„ application.yml é…ç½®åˆå¹¶ï¼Œæ‰èƒ½å®Œæˆé¡¹ç›®å¯åŠ¨ã€‚</p><p>ä½†å¦‚æœå°šæœªè¯»å– application.ymlï¼Œåˆå¦‚ä½•å¾—çŸ¥ nacos åœ°å€å‘¢ï¼Ÿ</p><p>å› æ­¤ spring å¼•å…¥äº†ä¸€ç§æ–°çš„é…ç½®æ–‡ä»¶ï¼šbootstrap.yaml æ–‡ä»¶ï¼Œä¼šåœ¨ application.yml ä¹‹å‰è¢«è¯»å–ï¼Œæµç¨‹å¦‚ä¸‹ï¼š</p><p><img src="http://cdn.leesin.fun/typora/s3/img/L0iFYNF.png" alt="img"></p><h2 id="é…ç½®çƒ­æ›´æ–°â­"><a href="#é…ç½®çƒ­æ›´æ–°â­" class="headerlink" title="é…ç½®çƒ­æ›´æ–°â­"></a>é…ç½®çƒ­æ›´æ–°â­</h2><p>æˆ‘ä»¬æœ€ç»ˆçš„ç›®çš„ï¼Œæ˜¯ä¿®æ”¹nacosä¸­çš„é…ç½®åï¼Œå¾®æœåŠ¡ä¸­æ— éœ€é‡å¯å³å¯è®©é…ç½®ç”Ÿæ•ˆï¼Œä¹Ÿå°±æ˜¯<strong>é…ç½®çƒ­æ›´æ–°</strong>ã€‚</p><p>è¦å®ç°é…ç½®çƒ­æ›´æ–°ï¼Œå¯ä»¥ä½¿ç”¨ä¸¤ç§æ–¹å¼ï¼š</p><h3 id="æ–¹å¼ä¸€"><a href="#æ–¹å¼ä¸€" class="headerlink" title="æ–¹å¼ä¸€"></a>æ–¹å¼ä¸€</h3><p>åœ¨ @Value æ³¨å…¥çš„å˜é‡æ‰€åœ¨ç±»ä¸Šæ·»åŠ æ³¨è§£ <code>@RefreshScope</code>ï¼š</p><p><img src="http://cdn.leesin.fun/typora/s3/img/image-20210714171036335.png" alt="image-20210714171036335"></p><h3 id="æ–¹å¼äºŒ"><a href="#æ–¹å¼äºŒ" class="headerlink" title="æ–¹å¼äºŒ"></a>æ–¹å¼äºŒ</h3><p>ä½¿ç”¨ <code>@ConfigurationProperties</code> æ³¨è§£ã€‚</p><p>åœ¨ user-service æœåŠ¡ä¸­ï¼Œæ·»åŠ ä¸€ä¸ªç±»ï¼Œè¯»å– patterrn.dateformat å±æ€§ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;pattern&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PatternProperties</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String dateformat;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ UserController ä¸­ä½¿ç”¨è¿™ä¸ªç±»ä»£æ›¿ @Valueï¼š</p><p><img src="http://cdn.leesin.fun/typora/s3/img/image-20210714171316124.png" alt="image-20210714171316124"></p><h2 id="é…ç½®å…±äº«"><a href="#é…ç½®å…±äº«" class="headerlink" title="é…ç½®å…±äº«"></a>é…ç½®å…±äº«</h2><p>å…¶å®å¾®æœåŠ¡å¯åŠ¨æ—¶ï¼Œä¼šå» nacos è¯»å–å¤šä¸ªé…ç½®æ–‡ä»¶ï¼Œä¾‹å¦‚ï¼š</p><ul><li><p><code>[spring.application.name]-[spring.profiles.active].yaml</code>ï¼Œä¾‹å¦‚ï¼šuser-service-dev.yaml</p></li><li><p><code>[spring.application.name].yaml</code>ï¼Œä¾‹å¦‚ï¼šuser-service.yaml</p></li></ul><p>è€Œ<code>[spring.application.name].yaml</code>ä¸åŒ…å«ç¯å¢ƒï¼Œå› æ­¤å¯ä»¥è¢«å¤šä¸ªç¯å¢ƒå…±äº«ã€‚</p><blockquote><p><strong>æ³¨æ„ï¼š</strong>å®é™…å·¥ä½œä¸­ï¼Œonlineã€devã€test ç¯å¢ƒæ˜¯åˆ†å¼€çš„ï¼Œåˆ†åˆ«æœ‰è‡ªå·±çš„ nacosã€‚æ‰€ä»¥é€šå¸¸ä¸€ä¸ªæœåŠ¡åªæœ‰ä¸€ä¸ª nacos é…ç½®æ–‡ä»¶ï¼Œå¦‚ user-service.yaml</p></blockquote><h2 id="é…ç½®å…±äº«çš„ä¼˜å…ˆçº§"><a href="#é…ç½®å…±äº«çš„ä¼˜å…ˆçº§" class="headerlink" title="é…ç½®å…±äº«çš„ä¼˜å…ˆçº§"></a>é…ç½®å…±äº«çš„ä¼˜å…ˆçº§</h2><p>å½“nacosã€æœåŠ¡æœ¬åœ°åŒæ—¶å‡ºç°ç›¸åŒå±æ€§æ—¶ï¼Œä¼˜å…ˆçº§æœ‰é«˜ä½ä¹‹åˆ†ï¼š</p><p><img src="http://cdn.leesin.fun/typora/s3/img/image-20210714174623557.png" alt="image-20210714174623557"></p>]]></content>
      
      
      <categories>
          
          <category> åç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> clound </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ribbonåŸºç¡€çŸ¥è¯†</title>
      <link href="/post/36.html"/>
      <url>/post/36.html</url>
      
        <content type="html"><![CDATA[<h1 id="1-ç¯å¢ƒ"><a href="#1-ç¯å¢ƒ" class="headerlink" title="1.ç¯å¢ƒ"></a>1.ç¯å¢ƒ</h1><h2 id="order-serviceæ¨¡å—"><a href="#order-serviceæ¨¡å—" class="headerlink" title="order-serviceæ¨¡å—"></a>order-serviceæ¨¡å—</h2><p>ç»™ restTemplate åŠ ä¸Š <code>@LoadBalanced</code> æ³¨è§£</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RestConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@LoadBalanced</span></span><br><span class="line">    <span class="keyword">public</span> RestTemplate <span class="title function_">restTemplate</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RestTemplate</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>order-service æ¨¡å—è°ƒç”¨ user-service æ¨¡å—å°±èƒ½å®ç°è´Ÿè½½å‡è¡¡</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> OrderMapper orderMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RestTemplate restTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Order <span class="title function_">queryOrderById</span><span class="params">(Long orderId)</span> &#123;</span><br><span class="line">        <span class="type">Order</span> <span class="variable">order</span> <span class="operator">=</span> orderMapper.selectById(orderId);</span><br><span class="line">        <span class="comment">// String url = &quot;http://localhost:8081/user/&quot; + order.getUserId();</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> <span class="string">&quot;http://user-service/user/&quot;</span> + order.getUserId();</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> restTemplate.getForObject(url, User.class);</span><br><span class="line">        order.setUser(user);</span><br><span class="line">        <span class="keyword">return</span> order;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»¥ä¸‹é»˜è®¤ order-service æ˜¯æœåŠ¡è°ƒç”¨æ–¹ï¼Œuser-service æ˜¯æœåŠ¡æä¾›æ–¹</p><h1 id="2-Ribbonè´Ÿè½½å‡è¡¡åŸç†"><a href="#2-Ribbonè´Ÿè½½å‡è¡¡åŸç†" class="headerlink" title="2.Ribbonè´Ÿè½½å‡è¡¡åŸç†"></a>2.Ribbonè´Ÿè½½å‡è¡¡åŸç†</h1><h2 id="è´Ÿè½½å‡è¡¡åŸç†"><a href="#è´Ÿè½½å‡è¡¡åŸç†" class="headerlink" title="è´Ÿè½½å‡è¡¡åŸç†"></a>è´Ÿè½½å‡è¡¡åŸç†</h2><p>SpringCloud åº•å±‚å…¶å®æ˜¯åˆ©ç”¨äº†ä¸€ä¸ªåä¸º Ribbon çš„ç»„ä»¶ï¼Œæ¥å®ç°è´Ÿè½½å‡è¡¡åŠŸèƒ½çš„ã€‚</p><p><img src="http://cdn.leesin.fun/typora/s3/img/image-20210713224517686.png" alt="image-20210713224517686"></p><p>é‚£ä¹ˆæˆ‘ä»¬å‘å‡ºçš„è¯·æ±‚æ˜æ˜æ˜¯ <a href="http://user-service/user/1ï¼Œæ€ä¹ˆå˜æˆäº†">http://user-service/user/1ï¼Œæ€ä¹ˆå˜æˆäº†</a> <a href="http://localhost:8081">http://localhost:8081</a> çš„å‘¢ï¼Ÿ</p><h2 id="æºç è·Ÿè¸ª"><a href="#æºç è·Ÿè¸ª" class="headerlink" title="æºç è·Ÿè¸ª"></a>æºç è·Ÿè¸ª</h2><p>ä¸ºä»€ä¹ˆåªè¾“å…¥ service åç§°å°±å¯ä»¥è®¿é—®äº†å‘¢ï¼Ÿä¹‹å‰è¿˜è¦è·å– ip å’Œç«¯å£ã€‚</p><p>å…¶å®æ˜¯æœ‰äººå¸®æˆ‘ä»¬æ ¹æ® service åç§°ï¼Œè·å–åˆ°äº†æœåŠ¡å®ä¾‹çš„ ip å’Œç«¯å£ã€‚å®ƒå°±æ˜¯ <code>LoadBalancerInterceptor</code>ï¼Œè¿™ä¸ªç±»ä¼šåœ¨å¯¹ RestTemplate çš„è¯·æ±‚è¿›è¡Œæ‹¦æˆªï¼Œç„¶åä» Eureka æ ¹æ®æœåŠ¡ id è·å–æœåŠ¡åˆ—è¡¨ï¼Œéšååˆ©ç”¨è´Ÿè½½å‡è¡¡ç®—æ³•å¾—åˆ°çœŸå®çš„æœåŠ¡åœ°å€ä¿¡æ¯ï¼Œæ›¿æ¢æœåŠ¡ idã€‚</p><p>æˆ‘ä»¬è¿›è¡Œæºç è·Ÿè¸ªï¼š</p><h3 id="1ï¼‰LoadBalancerIntercepor"><a href="#1ï¼‰LoadBalancerIntercepor" class="headerlink" title="1ï¼‰LoadBalancerIntercepor"></a>1ï¼‰LoadBalancerIntercepor</h3><p><img src="http://cdn.leesin.fun/typora/s3/img/1525620483637.png" alt="1525620483637"></p><p>å¯ä»¥çœ‹åˆ°è¿™é‡Œçš„ intercept æ–¹æ³•ï¼Œæ‹¦æˆªäº†ç”¨æˆ·çš„ HttpRequest è¯·æ±‚ï¼Œç„¶ååšäº†å‡ ä»¶äº‹ï¼š</p><ul><li><code>request.getURI()</code>ï¼šè·å–è¯·æ±‚ uriï¼Œæœ¬ä¾‹ä¸­å°±æ˜¯ <a href="http://user-service/user/8">http://user-service/user/8</a></li><li><code>originalUri.getHost()</code>ï¼šè·å– uri è·¯å¾„çš„ä¸»æœºåï¼Œå…¶å®å°±æ˜¯æœåŠ¡ idï¼Œ<code>user-service</code></li><li><code>this.loadBalancer.execute()</code>ï¼šå¤„ç†æœåŠ¡ idï¼Œå’Œç”¨æˆ·è¯·æ±‚ã€‚</li></ul><p>è¿™é‡Œçš„ <code>this.loadBalancer</code>æ˜¯ <code>LoadBalancerClient</code> ç±»å‹ï¼Œæˆ‘ä»¬ç»§ç»­è·Ÿå…¥ã€‚</p><h3 id="2ï¼‰LoadBalancerClient"><a href="#2ï¼‰LoadBalancerClient" class="headerlink" title="2ï¼‰LoadBalancerClient"></a>2ï¼‰LoadBalancerClient</h3><p>ç»§ç»­è·Ÿå…¥ execute æ–¹æ³•ï¼š</p><p><img src="http://cdn.leesin.fun/typora/s3/img/1525620787090.png" alt="1525620787090"></p><p>ä»£ç æ˜¯è¿™æ ·çš„ï¼š</p><ul><li>getLoadBalancer(serviceId)ï¼šæ ¹æ®æœåŠ¡ id è·å– ILoadBalancerï¼Œä¸”ä¼šæ‹¿ç€ serviceId å» eureka ä¸­è·å–æœåŠ¡åˆ—è¡¨å¹¶ä¿å­˜åˆ° ILoadBalancer ä¸­ã€‚</li></ul><p><img src="http://cdn.leesin.fun/typora/s3/img/Snipaste_2023-05-27_23-15-43.png" alt="Snipaste_2023-05-27_23-15-43"></p><ul><li>getServer(loadBalancer)ï¼šåˆ©ç”¨å†…ç½®çš„è´Ÿè½½å‡è¡¡ç®—æ³•ï¼Œä»æœåŠ¡åˆ—è¡¨ä¸­é€‰æ‹©ä¸€ä¸ªã€‚æœ¬ä¾‹ä¸­ï¼Œå¯ä»¥çœ‹åˆ°è·å–äº†8082ç«¯å£çš„æœåŠ¡</li></ul><p>æ”¾è¡Œåï¼Œå†æ¬¡è®¿é—®å¹¶è·Ÿè¸ªï¼Œå‘ç°è·å–çš„æ˜¯8081ï¼š</p><p> <img src="http://cdn.leesin.fun/typora/s3/img/1525620835911.png" alt="1525620835911"></p><p>æœç„¶å®ç°äº†è´Ÿè½½å‡è¡¡ã€‚</p><h3 id="3ï¼‰è´Ÿè½½å‡è¡¡ç­–ç•¥IRule"><a href="#3ï¼‰è´Ÿè½½å‡è¡¡ç­–ç•¥IRule" class="headerlink" title="3ï¼‰è´Ÿè½½å‡è¡¡ç­–ç•¥IRule"></a>3ï¼‰è´Ÿè½½å‡è¡¡ç­–ç•¥IRule</h3><p>åœ¨åˆšæ‰çš„ä»£ç ä¸­ï¼Œå¯ä»¥çœ‹åˆ°è·å–æœåŠ¡ä½¿é€šè¿‡ä¸€ä¸ª <code>getServer</code> æ–¹æ³•æ¥åšè´Ÿè½½å‡è¡¡:</p><p> <img src="http://cdn.leesin.fun/typora/s3/img/1525620835911.png" alt="1525620835911"></p><p>æˆ‘ä»¬ç»§ç»­è·Ÿå…¥ï¼š</p><p><img src="http://cdn.leesin.fun/typora/s3/img/1544361421671.png" alt="1544361421671"></p><p>ç»§ç»­è·Ÿè¸ªæºç  chooseServer æ–¹æ³•ï¼Œå‘ç°è¿™ä¹ˆä¸€æ®µä»£ç ï¼š</p><p> <img src="http://cdn.leesin.fun/typora/s3/img/1525622652849.png" alt="1525622652849"></p><p>æˆ‘ä»¬çœ‹çœ‹è¿™ä¸ª rule æ˜¯è°ï¼š</p><p> <img src="http://cdn.leesin.fun/typora/s3/img/1525622699666.png" alt="1525622699666"></p><p>è¿™é‡Œçš„ rule é»˜è®¤å€¼æ˜¯ä¸€ä¸ª <code>RoundRobinRule</code>ï¼Œçœ‹ç±»çš„ä»‹ç»ï¼š</p><p> <img src="http://cdn.leesin.fun/typora/s3/img/1525622754316.png" alt="1525622754316"></p><p>è¿™ä¸å°±æ˜¯è½®è¯¢çš„æ„æ€å˜›ã€‚</p><p>åˆ°è¿™é‡Œï¼Œæ•´ä¸ªè´Ÿè½½å‡è¡¡çš„æµç¨‹æˆ‘ä»¬å°±æ¸…æ¥šäº†ã€‚</p><h3 id="4ï¼‰æ€»ç»“"><a href="#4ï¼‰æ€»ç»“" class="headerlink" title="4ï¼‰æ€»ç»“"></a>4ï¼‰æ€»ç»“</h3><p>SpringCloud Ribbon çš„åº•å±‚é‡‡ç”¨äº†ä¸€ä¸ªæ‹¦æˆªå™¨ï¼Œæ‹¦æˆªäº† RestTemplate å‘å‡ºçš„è¯·æ±‚ï¼Œå¯¹åœ°å€åšäº†ä¿®æ”¹ã€‚ç”¨ä¸€å¹…å›¾æ¥æ€»ç»“ä¸€ä¸‹ï¼š</p><p><img src="http://cdn.leesin.fun/typora/s3/img/image-20210713224724673.png" alt="image-20210713224724673"></p><p>åŸºæœ¬æµç¨‹å¦‚ä¸‹ï¼š</p><ul><li>æ‹¦æˆªæˆ‘ä»¬çš„ RestTemplate è¯·æ±‚<a href="http://userservice/user/1">http://userservice/user/1</a></li><li>RibbonLoadBalancerClient ä¼šä»è¯·æ±‚ url ä¸­è·å–æœåŠ¡åç§°ï¼Œä¹Ÿå°±æ˜¯ user-service</li><li>DynamicServerListLoadBalancer æ ¹æ® user-service åˆ° eurekaæ‹‰å–æœåŠ¡åˆ—è¡¨</li><li>eureka è¿”å›åˆ—è¡¨ï¼Œlocalhost:8081ã€localhost:8082</li><li>IRule åˆ©ç”¨å†…ç½®è´Ÿè½½å‡è¡¡è§„åˆ™ï¼Œä»åˆ—è¡¨ä¸­é€‰æ‹©ä¸€ä¸ªï¼Œä¾‹å¦‚ localhost:8081</li><li>RibbonLoadBalancerClient ä¿®æ”¹è¯·æ±‚åœ°å€ï¼Œç”¨ localhost:8081 æ›¿ä»£ userserviceï¼Œå¾—åˆ° <a href="http://localhost:8081/user/1ï¼Œå‘èµ·çœŸå®è¯·æ±‚">http://localhost:8081/user/1ï¼Œå‘èµ·çœŸå®è¯·æ±‚</a></li></ul><h1 id="3-è´Ÿè½½å‡è¡¡ç­–ç•¥"><a href="#3-è´Ÿè½½å‡è¡¡ç­–ç•¥" class="headerlink" title="3.è´Ÿè½½å‡è¡¡ç­–ç•¥"></a>3.è´Ÿè½½å‡è¡¡ç­–ç•¥</h1><h3 id="è´Ÿè½½å‡è¡¡ç­–ç•¥"><a href="#è´Ÿè½½å‡è¡¡ç­–ç•¥" class="headerlink" title="è´Ÿè½½å‡è¡¡ç­–ç•¥"></a>è´Ÿè½½å‡è¡¡ç­–ç•¥</h3><p>è´Ÿè½½å‡è¡¡çš„è§„åˆ™éƒ½å®šä¹‰åœ¨IRuleæ¥å£ä¸­ï¼Œè€ŒIRuleæœ‰å¾ˆå¤šä¸åŒçš„å®ç°ç±»ï¼š</p><p><img src="http://cdn.leesin.fun/typora/s3/img/image-20210713225653000.png" alt="image-20210713225653000"></p><p>ä¸åŒè§„åˆ™çš„å«ä¹‰å¦‚ä¸‹ï¼š</p><div class="table-container"><table><thead><tr><th><strong>å†…ç½®è´Ÿè½½å‡è¡¡è§„åˆ™ç±»</strong></th><th><strong>è§„åˆ™æè¿°</strong></th></tr></thead><tbody><tr><td>RoundRobinRule</td><td>ç®€å•è½®è¯¢æœåŠ¡åˆ—è¡¨æ¥é€‰æ‹©æœåŠ¡å™¨ã€‚å®ƒæ˜¯Ribboné»˜è®¤çš„è´Ÿè½½å‡è¡¡è§„åˆ™ã€‚</td></tr><tr><td>AvailabilityFilteringRule</td><td>å¯¹ä»¥ä¸‹ä¸¤ç§æœåŠ¡å™¨è¿›è¡Œå¿½ç•¥ï¼š   ï¼ˆ1ï¼‰åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œè¿™å°æœåŠ¡å™¨å¦‚æœ3æ¬¡è¿æ¥å¤±è´¥ï¼Œè¿™å°æœåŠ¡å™¨å°±ä¼šè¢«è®¾ç½®ä¸ºâ€œçŸ­è·¯â€çŠ¶æ€ã€‚çŸ­è·¯çŠ¶æ€å°†æŒç»­30ç§’ï¼Œå¦‚æœå†æ¬¡è¿æ¥å¤±è´¥ï¼ŒçŸ­è·¯çš„æŒç»­æ—¶é—´å°±ä¼šå‡ ä½•çº§åœ°å¢åŠ ã€‚  ï¼ˆ2ï¼‰å¹¶å‘æ•°è¿‡é«˜çš„æœåŠ¡å™¨ã€‚å¦‚æœä¸€ä¸ªæœåŠ¡å™¨çš„å¹¶å‘è¿æ¥æ•°è¿‡é«˜ï¼Œé…ç½®äº†AvailabilityFilteringRuleè§„åˆ™çš„å®¢æˆ·ç«¯ä¹Ÿä¼šå°†å…¶å¿½ç•¥ã€‚å¹¶å‘è¿æ¥æ•°çš„ä¸Šé™ï¼Œå¯ä»¥ç”±å®¢æˆ·ç«¯çš„<clientName>.<clientConfigNameSpace>.ActiveConnectionsLimitå±æ€§è¿›è¡Œé…ç½®ã€‚</clientConfigNameSpace></clientName></td></tr><tr><td>WeightedResponseTimeRule</td><td>ä¸ºæ¯ä¸€ä¸ªæœåŠ¡å™¨èµ‹äºˆä¸€ä¸ªæƒé‡å€¼ã€‚æœåŠ¡å™¨å“åº”æ—¶é—´è¶Šé•¿ï¼Œè¿™ä¸ªæœåŠ¡å™¨çš„æƒé‡å°±è¶Šå°ã€‚è¿™ä¸ªè§„åˆ™ä¼šéšæœºé€‰æ‹©æœåŠ¡å™¨ï¼Œè¿™ä¸ªæƒé‡å€¼ä¼šå½±å“æœåŠ¡å™¨çš„é€‰æ‹©ã€‚</td></tr><tr><td><strong>ZoneAvoidanceRule</strong></td><td>ä»¥åŒºåŸŸå¯ç”¨çš„æœåŠ¡å™¨ä¸ºåŸºç¡€è¿›è¡ŒæœåŠ¡å™¨çš„é€‰æ‹©ã€‚ä½¿ç”¨Zoneå¯¹æœåŠ¡å™¨è¿›è¡Œåˆ†ç±»ï¼Œè¿™ä¸ªZoneå¯ä»¥ç†è§£ä¸ºä¸€ä¸ªæœºæˆ¿ã€ä¸€ä¸ªæœºæ¶ç­‰ã€‚è€Œåå†å¯¹Zoneå†…çš„å¤šä¸ªæœåŠ¡åšè½®è¯¢ã€‚</td></tr><tr><td>BestAvailableRule</td><td>å¿½ç•¥é‚£äº›çŸ­è·¯çš„æœåŠ¡å™¨ï¼Œå¹¶é€‰æ‹©å¹¶å‘æ•°è¾ƒä½çš„æœåŠ¡å™¨ã€‚</td></tr><tr><td>RandomRule</td><td>éšæœºé€‰æ‹©ä¸€ä¸ªå¯ç”¨çš„æœåŠ¡å™¨ã€‚</td></tr><tr><td>RetryRule</td><td>é‡è¯•æœºåˆ¶çš„é€‰æ‹©é€»è¾‘</td></tr></tbody></table></div><p>é»˜è®¤çš„å®ç°å°±æ˜¯ ZoneAvoidanceRuleï¼Œæ˜¯ä¸€ç§è½®è¯¢æ–¹æ¡ˆ</p><h3 id="è‡ªå®šä¹‰è´Ÿè½½å‡è¡¡ç­–ç•¥"><a href="#è‡ªå®šä¹‰è´Ÿè½½å‡è¡¡ç­–ç•¥" class="headerlink" title="è‡ªå®šä¹‰è´Ÿè½½å‡è¡¡ç­–ç•¥"></a>è‡ªå®šä¹‰è´Ÿè½½å‡è¡¡ç­–ç•¥</h3><p>é€šè¿‡å®šä¹‰IRuleå®ç°å¯ä»¥ä¿®æ”¹è´Ÿè½½å‡è¡¡è§„åˆ™ï¼Œæœ‰ä¸¤ç§æ–¹å¼ï¼š</p><ol><li>ä»£ç æ–¹å¼ï¼šåœ¨ order-serviceï¼ˆæœåŠ¡è°ƒç”¨æ–¹ï¼‰ä¸­çš„ RestConfig é…ç½®ç±»ä¸­ï¼Œå®šä¹‰ä¸€ä¸ªæ–°çš„ IRuleï¼š</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RestConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@LoadBalanced</span></span><br><span class="line">    <span class="keyword">public</span> RestTemplate <span class="title function_">restTemplate</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RestTemplate</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="comment">//éšæœºçš„è´Ÿè½½å‡è¡¡ç­–ç•¥</span></span><br><span class="line">    <span class="keyword">public</span> IRule <span class="title function_">randomRule</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RandomRule</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li>é…ç½®æ–‡ä»¶æ–¹å¼ï¼šåœ¨ order-service çš„ application.yml æ–‡ä»¶ä¸­ï¼Œæ·»åŠ æ–°çš„é…ç½®ä¹Ÿå¯ä»¥ä¿®æ”¹è§„åˆ™ï¼š</li></ol><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">user-service:</span> <span class="comment"># ç»™æŸä¸ªå¾®æœåŠ¡é…ç½®è´Ÿè½½å‡è¡¡è§„åˆ™ï¼Œè¿™é‡Œæ˜¯ user-service æœåŠ¡</span></span><br><span class="line">  <span class="attr">ribbon:</span></span><br><span class="line">    <span class="attr">NFLoadBalancerRuleClassName:</span> <span class="string">com.netflix.loadbalancer.RandomRule</span> <span class="comment"># è´Ÿè½½å‡è¡¡è§„åˆ™ </span></span><br></pre></td></tr></table></figure><blockquote><ul><li><p>@Beanæ–¹å¼æ˜¯å…¨å±€è®¾ç½®çš„ï¼Œå³å¯¹æ‰€æœ‰çš„æœåŠ¡çš„è¯·æ±‚éƒ½ç»Ÿä¸€éƒ½ç”¨ RandomRule ç­–ç•¥</p></li><li><p>è€Œé…ç½®æ–‡ä»¶æ–¹å¼æ˜¯æŒ‡å®šæœåŠ¡çš„ï¼Œå³åªå¯¹ user-service æœåŠ¡ç”¨ RandomRule ç­–ç•¥</p></li></ul><p><strong>æ³¨æ„</strong>ï¼Œä¸€èˆ¬ç”¨é»˜è®¤çš„è´Ÿè½½å‡è¡¡è§„åˆ™ï¼Œä¸åšä¿®æ”¹ã€‚</p></blockquote><h1 id="4-é¥¥é¥¿åŠ è½½"><a href="#4-é¥¥é¥¿åŠ è½½" class="headerlink" title="4.é¥¥é¥¿åŠ è½½"></a>4.é¥¥é¥¿åŠ è½½</h1><p>Ribbon é»˜è®¤æ˜¯é‡‡ç”¨æ‡’åŠ è½½ï¼Œå³ç¬¬ä¸€æ¬¡è®¿é—®æ—¶æ‰ä¼šå»åˆ›å»º LoadBalanceClientï¼Œæ‰€ä»¥ç¬¬ä¸€æ¬¡è¯·æ±‚çš„æ—¶é—´ä¼šå¾ˆé•¿ã€‚</p><p>è€Œé¥¥é¥¿åŠ è½½åˆ™ä¼šåœ¨é¡¹ç›®å¯åŠ¨æ—¶åˆ›å»ºï¼Œé™ä½ç¬¬ä¸€æ¬¡è®¿é—®çš„è€—æ—¶ï¼Œå¯ä»¥é€šè¿‡é…ç½®å¼€å¯é¥¥é¥¿åŠ è½½ã€‚ä¾‹å¦‚åœ¨ order-serviceï¼ˆæœåŠ¡è°ƒç”¨æ–¹ï¼‰ä¸­é…ç½®å¯¹user-serviceï¼ˆæœåŠ¡æä¾›æ–¹ï¼‰é¥¥é¥¿åŠ è½½ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">ribbon:</span></span><br><span class="line">  <span class="attr">eager-load:</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">clients:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">user-service</span> <span class="comment"># å¯¹ user-service é¥¥é¥¿åŠ è½½</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">other-service</span> <span class="comment"># å¯¹ other-service é¥¥é¥¿åŠ è½½</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> åç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> clound </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>springäº‹åŠ¡</title>
      <link href="/post/35.html"/>
      <url>/post/35.html</url>
      
        <content type="html"><![CDATA[<h1 id="æ¦‚è¿°ï¼ˆä¸é‡è¦ï¼‰"><a href="#æ¦‚è¿°ï¼ˆä¸é‡è¦ï¼‰" class="headerlink" title="æ¦‚è¿°ï¼ˆä¸é‡è¦ï¼‰"></a>æ¦‚è¿°ï¼ˆä¸é‡è¦ï¼‰</h1><p>äº‹åŠ¡æ˜¯å¼€å‘ä¸­å¿…ä¸å¯å°‘çš„ä¸œè¥¿ï¼Œä½¿ç”¨ JDBC å¼€å‘æ—¶ï¼Œæˆ‘ä»¬ä½¿ç”¨ connnection å¯¹äº‹åŠ¡è¿›è¡Œæ§åˆ¶ï¼Œä½¿ç”¨ MyBatis æ—¶ï¼Œæˆ‘ä»¬ ä½¿ç”¨ SqlSession å¯¹äº‹åŠ¡è¿›è¡Œæ§åˆ¶ï¼Œç¼ºç‚¹æ˜¾è€Œæ˜“è§ï¼Œå½“æˆ‘ä»¬åˆ‡æ¢æ•°æ®åº“è®¿é—®æŠ€æœ¯æ—¶ï¼Œäº‹åŠ¡æ§åˆ¶çš„æ–¹å¼æ€»ä¼šå˜åŒ–ï¼Œ Spring å°±å°†è¿™äº›æŠ€æœ¯åŸºç¡€ä¸Šï¼Œæä¾›äº†ç»Ÿä¸€çš„æ§åˆ¶äº‹åŠ¡çš„æ¥å£ã€‚Spring çš„äº‹åŠ¡åˆ†ä¸ºï¼š<strong>ç¼–ç¨‹å¼äº‹åŠ¡æ§åˆ¶</strong> å’Œ <strong>å£°æ˜å¼äº‹åŠ¡æ§åˆ¶</strong></p><div class="table-container"><table><thead><tr><th>äº‹åŠ¡æ§åˆ¶æ–¹å¼</th><th>è§£é‡Š</th></tr></thead><tbody><tr><td>ç¼–ç¨‹å¼äº‹åŠ¡æ§åˆ¶</td><td>Spring æä¾›äº†äº‹åŠ¡æ§åˆ¶çš„ç±»å’Œæ–¹æ³•ï¼Œä½¿ç”¨ç¼–ç çš„æ–¹å¼å¯¹ä¸šåŠ¡ä»£ç è¿›è¡Œäº‹åŠ¡æ§åˆ¶ï¼Œäº‹åŠ¡æ§åˆ¶ä»£ç å’Œä¸šåŠ¡æ“ä½œä»£ç è€¦åˆåˆ°äº†ä¸€èµ·ï¼Œå¼€å‘ä¸­ä¸ä½¿ç”¨</td></tr><tr><td>å£°æ˜å¼äº‹åŠ¡æ§åˆ¶</td><td>Spring å°†äº‹åŠ¡æ§åˆ¶çš„ä»£ç å°è£…ï¼Œå¯¹å¤–æä¾›äº† Xml å’Œ æ³¨è§£é…ç½® æ–¹å¼ï¼Œé€šè¿‡é…ç½®çš„æ–¹å¼å®Œæˆäº‹åŠ¡çš„æ§åˆ¶ï¼Œ å¯ä»¥è¾¾åˆ°äº‹åŠ¡æ§åˆ¶ä¸ä¸šåŠ¡æ“ä½œä»£ç è§£è€¦åˆï¼Œå¼€å‘ä¸­æ¨èä½¿ç”¨</td></tr></tbody></table></div><h1 id="Spring-äº‹åŠ¡ç¼–ç¨‹"><a href="#Spring-äº‹åŠ¡ç¼–ç¨‹" class="headerlink" title="Spring äº‹åŠ¡ç¼–ç¨‹"></a>Spring äº‹åŠ¡ç¼–ç¨‹</h1><p>Spring äº‹åŠ¡ç¼–ç¨‹ç›¸å…³çš„ç±»ä¸»è¦æœ‰å¦‚ä¸‹ä¸‰ä¸ª</p><div class="table-container"><table><thead><tr><th>äº‹åŠ¡æ§åˆ¶ç›¸å…³ç±»</th><th>è§£é‡Š</th></tr></thead><tbody><tr><td>å¹³å°äº‹åŠ¡ç®¡ç†å™¨ PlatformTransactionManager</td><td>æ˜¯ä¸€ä¸ªæ¥å£æ ‡å‡†ï¼Œå®ç°ç±»éƒ½å…·å¤‡äº‹åŠ¡æäº¤ã€å›æ»šå’Œè·å¾—äº‹åŠ¡å¯¹è±¡çš„åŠŸèƒ½ï¼Œä¸åŒæŒä¹…å±‚æ¡†æ¶å¯èƒ½ä¼šæœ‰ä¸åŒå®ç°æ–¹æ¡ˆ</td></tr><tr><td>äº‹åŠ¡å®šä¹‰ TransactionDefinition</td><td>å°è£…äº‹åŠ¡çš„éš”ç¦»çº§åˆ«ã€ä¼ æ’­è¡Œä¸ºã€è¿‡æœŸæ—¶é—´ç­‰å±æ€§ä¿¡æ¯</td></tr><tr><td>äº‹åŠ¡çŠ¶æ€ TransactionStatus</td><td>å­˜å‚¨å½“å‰äº‹åŠ¡çš„çŠ¶æ€ä¿¡æ¯ï¼Œå¦‚æœäº‹åŠ¡æ˜¯å¦æäº¤ã€æ˜¯å¦å›æ»šã€æ˜¯å¦æœ‰å›æ»šç‚¹ç­‰</td></tr></tbody></table></div><h1 id="åŸºäºæ³¨è§£çš„å£°æ˜å¼äº‹åŠ¡"><a href="#åŸºäºæ³¨è§£çš„å£°æ˜å¼äº‹åŠ¡" class="headerlink" title="åŸºäºæ³¨è§£çš„å£°æ˜å¼äº‹åŠ¡"></a>åŸºäºæ³¨è§£çš„å£°æ˜å¼äº‹åŠ¡</h1><ol><li>å¯¼åæ ‡</li></ol><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--spring-context--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.3.7<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--mybatis--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.5.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--mybatis-spring--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.0.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--spring-jdbc--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.2.13.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--druid--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.23<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--mysql--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>8.0.22<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!--lombok--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.18.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--aspectj--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.aspectj<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aspectjweaver<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.9.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p><!--spring-jdbc--> ä¾èµ–åŒ…å«äº†äº‹åŠ¡çš„ä¾èµ–</p></blockquote><ol><li>æ­ç¯å¢ƒ</li></ol><p>å»ºè¡¨</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `tb_account` (</span><br><span class="line">  `id` <span class="type">int</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `money` <span class="type">int</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb4 <span class="keyword">COLLATE</span><span class="operator">=</span>utf8mb4_0900_ai_ci;</span><br><span class="line"><span class="keyword">BEGIN</span>;</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `tb_account` (`id`, `money`) <span class="keyword">VALUES</span> (<span class="number">1</span>, <span class="number">3000</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `tb_account` (`id`, `money`) <span class="keyword">VALUES</span> (<span class="number">2</span>, <span class="number">6000</span>);</span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br></pre></td></tr></table></figure><p>åˆ›å»ºå®ä½“</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ç•¥</span><br></pre></td></tr></table></figure><p>mapper</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">AccountMapper</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">incrMoney</span><span class="params">()</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">decrMoney</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>mapper.xml</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span> <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.lyf.mapper.AccountMapper&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;incrMoney&quot;</span> &gt;</span></span><br><span class="line">        update tb_account set money = money - 500 where id = 1;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;decrMoney&quot;</span> &gt;</span></span><br><span class="line">        update tb_account set money = money + 500 where id = 2;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure><p>service</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AccountServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">AccountService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AccountMapper accountMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">transferMoney</span><span class="params">()</span> &#123;</span><br><span class="line">        accountMapper.incrMoney();</span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>/<span class="number">0</span>;</span><br><span class="line">        accountMapper.decrMoney();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li>é…ç½®</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan(&quot;com.lyf&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringConfig</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>mybatis</p><p>æŸ¥çœ‹<a href="https://leesin9527.github.io/post/31.html">https://leesin9527.github.io/post/31.html</a></p><p>äº‹åŠ¡é…ç½®</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableTransactionManagement</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TransactionConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> PlatformTransactionManager <span class="title function_">transactionManager</span><span class="params">(DataSource dataSource)</span> &#123;</span><br><span class="line">        <span class="type">DataSourceTransactionManager</span> <span class="variable">transactionManager</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DataSourceTransactionManager</span>();</span><br><span class="line">        transactionManager.setDataSource(dataSource);</span><br><span class="line">        <span class="keyword">return</span> transactionManager;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li>æµ‹è¯•</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">  <span class="type">ApplicationContext</span> <span class="variable">app</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AnnotationConfigApplicationContext</span>(SpringConfig.class);</span><br><span class="line">  <span class="type">AccountService</span> <span class="variable">accountService</span> <span class="operator">=</span> app.getBean(AccountService.class);</span><br><span class="line">  accountService.transferMoney();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="äº‹åŠ¡å±æ€§"><a href="#äº‹åŠ¡å±æ€§" class="headerlink" title="äº‹åŠ¡å±æ€§"></a>äº‹åŠ¡å±æ€§</h1><h2 id="isolation-å±æ€§"><a href="#isolation-å±æ€§" class="headerlink" title="isolation å±æ€§"></a>isolation å±æ€§</h2><p>æŒ‡å®šäº‹åŠ¡çš„éš”ç¦»çº§åˆ«ï¼Œäº‹åŠ¡å¹¶å‘å­˜åœ¨ä¸‰å¤§é—®é¢˜ï¼ˆè„è¯»ã€ä¸å¯é‡å¤è¯»ã€å¹»è¯»ï¼‰ã€‚å¯ä»¥é€šè¿‡è®¾ç½®äº‹åŠ¡çš„éš”ç¦»çº§åˆ«æ¥ä¿è¯å¹¶å‘é—®é¢˜çš„å‡ºç°ï¼Œå¸¸ç”¨çš„æ˜¯ READ_COMMITTED å’Œ REPEATABLE_READ</p><div class="table-container"><table><thead><tr><th>isolationå±æ€§</th><th>è§£é‡Š</th></tr></thead><tbody><tr><td>DEFAULT</td><td>é»˜è®¤éš”ç¦»çº§åˆ«ï¼Œå–å†³äºå½“å‰æ•°æ®åº“éš”ç¦»çº§åˆ«ï¼Œä¾‹å¦‚MySQLé»˜è®¤éš”ç¦»çº§åˆ«æ˜¯REPEATABLE_READ</td></tr><tr><td>READ_UNCOMMITTED</td><td>Aäº‹åŠ¡å¯ä»¥è¯»å–åˆ°Bäº‹åŠ¡å°šæœªæäº¤çš„äº‹åŠ¡è®°å½•ï¼Œä¸èƒ½è§£å†³ä»»ä½•å¹¶å‘é—®é¢˜ï¼Œå®‰å…¨æ€§æœ€ä½ï¼Œæ€§èƒ½æœ€é«˜</td></tr><tr><td>READ_COMMITTED</td><td>Aäº‹åŠ¡åªèƒ½è¯»å–åˆ°å…¶ä»–äº‹åŠ¡å·²ç»æäº¤çš„è®°å½•ï¼Œä¸èƒ½è¯»å–åˆ°æœªæäº¤çš„è®°å½•ã€‚å¯ä»¥è§£å†³è„è¯»é—®é¢˜ï¼Œä½†æ˜¯ä¸èƒ½è§£å†³ä¸å¯é‡å¤è¯»å’Œå¹»è¯»</td></tr><tr><td>REPEATABLE_READ</td><td>Aäº‹åŠ¡å¤šæ¬¡ä»æ•°æ®åº“è¯»å–æŸæ¡è®°å½•ç»“æœä¸€è‡´ï¼Œå¯ä»¥è§£å†³ä¸å¯é‡å¤è¯»ï¼Œä¸å¯ä»¥è§£å†³å¹»è¯»</td></tr><tr><td>SERIALIZABLE</td><td>ä¸²è¡ŒåŒ–ï¼Œå¯ä»¥è§£å†³ä»»ä½•å¹¶å‘é—®é¢˜ï¼Œå®‰å…¨æ€§æœ€é«˜ï¼Œä½†æ˜¯æ€§èƒ½æœ€ä½</td></tr></tbody></table></div><h2 id="read-only-å±æ€§"><a href="#read-only-å±æ€§" class="headerlink" title="read-only å±æ€§"></a>read-only å±æ€§</h2><p>è®¾ç½®å½“å‰çš„åªè¯»çŠ¶æ€ï¼Œå¦‚æœæ˜¯æŸ¥è¯¢åˆ™è®¾ç½®ä¸º trueï¼Œå¯ä»¥æé«˜æŸ¥è¯¢æ€§èƒ½ï¼Œå¦‚æœæ˜¯æ›´æ–°(å¢åˆ æ”¹)æ“ä½œåˆ™è®¾ç½®ä¸º false</p><h2 id="timeout-å±æ€§"><a href="#timeout-å±æ€§" class="headerlink" title="timeout å±æ€§"></a>timeout å±æ€§</h2><p>è®¾ç½®äº‹åŠ¡æ‰§è¡Œçš„è¶…æ—¶æ—¶é—´ï¼Œå•ä½æ˜¯<strong>ç§’</strong>ï¼Œå¦‚æœè¶…è¿‡è¯¥æ—¶é—´é™åˆ¶ä½†äº‹åŠ¡è¿˜æ²¡æœ‰å®Œæˆï¼Œåˆ™è‡ªåŠ¨å›æ»šäº‹åŠ¡ ï¼Œä¸å†ç»§ç»­æ‰§è¡Œã€‚é»˜è®¤å€¼æ˜¯-1ï¼Œå³æ²¡æœ‰è¶…æ—¶æ—¶é—´é™åˆ¶ã€‚</p><h2 id="propagationå±æ€§"><a href="#propagationå±æ€§" class="headerlink" title="propagationå±æ€§"></a>propagationå±æ€§</h2><p>è®¾ç½®äº‹åŠ¡çš„ä¼ æ’­è¡Œä¸ºï¼Œä¸»è¦è§£å†³æ˜¯ A æ–¹æ³•è°ƒç”¨ B æ–¹æ³•æ—¶ï¼Œäº‹åŠ¡çš„ä¼ æ’­æ–¹å¼é—®é¢˜çš„ï¼Œä¾‹å¦‚:ä½¿ç”¨å•æ–¹çš„äº‹åŠ¡ï¼Œè¿˜æ˜¯ A å’Œ B éƒ½ä½¿ç”¨è‡ªå·±çš„äº‹åŠ¡ç­‰ã€‚äº‹åŠ¡çš„ä¼ æ’­è¡Œä¸ºæœ‰å¦‚ä¸‹ä¸ƒç§å±æ€§å€¼å¯é…ç½®ï¼š</p><div class="table-container"><table><thead><tr><th>äº‹åŠ¡ä¼ æ’­è¡Œä¸º</th><th>è§£é‡Š</th></tr></thead><tbody><tr><td>REQUIRED(é»˜è®¤å€¼)</td><td>Aè°ƒç”¨Bï¼ŒBéœ€è¦äº‹åŠ¡ï¼Œå¦‚æœAæœ‰äº‹åŠ¡Bå°±åŠ å…¥Açš„äº‹åŠ¡ä¸­ï¼Œå¦‚æœAæ²¡æœ‰äº‹åŠ¡ï¼ŒBå°±è‡ªå·±åˆ›å»ºä¸€ä¸ªäº‹åŠ¡</td></tr><tr><td>REQUIRED_NEW</td><td>Aè°ƒç”¨Bï¼ŒBéœ€è¦æ–°äº‹åŠ¡ï¼Œå¦‚æœAæœ‰äº‹åŠ¡å°±æŒ‚èµ·ï¼ŒBè‡ªå·±åˆ›å»ºä¸€ä¸ªæ–°çš„äº‹åŠ¡</td></tr><tr><td>SUPPORTS</td><td>Aè°ƒç”¨Bï¼ŒBæœ‰æ— äº‹åŠ¡æ— æ‰€è°“ï¼ŒAæœ‰äº‹åŠ¡å°±åŠ å…¥åˆ°Aäº‹åŠ¡ä¸­ï¼ŒAæ— äº‹åŠ¡Bå°±ä»¥éäº‹åŠ¡æ–¹å¼æ‰§è¡Œ</td></tr><tr><td>NOT_SUPPORTS</td><td>Aè°ƒç”¨Bï¼ŒBä»¥æ— äº‹åŠ¡æ–¹å¼æ‰§è¡Œï¼ŒAå¦‚æœ‰äº‹åŠ¡åˆ™æŒ‚èµ·</td></tr><tr><td>NEVER</td><td>Aè°ƒç”¨Bï¼ŒBä»¥æ— äº‹åŠ¡æ–¹å¼æ‰§è¡Œï¼ŒAå¦‚æœ‰äº‹åŠ¡åˆ™æŠ›å‡ºå¼‚å¸¸</td></tr><tr><td>MANDATORY</td><td>Aè°ƒç”¨Bï¼ŒBè¦åŠ å…¥Açš„äº‹åŠ¡ä¸­ï¼Œå¦‚æœAæ— äº‹åŠ¡å°±æŠ›å‡ºå¼‚å¸¸</td></tr><tr><td>NESTED</td><td>Aè°ƒç”¨Bï¼ŒBåˆ›å»ºä¸€ä¸ªæ–°äº‹åŠ¡ï¼ŒAæœ‰äº‹åŠ¡å°±ä½œä¸ºåµŒå¥—äº‹åŠ¡å­˜åœ¨ï¼ŒAæ²¡äº‹åŠ¡å°±ä»¥åˆ›å»ºçš„æ–°äº‹åŠ¡æ‰§è¡Œ</td></tr></tbody></table></div><h1 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h1><p>å¾…æ›´æ–°</p>]]></content>
      
      
      <categories>
          
          <category> åç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> spring </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ‰«æ@Componentçš„åŸç†</title>
      <link href="/post/34.html"/>
      <url>/post/34.html</url>
      
        <content type="html"><![CDATA[<h1 id="XMLæ–¹å¼çš„åŸç†"><a href="#XMLæ–¹å¼çš„åŸç†" class="headerlink" title="XMLæ–¹å¼çš„åŸç†"></a>XMLæ–¹å¼çš„åŸç†</h1><p>xml é…ç½®çš„æ–¹å¼å¦‚ä¸‹ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;</span></span></span><br><span class="line"><span class="string"><span class="tag">       http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">       http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.lyf&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure><p>æœ¬è´¨ä¸Šçš„åŸç†å°±æ˜¯è‡ªå®šä¹‰å‘½åç©ºé—´çš„è§£ææµç¨‹ã€‚</p><blockquote><p><a href="https://leesin9527.github.io/post/33.html">https://leesin9527.github.io/post/33.html</a> è¿™ç¯‡æ–‡ç« å·²ç»å†™æ¸…æ¥šäº†å¤§æ¦‚æµç¨‹</p></blockquote><p>è‡ªå·±é˜…è¯»çš„å…¥å£</p><p><img src="http://cdn.leesin.fun/typora/macpro/img/image-20230511181302072.png" alt="image-20230511181302072"></p><blockquote><p>æ ¸å¿ƒæºç è·¯å¾„ï¼šContextNamespaceHandler -&gt; ComponentScanBeanDefinitionParser -&gt; parse() -&gt; scanner.doScan(basePackages) </p></blockquote><p>åœ¨ ClassPathBeanDefinitionScanner çš„ doScan æ–¹æ³•é‡Œæ‰¾åˆ°ä»¥ä¸‹ä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">BeanDefinitionHolder</span> <span class="variable">definitionHolder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BeanDefinitionHolder</span>(candidate, beanName);</span><br><span class="line"><span class="built_in">this</span>.registerBeanDefinition(definitionHolder, <span class="built_in">this</span>.registry);</span><br></pre></td></tr></table></figure><p>å…¶å®å°±æ˜¯å°†å¸¦æœ‰ @Component æ³¨è§£çš„ç±»ï¼Œæ³¨å†Œè¿› BeanDefinitionMap</p><blockquote><p>è·Ÿå‰é¢è‡ªå·±å†™çš„ @Component æ³¨è§£å¦‚å‡ºä¸€è¾™ï¼š<a href="https://leesin9527.github.io/post/27.html">https://leesin9527.github.io/post/27.html</a></p></blockquote><h1 id="æ³¨è§£æ–¹å¼çš„åŸç†"><a href="#æ³¨è§£æ–¹å¼çš„åŸç†" class="headerlink" title="æ³¨è§£æ–¹å¼çš„åŸç†"></a>æ³¨è§£æ–¹å¼çš„åŸç†</h1><p>æ³¨è§£ é…ç½®çš„æ–¹å¼å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan(&#123;&quot;com.lyf&quot;&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringConfig</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">ApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AnnotationConfigApplicationContext</span>(SpringConfig.class);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åŸç†ç•¥ã€‚</p><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p><img src="http://cdn.leesin.fun/typora/macpro/img/image-20230511183028804.png" alt="image-20230511183028804"></p>]]></content>
      
      
      <categories>
          
          <category> åç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> spring </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>springè‡ªå®šä¹‰å‘½åç©ºé—´</title>
      <link href="/post/33.html"/>
      <url>/post/33.html</url>
      
        <content type="html"><![CDATA[<h1 id="ä»¥contextå‘½åç©ºé—´ä¸ºä¾‹"><a href="#ä»¥contextå‘½åç©ºé—´ä¸ºä¾‹" class="headerlink" title="ä»¥contextå‘½åç©ºé—´ä¸ºä¾‹"></a>ä»¥contextå‘½åç©ºé—´ä¸ºä¾‹</h1><p>applicationContext.xml</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="line">&lt;beans xmlns=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span><br><span class="line">       xmlns:xsi=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="line">       xmlns:context=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span><br><span class="line">       xsi:schemaLocation=<span class="string">&quot;</span></span><br><span class="line"><span class="string">       http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd</span></span><br><span class="line"><span class="string">       http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd</span></span><br><span class="line"><span class="string">&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!--åŠ è½½ properties æ–‡ä»¶--&gt;</span><br><span class="line">    &lt;context:property-placeholder location=<span class="string">&quot;classpath:jdbc.properties&quot;</span>/&gt;</span><br><span class="line"></span><br><span class="line">&lt;/beans&gt;</span><br></pre></td></tr></table></figure><p>jdbc.properties</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">jdbc.driver</span>=<span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line"><span class="attr">jdbc.url</span>=<span class="string">jdbc:mysql://localhost:3306/tmpdb?serverTimezone=Asia/Shanghai</span></span><br><span class="line"><span class="attr">jdbc.username</span>=<span class="string">root</span></span><br><span class="line"><span class="attr">jdbc.password</span>=<span class="string">root</span></span><br></pre></td></tr></table></figure><h1 id="è‡ªå®šä¹‰å‘½åç©ºé—´è§£æçš„åŸç†"><a href="#è‡ªå®šä¹‰å‘½åç©ºé—´è§£æçš„åŸç†" class="headerlink" title="è‡ªå®šä¹‰å‘½åç©ºé—´è§£æçš„åŸç†"></a>è‡ªå®šä¹‰å‘½åç©ºé—´è§£æçš„åŸç†</h1><p>spring è§£æ applicationContext.xml æ—¶ï¼Œä¼šå»ä¾èµ–çš„ META-INF/spring.handlers ä¸­ï¼ŒåŠ è½½å‘½åç©ºé—´å¤„ç†å™¨åˆ° <code>Map&lt;String, Object&gt; handlerMappings</code> ä¸­å»</p><p><img src="http://cdn.leesin.fun/typora/s3/img/image-20230510233503453.png" alt="image-20230510233503453"></p><p>åŠ è½½çš„æ—¶å€™ï¼Œä¼šè°ƒç”¨handler.initæ–¹æ³•ï¼Œç›®çš„æ˜¯ä¸ºè¯¥å‘½åç©ºé—´ä¸‹çš„æ‰€æœ‰çš„æ ‡ç­¾éƒ½æ³¨å…¥ç›¸åº”çš„è§£æå™¨parser</p><p><img src="http://cdn.leesin.fun/typora/s3/img/image-20230510234018392.png" alt="image-20230510234018392"></p><p>å½“è§£æåˆ° <code>&lt;context:property-placeholder&gt;</code> æ—¶ï¼ŒSpring æ ¹æ®å‘½åç©ºé—´ context ä¼šå¾—åˆ°å®ƒçš„ handlerï¼Œç„¶åè°ƒç”¨å®ƒçš„ handler.parseæ–¹æ³•ï¼Œè¯¥æ–¹æ³•å†…éƒ¨æœ€ç»ˆä¼šè°ƒç”¨åˆ° ç›¸åº”æ ‡ç­¾çš„doParseæ–¹æ³•ï¼Œæœ€ç»ˆå®Œæˆè§£æã€‚</p><p><img src="http://cdn.leesin.fun/typora/s3/img/image-20230510234127550.png" alt="image-20230510234127550"></p><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>é€šè¿‡ä¸Šè¿°åˆ†æï¼Œæˆ‘ä»¬æ¸…æ¥šçš„äº†è§£äº†å¤–éƒ¨å‘½åç©ºé—´æ ‡ç­¾çš„æ‰§è¡Œæµç¨‹ï¼Œå¦‚ä¸‹ï¼š</p><ul><li>å°†è‡ªå®šä¹‰æ ‡ç­¾çš„çº¦æŸ ä¸ ç‰©ç†çº¦æŸæ–‡ä»¶ä¸ç½‘ç»œçº¦æŸåç§°çš„çº¦æŸ ä»¥é”®å€¼å¯¹å½¢å¼å­˜å‚¨åˆ°ä¸€ä¸ªspring.schemasæ–‡ä»¶é‡Œ ï¼Œè¯¥æ–‡ä»¶å­˜å‚¨åœ¨ç±»åŠ è½½è·¯å¾„çš„ META-INFé‡Œï¼ŒSpringä¼šè‡ªåŠ¨åŠ è½½åˆ°</li><li>å°†è‡ªå®šä¹‰å‘½åç©ºé—´çš„åç§° ä¸ è‡ªå®šä¹‰å‘½åç©ºé—´çš„å¤„ç†å™¨æ˜ å°„å…³ç³» ä»¥é”®å€¼å¯¹å½¢å¼å­˜åœ¨åˆ°ä¸€ä¸ªå«spring.handlersæ–‡ ä»¶é‡Œï¼Œè¯¥æ–‡ä»¶å­˜å‚¨åœ¨ç±»åŠ è½½è·¯å¾„çš„ META-INFé‡Œï¼ŒSpringä¼šè‡ªåŠ¨åŠ è½½åˆ°</li><li>å‡†å¤‡å¥½NamespaceHandlerï¼Œå¦‚æœå‘½åç©ºé—´åªæœ‰ä¸€ä¸ªæ ‡ç­¾ï¼Œé‚£ä¹ˆç›´æ¥åœ¨parseæ–¹æ³•ä¸­è¿›è¡Œè§£æå³å¯ï¼Œä¸€èˆ¬è§£æç»“ æœå°±æ˜¯æ³¨å†Œè¯¥æ ‡ç­¾å¯¹åº”çš„BeanDefinitionã€‚å¦‚æœå‘½åç©ºé—´é‡Œæœ‰å¤šä¸ªæ ‡ç­¾ï¼Œé‚£ä¹ˆå¯ä»¥åœ¨initæ–¹æ³•ä¸­ä¸ºæ¯ä¸ªæ ‡ç­¾éƒ½æ³¨ å†Œä¸€ä¸ªBeanDefinitionParserï¼Œåœ¨æ‰§è¡ŒNamespaceHandlerçš„parseæ–¹æ³•æ—¶åœ¨åˆ†æµç»™ä¸åŒçš„ BeanDefinitionParserè¿›è¡Œè§£æ(é‡å†™doParseæ–¹æ³•å³å¯)ã€‚</li></ul><h1 id="è‡ªå·±å†™ä¸€ä¸ªè‡ªå®šä¹‰å‘½åç©ºé—´"><a href="#è‡ªå·±å†™ä¸€ä¸ªè‡ªå®šä¹‰å‘½åç©ºé—´" class="headerlink" title="è‡ªå·±å†™ä¸€ä¸ªè‡ªå®šä¹‰å‘½åç©ºé—´"></a>è‡ªå·±å†™ä¸€ä¸ªè‡ªå®šä¹‰å‘½åç©ºé—´</h1><h2 id="æ¡ˆä¾‹"><a href="#æ¡ˆä¾‹" class="headerlink" title="æ¡ˆä¾‹"></a>æ¡ˆä¾‹</h2><p>è®¾æƒ³è‡ªå·±æ˜¯ä¸€åæ¶æ„å¸ˆï¼Œè¿›è¡ŒæŸä¸€ä¸ªæ¡†æ¶ä¸ Spring çš„é›†æˆå¼€å‘ï¼Œæ•ˆæœæ˜¯é€šè¿‡ä¸€ä¸ªæŒ‡ç¤ºæ ‡ç­¾ï¼Œå‘ Spring å®¹å™¨ä¸­è‡ªåŠ¨æ³¨å…¥ä¸€ä¸ª BeanPostProcessor</p><h2 id="æ­¥éª¤åˆ†æ"><a href="#æ­¥éª¤åˆ†æ" class="headerlink" title="æ­¥éª¤åˆ†æ"></a>æ­¥éª¤åˆ†æ</h2><ol><li>ç¡®å®šå‘½åç©ºé—´åç§°ã€schemaè™šæ‹Ÿè·¯å¾„ã€æ ‡ç­¾åç§°ï¼› </li><li>ç¼–å†™schemaçº¦æŸæ–‡ä»¶haohao-annotation.xsd</li><li>åœ¨ç±»åŠ è½½è·¯å¾„ä¸‹åˆ›å»ºMETAç›®å½•ï¼Œç¼–å†™çº¦æŸæ˜ å°„æ–‡ä»¶spring.schemaså’Œå¤„ç†å™¨æ˜ å°„æ–‡ä»¶spring.handlers</li><li>ç¼–å†™å‘½åç©ºé—´å¤„ç†å™¨ HaohaoNamespaceHandlerï¼Œåœ¨initæ–¹æ³•ä¸­æ³¨å†ŒHaohaoBeanDefinitionParser</li><li>ç¼–å†™æ ‡ç­¾çš„è§£æå™¨ HaohaoBeanDefinitionParserï¼Œåœ¨parseæ–¹æ³•ä¸­æ³¨å†ŒHaohaoBeanPostProcessor</li><li>ç¼–å†™HaohaoBeanPostProcessor </li></ol><p>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”ä»¥ä¸Šäº”æ­¥æ˜¯æ¡†æ¶å¼€å‘è€…å†™çš„ï¼Œä»¥ä¸‹æ˜¯æ¡†æ¶ä½¿ç”¨è€…å†™çš„â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”</p><ol><li>åœ¨ applicationContext.xml é…ç½®æ–‡ä»¶ä¸­å¼•å…¥å‘½åç©ºé—´</li><li>åœ¨ applicationContext.xml é…ç½®æ–‡ä»¶ä¸­ä½¿ç”¨è‡ªå®šä¹‰çš„æ ‡ç­¾</li></ol><h2 id="å¼€å§‹"><a href="#å¼€å§‹" class="headerlink" title="å¼€å§‹"></a>å¼€å§‹</h2><ol><li>åœ¨ç±»åŠ è½½è·¯å¾„ä¸‹åˆ›å»º com/lyf/haohao/config ç›®å½•ï¼Œç¼–å†™ schema çº¦æŸæ–‡ä»¶ haohao-annotation.xsd</li></ol><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">xsd:schema</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.lyf.com/haohao&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">xmlns:xsd</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">targetNamespace</span>=<span class="string">&quot;http://www.lyf.com/haohao&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">xsd:element</span> <span class="attr">name</span>=<span class="string">&quot;annotation-driven&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">xsd:element</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">xsd:schema</span>&gt;</span></span><br></pre></td></tr></table></figure><ol><li>åœ¨ç±»åŠ è½½è·¯å¾„ä¸‹åˆ›å»º META-INF ç›®å½•ï¼Œç¼–å†™çº¦æŸæ˜ å°„æ–‡ä»¶ spring.schemas å’Œå¤„ç†å™¨æ˜ å°„æ–‡ä»¶ spring.handlers</li></ol><p>spring.schemas</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">http\://www.lyf.com/haohao/haohao-annotation.xsd</span> =<span class="string">com/lyf/haohao/config/haohao-annotation.xsd</span></span><br></pre></td></tr></table></figure><p>spring.handlers</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">http\://www.lyf.com/haohao</span> =<span class="string">com.lyf.haohao.handler.HaohaoNamespaceHandler</span></span><br></pre></td></tr></table></figure><ol><li>ç¼–å†™å‘½åç©ºé—´å¤„ç†å™¨ HaohaoNamespaceHandlerï¼Œåœ¨ init æ–¹æ³•ä¸­æ³¨å†Œ HaohaoBeanDefinitionParser</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HaohaoNamespaceHandler</span> <span class="keyword">extends</span> <span class="title class_">NamespaceHandlerSupport</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.registerBeanDefinitionParser(<span class="string">&quot;annotation-driven&quot;</span>, <span class="keyword">new</span> <span class="title class_">HaohaoBeanDefinitionParser</span>());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li>ç¼–å†™æ ‡ç­¾çš„è§£æå™¨ HaohaoBeanDefinitionParserï¼Œåœ¨ parse æ–¹æ³•ä¸­æ³¨å†Œ MyBeanPostProcessor</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HaohaoBeanDefinitionParser</span> <span class="keyword">implements</span> <span class="title class_">BeanDefinitionParser</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> BeanDefinition <span class="title function_">parse</span><span class="params">(Element element, ParserContext parserContext)</span> &#123;</span><br><span class="line">        <span class="comment">// åˆ›å»º HaohaoBeanPostProcessor çš„ BeanDefinition</span></span><br><span class="line">        <span class="type">RootBeanDefinition</span> <span class="variable">beanDefinition</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RootBeanDefinition</span>();</span><br><span class="line">        beanDefinition.setBeanClass(HaohaoBeanPostProcessor.class);</span><br><span class="line">        <span class="comment">// æ³¨å†Œ myBeanPostProcessor</span></span><br><span class="line">        parserContext.getRegistry().registerBeanDefinition(<span class="string">&quot;myBeanPostProcessor&quot;</span>,beanDefinition);</span><br><span class="line">        <span class="keyword">return</span> beanDefinition;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li>ç¼–å†™ MyBeanPostProcessor</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyBeanPostProcessor</span> <span class="keyword">implements</span> <span class="title class_">BeanPostProcessor</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">postProcessBeforeInitialization</span><span class="params">(Object bean, String beanName)</span> <span class="keyword">throws</span> BeansException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;è‡ªåŠ¨æ³¨å…¥ MyBeanPostProcessor æˆåŠŸ&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> bean;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li>ç¼–å†™é…ç½®æ–‡ä»¶ applicationContext.xml</li></ol><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:haohao</span>=<span class="string">&quot;http://www.lyf.com/haohao&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;</span></span></span><br><span class="line"><span class="string"><span class="tag">       http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">       http://www.lyf.com/haohao http://www.lyf.com/haohao/haohao-annotation.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;user&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.lyf.entity.User&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">haohao:annotation-driven</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure><ol><li>æµ‹è¯•ä»£ç </li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">ApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> </span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;applicationContext.xml&quot;</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><ol><li>æ§åˆ¶å°è¾“å‡º</li></ol><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">è‡ªåŠ¨æ³¨å…¥HaohaoBeanPostProcessoræˆåŠŸ</span><br></pre></td></tr></table></figure><p><img src="http://cdn.leesin.fun/typora/s3/img/image-20230511130509491.png" alt="image-20230511130509491"></p>]]></content>
      
      
      <categories>
          
          <category> åç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> spring </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Importæ³¨è§£</title>
      <link href="/post/32.html"/>
      <url>/post/32.html</url>
      
        <content type="html"><![CDATA[<p>Spring ä¸ MyBatis æ³¨è§£æ–¹å¼æ•´åˆæœ‰ä¸ªé‡è¦çš„æŠ€æœ¯ç‚¹å°±æ˜¯ @Importã€‚ç¬¬ä¸‰æ–¹æ¡†æ¶ä¸ Spring æ•´åˆ xml æ–¹å¼å¾ˆå¤šæ˜¯å‡­å€Ÿè‡ªå®šä¹‰æ ‡ç­¾å®Œæˆçš„ï¼Œè€Œç¬¬ä¸‰æ–¹æ¡†æ¶ä¸ Spring æ•´åˆæ³¨è§£æ–¹å¼å¾ˆå¤šæ˜¯é  @Import æ³¨è§£å®Œæˆçš„ã€‚</p><h1 id="Import-å¯ä»¥å¯¼å…¥çš„ç±»"><a href="#Import-å¯ä»¥å¯¼å…¥çš„ç±»" class="headerlink" title="@Import å¯ä»¥å¯¼å…¥çš„ç±»"></a>@Import å¯ä»¥å¯¼å…¥çš„ç±»</h1><p>@Import å¯ä»¥å¯¼å…¥å¦‚ä¸‹ä¸‰ç§ç±»:</p><ul><li>æ™®é€šçš„é…ç½®ç±»</li><li>å®ç° ImportSelector æ¥å£çš„ç±»</li><li>å®ç° ImportBeanDefinitionRegistrar æ¥å£çš„ç±»</li></ul><h1 id="æ™®é€šçš„é…ç½®ç±»"><a href="#æ™®é€šçš„é…ç½®ç±»" class="headerlink" title="æ™®é€šçš„é…ç½®ç±»"></a>æ™®é€šçš„é…ç½®ç±»</h1><p>å…¶ä»–çš„ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OtherBean</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…¶ä»–çš„é…ç½®ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OtherConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> OtherBean <span class="title function_">otherBean</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">OtherBean</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>spring é…ç½®ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@Import(OtherConfig.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringConfig</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æµ‹è¯•ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="type">ApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AnnotationConfigApplicationContext</span>(SpringConfig.class);</span><br><span class="line">    <span class="type">OtherConfig</span> <span class="variable">otherConfig</span> <span class="operator">=</span> context.getBean(OtherConfig.class);</span><br><span class="line">    System.out.println(otherConfig);<span class="comment">// èƒ½è·å–åˆ°</span></span><br><span class="line">    <span class="type">OtherBean</span> <span class="variable">otherBean</span> <span class="operator">=</span> context.getBean(OtherBean.class);</span><br><span class="line">    System.out.println(otherBean);<span class="comment">// èƒ½è·å–åˆ°</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="å®ç°-ImportSelector-æ¥å£çš„ç±»"><a href="#å®ç°-ImportSelector-æ¥å£çš„ç±»" class="headerlink" title="å®ç° ImportSelector æ¥å£çš„ç±»"></a>å®ç° ImportSelector æ¥å£çš„ç±»</h1><p>å…¶ä»–çš„ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OtherBean</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è‡ªå®šä¹‰çš„ ImportSelector</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyImportSelector</span> <span class="keyword">implements</span> <span class="title class_">ImportSelector</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String[] selectImports(AnnotationMetadata annotationMetadata) &#123;</span><br><span class="line">        <span class="comment">// è¿”å›è¦è¿›è¡Œæ³¨å†Œçš„ Bean çš„å…¨é™å®šåæ•°ç»„</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">String</span>[]&#123;<span class="string">&quot;com.lyf.other.OtherBean&quot;</span>&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>spring é…ç½®ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan(&#123;&quot;com.lyf&quot;&#125;)</span></span><br><span class="line"><span class="meta">@Import(&#123;MyImportSelector.class&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringConfig</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æµ‹è¯•ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="type">ApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AnnotationConfigApplicationContext</span>(SpringConfig.class);</span><br><span class="line">    <span class="type">OtherBean</span> <span class="variable">otherBean</span> <span class="operator">=</span> context.getBean(OtherBean.class);</span><br><span class="line">    System.out.println(otherBean);<span class="comment">// èƒ½è·å–åˆ°</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€”â€”â€”â€”â€”åˆ†å‰²çº¿â€”â€”â€”â€”-</p><p>ImportSelector æ¥å£ selectImports æ–¹æ³•çš„å‚æ•° AnnotationMetadata ä»£è¡¨æ³¨è§£çš„å…ƒæ•°æ®ï¼Œå¯ä»¥è·å¾—å½“å‰æ³¨è§£ä¿®é¥°çš„ç±»çš„å…ƒä¿¡æ¯ï¼Œä¾‹å¦‚:è·å¾—ç»„ä»¶æ‰«æçš„åŒ…åã€‚</p><p>ä¿®æ”¹ MyImportSelector.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyImportSelector</span> <span class="keyword">implements</span> <span class="title class_">ImportSelector</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String[] selectImports(AnnotationMetadata annotationMetadata) &#123;</span><br><span class="line">        <span class="comment">// è·å¾—æŒ‡å®šç±»å‹æ³¨è§£çš„å…¨éƒ¨å…ƒä¿¡æ¯</span></span><br><span class="line">        Map&lt;String, Object&gt; annotationAttributes =</span><br><span class="line">                annotationMetadata.getAnnotationAttributes(ComponentScan.class.getName());</span><br><span class="line">        <span class="comment">// è·å¾— basePackages ä¿¡æ¯</span></span><br><span class="line">        String[] basePackages = (String[]) annotationAttributes.get(<span class="string">&quot;basePackages&quot;</span>);</span><br><span class="line">        <span class="comment">// æ‰“å°ç»“æœæ˜¯ com.lyf</span></span><br><span class="line">        System.out.println(basePackages[<span class="number">0</span>]);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">String</span>[]&#123;<span class="string">&quot;com.lyf.other.OtherBean&quot;</span>&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é‡æ–°è¿è¡Œæµ‹è¯•ç±»ï¼Œæ§åˆ¶å°è¾“å‡ºï¼š</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">com.lyf</span><br></pre></td></tr></table></figure><h1 id="å®ç°-ImportBeanDefinitionRegistrar-æ¥å£çš„ç±»"><a href="#å®ç°-ImportBeanDefinitionRegistrar-æ¥å£çš„ç±»" class="headerlink" title="å®ç° ImportBeanDefinitionRegistrar æ¥å£çš„ç±»"></a>å®ç° ImportBeanDefinitionRegistrar æ¥å£çš„ç±»</h1><p>å…¶ä»–çš„ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OtherBean2</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è‡ªå®šä¹‰çš„ ImportBeanDefinitionRegistrar</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyImportBeanDefinitionRegistrar</span> <span class="keyword">implements</span> <span class="title class_">ImportBeanDefinitionRegistrar</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">registerBeanDefinitions</span><span class="params">(AnnotationMetadata importingClassMetadata, BeanDefinitionRegistry registry)</span> &#123;</span><br><span class="line">        <span class="comment">// æ³¨å†Œ BeanDefinition</span></span><br><span class="line">        <span class="type">BeanDefinition</span> <span class="variable">beandefinition</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RootBeanDefinition</span>();</span><br><span class="line">        beandefinition.setBeanClassName(<span class="string">&quot;com.lyf.other.OtherBean2&quot;</span>);</span><br><span class="line">        registry.registerBeanDefinition(<span class="string">&quot;otherBean2&quot;</span>, beandefinition);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>spring é…ç½®ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan(&#123;&quot;com.lyf&quot;&#125;)</span></span><br><span class="line"><span class="meta">@Import(&#123;MyImportBeanDefinitionRegistrar.class&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringConfig</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æµ‹è¯•ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="type">ApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AnnotationConfigApplicationContext</span>(SpringConfig.class);</span><br><span class="line">    <span class="type">OtherBean2</span> <span class="variable">otherBean2</span> <span class="operator">=</span> context.getBean(OtherBean2.class);</span><br><span class="line">    System.out.println(otherBean2);<span class="comment">// èƒ½è·å–åˆ°</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ¨¡ä»¿-MyBatis-çš„-MapperScan"><a href="#æ¨¡ä»¿-MyBatis-çš„-MapperScan" class="headerlink" title="æ¨¡ä»¿ MyBatis çš„ MapperScan"></a>æ¨¡ä»¿ MyBatis çš„ MapperScan</h2><p>ç¼–å†™ MyMapperScan </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Target(ElementType.TYPE)</span></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="meta">@Import(MyMapperScannerRegistrar.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> MyMapperScan &#123;</span><br><span class="line">    String[] basePackages() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¼–å†™ MyMapperScannerRegistrar</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyMapperScannerRegistrar</span> <span class="keyword">implements</span> <span class="title class_">ImportBeanDefinitionRegistrar</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">registerBeanDefinitions</span><span class="params">(AnnotationMetadata importingClassMetadata, BeanDefinitionRegistry registry)</span> &#123;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// è·å¾—æŒ‡å®šç±»å‹æ³¨è§£çš„å…¨éƒ¨å…ƒä¿¡æ¯</span></span><br><span class="line">        Map&lt;String, Object&gt; annotationAttributes =</span><br><span class="line">                importingClassMetadata.getAnnotationAttributes(MyMapperScan.class.getName());</span><br><span class="line">      <span class="comment">// è·å¾— basePackages ä¿¡æ¯</span></span><br><span class="line">        String[] basePackages = (String[]) annotationAttributes.get(<span class="string">&quot;basePackages&quot;</span>);</span><br><span class="line">      <span class="comment">// æ‰“å°ç»“æœæ˜¯ com.lyf</span></span><br><span class="line">        System.out.println(basePackages[<span class="number">0</span>]);</span><br><span class="line">      <span class="comment">// å°† MapperScannerConfigurer æ³¨å†Œè¿› BeanDefinitionMap ä¸­......</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Spring é…ç½®ç±»é‡Œä½¿ç”¨ @MyMapperScanï¼Œå¹¶æŒ‡å®š basePackages</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@MyMapperScan(basePackages = &#123;&quot;com.lyf&quot;&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringConfig</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æµ‹è¯•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">  <span class="type">ApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AnnotationConfigApplicationContext</span>(SpringConfig.class);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// æ§åˆ¶å°æ‰“å°ï¼šcom.lyf</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> åç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> spring </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>springæ•´åˆMyBatis</title>
      <link href="/post/31.html"/>
      <url>/post/31.html</url>
      
        <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>spring xml æ•´åˆç¬¬ä¸‰æ–¹æ¡†æ¶æœ‰ä¸¤ç§æ•´åˆæ–¹æ¡ˆï¼š</p><ul><li>ä¸éœ€è¦è‡ªå®šä¹‰åç©ºé—´ï¼Œä¸éœ€è¦ä½¿ç”¨Springçš„é…ç½®æ–‡ä»¶é…ç½®ç¬¬ä¸‰æ–¹æ¡†æ¶æœ¬èº«å†…å®¹ï¼Œä¾‹å¦‚ï¼šMyBatis</li><li>éœ€è¦å¼•å…¥ç¬¬ä¸‰æ–¹æ¡†æ¶å‘½åç©ºé—´ï¼Œéœ€è¦ä½¿ç”¨ Spring çš„é…ç½®æ–‡ä»¶é…ç½®ç¬¬ä¸‰æ–¹æ¡†æ¶æœ¬èº«å†…å®¹ï¼Œä¾‹å¦‚ï¼šDubbo</li></ul><h1 id="MyBatisåŸå§‹æ“ä½œ"><a href="#MyBatisåŸå§‹æ“ä½œ" class="headerlink" title="MyBatisåŸå§‹æ“ä½œ"></a>MyBatisåŸå§‹æ“ä½œ</h1><ol><li>å¯¼å…¥åæ ‡</li></ol><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--mybatis--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.5.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--mysqlé©±åŠ¨--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>8.0.22<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--lombok--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.18.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><ol><li>æ•°æ®åº“åˆ›è¡¨</li></ol><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `tb_user` (</span><br><span class="line">  `id` <span class="type">int</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `username` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `password` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb4 <span class="keyword">COLLATE</span><span class="operator">=</span>utf8mb4_0900_ai_ci;</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> tb_user <span class="keyword">values</span> (<span class="number">1</span>, &quot;zhangsan&quot;, &quot;zz&quot;), (<span class="number">2</span>, &quot;lisi&quot;, &quot;zz&quot;);</span><br></pre></td></tr></table></figure><ol><li>å‡†å¤‡å®ä½“ç±»Userï¼ŒUserMapper.javaï¼ŒUserMapper.xml</li></ol><p>User.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>UserMapper.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserMapper</span> &#123;</span><br><span class="line">    List&lt;User&gt; <span class="title function_">findAll</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>UserMapper.xml</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span> <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.lyf.mapper.UserMapper&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findAll&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.lyf.entity.User&quot;</span>&gt;</span></span><br><span class="line">        select * from tb_user;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure><ol><li>MyBatis é…ç½®æ–‡ä»¶</li></ol><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">configuration</span></span></span><br><span class="line"><span class="meta">        <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">environments</span> <span class="attr">default</span>=<span class="string">&quot;development&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">&quot;development&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">&quot;JDBC&quot;</span>/&gt;</span></span><br><span class="line">          <span class="comment">&lt;!-- æ•°æ®æº --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">&quot;POOLED&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driver&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;jdbc:mysql://localhost:3306/test?serverTimezone=Asia/Shanghai&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">environments</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!--æ‰«æ Mapper --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">&quot;com.lyf.mapper&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure><ol><li>ç¼–å†™ä¸»ç±»</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="type">InputStream</span> <span class="variable">in</span> <span class="operator">=</span> Resources.getResourceAsStream(<span class="string">&quot;mybatis-config.xml&quot;</span>);</span><br><span class="line">    <span class="type">SqlSessionFactoryBuilder</span> <span class="variable">builder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBuilder</span>();</span><br><span class="line">    <span class="type">SqlSessionFactory</span> <span class="variable">sqlSessionFactory</span> <span class="operator">=</span> builder.build(in);</span><br><span class="line">    <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> sqlSessionFactory.openSession();</span><br><span class="line">    <span class="type">UserMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> sqlSession.getMapper(UserMapper.class);</span><br><span class="line">    List&lt;User&gt; users = mapper.findAll();</span><br><span class="line">    <span class="keyword">for</span> (User user : users) &#123;</span><br><span class="line">      System.out.println(user);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="Spring-æ•´åˆ-MyBatisã€xmlã€‘"><a href="#Spring-æ•´åˆ-MyBatisã€xmlã€‘" class="headerlink" title="Spring æ•´åˆ MyBatisã€xmlã€‘"></a>Spring æ•´åˆ MyBatisã€xmlã€‘</h1><p>MyBatis æä¾›äº† mybatis-spring.jar ä¸“é—¨ç”¨äºä¸¤å¤§æ¡†æ¶çš„æ•´åˆã€‚</p><p>Spring æ•´åˆ MyBatis çš„æ­¥éª¤å¦‚ä¸‹ï¼š</p><ul><li>å¯¼å…¥ MyBatis æ•´åˆ Spring çš„ç›¸å…³åæ ‡</li><li>ç¼–å†™ Mapper å’Œ Mapper.xml</li><li>é…ç½® SqlSessionFactoryBean å’Œ MapperScannerConfigurer</li><li>ç¼–å†™æµ‹è¯•ä»£ç </li></ul><ol><li>åœ¨ä¸Šé¢çš„åŸºç¡€ä¸Šï¼Œå¯¼å…¥é¢å¤–çš„åŒ…</li></ol><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--spring-context--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.3.7<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span>        </span><br><span class="line"><span class="comment">&lt;!--mybatis-spring--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.0.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--spring-jdbc--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.2.13.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--druid--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.23<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><ol><li>ç¼–å†™ Mapper å’Œ Mapper.xml</li></ol><blockquote><p>å’Œä¸Šé¢ä¸€æ ·</p></blockquote><ol><li>é…ç½® SqlSessionFactoryBean å’Œ MapperScannerConfigurer</li></ol><p>application-context.xml å–ä»£åŸæ¥çš„ mybatis-config.xml</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--é…ç½®æ•°æ®æº--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;datasource&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.alibaba.druid.pool.DruidDataSource&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;jdbc:mysql://localhost:3306/test?serverTimezone=Asia/Shanghai&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;rootroot&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--é…ç½® SqlSessionFactoryBean--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.mybatis.spring.SqlSessionFactoryBean&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;datasource&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--é…ç½® Mapper åŒ…æ‰«æ--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.mybatis.spring.mapper.MapperScannerConfigurer&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;basePackage&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.lyf.mapper&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><ol><li>ç¼–å†™æµ‹è¯•ä»£ç </li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">  <span class="type">ApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;application-context.xml&quot;</span>);</span><br><span class="line">  <span class="type">UserMapper</span> <span class="variable">userMapper</span> <span class="operator">=</span> context.getBean(UserMapper.class);</span><br><span class="line">  List&lt;User&gt; users = userMapper.findAll();</span><br><span class="line">  <span class="keyword">for</span> (User user : users) &#123;</span><br><span class="line">    System.out.println(user);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="æ•´åˆåŸç†ã€xmlã€‘"><a href="#æ•´åˆåŸç†ã€xmlã€‘" class="headerlink" title="æ•´åˆåŸç†ã€xmlã€‘"></a>æ•´åˆåŸç†ã€xmlã€‘</h1><blockquote><p><a href="https://www.bilibili.com/video/BV1rt4y1u7q5?p=60">https://www.bilibili.com/video/BV1rt4y1u7q5?p=60</a></p><p><a href="https://www.bilibili.com/video/BV1rt4y1u7q5?p=61">https://www.bilibili.com/video/BV1rt4y1u7q5?p=61</a></p></blockquote><p>æ•´åˆåŒ…é‡Œæä¾›äº†ä¸€ä¸ª SqlSessionFactoryBean å’Œä¸€ä¸ªæ‰«æ Mapper çš„é…ç½®å¯¹è±¡ï¼ŒSqlSessionFactoryBean ä¸€æ—¦è¢«å®ä¾‹åŒ–ï¼Œå°±å¼€å§‹æ‰«æ Mapper å¹¶é€šè¿‡åŠ¨æ€ä»£ç†äº§ç”Ÿ Mapper çš„å®ç°ç±»å­˜å‚¨åˆ° Spring å®¹å™¨ä¸­ã€‚</p><p>ç›¸å…³çš„æœ‰å¦‚ä¸‹å››ä¸ªç±»ï¼š</p><ul><li>SqlSessionFactoryBeanï¼šéœ€è¦è¿›è¡Œé…ç½®ï¼Œç”¨äºæä¾› SqlSessionFactory</li><li>MapperScannerConfigurerï¼šéœ€è¦è¿›è¡Œé…ç½®ï¼Œç”¨äºæ‰«ææŒ‡å®š mapper æ³¨å†Œ BeanDefinition</li><li>MapperFactoryBeanï¼šMapper çš„ FactoryBeanï¼Œè·å¾—æŒ‡å®š Mapper æ—¶è°ƒç”¨ getObject æ–¹æ³•</li><li>ClassPathMapperScannerï¼šdefinition.setAutowireMode(2) ä¿®æ”¹äº†è‡ªåŠ¨æ³¨å…¥çŠ¶æ€ï¼Œæ‰€ä»¥ MapperFactoryBean ä¸­çš„ setSqlSessionFactory ä¼šè‡ªåŠ¨æ³¨å…¥è¿›å»ã€‚</li></ul><h2 id="SqlSessionFactoryBean-æºç ç²¾ç®€"><a href="#SqlSessionFactoryBean-æºç ç²¾ç®€" class="headerlink" title="SqlSessionFactoryBean æºç ç²¾ç®€"></a>SqlSessionFactoryBean æºç ç²¾ç®€</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">SqlSessionFactoryBean</span> <span class="keyword">implements</span> <span class="title class_">FactoryBean</span>&lt;SqlSessionFactory&gt;, InitializingBean&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> SqlSessionFactory sqlSessionFactory;</span><br><span class="line">    <span class="keyword">private</span> DataSource dataSource;</span><br><span class="line">    <span class="comment">// è¿™ä¸ªæ˜¯æˆ‘ä»¬åœ¨é…ç½®æ–‡ä»¶ä¸­æ³¨å…¥è°ƒç”¨çš„</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setDataSource</span><span class="params">(DataSource dataSource)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.dataSource = dataSource;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterPropertiesSet</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//åˆ›å»ºSqlSessionFactoryå¯¹è±¡</span></span><br><span class="line">        <span class="built_in">this</span>.sqlSessionFactory = <span class="built_in">this</span>.buildSqlSessionFactory();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> SqlSessionFactory <span class="title function_">getObject</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.sqlSessionFactory;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">protected</span> SqlSessionFactory <span class="title function_">buildSqlSessionFactory</span><span class="params">()</span> &#123;</span><br><span class="line">        ...</span><br><span class="line">        targetConfiguration.setDataSource(<span class="built_in">this</span>.dataSource);</span><br><span class="line">        ...</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.sqlSessionFactoryBuilder.build(targetConfiguration);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>å¤ä¹ ä¸€ä¸‹ Bean ç”Ÿå‘½å‘¨æœŸï¼šBean å®ä¾‹åŒ– -&gt; å±æ€§å¡«å…… -&gt; Awareæ¥å£ -&gt; BeanPostProcessor çš„ before() -&gt; InitializingBean çš„ afterPropertiesSet() -&gt; è‡ªå®šä¹‰åˆå§‹åŒ–æ–¹æ³• init() -&gt; BeanPostProcessor çš„ after()</p><p>æ‰€ä»¥ SqlSessionFactoryBean çš„è°ƒç”¨é¡ºåºï¼š</p><p>setDataSource() -&gt; afterPropertiesSet() -&gt; buildSqlSessionFactory() -&gt; äº§ç”ŸsqlSessionFactory</p><p>ç„¶åå¦‚æœæœ‰äººè°ƒç”¨ context.getBean(SqlSessionFactory.class) æ—¶ï¼ŒSpring å°±ä¼šè°ƒç”¨ SqlSessionFactoryBean çš„ getObject() æ–¹æ³•ï¼Œå°† sqlSessionFactory è¿”å›ç»™è°ƒç”¨è€…ã€‚</p></blockquote><h2 id="MapperScannerConfigurer-æºç ç²¾ç®€"><a href="#MapperScannerConfigurer-æºç ç²¾ç®€" class="headerlink" title="MapperScannerConfigurer æºç ç²¾ç®€"></a>MapperScannerConfigurer æºç ç²¾ç®€</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MapperScannerConfigurer</span> <span class="keyword">implements</span> <span class="title class_">BeanDefinitionRegistryPostProcessor</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">postProcessBeanDefinitionRegistry</span><span class="params">(BeanDefinitionRegistry registry)</span> &#123;</span><br><span class="line">        <span class="type">ClassPathMapperScanner</span> <span class="variable">scanner</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathMapperScanner</span>(registry);</span><br><span class="line">        scanner.scan(StringUtils.tokenizeToStringArray(<span class="built_in">this</span>.basePackage, <span class="string">&quot;,; \t\n&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>ClassPathMapperScanner å¹¶æ²¡æœ‰ scan æ–¹æ³•ï¼Œæ‰€ä»¥è°ƒç”¨å…¶çˆ¶ç±» ClassPathBeanDefinitionScanner çš„ scan æ–¹æ³•ã€‚</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ClassPathBeanDefinitionScanner</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">scan</span><span class="params">(String... basePackages)</span> &#123;</span><br><span class="line">        ...</span><br><span class="line">    <span class="built_in">this</span>.doScan(basePackages);</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">protected</span> Set&lt;BeanDefinitionHolder&gt; <span class="title function_">doScan</span><span class="params">(String... basePackages)</span> &#123;</span><br><span class="line">        <span class="comment">//å°†æ‰«æåˆ°çš„ç±»æ³¨å†Œåˆ° beanDefinitionMap ä¸­ï¼Œæ­¤æ—¶ beanClass æ˜¯å½“å‰ç±»å…¨é™å®šå</span></span><br><span class="line">        <span class="built_in">this</span>.registerBeanDefinition(definitionHolder, <span class="built_in">this</span>.registry);</span><br><span class="line">        <span class="keyword">return</span> beanDefinitions;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><p>ç”±äºæ˜¯å­ç±»è°ƒç”¨çš„ scan æ–¹æ³•ï¼Œæ‰€ä»¥ <code>this.doScan(basePackages);</code> è¿™æ¡è¯­å¥å®é™…ä¸Šæ˜¯æ‰§è¡Œçš„å­ç±»çš„ doScan æ–¹æ³•ã€‚</p><p>ç„¶åå­ç±»åˆè°ƒç”¨çˆ¶ç±»çš„ doScan æ–¹æ³•ï¼š<code>super.doScan(basePackages);</code></p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ClassPathMapperScanner</span> <span class="keyword">extends</span> <span class="title class_">ClassPathBeanDefinitionScanner</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> Set&lt;BeanDefinitionHolder&gt; <span class="title function_">doScan</span><span class="params">(String... basePackages)</span> &#123;</span><br><span class="line">        Set&lt;BeanDefinitionHolder&gt; beanDefinitions = <span class="built_in">super</span>.doScan(basePackages);</span><br><span class="line">        <span class="keyword">if</span> (!beanDefinitions.isEmpty()) </span><br><span class="line">        <span class="built_in">this</span>.processBeanDefinitions(beanDefinitions);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">processBeanDefinitions</span><span class="params">(Set&lt;BeanDefinitionHolder&gt; beanDefinitions)</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (BeanDefinitionHolder holder : beanDefinitions) &#123;</span><br><span class="line">            definition = holder.getBeanDefinition();</span><br><span class="line">            <span class="comment">//è®¾ç½® Mapper çš„ beanClass æ˜¯ org.mybatis.spring.mapper.MapperFactoryBean</span></span><br><span class="line">            definition.setBeanClass(<span class="built_in">this</span>.mapperFactoryBeanClass);</span><br><span class="line">            definition.setAutowireMode(<span class="number">2</span>); <span class="comment">//è®¾ç½® MapperBeanFactory è¿›è¡Œè‡ªåŠ¨æ³¨å…¥</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>æ€»çš„æ¥è¯´ï¼Œçˆ¶ç±»çš„ doScan é¦–å…ˆå°† <code>&lt;beanName,Mapperæ¥å£ç±»å¯¹è±¡&gt;</code> çš„ BeanDefinition æ³¨å†Œè¿› BeanDefinitionMap ä¸­</p><p>ç„¶åï¼Œå­ç±»å†å°† BeanDefinition çš„å…¨é™å®šç±»åæ”¹ä¸º MapperFactoryBeanï¼Œå› ä¸º Mapper ä½œä¸ºæ¥å£ä¸èƒ½é€šè¿‡åå°„åˆ›å»ºå¯¹è±¡ã€‚</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MapperFactoryBean</span>&lt;T&gt; <span class="keyword">implements</span> <span class="title class_">FactoryBean</span>&lt;T&gt; &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> Class&lt;T&gt; mapperInterface;</span><br><span class="line">    <span class="keyword">private</span> SqlSessionTemplate sqlSessionTemplate;<span class="comment">// SqlSessionTemplate æ˜¯ SqlSession çš„å­ç±»</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MapperFactoryBean</span><span class="params">(Class&lt;T&gt; mapperInterface)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.mapperInterface = mapperInterface;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setSqlSessionFactory</span><span class="params">(SqlSessionFactory sqlSessionFactory)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.sqlSessionTemplate = <span class="built_in">this</span>.createSqlSessionTemplate(sqlSessionFactory);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> T <span class="title function_">getObject</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.getSqlSession().getMapper(<span class="built_in">this</span>.mapperInterface);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>æœ€å MapperFactoryBean çš„ getObject æ–¹æ³•ï¼Œ å°±æ˜¯é€šè¿‡ MyBatis æä¾›çš„åŸå§‹æ–¹å¼æ¥è·å– Mapper çš„ã€‚</p></blockquote><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>SqlSessionFactoryBean ä½œä¸ºä¸€ä¸ª FactoryBeanï¼Œå‘ Spring æä¾› SqlSessionFactory</p><p>MapperScannerConfigurer ä½œä¸ºä¸€ä¸ª BeanDefinitionRegistryPostProcessorï¼Œå¯¹ Spring Bean çš„ç”Ÿå‘½å‘¨æœŸè¿›è¡Œå¹²æ‰°ï¼Œå°†æ‰«æåˆ°çš„ mapper è½¬åŒ–ä¸ºä¸€ä¸ªä¸ªçš„BeanDefinition: <code>&lt;mapperName, MapperFactoryBeançš„className&gt;</code>ï¼Œæœ€åæŠŠè¿™äº› BeanDefinition éƒ½æ³¨å†Œè¿› BeanDefinitionMap ä¸­ã€‚</p><h1 id="Springæ•´åˆMyBatisã€æ³¨è§£ã€‘"><a href="#Springæ•´åˆMyBatisã€æ³¨è§£ã€‘" class="headerlink" title="Springæ•´åˆMyBatisã€æ³¨è§£ã€‘"></a>Springæ•´åˆMyBatisã€æ³¨è§£ã€‘</h1><ol><li>å¯¼å…¥åæ ‡</li></ol><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--spring-context--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.3.7<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--mybatis--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.5.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--mybatis-spring--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.0.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--spring-jdbc--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.2.13.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--druid--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.23<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--mysql--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>8.0.22<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--lombok--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.18.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><ol><li>æ•°æ®åº“åˆ›è¡¨</li></ol><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `tb_user` (</span><br><span class="line">  `id` <span class="type">int</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `username` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `password` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb4 <span class="keyword">COLLATE</span><span class="operator">=</span>utf8mb4_0900_ai_ci;</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> tb_user <span class="keyword">values</span> (<span class="number">1</span>, &quot;zhangsan&quot;, &quot;zz&quot;), (<span class="number">2</span>, &quot;lisi&quot;, &quot;zz&quot;);</span><br></pre></td></tr></table></figure><ol><li>å‡†å¤‡å®ä½“ç±»Userï¼ŒUserMapper.javaï¼ŒUserMapper.xml</li></ol><p>User.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>UserMapper.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserMapper</span> &#123;</span><br><span class="line">    List&lt;User&gt; <span class="title function_">findAll</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>UserMapper.xml</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="line">&lt;!DOCTYPE mapper PUBLIC <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">&lt;mapper namespace=<span class="string">&quot;com.lyf.mapper.UserMapper&quot;</span>&gt;</span><br><span class="line">    &lt;select id=<span class="string">&quot;findAll&quot;</span> resultType=<span class="string">&quot;com.lyf.entity.User&quot;</span>&gt;</span><br><span class="line">        select * from tb_user;</span><br><span class="line">    &lt;/select&gt;</span><br><span class="line">&lt;/mapper&gt;</span><br></pre></td></tr></table></figure><ol><li>ç¼–å†™ jdbc.properties é…ç½®æ–‡ä»¶</li></ol><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">jdbc.driver</span>=<span class="string">com.mysql.jdbc.Driver</span></span><br><span class="line"><span class="attr">jdbc.url</span>=<span class="string">jdbc:mysql://localhost:3306/test?serverTimezone=Asia/Shanghai</span></span><br><span class="line"><span class="attr">jdbc.username</span>=<span class="string">root</span></span><br><span class="line"><span class="attr">jdbc.password</span>=<span class="string">root</span></span><br></pre></td></tr></table></figure><ol><li>ç¼–å†™ Spring çš„é…ç½®ç±»</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan(&#123;&quot;com.lyf&quot;&#125;)</span></span><br><span class="line"><span class="meta">@PropertySource(&#123;&quot;classpath:jdbc.properties&quot;&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringConfig</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li>ç¼–å†™ MyBatis çš„é…ç½®ç±»</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@MapperScan(&quot;com.lyf.mapper&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyBatisConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> DruidDataSource <span class="title function_">dataSource</span><span class="params">(</span></span><br><span class="line"><span class="params">            <span class="meta">@Value(&quot;$&#123;jdbc.driver&#125;&quot;)</span> String driver,</span></span><br><span class="line"><span class="params">            <span class="meta">@Value(&quot;$&#123;jdbc.url&#125;&quot;)</span> String url,</span></span><br><span class="line"><span class="params">            <span class="meta">@Value(&quot;$&#123;jdbc.username&#125;&quot;)</span> String username,</span></span><br><span class="line"><span class="params">            <span class="meta">@Value(&quot;$&#123;jdbc.password&#125;&quot;)</span> String password)</span> &#123;</span><br><span class="line">        <span class="type">DruidDataSource</span> <span class="variable">dataSource</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DruidDataSource</span>();</span><br><span class="line">        dataSource.setDriverClassName(driver);</span><br><span class="line">        dataSource.setUrl(url);</span><br><span class="line">        dataSource.setUsername(username);</span><br><span class="line">        dataSource.setPassword(password);</span><br><span class="line">        <span class="keyword">return</span> dataSource;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> SqlSessionFactoryBean <span class="title function_">sqlSessionFactoryBean</span><span class="params">(DruidDataSource dataSource)</span> &#123;</span><br><span class="line">        <span class="type">SqlSessionFactoryBean</span> <span class="variable">sqlSessionFactoryBean</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBean</span>();</span><br><span class="line">        sqlSessionFactoryBean.setDataSource(dataSource);</span><br><span class="line">        <span class="keyword">return</span> sqlSessionFactoryBean;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li>ç¼–å†™æµ‹è¯•ç±»</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">  <span class="type">ApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AnnotationConfigApplicationContext</span>(SpringConfig.class);</span><br><span class="line">  <span class="type">UserMapper</span> <span class="variable">userMapper</span> <span class="operator">=</span> context.getBean(UserMapper.class);</span><br><span class="line">  List&lt;User&gt; users = userMapper.findAll();</span><br><span class="line">  <span class="keyword">for</span> (User user : users) &#123;</span><br><span class="line">    System.out.println(user);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="æ•´åˆåŸç†ã€æ³¨è§£ã€‘"><a href="#æ•´åˆåŸç†ã€æ³¨è§£ã€‘" class="headerlink" title="æ•´åˆåŸç†ã€æ³¨è§£ã€‘"></a>æ•´åˆåŸç†ã€æ³¨è§£ã€‘</h1><p>æ³¨è§£æ–¹å¼ï¼ŒSpring æ•´åˆ MyBatis çš„åŸç†ï¼Œå…³é”®åœ¨äº @MapperScanï¼Œ@MapperScan ä¸æ˜¯ Spring æä¾›çš„æ³¨è§£ï¼Œæ˜¯ MyBatis ä¸ºäº†æ•´åˆ Springï¼Œåœ¨æ•´åˆåŒ… org.mybatis.spring.annotation ä¸­æä¾›çš„æ³¨è§£ï¼Œæºç å¦‚ä¸‹:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span> </span><br><span class="line"><span class="meta">@Target(&#123;ElementType.TYPE&#125;)</span> </span><br><span class="line"><span class="meta">@Documented</span> </span><br><span class="line"><span class="meta">@Import(&#123;MapperScannerRegistrar.class&#125;)</span> </span><br><span class="line"><span class="meta">@Repeatable(MapperScans.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> MapperScan &#123;</span><br><span class="line">    String[] value() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line">    String[] basePackages() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line">    Class&lt;?&gt;[] basePackageClasses() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line">    Class&lt;? <span class="keyword">extends</span> <span class="title class_">Annotation</span>&gt; annotationClass() <span class="keyword">default</span> Annotation.class; </span><br><span class="line">  <span class="comment">// ... ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é‡ç‚¹å…³æ³¨ä¸€ä¸‹ <code>@Import(&#123;MapperScannerRegistrar.class&#125;)</code> ï¼Œå½“ @MapperScan è¢«æ‰«æåŠ è½½æ—¶ï¼Œä¼šè§£æ @Import æ³¨è§£ï¼Œä»è€ŒåŠ è½½æŒ‡å®šçš„ç±»ï¼Œæ­¤å¤„å°±æ˜¯åŠ è½½äº† MapperScannerRegistrar</p><p>MapperScannerRegistrar å®ç°äº† ImportBeanDefinitionRegistrar æ¥å£ï¼ŒSpring ä¼šè‡ªåŠ¨è°ƒç”¨ registerBeanDefinitions æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¸­åˆæ³¨å†Œ MapperScannerConfigurer ç±»ï¼Œè€Œ MapperScannerConfigurer ç±»ä½œç”¨æ˜¯æ‰«æ Mapperï¼Œå‘å®¹å™¨ä¸­æ³¨å†Œ Mapper å¯¹åº”çš„ MapperFactoryBeanï¼Œå‰é¢è®²è¿‡ï¼Œæ­¤å¤„ä¸åœ¨èµ˜è¿°äº†:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MapperScannerRegistrar</span> <span class="keyword">implements</span> <span class="title class_">ImportBeanDefinitionRegistrar</span> &#123;</span><br><span class="line">  <span class="comment">//é»˜è®¤æ‰§è¡ŒregisterBeanDefinitionsæ–¹æ³•</span></span><br><span class="line">  <span class="keyword">void</span> <span class="title function_">registerBeanDefinitions</span><span class="params">(...)</span> &#123;</span><br><span class="line">    <span class="type">BeanDefinitionBuilder</span> <span class="variable">builder</span> <span class="operator">=</span> BeanDefinitionBuilder.genericBeanDefinition(MapperScannerConfigurer.class);</span><br><span class="line">    <span class="comment">//... çœç•¥å…¶ä»–ä»£ç  ...</span></span><br><span class="line">    builder.addPropertyValue(<span class="string">&quot;basePackage&quot;</span>, StringUtils.collectionToCommaDelimitedString(basePackages));</span><br><span class="line">    <span class="comment">//æ³¨å†ŒBeanDefinition</span></span><br><span class="line">    registry.registerBeanDefinition(beanName, builder.getBeanDefinition()); </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>ä¸Šé¢çš„æ ¸å¿ƒå°±æ˜¯å°† MapperScannerConfigurer æ³¨å†Œè¿› Spring å®¹å™¨ä¸­</p></blockquote><h1 id="æä¸ªé—®é¢˜"><a href="#æä¸ªé—®é¢˜" class="headerlink" title="æä¸ªé—®é¢˜"></a>æä¸ªé—®é¢˜</h1><p>xml æ–¹å¼ä¸­ï¼Œæ˜¯é€šè¿‡é…ç½®æ–‡ä»¶çš„æ–¹å¼æŠŠ basePackage ä¼ ç»™ MapperScannerConfigurerã€‚</p><p>é‚£æ³¨è§£æ–¹å¼å‘¢ï¼Ÿ MapperScannerConfigurer çš„ basePackage ä»å“ªé‡Œæ¥ï¼Ÿ</p><p>ä¸Šé¢å·²ç»çŸ¥é“ï¼ŒMapperScannerRegistrar ä¼šå°† MapperScannerConfigurer æ³¨å†Œè¿› BeanDefinitionMap ä¸­ï¼Œä½†æ˜¯ç»†èŠ‚æ²¡ç»†æŒ–ã€‚</p><p>é€šè¿‡æºç å¯ä»¥çœ‹åˆ°ï¼ŒMapperScannerRegistrar è¿˜æœ‰ä¸€è¡Œä»£ç ï¼Œæ˜¯ç»™ MapperScannerConfigurer çš„ BeanDefinition æ·»åŠ  â€œbasePackageâ€ å±æ€§çš„ã€‚</p><p>ç„¶å MapperScannerConfigurer åœ¨æ‰§è¡Œ MapperScannerConfigurer æ—¶ï¼Œå°±ä¼šå–å‡ºè‡ªå·±çš„BeanDefinitionçš„ â€œbasePackageâ€ å±æ€§çš„å€¼ã€‚</p><blockquote><p>æ³¨ï¼šMapperScannerConfigurer çš„ postProcessBeanDefinitionRegistry æ–¹æ³•ï¼Œä½œç”¨æ˜¯æ ¹æ® basePackage æ¥æ‰«æ mapperï¼ŒæŠŠæ‰«æåˆ°çš„ mapper å°è£…æˆ BeanDefinition ï¼Œç„¶åæ³¨å†Œè¿› BeanDefinitionMap ä¸­ã€‚</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> åç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> spring </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>AOPå…¥é—¨</title>
      <link href="/post/30.html"/>
      <url>/post/30.html</url>
      
        <content type="html"><![CDATA[<h1 id="AOP-ç›¸å…³æ¦‚å¿µ"><a href="#AOP-ç›¸å…³æ¦‚å¿µ" class="headerlink" title="AOP ç›¸å…³æ¦‚å¿µ"></a>AOP ç›¸å…³æ¦‚å¿µ</h1><p><img src="http://cdn.leesin.fun/typora/nana/img/aopç›¸å…³æ¦‚å¿µ.png" alt="aopç›¸å…³æ¦‚å¿µ"></p><h1 id="åŸºäº-XML-çš„-AOP"><a href="#åŸºäº-XML-çš„-AOP" class="headerlink" title="åŸºäº XML çš„ AOP"></a>åŸºäº XML çš„ AOP</h1><h2 id="å¿«é€Ÿå…¥é—¨"><a href="#å¿«é€Ÿå…¥é—¨" class="headerlink" title="å¿«é€Ÿå…¥é—¨"></a>å¿«é€Ÿå…¥é—¨</h2><ol><li>å¯¼å…¥åæ ‡</li></ol><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.3.22<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.aspectj<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aspectjweaver<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.9.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><ol><li>å‡†å¤‡ç›®æ ‡ç±»ã€å¢å¼ºç±»ï¼Œå¹¶äº¤ç”± Spring ç®¡ç†</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">show</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">show</span><span class="params">()</span> &#123;System.out.println(<span class="string">&quot;show...&quot;</span>);&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyAdvice</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">beforeMethod</span><span class="params">()</span> &#123;System.out.println(<span class="string">&quot;å‰ç½®å¢å¼º...&quot;</span>);&#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterMethod</span><span class="params">()</span> &#123;System.out.println(<span class="string">&quot;åç½®å¢å¼º...&quot;</span>);&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li>é…ç½®åˆ‡ç‚¹è¡¨è¾¾å¼ï¼ˆå“ªäº›æ–¹æ³•è¢«å¢å¼ºï¼‰</li><li>é…ç½®ç»‡å…¥ï¼ˆåˆ‡ç‚¹è¢«å“ªäº›é€šçŸ¥æ–¹æ³•å¢å¼ºï¼Œæ˜¯å“ªç§å¢å¼ºç±»å‹ï¼‰</li></ol><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:aop</span>=<span class="string">&quot;http://www.springframework.org/schema/aop&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;</span></span></span><br><span class="line"><span class="string"><span class="tag">       http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">       http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userService&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.lyf.service.impl.UserServiceImpl&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;myAdvice&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.lyf.advice.MyAdvice&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--é…ç½®åˆ‡ç‚¹è¡¨è¾¾å¼,å¯¹å“ªäº›æ–¹æ³•è¿›è¡Œå¢å¼º--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">id</span>=<span class="string">&quot;myPointcut&quot;</span> <span class="attr">expression</span>=<span class="string">&quot;execution(void com.lyf.service.impl.*.*(..))&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--åˆ‡é¢=åˆ‡ç‚¹+é€šçŸ¥--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:aspect</span> <span class="attr">ref</span>=<span class="string">&quot;myAdvice&quot;</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--æŒ‡å®šå‰ç½®é€šçŸ¥æ–¹æ³•æ˜¯beforeMethod--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">aop:before</span> <span class="attr">method</span>=<span class="string">&quot;beforeMethod&quot;</span> <span class="attr">pointcut-ref</span>=<span class="string">&quot;myPointcut&quot;</span>/&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--æŒ‡å®šåç½®é€šçŸ¥æ–¹æ³•æ˜¯afterMethod--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">aop:after-returning</span> <span class="attr">method</span>=<span class="string">&quot;afterMethod&quot;</span> <span class="attr">pointcut-ref</span>=<span class="string">&quot;myPointcut&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">aop:aspect</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure><ol><li>æµ‹è¯•</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">App</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">ApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;applicationContext.xml&quot;</span>);</span><br><span class="line">        <span class="type">UserService</span> <span class="variable">userService</span> <span class="operator">=</span> context.getBean(UserService.class);</span><br><span class="line">        userService.show();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li>è¾“å‡º</li></ol><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">å‰ç½®å¢å¼º...</span><br><span class="line">show...</span><br><span class="line">åç½®å¢å¼º...</span><br></pre></td></tr></table></figure><h2 id="åˆ‡ç‚¹è¡¨è¾¾å¼"><a href="#åˆ‡ç‚¹è¡¨è¾¾å¼" class="headerlink" title="åˆ‡ç‚¹è¡¨è¾¾å¼"></a>åˆ‡ç‚¹è¡¨è¾¾å¼</h2><p>è¯­æ³•å¦‚ä¸‹</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">execution([è®¿é—®ä¿®é¥°ç¬¦] è¿”å›å€¼ç±»å‹ åŒ…å.ç±»å.æ–¹æ³•å(å‚æ•°))</span><br></pre></td></tr></table></figure><blockquote><ul><li>è®¿é—®ä¿®é¥°ç¬¦å¯ä»¥çœç•¥ä¸å†™</li><li>è¿”å›å€¼ç±»å‹ã€æŸä¸€çº§åŒ…åã€ç±»åã€æ–¹æ³•å å¯ä»¥ä½¿ç”¨ * è¡¨ç¤ºä»»æ„</li><li>åŒ…åä¸ç±»åä¹‹é—´ä½¿ç”¨å•ç‚¹ . è¡¨ç¤ºè¯¥åŒ…ä¸‹çš„ç±»ï¼Œä½¿ç”¨åŒç‚¹ .. è¡¨ç¤ºè¯¥åŒ…åŠå…¶å­åŒ…ä¸‹çš„ç±»</li><li>å‚æ•°åˆ—è¡¨å¯ä»¥ä½¿ç”¨ä¸¤ä¸ªç‚¹ .. è¡¨ç¤ºä»»æ„å‚æ•°</li></ul></blockquote><p>ä¾‹å¦‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//è¡¨ç¤ºè®¿é—®ä¿®é¥°ç¬¦ä¸ºpublicã€æ— è¿”å›å€¼ã€åœ¨com.itheima.aopåŒ…ä¸‹çš„TargetImplç±»çš„æ— å‚æ–¹æ³•show</span></span><br><span class="line">execution(<span class="keyword">public</span> <span class="keyword">void</span> com.itheima.aop.TargetImpl.show())</span><br><span class="line"></span><br><span class="line"><span class="comment">//è¡¨è¿°com.itheima.aopåŒ…ä¸‹çš„TargetImplç±»çš„ä»»æ„æ–¹æ³•</span></span><br><span class="line">execution(* com.itheima.aop.TargetImpl.*(..))</span><br><span class="line"></span><br><span class="line"><span class="comment">//è¡¨ç¤ºcom.itheima.aopåŒ…ä¸‹çš„ä»»æ„ç±»çš„ä»»æ„æ–¹æ³•</span></span><br><span class="line">execution(* com.itheima.aop.*.*(..))</span><br><span class="line"></span><br><span class="line"><span class="comment">//è¡¨ç¤ºcom.itheima.aopåŒ…åŠå…¶å­åŒ…ä¸‹çš„ä»»æ„ç±»çš„ä»»æ„æ–¹æ³•</span></span><br><span class="line">execution(* com.itheima.aop..*.*(..))</span><br><span class="line"></span><br><span class="line"><span class="comment">//è¡¨ç¤ºä»»æ„åŒ…ä¸­çš„ä»»æ„ç±»çš„ä»»æ„æ–¹æ³•</span></span><br><span class="line">execution(* *..*.*(..))</span><br></pre></td></tr></table></figure><h2 id="AspectJçš„äº”ç§é€šçŸ¥ç±»å‹"><a href="#AspectJçš„äº”ç§é€šçŸ¥ç±»å‹" class="headerlink" title="AspectJçš„äº”ç§é€šçŸ¥ç±»å‹"></a>AspectJçš„äº”ç§é€šçŸ¥ç±»å‹</h2><div class="table-container"><table><thead><tr><th>é€šçŸ¥åç§°</th><th>é…ç½®æ–¹å¼</th><th>æ‰§è¡Œæ—¶æœº</th></tr></thead><tbody><tr><td>å‰ç½®é€šçŸ¥</td><td>&lt; aop:before &gt;</td><td>ç›®æ ‡æ–¹æ³•æ‰§è¡Œä¹‹å‰æ‰§è¡Œ</td></tr><tr><td>åç½®é€šçŸ¥</td><td>&lt; aop:after-returning &gt;</td><td>ç›®æ ‡æ–¹æ³•æ‰§è¡Œä¹‹åæ‰§è¡Œã€‚å½“ç›®æ ‡æ–¹æ³•å¼‚å¸¸æ—¶ï¼Œä¸æ‰§è¡Œ</td></tr><tr><td>ç¯ç»•é€šçŸ¥</td><td>&lt; aop:around &gt;</td><td>ç›®æ ‡æ–¹æ³•æ‰§è¡Œå‰åæ‰§è¡Œã€‚å½“ç›®æ ‡æ–¹æ³•å¼‚å¸¸æ—¶ï¼Œä¸æ‰§è¡Œ</td></tr><tr><td>å¼‚å¸¸é€šçŸ¥</td><td>&lt; aop:after-throwing &gt;</td><td>ç›®æ ‡æ–¹æ³•æŠ›å‡ºå¼‚å¸¸æ—¶æ‰§è¡Œ</td></tr><tr><td>æœ€ç»ˆé€šçŸ¥</td><td>&lt; aop:after &gt;</td><td>ä¸ç®¡ç›®æ ‡æ–¹æ³•æ˜¯å¦æœ‰å¼‚å¸¸ï¼Œæœ€ç»ˆéƒ½ä¼šæ‰§è¡Œ</td></tr></tbody></table></div><h3 id="ç¯ç»•é€šçŸ¥"><a href="#ç¯ç»•é€šçŸ¥" class="headerlink" title="ç¯ç»•é€šçŸ¥"></a>ç¯ç»•é€šçŸ¥</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åœ¨ MyAdvice ç±»é‡Œé¢</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">around</span><span class="params">(ProceedingJoinPoint joinPoint)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">    <span class="comment">//ç¯ç»•å‰</span></span><br><span class="line">    System.out.println(<span class="string">&quot;ç¯ç»•å‰é€šçŸ¥&quot;</span>);</span><br><span class="line">    <span class="comment">//ç›®æ ‡æ–¹æ³•</span></span><br><span class="line">    joinPoint.proceed();</span><br><span class="line">    <span class="comment">///ç¯ç»•å</span></span><br><span class="line">    System.out.println(<span class="string">&quot;ç¯ç»•åé€šçŸ¥&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">aop:around</span> <span class="attr">method</span>=<span class="string">&quot;around&quot;</span> <span class="attr">pointcut-ref</span>=<span class="string">&quot;myPointcut&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>å…¶ä»–ä»£ç å’Œå‰é¢çš„ä¸€æ ·</p></blockquote><h3 id="å¼‚å¸¸é€šçŸ¥1"><a href="#å¼‚å¸¸é€šçŸ¥1" class="headerlink" title="å¼‚å¸¸é€šçŸ¥1"></a>å¼‚å¸¸é€šçŸ¥1</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">show</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;show...&quot;</span>);</span><br><span class="line">        <span class="comment">// åˆ¶é€ å¼‚å¸¸</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span> / <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åœ¨ MyAdvice ç±»é‡Œé¢</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterThrowing</span><span class="params">()</span> &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;ç›®æ ‡æ–¹æ³•æŠ›å‡ºå¼‚å¸¸äº†ï¼Œåç½®é€šçŸ¥å’Œç¯ç»•åé€šçŸ¥ä¸åœ¨æ‰§è¡Œ&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">aop:after-throwing</span> <span class="attr">method</span>=<span class="string">&quot;afterThrowing&quot;</span> <span class="attr">pointcut-ref</span>=<span class="string">&quot;myPointcut&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure><p>è¾“å‡ºå¦‚ä¸‹ï¼š<br><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">show1...</span><br><span class="line">ç›®æ ‡æ–¹æ³•æŠ›å‡ºå¼‚å¸¸äº†ï¼Œåç½®é€šçŸ¥å’Œç¯ç»•åé€šçŸ¥ä¸åœ¨æ‰§è¡Œ</span><br><span class="line">Exception in thread &quot;main&quot; java.lang.ArithmeticException: / by zero</span><br><span class="line">...</span><br></pre></td></tr></table></figure></p><h3 id="å¼‚å¸¸é€šçŸ¥2"><a href="#å¼‚å¸¸é€šçŸ¥2" class="headerlink" title="å¼‚å¸¸é€šçŸ¥2"></a>å¼‚å¸¸é€šçŸ¥2</h3><blockquote><p>å¦‚æœæƒ³è¦åœ¨ afterThrowing é€šçŸ¥æ–¹æ³•é‡Œæ‹¿åˆ° Throwable å‚æ•°ï¼Œéœ€è¦åœ¨é…ç½®æ–‡ä»¶ä¸­åŠ ä¸€ç‚¹é…ç½®</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterThrowing</span><span class="params">(Throwable e)</span> &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;ç›®æ ‡æ–¹æ³•æŠ›å‡ºå¼‚å¸¸äº†ï¼Œåç½®é€šçŸ¥å’Œç¯ç»•åé€šçŸ¥ä¸åœ¨æ‰§è¡Œ&quot;</span>);</span><br><span class="line">    System.out.println(e.getMessage());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">aop:after-throwing</span> <span class="attr">method</span>=<span class="string">&quot;afterThrowing&quot;</span> <span class="attr">pointcut-ref</span>=<span class="string">&quot;myPointcut&quot;</span> <span class="attr">throwing</span>=<span class="string">&quot;e&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure><h2 id="å¯é€‰å‚æ•°"><a href="#å¯é€‰å‚æ•°" class="headerlink" title="å¯é€‰å‚æ•°"></a>å¯é€‰å‚æ•°</h2><p>é€šçŸ¥æ–¹æ³•åœ¨è¢«è°ƒç”¨æ—¶ï¼ŒSpring å¯ä»¥ä¸ºå…¶ä¼ é€’ä¸€äº›å¿…è¦çš„å‚æ•°</p><div class="table-container"><table><thead><tr><th>å‚æ•°ç±»å‹</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>JoinPoint</td><td>è¿æ¥ç‚¹å¯¹è±¡ï¼Œä»»ä½•é€šçŸ¥éƒ½å¯ä½¿ç”¨ï¼Œå¯ä»¥è·å¾—å½“å‰ç›®æ ‡å¯¹è±¡ã€ç›®æ ‡æ–¹æ³•å‚æ•°ç­‰ä¿¡æ¯</td></tr><tr><td>ProceedingJoinPoint</td><td>JoinPoint å­ç±»å¯¹è±¡ï¼Œä¸»è¦æ˜¯åœ¨ç¯ç»•é€šçŸ¥ä¸­æ‰§è¡Œ proceed() ï¼Œè¿›è€Œæ‰§è¡Œç›®æ ‡æ–¹æ³•</td></tr><tr><td>Throwable</td><td>å¼‚å¸¸å¯¹è±¡ï¼Œä½¿ç”¨åœ¨å¼‚å¸¸é€šçŸ¥ä¸­ï¼Œéœ€è¦åœ¨é…ç½®æ–‡ä»¶ä¸­æŒ‡å‡ºå¼‚å¸¸å¯¹è±¡åç§°</td></tr></tbody></table></div><h3 id="JoinPointå¯¹è±¡"><a href="#JoinPointå¯¹è±¡" class="headerlink" title="JoinPointå¯¹è±¡"></a>JoinPointå¯¹è±¡</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> é€šçŸ¥æ–¹æ³•åç§°(JoinPoint joinPoint) &#123;</span><br><span class="line">    <span class="comment">//è·å¾—ç›®æ ‡æ–¹æ³•çš„å‚æ•°</span></span><br><span class="line">    System.out.println(joinPoint.getArgs());</span><br><span class="line">    <span class="comment">//è·å¾—ç›®æ ‡å¯¹è±¡</span></span><br><span class="line">    System.out.println(joinPoint.getTarget());</span><br><span class="line">    <span class="comment">//è·å¾—ç²¾ç¡®çš„åˆ‡ç‚¹è¡¨è¾¾å¼ä¿¡æ¯</span></span><br><span class="line">    System.out.println(joinPoint.getStaticPart());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ProceedingJoinPointå¯¹è±¡"><a href="#ProceedingJoinPointå¯¹è±¡" class="headerlink" title="ProceedingJoinPointå¯¹è±¡"></a>ProceedingJoinPointå¯¹è±¡</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Object <span class="title function_">around</span><span class="params">(ProceedingJoinPoint joinPoint)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">    System.out.println(joinPoint.getArgs());<span class="comment">//è·å¾—ç›®æ ‡æ–¹æ³•çš„å‚æ•°</span></span><br><span class="line">    System.out.println(joinPoint.getTarget());<span class="comment">//è·å¾—ç›®æ ‡å¯¹è±¡</span></span><br><span class="line">    System.out.println(joinPoint.getStaticPart());<span class="comment">//è·å¾—ç²¾ç¡®çš„åˆ‡ç‚¹è¡¨è¾¾å¼ä¿¡æ¯</span></span><br><span class="line">    <span class="type">Object</span> <span class="variable">result</span> <span class="operator">=</span> joinPoint.proceed();<span class="comment">//æ‰§è¡Œç›®æ ‡æ–¹æ³•</span></span><br><span class="line">    <span class="keyword">return</span> result;<span class="comment">//è¿”å›ç›®æ ‡æ–¹æ³•è¿”å›å€¼</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Throwableå¯¹è±¡"><a href="#Throwableå¯¹è±¡" class="headerlink" title="Throwableå¯¹è±¡"></a>Throwableå¯¹è±¡</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterThrowing</span><span class="params">(JoinPoint joinPoint,Throwable th)</span>&#123;</span><br><span class="line">    <span class="comment">//è·å¾—å¼‚å¸¸ä¿¡æ¯</span></span><br><span class="line">System.out.println(<span class="string">&quot;å¼‚å¸¸å¯¹è±¡æ˜¯ï¼š&quot;</span>+th+<span class="string">&quot;å¼‚å¸¸ä¿¡æ¯æ˜¯ï¼š&quot;</span>+th.getMessage());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">aop:after-throwing</span> <span class="attr">method</span>=<span class="string">&quot;afterThrowing&quot;</span> <span class="attr">pointcut-ref</span>=<span class="string">&quot;myPointcut&quot;</span> <span class="attr">throwing</span>=<span class="string">&quot;th&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure><h1 id="åŸºäºæ³¨è§£æ–¹å¼çš„-AOP"><a href="#åŸºäºæ³¨è§£æ–¹å¼çš„-AOP" class="headerlink" title="åŸºäºæ³¨è§£æ–¹å¼çš„ AOP"></a>åŸºäºæ³¨è§£æ–¹å¼çš„ AOP</h1><h2 id="å¿«é€Ÿå…¥é—¨-1"><a href="#å¿«é€Ÿå…¥é—¨-1" class="headerlink" title="å¿«é€Ÿå…¥é—¨"></a>å¿«é€Ÿå…¥é—¨</h2><ol><li>å¯¼å…¥åæ ‡</li></ol><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.3.22<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.aspectj<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aspectjweaver<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.9.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><ol><li>å‡†å¤‡ç›®æ ‡ç±»ã€å¢å¼ºç±»ï¼Œå¹¶äº¤ç”± Spring ç®¡ç†</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">show</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">show</span><span class="params">()</span> &#123;System.out.println(<span class="string">&quot;show...&quot;</span>);&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li>åˆ‡é¢ç±»ï¼šç¼–å†™åˆ‡ç‚¹ã€ç¼–å†™é€šçŸ¥æ–¹æ³•ã€é…ç½®ç»‡å…¥</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyAdvice</span> &#123;</span><br><span class="line">    <span class="comment">// åˆ‡ç‚¹è¡¨è¾¾å¼çš„æŠ½å–</span></span><br><span class="line">    <span class="meta">@Pointcut(&quot;execution(void com.lyf.service.impl.*.*(..))&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">myPointCut</span><span class="params">()</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Around(&quot;myPointCut()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">around</span><span class="params">(ProceedingJoinPoint pjp)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;ç¯ç»•å‰ç½®é€šçŸ¥...&quot;</span>);</span><br><span class="line">        pjp.proceed();</span><br><span class="line">        System.out.println(<span class="string">&quot;ç¯ç»•åç½®é€šçŸ¥...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li>é…ç½®ç±»ï¼šå¼€å¯ spring çš„è‡ªåŠ¨ä»£ç†ï¼Œå¼€å¯ç»„ä»¶æ‰«æ</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan(&quot;com.lyf&quot;)</span> <span class="comment">//ç”¨äºç»„ä»¶æ‰«æ</span></span><br><span class="line"><span class="comment">//@PropertySource(&quot;classpath:jdbc.properties&quot;) //ç”¨äºåŠ è½½é…ç½®æ–‡ä»¶</span></span><br><span class="line"><span class="meta">@EnableAspectJAutoProxy</span> <span class="comment">//å¼€å¯springè‡ªåŠ¨ä»£ç†</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringConfig</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>ä¸é‡è¦çš„çŸ¥è¯†ç‚¹ï¼šå¦‚æœæ˜¯new ClassPathXmlApplicationContext()ï¼Œéœ€è¦åœ¨é…ç½®æ–‡ä»¶ä¸­åŠ å…¥é…ç½®<code>&lt;aop:aspectj-autoproxy&gt;</code> ï¼Œæ¥å¼€å¯springçš„è‡ªåŠ¨ä»£ç†ã€‚</p><ol><li>æµ‹è¯•ç±»</li></ol></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">App</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">ApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AnnotationConfigApplicationContext</span>(SpringConfig.class);</span><br><span class="line">        <span class="type">UserService</span> <span class="variable">userService</span> <span class="operator">=</span> context.getBean(UserService.class);</span><br><span class="line">        userService.show();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li>è¾“å‡º</li></ol><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ç¯ç»•å‰ç½®é€šçŸ¥...</span><br><span class="line">show...</span><br><span class="line">ç¯ç»•åç½®é€šçŸ¥...</span><br></pre></td></tr></table></figure><h1 id="ç»Ÿä¸€æ—¥å¿—å¤„ç†â­"><a href="#ç»Ÿä¸€æ—¥å¿—å¤„ç†â­" class="headerlink" title="ç»Ÿä¸€æ—¥å¿—å¤„ç†â­"></a>ç»Ÿä¸€æ—¥å¿—å¤„ç†â­</h1><ol><li>åæ ‡</li></ol><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.3.7<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.16.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.aspectj<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aspectjweaver<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.9.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><ol><li>ç¼–å†™ç»Ÿä¸€æ—¥å¿—æ³¨è§£</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target(ElementType.METHOD)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> MyLog &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li>ç¼–å†™æ—¥å¿—åˆ‡é¢ç±»</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LogAspect</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Pointcut(&quot;@annotation(com.lyf.log.MyLog)&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">logPointCut</span><span class="params">()</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Around(&quot;logPointCut()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">around</span><span class="params">(ProceedingJoinPoint pjp)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        <span class="type">long</span> <span class="variable">start</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        <span class="type">Object</span> <span class="variable">result</span> <span class="operator">=</span> pjp.proceed();</span><br><span class="line">        <span class="type">long</span> <span class="variable">end</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        <span class="type">String</span> <span class="variable">className</span> <span class="operator">=</span> pjp.getTarget().getClass().getSimpleName();</span><br><span class="line">        <span class="type">MethodSignature</span> <span class="variable">methodSignature</span> <span class="operator">=</span> (MethodSignature) pjp.getSignature();</span><br><span class="line">        <span class="type">String</span> <span class="variable">methodName</span> <span class="operator">=</span> methodSignature.getMethod().getName();</span><br><span class="line">        System.out.println(className + <span class="string">&quot;.&quot;</span> + methodName + <span class="string">&quot;======è€—æ—¶ï¼š&quot;</span> + (end - start) + <span class="string">&quot;ms&quot;</span> );</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li>ç¼–å†™é…ç½®ç±»ï¼Œå¹¶å¼€å¯ spring è‡ªåŠ¨ä»£ç†</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan(&quot;com.lyf&quot;)</span></span><br><span class="line"><span class="meta">@EnableAspectJAutoProxy</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringConfig</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li>ç¼–å†™ç›®æ ‡ç±»å’Œç›®æ ‡æ–¹æ³•</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserDao</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">say1</span><span class="params">()</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">say2</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserDaoImpl</span> <span class="keyword">implements</span> <span class="title class_">UserDao</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="meta">@MyLog</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">say1</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;say1...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">say2</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(<span class="number">2000</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;say2...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li>ç¼–å†™æµ‹è¯•ç±»</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">App</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">ApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AnnotationConfigApplicationContext</span>(SpringConfig.class);</span><br><span class="line">        <span class="type">UserDao</span> <span class="variable">userDao</span> <span class="operator">=</span> context.getBean(UserDao.class);</span><br><span class="line">        userDao.say1();</span><br><span class="line">        System.out.println(<span class="string">&quot;-----------&quot;</span>);</span><br><span class="line">        userDao.say2();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li>è¾“å‡º</li></ol><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">say1...</span><br><span class="line">UserDaoImpl.say1======è€—æ—¶ï¼š1006ms</span><br><span class="line">-----------</span><br><span class="line">say2...</span><br></pre></td></tr></table></figure><blockquote><p>å¯ä»¥çœ‹åˆ°ï¼Œåœ¨ say1 æ–¹æ³•ä¸ŠåŠ äº†ç»Ÿä¸€æ—¥å¿—æ³¨è§£ï¼Œæ‰€ä»¥say1è¢«å¢å¼ºäº†ã€‚say2 æ­£å¸¸æ‰§è¡Œã€‚</p></blockquote><h2 id="AOPçš„å¦ä¸€ç§é…ç½®æ–¹å¼â€”â€”-Advice"><a href="#AOPçš„å¦ä¸€ç§é…ç½®æ–¹å¼â€”â€”-Advice" class="headerlink" title="AOPçš„å¦ä¸€ç§é…ç½®æ–¹å¼â€”â€”-Advice"></a>AOPçš„å¦ä¸€ç§é…ç½®æ–¹å¼â€”â€”-Advice</h2><p>AOP çš„å¦ä¸€ç§é…ç½®æ–¹å¼ï¼Œè¯¥æ–¹å¼éœ€è¦é€šçŸ¥ç±»å®ç° Advice çš„å­åŠŸèƒ½æ¥å£</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Advice</span> &#123; &#125;</span><br></pre></td></tr></table></figure><p>Advice çš„å­åŠŸèƒ½æ¥å£</p><p><img src="http://cdn.leesin.fun/typora/macpro/img/image-20230511183755898.png" alt="image-20230511183755898"></p><p>ä¾‹å¦‚ï¼šé€šçŸ¥ç±»å®ç°äº†å‰ç½®é€šçŸ¥å’Œåç½®é€šçŸ¥æ¥å£</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyAdvice</span> <span class="keyword">implements</span> <span class="title class_">MethodBeforeAdvice</span>, AfterReturningAdvice &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">before</span><span class="params">(Method method, Object[] objects, Object o)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;å‰ç½®é€šçŸ¥...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterReturning</span><span class="params">(Object o, Method method, Object[] objects, Object o1)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;åç½®é€šçŸ¥...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆ‡é¢ä½¿ç”¨ advisor æ ‡ç­¾é…ç½®</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--ç»‡å…¥ï¼šå°†é€šçŸ¥å’Œåˆ‡ç‚¹è¿›è¡Œç»“åˆ--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">aop:advisor</span> <span class="attr">advice-ref</span>=<span class="string">&quot;myAdvice&quot;</span> <span class="attr">pointcut</span>=<span class="string">&quot;execution(* com.lyf.dao.impl.UserDaoImpl.*(..))&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br></pre></td></tr></table></figure><p>åˆä¾‹å¦‚ï¼šé€šçŸ¥ç±»å®ç°äº†æ–¹æ³•æ‹¦æˆªå™¨æ¥å£</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyAdvice2</span> <span class="keyword">implements</span> <span class="title class_">MethodInterceptor</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">invoke</span><span class="params">(MethodInvocation methodInvocation)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;ç¯ç»•å‰ç½®...&quot;</span>);</span><br><span class="line">        <span class="type">Object</span> <span class="variable">result</span> <span class="operator">=</span></span><br><span class="line">                methodInvocation.getMethod().invoke(methodInvocation.getThis(), methodInvocation.getArguments());</span><br><span class="line">        System.out.println(<span class="string">&quot;ç¯ç»•åç½®...&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆ‡é¢ä½¿ç”¨ advisor æ ‡ç­¾é…ç½®</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;aop:config&gt;</span><br><span class="line">  &lt;!--ç»‡å…¥ï¼šå°†é€šçŸ¥å’Œåˆ‡ç‚¹è¿›è¡Œç»“åˆ--&gt;</span><br><span class="line">  &lt;aop:advisor advice-ref=<span class="string">&quot;myAdvice2&quot;</span> pointcut=<span class="string">&quot;execution(* com.lyf.dao.impl.UserDaoImpl.*(..))&quot;</span>/&gt;</span><br><span class="line">&lt;/aop:config&gt;</span><br></pre></td></tr></table></figure><blockquote><ul><li>å®é™…å¼€å‘ä¸­ï¼Œè‡ªå®šä¹‰ aop åŠŸèƒ½çš„é…ç½®å¤§å¤šä½¿ç”¨ aspect çš„é…ç½®æ–¹å¼ï¼Œ</li><li>å­¦ä¹  advisor æ˜¯ä¸ºäº†åé¢å­¦ä¹  Spring å£°æ˜å¼äº‹åŠ¡æ§åˆ¶åšé“ºå«ã€‚</li></ul></blockquote>]]></content>
      
      
      <categories>
          
          <category> åç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> spring </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Springæ³¨è§£å¼€å‘</title>
      <link href="/post/29.html"/>
      <url>/post/29.html</url>
      
        <content type="html"><![CDATA[<h1 id="Springæ³¨è§£å¼€å‘"><a href="#Springæ³¨è§£å¼€å‘" class="headerlink" title="Springæ³¨è§£å¼€å‘"></a>Springæ³¨è§£å¼€å‘</h1><h2 id="Component"><a href="#Component" class="headerlink" title="@Component"></a>@Component</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//è·å–æ–¹å¼:applicationContext.getBean(&quot;userDao&quot;); </span></span><br><span class="line"><span class="meta">@Component(&quot;userDao&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserDaoImpl</span> <span class="keyword">implements</span> <span class="title class_">UserDao</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//è·å–æ–¹å¼:applicationContext.getBean(&quot;userDaoImpl&quot;); </span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserDaoImpl</span> <span class="keyword">implements</span> <span class="title class_">UserDao</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="beanæ ‡ç­¾çš„å±æ€§å¯¹åº”å…³ç³»"><a href="#beanæ ‡ç­¾çš„å±æ€§å¯¹åº”å…³ç³»" class="headerlink" title="beanæ ‡ç­¾çš„å±æ€§å¯¹åº”å…³ç³»"></a>beanæ ‡ç­¾çš„å±æ€§å¯¹åº”å…³ç³»</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;&quot;</span> <span class="attr">name</span>=<span class="string">&quot;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;&quot;</span> <span class="attr">scope</span>=<span class="string">&quot;&quot;</span> <span class="attr">lazy-init</span>=<span class="string">&quot;&quot;</span> <span class="attr">init-method</span>=<span class="string">&quot;&quot;</span> <span class="attr">destroy-method</span>=<span class="string">&quot;&quot;</span> <span class="attr">abstract</span>=<span class="string">&quot;&quot;</span> <span class="attr">autowire</span>=<span class="string">&quot;&quot;</span> <span class="attr">factory-bean</span>=<span class="string">&quot;&quot;</span> <span class="attr">factory-method</span>=<span class="string">&quot;&quot;</span>&gt;</span> <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><div class="table-container"><table><thead><tr><th>xmlé…ç½®</th><th>æ³¨è§£</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>&lt;bean scope=&quot;&quot;&gt;</code></td><td>@Scope</td><td>åœ¨ç±»ä¸Šæˆ–ä½¿ç”¨äº†@Beanæ ‡æ³¨çš„æ–¹æ³•ä¸Šï¼Œæ ‡æ³¨Beançš„ä½œç”¨èŒƒå›´ï¼Œå–å€¼ä¸º singletonæˆ–prototype</td></tr><tr><td><code>&lt;bean lazy-init=&quot;&quot;&gt;</code></td><td>@Lazy</td><td>åœ¨ç±»ä¸Šæˆ–ä½¿ç”¨äº†@Beanæ ‡æ³¨çš„æ–¹æ³•ä¸Šï¼Œæ ‡æ³¨Beanæ˜¯å¦å»¶è¿ŸåŠ è½½ï¼Œå–å€¼ä¸º trueå’Œfalse</td></tr><tr><td><code>&lt;bean init-method=&quot;&quot;&gt;</code></td><td>@PostConstruct</td><td>åœ¨æ–¹æ³•ä¸Šä½¿ç”¨ï¼Œæ ‡æ³¨Beançš„å®ä¾‹åŒ–åæ‰§è¡Œçš„æ–¹æ³•</td></tr><tr><td><code>&lt;bean destroy-method=&quot;&quot;&gt;</code></td><td>@PreDestroy</td><td>åœ¨æ–¹æ³•ä¸Šä½¿ç”¨ï¼Œæ ‡æ³¨Beançš„é”€æ¯å‰æ‰§è¡Œæ–¹æ³•</td></tr></tbody></table></div><p>ä¾‹å¦‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component(&quot;userDao&quot;)</span></span><br><span class="line"><span class="meta">@Scope(&quot;singleton&quot;)</span></span><br><span class="line"><span class="meta">@Lazy(true)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserDaoImpl</span> <span class="keyword">implements</span> <span class="title class_">UserDao</span>&#123;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@PostConstruct</span> </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span>&#123;&#125;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@PreDestroy</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">destroy</span><span class="params">()</span>&#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="beanæ ‡ç­¾çš„å­—æ ‡ç­¾å¯¹åº”å…³ç³»"><a href="#beanæ ‡ç­¾çš„å­—æ ‡ç­¾å¯¹åº”å…³ç³»" class="headerlink" title="beanæ ‡ç­¾çš„å­—æ ‡ç­¾å¯¹åº”å…³ç³»"></a>beanæ ‡ç­¾çš„å­—æ ‡ç­¾å¯¹åº”å…³ç³»</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&quot;</span>/&gt;</span> </span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><div class="table-container"><table><thead><tr><th>å±æ€§æ³¨å…¥æ³¨è§£</th><th>æè¿°</th></tr></thead><tbody><tr><td>@Value</td><td>ä½¿ç”¨åœ¨å­—æ®µæˆ–æ–¹æ³•ä¸Šï¼Œç”¨äºæ³¨å…¥æ™®é€šæ•°æ®</td></tr><tr><td>@Autowired</td><td>ä½¿ç”¨åœ¨å­—æ®µæˆ–æ–¹æ³•ä¸Šï¼Œç”¨äºæ ¹æ®ç±»å‹(byType)æ³¨å…¥å¼•ç”¨æ•°æ®</td></tr><tr><td>@Qualifier</td><td>ä½¿ç”¨åœ¨å­—æ®µæˆ–æ–¹æ³•ä¸Šï¼Œç»“åˆ@Autowiredï¼Œæ ¹æ®åç§°æ³¨å…¥</td></tr><tr><td>@Resource</td><td>ä½¿ç”¨åœ¨å­—æ®µæˆ–æ–¹æ³•ä¸Šï¼Œæ ¹æ®ç±»å‹æˆ–åç§°è¿›è¡Œæ³¨å…¥</td></tr></tbody></table></div><p>ä¾‹å¦‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Value(&quot;haohao&quot;)</span> </span><br><span class="line"><span class="keyword">private</span> String str;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿˜æ”¯æŒä¸€äº› SpEL è¡¨è¾¾å¼</span></span><br><span class="line"><span class="meta">@Value(&quot;$&#123;jdbc.username&#125;&quot;)</span> </span><br><span class="line"><span class="keyword">private</span> String username;</span><br></pre></td></tr></table></figure><blockquote><p>@Autowired é»˜è®¤ ByType æ³¨å…¥ã€‚ä½†æ˜¯å¦‚æœç±»å‹æœ‰å¤šä¸ªï¼Œå°±ä¼š ByName æ³¨å…¥ï¼Œé»˜è®¤æ ¹æ®å±æ€§åç§°æ³¨å…¥ã€‚</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component(&quot;userDao1&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserDaoImpl1</span> <span class="keyword">implements</span> <span class="title class_">UserDao</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">say</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æˆ‘æ˜¯1&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component(&quot;userDao2&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserDaoImpl2</span> <span class="keyword">implements</span> <span class="title class_">UserDao</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">say</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æˆ‘æ˜¯2&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// è¿™é‡Œæœ‰ä¸¤ä¸ª UserDao ç±»å‹ï¼Œ</span></span><br><span class="line">    <span class="comment">// æ‰€ä»¥æ ¹æ® BeanName=&quot;userDao1&quot; æ¥æ³¨å…¥</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserDao userDao1;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">App</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">ApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AnnotationConfigApplicationContext</span>(<span class="string">&quot;com.lyf&quot;</span>);</span><br><span class="line">        <span class="type">UserService</span> <span class="variable">userService</span> <span class="operator">=</span> context.getBean(UserService.class);</span><br><span class="line">        ((UserServiceImpl)userService).getUserDao1().say(); <span class="comment">// æˆ‘æ˜¯1</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>å¦‚æœå½“æœ‰å¤šä¸ª UserDao ç±»å‹çš„å¯¹è±¡ï¼Œä¸”åˆä¸æƒ³ç”¨é»˜è®¤çš„ ä»¥å±æ€§åä½œä¸º BeanName çš„ ByName æ–¹å¼æ³¨å…¥ã€‚</p><p>é‚£ä¹ˆå¯ä»¥é…åˆ @Qualifier æ¥æŒ‡å®š BeanNameï¼Œè¿™é‡Œå°±ä¸æ¼”ç¤ºäº†ã€‚</p><p>ä¹Ÿå¯ä»¥ç”¨@Resourceï¼Œæ­¤æ³¨è§£å¦‚æœä¸æŒ‡å®šnameå±æ€§ï¼Œé»˜è®¤name=å±æ€§åï¼Œå¦‚æœæŒ‡å®šäº†nameå±æ€§çš„å€¼ï¼Œé‚£å°±æŒ‰ç…§æŒ‡å®šå€¼æ¥æ³¨å…¥ã€‚</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="meta">@Resource(name = &quot;userDao2&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> UserDao xxx;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="éè‡ªå®šä¹‰-Bean-çš„æ³¨å…¥"><a href="#éè‡ªå®šä¹‰-Bean-çš„æ³¨å…¥" class="headerlink" title="éè‡ªå®šä¹‰ Bean çš„æ³¨å…¥"></a>éè‡ªå®šä¹‰ Bean çš„æ³¨å…¥</h2><p>å¦‚æœ @Bean å·¥å‚æ–¹æ³•éœ€è¦<strong>å‚æ•°</strong>çš„è¯ï¼Œåˆ™æœ‰å¦‚ä¸‹å‡ ç§æ³¨å…¥æ–¹å¼:</p><ul><li>ä½¿ç”¨ @Autowired æ ¹æ®ç±»å‹è‡ªåŠ¨è¿›è¡ŒBeançš„åŒ¹é…ï¼Œ<strong>@Autowired å¯ä»¥çœç•¥</strong> </li><li>ä½¿ç”¨ @Qualifier æ ¹æ®åç§°è¿›è¡Œ Bean çš„åŒ¹é…</li><li>ä½¿ç”¨ @Value æ³¨å…¥åŸºæœ¬æ•°æ®ç±»å‹</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span> <span class="comment">// äº¤ç”± spring ç®¡ç†</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OtherBeanConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span> <span class="comment">// ä¸æŒ‡å®šå€¼ï¼Œé»˜è®¤å°±æ˜¯æ–¹æ³•åï¼Œå³ otherBean</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">otherBean</span><span class="params">(UserDao userDao, // æ ¹æ®ç±»å‹æ³¨å…¥ï¼Œçœç•¥äº† <span class="meta">@Autowired</span></span></span><br><span class="line"><span class="params">                               <span class="meta">@Qualifier(&quot;userService&quot;)</span> UserService userService, // æ ¹æ® beanName è¿›è¡Œæ³¨å…¥</span></span><br><span class="line"><span class="params">                               <span class="meta">@Value(&quot;zhangsan&quot;)</span> String username)</span>&#123; <span class="comment">// æ³¨å…¥åŸºæœ¬ç±»å‹</span></span><br><span class="line">        System.out.println(userDao);</span><br><span class="line">        System.out.println(userService);</span><br><span class="line">        System.out.println(username);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="é…ç½®ç±»"><a href="#é…ç½®ç±»" class="headerlink" title="é…ç½®ç±»"></a>é…ç½®ç±»</h2><p>xmlæ–¹å¼</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- åŠ è½½propertiesæ–‡ä»¶ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">location</span>=<span class="string">&quot;classpath:jdbc.properties&quot;</span>/&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- ç»„ä»¶æ‰«æ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.itheima&quot;</span>/&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- å¼•å…¥å…¶ä»–xmlæ–‡ä»¶ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">import</span> <span class="attr">resource</span>=<span class="string">&quot;classpath:beans.xml&quot;</span>/&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- å¼€å¯springè‡ªåŠ¨ä»£ç† --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">aop:aspectj-autoproxy</span>&gt;</span></span><br></pre></td></tr></table></figure><p>é…ç½®ç±»æ³¨è§£æ–¹å¼</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan(&quot;com.lyf&quot;)</span> <span class="comment">// &lt;context:component-scan base-package=&quot;&quot;/&gt;</span></span><br><span class="line"><span class="meta">@PropertySource(&quot;classpath:jdbc.properties&quot;)</span>  <span class="comment">//&lt;context:property-placeholder location=â€œâ€/&gt;</span></span><br><span class="line"><span class="meta">@Import(OtherConfig.class)</span> <span class="comment">// &lt;import resource=â€œclasspath:beans.xmlâ€/&gt;</span></span><br><span class="line"><span class="meta">@EnableAspectJAutoProxy</span> <span class="comment">// &lt;aop:aspectj-autoproxy&gt;</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ApplicationContextConfig</span> &#123;&#125;</span><br></pre></td></tr></table></figure><p>base-packageçš„é…ç½®æ–¹å¼:</p><ul><li>æŒ‡å®šä¸€ä¸ªæˆ–å¤šä¸ªåŒ…åï¼šæ‰«ææŒ‡å®šåŒ…åŠå…¶å­åŒ…ä¸‹ä½¿ç”¨æ³¨è§£çš„ç±»</li><li>ä¸é…ç½®åŒ…åï¼šæ‰«æå½“å‰ @componentScan æ³¨è§£é…ç½®ç±»æ‰€åœ¨åŒ…åŠå…¶å­åŒ…ä¸‹çš„ç±»</li></ul><h2 id="å…¶ä»–æ ‡ç­¾"><a href="#å…¶ä»–æ ‡ç­¾" class="headerlink" title="å…¶ä»–æ ‡ç­¾"></a>å…¶ä»–æ ‡ç­¾</h2><h3 id="Primary"><a href="#Primary" class="headerlink" title="@Primary"></a>@Primary</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Repository(&quot;userDao&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserDaoImpl</span> <span class="keyword">implements</span> <span class="title class_">UserDao</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Repository(&quot;userDao2&quot;)</span></span><br><span class="line"><span class="meta">@Primary</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserDaoImpl2</span> <span class="keyword">implements</span> <span class="title class_">UserDao</span>&#123;&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> UserDao <span class="title function_">userDao01</span><span class="params">()</span>&#123;<span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">UserDaoImpl</span>();&#125; </span><br><span class="line"></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@Primary</span></span><br><span class="line"><span class="keyword">public</span> UserDao <span class="title function_">userDao02</span><span class="params">()</span>&#123;<span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">UserDaoImpl2</span>();&#125;</span><br></pre></td></tr></table></figure><blockquote><p>@Primary æ³¨è§£ç”¨äºæ ‡æ³¨ç›¸åŒç±»å‹çš„ Bean ä¼˜å…ˆè¢«ä½¿ç”¨æƒï¼Œä¸ @Component å’Œ @Bean ä¸€èµ·ä½¿ç”¨ï¼Œæ ‡æ³¨è¯¥ Bean çš„ä¼˜å…ˆçº§æ›´é«˜ï¼Œåˆ™åœ¨é€šè¿‡ç±»å‹è·å– Bean æˆ–é€šè¿‡ @Autowired æ ¹æ®ç±»å‹è¿›è¡Œæ³¨å…¥æ—¶ï¼Œ ä¼šé€‰ç”¨ä¼˜å…ˆçº§æ›´é«˜çš„ã€‚</p></blockquote><h3 id="Profile"><a href="#Profile" class="headerlink" title="@Profile"></a>@Profile</h3><p>æ‰©å±•ï¼š@Profile æ³¨è§£çš„ä½œç”¨åŒäº xml é…ç½®æ—¶å­¦ä¹  profile å±æ€§ï¼Œæ˜¯è¿›è¡Œç¯å¢ƒåˆ‡æ¢ä½¿ç”¨çš„</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">profile</span>=<span class="string">&quot;test&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure><p>æ³¨è§£  @Profile  æ ‡æ³¨åœ¨ç±»æˆ–æ–¹æ³•ä¸Šï¼Œæ ‡æ³¨å½“å‰äº§ç”Ÿçš„ Bean ä»å±äºå“ªä¸ªç¯å¢ƒï¼Œåªæœ‰æ¿€æ´»äº†å½“å‰ç¯å¢ƒï¼Œè¢«æ ‡æ³¨çš„ Bean æ‰èƒ½è¢«æ³¨å†Œåˆ° Spring å®¹å™¨é‡Œï¼Œä¸æŒ‡å®šç¯å¢ƒçš„ Beanï¼Œä»»ä½•ç¯å¢ƒä¸‹éƒ½èƒ½æ³¨å†Œåˆ° Spring å®¹å™¨é‡Œ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Repository(&quot;userDao&quot;)</span></span><br><span class="line"><span class="meta">@Profile(&quot;test&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserDaoImpl</span> <span class="keyword">implements</span> <span class="title class_">UserDao</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Repository(&quot;userDao2&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserDaoImpl2</span> <span class="keyword">implements</span> <span class="title class_">UserDao</span>&#123;&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥ä½¿ç”¨ä»¥ä¸‹ä¸¤ç§æ–¹å¼æŒ‡å®šè¢«æ¿€æ´»çš„ç¯å¢ƒï¼š</p><ul><li>ä½¿ç”¨å‘½ä»¤è¡ŒåŠ¨æ€å‚æ•°ï¼Œè™šæ‹Ÿæœºå‚æ•°ä½ç½®åŠ è½½ <code>-Dspring.profiles.active=test</code></li><li>ä½¿ç”¨ä»£ç çš„æ–¹å¼è®¾ç½®ç¯å¢ƒå˜é‡ <code>System.setProperty(&quot;spring.profiles.active&quot;,&quot;test&quot;);</code></li></ul>]]></content>
      
      
      <categories>
          
          <category> åç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> spring </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Spring Beançš„ç”Ÿå‘½å‘¨æœŸ</title>
      <link href="/post/28.html"/>
      <url>/post/28.html</url>
      
        <content type="html"><![CDATA[<h1 id="Spring-Beançš„ç”Ÿå‘½å‘¨æœŸâ­â­â­"><a href="#Spring-Beançš„ç”Ÿå‘½å‘¨æœŸâ­â­â­" class="headerlink" title="Spring Beançš„ç”Ÿå‘½å‘¨æœŸâ­â­â­"></a>Spring Beançš„ç”Ÿå‘½å‘¨æœŸâ­â­â­</h1><p>Spring Bean çš„ç”Ÿå‘½å‘¨æœŸæ˜¯ä» Bean å®ä¾‹åŒ–ä¹‹åï¼Œå³é€šè¿‡åå°„åˆ›å»ºå‡ºå¯¹è±¡ä¹‹åï¼Œåˆ° Bean æˆä¸ºä¸€ä¸ªå®Œæ•´å¯¹è±¡ï¼Œæœ€ç»ˆå­˜å‚¨åˆ°å•ä¾‹æ± ä¸­ï¼Œè¿™ä¸ªè¿‡ç¨‹è¢«ç§°ä¸º Spring Bean çš„ç”Ÿå‘½å‘¨æœŸã€‚Spring Bean çš„ç”Ÿå‘½å‘¨æœŸå¤§ä½“ä¸Šåˆ†ä¸ºä¸‰ä¸ªé˜¶æ®µ:</p><ol><li>Bean çš„å®ä¾‹åŒ–é˜¶æ®µï¼šSpring æ¡†æ¶ä¼šå–å‡º BeanDefinition çš„ä¿¡æ¯è¿›è¡Œåˆ¤æ–­å½“å‰ Bean çš„èŒƒå›´æ˜¯å¦æ˜¯ singleton çš„ï¼Œ æ˜¯å¦ä¸æ˜¯å»¶è¿ŸåŠ è½½çš„ï¼Œæ˜¯å¦ä¸æ˜¯ FactoryBean ç­‰ï¼Œæœ€ç»ˆå°†ä¸€ä¸ªæ™®é€šçš„ singleton çš„ Bean é€šè¿‡åå°„è¿›è¡Œå®ä¾‹åŒ–;</li><li>Bean çš„åˆå§‹åŒ–é˜¶æ®µï¼šBean åˆ›å»ºä¹‹åè¿˜ä»…ä»…æ˜¯ä¸ªâ€åŠæˆå“â€ï¼Œè¿˜éœ€è¦å¯¹ Bean å®ä¾‹çš„å±æ€§è¿›è¡Œå¡«å……ã€æ‰§è¡Œä¸€äº› Aware æ¥å£æ–¹æ³•ã€æ‰§è¡Œ BeanPostProcessor æ–¹æ³•ã€æ‰§è¡Œ InitializingBean æ¥å£çš„åˆå§‹åŒ–æ–¹æ³•ã€æ‰§è¡Œè‡ªå®šä¹‰åˆå§‹åŒ– init æ–¹æ³•ç­‰ã€‚è¯¥é˜¶æ®µæ˜¯ Spring æœ€å…·æŠ€æœ¯å«é‡å’Œå¤æ‚åº¦çš„é˜¶æ®µï¼ŒAopå¢å¼ºåŠŸèƒ½ï¼Œåé¢è¦å­¦ä¹ çš„ Spring çš„æ³¨è§£åŠŸèƒ½ç­‰ã€ spring é«˜é¢‘é¢è¯•é¢˜ Bean çš„å¾ªç¯å¼•ç”¨é—®é¢˜éƒ½æ˜¯åœ¨è¿™ä¸ªé˜¶æ®µä½“ç°çš„;</li><li>Bean çš„å®Œæˆé˜¶æ®µï¼šç»è¿‡åˆå§‹åŒ–é˜¶æ®µï¼ŒBean å°±æˆä¸ºäº†ä¸€ä¸ªå®Œæ•´çš„ Spring Beanï¼Œè¢«å­˜å‚¨åˆ°å•ä¾‹æ±  singletonObjects ä¸­å»äº†ï¼Œå³å®Œæˆäº† Spring Bean çš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸã€‚</li></ol><h2 id="Bean-çš„åˆå§‹åŒ–é˜¶æ®µ"><a href="#Bean-çš„åˆå§‹åŒ–é˜¶æ®µ" class="headerlink" title="Bean çš„åˆå§‹åŒ–é˜¶æ®µ"></a>Bean çš„åˆå§‹åŒ–é˜¶æ®µ</h2><p>ç”±äº Bean çš„åˆå§‹åŒ–é˜¶æ®µçš„æ­¥éª¤æ¯”è¾ƒå¤æ‚ï¼Œæ‰€ä»¥ç€é‡ç ”ç©¶Beançš„åˆå§‹åŒ–é˜¶æ®µã€‚</p><p>Spring Bean çš„åˆå§‹åŒ–è¿‡ç¨‹æ¶‰åŠå¦‚ä¸‹å‡ ä¸ªè¿‡ç¨‹: </p><ul><li>Bean å®ä¾‹çš„å±æ€§å¡«å……</li><li>Aware æ¥å£å±æ€§æ³¨å…¥</li><li>BeanPostProcessor çš„ before() æ–¹æ³•å›è°ƒ</li><li>InitializingBean æ¥å£çš„åˆå§‹åŒ–æ–¹æ³•å›è°ƒ</li><li>è‡ªå®šä¹‰åˆå§‹åŒ–æ–¹æ³• init å›è°ƒ</li><li>BeanPostProcessor çš„ after() æ–¹æ³•å›è°ƒ</li></ul><p>PS:é€šè¿‡ä»£ç éªŒè¯ä¸Šè¿°åˆå§‹åŒ–é¡ºåºâ€¦ â€¦</p><h3 id="Bean-å®ä¾‹å±æ€§å¡«å……"><a href="#Bean-å®ä¾‹å±æ€§å¡«å……" class="headerlink" title="Bean å®ä¾‹å±æ€§å¡«å……"></a>Bean å®ä¾‹å±æ€§å¡«å……</h3><p><img src="http://cdn.leesin.fun/typora/macpro/img/Bean%E5%B1%9E%E6%80%A7%E5%A1%AB%E5%85%85.png" alt="Beanå±æ€§å¡«å……"></p><p>Spring åœ¨è¿›è¡Œå±æ€§æ³¨å…¥æ—¶ï¼Œä¼šåˆ†ä¸ºå¦‚ä¸‹å‡ ç§æƒ…å†µï¼š</p><ul><li>æ³¨å…¥æ™®é€šå±æ€§ï¼ŒStringã€int æˆ–å­˜å‚¨åŸºæœ¬ç±»å‹çš„é›†åˆæ—¶ï¼Œç›´æ¥é€šè¿‡ set æ–¹æ³•çš„åå°„è®¾ç½®è¿›å»</li><li>æ³¨å…¥å•å‘å¯¹è±¡å¼•ç”¨å±æ€§æ—¶ï¼Œä»å®¹å™¨ä¸­ getBean è·å–åé€šè¿‡ set æ–¹æ³•åå°„è®¾ç½®è¿›å»ï¼Œå¦‚æœå®¹å™¨ä¸­æ²¡æœ‰ï¼Œåˆ™å…ˆåˆ›å»ºè¢«æ³¨å…¥å¯¹è±¡ Bean å®ä¾‹(å®Œæˆæ•´ä¸ªç”Ÿå‘½å‘¨æœŸ)åï¼Œå†è¿›è¡Œæ³¨å…¥æ“ä½œ</li><li>æ³¨å…¥åŒå‘å¯¹è±¡å¼•ç”¨å±æ€§æ—¶ï¼Œå°±æ¯”è¾ƒå¤æ‚äº†ï¼Œæ¶‰åŠäº†å¾ªç¯å¼•ç”¨(å¾ªç¯ä¾èµ–)é—®é¢˜ã€‚</li></ul><h4 id="å¾ªç¯ä¾èµ–"><a href="#å¾ªç¯ä¾èµ–" class="headerlink" title="å¾ªç¯ä¾èµ–"></a>å¾ªç¯ä¾èµ–</h4><p>Spring æä¾›äº†<strong>ä¸‰çº§ç¼“å­˜</strong>å­˜å‚¨ ==å®Œæ•´Beanå®ä¾‹== å’Œ ==åŠæˆå“Beanå®ä¾‹== ï¼Œç”¨äºè§£å†³å¾ªç¯å¼•ç”¨é—®é¢˜</p><p>åœ¨ DefaultListableBeanFactory çš„ä¸Šå››çº§çˆ¶ç±» DefaultSingletonBeanRegistry ä¸­æä¾›å¦‚ä¸‹ä¸‰ä¸ª Mapï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DefaultSingletonBeanRegistry</span> ... &#123; </span><br><span class="line">  <span class="comment">//1ã€æœ€ç»ˆå­˜å‚¨å•ä¾‹Beanæˆå“çš„å®¹å™¨ï¼Œå³å®ä¾‹åŒ–å’Œåˆå§‹åŒ–éƒ½å®Œæˆçš„Beanï¼Œç§°ä¹‹ä¸º&quot;ä¸€çº§ç¼“å­˜&quot;</span></span><br><span class="line">Map&lt;String, Object&gt; singletonObjects = <span class="keyword">new</span> <span class="title class_">ConcurrentHashMap</span>(<span class="number">256</span>); </span><br><span class="line">  <span class="comment">//2ã€æ—©æœŸBeanå•ä¾‹æ± ï¼Œç¼“å­˜åŠæˆå“å¯¹è±¡ï¼Œä¸”å½“å‰å¯¹è±¡å·²ç»è¢«å…¶ä»–å¯¹è±¡å¼•ç”¨äº†ï¼Œç§°ä¹‹ä¸º&quot;äºŒçº§ç¼“å­˜&quot; </span></span><br><span class="line">  Map&lt;String, Object&gt; earlySingletonObjects = <span class="keyword">new</span> <span class="title class_">ConcurrentHashMap</span>(<span class="number">16</span>); </span><br><span class="line">  <span class="comment">//3ã€å•ä¾‹Beançš„å·¥å‚æ± ï¼Œç¼“å­˜åŠæˆå“å¯¹è±¡ï¼Œå¯¹è±¡æœªè¢«å¼•ç”¨ï¼Œä½¿ç”¨æ—¶åœ¨é€šè¿‡å·¥å‚åˆ›å»ºBeanï¼Œç§°ä¹‹ä¸º&quot;ä¸‰çº§ç¼“å­˜&quot; </span></span><br><span class="line">  Map&lt;String, ObjectFactory&lt;?&gt;&gt; singletonFactories = <span class="keyword">new</span> <span class="title class_">HashMap</span>(<span class="number">16</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="å¾ªç¯ä¾èµ–ä¸¾ä¾‹è¯´æ˜"><a href="#å¾ªç¯ä¾èµ–ä¸¾ä¾‹è¯´æ˜" class="headerlink" title="å¾ªç¯ä¾èµ–ä¸¾ä¾‹è¯´æ˜"></a>å¾ªç¯ä¾èµ–ä¸¾ä¾‹è¯´æ˜</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userService&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.lyf.service.impl.UserServiceImpl&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;userDao&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;userDao&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userDao&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.lyf.dao.impl.UserDaoImpl&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;userService&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;userService&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><p>UserService ä¸ UserDao å®ä¾‹åŒ–ä¸åˆå§‹åŒ–çš„é¡ºåºå¦‚ä¸‹ï¼š</p><p><img src="http://cdn.leesin.fun/typora/macpro/img/Snipaste_2023-05-05_11-51-24.png" alt="Snipaste_2023-05-05_11-51-24"></p><p>UserService å’Œ UserDao å¾ªç¯ä¾èµ–çš„è¿‡ç¨‹ç»“åˆä¸Šè¿°ä¸‰çº§ç¼“å­˜æè¿°ä¸€ä¸‹ï¼š</p><ol><li>UserService å®ä¾‹åŒ–å¯¹è±¡ï¼Œä½†å°šæœªåˆå§‹åŒ–ï¼Œå°† UserService å­˜å‚¨åˆ°ä¸‰çº§ç¼“å­˜;</li><li>UserService å±æ€§æ³¨å…¥ï¼Œéœ€è¦ UserDaoï¼Œä»ç¼“å­˜ä¸­è·å–ï¼Œä½†æ˜¯ç¼“å­˜æ²¡æœ‰ UserDaoï¼Œæ‰€ä»¥å…ˆæ‰§è¡ŒUserDaoçš„ç”Ÿå‘½å‘¨æœŸ;<br>   2.1. UserDao å®ä¾‹åŒ–å¯¹è±¡ï¼Œä½†å°šæœªåˆå§‹åŒ–ï¼Œå°† UserDao å­˜å‚¨åˆ°åˆ°ä¸‰çº§ç¼“å­˜;<br> 2.2. UserDao å±æ€§æ³¨å…¥ï¼Œéœ€è¦ UserServiceï¼Œä»ä¸‰çº§ç¼“å­˜è·å– UserServiceï¼ŒUserService ä»ä¸‰çº§ç¼“å­˜ç§»å…¥äºŒçº§ç¼“å­˜;<br> 2.3. UserDao æ‰§è¡Œå…¶ä»–ç”Ÿå‘½å‘¨æœŸè¿‡ç¨‹ï¼Œæœ€ç»ˆæˆä¸ºä¸€ä¸ªå®Œæˆ Beanï¼Œå­˜å‚¨åˆ°ä¸€çº§ç¼“å­˜ï¼Œåˆ é™¤äºŒä¸‰çº§ç¼“å­˜;</li><li>UserService æ³¨å…¥ UserDao;</li><li>UserServiceæ‰§è¡Œå…¶ä»–ç”Ÿå‘½å‘¨æœŸè¿‡ç¨‹ï¼Œæœ€ç»ˆæˆä¸ºä¸€ä¸ªå®ŒæˆBeanï¼Œå­˜å‚¨åˆ°ä¸€çº§ç¼“å­˜ï¼Œåˆ é™¤äºŒä¸‰çº§ç¼“å­˜ã€‚</li></ol><h3 id="å¸¸ç”¨çš„Awareæ¥å£"><a href="#å¸¸ç”¨çš„Awareæ¥å£" class="headerlink" title="å¸¸ç”¨çš„Awareæ¥å£"></a>å¸¸ç”¨çš„Awareæ¥å£</h3><p>Aware æ¥å£æ˜¯ä¸€ç§æ¡†æ¶è¾…åŠ©å±æ€§æ³¨å…¥çš„ä¸€ç§æ€æƒ³ï¼Œå…¶ä»–æ¡†æ¶ä¸­ä¹Ÿå¯ä»¥çœ‹åˆ°ç±»ä¼¼çš„æ¥å£ã€‚æ¡†æ¶å…·å¤‡é«˜åº¦å°è£…æ€§ï¼Œæˆ‘ä»¬æ¥è§¦åˆ°çš„ä¸€èˆ¬éƒ½æ˜¯ä¸šåŠ¡ä»£ç ï¼Œä¸€ä¸ªåº•å±‚åŠŸèƒ½ API ä¸èƒ½è½»æ˜“çš„è·å–åˆ°ï¼Œä½†æ˜¯è¿™ä¸æ„å‘³ç€æ°¸è¿œç”¨ä¸åˆ°è¿™äº›å¯¹è±¡ï¼Œå¦‚æœç”¨åˆ°äº† ï¼Œå°±å¯ä»¥ä½¿ç”¨æ¡†æ¶æä¾›çš„ç±»ä¼¼ Aware çš„æ¥å£ï¼Œè®©æ¡†æ¶ç»™æˆ‘ä»¬æ³¨å…¥è¯¥å¯¹è±¡ã€‚</p><div class="table-container"><table><thead><tr><th style="text-align:center">Awareæ¥å£</th><th style="text-align:center">å›è°ƒæ–¹æ³•</th><th style="text-align:center">ä½œç”¨</th></tr></thead><tbody><tr><td style="text-align:center">ServletContextAware</td><td style="text-align:center">setServletContext(ServletContext context)</td><td style="text-align:center">Springæ¡†æ¶å›è°ƒæ–¹æ³•æ³¨å…¥ServletContextå¯¹è±¡ webç¯å¢ƒä¸‹æ‰ç”Ÿæ•ˆ</td></tr><tr><td style="text-align:center">BeanFactoryAware</td><td style="text-align:center">setBeanFactory(BeanFactory factory)</td><td style="text-align:center">Springæ¡†æ¶å›è°ƒæ–¹æ³•æ³¨å…¥beanFactoryå¯¹è±¡</td></tr><tr><td style="text-align:center">BeanNameAware</td><td style="text-align:center">setBeanName(String beanName)</td><td style="text-align:center">Springæ¡†æ¶å›è°ƒæ–¹æ³•æ³¨å…¥å½“å‰Beanåœ¨å®¹å™¨ä¸­ çš„beanName</td></tr><tr><td style="text-align:center">ApplicationContextAware</td><td style="text-align:center">setApplicationContext(ApplicationContext applicationContext)</td><td style="text-align:center">Springæ¡†æ¶å›è°ƒæ–¹æ³•æ³¨å…¥applicationContext å¯¹è±¡</td></tr></tbody></table></div><p>ä¸¾ä¾‹å¦‚ä¸‹ï¼š</p><p>è‡ªå®šä¹‰ä¸€ä¸ª Pig ç±»ï¼Œå®ç° Aware æ¥å£</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Pig</span> <span class="keyword">implements</span> <span class="title class_">BeanFactoryAware</span>, BeanNameAware, ApplicationContextAware &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setBeanFactory</span><span class="params">(BeanFactory beanFactory)</span> <span class="keyword">throws</span> BeansException &#123;</span><br><span class="line">        System.out.println(beanFactory);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setBeanName</span><span class="params">(String beanName)</span> &#123;</span><br><span class="line">        System.out.println(beanName);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setApplicationContext</span><span class="params">(ApplicationContext context)</span> <span class="keyword">throws</span> BeansException &#123;</span><br><span class="line">        System.out.println(context);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é…ç½® Pig</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;myPigPig&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.lyf.domain.Pig&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure><p>æµ‹è¯•ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">App</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">ApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;applicationContext.xml&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœ</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">myPigPig</span><br><span class="line">org.springframework.beans.factory.support.DefaultListableBeanFactory@6b2fad11: defining beans [myPigPig]; root of factory hierarchy</span><br><span class="line">org.springframework.context.support.ClassPathXmlApplicationContext@4fca772d, started on Fri May 05 13:57:07 CST 2023</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> åç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> spring </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Springåå¤„ç†å™¨</title>
      <link href="/post/27.html"/>
      <url>/post/27.html</url>
      
        <content type="html"><![CDATA[<h1 id="Springçš„åå¤„ç†å™¨â­â­â­"><a href="#Springçš„åå¤„ç†å™¨â­â­â­" class="headerlink" title="Springçš„åå¤„ç†å™¨â­â­â­"></a>Springçš„åå¤„ç†å™¨â­â­â­</h1><p>Spring çš„åå¤„ç†å™¨æ˜¯ Spring å¯¹å¤–å¼€å‘çš„é‡è¦æ‰©å±•ç‚¹ï¼Œå…è®¸æˆ‘ä»¬ä»‹å…¥åˆ° Bean çš„æ•´ä¸ªå®ä¾‹åŒ–æµç¨‹ä¸­æ¥ï¼Œä»¥è¾¾åˆ°==åŠ¨æ€æ³¨å†Œ  BeanDefinition==ï¼Œ==åŠ¨æ€ä¿®æ”¹ BeanDefinition==ï¼Œä»¥åŠ==åŠ¨æ€ä¿®æ”¹ Bean== çš„ä½œç”¨ã€‚Spring ä¸»è¦æœ‰ä¸¤ç§åå¤„ç†å™¨ï¼š</p><ul><li>BeanFactoryPostProcessorï¼šBean å·¥å‚åå¤„ç†å™¨ï¼Œåœ¨ BeanDefinitionMap å¡«å……å®Œæ¯•ï¼ŒBean å®ä¾‹åŒ–ä¹‹å‰æ‰§è¡Œï¼› </li><li>BeanPostProcessorï¼šBean åå¤„ç†å™¨ï¼Œä¸€èˆ¬åœ¨ Bean å®ä¾‹åŒ–ä¹‹åï¼Œå¡«å……åˆ°å•ä¾‹æ±  singletonObjects ä¹‹å‰æ‰§è¡Œã€‚</li></ul><h2 id="BeanFactoryPostProcessor"><a href="#BeanFactoryPostProcessor" class="headerlink" title="BeanFactoryPostProcessor"></a>BeanFactoryPostProcessor</h2><p>Bean å·¥å‚åå¤„ç†å™¨ï¼šBeanFactoryPostProcessor æ˜¯ä¸€ä¸ªæ¥å£è§„èŒƒï¼Œå®ç°äº†è¯¥æ¥å£çš„ç±»åªè¦äº¤ç”± Spring ç®¡ç†ï¼ŒSpring å°±ä¼šå›è°ƒè¯¥æ¥å£çš„æ–¹æ³•ã€‚é€šå¸¸ç”¨äº==å¯¹ BeanDefinition è¿›è¡Œæ³¨å†Œ/ä¿®æ”¹==ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@FunctionalInterface</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">BeanFactoryPostProcessor</span> &#123; </span><br><span class="line"><span class="keyword">void</span> <span class="title function_">postProcessBeanFactory</span><span class="params">(ConfigurableListableBeanFactory beanFactory)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ä¿®æ”¹-BeanDefinition-ç»ƒä¹ "><a href="#ä¿®æ”¹-BeanDefinition-ç»ƒä¹ " class="headerlink" title="ä¿®æ”¹ BeanDefinition ç»ƒä¹ "></a>ä¿®æ”¹ BeanDefinition ç»ƒä¹ </h3><p>ç›®çš„ï¼šä¿®æ”¹ BeanDefinition ï¼Œå°† Cat æ”¹ä¸º Dog</p><p>Cat.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Cat</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Dog.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Dog</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é…ç½®æ–‡ä»¶</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- åªæ³¨å…¥ Cat --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;cat&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.lyf.animal.Cat&quot;</span>/&gt;</span></span><br><span class="line"><span class="comment">&lt;!--æ³¨å…¥è‡ªå®šä¹‰çš„ Bean å·¥å‚åå¤„ç†å™¨--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;com.lyf.processor.MyBeanFactoryPostProcessor&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure><p>è‡ªå®šä¹‰çš„ Bean å·¥å‚åå¤„ç†å™¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyBeanFactoryPostProcessor</span> <span class="keyword">implements</span> <span class="title class_">BeanFactoryPostProcessor</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">postProcessBeanFactory</span><span class="params">(ConfigurableListableBeanFactory beanFactory)</span> <span class="keyword">throws</span> BeansException &#123;</span><br><span class="line">        <span class="comment">// é€šè¿‡ beanFactory æ‹¿åˆ° Cat çš„ beanDefinition</span></span><br><span class="line">        <span class="type">BeanDefinition</span> <span class="variable">beanDefinition</span> <span class="operator">=</span> beanFactory.getBeanDefinition(<span class="string">&quot;cat&quot;</span>);</span><br><span class="line">        <span class="comment">// å°† beanDefinition çš„ ClassName ä¿®æ”¹ä¸º Dog çš„</span></span><br><span class="line">        beanDefinition.setBeanClassName(<span class="string">&quot;com.lyf.animal.Dog&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æµ‹è¯•ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ApplicationContextTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">ApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;applicationContext.xml&quot;</span>);</span><br><span class="line">        <span class="type">Object</span> <span class="variable">cat</span> <span class="operator">=</span> context.getBean(<span class="string">&quot;cat&quot;</span>);</span><br><span class="line">        System.out.println(cat);<span class="comment">//æ§åˆ¶å°æ‰“å°ï¼šcom.lyf.animal.Dog@59494225</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ³¨å†Œ-BeanDefinition-ç»ƒä¹ 1"><a href="#æ³¨å†Œ-BeanDefinition-ç»ƒä¹ 1" class="headerlink" title="æ³¨å†Œ BeanDefinition ç»ƒä¹ 1"></a>æ³¨å†Œ BeanDefinition ç»ƒä¹ 1</h3><p>ç›®çš„ï¼šé…ç½®æ–‡ä»¶ä¸æ³¨å…¥ Dog ï¼Œè€Œæ˜¯é€šè¿‡ Bean å·¥å‚åå¤„ç†å™¨æ¥æ³¨å†Œä¸€ä¸ª BeanDefinitonï¼Œæœ€ç»ˆå®ç° Spring å¸®æˆ‘ä»¬ç®¡ç† Dog</p><p>Dog.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Dog</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é…ç½®æ–‡ä»¶</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--æ³¨å…¥è‡ªå®šä¹‰çš„ Bean å·¥å‚åå¤„ç†å™¨--&gt;</span><br><span class="line">&lt;bean class=<span class="string">&quot;com.lyf.processor.MyBeanFactoryPostProcessor&quot;</span>/&gt;</span><br></pre></td></tr></table></figure><p>è‡ªå®šä¹‰çš„ Bean å·¥å‚åå¤„ç†å™¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyBeanFactoryPostProcessor</span> <span class="keyword">implements</span> <span class="title class_">BeanFactoryPostProcessor</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">postProcessBeanFactory</span><span class="params">(ConfigurableListableBeanFactory beanFactory)</span> <span class="keyword">throws</span> BeansException &#123;</span><br><span class="line">        <span class="comment">// beanFactory çš„å®ç°ç±»å…¶å®æ˜¯ DefaultListableBeanFactory</span></span><br><span class="line">        System.out.println(beanFactory.getClass().getSimpleName());<span class="comment">// æ§åˆ¶å°è¾“å‡º DefaultListableBeanFactory</span></span><br><span class="line">        <span class="comment">// ç”Ÿæˆä¸€ä¸ª BeanDefinition</span></span><br><span class="line">        <span class="type">BeanDefinition</span> <span class="variable">dogDefinition</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RootBeanDefinition</span>();</span><br><span class="line">        dogDefinition.setBeanClassName(<span class="string">&quot;com.lyf.animal.Dog&quot;</span>);</span><br><span class="line">        <span class="comment">// è¿›è¡Œæ³¨å†Œæ“ä½œ</span></span><br><span class="line">        ((DefaultListableBeanFactory)beanFactory).registerBeanDefinition(<span class="string">&quot;dog&quot;</span>, dogDefinition);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æµ‹è¯•ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ApplicationContextTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">ApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;applicationContext.xml&quot;</span>);</span><br><span class="line">        <span class="type">Dog</span> <span class="variable">dog</span> <span class="operator">=</span> context.getBean(Dog.class);</span><br><span class="line">        System.out.println(dog); <span class="comment">// æ§åˆ¶å°è¾“å‡º com.lyf.animal.Dog@cb644e</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="BeanDefinitionRegistryPostProcessor"><a href="#BeanDefinitionRegistryPostProcessor" class="headerlink" title="BeanDefinitionRegistryPostProcessor"></a>BeanDefinitionRegistryPostProcessor</h3><p>Spring æä¾›äº†ä¸€ä¸ª BeanFactoryPostProcessor çš„å­æ¥å£ BeanDefinitionRegistryPostProcessor ä¸“é—¨ç”¨äºæ³¨å†Œ  BeanDefinition æ“ä½œ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">BeanDefinitionRegistryPostProcessor</span> <span class="keyword">extends</span> <span class="title class_">BeanFactoryPostProcessor</span> &#123;</span><br><span class="line"><span class="keyword">void</span> <span class="title function_">postProcessBeanDefinitionRegistry</span><span class="params">(BeanDefinitionRegistry registry)</span> <span class="keyword">throws</span> BeansException;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ³¨å†Œ-BeanDefinition-ç»ƒä¹ 2"><a href="#æ³¨å†Œ-BeanDefinition-ç»ƒä¹ 2" class="headerlink" title="æ³¨å†Œ BeanDefinition ç»ƒä¹ 2"></a>æ³¨å†Œ BeanDefinition ç»ƒä¹ 2</h3><p>ç›®çš„ï¼šå’Œä¸Šä¸€ä¸ªç»ƒä¹ çš„ä¸€æ ·</p><p>Dog.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Dog</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é…ç½®æ–‡ä»¶</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--æ³¨å…¥è‡ªå®šä¹‰çš„ Bean å·¥å‚åå¤„ç†å™¨--&gt;</span><br><span class="line">&lt;bean class=<span class="string">&quot;com.lyf.processor.MyBeanFactoryPostProcessor2&quot;</span>/&gt;</span><br></pre></td></tr></table></figure><p>è‡ªå®šä¹‰çš„ Bean å·¥å‚åå¤„ç†å™¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyBeanFactoryPostProcessor2</span> <span class="keyword">implements</span> <span class="title class_">BeanDefinitionRegistryPostProcessor</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">postProcessBeanDefinitionRegistry</span><span class="params">(BeanDefinitionRegistry registry)</span> <span class="keyword">throws</span> BeansException &#123;</span><br><span class="line">        <span class="type">BeanDefinition</span> <span class="variable">dogDefinition</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RootBeanDefinition</span>(<span class="string">&quot;com.lyf.animal.Dog&quot;</span>);</span><br><span class="line">        registry.registerBeanDefinition(<span class="string">&quot;dog&quot;</span>, dogDefinition);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">postProcessBeanFactory</span><span class="params">(ConfigurableListableBeanFactory beanFactory)</span> <span class="keyword">throws</span> BeansException &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æµ‹è¯•ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ApplicationContextTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">ApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;applicationContext.xml&quot;</span>);</span><br><span class="line">        <span class="type">Dog</span> <span class="variable">dog</span> <span class="operator">=</span> context.getBean(Dog.class);</span><br><span class="line">        System.out.println(dog); <span class="comment">// æ§åˆ¶å°è¾“å‡º com.lyf.animal.Dog@56ef9176</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ¢è®¨æ‰§è¡Œé¡ºåº"><a href="#æ¢è®¨æ‰§è¡Œé¡ºåº" class="headerlink" title="æ¢è®¨æ‰§è¡Œé¡ºåº"></a>æ¢è®¨æ‰§è¡Œé¡ºåº</h3><p>å¦‚æœåŒæ—¶é…ç½®äº† BeanFactoryPostProcessor å’Œå®ƒçš„å­æ¥å£ BeanDefinitionRegistryPostProcessorï¼Œé‚£ä¹ˆå®ƒä»¬è¢«è°ƒç”¨é¡ºåºæ˜¯æ€æ ·çš„ï¼Ÿä¸‹é¢ç»™å‡ºæµ‹è¯•ä»£ç </p><p>é…ç½®æ–‡ä»¶</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;com.lyf.processor.MyBeanFactoryPostProcessor&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;com.lyf.processor.MyBeanFactoryPostProcessor2&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure><p>å®ç°çˆ¶æ¥å£ BeanFactoryPostProcessor çš„ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyBeanFactoryPostProcessor</span> <span class="keyword">implements</span> <span class="title class_">BeanFactoryPostProcessor</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">postProcessBeanFactory</span><span class="params">(ConfigurableListableBeanFactory beanFactory)</span> <span class="keyword">throws</span> BeansException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;çˆ¶æ¥å£ BeanFactoryPostProcessor çš„ postProcessBeanFactoryæ–¹æ³•&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®ç°å­æ¥å£ BeanDefinitionRegistryPostProcessor çš„ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyBeanFactoryPostProcessor2</span> <span class="keyword">implements</span> <span class="title class_">BeanDefinitionRegistryPostProcessor</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">postProcessBeanDefinitionRegistry</span><span class="params">(BeanDefinitionRegistry registry)</span> <span class="keyword">throws</span> BeansException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;å­æ¥å£ BeanDefinitionRegistryPostProcessor çš„ postProcessBeanDefinitionRegistry æ–¹æ³•&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">postProcessBeanFactory</span><span class="params">(ConfigurableListableBeanFactory beanFactory)</span> <span class="keyword">throws</span> BeansException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;å­æ¥å£ BeanDefinitionRegistryPostProcessor çš„ postProcessBeanFactory æ–¹æ³•&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æµ‹è¯•ä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ApplicationContextTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">ApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;applicationContext.xml&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ§åˆ¶å°è¾“å‡º</p><blockquote><p>å­æ¥å£ BeanDefinitionRegistryPostProcessor çš„ postProcessBeanDefinitionRegistry æ–¹æ³•<br>å­æ¥å£ BeanDefinitionRegistryPostProcessor çš„ postProcessBeanFactory æ–¹æ³•<br>çˆ¶æ¥å£ BeanFactoryPostProcessor çš„ postProcessBeanFactoryæ–¹æ³•</p></blockquote><p>æ€»ç»“è°ƒç”¨é¡ºåºï¼š</p><blockquote><ol><li>è°ƒç”¨å­æ¥å£ä¸­ç‰¹æœ‰çš„æ–¹æ³•</li><li>è°ƒç”¨å­æ¥å£ä¸­ç»§æ‰¿çˆ¶æ¥å£çš„æ–¹æ³•</li><li>è°ƒç”¨çˆ¶æ¥å£çš„æ–¹æ³•</li></ol></blockquote><h2 id="æ¨¡æ‹Ÿ-Componentæ³¨è§£çš„å®ç°"><a href="#æ¨¡æ‹Ÿ-Componentæ³¨è§£çš„å®ç°" class="headerlink" title="æ¨¡æ‹Ÿ@Componentæ³¨è§£çš„å®ç°"></a>æ¨¡æ‹Ÿ@Componentæ³¨è§£çš„å®ç°</h2><p>ä½¿ç”¨ Spring çš„ BeanFactoryPostProcessor æ‰©å±•ç‚¹å®Œæˆè‡ªå®šä¹‰æ³¨è§£æ‰«æï¼Œè¦æ±‚å¦‚ä¸‹ï¼š</p><ul><li>è‡ªå®šä¹‰ @MyComponent æ³¨è§£ï¼Œä½¿ç”¨åœ¨ç±»ä¸Š</li><li>ä½¿ç”¨èµ„æ–™ä¸­æä¾›å¥½çš„åŒ…æ‰«æå™¨å·¥å…· BaseClassScanUtils å®ŒæˆæŒ‡å®šåŒ…çš„ç±»æ‰«æ</li><li>è‡ªå®šä¹‰ BeanFactoryPostProcessor å®Œæˆæ³¨è§£ @MyComponent çš„è§£æï¼Œè§£æåæœ€ç»ˆè¢« Spring ç®¡ç†ã€‚</li></ul><ol><li>MyComponent.java</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target(ElementType.TYPE)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> MyComponent &#123;</span><br><span class="line">    <span class="comment">// æ˜¾ç¤ºåœ°æŒ‡å®š beanName</span></span><br><span class="line">    String <span class="title function_">value</span><span class="params">()</span> <span class="keyword">default</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li>BaseClassScanUtils.java</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BaseClassScanUtils</span> &#123;</span><br><span class="line">    <span class="comment">//è®¾ç½®èµ„æºè§„åˆ™</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">RESOURCE_PATTERN</span> <span class="operator">=</span> <span class="string">&quot;/**/*.class&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Map&lt;String, Class&gt; <span class="title function_">scanMyComponentAnnotation</span><span class="params">(String basePackage)</span> &#123;</span><br><span class="line">        <span class="comment">//åˆ›å»ºå®¹å™¨å­˜å‚¨ä½¿ç”¨äº†æŒ‡å®šæ³¨è§£çš„Beanå­—èŠ‚ç å¯¹è±¡</span></span><br><span class="line">        Map&lt;String, Class&gt; annotationClassMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        <span class="comment">//springå·¥å…·ç±»ï¼Œå¯ä»¥è·å–æŒ‡å®šè·¯å¾„ä¸‹çš„å…¨éƒ¨ç±»</span></span><br><span class="line">        <span class="type">ResourcePatternResolver</span> <span class="variable">resourcePatternResolver</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PathMatchingResourcePatternResolver</span>();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">pattern</span> <span class="operator">=</span> ResourcePatternResolver.CLASSPATH_ALL_URL_PREFIX +</span><br><span class="line">                    ClassUtils.convertClassNameToResourcePath(basePackage) + RESOURCE_PATTERN;</span><br><span class="line">            Resource[] resources = resourcePatternResolver.getResources(pattern);</span><br><span class="line">            <span class="comment">//MetadataReader çš„å·¥å‚ç±»</span></span><br><span class="line">            <span class="type">MetadataReaderFactory</span> <span class="variable">refractory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CachingMetadataReaderFactory</span>(resourcePatternResolver);</span><br><span class="line">            <span class="keyword">for</span> (Resource resource : resources) &#123;</span><br><span class="line">                <span class="comment">//ç”¨äºè¯»å–ç±»ä¿¡æ¯</span></span><br><span class="line">                <span class="type">MetadataReader</span> <span class="variable">reader</span> <span class="operator">=</span> refractory.getMetadataReader(resource);</span><br><span class="line">                <span class="comment">//æ‰«æåˆ°çš„class</span></span><br><span class="line">                <span class="type">String</span> <span class="variable">classname</span> <span class="operator">=</span> reader.getClassMetadata().getClassName();</span><br><span class="line">                Class&lt;?&gt; clazz = Class.forName(classname);</span><br><span class="line">                <span class="comment">//åˆ¤æ–­æ˜¯å¦å±äºæŒ‡å®šçš„æ³¨è§£ç±»å‹</span></span><br><span class="line">                <span class="keyword">if</span>(clazz.isAnnotationPresent(MyComponent.class))&#123;</span><br><span class="line">                    <span class="comment">//è·å¾—æ³¨è§£å¯¹è±¡</span></span><br><span class="line">                    <span class="type">MyComponent</span> <span class="variable">annotation</span> <span class="operator">=</span> clazz.getAnnotation(MyComponent.class);</span><br><span class="line">                    <span class="comment">//è·å¾—å±valueå±æ€§å€¼</span></span><br><span class="line">                    <span class="type">String</span> <span class="variable">beanName</span> <span class="operator">=</span> annotation.value();</span><br><span class="line">                    <span class="comment">//åˆ¤æ–­æ˜¯å¦ä¸º&quot;&quot;</span></span><br><span class="line">                    <span class="keyword">if</span>(beanName!=<span class="literal">null</span>&amp;&amp;!beanName.equals(<span class="string">&quot;&quot;</span>))&#123;</span><br><span class="line">                        <span class="comment">//å­˜å‚¨åˆ°Mapä¸­å»</span></span><br><span class="line">                        annotationClassMap.put(beanName,clazz);</span><br><span class="line">                        <span class="keyword">continue</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="comment">//å¦‚æœæ²¡æœ‰ä¸º&quot;&quot;,é‚£å°±æŠŠå½“å‰ç±»çš„ç±»åä½œä¸ºbeanName</span></span><br><span class="line">                    annotationClassMap.put(clazz.getSimpleName(),clazz);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception exception) &#123;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> annotationClassMap;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        Map&lt;String, Class&gt; stringClassMap = scanMyComponentAnnotation(<span class="string">&quot;com.lyf&quot;</span>);</span><br><span class="line">        System.out.println(stringClassMap);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li>è‡ªå®šä¹‰çš„ Bean å·¥å‚åå¤„ç†å™¨ï¼Œç»§æ‰¿ BeanDefinitionRegistryPostProcessor ï¼Œå®ç°æ–¹æ³•å¦‚ä¸‹ï¼š</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">postProcessBeanDefinitionRegistry</span><span class="params">(BeanDefinitionRegistry registry)</span> <span class="keyword">throws</span> BeansException &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">basePackage</span> <span class="operator">=</span> <span class="string">&quot;com.lyf&quot;</span>;</span><br><span class="line">    Map&lt;String, Class&gt; map = BaseClassScanUtils.scanMyComponentAnnotation(basePackage);</span><br><span class="line">    <span class="keyword">for</span> (String beanName : map.keySet()) &#123;</span><br><span class="line">        <span class="type">BeanDefinition</span> <span class="variable">beanDefinition</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RootBeanDefinition</span>(map.get(beanName));</span><br><span class="line">        registry.registerBeanDefinition(beanName, beanDefinition);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li>é…ç½®æ–‡ä»¶</li></ol><p>æ³¨å…¥è‡ªå®šä¹‰çš„ Bean å·¥å‚åå¤„ç†å™¨</p><ol><li>æµ‹è¯•ï¼šç»™ Dog ç±»ï¼ŒCat ç±»åŠ ä¸Šè‡ªå®šä¹‰æ³¨è§£ @MyComponent </li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ApplicationContextTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">ApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;applicationContext.xml&quot;</span>);</span><br><span class="line">        <span class="type">Dog</span> <span class="variable">dog</span> <span class="operator">=</span> context.getBean(Dog.class);</span><br><span class="line">        System.out.println(dog);</span><br><span class="line">        <span class="type">Cat</span> <span class="variable">cat</span> <span class="operator">=</span> context.getBean(Cat.class);</span><br><span class="line">        System.out.println(cat);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="BeanPostProcessor"><a href="#BeanPostProcessor" class="headerlink" title="BeanPostProcessor"></a>BeanPostProcessor</h2><p>Bean è¢«å®ä¾‹åŒ–åï¼Œåˆ°æœ€ç»ˆç¼“å­˜åˆ°åä¸º singletonObjects å•ä¾‹æ± ä¹‹å‰ï¼Œä¸­é—´ä¼šç»è¿‡ Bean çš„åˆå§‹åŒ–è¿‡ç¨‹ï¼Œä¾‹å¦‚ï¼šå±æ€§çš„å¡«å……ã€åˆå§‹æ–¹æ³• init çš„æ‰§è¡Œç­‰ï¼Œå…¶ä¸­æœ‰ä¸€ä¸ªå¯¹å¤–è¿›è¡Œæ‰©å±•çš„ç‚¹ BeanPostProcessorï¼Œæˆ‘ä»¬ç§°ä¸º Bean åå¤„ç†ã€‚è·Ÿä¸Šé¢çš„ Bean å·¥å‚åå¤„ç†å™¨ç›¸ä¼¼ï¼Œå®ƒä¹Ÿæ˜¯ä¸€ä¸ªæ¥å£ï¼Œå®ç°äº†è¯¥æ¥å£å¹¶è¢«å®¹å™¨ç®¡ç†çš„ BeanPostProcessorï¼Œä¼šåœ¨æµç¨‹èŠ‚ç‚¹ä¸Šè¢« Spring è‡ªåŠ¨è°ƒç”¨ã€‚</p><p>BeanPostProcessor çš„æ¥å£å®šä¹‰å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">BeanPostProcessor</span> &#123;</span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    <span class="comment">// åœ¨å±æ€§æ³¨å…¥å®Œæ¯•ï¼Œinit åˆå§‹åŒ–æ–¹æ³•æ‰§è¡Œä¹‹å‰è¢«å›è°ƒ</span></span><br><span class="line">    <span class="keyword">default</span> Object <span class="title function_">postProcessBeforeInitialization</span><span class="params">(Object bean, String beanName)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> bean;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    <span class="comment">// åœ¨åˆå§‹åŒ–æ–¹æ³•æ‰§è¡Œä¹‹åï¼Œè¢«æ·»åŠ åˆ°å•ä¾‹æ±  singletonObjects ä¹‹å‰è¢«å›è°ƒ</span></span><br><span class="line">    <span class="keyword">default</span> Object <span class="title function_">postProcessAfterInitialization</span><span class="params">(Object bean, String beanName)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> bean;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="æ¥å£æ–¹æ³•æ‰§è¡Œæ—¶æœº"><a href="#æ¥å£æ–¹æ³•æ‰§è¡Œæ—¶æœº" class="headerlink" title="æ¥å£æ–¹æ³•æ‰§è¡Œæ—¶æœº"></a>æ¥å£æ–¹æ³•æ‰§è¡Œæ—¶æœº</h3><p>UserDao.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserDao</span> <span class="keyword">implements</span> <span class="title class_">InitializingBean</span> &#123;</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;UserDaoå±æ€§å¡«å……äº†...&quot;</span>);</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">UserDao</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;UserDaoå®ä¾‹åŒ–...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterPropertiesSet</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;UserDaoåˆå§‹åŒ–æ–¹æ³•æ‰§è¡Œ...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>MyBeanPostProcessor.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyBeanPostProcessor</span> <span class="keyword">implements</span> <span class="title class_">BeanPostProcessor</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">postProcessBeforeInitialization</span><span class="params">(Object bean, String beanName)</span> <span class="keyword">throws</span> BeansException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;BeanPostProcessor çš„ before æ–¹æ³•æ‰§è¡Œäº†...&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> bean;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">postProcessAfterInitialization</span><span class="params">(Object bean, String beanName)</span> <span class="keyword">throws</span> BeansException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;BeanPostProcessor çš„ after æ–¹æ³•æ‰§è¡Œäº†...&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> bean;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é…ç½®æ–‡ä»¶</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userDao&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.lyf.dao.UserDao&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;leesin&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;com.lyf.processor.MyBeanPostProcessor&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure><p>æµ‹è¯•ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">App</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">ClassPathXmlApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;applicationContext.xml&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœ</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">UserDaoå®ä¾‹åŒ–...</span><br><span class="line">UserDaoå±æ€§å¡«å……äº†...</span><br><span class="line">BeanPostProcessor çš„ before æ–¹æ³•æ‰§è¡Œäº†...</span><br><span class="line">UserDaoåˆå§‹åŒ–æ–¹æ³•æ‰§è¡Œ...</span><br><span class="line">BeanPostProcessor çš„ after æ–¹æ³•æ‰§è¡Œäº†...</span><br></pre></td></tr></table></figure><h3 id="ä½¿ç”¨æ¡ˆä¾‹"><a href="#ä½¿ç”¨æ¡ˆä¾‹" class="headerlink" title="ä½¿ç”¨æ¡ˆä¾‹"></a>ä½¿ç”¨æ¡ˆä¾‹</h3><p>è¦æ±‚å¦‚ä¸‹:</p><ul><li>Beançš„æ–¹æ³•æ‰§è¡Œä¹‹å‰æ§åˆ¶å°æ‰“å°å½“å‰æ—¶é—´</li><li>Beançš„æ–¹æ³•æ‰§è¡Œä¹‹åæ§åˆ¶å°æ‰“å°å½“å‰æ—¶é—´ã€‚</li></ul><p>åˆ†æ:</p><ul><li>å¯¹æ–¹æ³•è¿›è¡Œå¢å¼ºä¸»è¦å°±æ˜¯ä»£ç†è®¾è®¡æ¨¡å¼å’ŒåŒ…è£…è®¾è®¡æ¨¡å¼</li><li>ç”±äºBeanæ–¹æ³•ä¸ç¡®å®šï¼Œæ‰€ä»¥ä½¿ç”¨åŠ¨æ€ä»£ç†åœ¨è¿è¡ŒæœŸé—´æ‰§è¡Œå¢å¼ºæ“ä½œ</li><li>åœ¨Beanå®ä¾‹åˆ›å»ºå®Œæ¯•åï¼Œè¿›å…¥åˆ°å•ä¾‹æ± ä¹‹å‰ï¼Œä½¿ç”¨Proxyä»£æ›¿çœŸå®çš„ç›®æ ‡Bean</li></ul><p>UserDaoæ¥å£</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserDao</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">hello</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>UserDaoImpl.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserDaoImpl</span> <span class="keyword">implements</span> <span class="title class_">UserDao</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">hello</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;haha...&quot;</span>);</span><br><span class="line">        Thread.sleep(<span class="number">2000</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ—¶é—´æ—¥å¿—å¤„ç†çš„BeanPostProcessor</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TimeLogPostProcessor</span> <span class="keyword">implements</span> <span class="title class_">BeanPostProcessor</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">postProcessAfterInitialization</span><span class="params">(Object bean, String beanName)</span> <span class="keyword">throws</span> BeansException &#123;</span><br><span class="line">        <span class="comment">//å¯¹Beanè¿›è¡ŒåŠ¨æ€ä»£ç†ï¼Œè¿”å›çš„æ˜¯Proxyä»£ç†å¯¹è±¡</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">proxyBean</span> <span class="operator">=</span> Proxy.newProxyInstance(bean.getClass().getClassLoader(),</span><br><span class="line">                bean.getClass().getInterfaces(),</span><br><span class="line">                (Object proxy, Method method, Object[] args) -&gt; &#123;</span><br><span class="line">                    <span class="type">long</span> <span class="variable">start</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">                    System.out.println(<span class="string">&quot;å¼€å§‹æ—¶é—´:&quot;</span> + <span class="keyword">new</span> <span class="title class_">Date</span>(start));</span><br><span class="line">                    <span class="comment">//æ‰§è¡Œç›®æ ‡æ–¹æ³•</span></span><br><span class="line">                    <span class="type">Object</span> <span class="variable">result</span> <span class="operator">=</span> method.invoke(bean, args);</span><br><span class="line">                    <span class="type">long</span> <span class="variable">end</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">                    System.out.println(<span class="string">&quot;ç»“æŸæ—¶é—´:&quot;</span> + <span class="keyword">new</span> <span class="title class_">Date</span>(end));</span><br><span class="line">                    System.out.println(<span class="string">&quot;è€—æ—¶ï¼š&quot;</span> + (end - start) + <span class="string">&quot;ms&quot;</span>);</span><br><span class="line">                    <span class="keyword">return</span> result;</span><br><span class="line">                &#125;);</span><br><span class="line">        <span class="keyword">return</span> proxyBean;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é…ç½®æ–‡ä»¶</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userDao&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.lyf.dao.impl.UserDaoImpl&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;com.lyf.processor.TimeLogPostProcessor&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure><p>æµ‹è¯•ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">App</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">ClassPathXmlApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> </span><br><span class="line">          <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;applicationContext.xml&quot;</span>);</span><br><span class="line">        <span class="type">UserDao</span> <span class="variable">userDao</span> <span class="operator">=</span> (UserDao) context.getBean(<span class="string">&quot;userDao&quot;</span>);</span><br><span class="line">        userDao.hello();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡º</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">å¼€å§‹æ—¶é—´:Fri May 05 10:43:54 CST 2023</span><br><span class="line">haha...</span><br><span class="line">ç»“æŸæ—¶é—´:Fri May 05 10:43:57 CST 2023</span><br><span class="line">è€—æ—¶ï¼š2017ms</span><br></pre></td></tr></table></figure><blockquote><p>æ³¨æ„ï¼šä»£ç†çš„ç›®æ ‡Beanåªèƒ½æ˜¯å®ç°äº†æ¥å£çš„å¯¹è±¡ï¼Œå› ä¸ºjdkæä¾›çš„åŠ¨æ€ä»£ç†å°±æ˜¯åªæ”¯æŒè¿™æ ·çš„ç±»å‹çš„å¯¹è±¡çš„ã€‚</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> åç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> spring </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Beanå®ä¾‹åŒ–æµç¨‹</title>
      <link href="/post/26.html"/>
      <url>/post/26.html</url>
      
        <content type="html"><![CDATA[<h1 id="Beanå®ä¾‹åŒ–çš„åŸºæœ¬æµç¨‹â­â­â­"><a href="#Beanå®ä¾‹åŒ–çš„åŸºæœ¬æµç¨‹â­â­â­" class="headerlink" title="Beanå®ä¾‹åŒ–çš„åŸºæœ¬æµç¨‹â­â­â­"></a>Beanå®ä¾‹åŒ–çš„åŸºæœ¬æµç¨‹â­â­â­</h1><p>Spring å®¹å™¨åœ¨è¿›è¡Œåˆå§‹åŒ–æ—¶ï¼Œä¼šå°† xml é…ç½®çš„çš„ä¿¡æ¯å°è£…æˆä¸€ä¸ª BeanDefinition å¯¹è±¡ï¼Œæ‰€æœ‰çš„ BeanDefinition å­˜å‚¨åˆ°ä¸€ä¸ªåä¸º beanDefinitionMap çš„ Map é›†åˆä¸­å»ï¼ŒSpring æ¡†æ¶åœ¨å¯¹è¯¥ Map è¿›è¡Œéå†ï¼Œä½¿ç”¨åå°„åˆ›å»º Bean å®ä¾‹å¯¹è±¡ï¼Œåˆ›å»ºå¥½çš„Bean å¯¹è±¡å­˜å‚¨åœ¨ä¸€ä¸ªåä¸º singletonObjects çš„ Map é›†åˆä¸­ï¼Œå½“è°ƒç”¨ getBean æ–¹æ³•æ—¶ï¼Œåˆ™æœ€ç»ˆä»è¯¥ Map é›†åˆä¸­å–å‡º Bean å®ä¾‹å¯¹è±¡è¿”å›ã€‚</p><blockquote><p>æ‰€ä»¥åªè¦æƒ³åŠæ³•å°† BeanDefinition æ³¨å†Œåˆ° beanDefinitionMap ä¸­ï¼ŒSpring å°±ä¼šè¿›è¡Œå¯¹åº”çš„ Bean çš„å®ä¾‹åŒ–æ“ä½œ</p></blockquote><p>æ€»ç»“åŸºæœ¬æµç¨‹ï¼š</p><ol><li>åŠ è½½ xml é…ç½®æ–‡ä»¶ï¼Œè§£æè·å–é…ç½®ä¸­çš„æ¯ä¸ªçš„ä¿¡æ¯ï¼Œå°è£…æˆä¸€ä¸ªä¸ªçš„ BeanDefinition å¯¹è±¡; </li><li>å°† BeanDefinition å­˜å‚¨åœ¨ beanDefinitionMap ä¸­</li><li>ApplicationContext åº•å±‚éå† beanDefinitionMapï¼Œåˆ›å»º Bean å®ä¾‹å¯¹è±¡;</li><li>åˆ›å»ºå¥½çš„ Bean å®ä¾‹å¯¹è±¡ï¼Œè¢«å­˜å‚¨åˆ°ä¸€ä¸ªåä¸º singletonObjects çš„ Map ä¸­;</li><li>å½“æ‰§è¡Œ applicationContext.getBean(beanName) æ—¶ï¼Œä» singletonObjects å»åŒ¹é… Bean å®ä¾‹è¿”å›ã€‚</li></ol><p><img src="http://cdn.leesin.fun/typora/s3/img/Beanå®ä¾‹åŒ–çš„åŸºæœ¬æµç¨‹.png" alt="Beanå®ä¾‹åŒ–çš„åŸºæœ¬æµç¨‹"></p><blockquote><p>æ›´è¯¦ç»†/ç»†èŠ‚çš„æµç¨‹å›¾ è¯·çœ‹ä¸‹é¢çš„å›¾ </p></blockquote><h2 id="æµç¨‹ç»†èŠ‚å‡çº§1"><a href="#æµç¨‹ç»†èŠ‚å‡çº§1" class="headerlink" title="æµç¨‹ç»†èŠ‚å‡çº§1"></a>æµç¨‹ç»†èŠ‚å‡çº§1</h2><p>BeanFactoryPostProcessor åœ¨ SpringBean çš„å®ä¾‹åŒ–è¿‡ç¨‹ä¸­çš„ä½“ç°ï¼š</p><p><img src="http://cdn.leesin.fun/typora/s3/img/Beanå®ä¾‹åŒ–çš„åŸºæœ¬æµç¨‹2.png" alt="Beanå®ä¾‹åŒ–çš„åŸºæœ¬æµç¨‹2"></p><h2 id="æµç¨‹ç»†èŠ‚å‡çº§2"><a href="#æµç¨‹ç»†èŠ‚å‡çº§2" class="headerlink" title="æµç¨‹ç»†èŠ‚å‡çº§2"></a>æµç¨‹ç»†èŠ‚å‡çº§2</h2><p>BeanPostProcessor åœ¨ SpringBean çš„å®ä¾‹åŒ–è¿‡ç¨‹ä¸­çš„ä½“ç°ï¼š</p><p><img src="http://cdn.leesin.fun/typora/s3/img/Beanå®ä¾‹åŒ–çš„åŸºæœ¬æµç¨‹3.png" alt="Beanå®ä¾‹åŒ–çš„åŸºæœ¬æµç¨‹3"></p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p><img src="http://cdn.leesin.fun/typora/s3/img/Spring IoCæ•´ä½“æµç¨‹.png" alt="Spring IoCæ•´ä½“æµç¨‹"></p>]]></content>
      
      
      <categories>
          
          <category> åç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> spring </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åŸºäºxmlçš„Springåº”ç”¨</title>
      <link href="/post/25.html"/>
      <url>/post/25.html</url>
      
        <content type="html"><![CDATA[<h1 id="SpringBean-çš„é…ç½®è¯¦è§£"><a href="#SpringBean-çš„é…ç½®è¯¦è§£" class="headerlink" title="SpringBean çš„é…ç½®è¯¦è§£"></a>SpringBean çš„é…ç½®è¯¦è§£</h1><div class="table-container"><table><thead><tr><th style="text-align:center">Xmlé…ç½®æ–¹å¼</th><th style="text-align:center">åŠŸèƒ½æè¿°</th></tr></thead><tbody><tr><td style="text-align:center"><code>&lt;bean id=&quot;&quot; class=&quot;&quot;&gt;</code></td><td style="text-align:center">Beançš„idå’Œå…¨é™å®šåé…ç½®</td></tr><tr><td style="text-align:center"><code>&lt;bean name=&quot;alias1,alias2&quot;&gt;</code></td><td style="text-align:center">é€šè¿‡nameè®¾ç½®Beançš„åˆ«åï¼Œé€šè¿‡åˆ«åä¹Ÿèƒ½ç›´æ¥è·å–åˆ°Beanå®ä¾‹ã€‚åˆ«åå¯ä»¥æœ‰å¤šä¸ªï¼Œç”¨é€—å·éš”å¼€</td></tr><tr><td style="text-align:center"><code>&lt;bean scope=&quot;&quot;&gt;</code></td><td style="text-align:center">Beançš„ä½œç”¨èŒƒå›´ï¼ŒBeanFactoryä½œä¸ºå®¹å™¨æ—¶å–å€¼singletonå’Œprototypeã€‚<strong>é»˜è®¤å€¼singleton</strong></td></tr><tr><td style="text-align:center"><code>&lt;bean lazy-init=&quot;&quot;&gt;</code></td><td style="text-align:center">Beançš„å®ä¾‹åŒ–æ—¶æœºï¼Œæ˜¯å¦å»¶è¿ŸåŠ è½½ã€‚BeanFactoryä½œä¸ºå®¹å™¨æ—¶æ— æ•ˆ</td></tr><tr><td style="text-align:center"><code>&lt;bean init-method=&quot;&quot;&gt;</code></td><td style="text-align:center">Beanå®ä¾‹åŒ–åè‡ªåŠ¨æ‰§è¡Œçš„åˆå§‹åŒ–æ–¹æ³•ï¼ŒmethodæŒ‡å®šæ–¹æ³•å</td></tr><tr><td style="text-align:center"><code>&lt;bean destroy-method=&quot;&quot;&gt;</code></td><td style="text-align:center">Beanå®ä¾‹é”€æ¯å‰çš„æ–¹æ³•ï¼ŒmethodæŒ‡å®šæ–¹æ³•å</td></tr><tr><td style="text-align:center"><code>&lt;bean autowire=&quot;byType&quot;&gt;</code></td><td style="text-align:center">è®¾ç½®è‡ªåŠ¨æ³¨å…¥æ¨¡å¼ï¼Œå¸¸ç”¨çš„æœ‰æŒ‰ç…§ç±»å‹byTypeï¼ŒæŒ‰ç…§åå­—byName</td></tr><tr><td style="text-align:center"><code>&lt;bean factory-bean=&quot;&quot; factory-method=&quot;&quot;/&gt;</code></td><td style="text-align:center">æŒ‡å®šå“ªä¸ªå·¥å‚Beançš„å“ªä¸ªæ–¹æ³•å®ŒæˆBeançš„åˆ›å»º</td></tr></tbody></table></div><h2 id="Beançš„idå’Œname"><a href="#Beançš„idå’Œname" class="headerlink" title="Beançš„idå’Œname"></a>Beançš„idå’Œname</h2><h3 id="æƒ…å†µ1ï¼šé…ç½®äº†-Bean-çš„-idï¼Œé‚£ä¹ˆ-beanName-å°±ä¸º-id"><a href="#æƒ…å†µ1ï¼šé…ç½®äº†-Bean-çš„-idï¼Œé‚£ä¹ˆ-beanName-å°±ä¸º-id" class="headerlink" title="æƒ…å†µ1ï¼šé…ç½®äº† Bean çš„ idï¼Œé‚£ä¹ˆ beanName å°±ä¸º id"></a>æƒ…å†µ1ï¼šé…ç½®äº† Bean çš„ idï¼Œé‚£ä¹ˆ beanName å°±ä¸º id</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userService&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.lyf.service.impl.UserServiceImpl&quot;</span>&gt;</span> <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ä¸‹é¢è¿™æ®µä»£ç æ˜¯å¯ä»¥æ‹¿åˆ° Bean çš„</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ApplicationContextTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">ApplicationContext</span> <span class="variable">applicationContext</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;applicationContext.xml&quot;</span>);</span><br><span class="line">        <span class="type">UserService</span> <span class="variable">userService</span> <span class="operator">=</span> (UserService) applicationContext.getBean(<span class="string">&quot;userService&quot;</span>);</span><br><span class="line">        System.out.println(userService); <span class="comment">// æ‹¿å¾—åˆ°</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="http://cdn.leesin.fun/typora/s3/img/beanName1.png" alt="beanName1"></p><h3 id="æƒ…å†µ2ï¼šæ²¡é…ç½®-Bean-çš„-idï¼Œé‚£ä¹ˆ-BeanName-é»˜è®¤ä¸ºç±»çš„å…¨é™å®šåï¼Œå³-com-lyf-service-impl-UserServiceImpl"><a href="#æƒ…å†µ2ï¼šæ²¡é…ç½®-Bean-çš„-idï¼Œé‚£ä¹ˆ-BeanName-é»˜è®¤ä¸ºç±»çš„å…¨é™å®šåï¼Œå³-com-lyf-service-impl-UserServiceImpl" class="headerlink" title="æƒ…å†µ2ï¼šæ²¡é…ç½® Bean çš„ idï¼Œé‚£ä¹ˆ BeanName é»˜è®¤ä¸ºç±»çš„å…¨é™å®šåï¼Œå³ com.lyf.service.impl.UserServiceImpl"></a>æƒ…å†µ2ï¼šæ²¡é…ç½® Bean çš„ idï¼Œé‚£ä¹ˆ BeanName é»˜è®¤ä¸ºç±»çš„å…¨é™å®šåï¼Œå³ com.lyf.service.impl.UserServiceImpl</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;com.lyf.service.impl.UserServiceImpl&quot;</span>&gt;</span> <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ä¸‹é¢è¿™æ®µä»£ç æ˜¯å¯ä»¥æ‹¿åˆ° Bean çš„</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ApplicationContextTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">ApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;applicationContext.xml&quot;</span>);</span><br><span class="line">        <span class="comment">// System.out.println(context.getBean(&quot;userService&quot;)); // æ‹¿ä¸åˆ°</span></span><br><span class="line">        System.out.println(context.getBean(<span class="string">&quot;com.lyf.service.impl.UserServiceImpl&quot;</span>)); <span class="comment">// æ‹¿å¾—åˆ°</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="http://cdn.leesin.fun/typora/s3/img/beanName2.png" alt="beanName2"></p><h4 id="æƒ…å†µ3ï¼šå¯ä»¥ä¸ºå½“å‰-Bean-æŒ‡å®šå¤šä¸ªåˆ«åï¼Œæ ¹æ®åˆ«åä¹Ÿå¯ä»¥è·å¾—-Bean-å¯¹è±¡"><a href="#æƒ…å†µ3ï¼šå¯ä»¥ä¸ºå½“å‰-Bean-æŒ‡å®šå¤šä¸ªåˆ«åï¼Œæ ¹æ®åˆ«åä¹Ÿå¯ä»¥è·å¾—-Bean-å¯¹è±¡" class="headerlink" title="æƒ…å†µ3ï¼šå¯ä»¥ä¸ºå½“å‰ Bean æŒ‡å®šå¤šä¸ªåˆ«åï¼Œæ ¹æ®åˆ«åä¹Ÿå¯ä»¥è·å¾— Bean å¯¹è±¡"></a>æƒ…å†µ3ï¼šå¯ä»¥ä¸ºå½“å‰ Bean æŒ‡å®šå¤šä¸ªåˆ«åï¼Œæ ¹æ®åˆ«åä¹Ÿå¯ä»¥è·å¾— Bean å¯¹è±¡</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userService&quot;</span> <span class="attr">name</span>=<span class="string">&quot;aaa,bbb,ccc&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.lyf.service.impl.UserServiceImpl&quot;</span>&gt;</span> <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ä¸‹é¢è¿™æ®µä»£ç æ˜¯éƒ½å¯ä»¥æ‹¿åˆ° Bean çš„</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ApplicationContextTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">ApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;applicationContext.xml&quot;</span>);</span><br><span class="line">        System.out.println(context.getBean(<span class="string">&quot;userService&quot;</span>)); <span class="comment">// æ‹¿å¾—åˆ°</span></span><br><span class="line">        System.out.println(context.getBean(<span class="string">&quot;aaa&quot;</span>)); <span class="comment">// æ‹¿å¾—åˆ°</span></span><br><span class="line">        System.out.println(context.getBean(<span class="string">&quot;bbb&quot;</span>)); <span class="comment">// æ‹¿å¾—åˆ°</span></span><br><span class="line">        System.out.println(context.getBean(<span class="string">&quot;ccc&quot;</span>)); <span class="comment">// æ‹¿å¾—åˆ°</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="http://cdn.leesin.fun/typora/s3/img/beanName3.png" alt="beanName3"></p><blockquote><p>Debugæ¨¡å¼ä¸‹ï¼Œå¯»æ‰¾BeanNameå’ŒBeançš„é”®å€¼å¯¹ã€‚</p><p>applicationContext -&gt; beanFactory -&gt; singleonObjects -&gt; table</p><p>applicationContext -&gt; beanFactory -&gt; aliasMap -&gt; table</p></blockquote><h2 id="Beançš„èŒƒå›´"><a href="#Beançš„èŒƒå›´" class="headerlink" title="Beançš„èŒƒå›´"></a>Beançš„èŒƒå›´</h2><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œå•çº¯çš„ Spring ç¯å¢ƒ Bean çš„ä½œç”¨èŒƒå›´æœ‰ä¸¤ä¸ªï¼šSingletonå’ŒPrototype </p><ul><li>singletonï¼šå•ä¾‹ï¼Œé»˜è®¤å€¼ï¼ŒSpring å®¹å™¨åˆ›å»ºçš„æ—¶å€™ï¼Œå°±ä¼šè¿›è¡Œ Bean çš„å®ä¾‹åŒ–ï¼Œå¹¶å­˜å‚¨åˆ°å®¹å™¨å†…éƒ¨çš„å•ä¾‹æ± ä¸­ ï¼Œæ¯æ¬¡ getBean æ—¶éƒ½æ˜¯ä»å•ä¾‹æ± ä¸­è·å–ç›¸åŒçš„ Bean å®ä¾‹ã€‚</li><li>prototypeï¼šåŸå‹ï¼ŒSpring å®¹å™¨åˆå§‹åŒ–æ—¶ä¸ä¼šåˆ›å»ºBeanå®ä¾‹ï¼Œå½“è°ƒç”¨ getBean æ—¶æ‰ä¼šå®ä¾‹åŒ– Beanï¼Œæ¯æ¬¡ getBean éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ Bean å®ä¾‹ã€‚</li></ul><h2 id="Beançš„å»¶è¿ŸåŠ è½½"><a href="#Beançš„å»¶è¿ŸåŠ è½½" class="headerlink" title="Beançš„å»¶è¿ŸåŠ è½½"></a>Beançš„å»¶è¿ŸåŠ è½½</h2><p>lazy-init é»˜è®¤å€¼ false</p><p>å½“ lazy-init è®¾ç½®ä¸º true æ—¶ä¸ºå»¶è¿ŸåŠ è½½ï¼Œä¹Ÿå°±æ˜¯å½“ Spring å®¹å™¨åˆ›å»ºçš„æ—¶å€™ï¼Œä¸ä¼šç«‹å³åˆ›å»º Bean å®ä¾‹ï¼Œç­‰å¾…ç”¨åˆ°æ—¶åœ¨åˆ›å»º Bean å®ä¾‹å¹¶å­˜å‚¨åˆ°å•ä¾‹æ± ä¸­å»ï¼Œåç»­åœ¨ä½¿ç”¨è¯¥ Bean ç›´æ¥ä»å•ä¾‹æ± è·å–å³å¯ï¼Œæœ¬è´¨ä¸Šè¯¥ Bean è¿˜æ˜¯å•ä¾‹çš„ã€‚</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userService&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.lyf.service.impl.UserServiceImpl&quot;</span> <span class="attr">lazy-init</span>=<span class="string">&quot;true&quot;</span>&gt;</span> <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>æ³¨æ„ï¼šåœ¨ã€Šã€SpringåŸºç¡€ã€‘BeanFactoryä¸ApplicationContextã€‹çš„ã€Š2.3.BeanFactoryä¸ApplicationContextçš„å…³ç³»ã€‹ä¸­å·²ç»è¯æ˜äº†</p><blockquote><p><strong>Beançš„åˆå§‹åŒ–æ—¶æœºä¸åŒ</strong>ï¼ŒåŸå§‹BeanFactoryæ˜¯åœ¨é¦–æ¬¡è°ƒç”¨getBeanæ—¶æ‰è¿›è¡ŒBeançš„åˆ›å»ºï¼Œè€ŒApplicationContextåˆ™æ˜¯é…ç½®æ–‡ä»¶åŠ è½½ï¼Œå®¹å™¨ä¸€åˆ›å»ºå°±å°†Beanéƒ½å®ä¾‹åŒ–å¹¶åˆå§‹åŒ–å¥½ã€‚</p></blockquote><p>æ‰€ä»¥ lazy-init å±æ€§æ˜¯é’ˆå¯¹ ApplicationContext çš„ï¼Œå¹¶ä¸ä¼šå¯¹ BeanFactory ç”Ÿæ•ˆã€‚</p><p>ï¼ˆæµ‹è¯•åœ¨ä¹‹å‰çš„æ–‡ç« å†™çš„æ¯”è¾ƒè¯¦ç»†ï¼Œè¿™é‡Œå°±ä¸å†debugæµ‹è¯•ï¼‰</p></blockquote><h2 id="Beançš„init-methodå’Œdestroy-method"><a href="#Beançš„init-methodå’Œdestroy-method" class="headerlink" title="Beançš„init-methodå’Œdestroy-method"></a>Beançš„init-methodå’Œdestroy-method</h2><p>é…ç½®æ–‡ä»¶</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userService&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.lyf.service.impl.UserServiceImpl&quot;</span> <span class="attr">init-method</span>=<span class="string">&quot;init&quot;</span> <span class="attr">destroy-method</span>=<span class="string">&quot;destroy&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure><p>æµ‹è¯•ä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">UserServiceImpl</span><span class="params">()</span>&#123; System.out.println(<span class="string">&quot;å®ä¾‹åŒ–...&quot;</span>); &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span> &#123; System.out.println(<span class="string">&quot;init...&quot;</span>); &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">destroy</span><span class="params">()</span> &#123; System.out.println(<span class="string">&quot;destroy...&quot;</span>); &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ApplicationContextTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">ApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;applicationContext.xml&quot;</span>);</span><br><span class="line">        ((ClassPathXmlApplicationContext)context).close();<span class="comment">// æ˜¾å¼å…³é—­å®¹å™¨</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>å®ä¾‹åŒ–â€¦<br>initâ€¦<br>destroyâ€¦</p></blockquote><h2 id="Beançš„å®ä¾‹åŒ–é…ç½®â­â­â­"><a href="#Beançš„å®ä¾‹åŒ–é…ç½®â­â­â­" class="headerlink" title="Beançš„å®ä¾‹åŒ–é…ç½®â­â­â­"></a>Beançš„å®ä¾‹åŒ–é…ç½®â­â­â­</h2><p>Springçš„å®ä¾‹åŒ–æ–¹å¼ä¸»è¦å¦‚ä¸‹ä¸¤ç§ï¼š </p><ol><li>æ„é€ æ–¹å¼å®ä¾‹åŒ–ï¼šåº•å±‚é€šè¿‡æ„é€ æ–¹æ³•å¯¹Beanè¿›è¡Œå®ä¾‹åŒ–</li><li>å·¥å‚æ–¹å¼å®ä¾‹åŒ–ï¼šåº•å±‚é€šè¿‡è°ƒç”¨è‡ªå®šä¹‰çš„å·¥å‚æ–¹æ³•å¯¹Beanè¿›è¡Œå®ä¾‹åŒ–</li></ol><h3 id="æ„é€ æ–¹å¼å®ä¾‹åŒ–"><a href="#æ„é€ æ–¹å¼å®ä¾‹åŒ–" class="headerlink" title="æ„é€ æ–¹å¼å®ä¾‹åŒ–"></a>æ„é€ æ–¹å¼å®ä¾‹åŒ–</h3><p>æ„é€ æ–¹å¼å®ä¾‹åŒ– Bean åˆåˆ†ä¸ºæ— å‚æ„é€ æ–¹æ³•å®ä¾‹åŒ–å’Œæœ‰å‚æ„é€ æ–¹æ³•å®ä¾‹åŒ–ï¼ŒSpring ä¸­é…ç½®çš„å‡ ä¹éƒ½æ˜¯æ— å‚æ„é€ è¯¥æ–¹å¼ï¼Œæ­¤å¤„ä¸åœ¨èµ˜è¿°ã€‚ä¸‹é¢ä¸¾ä¾‹æœ‰å‚æ„é€ æ–¹æ³•å®ä¾‹åŒ–ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">UserServiceImpl</span><span class="params">(String userName)</span> &#123;<span class="comment">//æœ‰å‚æ„é€ æ–¹æ³•</span></span><br><span class="line">        System.out.println(<span class="string">&quot;ç”¨æˆ·åæ˜¯&quot;</span> + userName);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ‰å‚æ„é€ åœ¨å®ä¾‹åŒ– Bean æ—¶ï¼Œéœ€è¦å‚æ•°çš„æ³¨å…¥ï¼Œé€šè¿‡<code>&lt;constructor-arg&gt;</code>æ ‡ç­¾ï¼ŒåµŒå…¥åœ¨<code>&lt;bean&gt;</code>æ ‡ç­¾å†…éƒ¨æä¾›æ„é€ å‚æ•°ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userService&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.lyf.service.impl.UserServiceImpl&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">&quot;userName&quot;</span> <span class="attr">value</span>=<span class="string">&quot;zhangsan&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="å·¥å‚æ–¹å¼å®ä¾‹åŒ–"><a href="#å·¥å‚æ–¹å¼å®ä¾‹åŒ–" class="headerlink" title="å·¥å‚æ–¹å¼å®ä¾‹åŒ–"></a>å·¥å‚æ–¹å¼å®ä¾‹åŒ–</h3><p>å·¥å‚æ–¹å¼å®ä¾‹åŒ–Beanï¼Œåˆåˆ†ä¸ºå¦‚ä¸‹ä¸‰ç§ï¼š</p><ol><li>é™æ€å·¥å‚æ–¹æ³•å®ä¾‹åŒ–Bean</li><li>å®ä¾‹å·¥å‚æ–¹æ³•å®ä¾‹åŒ–Bean</li><li>å®ç°FactoryBeanè§„èŒƒå»¶è¿Ÿå®ä¾‹åŒ–Bean</li></ol><h4 id="é™æ€å·¥å‚æ–¹æ³•å®ä¾‹åŒ–Bean"><a href="#é™æ€å·¥å‚æ–¹æ³•å®ä¾‹åŒ–Bean" class="headerlink" title="é™æ€å·¥å‚æ–¹æ³•å®ä¾‹åŒ–Bean"></a>é™æ€å·¥å‚æ–¹æ³•å®ä¾‹åŒ–Bean</h4><p>Beanç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å·¥å‚ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyBeanFactory1</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> UserService <span class="title function_">userService</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">UserServiceImpl</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é…ç½®</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userService&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.lyf.factory.MyBeanFactory1&quot;</span> <span class="attr">factory-method</span>=<span class="string">&quot;userService&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure><p>æµ‹è¯•ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ApplicationContextTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">ApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;applicationContext.xml&quot;</span>);</span><br><span class="line">        System.out.println(context.getBean(<span class="string">&quot;userService&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="å®ä¾‹å·¥å‚æ–¹æ³•å®ä¾‹åŒ–Bean"><a href="#å®ä¾‹å·¥å‚æ–¹æ³•å®ä¾‹åŒ–Bean" class="headerlink" title="å®ä¾‹å·¥å‚æ–¹æ³•å®ä¾‹åŒ–Bean"></a>å®ä¾‹å·¥å‚æ–¹æ³•å®ä¾‹åŒ–Bean</h4><p>å·¥å‚ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyBeanFactory2</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> UserService <span class="title function_">userService</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">UserServiceImpl</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é…ç½®</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;myBeanFactory2&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.lyf.factory.MyBeanFactory2&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userService&quot;</span> <span class="attr">factory-bean</span>=<span class="string">&quot;myBeanFactory2&quot;</span> <span class="attr">factory-method</span>=<span class="string">&quot;userService&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure><p>æµ‹è¯•ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ApplicationContextTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">ApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;applicationContext.xml&quot;</span>);</span><br><span class="line">        System.out.println(context.getBean(<span class="string">&quot;userService&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="http://cdn.leesin.fun/typora/s3/img/å®ä¾‹BeanFactoryåˆ›å»ºBean.png" alt="å®ä¾‹BeanFactoryåˆ›å»ºBean"></p><blockquote><p>é™æ€å·¥å‚æ–¹æ³•å®ä¾‹åŒ–Beanï¼šä¸ä¼šåˆ›å»ºå·¥å‚å¯¹è±¡</p><p>å®ä¾‹å·¥å‚æ–¹æ³•å®ä¾‹åŒ–Beanï¼šä¼šåˆ›å»ºå·¥å‚å¯¹è±¡ï¼Œä¸”å­˜åœ¨ singletonObjects ä¸­</p></blockquote><h4 id="å®ç°FactoryBeanè§„èŒƒå»¶è¿Ÿå®ä¾‹åŒ–Bean"><a href="#å®ç°FactoryBeanè§„èŒƒå»¶è¿Ÿå®ä¾‹åŒ–Bean" class="headerlink" title="å®ç°FactoryBeanè§„èŒƒå»¶è¿Ÿå®ä¾‹åŒ–Bean"></a>å®ç°FactoryBeanè§„èŒƒå»¶è¿Ÿå®ä¾‹åŒ–Bean</h4><p>å·¥å‚ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyBeanFactory3</span> <span class="keyword">implements</span> <span class="title class_">FactoryBean</span>&lt;UserService&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> UserService <span class="title function_">getObject</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;UserServiceImplè¢«åˆ›å»ºäº†...&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">UserServiceImpl</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Class&lt;?&gt; getObjectType() &#123;</span><br><span class="line">        <span class="keyword">return</span> UserService.class;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é…ç½®</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userService&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.lyf.factory.MyBeanFactory3&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>ç»§æ‰¿äº†Springçš„FactoryBeanæ¥å£ï¼Œå°±ä¸ç”¨åƒä¹‹å‰ä¸€æ ·äº†ï¼Œé…ç½®æ–¹å¼æœ‰ç‚¹æ”¹åŠ¨ã€‚</p></blockquote><p>æµ‹è¯•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ApplicationContextTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">ApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;applicationContext.xml&quot;</span>);</span><br><span class="line">        System.out.println(context.getBean(<span class="string">&quot;userService&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ–­ç‚¹è°ƒè¯•ï¼ŒéªŒè¯å»¶è¿Ÿå®ä¾‹åŒ–Bean</p><ol><li>å½“ applicationContext è¢«åˆ›å»ºæ—¶ï¼Œæ§åˆ¶å°æ²¡æœ‰ä»»ä½•è¾“å‡ºï¼Œè¯´æ˜ UserServiceImpl å®ä¾‹è¿˜æ²¡è¢«åˆ›å»ºã€‚æ­¤æ—¶ï¼ŒsingleObjects ä¸­ userService å¯¹åº”çš„å€¼æ˜¯ä»–çš„å·¥å‚ MyBeanFactory3ã€‚</li></ol><p><img src="http://cdn.leesin.fun/typora/s3/img/MyBeanFactory3è°ƒè¯•1.png" alt="MyBeanFactory3è°ƒè¯•1"></p><blockquote><p>è¿™ç§æ–¹å¼ä¸‹ï¼Œcontext -&gt; beanFactory -&gt; singletonObjects -&gt; table ä¸­ï¼ŒuserService å¯¹åº”çš„å±…ç„¶ä¸æ˜¯ UserServiceImplï¼Œè€Œæ˜¯ä»–çš„å·¥å‚ç±» MyBeanFactory3</p></blockquote><ol><li>å½“è°ƒç”¨äº† <code>context.getBean(&quot;userService&quot;)</code> æ—¶ï¼Œæ§åˆ¶å°æ‰æ‰“å°äº† <code>UserServiceImplè¢«åˆ›å»ºäº†...</code> ï¼Œè¯´æ˜è¿™ç§æ–¹å¼çœŸçš„å¯ä»¥å»¶è¿Ÿå®ä¾‹åŒ– Beanã€‚</li></ol><p><img src="http://cdn.leesin.fun/typora/s3/img/MyBeanFactory3è°ƒè¯•2.png" alt="MyBeanFactory3è°ƒè¯•2"></p><blockquote><p>åŸæ¥ï¼Œè¿™ç§æ–¹å¼ä¸‹ï¼ŒçœŸæ­£çš„ UserServiceImpl å®ä¾‹å­˜å‚¨åœ¨ context -&gt; beanFactory -&gt; factoryBeanObjectCache -&gt; table ä¸­äº†</p></blockquote><h2 id="Beançš„å®ä¾‹åŒ–é…ç½®ç»ƒä¹ â­â­â­"><a href="#Beançš„å®ä¾‹åŒ–é…ç½®ç»ƒä¹ â­â­â­" class="headerlink" title="Beançš„å®ä¾‹åŒ–é…ç½®ç»ƒä¹ â­â­â­"></a>Beançš„å®ä¾‹åŒ–é…ç½®ç»ƒä¹ â­â­â­</h2><h3 id="ç»ƒä¹ 1ï¼šæ„é€ æ–¹å¼å®ä¾‹åŒ–"><a href="#ç»ƒä¹ 1ï¼šæ„é€ æ–¹å¼å®ä¾‹åŒ–" class="headerlink" title="ç»ƒä¹ 1ï¼šæ„é€ æ–¹å¼å®ä¾‹åŒ–"></a>ç»ƒä¹ 1ï¼šæ„é€ æ–¹å¼å®ä¾‹åŒ–</h3><p>é…ç½® Druid æ•°æ®æºäº¤ç”± Spring ç®¡ç†</p><ol><li>å¯¼å…¥åæ ‡</li></ol><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- mysqlé©±åŠ¨ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.49<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- druidæ•°æ®æº --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.23<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><ol><li>åŸæ¥çš„æ–¹å¼</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">DruidDataSource</span> <span class="variable">dataSource</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DruidDataSource</span>();</span><br><span class="line">dataSource.setDriverClassName(<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>);</span><br><span class="line">dataSource.setUrl(<span class="string">&quot;jdbc://localhost:3306/test&quot;</span>);</span><br><span class="line">dataSource.setUsername(<span class="string">&quot;root&quot;</span>);</span><br><span class="line">dataSource.setPassword(<span class="string">&quot;root&quot;</span>);</span><br></pre></td></tr></table></figure><ol><li>spring ç®¡ç†çš„æ–¹å¼</li></ol><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;datasource&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.alibaba.druid.pool.DruidDataSource&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driverClassName&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;jdbc:mysql://localhost:3306/test&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ApplicationContextTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> SQLException &#123;</span><br><span class="line">        <span class="type">ApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;applicationContext.xml&quot;</span>);</span><br><span class="line">        System.out.println(context.getBean(<span class="string">&quot;datasource&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ç»ƒä¹ 2ï¼šé™æ€å·¥å‚æ–¹æ³•å®ä¾‹åŒ–"><a href="#ç»ƒä¹ 2ï¼šé™æ€å·¥å‚æ–¹æ³•å®ä¾‹åŒ–" class="headerlink" title="ç»ƒä¹ 2ï¼šé™æ€å·¥å‚æ–¹æ³•å®ä¾‹åŒ–"></a>ç»ƒä¹ 2ï¼šé™æ€å·¥å‚æ–¹æ³•å®ä¾‹åŒ–</h3><p>é…ç½® Connection äº¤ç”± Spring ç®¡ç†</p><ol><li>å¯¼å…¥åæ ‡ï¼šå’Œç»ƒä¹ 1çš„ä¸€æ ·</li><li>åŸæ¥çš„æ–¹å¼</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Class.forName(<span class="string">&quot;com.mysql.jdbc.Connection&quot;</span>);</span><br><span class="line"><span class="type">Connection</span> <span class="variable">conn</span> <span class="operator">=</span> DriverManager.getConnection(<span class="string">&quot;jdbc:mysql://localhost:3306/test&quot;</span>, <span class="string">&quot;root&quot;</span>, <span class="string">&quot;root&quot;</span>);</span><br><span class="line">System.out.println(conn);</span><br></pre></td></tr></table></figure><ol><li>spring ç®¡ç†çš„æ–¹å¼</li></ol><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;driverClass&quot;</span> <span class="attr">class</span>=<span class="string">&quot;java.lang.Class&quot;</span> <span class="attr">factory-method</span>=<span class="string">&quot;forName&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">&quot;className&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.mysql.jdbc.Connection&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;conn&quot;</span> <span class="attr">class</span>=<span class="string">&quot;java.sql.DriverManager&quot;</span> <span class="attr">factory-method</span>=<span class="string">&quot;getConnection&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;jdbc:mysql://localhost:3306/test&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">&quot;user&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ApplicationContextTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> SQLException, ClassNotFoundException &#123;</span><br><span class="line">        <span class="type">ApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;applicationContext.xml&quot;</span>);</span><br><span class="line">        <span class="type">Connection</span> <span class="variable">conn</span> <span class="operator">=</span> (Connection) context.getBean(<span class="string">&quot;conn&quot;</span>);</span><br><span class="line">        System.out.println(conn);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ç»ƒä¹ 3ï¼šå®ä¾‹å·¥å‚æ–¹æ³•å®ä¾‹åŒ–"><a href="#ç»ƒä¹ 3ï¼šå®ä¾‹å·¥å‚æ–¹æ³•å®ä¾‹åŒ–" class="headerlink" title="ç»ƒä¹ 3ï¼šå®ä¾‹å·¥å‚æ–¹æ³•å®ä¾‹åŒ–"></a>ç»ƒä¹ 3ï¼šå®ä¾‹å·¥å‚æ–¹æ³•å®ä¾‹åŒ–</h3><p>é…ç½®æ—¥æœŸå¯¹è±¡äº¤ç”±Springç®¡ç†</p><p>åŸå§‹ä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">currentTimeStr</span> <span class="operator">=</span> <span class="string">&quot;2023-08-27 07:20:00&quot;</span>;</span><br><span class="line"><span class="type">SimpleDateFormat</span> <span class="variable">simpleDateFormat</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>);</span><br><span class="line"><span class="type">Date</span> <span class="variable">date</span> <span class="operator">=</span> simpleDateFormat.parse(currentTimeStr);</span><br><span class="line">System.out.println(date);</span><br></pre></td></tr></table></figure><p>spring ç®¡ç†çš„æ–¹å¼</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--sdfç›¸å½“äºæ˜¯ä¸€ä¸ªå·¥å‚--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;sdf&quot;</span> <span class="attr">class</span>=<span class="string">&quot;java.text.SimpleDateFormat&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">&quot;pattern&quot;</span> <span class="attr">value</span>=<span class="string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;myDate&quot;</span> <span class="attr">factory-bean</span>=<span class="string">&quot;sdf&quot;</span> <span class="attr">factory-method</span>=<span class="string">&quot;parse&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">&quot;source&quot;</span> <span class="attr">value</span>=<span class="string">&quot;2023-08-27 07:20:00&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ApplicationContextTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> SQLException, ClassNotFoundException, ParseException &#123;</span><br><span class="line">        <span class="type">ApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;applicationContext.xml&quot;</span>);</span><br><span class="line">        <span class="type">Date</span> <span class="variable">date</span> <span class="operator">=</span> context.getBean(Date.class);</span><br><span class="line">        System.out.println(date);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ç»ƒä¹ 4ï¼šç»¼åˆ"><a href="#ç»ƒä¹ 4ï¼šç»¼åˆ" class="headerlink" title="ç»ƒä¹ 4ï¼šç»¼åˆ"></a>ç»ƒä¹ 4ï¼šç»¼åˆ</h3><p>é…ç½®MyBatisçš„SqlSessionFactoryäº¤ç”±Springç®¡ç†</p><p>å¯¼å…¥åæ ‡</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--mybatisæ¡†æ¶--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.5.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- mysqlé©±åŠ¨ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.49<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>åŸå§‹ä»£ç </p><p>mybatis-config.xml</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">configuration</span></span></span><br><span class="line"><span class="meta">        <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">environments</span> <span class="attr">default</span>=<span class="string">&quot;development&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">&quot;development&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">&quot;JDBC&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">&quot;POOLED&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driver&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;jdbc:mysql://localhost:3306/test&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">environments</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//åŠ è½½mybatisæ ¸å¿ƒé…ç½®æ–‡ä»¶ï¼Œä½¿ç”¨Springé™æ€å·¥å‚æ–¹å¼</span></span><br><span class="line"><span class="type">InputStream</span> <span class="variable">in</span> <span class="operator">=</span> Resources.getResourceAsStream(<span class="string">&quot;mybatis-config.xml&quot;</span>);</span><br><span class="line"><span class="comment">//åˆ›å»ºSqlSessionFactoryBuilderå¯¹è±¡ï¼Œä½¿ç”¨Springæ— å‚æ„é€ æ–¹å¼</span></span><br><span class="line"><span class="type">SqlSessionFactoryBuilder</span> <span class="variable">builder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBuilder</span>();</span><br><span class="line"><span class="comment">//è°ƒç”¨SqlSessionFactoryBuilderçš„buildæ–¹æ³•ï¼Œä½¿ç”¨Springå®ä¾‹å·¥å‚æ–¹å¼</span></span><br><span class="line"><span class="type">SqlSessionFactory</span> <span class="variable">sqlSessionFactory</span> <span class="operator">=</span> builder.build(in);</span><br><span class="line">System.out.println(sqlSessionFactory);</span><br></pre></td></tr></table></figure><p>spring ç®¡ç†æ–¹å¼</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--é™æ€å·¥å‚æ–¹æ³•å®ä¾‹åŒ–--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;in&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.apache.ibatis.io.Resources&quot;</span> <span class="attr">factory-method</span>=<span class="string">&quot;getResourceAsStream&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">&quot;resource&quot;</span> <span class="attr">value</span>=<span class="string">&quot;mybatis-config.xml&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--ç›¸å½“äºæ˜¯ä¸€ä¸ªå®ä¾‹å·¥å‚--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;builder&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.apache.ibatis.session.SqlSessionFactoryBuilder&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--å®ä¾‹å·¥å‚æ–¹æ³•å®ä¾‹åŒ–--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;sqlSessionFactory&quot;</span> <span class="attr">factory-bean</span>=<span class="string">&quot;builder&quot;</span> <span class="attr">factory-method</span>=<span class="string">&quot;build&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">&quot;inputStream&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;in&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ApplicationContextTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">ApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;applicationContext.xml&quot;</span>);</span><br><span class="line">        <span class="type">SqlSessionFactory</span> <span class="variable">sqlSessionFactory</span> <span class="operator">=</span> context.getBean(SqlSessionFactory.class);</span><br><span class="line">        System.out.println(sqlSessionFactory);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Beançš„ä¾èµ–æ³¨å…¥é…ç½®"><a href="#Beançš„ä¾èµ–æ³¨å…¥é…ç½®" class="headerlink" title="Beançš„ä¾èµ–æ³¨å…¥é…ç½®"></a>Beançš„ä¾èµ–æ³¨å…¥é…ç½®</h2><p>ç•¥</p>]]></content>
      
      
      <categories>
          
          <category> åç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> spring </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>BeanFactoryä¸ApplicationContext</title>
      <link href="/post/24.html"/>
      <url>/post/24.html</url>
      
        <content type="html"><![CDATA[<h1 id="Spring-Framework-æŠ€æœ¯æ ˆå›¾ç¤º"><a href="#Spring-Framework-æŠ€æœ¯æ ˆå›¾ç¤º" class="headerlink" title="Spring Framework æŠ€æœ¯æ ˆå›¾ç¤º"></a>Spring Framework æŠ€æœ¯æ ˆå›¾ç¤º</h1><p><img src="http://cdn.leesin.fun/typora/s3/img/Spring Framework æŠ€æœ¯æ ˆå›¾ç¤º.png" alt="Spring Framework æŠ€æœ¯æ ˆå›¾ç¤º"></p><p>åœ¨mavenä¸­å¯¼å…¥spring-contextåæ ‡ï¼Œå°±ä¼šè‡ªåŠ¨å¯¼å…¥Aopã€Beansã€Coreã€SpEl</p><p><img src="http://cdn.leesin.fun/typora/s3/img/å¼•å…¥spring-contextåŒ….png" alt="å¼•å…¥spring-contextåŒ…"></p><h1 id="BeanFactory-å’ŒApplicationContext"><a href="#BeanFactory-å’ŒApplicationContext" class="headerlink" title="BeanFactory å’ŒApplicationContext"></a>BeanFactory å’ŒApplicationContext</h1><h2 id="BeanFactoryä½¿ç”¨ç¤ºä¾‹"><a href="#BeanFactoryä½¿ç”¨ç¤ºä¾‹" class="headerlink" title="BeanFactoryä½¿ç”¨ç¤ºä¾‹"></a>BeanFactoryä½¿ç”¨ç¤ºä¾‹</h2><ol><li>å¯¼å…¥Springçš„jaråŒ…æˆ–Mavenåæ ‡</li></ol><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.3.7<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><ol><li>å®šä¹‰UserServiceæ¥å£åŠå…¶UserServiceImplå®ç°ç±»</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li>åˆ›å»ºbeans.xmlé…ç½®æ–‡ä»¶ï¼Œå°†UserServiceImplçš„ä¿¡æ¯é…ç½®åˆ°è¯¥xmlä¸­</li></ol><p><img src="http://cdn.leesin.fun/typora/s3/img/æ–°å»ºbeans.xml.png" alt="æ–°å»ºbeans.xml"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;bean id=<span class="string">&quot;userService&quot;</span> class=<span class="string">&quot;com.lyf.service.impl.UserServiceImpl&quot;</span>&gt; &lt;/bean&gt;</span><br></pre></td></tr></table></figure><ol><li>ç¼–å†™æµ‹è¯•ä»£ç ï¼Œåˆ›å»ºBeanFactoryï¼ŒåŠ è½½é…ç½®æ–‡ä»¶ï¼Œè·å–UserServiceå®ä¾‹å¯¹è±¡</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="comment">// åˆ›å»º BeanFactory</span></span><br><span class="line">    <span class="type">DefaultListableBeanFactory</span> <span class="variable">beanFactory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DefaultListableBeanFactory</span>();</span><br><span class="line">    <span class="comment">// åˆ›å»ºè¯»å–å™¨</span></span><br><span class="line">    <span class="type">XmlBeanDefinitionReader</span> <span class="variable">reader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">XmlBeanDefinitionReader</span>(beanFactory);</span><br><span class="line">    <span class="comment">// åŠ è½½é…ç½®æ–‡ä»¶</span></span><br><span class="line">    reader.loadBeanDefinitions(<span class="string">&quot;beans.xml&quot;</span>);</span><br><span class="line">    <span class="comment">// è·å– Bean å®ä¾‹å¯¹è±¡</span></span><br><span class="line">    <span class="type">UserService</span> <span class="variable">userService</span> <span class="operator">=</span> (UserService) beanFactory.getBean(<span class="string">&quot;userService&quot;</span>);</span><br><span class="line">    System.out.println(userService);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ApplicationContextä½¿ç”¨ç¤ºä¾‹"><a href="#ApplicationContextä½¿ç”¨ç¤ºä¾‹" class="headerlink" title="ApplicationContextä½¿ç”¨ç¤ºä¾‹"></a>ApplicationContextä½¿ç”¨ç¤ºä¾‹</h2><p>ApplicationContext ç§°ä¸ºSpringå®¹å™¨ï¼Œå†…éƒ¨å°è£…äº†BeanFactoryï¼Œæ¯”BeanFactoryåŠŸèƒ½æ›´ä¸°å¯Œæ›´å¼ºå¤§ï¼Œä½¿ç”¨ ApplicationContext è¿›è¡Œå¼€å‘æ—¶ï¼Œxmlé…ç½®æ–‡ä»¶çš„åç§°ä¹ æƒ¯å†™æˆapplicationContext.xml</p><p>æµ‹è¯•ç±»å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="comment">// åˆ›å»º ApplicationContext ,åŠ è½½é…ç½®æ–‡ä»¶ï¼Œå®ä¾‹åŒ–å®¹å™¨</span></span><br><span class="line">    <span class="type">ApplicationContext</span> <span class="variable">applicationContext</span> <span class="operator">=</span></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;applicationContext.xml&quot;</span>);</span><br><span class="line">    <span class="comment">//æ ¹æ® beanName è·å¾—å®¹å™¨ä¸­çš„ Bean å®ä¾‹</span></span><br><span class="line">    <span class="type">UserService</span> <span class="variable">userService</span> <span class="operator">=</span> (UserService) applicationContext.getBean(<span class="string">&quot;userService&quot;</span>);</span><br><span class="line">    System.out.println(userService);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="BeanFactoryä¸ApplicationContextçš„å…³ç³»"><a href="#BeanFactoryä¸ApplicationContextçš„å…³ç³»" class="headerlink" title="BeanFactoryä¸ApplicationContextçš„å…³ç³»"></a>BeanFactoryä¸ApplicationContextçš„å…³ç³»</h2><ol><li><p>BeanFactoryæ˜¯Springçš„æ—©æœŸæ¥å£ï¼Œç§°ä¸ºSpringçš„Beanå·¥å‚ï¼ŒApplicationContextæ˜¯åæœŸæ›´é«˜çº§æ¥å£ï¼Œç§°ä¹‹ä¸º Spring å®¹å™¨ï¼›</p></li><li><p>ApplicationContextåœ¨BeanFactoryåŸºç¡€ä¸Šå¯¹åŠŸèƒ½è¿›è¡Œäº†æ‰©å±•ï¼Œä¾‹å¦‚ï¼šç›‘å¬åŠŸèƒ½ã€å›½é™…åŒ–åŠŸèƒ½ç­‰ã€‚BeanFactoryçš„ APIæ›´åå‘åº•å±‚ï¼ŒApplicationContextçš„APIå¤§å¤šæ•°æ˜¯å¯¹è¿™äº›åº•å±‚APIçš„å°è£…ï¼› </p></li><li><p>Beanåˆ›å»ºçš„ä¸»è¦é€»è¾‘å’ŒåŠŸèƒ½éƒ½è¢«å°è£…åœ¨BeanFactoryä¸­ï¼ŒApplicationContextä¸ä»…ç»§æ‰¿äº†BeanFactoryï¼Œè€Œä¸” ApplicationContextå†…éƒ¨è¿˜ç»´æŠ¤ç€BeanFactoryçš„å¼•ç”¨ï¼Œæ‰€ä»¥ï¼ŒApplicationContextä¸BeanFactoryæ—¢æœ‰ç»§æ‰¿å…³ç³»ï¼Œåˆæœ‰èåˆå…³ç³»ã€‚</p></li></ol><p><img src="http://cdn.leesin.fun/typora/s3/img/ApplicationContextç»§æ‰¿ä½“ç³»å›¾.png" alt="ApplicationContextç»§æ‰¿ä½“ç³»å›¾"></p><ol><li><strong>Beançš„åˆå§‹åŒ–æ—¶æœºä¸åŒ</strong>ï¼ŒåŸå§‹BeanFactoryæ˜¯åœ¨é¦–æ¬¡è°ƒç”¨getBeanæ—¶æ‰è¿›è¡ŒBeançš„åˆ›å»ºï¼Œè€ŒApplicationContextåˆ™æ˜¯é…ç½®æ–‡ä»¶åŠ è½½ï¼Œå®¹å™¨ä¸€åˆ›å»ºå°±å°†Beanéƒ½å®ä¾‹åŒ–å¹¶åˆå§‹åŒ–å¥½ã€‚</li></ol><p>éªŒè¯ BeanFactory å’Œ ApplicationContext å¯¹ Bean çš„åˆå§‹åŒ–æ—¶æœºï¼Œåœ¨ UserServiceImpl çš„æ— å‚æ„é€ å†…æ‰“å°ä¸€å¥è¯ï¼ŒéªŒè¯æ„é€ æ–¹æ³•çš„æ‰§è¡Œæ—¶æœºã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">UserServiceImpl</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;UserServiceImplåˆ›å»ºäº†...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ–­ç‚¹è°ƒè¯•ï¼Œæµ‹è¯• BeanFactory åˆ›å»º Beançš„æ—¶æœº</p><p><img src="http://cdn.leesin.fun/typora/s3/img/æµ‹è¯•BeanFactoryåˆ›å»ºBeanæ—¶æœº1.png" alt="æµ‹è¯•BeanFactoryåˆ›å»ºBeanæ—¶æœº1"></p><p><img src="http://cdn.leesin.fun/typora/s3/img/æµ‹è¯•BeanFactoryåˆ›å»ºBeanæ—¶æœº2.png" alt="æµ‹è¯•BeanFactoryåˆ›å»ºBeanæ—¶æœº2"></p><p>æ–­ç‚¹è°ƒè¯•ï¼Œæµ‹è¯• ApplicationContext åˆ›å»º Beançš„æ—¶æœº</p><p><img src="http://cdn.leesin.fun/typora/s3/img/æµ‹è¯•ApplicationContextåˆ›å»ºBeanæ—¶æœº.png" alt="æµ‹è¯•ApplicationContextåˆ›å»ºBeanæ—¶æœº"></p><p>ç»“è®ºï¼šBeanFactory æ–¹å¼æ—¶ï¼Œå½“è°ƒç”¨getBeanæ–¹æ³•æ—¶æ‰ä¼šæŠŠéœ€è¦çš„ Bean å®ä¾‹åˆ›å»ºï¼Œå³å»¶è¿ŸåŠ è½½ï¼›è€Œ ApplicationContext æ˜¯åŠ è½½é…ç½®æ–‡ä»¶ï¼Œå®¹å™¨åˆ›å»ºæ—¶å°±å°†æ‰€æœ‰çš„Beanå®ä¾‹éƒ½åˆ›å»ºå¥½äº†ï¼Œå­˜å‚¨åˆ°ä¸€ä¸ªå•ä¾‹æ± ä¸­ï¼Œå½“è°ƒç”¨ getBean æ—¶ç›´æ¥ä»å•ä¾‹æ± ä¸­è·å–Beanå®ä¾‹è¿”å›</p><h2 id="BeanFactoryçš„ç»§æ‰¿ä½“ç³»"><a href="#BeanFactoryçš„ç»§æ‰¿ä½“ç³»" class="headerlink" title="BeanFactoryçš„ç»§æ‰¿ä½“ç³»"></a>BeanFactoryçš„ç»§æ‰¿ä½“ç³»</h2><p>BeanFactory æ˜¯æ ¸å¿ƒæ¥å£ï¼Œé¡¹ç›®è¿è¡Œè¿‡ç¨‹ä¸­è‚¯å®šæœ‰å…·ä½“å®ç°å‚ä¸ï¼Œè¿™ä¸ªå…·ä½“å®ç°å°±æ˜¯ <strong>DefaultListableBeanFactory</strong> ï¼Œè€Œ ApplicationContext å†…éƒ¨ç»´æŠ¤çš„ Beanfactory çš„å®ç°ç±»ä¹Ÿæ˜¯å®ƒ</p><p><img src="http://cdn.leesin.fun/typora/s3/img/BeanFactoryç»§æ‰¿ä½“ç³»å›¾.png" alt="BeanFactoryç»§æ‰¿ä½“ç³»å›¾"></p><h2 id="ApplicationContextçš„ç»§æ‰¿ä½“ç³»"><a href="#ApplicationContextçš„ç»§æ‰¿ä½“ç³»" class="headerlink" title="ApplicationContextçš„ç»§æ‰¿ä½“ç³»"></a>ApplicationContextçš„ç»§æ‰¿ä½“ç³»</h2><p>åªåœ¨ Spring åŸºç¡€ç¯å¢ƒä¸‹ï¼Œå³åªå¯¼å…¥ spring-context åæ ‡æ—¶ï¼Œæ­¤æ—¶ ApplicationContext çš„ç»§æ‰¿ä½“ç³»</p><p><img src="http://cdn.leesin.fun/typora/s3/img/ApplicationContextç»§æ‰¿ä½“ç³»å›¾2.png" alt="ApplicationContextç»§æ‰¿ä½“ç³»å›¾2"></p><p>åªåœ¨SpringåŸºç¡€ç¯å¢ƒä¸‹ï¼Œå¸¸ç”¨çš„ä¸‰ä¸ªApplicationContextä½œç”¨å¦‚ä¸‹ï¼š</p><div class="table-container"><table><thead><tr><th style="text-align:center">å®ç°ç±»</th><th style="text-align:center">åŠŸèƒ½æè¿°</th></tr></thead><tbody><tr><td style="text-align:center">ClassPathXmlApplicationContext</td><td style="text-align:center">åŠ è½½ç±»è·¯å¾„ä¸‹çš„xmlé…ç½®çš„ApplicationContext</td></tr><tr><td style="text-align:center">FileSystemXmlApplicationContext</td><td style="text-align:center">åŠ è½½ç£ç›˜è·¯å¾„ä¸‹çš„xmlé…ç½®çš„ApplicationContext</td></tr><tr><td style="text-align:center">AnnotationConfigApplicationContext</td><td style="text-align:center">åŠ è½½æ³¨è§£é…ç½®ç±»çš„ApplicationContext</td></tr></tbody></table></div><p>å¦‚æœ Spring åŸºç¡€ç¯å¢ƒä¸­åŠ å…¥äº†å…¶ä»–ç»„ä»¶è§£å†³æ–¹æ¡ˆï¼Œå¦‚ web å±‚è§£å†³æ–¹æ¡ˆï¼Œå³å¯¼å…¥ spring-web åæ ‡ï¼Œæ­¤æ—¶ ApplicationContext çš„ç»§æ‰¿ä½“ç³»</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.3.7<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p><img src="http://cdn.leesin.fun/typora/s3/img/ApplicationContextç»§æ‰¿ä½“ç³»å›¾ï¼ˆWebç¯å¢ƒï¼‰.png" alt="ApplicationContextç»§æ‰¿ä½“ç³»å›¾ï¼ˆWebç¯å¢ƒï¼‰"></p><p>åœ¨Springçš„webç¯å¢ƒä¸‹ï¼Œå¸¸ç”¨çš„ä¸¤ä¸ªApplicationContextä½œç”¨å¦‚ä¸‹ï¼š</p><div class="table-container"><table><thead><tr><th style="text-align:center">å®ç°ç±»</th><th style="text-align:center">åŠŸèƒ½æè¿°</th></tr></thead><tbody><tr><td style="text-align:center">XmlWebApplicationContext</td><td style="text-align:center">webç¯å¢ƒä¸‹ï¼ŒåŠ è½½ç±»è·¯å¾„ä¸‹çš„xmlé…ç½®çš„ApplicationContext</td></tr><tr><td style="text-align:center">AnnotationConfigWebApplicationContext</td><td style="text-align:center">webç¯å¢ƒä¸‹ï¼ŒåŠ è½½ç£ç›˜è·¯å¾„ä¸‹çš„xmlé…ç½®çš„ApplicationContext</td></tr></tbody></table></div>]]></content>
      
      
      <categories>
          
          <category> åç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> spring </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>IoCã€DIã€AOP</title>
      <link href="/post/23.html"/>
      <url>/post/23.html</url>
      
        <content type="html"><![CDATA[<h1 id="IoCã€DIå’ŒAOPæ€æƒ³æå‡º"><a href="#IoCã€DIå’ŒAOPæ€æƒ³æå‡º" class="headerlink" title="IoCã€DIå’ŒAOPæ€æƒ³æå‡º"></a>IoCã€DIå’ŒAOPæ€æƒ³æå‡º</h1><h2 id="IoC-Inversion-of-Control"><a href="#IoC-Inversion-of-Control" class="headerlink" title="IoC (Inversion of Control)"></a>IoC (Inversion of Control)</h2><p>IoCæ€æƒ³ï¼šç¿»è¯‘ä¸ºâ€œæ§åˆ¶åè½¬â€æˆ–â€œåè½¬æ§åˆ¶â€ï¼Œå¼ºè°ƒçš„æ˜¯åŸæ¥åœ¨ç¨‹åºä¸­åˆ›å»ºBeançš„æƒåˆ©åè½¬ç»™ç¬¬ä¸‰æ–¹ã€‚</p><p>ä¾‹å¦‚ï¼šåŸæ¥åœ¨ç¨‹åºä¸­æ‰‹åŠ¨çš„å» <code>new UserServiceImpl()</code>ï¼Œæ‰‹åŠ¨çš„å»<code>new UserDaoImpl()</code>ï¼Œè€Œæ ¹æ®IoCæ€æƒ³çš„æŒ‡å¯¼ï¼Œ å¯»æ±‚ä¸€ä¸ªç¬¬ä¸‰æ–¹å»åˆ›å»ºUserServiceImplå¯¹è±¡å’ŒUserDaoImplå¯¹è±¡ã€‚è¿™æ ·ç¨‹åºä¸å…·ä½“å¯¹è±¡å°±å¤±å»çš„ç›´æ¥è”ç³»ã€‚</p><p>è°å»å……å½“ç¬¬ä¸‰æ–¹è§’è‰²å‘¢ï¼Ÿ </p><p>â€‹        <strong>å·¥å‚è®¾è®¡æ¨¡å¼</strong>ï¼ŒBeanFactoryæ¥å……å½“ç¬¬ä¸‰æ–¹çš„è§’è‰²ï¼Œæ¥äº§ç”ŸBeanå®ä¾‹ </p><p>BeanFactoryæ€ä¹ˆçŸ¥é“äº§ç”Ÿå“ªäº›Beanå®ä¾‹å‘¢ï¼Ÿ </p><p>â€‹        å¯ä»¥ä½¿ç”¨é…ç½®æ–‡ä»¶é…ç½®Beançš„åŸºæœ¬ä¿¡æ¯ï¼ŒBeanFactoryæ ¹æ®é…ç½®æ–‡ä»¶æ¥ç”Ÿäº§Beanå®ä¾‹</p><p><img src="http://cdn.leesin.fun/typora/s3/img/BeanFactoryæ¡†æ¶å›¾.png" alt="BeanFactoryæ¡†æ¶å›¾"></p><p>ä¾‹å¦‚ï¼Œç”¨IoCæ€æƒ³å»åè½¬UserServiceImplçš„åˆ›å»ºæƒï¼Œç”±åŸæ¥ç¨‹åºä¸­åˆ›å»ºåè½¬ç»™é€šè¿‡BeanFactoryå»åˆ›å»º</p><p><img src="http://cdn.leesin.fun/typora/s3/img/IoC ä¾‹å­.png" alt="IoC ä¾‹å­"></p><h2 id="DI-Dependency-Injection"><a href="#DI-Dependency-Injection" class="headerlink" title="DI (Dependency Injection)"></a>DI (Dependency Injection)</h2><p>ä¸Šé¢ä½¿ç”¨BeanFactoryçš„æ–¹å¼å·²ç»å®ç°çš„â€æ§åˆ¶åè½¬â€ï¼Œå°†Beançš„åˆ›å»ºæƒäº¤ç»™äº†BeanFactoryï¼Œå¦‚æœæˆ‘ä»¬æƒ³å°† UserDaoçš„åˆ›å»ºæƒä¹Ÿåè½¬ç»™BeanFactoryï¼Œä¸æ­¤åŒæ—¶UserServiceå†…éƒ¨è¿˜éœ€è¦ç”¨åˆ°UserDaoå®ä¾‹å¯¹è±¡ï¼Œé‚£åº”è¯¥æ€æ ·æ“ä½œå‘¢ï¼Ÿ</p><p>â€‹        1ï¼‰åœ¨ç¨‹åºä¸­ï¼Œé€šè¿‡BeanFactoryè·å¾—UserService </p><p>â€‹        2ï¼‰åœ¨ç¨‹åºä¸­ï¼Œé€šè¿‡BeanFactoryè·å¾—UserDao</p><p>â€‹        3ï¼‰åœ¨ç¨‹åºä¸­ï¼Œå°†UserDaoè®¾ç½®ç»™UserService</p><p><img src="http://cdn.leesin.fun/typora/s3/img/ä¾èµ–æ³¨å…¥ä¾‹å­.png" alt="ä¾èµ–æ³¨å…¥ä¾‹å­"></p><h2 id="AOP-Aspect-Oriented-Programming"><a href="#AOP-Aspect-Oriented-Programming" class="headerlink" title="AOP (Aspect Oriented Programming)"></a>AOP (Aspect Oriented Programming)</h2><p>AOPï¼Œé¢å‘åˆ‡é¢ç¼–ç¨‹ï¼Œæ˜¯å¯¹é¢å‘å¯¹è±¡ç¼–ç¨‹OOPçš„å‡åã€‚</p><p>OOPæ˜¯çºµå‘å¯¹ä¸€ä¸ªäº‹ç‰©çš„æŠ½è±¡ï¼Œä¸€ä¸ªå¯¹è±¡åŒ…æ‹¬é™æ€çš„å±æ€§ä¿¡æ¯ï¼ŒåŒ…æ‹¬åŠ¨æ€çš„æ–¹æ³•ä¿¡æ¯ç­‰ã€‚</p><p>è€ŒAOPæ˜¯æ¨ªå‘çš„å¯¹ä¸åŒäº‹ç‰©çš„æŠ½è±¡ï¼Œå±æ€§ä¸å±æ€§ã€æ–¹æ³•ä¸æ–¹æ³•ã€å¯¹è±¡ä¸å¯¹è±¡éƒ½å¯ä»¥ç»„æˆä¸€ä¸ªåˆ‡é¢ï¼Œè€Œç”¨è¿™ç§æ€ç»´å»è®¾è®¡ç¼–ç¨‹çš„æ–¹å¼å«åšé¢å‘åˆ‡é¢ç¼–ç¨‹ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> åç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> spring </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€ç®—æ³•ã€‘åŠ›æ‰£101ï¼ˆå¯¹ç§°äºŒå‰æ ‘ï¼‰</title>
      <link href="/post/22.html"/>
      <url>/post/22.html</url>
      
        <content type="html"><![CDATA[<h1 id="é¢˜ç›®æè¿°"><a href="#é¢˜ç›®æè¿°" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h1><p><a href="https://leetcode.cn/problems/symmetric-tree/">101. å¯¹ç§°äºŒå‰æ ‘</a></p><p>ç»™ä½ ä¸€ä¸ªäºŒå‰æ ‘çš„æ ¹èŠ‚ç‚¹ <code>root</code> ï¼Œ æ£€æŸ¥å®ƒæ˜¯å¦è½´å¯¹ç§°ã€‚</p><p>ç¤ºä¾‹ 1ï¼š</p><p><img src="https://assets.leetcode.com/uploads/2021/02/19/symtree1.jpg" alt="å¯¹ç§°äºŒå‰æ ‘ç¤ºä¾‹1"></p><p>è¾“å…¥ï¼šroot = [1,2,2,3,4,4,3]<br>è¾“å‡ºï¼štrue</p><p>ç¤ºä¾‹ 2ï¼š</p><p><img src="https://assets.leetcode.com/uploads/2021/02/19/symtree2.jpg" alt="å¯¹ç§°äºŒå‰æ ‘ç¤ºä¾‹2"></p><p>è¾“å…¥ï¼šroot = [1,2,2,null,3,null,3]<br>è¾“å‡ºï¼šfalse</p><p>æç¤ºï¼š</p><pre><code>æ ‘ä¸­èŠ‚ç‚¹æ•°ç›®åœ¨èŒƒå›´ [1, 1000] å†…-100 &lt;= Node.val &lt;= 100</code></pre><h1 id="è§£æ³•ä¸€ï¼šé€’å½’"><a href="#è§£æ³•ä¸€ï¼šé€’å½’" class="headerlink" title="è§£æ³•ä¸€ï¼šé€’å½’"></a>è§£æ³•ä¸€ï¼šé€’å½’</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isSymmetric</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> isSame(root.left, root.right);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isSame</span><span class="params">(TreeNode node1, TreeNode node2)</span> &#123;</span><br><span class="line">        <span class="comment">// é¦–å…ˆæ’é™¤ç©ºèŠ‚ç‚¹çš„æƒ…å†µ</span></span><br><span class="line">        <span class="keyword">if</span> (node1 == <span class="literal">null</span> &amp;&amp; node2 == <span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">if</span> (node1 == <span class="literal">null</span> || node2 == <span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="comment">// å†æ’é™¤æ•°å€¼ä¸ç›¸åŒçš„æƒ…å†µ</span></span><br><span class="line">        <span class="keyword">if</span> (node1.val != node2.val) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="comment">// æ­¤æ—¶å°±æ˜¯ï¼šå·¦å³èŠ‚ç‚¹éƒ½ä¸ä¸ºç©ºï¼Œä¸”æ•°å€¼ç›¸åŒçš„æƒ…å†µ</span></span><br><span class="line">        <span class="comment">// æ­¤æ—¶æ‰åšé€’å½’ï¼Œåšä¸‹ä¸€å±‚çš„åˆ¤æ–­</span></span><br><span class="line">        <span class="keyword">return</span> isSame(node1.left, node2.right) &amp;&amp; isSame(node1.right, node2.left);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="è§£æ³•äºŒï¼šå±‚åºéå†"><a href="#è§£æ³•äºŒï¼šå±‚åºéå†" class="headerlink" title="è§£æ³•äºŒï¼šå±‚åºéå†"></a>è§£æ³•äºŒï¼šå±‚åºéå†</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isSymmetric</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        Deque&lt;TreeNode&gt; queue = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">        queue.offer(root);</span><br><span class="line">        <span class="keyword">while</span> (!queue.isEmpty()) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">size</span> <span class="operator">=</span> queue.size();</span><br><span class="line">            List&lt;Integer&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; size; i++) &#123;</span><br><span class="line">                <span class="type">TreeNode</span> <span class="variable">cur</span> <span class="operator">=</span> queue.poll();</span><br><span class="line">                <span class="keyword">if</span> (cur == <span class="literal">null</span>) &#123;</span><br><span class="line">                    <span class="comment">// å› ä¸ºé¢˜ç›®è¯´äº†ï¼š-100 &lt;= Node.val &lt;= 100</span></span><br><span class="line">                    <span class="comment">// æ‰€ä»¥è¿™é‡Œå–å·§ï¼Œè®©ç©ºèŠ‚ç‚¹çš„å€¼ä¸º111</span></span><br><span class="line">                    list.add(<span class="number">111</span>);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    list.add(cur.val);</span><br><span class="line">                    queue.offer(cur.left);</span><br><span class="line">                    queue.offer(cur.right);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (!isSymmetric(list)) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isSymmetric</span><span class="params">(List&lt;Integer&gt; list)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">low</span> <span class="operator">=</span> <span class="number">0</span>, high = list.size() - <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span> (low &lt; high) &#123;</span><br><span class="line">            <span class="keyword">if</span> (list.get(low++) != list.get(high--))</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ç®—æ³• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å•è°ƒé˜Ÿåˆ— </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€ç®—æ³•ã€‘äºŒå‰æ ‘çš„æœ€å¤§æ·±åº¦å’Œæœ€å°æ·±åº¦</title>
      <link href="/post/21.html"/>
      <url>/post/21.html</url>
      
        <content type="html"><![CDATA[<h1 id="äºŒå‰æ ‘çš„æœ€å¤§æ·±åº¦"><a href="#äºŒå‰æ ‘çš„æœ€å¤§æ·±åº¦" class="headerlink" title="äºŒå‰æ ‘çš„æœ€å¤§æ·±åº¦"></a>äºŒå‰æ ‘çš„æœ€å¤§æ·±åº¦</h1><h2 id="é¢˜ç›®æè¿°"><a href="#é¢˜ç›®æè¿°" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h2><p>ç»™å®šä¸€ä¸ªäºŒå‰æ ‘ï¼Œæ‰¾å‡ºå…¶æœ€å¤§æ·±åº¦ã€‚äºŒå‰æ ‘çš„æ·±åº¦ä¸ºæ ¹èŠ‚ç‚¹åˆ°æœ€è¿œå¶å­èŠ‚ç‚¹çš„æœ€é•¿è·¯å¾„ä¸Šçš„èŠ‚ç‚¹æ•°ã€‚</p><blockquote><p>ç¤ºä¾‹ï¼šç»™å®šäºŒå‰æ ‘ [3,9,20,null,null,15,7]ï¼Œ<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">  3</span><br><span class="line"> / \</span><br><span class="line">9  20</span><br><span class="line">  /  \</span><br><span class="line"> 15   7</span><br></pre></td></tr></table></figure></p><p>è¿”å›å®ƒçš„æœ€å¤§æ·±åº¦ 3 ã€‚</p></blockquote><h2 id="DFS"><a href="#DFS" class="headerlink" title="DFS"></a>DFS</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">maxDepth</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (root == <span class="literal">null</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">return</span> Math.max(maxDepth(root.left), maxDepth(root.right)) + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="BFS"><a href="#BFS" class="headerlink" title="BFS"></a>BFS</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">maxDepth</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (root == <span class="literal">null</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        Deque&lt;TreeNode&gt; queue = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">        queue.offer(root);</span><br><span class="line">        <span class="type">int</span> <span class="variable">level</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (!queue.isEmpty()) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">size</span> <span class="operator">=</span> queue.size();</span><br><span class="line">            level ++;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; size; i++) &#123;</span><br><span class="line">                <span class="type">TreeNode</span> <span class="variable">cur</span> <span class="operator">=</span> queue.poll();</span><br><span class="line">                <span class="keyword">if</span> (cur.left != <span class="literal">null</span>) queue.offer(cur.left);</span><br><span class="line">                <span class="keyword">if</span> (cur.right != <span class="literal">null</span>) queue.offer(cur.right);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> level;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="äºŒå‰æ ‘çš„æœ€å°æ·±åº¦"><a href="#äºŒå‰æ ‘çš„æœ€å°æ·±åº¦" class="headerlink" title="äºŒå‰æ ‘çš„æœ€å°æ·±åº¦"></a>äºŒå‰æ ‘çš„æœ€å°æ·±åº¦</h1><p><a href="https://leetcode.cn/problems/minimum-depth-of-binary-tree/">111. äºŒå‰æ ‘çš„æœ€å°æ·±åº¦</a></p><h2 id="é¢˜ç›®æè¿°-1"><a href="#é¢˜ç›®æè¿°-1" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h2><p>ç»™å®šä¸€ä¸ªäºŒå‰æ ‘ï¼Œæ‰¾å‡ºå…¶æœ€å°æ·±åº¦ã€‚æœ€å°æ·±åº¦æ˜¯ä»æ ¹èŠ‚ç‚¹åˆ°æœ€è¿‘å¶å­èŠ‚ç‚¹çš„æœ€çŸ­è·¯å¾„ä¸Šçš„èŠ‚ç‚¹æ•°é‡ã€‚</p><blockquote><p>ç¤ºä¾‹ï¼šç»™å®šäºŒå‰æ ‘ [3,9,20,null,null,15,7]ï¼Œ<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">  3</span><br><span class="line"> / \</span><br><span class="line">9  20</span><br><span class="line">  /  \</span><br><span class="line"> 15   7</span><br></pre></td></tr></table></figure></p><p>è¿”å›å®ƒçš„æœ€å°æ·±åº¦ 2 ã€‚</p></blockquote><h2 id="DFS-1"><a href="#DFS-1" class="headerlink" title="DFS"></a>DFS</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">minDepth</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (root == <span class="literal">null</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">return</span> dfs(root); </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">dfs</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (root.left == <span class="literal">null</span> &amp;&amp; root.right == <span class="literal">null</span>) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">left_depth</span> <span class="operator">=</span> Integer.MAX_VALUE, right_depth = Integer.MAX_VALUE;</span><br><span class="line">        <span class="keyword">if</span> (root.left != <span class="literal">null</span>) left_depth = dfs(root.left);</span><br><span class="line">        <span class="keyword">if</span> (root.right != <span class="literal">null</span>) right_depth = dfs(root.right);</span><br><span class="line">        <span class="keyword">return</span> Math.min(left_depth, right_depth) + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="BFS-1"><a href="#BFS-1" class="headerlink" title="BFS"></a>BFS</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">minDepth</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (root == <span class="literal">null</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        Deque&lt;TreeNode&gt; queue = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">        queue.offer(root);</span><br><span class="line">        <span class="type">int</span> <span class="variable">level</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (!queue.isEmpty()) &#123;</span><br><span class="line">            level++;</span><br><span class="line">            <span class="type">int</span> <span class="variable">size</span> <span class="operator">=</span> queue.size();</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; size; i++) &#123;</span><br><span class="line">                <span class="type">TreeNode</span> <span class="variable">cur</span> <span class="operator">=</span> queue.poll();</span><br><span class="line">                <span class="comment">// æ‰¾åˆ°å¶å­èŠ‚ç‚¹ç›´æ¥å¯ä»¥è¿”å›äº†</span></span><br><span class="line">                <span class="keyword">if</span> (isLeaf(cur)) <span class="keyword">return</span> level;</span><br><span class="line">                <span class="keyword">if</span> (cur.left != <span class="literal">null</span>) queue.offer(cur.left);</span><br><span class="line">                <span class="keyword">if</span> (cur.right != <span class="literal">null</span>) queue.offer(cur.right);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isLeaf</span><span class="params">(TreeNode node)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> node.left == <span class="literal">null</span> &amp;&amp; node.right == <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>æ­¤é¢˜ç”¨BFSå¯èƒ½æ•ˆç‡é«˜ã€‚ä¸ç”¨éå†æ‰€æœ‰çš„ç»“ç‚¹ï¼Œå°±èƒ½æ‰¾åˆ°ç­”æ¡ˆã€‚åªè¦æ‰¾åˆ°ä¸€ä¸ªå¶å­èŠ‚ç‚¹ï¼Œå°±å¯ä»¥è¿”å›äº†ã€‚</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> ç®—æ³• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å•è°ƒé˜Ÿåˆ— </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€ç®—æ³•ã€‘æ ‘çš„éé€’å½’éå†</title>
      <link href="/post/20.html"/>
      <url>/post/20.html</url>
      
        <content type="html"><![CDATA[<h1 id="é¢˜ç›®"><a href="#é¢˜ç›®" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h1><p><a href="https://leetcode.cn/problems/binary-tree-preorder-traversal/">144. äºŒå‰æ ‘çš„å‰åºéå†</a>â­</p><p><a href="https://leetcode.cn/problems/binary-tree-postorder-traversal/">145. äºŒå‰æ ‘çš„ååºéå†</a>â­</p><p><a href="https://leetcode.cn/problems/binary-tree-inorder-traversal/">94. äºŒå‰æ ‘çš„ä¸­åºéå†</a>â­â­â­</p><h1 id="å‰åºéå†"><a href="#å‰åºéå†" class="headerlink" title="å‰åºéå†"></a>å‰åºéå†</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> List&lt;Integer&gt; <span class="title function_">preorderTraversal</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        List&lt;Integer&gt; res = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">if</span> (root == <span class="literal">null</span>) <span class="keyword">return</span> res;</span><br><span class="line">        Deque&lt;TreeNode&gt; stack = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">        stack.push(root);</span><br><span class="line">        <span class="keyword">while</span> (!stack.isEmpty()) &#123;</span><br><span class="line">            <span class="type">TreeNode</span> <span class="variable">cur</span> <span class="operator">=</span> stack.pop();</span><br><span class="line">            res.add(cur.val);</span><br><span class="line">            <span class="keyword">if</span> (cur.right != <span class="literal">null</span>) stack.push(cur.right);</span><br><span class="line">            <span class="keyword">if</span> (cur.left != <span class="literal">null</span>) stack.push(cur.left);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="ååºéå†"><a href="#ååºéå†" class="headerlink" title="ååºéå†"></a>ååºéå†</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> List&lt;Integer&gt; <span class="title function_">postorderTraversal</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        List&lt;Integer&gt; res = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">if</span> (root == <span class="literal">null</span>) <span class="keyword">return</span> res;</span><br><span class="line">        Deque&lt;TreeNode&gt; stack = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">        stack.push(root);</span><br><span class="line">        <span class="keyword">while</span> (!stack.isEmpty()) &#123;</span><br><span class="line">            <span class="type">TreeNode</span> <span class="variable">cur</span> <span class="operator">=</span> stack.pop();</span><br><span class="line">            res.add(cur.val);</span><br><span class="line">            <span class="keyword">if</span> (cur.left != <span class="literal">null</span>) stack.push(cur.left);</span><br><span class="line">            <span class="keyword">if</span> (cur.right != <span class="literal">null</span>) stack.push(cur.right);</span><br><span class="line">        &#125;</span><br><span class="line">        Collections.reverse(res);</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="ä¸­åºéå†"><a href="#ä¸­åºéå†" class="headerlink" title="ä¸­åºéå†"></a>ä¸­åºéå†</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> List&lt;Integer&gt; <span class="title function_">inorderTraversal</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        List&lt;Integer&gt; res = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">if</span> (root == <span class="literal">null</span>) <span class="keyword">return</span> res;</span><br><span class="line">        Deque&lt;TreeNode&gt; stack = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">        <span class="type">TreeNode</span> <span class="variable">cur</span> <span class="operator">=</span> root;</span><br><span class="line">        <span class="keyword">while</span> (cur != <span class="literal">null</span> || !stack.isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">while</span> (cur != <span class="literal">null</span>) &#123;</span><br><span class="line">                stack.push(cur);</span><br><span class="line">                cur = cur.left;</span><br><span class="line">            &#125;</span><br><span class="line">            cur = stack.pop();</span><br><span class="line">            res.add(cur.val);</span><br><span class="line">            cur = cur.right;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ç®—æ³• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å•è°ƒé˜Ÿåˆ— </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€ç®—æ³•ã€‘åŠ›æ‰£347ï¼ˆå‰Kä¸ªé«˜é¢‘å…ƒç´ ï¼‰</title>
      <link href="/post/19.html"/>
      <url>/post/19.html</url>
      
        <content type="html"><![CDATA[<h1 id="é¢˜ç›®æè¿°"><a href="#é¢˜ç›®æè¿°" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h1><p>ç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ <code>nums</code> å’Œä¸€ä¸ªæ•´æ•° <code>k</code> ï¼Œè¯·ä½ è¿”å›å…¶ä¸­å‡ºç°é¢‘ç‡å‰ <code>k</code> é«˜çš„å…ƒç´ ã€‚ä½ å¯ä»¥æŒ‰ <strong>ä»»æ„é¡ºåº</strong> è¿”å›ç­”æ¡ˆã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥: nums = [1,1,1,2,2,3], k = 2</span><br><span class="line">è¾“å‡º: [1,2]</span><br><span class="line"></span><br><span class="line">è¾“å…¥: nums = [1], k = 1</span><br><span class="line">è¾“å‡º: [1]</span><br></pre></td></tr></table></figure><h1 id="è§£æ³•ä¸€ï¼šå°æ ¹å †"><a href="#è§£æ³•ä¸€ï¼šå°æ ¹å †" class="headerlink" title="è§£æ³•ä¸€ï¼šå°æ ¹å †"></a>è§£æ³•ä¸€ï¼šå°æ ¹å †</h1><p>å°æ ¹å †è§£æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span>[] topKFrequent(<span class="type">int</span>[] nums, <span class="type">int</span> k) &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> nums.length;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ä½¿ç”¨mapæ¥è®¡æ•°</span></span><br><span class="line">        Map&lt;Integer, Integer&gt; countMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;(); <span class="comment">// ç©ºé—´O(n)</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n; i++) &#123; <span class="comment">// æ—¶é—´O(n)</span></span><br><span class="line">            countMap.put(nums[i], countMap.getOrDefault(nums[i], <span class="number">0</span>) + <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        Set&lt;Integer&gt; keySet = countMap.keySet();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å°æ ¹å †, ç©ºé—´O(k)</span></span><br><span class="line">        PriorityQueue&lt;<span class="type">int</span>[]&gt; q = <span class="keyword">new</span> <span class="title class_">PriorityQueue</span>&lt;&gt;((pair1, pair2) -&gt; pair1[<span class="number">1</span>]-pair2[<span class="number">1</span>]); </span><br><span class="line">        <span class="keyword">for</span> (Integer num : keySet) &#123;<span class="comment">// æ—¶é—´O(n)</span></span><br><span class="line">            <span class="comment">// System.out.println(&quot;key=&quot; + num + &quot; value=&quot; + countMap.get(num));</span></span><br><span class="line">            <span class="keyword">if</span> (q.size() &lt; k) &#123;<span class="comment">// å…ˆå°†kä¸ªå…ƒç´ æ”¾å…¥å°æ ¹å †</span></span><br><span class="line">                q.offer(<span class="keyword">new</span> <span class="title class_">int</span>[]&#123;num, countMap.get(num)&#125;); <span class="comment">// æ—¶é—´O(logk)</span></span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (countMap.get(num) &gt; q.peek()[<span class="number">1</span>]) &#123;</span><br><span class="line">                    q.poll();<span class="comment">// æ—¶é—´O(logk)</span></span><br><span class="line">                    q.offer(<span class="keyword">new</span> <span class="title class_">int</span>[]&#123;num, countMap.get(num)&#125;);<span class="comment">// æ—¶é—´O(logk)</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span>[] res = <span class="keyword">new</span> <span class="title class_">int</span>[k];</span><br><span class="line">        <span class="type">int</span> <span class="variable">idx</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span>[] pair : q) &#123;</span><br><span class="line">            res[idx++] = pair[<span class="number">0</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="å¤æ‚æ€§åˆ†æ"><a href="#å¤æ‚æ€§åˆ†æ" class="headerlink" title="å¤æ‚æ€§åˆ†æ"></a>å¤æ‚æ€§åˆ†æ</h1><blockquote><p>æ—¶é—´å¤æ‚åº¦ï¼šO(Nlogâ¡k)ï¼Œå…¶ä¸­ N ä¸ºæ•°ç»„çš„é•¿åº¦ã€‚æˆ‘ä»¬é¦–å…ˆéå†åŸæ•°ç»„ï¼Œå¹¶ä½¿ç”¨å“ˆå¸Œè¡¨è®°å½•å‡ºç°æ¬¡æ•°ï¼Œæ¯ä¸ªå…ƒç´ éœ€è¦ O(1) çš„æ—¶é—´ï¼Œå…±éœ€ O(N) çš„æ—¶é—´ã€‚éšåï¼Œæˆ‘ä»¬éå†ã€Œå‡ºç°æ¬¡æ•°æ•°ç»„ã€ï¼Œç”±äºå †çš„å¤§å°è‡³å¤šä¸º kï¼Œå› æ­¤æ¯æ¬¡å †æ“ä½œéœ€è¦ O(logâ¡k) çš„æ—¶é—´ï¼Œå…±éœ€ O(Nlogâ¡k)çš„æ—¶é—´ã€‚äºŒè€…ä¹‹å’Œä¸º O(Nlogk)ã€‚</p><p>ç©ºé—´å¤æ‚åº¦ï¼šO(N)ã€‚å“ˆå¸Œè¡¨çš„å¤§å°ä¸º O(N)ï¼Œè€Œå †çš„å¤§å°ä¸º O(k)ï¼Œå…±è®¡ä¸º O(N)ã€‚</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> ç®—æ³• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å•è°ƒé˜Ÿåˆ— </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€ç®—æ³•ã€‘åŠ›æ‰£239ï¼ˆæ»‘åŠ¨çª—å£æœ€å¤§å€¼ï¼‰</title>
      <link href="/post/18.html"/>
      <url>/post/18.html</url>
      
        <content type="html"><![CDATA[<h1 id="é¢˜ç›®æè¿°"><a href="#é¢˜ç›®æè¿°" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h1><p>ç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ numsï¼Œæœ‰ä¸€ä¸ªå¤§å°ä¸º k çš„æ»‘åŠ¨çª—å£ä»æ•°ç»„çš„æœ€å·¦ä¾§ç§»åŠ¨åˆ°æ•°ç»„çš„æœ€å³ä¾§ã€‚ä½ åªå¯ä»¥çœ‹åˆ°åœ¨æ»‘åŠ¨çª—å£å†…çš„ k ä¸ªæ•°å­—ã€‚æ»‘åŠ¨çª—å£æ¯æ¬¡åªå‘å³ç§»åŠ¨ä¸€ä½ã€‚è¿”å›æ»‘åŠ¨çª—å£ä¸­çš„æœ€å¤§å€¼ ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥ï¼šnums = [1,3,-1,-3,5,3,6,7], k = 3</span><br><span class="line">è¾“å‡ºï¼š[3,3,5,5,6,7]</span><br><span class="line">è§£é‡Šï¼š</span><br><span class="line">æ»‘åŠ¨çª—å£çš„ä½ç½®                æœ€å¤§å€¼</span><br><span class="line">---------------               -----</span><br><span class="line">[1  3  -1] -3  5  3  6  7       3</span><br><span class="line"> 1 [3  -1  -3] 5  3  6  7       3</span><br><span class="line"> 1  3 [-1  -3  5] 3  6  7       5</span><br><span class="line"> 1  3  -1 [-3  5  3] 6  7       5</span><br><span class="line"> 1  3  -1  -3 [5  3  6] 7       6</span><br><span class="line"> 1  3  -1  -3  5 [3  6  7]      7</span><br></pre></td></tr></table></figure><h1 id="è§£ç­”"><a href="#è§£ç­”" class="headerlink" title="è§£ç­”"></a>è§£ç­”</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span>[] maxSlidingWindow(<span class="type">int</span>[] nums, <span class="type">int</span> k) &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> nums.length; <span class="comment">// åŸæ•°ç»„çš„é•¿åº¦</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">m</span> <span class="operator">=</span> n - k + <span class="number">1</span>; <span class="comment">// ç»“æœæ•°ç»„çš„é•¿åº¦</span></span><br><span class="line">        <span class="keyword">if</span> (m &lt;= <span class="number">0</span>) <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">int</span>[<span class="number">0</span>];</span><br><span class="line">        <span class="type">int</span>[] res = <span class="keyword">new</span> <span class="title class_">int</span>[m];</span><br><span class="line">        Deque&lt;Integer&gt; q = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();<span class="comment">//å•è°ƒé€’å‡é˜Ÿåˆ—</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// =================åˆå§‹åŒ–å•è°ƒé€’å‡é˜Ÿåˆ—ï¼šå…ˆå°†å‰kçš„å…ƒç´ æ”¾å…¥é˜Ÿåˆ—===============</span></span><br><span class="line">        q.offerLast(nums[<span class="number">0</span>]); <span class="comment">// å…¥é˜Ÿ</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; k; i++) &#123;</span><br><span class="line">            <span class="keyword">while</span> (!q.isEmpty() &amp;&amp; nums[i] &gt; q.peekLast()) &#123; <span class="comment">// å¦‚æœæƒ³è¦å…¥é˜Ÿçš„å…ƒç´ æ¯”é˜Ÿå°¾å…ƒç´ è¿˜è¦å¤§</span></span><br><span class="line">                q.pollLast(); <span class="comment">// é‚£ä¹ˆå°±è®©é˜Ÿå°¾å…ƒç´ å‡ºé˜Ÿ</span></span><br><span class="line">            &#125;</span><br><span class="line">            q.offerLast(nums[i]); <span class="comment">// æ­¤æ—¶å¯ä»¥å…¥é˜Ÿäº†</span></span><br><span class="line">        &#125;</span><br><span class="line">        res[<span class="number">0</span>] = q.peekFirst(); <span class="comment">// é˜Ÿé¦–å…ƒç´ ä¸€å®šæ˜¯æœ€å¤§å€¼</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// =================å¼€å§‹éå†æ•°ç»„===============</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> k; i &lt; n; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (nums[i-k] == q.peekFirst()) &#123; <span class="comment">// å¦‚æœä¸Šä¸€ä¸ªçª—å£çš„ç¬¬ä¸€ä¸ªå…ƒç´ ä¸é˜Ÿé¦–å…ƒç´ ç›¸åŒ</span></span><br><span class="line">                q.pollFirst(); <span class="comment">// é‚£ä¹ˆå°±è®©ä»–å‡ºé˜Ÿ</span></span><br><span class="line">            &#125; <span class="comment">// å¦åˆ™ä»€ä¹ˆä¹Ÿä¸åšï¼Œå› ä¸ºä¸Šä¸ªçª—å£çš„ç¬¬ä¸€ä¸ªå…ƒç´ ä¸æ˜¯æœ€å¤§å€¼çš„è¯ï¼Œé‚£ä¹ˆè‚¯å®šå·²ç»ä¸å†é˜Ÿåˆ—ä¸­äº†ã€‚</span></span><br><span class="line">            <span class="keyword">while</span> (!q.isEmpty() &amp;&amp; nums[i] &gt; q.peekLast()) &#123; <span class="comment">// å¦‚æœæƒ³è¦å…¥é˜Ÿçš„å…ƒç´ æ¯”é˜Ÿå°¾å…ƒç´ è¿˜è¦å¤§</span></span><br><span class="line">                q.pollLast(); <span class="comment">// é‚£ä¹ˆå°±è®©é˜Ÿå°¾å…ƒç´ å‡ºé˜Ÿ</span></span><br><span class="line">            &#125;</span><br><span class="line">            q.offerLast(nums[i]); <span class="comment">// æ­¤æ—¶å¯ä»¥å…¥é˜Ÿäº†</span></span><br><span class="line">            res[i - k + <span class="number">1</span>] = q.peekFirst(); <span class="comment">// é˜Ÿé¦–å…ƒç´ ä¸€å®šæ˜¯æœ€å¤§å€¼</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>ä»¥ä¸Šæ˜¯æˆ‘è‡ªå·±å†™çš„ï¼Œçœ‹äº†å®˜æ–¹é¢˜è§£çš„ä»£ç åï¼Œå‘ç°å’Œæˆ‘å†™çš„å·®ä¸å¤š<code>^_^</code></p><p>å¦‚æœç”¨æš´åŠ›æ¥è§£ç­”ï¼Œæ—¶é—´å¤æ‚åº¦æ˜¯O(n*k)ï¼Œä¼šè¶…æ—¶çš„ã€‚</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> ç®—æ³• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å•è°ƒé˜Ÿåˆ— </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€ç®—æ³•ã€‘åŠ›æ‰£142ï¼ˆç¯å½¢é“¾è¡¨IIï¼‰</title>
      <link href="/post/17.html"/>
      <url>/post/17.html</url>
      
        <content type="html"><![CDATA[<h1 id="é¢˜ç›®æè¿°"><a href="#é¢˜ç›®æè¿°" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h1><p><a href="https://leetcode.cn/problems/3sum">https://leetcode.cn/problems/3sum</a></p><p>ç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ nums ï¼Œåˆ¤æ–­æ˜¯å¦å­˜åœ¨ä¸‰å…ƒç»„ [nums[i], nums[j], nums[k]] æ»¡è¶³ i != jã€i != k ä¸” j != k ï¼ŒåŒæ—¶è¿˜æ»¡è¶³ nums[i] + nums[j] + nums[k] == 0 ã€‚è¯·</p><p>ä½ è¿”å›æ‰€æœ‰å’Œä¸º 0 ä¸”ä¸é‡å¤çš„ä¸‰å…ƒç»„ã€‚</p><p>æ³¨æ„ï¼šç­”æ¡ˆä¸­ä¸å¯ä»¥åŒ…å«é‡å¤çš„ä¸‰å…ƒç»„ã€‚</p><blockquote><p>ç¤ºä¾‹ 1ï¼š<br>è¾“å…¥ï¼šnums = [-1,0,1,2,-1,-4]<br>è¾“å‡ºï¼š[[-1,-1,2],[-1,0,1]]<br>è§£é‡Šï¼š<br>nums[0] + nums[1] + nums[2] = (-1) + 0 + 1 = 0 ã€‚<br>nums[1] + nums[2] + nums[4] = 0 + 1 + (-1) = 0 ã€‚<br>nums[0] + nums[3] + nums[4] = (-1) + 2 + (-1) = 0 ã€‚<br>ä¸åŒçš„ä¸‰å…ƒç»„æ˜¯ [-1,0,1] å’Œ [-1,-1,2] ã€‚<br>æ³¨æ„ï¼Œè¾“å‡ºçš„é¡ºåºå’Œä¸‰å…ƒç»„çš„é¡ºåºå¹¶ä¸é‡è¦ã€‚</p><p>ç¤ºä¾‹ 2ï¼š<br>è¾“å…¥ï¼šnums = [0,1,1]<br>è¾“å‡ºï¼š[]<br>è§£é‡Šï¼šå”¯ä¸€å¯èƒ½çš„ä¸‰å…ƒç»„å’Œä¸ä¸º 0 ã€‚</p><p>ç¤ºä¾‹ 3ï¼š<br>è¾“å…¥ï¼šnums = [0,0,0]<br>è¾“å‡ºï¼š[[0,0,0]]<br>è§£é‡Šï¼šå”¯ä¸€å¯èƒ½çš„ä¸‰å…ƒç»„å’Œä¸º 0 ã€‚</p></blockquote><h1 id="åŒæŒ‡é’ˆè§£æ³•"><a href="#åŒæŒ‡é’ˆè§£æ³•" class="headerlink" title="åŒæŒ‡é’ˆè§£æ³•"></a>åŒæŒ‡é’ˆè§£æ³•</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> List&lt;List&lt;Integer&gt;&gt; <span class="title function_">threeSum</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">        List&lt;List&lt;Integer&gt;&gt; res = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> nums.length;</span><br><span class="line">        Arrays.sort(nums);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n-<span class="number">2</span>; i++) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// å› ä¸ºnumså·²ç»æœ‰åºï¼Œå¦‚æœé¦–ä¸ªå…ƒç´ å·²ç»å¤§äº0ï¼Œç›´æ¥é€€å‡ºå¾ªç¯</span></span><br><span class="line">            <span class="keyword">if</span> (nums[i] &gt; <span class="number">0</span>) <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// å»é‡1</span></span><br><span class="line">            <span class="keyword">if</span> (i &gt; <span class="number">0</span> &amp;&amp; nums[i] == nums[i-<span class="number">1</span>]) <span class="keyword">continue</span>;</span><br><span class="line">            <span class="type">int</span> <span class="variable">targer</span> <span class="operator">=</span> -nums[i]; <span class="comment">// ä¸¤æ•°ä¹‹å’Œçš„ç›®æ ‡å€¼</span></span><br><span class="line">            <span class="type">int</span> <span class="variable">low</span> <span class="operator">=</span> i + <span class="number">1</span>, high = n - <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">while</span> (low &lt; high) &#123;</span><br><span class="line">                <span class="type">int</span> <span class="variable">sum</span> <span class="operator">=</span> nums[low] + nums[high]; </span><br><span class="line">                <span class="keyword">if</span> (sum &gt; targer) &#123;</span><br><span class="line">                    high--;</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (sum &lt; targer) &#123;</span><br><span class="line">                    low++;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    res.add(Arrays.asList(nums[i], nums[low], nums[high]));</span><br><span class="line">                    low ++;</span><br><span class="line">                    high --;</span><br><span class="line">                    <span class="comment">// å»é‡2</span></span><br><span class="line">                    <span class="keyword">while</span> (low &lt; high &amp;&amp; nums[low] == nums[low-<span class="number">1</span>]) low++;</span><br><span class="line">                    <span class="comment">// å»é‡3</span></span><br><span class="line">                    <span class="keyword">while</span> (low &lt; high &amp;&amp; nums[high] == nums[high+<span class="number">1</span>]) high--;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>å»é‡1ï¼š</p><p>â€‹    å¦‚æœè¾“å…¥æ˜¯[-1,0,1,2,-1,-4]ï¼Œæ’åºå[-4,-1,-1,0,1,2]ï¼Œå½“å¤–å±‚å¾ªç¯éå†åˆ°ç¬¬ä¸€ä¸ª-1æ—¶ï¼Œæ‰¾åˆ°ç¬¦åˆæ¡ä»¶çš„ä¸‰å…ƒç»„[-1,0,1]</p><p>å¦‚æœéå†åˆ°ç¬¬äºŒä¸ª-1æ—¶ï¼Œä¸æ‰§è¡Œè·³è¿‡è¯­å¥ï¼Œå°±ä¼šè¾“å‡ºé‡å¤ä¸‰å…ƒç»„[-1,0,1]</p><p>å»é‡2å’Œå»é‡3ï¼š</p><p>â€‹    å¦‚æœè¾“å…¥çš„æ˜¯[-2,0,0,2,2]ï¼Œå½“å¤–å±‚æ‰§è¡Œåˆ°-2ï¼Œé‡Œå±‚çš„low=1ï¼Œhigh=4ï¼Œæ­¤æ—¶ä¸‰å…ƒç»„[-2,0,2]ç¬¦åˆæ¡ä»¶ã€‚</p><p>æ­¤æ—¶low=2ï¼Œhigh=3ã€‚å¦‚æœæ²¡æœ‰å»é‡2å’Œå»é‡3ï¼Œé‚£ä¹ˆæ­¤æ—¶çš„lowå’Œhighåˆç¬¦åˆæ¡ä»¶ï¼Œä¸‰å…ƒç»„[-2,0,2]ä¼šè¢«é‡å¤è¾“å‡ºã€‚</p></blockquote><h1 id="å¤æ‚åº¦åˆ†æ"><a href="#å¤æ‚åº¦åˆ†æ" class="headerlink" title="å¤æ‚åº¦åˆ†æ"></a>å¤æ‚åº¦åˆ†æ</h1><p>æ—¶é—´å¤æ‚åº¦ï¼šO(nÂ²)</p><p>ç©ºé—´å¤æ‚åº¦ï¼šO(1)</p>]]></content>
      
      
      <categories>
          
          <category> ç®—æ³• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> åŒæŒ‡é’ˆ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>rediså“¨å…µé›†ç¾¤</title>
      <link href="/post/15.html"/>
      <url>/post/15.html</url>
      
        <content type="html"><![CDATA[<p>ä¸Šä¸€èŠ‚è®²åˆ°äº†redisçš„ä¸»ä»é›†ç¾¤ï¼Œé‚£ä¹ˆæ€è€ƒä¸€ä¸ªé—®é¢˜ï¼šslaveèŠ‚ç‚¹å®•æœºæ¢å¤åå¯ä»¥æ‰¾masterèŠ‚ç‚¹åŒæ­¥æ•°æ®ï¼Œé‚£masterèŠ‚ç‚¹å®•æœºæ€ä¹ˆåŠï¼Ÿ</p><h1 id="1-é›†ç¾¤ç»“æ„å’Œä½œç”¨"><a href="#1-é›†ç¾¤ç»“æ„å’Œä½œç”¨" class="headerlink" title="1.é›†ç¾¤ç»“æ„å’Œä½œç”¨"></a>1.é›†ç¾¤ç»“æ„å’Œä½œç”¨</h1><p>å“¨å…µçš„ç»“æ„å¦‚å›¾ï¼š</p><p><img src="http://cdn.leesin.fun/typora/s3/img/image-20210725154528072.png" alt="image-20210725154528072"></p><p>å“¨å…µçš„ä½œç”¨å¦‚ä¸‹ï¼š</p><ul><li><strong>ç›‘æ§</strong>ï¼šSentinel ä¼šä¸æ–­æ£€æŸ¥æ‚¨çš„masterå’Œslaveæ˜¯å¦æŒ‰é¢„æœŸå·¥ä½œ</li><li><strong>è‡ªåŠ¨æ•…éšœæ¢å¤</strong>ï¼šå¦‚æœmasteræ•…éšœï¼ŒSentinelä¼šå°†ä¸€ä¸ªslaveæå‡ä¸ºmasterã€‚å½“æ•…éšœå®ä¾‹æ¢å¤åä¹Ÿä»¥æ–°çš„masterä¸ºä¸»</li><li><strong>é€šçŸ¥</strong>ï¼šSentinelå……å½“Rediså®¢æˆ·ç«¯çš„æœåŠ¡å‘ç°æ¥æºï¼Œå½“é›†ç¾¤å‘ç”Ÿæ•…éšœè½¬ç§»æ—¶ï¼Œä¼šå°†æœ€æ–°ä¿¡æ¯æ¨é€ç»™Redisçš„å®¢æˆ·ç«¯</li></ul><h1 id="2-é›†ç¾¤ç›‘æ§åŸç†"><a href="#2-é›†ç¾¤ç›‘æ§åŸç†" class="headerlink" title="2.é›†ç¾¤ç›‘æ§åŸç†"></a>2.é›†ç¾¤ç›‘æ§åŸç†</h1><p>SentinelåŸºäºå¿ƒè·³æœºåˆ¶ç›‘æµ‹æœåŠ¡çŠ¶æ€ï¼Œæ¯éš”1ç§’å‘é›†ç¾¤çš„æ¯ä¸ªå®ä¾‹å‘é€pingå‘½ä»¤ï¼š</p><ul><li><p>ä¸»è§‚ä¸‹çº¿ï¼šå¦‚æœæŸsentinelèŠ‚ç‚¹å‘ç°æŸå®ä¾‹æœªåœ¨è§„å®šæ—¶é—´å“åº”ï¼Œåˆ™è®¤ä¸ºè¯¥å®ä¾‹<strong>ä¸»è§‚ä¸‹çº¿</strong>ã€‚</p></li><li><p>å®¢è§‚ä¸‹çº¿ï¼šè‹¥è¶…è¿‡æŒ‡å®šæ•°é‡ï¼ˆquorumï¼‰çš„sentineléƒ½è®¤ä¸ºè¯¥å®ä¾‹ä¸»è§‚ä¸‹çº¿ï¼Œåˆ™è¯¥å®ä¾‹<strong>å®¢è§‚ä¸‹çº¿</strong>ã€‚quorumå€¼æœ€å¥½è¶…è¿‡Sentinelå®ä¾‹æ•°é‡çš„ä¸€åŠã€‚</p></li></ul><p><img src="http://cdn.leesin.fun/typora/s3/img/image-20210725154632354.png" alt="image-20210725154632354"></p><h1 id="3-é›†ç¾¤æ•…éšœæ¢å¤åŸç†"><a href="#3-é›†ç¾¤æ•…éšœæ¢å¤åŸç†" class="headerlink" title="3.é›†ç¾¤æ•…éšœæ¢å¤åŸç†"></a>3.é›†ç¾¤æ•…éšœæ¢å¤åŸç†</h1><p>ä¸€æ—¦å‘ç°masteræ•…éšœï¼Œsentineléœ€è¦åœ¨salveä¸­é€‰æ‹©ä¸€ä¸ªä½œä¸ºæ–°çš„masterï¼Œé€‰æ‹©ä¾æ®æ˜¯è¿™æ ·çš„ï¼š</p><ul><li>é¦–å…ˆä¼šåˆ¤æ–­slaveèŠ‚ç‚¹ä¸masterèŠ‚ç‚¹æ–­å¼€æ—¶é—´é•¿çŸ­ï¼Œå¦‚æœè¶…è¿‡æŒ‡å®šå€¼ï¼ˆdown-after-milliseconds * 10ï¼‰åˆ™ä¼šæ’é™¤è¯¥slaveèŠ‚ç‚¹</li><li>ç„¶ååˆ¤æ–­slaveèŠ‚ç‚¹çš„slave-priorityå€¼ï¼Œè¶Šå°ä¼˜å…ˆçº§è¶Šé«˜ï¼Œå¦‚æœæ˜¯0åˆ™æ°¸ä¸å‚ä¸é€‰ä¸¾</li><li>å¦‚æœslave-prorityä¸€æ ·ï¼Œåˆ™åˆ¤æ–­slaveèŠ‚ç‚¹çš„offsetå€¼ï¼Œè¶Šå¤§è¯´æ˜æ•°æ®è¶Šæ–°ï¼Œä¼˜å…ˆçº§è¶Šé«˜</li><li>æœ€åæ˜¯åˆ¤æ–­slaveèŠ‚ç‚¹çš„è¿è¡Œidå¤§å°ï¼Œè¶Šå°ä¼˜å…ˆçº§è¶Šé«˜ã€‚</li></ul><p>å½“é€‰å‡ºä¸€ä¸ªæ–°çš„masteråï¼Œè¯¥å¦‚ä½•å®ç°åˆ‡æ¢å‘¢ï¼Ÿ</p><p>æµç¨‹å¦‚ä¸‹ï¼š</p><ul><li>sentinelç»™å¤‡é€‰çš„slave1èŠ‚ç‚¹å‘é€ <code>slaveof no one</code> å‘½ä»¤ï¼Œè®©è¯¥èŠ‚ç‚¹æˆä¸ºmaster</li><li>sentinelç»™æ‰€æœ‰å…¶å®ƒslaveå‘é€ <code>slaveof 192.168.10.101 7002</code>  å‘½ä»¤ï¼Œè®©è¿™äº›slaveæˆä¸ºæ–°masterçš„ä»èŠ‚ç‚¹ï¼Œå¼€å§‹ä»æ–°çš„masterä¸ŠåŒæ­¥æ•°æ®ã€‚</li><li>æœ€åï¼Œsentinelå°†æ•…éšœèŠ‚ç‚¹æ ‡è®°ä¸ºslaveï¼Œå½“æ•…éšœèŠ‚ç‚¹æ¢å¤åä¼šè‡ªåŠ¨æˆä¸ºæ–°çš„masterçš„slaveèŠ‚ç‚¹</li></ul><p><img src="http://cdn.leesin.fun/typora/s3/img/image-20210725154816841.png" alt="image-20210725154816841"></p><h1 id="4-å°ç»“"><a href="#4-å°ç»“" class="headerlink" title="4.å°ç»“"></a>4.å°ç»“</h1><p>Sentinelçš„ä¸‰ä¸ªä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ</p><ul><li>ç›‘æ§</li><li>æ•…éšœè½¬ç§»</li><li>é€šçŸ¥</li></ul><p>Sentinelå¦‚ä½•åˆ¤æ–­ä¸€ä¸ªrediså®ä¾‹æ˜¯å¦å¥åº·ï¼Ÿ</p><ul><li>æ¯éš”1ç§’å‘é€ä¸€æ¬¡pingå‘½ä»¤ï¼Œå¦‚æœè¶…è¿‡ä¸€å®šæ—¶é—´æ²¡æœ‰ç›¸å‘åˆ™è®¤ä¸ºæ˜¯ä¸»è§‚ä¸‹çº¿</li><li>å¦‚æœå¤§å¤šæ•°sentineléƒ½è®¤ä¸ºå®ä¾‹ä¸»è§‚ä¸‹çº¿ï¼Œåˆ™åˆ¤å®šæœåŠ¡ä¸‹çº¿</li></ul><p>æ•…éšœè½¬ç§»æ­¥éª¤æœ‰å“ªäº›ï¼Ÿ</p><ul><li>é¦–å…ˆé€‰å®šä¸€ä¸ªslaveä½œä¸ºæ–°çš„masterï¼Œæ‰§è¡Œslaveof no one</li><li>ç„¶åè®©æ‰€æœ‰èŠ‚ç‚¹éƒ½æ‰§è¡Œslaveof æ–°master</li><li>ä¿®æ”¹æ•…éšœèŠ‚ç‚¹é…ç½®ï¼Œæ·»åŠ slaveof æ–°master</li></ul><h1 id="5-å“¨å…µé›†ç¾¤æ­å»º"><a href="#5-å“¨å…µé›†ç¾¤æ­å»º" class="headerlink" title="5.å“¨å…µé›†ç¾¤æ­å»º"></a>5.å“¨å…µé›†ç¾¤æ­å»º</h1><h2 id="5-1-é›†ç¾¤ç»“æ„"><a href="#5-1-é›†ç¾¤ç»“æ„" class="headerlink" title="5.1.é›†ç¾¤ç»“æ„"></a>5.1.é›†ç¾¤ç»“æ„</h2><p>è¿™é‡Œæˆ‘ä»¬æ­å»ºä¸€ä¸ªä¸‰èŠ‚ç‚¹å½¢æˆçš„Sentinelé›†ç¾¤ï¼Œæ¥ç›‘ç®¡ä¹‹å‰çš„Redisä¸»ä»é›†ç¾¤ã€‚å¦‚å›¾ï¼š<br><img src="http://cdn.leesin.fun/typora/s3/img/image-20210725154528072.png" alt="image-20210725154528072"></p><p>ä¸‰ä¸ªsentinelå®ä¾‹ä¿¡æ¯å¦‚ä¸‹ï¼š</p><div class="table-container"><table><thead><tr><th style="text-align:center">èŠ‚ç‚¹</th><th style="text-align:center">IP</th><th style="text-align:center">PORT</th></tr></thead><tbody><tr><td style="text-align:center">s1</td><td style="text-align:center">itachi101</td><td style="text-align:center">27001</td></tr><tr><td style="text-align:center">s2</td><td style="text-align:center">itachi101</td><td style="text-align:center">27002</td></tr><tr><td style="text-align:center">s3</td><td style="text-align:center">itachi101</td><td style="text-align:center">27003</td></tr></tbody></table></div><h2 id="5-2-ä¿®æ”¹masteré…ç½®ï¼Œå¹¶å¯åŠ¨ä¸»ä»å¤åˆ¶é›†ç¾¤"><a href="#5-2-ä¿®æ”¹masteré…ç½®ï¼Œå¹¶å¯åŠ¨ä¸»ä»å¤åˆ¶é›†ç¾¤" class="headerlink" title="5.2.ä¿®æ”¹masteré…ç½®ï¼Œå¹¶å¯åŠ¨ä¸»ä»å¤åˆ¶é›†ç¾¤"></a>5.2.ä¿®æ”¹masteré…ç½®ï¼Œå¹¶å¯åŠ¨ä¸»ä»å¤åˆ¶é›†ç¾¤</h2><p>å› ä¸ºæˆ‘ä»¬ä¹‹å‰çš„ä¸»ä»é›†ç¾¤ä¸­ï¼ŒmasterèŠ‚ç‚¹æ˜¯æ²¡è®¾ç½®å…¶ä»–slaveèŠ‚ç‚¹çš„å¯†ç çš„ã€‚ä½†æ˜¯å“¨å…µé›†ç¾¤ä¸­ï¼Œmasterå¯èƒ½å˜æˆslaveï¼Œæ­¤æ—¶å¦‚æœä»–æ²¡æœ‰å…¶ä»–èŠ‚ç‚¹çš„å¯†ç çš„è¯ï¼Œå°±ä¼šæ— æ³•å»æ–°çš„masterèŠ‚ç‚¹åŒæ­¥æ•°æ®ã€‚æ‰€ä»¥æˆ‘ä»¬åœ¨ <code>redis.conf</code> ä¸­ç»™masteré…ç½®å…¶ä»–èŠ‚ç‚¹çš„å¯†ç ã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">masterauth yourpassword</span><br></pre></td></tr></table></figure><p>ç„¶åå¯åŠ¨ä¸»ä»é›†ç¾¤ï¼Œæµ‹è¯•</p><h2 id="5-3-å‡†å¤‡å®ä¾‹å’Œé…ç½®"><a href="#5-3-å‡†å¤‡å®ä¾‹å’Œé…ç½®" class="headerlink" title="5.3.å‡†å¤‡å®ä¾‹å’Œé…ç½®"></a>5.3.å‡†å¤‡å®ä¾‹å’Œé…ç½®</h2><p>è¦åœ¨åŒä¸€å°è™šæ‹Ÿæœºå¼€å¯3ä¸ªå®ä¾‹ï¼Œå¿…é¡»å‡†å¤‡ä¸‰ä»½ä¸åŒçš„é…ç½®æ–‡ä»¶å’Œç›®å½•ï¼Œé…ç½®æ–‡ä»¶æ‰€åœ¨ç›®å½•ä¹Ÿå°±æ˜¯å·¥ä½œç›®å½•ã€‚</p><p>æˆ‘ä»¬åˆ›å»ºä¸‰ä¸ªæ–‡ä»¶å¤¹ï¼Œåå­—åˆ†åˆ«å«s1ã€s2ã€s3ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è¿›å…¥/tmpç›®å½•</span></span><br><span class="line"><span class="built_in">cd</span> /tmp</span><br><span class="line"><span class="comment"># åˆ›å»ºç›®å½•</span></span><br><span class="line"><span class="built_in">mkdir</span> s1 s2 s3</span><br></pre></td></tr></table></figure><p>ç„¶åæˆ‘ä»¬åœ¨s1ç›®å½•åˆ›å»ºä¸€ä¸ªsentinel.confæ–‡ä»¶ï¼Œæ·»åŠ ä¸‹é¢çš„å†…å®¹ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">port 27001</span><br><span class="line">sentinel announce-ip 192.168.10.101</span><br><span class="line">sentinel monitor mymaster 192.168.10.101 7001 2</span><br><span class="line">sentinel down-after-milliseconds mymaster 5000</span><br><span class="line">sentinel failover-timeout mymaster 60000</span><br><span class="line">sentinel auth-pass mymaster y</span><br><span class="line"><span class="built_in">dir</span> <span class="string">&quot;/tmp/s1&quot;</span></span><br></pre></td></tr></table></figure><p>è§£è¯»ï¼š</p><ul><li><code>port 27001</code>ï¼šæ˜¯å½“å‰sentinelå®ä¾‹çš„ç«¯å£</li><li><code>sentinel monitor mymaster 192.168.10.101 7001 2</code>ï¼šæŒ‡å®šä¸»èŠ‚ç‚¹ä¿¡æ¯<ul><li><code>mymaster</code>ï¼šä¸»èŠ‚ç‚¹åç§°ï¼Œè‡ªå®šä¹‰ï¼Œä»»æ„å†™</li><li><code>192.168.10.101 7001</code>ï¼šä¸»èŠ‚ç‚¹çš„ipå’Œç«¯å£</li><li><code>2</code>ï¼šé€‰ä¸¾masteræ—¶çš„quorumå€¼</li></ul></li></ul><p>ç„¶åå°†s1/sentinel.confæ–‡ä»¶æ‹·è´åˆ°s2ã€s3ä¸¤ä¸ªç›®å½•ä¸­ï¼ˆåœ¨/tmpç›®å½•æ‰§è¡Œä¸‹åˆ—å‘½ä»¤ï¼‰ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ–¹å¼ä¸€ï¼šé€ä¸ªæ‹·è´</span></span><br><span class="line"><span class="built_in">cp</span> s1/sentinel.conf s2</span><br><span class="line"><span class="built_in">cp</span> s1/sentinel.conf s3</span><br><span class="line"><span class="comment"># æ–¹å¼äºŒï¼šç®¡é“ç»„åˆå‘½ä»¤ï¼Œä¸€é”®æ‹·è´</span></span><br><span class="line"><span class="built_in">echo</span> s2 s3 | xargs -t -n 1 <span class="built_in">cp</span> s1/sentinel.conf</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹s2ã€s3ä¸¤ä¸ªæ–‡ä»¶å¤¹å†…çš„é…ç½®æ–‡ä»¶ï¼Œå°†ç«¯å£åˆ†åˆ«ä¿®æ”¹ä¸º27002ã€27003ï¼Œå·¥ä½œç›®å½•ä¿®æ”¹ä¸º/tmp/s2ï¼Œ/tmp/s1</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">vim s2/sentinel.conf</span><br><span class="line">port 27002</span><br><span class="line"><span class="built_in">dir</span> <span class="string">&quot;/tmp/s2&quot;</span></span><br><span class="line"></span><br><span class="line">vim s3/sentinel.conf</span><br><span class="line">port 27003</span><br><span class="line"><span class="built_in">dir</span> <span class="string">&quot;/tmp/s3&quot;</span></span><br></pre></td></tr></table></figure><h2 id="5-4-å¯åŠ¨"><a href="#5-4-å¯åŠ¨" class="headerlink" title="5.4.å¯åŠ¨"></a>5.4.å¯åŠ¨</h2><p>ä¸ºäº†æ–¹ä¾¿æŸ¥çœ‹æ—¥å¿—ï¼Œæˆ‘ä»¬æ‰“å¼€3ä¸ªsshçª—å£ï¼Œåˆ†åˆ«å¯åŠ¨3ä¸ªrediså®ä¾‹ï¼Œå¯åŠ¨å‘½ä»¤ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç¬¬1ä¸ª</span></span><br><span class="line">redis-sentinel s1/sentinel.conf</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¬¬2ä¸ª</span></span><br><span class="line">redis-sentinel s2/sentinel.conf</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¬¬3ä¸ª</span></span><br><span class="line">redis-sentinel s3/sentinel.conf</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="5-5-æµ‹è¯•"><a href="#5-5-æµ‹è¯•" class="headerlink" title="5.5.æµ‹è¯•"></a>5.5.æµ‹è¯•</h2><p>å°è¯•è®©masterèŠ‚ç‚¹7001å®•æœºï¼ŒæŸ¥çœ‹sentinelæ—¥å¿—ï¼š</p><p><img src="http://cdn.leesin.fun/typora/s3/img/image-20210701222857997.png" alt="image-20210701222857997"></p><p>æŸ¥çœ‹7003çš„æ—¥å¿—ï¼š</p><p><img src="http://cdn.leesin.fun/typora/s3/img/image-20210701223025709.png" alt="image-20210701223025709"></p><p>æŸ¥çœ‹7002çš„æ—¥å¿—ï¼š</p><p><img src="http://cdn.leesin.fun/typora/s3/img/image-20210701223131264.png" alt="image-20210701223131264"></p><p>ç„¶åå¯åŠ¨7001ï¼Œå¯ä»¥çœ‹åˆ°7001å˜æˆä»èŠ‚ç‚¹äº†</p>]]></content>
      
      
      <categories>
          
          <category> åç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> redis </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>redisä¸»ä»å¤åˆ¶</title>
      <link href="/post/14.html"/>
      <url>/post/14.html</url>
      
        <content type="html"><![CDATA[<h1 id="1-æ­å»ºä¸»ä»æ¶æ„"><a href="#1-æ­å»ºä¸»ä»æ¶æ„" class="headerlink" title="1.æ­å»ºä¸»ä»æ¶æ„"></a>1.æ­å»ºä¸»ä»æ¶æ„</h1><h2 id="1-1-é›†ç¾¤ç»“æ„"><a href="#1-1-é›†ç¾¤ç»“æ„" class="headerlink" title="1.1.é›†ç¾¤ç»“æ„"></a>1.1.é›†ç¾¤ç»“æ„</h2><p>å•èŠ‚ç‚¹Redisçš„å¹¶å‘èƒ½åŠ›æ˜¯æœ‰ä¸Šé™çš„ï¼Œè¦è¿›ä¸€æ­¥æé«˜Redisçš„å¹¶å‘èƒ½åŠ›ï¼Œå°±éœ€è¦æ­å»ºä¸»ä»é›†ç¾¤ï¼Œå®ç°è¯»å†™åˆ†ç¦»ã€‚</p><p><img src="http://cdn.leesin.fun/typora/s3/img/image-20230330193053327.png" alt="image-20230330193053327"></p><p>å…±åŒ…å«ä¸‰ä¸ªèŠ‚ç‚¹ï¼Œä¸€ä¸ªä¸»èŠ‚ç‚¹ï¼Œä¸¤ä¸ªä»èŠ‚ç‚¹ã€‚</p><p>è¿™é‡Œæˆ‘ä»¬ä¼šåœ¨åŒä¸€å°è™šæ‹Ÿæœºä¸­å¼€å¯3ä¸ªrediså®ä¾‹ï¼Œæ¨¡æ‹Ÿä¸»ä»é›†ç¾¤ï¼Œä¿¡æ¯å¦‚ä¸‹ï¼š</p><div class="table-container"><table><thead><tr><th style="text-align:center">IP</th><th style="text-align:center">PORT</th><th style="text-align:center">è§’è‰²</th></tr></thead><tbody><tr><td style="text-align:center">192.168.10.101</td><td style="text-align:center">7001</td><td style="text-align:center">master</td></tr><tr><td style="text-align:center">192.168.10.101</td><td style="text-align:center">7002</td><td style="text-align:center">slave</td></tr><tr><td style="text-align:center">192.168.10.101</td><td style="text-align:center">7003</td><td style="text-align:center">slave</td></tr></tbody></table></div><h2 id="1-2-å‡†å¤‡å®ä¾‹å’Œé…ç½®"><a href="#1-2-å‡†å¤‡å®ä¾‹å’Œé…ç½®" class="headerlink" title="1.2.å‡†å¤‡å®ä¾‹å’Œé…ç½®"></a>1.2.å‡†å¤‡å®ä¾‹å’Œé…ç½®</h2><p>è¦åœ¨åŒä¸€å°è™šæ‹Ÿæœºå¼€å¯3ä¸ªå®ä¾‹ï¼Œå¿…é¡»å‡†å¤‡ä¸‰ä»½ä¸åŒçš„é…ç½®æ–‡ä»¶å’Œç›®å½•ï¼Œé…ç½®æ–‡ä»¶æ‰€åœ¨ç›®å½•ä¹Ÿå°±æ˜¯å·¥ä½œç›®å½•ã€‚</p><p>1ï¼‰åˆ›å»ºç›®å½•</p><p>æˆ‘ä»¬åˆ›å»ºä¸‰ä¸ªæ–‡ä»¶å¤¹ï¼Œåå­—åˆ†åˆ«å«7001ã€7002ã€7003ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è¿›å…¥/tmpç›®å½•</span></span><br><span class="line"><span class="built_in">cd</span> /tmp</span><br><span class="line"><span class="comment"># åˆ›å»ºç›®å½•</span></span><br><span class="line"><span class="built_in">mkdir</span> 7001 7002 7003</span><br></pre></td></tr></table></figure><p>2ï¼‰æŠŠ <code>redis.conf</code> æ¢å¤åŸå§‹é…ç½®</p><p>3ï¼‰æ‹·è´é…ç½®æ–‡ä»¶åˆ°æ¯ä¸ªå®ä¾‹ç›®å½•</p><p>ç„¶åå°†redis-6.2.4/redis.confæ–‡ä»¶æ‹·è´åˆ°ä¸‰ä¸ªç›®å½•ä¸­ï¼ˆåœ¨/tmpç›®å½•æ‰§è¡Œä¸‹åˆ—å‘½ä»¤ï¼‰ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cp</span> /usr/local/src/redis-6.2.6/redis.conf.bck 7001</span><br><span class="line"><span class="built_in">cp</span> /usr/local/src/redis-6.2.6/redis.conf.bck 7002</span><br><span class="line"><span class="built_in">cp</span> /usr/local/src/redis-6.2.6/redis.conf.bck 7003</span><br><span class="line"></span><br><span class="line"><span class="built_in">cp</span> /tmp/7001/redis.conf.bck /tmp/7001/redis.conf</span><br><span class="line"><span class="built_in">cp</span> /tmp/7002/redis.conf.bck /tmp/7002/redis.conf</span><br><span class="line"><span class="built_in">cp</span> /tmp/7003/redis.conf.bck /tmp/7003/redis.conf</span><br></pre></td></tr></table></figure><p>4ï¼‰ä¿®æ”¹ä¸‰ä¸ªé…ç½®æ–‡ä»¶çš„åŸºæœ¬é…ç½®</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å…è®¸è®¿é—®çš„åœ°å€ï¼Œé»˜è®¤æ˜¯127.0.0.1ï¼Œä¼šå¯¼è‡´åªèƒ½åœ¨æœ¬åœ°è®¿é—®ã€‚ä¿®æ”¹ä¸º0.0.0.0åˆ™å¯ä»¥åœ¨ä»»æ„IPè®¿é—®ï¼Œç”Ÿäº§ç¯å¢ƒä¸è¦è®¾ç½®ä¸º0.0.0.0</span></span><br><span class="line"><span class="built_in">bind</span> 0.0.0.0</span><br><span class="line"><span class="comment"># åˆ†åˆ«ä¿®æ”¹ç«¯å£ä¸º7001 7002 7003</span></span><br><span class="line">port 7001</span><br><span class="line"><span class="comment"># å®ˆæŠ¤è¿›ç¨‹ï¼Œä¿®æ”¹ä¸ºyesåå³å¯åå°è¿è¡Œ</span></span><br><span class="line">daemonize <span class="built_in">yes</span></span><br><span class="line"><span class="comment"># å¯†ç ï¼Œè®¾ç½®åè®¿é—®Rediså¿…é¡»è¾“å…¥å¯†ç </span></span><br><span class="line">requirepass yourpassword</span><br><span class="line"><span class="comment"># æ³¨æ„ï¼švimåº•è¡Œæ¨¡å¼ï¼Œè¾“å…¥/requirepasså›è½¦å³å¯æœç´¢ã€‚nä¸‹ä¸€ä¸ª</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å·¥ä½œç›®å½•ï¼Œä¸‰å°æœºå™¨æ•´ä¸ªæœ‰å·®å¼‚ï¼Œåˆ†åˆ«ä¸º7001 7002 7003æ–‡ä»¶å¤¹</span></span><br><span class="line"><span class="built_in">dir</span> /tmp/7001</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ—¥å¿—æ–‡ä»¶ï¼Œé»˜è®¤ä¸ºç©ºï¼Œä¸è®°å½•æ—¥å¿—ï¼Œå¯ä»¥æŒ‡å®šæ—¥å¿—æ–‡ä»¶å</span></span><br><span class="line"><span class="comment"># åˆ†åˆ«ä¸ºredis7001.log redis7002.log redis7003.log</span></span><br><span class="line">logfile <span class="string">&quot;redis7001.log&quot;</span></span><br></pre></td></tr></table></figure><p>5ï¼‰ä¿®æ”¹æ¯ä¸ªå®ä¾‹çš„å£°æ˜IP</p><p>è™šæ‹Ÿæœºæœ¬èº«æœ‰å¤šä¸ªIPï¼Œä¸ºäº†é¿å…å°†æ¥æ··ä¹±ï¼Œæˆ‘ä»¬éœ€è¦åœ¨redis.confæ–‡ä»¶ä¸­æŒ‡å®šæ¯ä¸€ä¸ªå®ä¾‹çš„ç»‘å®šipä¿¡æ¯ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># rediså®ä¾‹çš„å£°æ˜ IP</span></span><br><span class="line"><span class="attr">replica-announce-ip</span> <span class="string">192.168.10.101</span></span><br></pre></td></tr></table></figure><p>æ¯ä¸ªç›®å½•éƒ½è¦æ”¹ï¼Œæˆ‘ä»¬ä¸€é”®å®Œæˆä¿®æ”¹ï¼ˆåœ¨/tmpç›®å½•æ‰§è¡Œä¸‹åˆ—å‘½ä»¤ï¼‰ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é€ä¸€æ‰§è¡Œ</span></span><br><span class="line">sed -i <span class="string">&#x27;1a replica-announce-ip 192.168.10.101&#x27;</span> 7001/redis.conf</span><br><span class="line">sed -i <span class="string">&#x27;1a replica-announce-ip 192.168.10.101&#x27;</span> 7002/redis.conf</span><br><span class="line">sed -i <span class="string">&#x27;1a replica-announce-ip 192.168.10.101&#x27;</span> 7003/redis.conf</span><br><span class="line"></span><br><span class="line"><span class="comment"># æˆ–è€…ä¸€é”®ä¿®æ”¹</span></span><br><span class="line"><span class="built_in">printf</span> <span class="string">&#x27;%s\n&#x27;</span> 7001 7002 7003 | xargs -I&#123;&#125; -t sed -i <span class="string">&#x27;1a replica-announce-ip 192.168.10.101&#x27;</span> &#123;&#125;/redis.conf</span><br></pre></td></tr></table></figure><p>6ï¼‰é…ç½®ä¸»ä»å…³ç³»ï¼Œè¿™ä¸€æ­¥åªéœ€è¦ä¿®æ”¹7002å’Œ7003</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">vim 7002/redis.conf</span><br><span class="line"><span class="comment"># æŒ‡å®šä¸»èŠ‚ç‚¹æ˜¯è°</span></span><br><span class="line">slaveof 192.168.10.101 7001</span><br><span class="line"><span class="comment"># æŒ‡å®šä¸»èŠ‚ç‚¹çš„å¯†ç </span></span><br><span class="line">masterauth yourpassword</span><br><span class="line"></span><br><span class="line">vim 7003/redis.conf</span><br><span class="line"><span class="comment"># æŒ‡å®šä¸»èŠ‚ç‚¹æ˜¯è°</span></span><br><span class="line">slaveof 192.168.10.101 7001</span><br><span class="line"><span class="comment"># æŒ‡å®šä¸»èŠ‚ç‚¹çš„å¯†ç </span></span><br><span class="line">masterauth yourpassword</span><br></pre></td></tr></table></figure><h2 id="1-3-å¯åŠ¨"><a href="#1-3-å¯åŠ¨" class="headerlink" title="1.3.å¯åŠ¨"></a>1.3.å¯åŠ¨</h2><p>ä¸ºäº†æ–¹ä¾¿æŸ¥çœ‹æ—¥å¿—ï¼Œæˆ‘ä»¬æ‰“å¼€3ä¸ªsshçª—å£ï¼Œåˆ†åˆ«å¯åŠ¨3ä¸ªrediså®ä¾‹ï¼Œå¯åŠ¨å‘½ä»¤ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç¬¬1ä¸ª</span></span><br><span class="line">redis-server 7001/redis.conf</span><br><span class="line"><span class="built_in">tail</span> -f 7001/redis7001.<span class="built_in">log</span></span><br><span class="line"><span class="comment"># ç¬¬2ä¸ª</span></span><br><span class="line">redis-server 7002/redis.conf</span><br><span class="line"><span class="built_in">tail</span> -f 7002/redis7002.<span class="built_in">log</span></span><br><span class="line"><span class="comment"># ç¬¬3ä¸ª</span></span><br><span class="line">redis-server 7003/redis.conf</span><br><span class="line"><span class="built_in">tail</span> -f 7003/redis7003.<span class="built_in">log</span> </span><br></pre></td></tr></table></figure><p>åœæ­¢ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">redis-cli -p 7001 -a yourpassword shutdown </span><br><span class="line">redis-cli -p 7002 -a yourpassword shutdown </span><br><span class="line">redis-cli -p 7003 -a yourpassword shutdown</span><br></pre></td></tr></table></figure><h2 id="1-4-å¼€å¯ä¸»ä»å…³ç³»"><a href="#1-4-å¼€å¯ä¸»ä»å…³ç³»" class="headerlink" title="1.4.å¼€å¯ä¸»ä»å…³ç³»"></a>1.4.å¼€å¯ä¸»ä»å…³ç³»</h2><p>ç°åœ¨ä¸‰ä¸ªå®ä¾‹è¿˜æ²¡æœ‰ä»»ä½•å…³ç³»ï¼Œè¦é…ç½®ä¸»ä»å¯ä»¥ä½¿ç”¨replicaof æˆ–è€…slaveofï¼ˆ5.0ä»¥å‰ï¼‰å‘½ä»¤ã€‚</p><p>æœ‰ä¸´æ—¶å’Œæ°¸ä¹…ä¸¤ç§æ¨¡å¼ï¼š</p><ul><li><p>ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼ˆæ°¸ä¹…ç”Ÿæ•ˆï¼‰</p><ul><li>åœ¨redis.confä¸­æ·»åŠ ä¸€è¡Œé…ç½®ï¼š<code>slaveof &lt;masterip&gt; &lt;masterport&gt;</code></li></ul></li><li><p>ä½¿ç”¨redis-cliå®¢æˆ·ç«¯è¿æ¥åˆ°redisæœåŠ¡ï¼Œæ‰§è¡Œslaveofå‘½ä»¤ï¼ˆé‡å¯åå¤±æ•ˆï¼‰ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">slaveof &lt;masterip&gt; &lt;masterport&gt;</span><br></pre></td></tr></table></figure></li></ul><p>æˆ‘ä»¬è¿™é‡Œå·²ç»åœ¨å‰é¢ä½¿ç”¨äº†ç¬¬ä¸€ç§æ–¹å¼ã€‚</p><p><strong><font color="red">æ³¨æ„</font></strong>ï¼šåœ¨5.0ä»¥åæ–°å¢å‘½ä»¤replicaofï¼Œä¸salveofæ•ˆæœä¸€è‡´ã€‚</p><p>ç„¶åè¿æ¥ 7001èŠ‚ç‚¹ï¼ŒæŸ¥çœ‹é›†ç¾¤çŠ¶æ€ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è¿æ¥ 7001</span></span><br><span class="line">redis-cli -p 7001 -a yourpassw</span><br><span class="line"><span class="comment"># æŸ¥çœ‹çŠ¶æ€</span></span><br><span class="line">info replication</span><br></pre></td></tr></table></figure><p>ç»“æœï¼š</p><p><img src="http://cdn.leesin.fun/typora/s3/img/image-20230330193403117.png" alt="image-20230330193403117"></p><h2 id="1-5-æµ‹è¯•"><a href="#1-5-æµ‹è¯•" class="headerlink" title="1.5.æµ‹è¯•"></a>1.5.æµ‹è¯•</h2><p>æ‰§è¡Œä¸‹åˆ—æ“ä½œä»¥æµ‹è¯•ï¼š</p><ul><li><p>åˆ©ç”¨redis-cliè¿æ¥7001ï¼Œæ‰§è¡Œ<code>set num 123</code></p></li><li><p>åˆ©ç”¨redis-cliè¿æ¥7002ï¼Œæ‰§è¡Œ<code>get num</code>ï¼Œå†æ‰§è¡Œ<code>set num 666</code></p></li><li><p>åˆ©ç”¨redis-cliè¿æ¥7003ï¼Œæ‰§è¡Œ<code>get num</code>ï¼Œå†æ‰§è¡Œ<code>set num 888</code></p></li></ul><p>å¯ä»¥å‘ç°ï¼Œåªæœ‰åœ¨7001è¿™ä¸ªmasterèŠ‚ç‚¹ä¸Šå¯ä»¥æ‰§è¡Œå†™æ“ä½œï¼Œ7002å’Œ7003è¿™ä¸¤ä¸ªslaveèŠ‚ç‚¹åªèƒ½æ‰§è¡Œè¯»æ“ä½œã€‚</p><h1 id="2-ä¸»ä»æ•°æ®åŒæ­¥åŸç†"><a href="#2-ä¸»ä»æ•°æ®åŒæ­¥åŸç†" class="headerlink" title="2.ä¸»ä»æ•°æ®åŒæ­¥åŸç†"></a>2.ä¸»ä»æ•°æ®åŒæ­¥åŸç†</h1><h2 id="2-1-å…¨é‡åŒæ­¥"><a href="#2-1-å…¨é‡åŒæ­¥" class="headerlink" title="2.1.å…¨é‡åŒæ­¥"></a>2.1.å…¨é‡åŒæ­¥</h2><p>ä¸»ä»ç¬¬ä¸€æ¬¡å»ºç«‹è¿æ¥æ—¶ï¼Œä¼šæ‰§è¡Œ<strong>å…¨é‡åŒæ­¥</strong>ï¼Œå°†masterèŠ‚ç‚¹çš„æ‰€æœ‰æ•°æ®éƒ½æ‹·è´ç»™slaveèŠ‚ç‚¹ï¼Œæµç¨‹ï¼š</p><p><img src="http://cdn.leesin.fun/typora/s3/img/image-20210725152222497.png" alt="image-20210725152222497"></p><p>è¿™é‡Œæœ‰ä¸€ä¸ªé—®é¢˜ï¼Œmasterå¦‚ä½•å¾—çŸ¥salveæ˜¯ç¬¬ä¸€æ¬¡æ¥è¿æ¥å‘¢ï¼Ÿï¼Ÿ</p><p>æœ‰ä¸¤ä¸ªæ¦‚å¿µï¼Œå¯ä»¥ä½œä¸ºåˆ¤æ–­ä¾æ®ï¼š</p><ul><li><strong>Replication Id</strong>ï¼šç®€ç§°replidï¼Œæ˜¯æ•°æ®é›†çš„æ ‡è®°ï¼Œidä¸€è‡´åˆ™è¯´æ˜æ˜¯åŒä¸€æ•°æ®é›†ã€‚æ¯ä¸€ä¸ªmasteréƒ½æœ‰å”¯ä¸€çš„replidï¼Œslaveåˆ™ä¼šç»§æ‰¿masterèŠ‚ç‚¹çš„replid</li><li><strong>offset</strong>ï¼šåç§»é‡ï¼Œéšç€è®°å½•åœ¨repl_baklogä¸­çš„æ•°æ®å¢å¤šè€Œé€æ¸å¢å¤§ã€‚slaveå®ŒæˆåŒæ­¥æ—¶ä¹Ÿä¼šè®°å½•å½“å‰åŒæ­¥çš„offsetã€‚å¦‚æœslaveçš„offsetå°äºmasterçš„offsetï¼Œè¯´æ˜slaveæ•°æ®è½åäºmasterï¼Œéœ€è¦æ›´æ–°ã€‚</li></ul><p>å› æ­¤slaveåšæ•°æ®åŒæ­¥ï¼Œå¿…é¡»å‘masterå£°æ˜è‡ªå·±çš„replication id å’Œoffsetï¼Œmasteræ‰å¯ä»¥åˆ¤æ–­åˆ°åº•éœ€è¦åŒæ­¥å“ªäº›æ•°æ®ã€‚</p><p>å› ä¸ºslaveåŸæœ¬ä¹Ÿæ˜¯ä¸€ä¸ªmasterï¼Œæœ‰è‡ªå·±çš„replidå’Œoffsetï¼Œå½“ç¬¬ä¸€æ¬¡å˜æˆslaveï¼Œä¸masterå»ºç«‹è¿æ¥æ—¶ï¼Œå‘é€çš„replidå’Œoffsetæ˜¯è‡ªå·±çš„replidå’Œoffsetã€‚</p><p>masteråˆ¤æ–­å‘ç°slaveå‘é€æ¥çš„replidä¸è‡ªå·±çš„ä¸ä¸€è‡´ï¼Œè¯´æ˜è¿™æ˜¯ä¸€ä¸ªå…¨æ–°çš„slaveï¼Œå°±çŸ¥é“è¦åšå…¨é‡åŒæ­¥äº†ã€‚</p><p>masterä¼šå°†è‡ªå·±çš„replidå’Œoffsetéƒ½å‘é€ç»™è¿™ä¸ªslaveï¼Œslaveä¿å­˜è¿™äº›ä¿¡æ¯ã€‚ä»¥åslaveçš„replidå°±ä¸masterä¸€è‡´äº†ã€‚</p><p>å› æ­¤ï¼Œ<strong>masteråˆ¤æ–­ä¸€ä¸ªèŠ‚ç‚¹æ˜¯å¦æ˜¯ç¬¬ä¸€æ¬¡åŒæ­¥çš„ä¾æ®ï¼Œå°±æ˜¯çœ‹replidæ˜¯å¦ä¸€è‡´</strong>ã€‚</p><p>å¦‚å›¾ï¼š</p><p><img src="http://cdn.leesin.fun/typora/s3/img/image-20210725152700914.png" alt="image-20210725152700914"></p><p>å®Œæ•´æµç¨‹æè¿°ï¼š</p><ul><li>slaveèŠ‚ç‚¹è¯·æ±‚å¢é‡åŒæ­¥</li><li>masterèŠ‚ç‚¹åˆ¤æ–­replidï¼Œå‘ç°ä¸ä¸€è‡´ï¼Œæ‹’ç»å¢é‡åŒæ­¥</li><li>masterå°†å®Œæ•´å†…å­˜æ•°æ®ç”ŸæˆRDBï¼Œå‘é€RDBåˆ°slave</li><li>slaveæ¸…ç©ºæœ¬åœ°æ•°æ®ï¼ŒåŠ è½½masterçš„RDB</li><li>masterå°†RDBæœŸé—´çš„å‘½ä»¤è®°å½•åœ¨repl_baklogï¼Œå¹¶æŒç»­å°†logä¸­çš„å‘½ä»¤å‘é€ç»™slave</li><li>slaveæ‰§è¡Œæ¥æ”¶åˆ°çš„å‘½ä»¤ï¼Œä¿æŒä¸masterä¹‹é—´çš„åŒæ­¥</li></ul><h2 id="2-2-å¢é‡åŒæ­¥"><a href="#2-2-å¢é‡åŒæ­¥" class="headerlink" title="2.2.å¢é‡åŒæ­¥"></a>2.2.å¢é‡åŒæ­¥</h2><p>å…¨é‡åŒæ­¥éœ€è¦å…ˆåšRDBï¼Œç„¶åå°†RDBæ–‡ä»¶é€šè¿‡ç½‘ç»œä¼ è¾“ä¸ªslaveï¼Œæˆæœ¬å¤ªé«˜äº†ã€‚å› æ­¤é™¤äº†ç¬¬ä¸€æ¬¡åšå…¨é‡åŒæ­¥ï¼Œå…¶å®ƒå¤§å¤šæ•°æ—¶å€™slaveä¸masteréƒ½æ˜¯åš<strong>å¢é‡åŒæ­¥</strong>ã€‚</p><p>ä»€ä¹ˆæ˜¯å¢é‡åŒæ­¥ï¼Ÿå°±æ˜¯åªæ›´æ–°slaveä¸masterå­˜åœ¨å·®å¼‚çš„éƒ¨åˆ†æ•°æ®ã€‚å¦‚å›¾ï¼š</p><p><img src="http://cdn.leesin.fun/typora/s3/img/image-20210725153201086.png" alt="image-20210725153201086"></p><p>é‚£ä¹ˆmasteræ€ä¹ˆçŸ¥é“slaveä¸è‡ªå·±çš„æ•°æ®å·®å¼‚åœ¨å“ªé‡Œå‘¢?</p><h2 id="2-3-repl-backlogåŸç†"><a href="#2-3-repl-backlogåŸç†" class="headerlink" title="2.3.repl_backlogåŸç†"></a>2.3.repl_backlogåŸç†</h2><p>masteræ€ä¹ˆçŸ¥é“slaveä¸è‡ªå·±çš„æ•°æ®å·®å¼‚åœ¨å“ªé‡Œå‘¢?</p><p>è¿™å°±è¦è¯´åˆ°å…¨é‡åŒæ­¥æ—¶çš„repl_baklogæ–‡ä»¶äº†ã€‚</p><p>è¿™ä¸ªæ–‡ä»¶æ˜¯ä¸€ä¸ªå›ºå®šå¤§å°çš„æ•°ç»„ï¼Œåªä¸è¿‡æ•°ç»„æ˜¯ç¯å½¢ï¼Œä¹Ÿå°±æ˜¯è¯´<strong>è§’æ ‡åˆ°è¾¾æ•°ç»„æœ«å°¾åï¼Œä¼šå†æ¬¡ä»0å¼€å§‹è¯»å†™</strong>ï¼Œè¿™æ ·æ•°ç»„å¤´éƒ¨çš„æ•°æ®å°±ä¼šè¢«è¦†ç›–ã€‚</p><p>repl_baklogä¸­ä¼šè®°å½•Rediså¤„ç†è¿‡çš„å‘½ä»¤æ—¥å¿—åŠoffsetï¼ŒåŒ…æ‹¬masterå½“å‰çš„offsetï¼Œå’Œslaveå·²ç»æ‹·è´åˆ°çš„offsetï¼š</p><p><img src="http://cdn.leesin.fun/typora/s3/img/image-20210725153359022.png" alt="image-20210725153359022"> </p><p>slaveä¸masterçš„offsetä¹‹é—´çš„å·®å¼‚ï¼Œå°±æ˜¯salveéœ€è¦å¢é‡æ‹·è´çš„æ•°æ®äº†ã€‚</p><p>éšç€ä¸æ–­æœ‰æ•°æ®å†™å…¥ï¼Œmasterçš„offseté€æ¸å˜å¤§ï¼Œslaveä¹Ÿä¸æ–­çš„æ‹·è´ï¼Œè¿½èµ¶masterçš„offsetï¼š</p><p><img src="http://cdn.leesin.fun/typora/s3/img/image-20210725153524190.png" alt="image-20210725153524190"> </p><p>ç›´åˆ°æ•°ç»„è¢«å¡«æ»¡ï¼š</p><p><img src="http://cdn.leesin.fun/typora/s3/img/image-20210725153715910.png" alt="image-20210725153715910"> </p><p>æ­¤æ—¶ï¼Œå¦‚æœæœ‰æ–°çš„æ•°æ®å†™å…¥ï¼Œå°±ä¼šè¦†ç›–æ•°ç»„ä¸­çš„æ—§æ•°æ®ã€‚ä¸è¿‡ï¼Œæ—§çš„æ•°æ®åªè¦æ˜¯ç»¿è‰²çš„ï¼Œè¯´æ˜æ˜¯å·²ç»è¢«åŒæ­¥åˆ°slaveçš„æ•°æ®ï¼Œå³ä¾¿è¢«è¦†ç›–äº†ä¹Ÿæ²¡ä»€ä¹ˆå½±å“ã€‚å› ä¸ºæœªåŒæ­¥çš„ä»…ä»…æ˜¯çº¢è‰²éƒ¨åˆ†ã€‚</p><p>ä½†æ˜¯ï¼Œå¦‚æœslaveå‡ºç°ç½‘ç»œé˜»å¡ï¼Œå¯¼è‡´masterçš„offsetè¿œè¿œè¶…è¿‡äº†slaveçš„offsetï¼š </p><p><img src="http://cdn.leesin.fun/typora/s3/img/image-20210725153937031.png" alt="image-20210725153937031"> </p><p>å¦‚æœmasterç»§ç»­å†™å…¥æ–°æ•°æ®ï¼Œå…¶offsetå°±ä¼šè¦†ç›–æ—§çš„æ•°æ®ï¼Œç›´åˆ°å°†slaveç°åœ¨çš„offsetä¹Ÿè¦†ç›–ï¼š</p><p><img src="http://cdn.leesin.fun/typora/s3/img/image-20210725154155984.png" alt="image-20210725154155984"> </p><p>æ£•è‰²æ¡†ä¸­çš„çº¢è‰²éƒ¨åˆ†ï¼Œå°±æ˜¯å°šæœªåŒæ­¥ï¼Œä½†æ˜¯å´å·²ç»è¢«è¦†ç›–çš„æ•°æ®ã€‚æ­¤æ—¶å¦‚æœslaveæ¢å¤ï¼Œéœ€è¦åŒæ­¥ï¼Œå´å‘ç°è‡ªå·±çš„offsetéƒ½æ²¡æœ‰äº†ï¼Œæ— æ³•å®Œæˆå¢é‡åŒæ­¥äº†ã€‚åªèƒ½åšå…¨é‡åŒæ­¥ã€‚</p><blockquote><p>æ€»ç»“ï¼šrepl_baklogå¤§å°æœ‰ä¸Šé™ï¼Œå†™æ»¡åä¼šè¦†ç›–æœ€æ—©çš„æ•°æ®ã€‚å¦‚æœslaveæ–­å¼€æ—¶é—´è¿‡ä¹…ï¼Œå¯¼è‡´å°šæœªå¤‡ä»½çš„æ•°æ®è¢«è¦†ç›–ï¼Œåˆ™æ— æ³•åŸºäºlogåšå¢é‡åŒæ­¥ï¼Œåªèƒ½å†æ¬¡å…¨é‡åŒæ­¥ã€‚</p></blockquote><h1 id="3-ä¸»ä»åŒæ­¥ä¼˜åŒ–"><a href="#3-ä¸»ä»åŒæ­¥ä¼˜åŒ–" class="headerlink" title="3.ä¸»ä»åŒæ­¥ä¼˜åŒ–"></a>3.ä¸»ä»åŒæ­¥ä¼˜åŒ–</h1><p>ä¸»ä»åŒæ­¥å¯ä»¥ä¿è¯ä¸»ä»æ•°æ®çš„ä¸€è‡´æ€§ï¼Œéå¸¸é‡è¦ã€‚</p><p>å¯ä»¥ä»ä»¥ä¸‹å‡ ä¸ªæ–¹é¢æ¥ä¼˜åŒ–Redisä¸»ä»é›†ç¾¤ï¼š</p><ul><li>åœ¨masterä¸­é…ç½®<code>repl-diskless-sync yes</code>å¯ç”¨æ— ç£ç›˜å¤åˆ¶ï¼Œé¿å…å…¨é‡åŒæ­¥æ—¶çš„ç£ç›˜IOã€‚</li><li>Rediså•èŠ‚ç‚¹ä¸Šçš„å†…å­˜å ç”¨ä¸è¦å¤ªå¤§ï¼Œå‡å°‘RDBå¯¼è‡´çš„è¿‡å¤šç£ç›˜IO</li><li>é€‚å½“æé«˜repl_baklogçš„å¤§å°ï¼Œå‘ç°slaveå®•æœºæ—¶å°½å¿«å®ç°æ•…éšœæ¢å¤ï¼Œå°½å¯èƒ½é¿å…å…¨é‡åŒæ­¥</li><li>é™åˆ¶ä¸€ä¸ªmasterä¸Šçš„slaveèŠ‚ç‚¹æ•°é‡ï¼Œå¦‚æœå®åœ¨æ˜¯å¤ªå¤šslaveï¼Œåˆ™å¯ä»¥é‡‡ç”¨<strong>ä¸»-ä»-ä»é“¾å¼ç»“æ„</strong>ï¼Œå‡å°‘masterå‹åŠ›</li></ul><p>ä¸»ä»ä»æ¶æ„å›¾ï¼š</p><p><img src="http://cdn.leesin.fun/typora/s3/img/image-20230330195253244.png" alt="image-20230330195253244"></p><h1 id="4-å°ç»“"><a href="#4-å°ç»“" class="headerlink" title="4.å°ç»“"></a>4.å°ç»“</h1><p>ç®€è¿°å…¨é‡åŒæ­¥å’Œå¢é‡åŒæ­¥åŒºåˆ«ï¼Ÿ</p><ul><li>å…¨é‡åŒæ­¥ï¼šmasterå°†å®Œæ•´å†…å­˜æ•°æ®ç”ŸæˆRDBï¼Œå‘é€RDBåˆ°slaveã€‚åç»­å‘½ä»¤åˆ™è®°å½•åœ¨repl_baklogï¼Œé€ä¸ªå‘é€ç»™slaveã€‚</li><li>å¢é‡åŒæ­¥ï¼šslaveæäº¤è‡ªå·±çš„offsetåˆ°masterï¼Œmasterè·å–repl_baklogä¸­ä»offsetä¹‹åçš„å‘½ä»¤ç»™slave</li></ul><p>ä»€ä¹ˆæ—¶å€™æ‰§è¡Œå…¨é‡åŒæ­¥ï¼Ÿ</p><ul><li>slaveèŠ‚ç‚¹ç¬¬ä¸€æ¬¡è¿æ¥masterèŠ‚ç‚¹æ—¶</li><li>slaveèŠ‚ç‚¹æ–­å¼€æ—¶é—´å¤ªä¹…ï¼Œrepl_baklogä¸­çš„offsetå·²ç»è¢«è¦†ç›–æ—¶</li></ul><p>ä»€ä¹ˆæ—¶å€™æ‰§è¡Œå¢é‡åŒæ­¥ï¼Ÿ</p><ul><li>slaveèŠ‚ç‚¹æ–­å¼€åˆæ¢å¤ï¼Œå¹¶ä¸”åœ¨repl_baklogä¸­èƒ½æ‰¾åˆ°offsetæ—¶</li></ul>]]></content>
      
      
      <categories>
          
          <category> åç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> redis </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>redisæŒä¹…åŒ–</title>
      <link href="/post/13.html"/>
      <url>/post/13.html</url>
      
        <content type="html"><![CDATA[<h1 id="1-RDBæŒä¹…åŒ–"><a href="#1-RDBæŒä¹…åŒ–" class="headerlink" title="1.RDBæŒä¹…åŒ–"></a>1.RDBæŒä¹…åŒ–</h1><h2 id="1-1-æ¦‚è¿°"><a href="#1-1-æ¦‚è¿°" class="headerlink" title="1.1.æ¦‚è¿°"></a>1.1.æ¦‚è¿°</h2><p>RDBå…¨ç§°<strong>R</strong>edis <strong>D</strong>atabase <strong>B</strong>ackup fileï¼ˆRedisæ•°æ®å¤‡ä»½æ–‡ä»¶ï¼‰ï¼Œä¹Ÿè¢«å«åš<strong>Redisæ•°æ®å¿«ç…§</strong>ã€‚ç®€å•æ¥è¯´å°±æ˜¯æŠŠå†…å­˜ä¸­çš„æ‰€æœ‰æ•°æ®éƒ½è®°å½•åˆ°ç£ç›˜ä¸­ã€‚å½“Rediså®ä¾‹æ•…éšœé‡å¯åï¼Œä»ç£ç›˜è¯»å–å¿«ç…§æ–‡ä»¶ï¼Œæ¢å¤æ•°æ®ã€‚</p><p>å¿«ç…§æ–‡ä»¶ç§°ä¸ºRDBæ–‡ä»¶ï¼Œé»˜è®¤æ˜¯ä¿å­˜åœ¨å½“å‰è¿è¡Œç›®å½•ã€‚</p><h2 id="1-2-æ‰§è¡Œæ—¶æœº"><a href="#1-2-æ‰§è¡Œæ—¶æœº" class="headerlink" title="1.2.æ‰§è¡Œæ—¶æœº"></a>1.2.æ‰§è¡Œæ—¶æœº</h2><p>RDBæŒä¹…åŒ–åœ¨å››ç§æƒ…å†µä¸‹ä¼šæ‰§è¡Œï¼š</p><ul><li>æ‰§è¡Œsaveå‘½ä»¤</li><li>æ‰§è¡Œbgsaveå‘½ä»¤</li><li>Redisåœæœºæ—¶</li><li>è§¦å‘RDBæ¡ä»¶æ—¶</li></ul><h3 id="1-2-1-saveå‘½ä»¤"><a href="#1-2-1-saveå‘½ä»¤" class="headerlink" title="1.2.1.saveå‘½ä»¤"></a>1.2.1.saveå‘½ä»¤</h3><p>æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼Œå¯ä»¥ç«‹å³æ‰§è¡Œä¸€æ¬¡RDBï¼š</p><p><img src="http://cdn.leesin.fun/typora/s3/img/image-20210725144536958.png" alt="image-20210725144536958"></p><p>saveå‘½ä»¤ä¼šå¯¼è‡´ä¸»è¿›ç¨‹æ‰§è¡ŒRDBï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸­å…¶å®ƒæ‰€æœ‰å‘½ä»¤éƒ½ä¼šè¢«é˜»å¡ã€‚åªæœ‰åœ¨æ•°æ®è¿ç§»æ—¶å¯èƒ½ç”¨åˆ°ã€‚</p><h3 id="1-2-2-bgsaveå‘½ä»¤"><a href="#1-2-2-bgsaveå‘½ä»¤" class="headerlink" title="1.2.2.bgsaveå‘½ä»¤"></a>1.2.2.bgsaveå‘½ä»¤</h3><p>ä¸‹é¢çš„å‘½ä»¤å¯ä»¥å¼‚æ­¥æ‰§è¡ŒRDBï¼š</p><p><img src="http://cdn.leesin.fun/typora/s3/img/image-20210725144725943.png" alt="image-20210725144725943"></p><p>è¿™ä¸ªå‘½ä»¤æ‰§è¡Œåä¼šå¼€å¯ç‹¬ç«‹è¿›ç¨‹å®ŒæˆRDBï¼Œä¸»è¿›ç¨‹å¯ä»¥æŒç»­å¤„ç†ç”¨æˆ·è¯·æ±‚ï¼Œä¸å—å½±å“ã€‚</p><h3 id="1-2-3-åœæœºæ—¶"><a href="#1-2-3-åœæœºæ—¶" class="headerlink" title="1.2.3.åœæœºæ—¶"></a>1.2.3.åœæœºæ—¶</h3><p>Redisåœæœºæ—¶ä¼šæ‰§è¡Œä¸€æ¬¡saveå‘½ä»¤ï¼Œå®ç°RDBæŒä¹…åŒ–ã€‚</p><h3 id="1-2-4-è§¦å‘RDBæ¡ä»¶"><a href="#1-2-4-è§¦å‘RDBæ¡ä»¶" class="headerlink" title="1.2.4.è§¦å‘RDBæ¡ä»¶"></a>1.2.4.è§¦å‘RDBæ¡ä»¶</h3><p>Rediså†…éƒ¨æœ‰è§¦å‘RDBçš„æœºåˆ¶ï¼Œå¯ä»¥åœ¨redis.confæ–‡ä»¶ä¸­æ‰¾åˆ°ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 900ç§’å†…ï¼Œå¦‚æœè‡³å°‘æœ‰1ä¸ªkeyè¢«ä¿®æ”¹ï¼Œåˆ™æ‰§è¡Œbgsave ï¼Œ å¦‚æœæ˜¯save &quot;&quot; åˆ™è¡¨ç¤ºç¦ç”¨RDB</span></span><br><span class="line"><span class="attr">save</span> <span class="string">900 1  </span></span><br><span class="line"><span class="attr">save</span> <span class="string">300 10  </span></span><br><span class="line"><span class="attr">save</span> <span class="string">60 10000 </span></span><br></pre></td></tr></table></figure><p>RDBçš„å…¶å®ƒé…ç½®ä¹Ÿå¯ä»¥åœ¨redis.confæ–‡ä»¶ä¸­è®¾ç½®ï¼š</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ˜¯å¦å‹ç¼© ,å»ºè®®ä¸å¼€å¯ï¼Œå‹ç¼©ä¹Ÿä¼šæ¶ˆè€—cpuï¼Œç£ç›˜çš„è¯ä¸å€¼é’±</span></span><br><span class="line"><span class="attr">rdbcompression</span> <span class="string">yes</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># RDBæ–‡ä»¶åç§°</span></span><br><span class="line"><span class="attr">dbfilename</span> <span class="string">dump.rdb  </span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># æ–‡ä»¶ä¿å­˜çš„è·¯å¾„ç›®å½•</span></span><br><span class="line"><span class="attr">dir</span> <span class="string">./ </span></span><br></pre></td></tr></table></figure><h2 id="1-3-RDBåŸç†"><a href="#1-3-RDBåŸç†" class="headerlink" title="1.3.RDBåŸç†"></a>1.3.RDBåŸç†</h2><p>bgsaveå¼€å§‹æ—¶ä¼šforkä¸»è¿›ç¨‹å¾—åˆ°å­è¿›ç¨‹ï¼Œå­è¿›ç¨‹å…±äº«ä¸»è¿›ç¨‹çš„å†…å­˜æ•°æ®ã€‚å®Œæˆforkåè¯»å–å†…å­˜æ•°æ®å¹¶å†™å…¥ RDB æ–‡ä»¶ã€‚</p><p>forké‡‡ç”¨çš„æ˜¯copy-on-writeæŠ€æœ¯ï¼š</p><ul><li>å½“ä¸»è¿›ç¨‹æ‰§è¡Œè¯»æ“ä½œæ—¶ï¼Œè®¿é—®å…±äº«å†…å­˜ï¼›</li><li>å½“ä¸»è¿›ç¨‹æ‰§è¡Œå†™æ“ä½œæ—¶ï¼Œåˆ™ä¼šæ‹·è´ä¸€ä»½æ•°æ®ï¼Œæ‰§è¡Œå†™æ“ä½œã€‚</li></ul><p><img src="http://cdn.leesin.fun/typora/s3/img/image-20230330161440149.png" alt="image-20230330161440149"></p><blockquote><p>ä¸»è¦æµç¨‹ä¸ºï¼š</p><ul><li>bgsave å­è¿›ç¨‹æ˜¯ç”±ä¸»çº¿ç¨‹ fork å‡ºæ¥çš„ï¼Œå¯ä»¥å…±äº«ä¸»çº¿ç¨‹çš„æ‰€æœ‰å†…å­˜æ•°æ®ï¼›</li><li>bgsave å­è¿›ç¨‹è¿è¡Œåï¼Œå¼€å§‹è¯»å–ä¸»çº¿ç¨‹çš„å†…å­˜æ•°æ®ï¼Œå¹¶æŠŠå®ƒä»¬å†™å…¥ RDB æ–‡ä»¶ä¸­ï¼›</li><li>å¦‚æœä¸»çº¿ç¨‹å¯¹è¿™äº›æ•°æ®éƒ½æ˜¯è¯»æ“ä½œï¼Œä¾‹å¦‚ Aï¼Œé‚£ä¹ˆä¸»çº¿ç¨‹å’Œ bgsave å­è¿›ç¨‹äº’ä¸å½±å“ï¼›</li><li>å¦‚æœä¸»çº¿ç¨‹éœ€è¦ä¿®æ”¹ä¸€å—æ•°æ®ï¼Œå¦‚ Cï¼Œè¿™å—æ•°æ®ä¼šè¢«å¤åˆ¶ä¸€ä»½ï¼Œç”Ÿæˆæ•°æ®çš„å‰¯æœ¬ï¼Œç„¶ä¸»çº¿ç¨‹åœ¨è¿™ä¸ªå‰¯æœ¬ä¸Šè¿›è¡Œä¿®æ”¹ï¼›bgsave å­è¿›ç¨‹å¯ä»¥æŠŠåŸæ¥çš„æ•°æ® C å†™å…¥ RDB æ–‡ä»¶ï¼›</li></ul></blockquote><h2 id="1-4-å°ç»“"><a href="#1-4-å°ç»“" class="headerlink" title="1.4.å°ç»“"></a>1.4.å°ç»“</h2><p>RDBæ–¹å¼bgsaveçš„åŸºæœ¬æµç¨‹ï¼Ÿ</p><ul><li>forkä¸»è¿›ç¨‹å¾—åˆ°ä¸€ä¸ªå­è¿›ç¨‹ï¼Œå…±äº«å†…å­˜ç©ºé—´</li><li>å­è¿›ç¨‹è¯»å–å†…å­˜æ•°æ®å¹¶å†™å…¥æ–°çš„RDBæ–‡ä»¶</li><li>ç”¨æ–°RDBæ–‡ä»¶æ›¿æ¢æ—§çš„RDBæ–‡ä»¶</li></ul><p>RDBä¼šåœ¨ä»€ä¹ˆæ—¶å€™æ‰§è¡Œï¼Ÿsave 60 1000ä»£è¡¨ä»€ä¹ˆå«ä¹‰ï¼Ÿ</p><ul><li>é»˜è®¤æ˜¯æœåŠ¡åœæ­¢æ—¶</li><li>ä»£è¡¨60ç§’å†…è‡³å°‘æ‰§è¡Œ1000æ¬¡ä¿®æ”¹åˆ™è§¦å‘RDB</li></ul><p>RDBçš„ç¼ºç‚¹ï¼Ÿ</p><ul><li>RDBæ‰§è¡Œé—´éš”æ—¶é—´é•¿ï¼Œä¸¤æ¬¡RDBä¹‹é—´å†™å…¥æ•°æ®æœ‰ä¸¢å¤±çš„é£é™©</li><li>forkå­è¿›ç¨‹ã€å‹ç¼©ã€å†™å‡ºRDBæ–‡ä»¶éƒ½æ¯”è¾ƒè€—æ—¶</li></ul><h1 id="2-AOFæŒä¹…åŒ–"><a href="#2-AOFæŒä¹…åŒ–" class="headerlink" title="2.AOFæŒä¹…åŒ–"></a>2.AOFæŒä¹…åŒ–</h1><h2 id="2-1-AOFåŸç†"><a href="#2-1-AOFåŸç†" class="headerlink" title="2.1.AOFåŸç†"></a>2.1.AOFåŸç†</h2><p>AOFå…¨ç§°ä¸ºAppend Only Fileï¼ˆè¿½åŠ æ–‡ä»¶ï¼‰ã€‚Rediså¤„ç†çš„æ¯ä¸€ä¸ªå†™å‘½ä»¤éƒ½ä¼šè®°å½•åœ¨AOFæ–‡ä»¶ï¼Œå¯ä»¥çœ‹åšæ˜¯å‘½ä»¤æ—¥å¿—æ–‡ä»¶ã€‚</p><p><img src="http://cdn.leesin.fun/typora/s3/img/image-20210725151543640.png" alt="image-20210725151543640"></p><blockquote><p>å…¶ä¸­*3 ä»£è¡¨å½“å‰å‘½ä»¤åˆ†ä¸ºä¸‰éƒ¨åˆ†ï¼Œæ¯éƒ¨åˆ†éƒ½æ˜¯é€šè¿‡$+æ•°å­—å¼€å¤´ï¼Œå…¶ä¸­æ•°å­—è¡¨ç¤ºè¯¥éƒ¨åˆ†çš„å‘½ä»¤ã€é”®ã€å€¼ä¸€å…±æœ‰å¤šå°‘å­—èŠ‚ã€‚</p></blockquote><h2 id="2-2-AOFé…ç½®"><a href="#2-2-AOFé…ç½®" class="headerlink" title="2.2.AOFé…ç½®"></a>2.2.AOFé…ç½®</h2><p>AOFé»˜è®¤æ˜¯å…³é—­çš„ï¼Œéœ€è¦ä¿®æ”¹redis.confé…ç½®æ–‡ä»¶æ¥å¼€å¯AOFï¼š</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ˜¯å¦å¼€å¯AOFåŠŸèƒ½ï¼Œé»˜è®¤æ˜¯no</span></span><br><span class="line"><span class="attr">appendonly</span> <span class="string">yes</span></span><br><span class="line"><span class="comment"># AOFæ–‡ä»¶çš„åç§°</span></span><br><span class="line"><span class="attr">appendfilename</span> <span class="string">&quot;appendonly.aof&quot;</span></span><br></pre></td></tr></table></figure><p>AOFçš„å‘½ä»¤è®°å½•çš„é¢‘ç‡ä¹Ÿå¯ä»¥é€šè¿‡redis.confæ–‡ä»¶æ¥é…ï¼š</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è¡¨ç¤ºæ¯æ‰§è¡Œä¸€æ¬¡å†™å‘½ä»¤ï¼Œç«‹å³è®°å½•åˆ°AOFæ–‡ä»¶</span></span><br><span class="line"><span class="attr">appendfsync</span> <span class="string">always </span></span><br><span class="line"><span class="comment"># å†™å‘½ä»¤æ‰§è¡Œå®Œå…ˆæ”¾å…¥AOFç¼“å†²åŒºï¼Œç„¶åè¡¨ç¤ºæ¯éš”1ç§’å°†ç¼“å†²åŒºæ•°æ®å†™åˆ°AOFæ–‡ä»¶ï¼Œæ˜¯é»˜è®¤æ–¹æ¡ˆ</span></span><br><span class="line"><span class="attr">appendfsync</span> <span class="string">everysec </span></span><br><span class="line"><span class="comment"># å†™å‘½ä»¤æ‰§è¡Œå®Œå…ˆæ”¾å…¥AOFç¼“å†²åŒºï¼Œç”±æ“ä½œç³»ç»Ÿå†³å®šä½•æ—¶å°†ç¼“å†²åŒºå†…å®¹å†™å›ç£ç›˜</span></span><br><span class="line"><span class="attr">appendfsync</span> <span class="string">no</span></span><br></pre></td></tr></table></figure><p>ä¸‰ç§ç­–ç•¥å¯¹æ¯”ï¼š</p><div class="table-container"><table><thead><tr><th style="text-align:center">é…ç½®é¡¹</th><th style="text-align:center">åˆ·ç›˜æ—¶æœº</th><th style="text-align:center">ä¼˜ç‚¹</th><th style="text-align:center">ç¼ºç‚¹</th></tr></thead><tbody><tr><td style="text-align:center">always</td><td style="text-align:center">åŒæ­¥åˆ·ç›˜</td><td style="text-align:center">å¯é æ€§é«˜ï¼Œå‡ ä¹ä¸ä¸¢æ•°æ®</td><td style="text-align:center">æ€§èƒ½å½±å“å¤§</td></tr><tr><td style="text-align:center">everysec</td><td style="text-align:center">æ¯ç§’åˆ·ç›˜</td><td style="text-align:center">æ€§èƒ½é€‚ä¸­</td><td style="text-align:center">æœ€å¤šä¸¢å¤±1ç§’æ•°æ®</td></tr><tr><td style="text-align:center">no</td><td style="text-align:center">æ“ä½œç³»ç»Ÿæ§åˆ¶</td><td style="text-align:center">æ€§èƒ½æœ€å¥½</td><td style="text-align:center">å¯é æ€§è¾ƒå·®ï¼Œå¯èƒ½ä¸¢å¤±å¤§é‡æ•°æ®</td></tr></tbody></table></div><blockquote><p>æ­£å¸¸æƒ…å†µä½¿ç”¨é»˜è®¤çš„everysecç­–ç•¥å°±è¡Œäº†ã€‚</p></blockquote><h2 id="2-3-AOFæ–‡ä»¶é‡å†™æœºåˆ¶"><a href="#2-3-AOFæ–‡ä»¶é‡å†™æœºåˆ¶" class="headerlink" title="2.3.AOFæ–‡ä»¶é‡å†™æœºåˆ¶"></a>2.3.AOFæ–‡ä»¶é‡å†™æœºåˆ¶</h2><h3 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h3><p>å› ä¸ºæ˜¯è®°å½•å‘½ä»¤ï¼ŒAOFæ–‡ä»¶ä¼šæ¯”RDBæ–‡ä»¶å¤§çš„å¤šã€‚è€Œä¸”AOFä¼šè®°å½•å¯¹åŒä¸€ä¸ªkeyçš„å¤šæ¬¡å†™æ“ä½œï¼Œä½†åªæœ‰æœ€åä¸€æ¬¡å†™æ“ä½œæ‰æœ‰æ„ä¹‰ã€‚é€šè¿‡æ‰§è¡Œ <code>bgrewriteaof</code> å‘½ä»¤ï¼Œå¯ä»¥è®©AOFæ–‡ä»¶æ‰§è¡Œé‡å†™åŠŸèƒ½ï¼Œç”¨æœ€å°‘çš„å‘½ä»¤è¾¾åˆ°ç›¸åŒæ•ˆæœã€‚</p><p><img src="http://cdn.leesin.fun/typora/s3/img/image-20210725151729118.png" alt="image-20210725151729118"></p><p>å¦‚å›¾ï¼ŒAOFåŸæœ¬æœ‰ä¸‰ä¸ªå‘½ä»¤ï¼Œä½†æ˜¯ <code>set num 123</code> å’Œ <code>set num 666</code> éƒ½æ˜¯å¯¹numçš„æ“ä½œï¼Œç¬¬äºŒæ¬¡ä¼šè¦†ç›–ç¬¬ä¸€æ¬¡çš„å€¼ï¼Œå› æ­¤ç¬¬ä¸€ä¸ªå‘½ä»¤è®°å½•ä¸‹æ¥æ²¡æœ‰æ„ä¹‰ã€‚</p><h3 id="å¯åŠ¨bgrewriteaof"><a href="#å¯åŠ¨bgrewriteaof" class="headerlink" title="å¯åŠ¨bgrewriteaof"></a>å¯åŠ¨bgrewriteaof</h3><p>æ‰€ä»¥é‡å†™å‘½ä»¤åï¼ŒAOFæ–‡ä»¶å†…å®¹å°±æ˜¯ï¼š<code>mset name jack num 666</code></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; BGREWRITEAOF</span><br><span class="line">Backgroud append only file rewriting started</span><br></pre></td></tr></table></figure><h3 id="é»˜è®¤çš„é…ç½®"><a href="#é»˜è®¤çš„é…ç½®" class="headerlink" title="é»˜è®¤çš„é…ç½®"></a>é»˜è®¤çš„é…ç½®</h3><p>Redisä¹Ÿä¼šåœ¨è§¦å‘é˜ˆå€¼æ—¶è‡ªåŠ¨å»é‡å†™AOFæ–‡ä»¶ã€‚é˜ˆå€¼ä¹Ÿå¯ä»¥åœ¨redis.confä¸­é…ç½®ï¼š</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># AOFæ–‡ä»¶æ¯”ä¸Šæ¬¡æ–‡ä»¶ å¢é•¿è¶…è¿‡å¤šå°‘ç™¾åˆ†æ¯”åˆ™è§¦å‘é‡å†™</span></span><br><span class="line"><span class="attr">auto-aof-rewrite-percentage</span> <span class="string">100</span></span><br><span class="line"><span class="comment"># AOFæ–‡ä»¶ä½“ç§¯æœ€å°å¤šå¤§ä»¥ä¸Šæ‰è§¦å‘é‡å†™ </span></span><br><span class="line"><span class="attr">auto-aof-rewrite-min-size</span> <span class="string">64mb </span></span><br></pre></td></tr></table></figure><h3 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h3><p>AOF é‡å†™çš„è¿‡ç¨‹æ˜¯é€šè¿‡ä¸»çº¿ç¨‹ fork åå°çš„ bgrewriteaof å­è¿›ç¨‹æ¥å®ç°çš„ï¼Œå¯ä»¥é¿å…é˜»å¡ä¸»è¿›ç¨‹å¯¼è‡´æ€§èƒ½ä¸‹é™ï¼Œæ•´ä¸ªè¿‡ç¨‹å¦‚ä¸‹ï¼š</p><ul><li>AOF æ¯æ¬¡é‡å†™ï¼Œfork è¿‡ç¨‹ä¼šæŠŠä¸»çº¿ç¨‹çš„å†…å­˜æ‹·è´ä¸€ä»½ bgrewriteaof å­è¿›ç¨‹ï¼Œé‡Œé¢åŒ…å«äº†æ•°æ®åº“çš„æ•°æ®ï¼Œæ‹·è´çš„æ˜¯çˆ¶è¿›ç¨‹çš„é¡µè¡¨ï¼Œå¯ä»¥åœ¨ä¸å½±å“ä¸»è¿›ç¨‹çš„æƒ…å†µä¸‹é€ä¸€æŠŠæ‹·è´çš„æ•°æ®è®°å…¥é‡å†™æ—¥å¿—ï¼›</li><li>å› ä¸ºä¸»çº¿ç¨‹æ²¡æœ‰é˜»å¡ï¼Œä»ç„¶å¯ä»¥å¤„ç†æ–°æ¥çš„æ“ä½œï¼Œå¦‚æœè¿™æ—¶å€™å­˜åœ¨å†™æ“ä½œï¼Œä¼šå…ˆæŠŠæ“ä½œå…ˆæ”¾å…¥ç¼“å†²åŒºï¼Œå¯¹äºæ­£åœ¨ä½¿ç”¨çš„æ—¥å¿—ï¼Œå¦‚æœå®•æœºäº†è¿™ä¸ªæ—¥å¿—ä¹Ÿæ˜¯é½å…¨çš„ï¼Œå¯ä»¥ç”¨äºæ¢å¤ï¼›å¯¹äºæ­£åœ¨æ›´æ–°çš„æ—¥å¿—ï¼Œä¹Ÿä¸ä¼šä¸¢å¤±æ–°çš„æ“ä½œï¼Œç­‰åˆ°æ•°æ®æ‹·è´å®Œæˆï¼Œå°±å¯ä»¥å°†ç¼“å†²åŒºçš„æ•°æ®å†™å…¥åˆ°æ–°çš„æ–‡ä»¶ä¸­ï¼Œä¿è¯æ•°æ®åº“çš„æœ€æ–°çŠ¶æ€ã€‚</li></ul><h1 id="3-RDBä¸AOFå¯¹æ¯”"><a href="#3-RDBä¸AOFå¯¹æ¯”" class="headerlink" title="3.RDBä¸AOFå¯¹æ¯”"></a>3.RDBä¸AOFå¯¹æ¯”</h1><p>RDBå’ŒAOFå„æœ‰è‡ªå·±çš„ä¼˜ç¼ºç‚¹ï¼Œå¦‚æœå¯¹æ•°æ®å®‰å…¨æ€§è¦æ±‚è¾ƒé«˜ï¼Œåœ¨å®é™…å¼€å‘ä¸­å¾€å¾€ä¼š<strong>ç»“åˆ</strong>ä¸¤è€…æ¥ä½¿ç”¨ã€‚</p><div class="table-container"><table><thead><tr><th style="text-align:center"></th><th style="text-align:center">RDB</th><th style="text-align:center">AOF</th></tr></thead><tbody><tr><td style="text-align:center">æŒä¹…åŒ–æ–¹å¼</td><td style="text-align:center">å®šæ—¶å¯¹æ•´ä¸ªå†…å­˜åšå¿«ç…§</td><td style="text-align:center">è®°å½•æ¯ä¸€æ¬¡æ‰§è¡Œçš„å‘½ä»¤</td></tr><tr><td style="text-align:center">æ•°æ®å®Œæ•´æ€§</td><td style="text-align:center">ä¸å®Œæ•´ï¼Œä¸¤æ¬¡æœ¬åˆ†ä¹‹é—´ä¼šä¸¢å¤±</td><td style="text-align:center">ç›¸å¯¹å®Œæ•´ï¼Œå–å†³äºåˆ·ç›˜ç­–ç•¥</td></tr><tr><td style="text-align:center">æ–‡ä»¶å¤§å°</td><td style="text-align:center">æ–‡ä»¶ä½“ç§¯è¾ƒå°</td><td style="text-align:center">æ–‡ä»¶ä½“ç§¯å¾ˆå¤§</td></tr><tr><td style="text-align:center">å®•æœºæ¢å¤é€Ÿåº¦</td><td style="text-align:center">å¾ˆå¿«</td><td style="text-align:center">æ…¢</td></tr><tr><td style="text-align:center">æ•°æ®æ¢å¤ä¼˜å…ˆçº§</td><td style="text-align:center">ä½ï¼Œå› ä¸ºæ•°æ®å®Œæ•´æ€§ä¸å¦‚AOF</td><td style="text-align:center">é«˜ï¼Œå› ä¸ºæ•°æ®å®Œæ•´æ€§æ›´é«˜</td></tr><tr><td style="text-align:center">ç³»ç»Ÿèµ„æºå ç”¨</td><td style="text-align:center">é«˜ï¼Œå¤§é‡CPUå’Œå†…å­˜æ¶ˆè€—</td><td style="text-align:center">ä½ï¼Œä¸»è¦æ˜¯ç£ç›˜IOèµ„æºã€‚ä½†AOFé‡å†™æ—¶ä¼šå ç”¨å¤§é‡CPUå’Œå†…å­˜èµ„æº</td></tr><tr><td style="text-align:center">ä½¿ç”¨åœºæ™¯</td><td style="text-align:center">å¯ä»¥å®¹å¿æ•°åˆ†é’Ÿçš„æ•°æ®ä¸¢å¤±ï¼Œè¿½æ±‚æ›´å¿«çš„å¯åŠ¨é€Ÿåº¦</td><td style="text-align:center">å¯¹æ•°æ®å®‰å…¨æ€§è¦æ±‚è¾ƒé«˜åœºæ™¯</td></tr></tbody></table></div><h1 id="4-æ··åˆä½¿ç”¨-AOF-æ—¥å¿—å’Œ-RDB-å¿«ç…§"><a href="#4-æ··åˆä½¿ç”¨-AOF-æ—¥å¿—å’Œ-RDB-å¿«ç…§" class="headerlink" title="4.æ··åˆä½¿ç”¨ AOF æ—¥å¿—å’Œ RDB å¿«ç…§"></a>4.æ··åˆä½¿ç”¨ AOF æ—¥å¿—å’Œ RDB å¿«ç…§</h1><p>è™½ç„¶è·Ÿ AOF ç›¸æ¯”ï¼ŒRDB å¿«ç…§çš„æ¢å¤é€Ÿåº¦å¿«ï¼Œä½†å¿«ç…§çš„é¢‘ç‡ä¸å¥½æŠŠæ¡ï¼Œå¦‚æœé¢‘ç‡å¤ªä½ï¼Œä¸¤æ¬¡å¿«ç…§é—´ä¸€æ—¦å®•æœºï¼Œå°±å¯èƒ½æœ‰æ¯”è¾ƒå¤šçš„æ•°æ®ä¸¢å¤±ã€‚å¦‚æœé¢‘ç‡å¤ªé«˜ï¼Œåˆä¼šäº§ç”Ÿé¢å¤–å¼€é”€ï¼Œé‚£ä¹ˆï¼Œè¿˜æœ‰ä»€ä¹ˆæ–¹æ³•æ—¢èƒ½åˆ©ç”¨ RDB çš„å¿«é€Ÿæ¢å¤ï¼Œåˆèƒ½ä»¥è¾ƒå°çš„å¼€é”€åšåˆ°å°½é‡å°‘ä¸¢æ•°æ®å‘¢ï¼Ÿ</p><p>åœ¨ Redis4.0 æå‡ºäº†<strong>æ··åˆä½¿ç”¨ AOF å’Œ RDB å¿«ç…§</strong>çš„æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯ä¸¤æ¬¡ RDB å¿«ç…§æœŸé—´çš„æ‰€æœ‰å‘½ä»¤æ“ä½œç”± AOF æ—¥å¿—æ–‡ä»¶è¿›è¡Œè®°å½•ã€‚è¿™æ ·çš„å¥½å¤„æ˜¯ RDB å¿«ç…§ä¸éœ€è¦å¾ˆé¢‘ç¹çš„æ‰§è¡Œï¼Œå¯ä»¥é¿å…é¢‘ç¹ fork å¯¹ä¸»çº¿ç¨‹çš„å½±å“ï¼Œè€Œä¸” AOF æ—¥å¿—ä¹Ÿåªè®°å½•ä¸¤æ¬¡å¿«ç…§æœŸé—´çš„æ“ä½œï¼Œä¸ç”¨è®°å½•æ‰€æœ‰æ“ä½œï¼Œä¹Ÿä¸ä¼šå‡ºç°æ–‡ä»¶è¿‡å¤§çš„æƒ…å†µï¼Œé¿å…äº†é‡å†™å¼€é”€ã€‚</p><p>é€šè¿‡ä¸Šè¿°æ–¹æ³•æ—¢å¯ä»¥äº«å— RDB å¿«é€Ÿæ¢å¤çš„å¥½å¤„ï¼Œä¹Ÿå¯ä»¥äº«å— AOF è®°å½•ç®€å•å‘½ä»¤çš„ä¼˜åŠ¿ã€‚</p><p><strong>å¯¹äº AOF å’Œ RDB çš„é€‰æ‹©é—®é¢˜ï¼š</strong></p><ul><li><p><strong>æ•°æ®ä¸èƒ½ä¸¢å¤±æ—¶ï¼Œå†…å­˜å¿«ç…§å’Œ AOF çš„æ··åˆä½¿ç”¨æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é€‰æ‹©ï¼›</strong></p></li><li><p><strong>å¦‚æœå…è®¸åˆ†é’Ÿçº§åˆ«çš„æ•°æ®ä¸¢å¤±ï¼Œå¯ä»¥åªä½¿ç”¨ RDBï¼›</strong></p></li><li><p><strong>å¦‚æœåªç”¨ AOFï¼Œä¼˜å…ˆä½¿ç”¨ everysec çš„é…ç½®é€‰é¡¹ï¼Œå› ä¸ºå®ƒåœ¨å¯é æ€§å’Œæ€§èƒ½ä¹‹é—´å–äº†ä¸€ä¸ªå¹³è¡¡ã€‚</strong></p></li></ul>]]></content>
      
      
      <categories>
          
          <category> åç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> redis </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€åŸç†ã€‘redisæ•°æ®ç»“æ„</title>
      <link href="/post/12.html"/>
      <url>/post/12.html</url>
      
        <content type="html"><![CDATA[<h1 id="1-æ€»è§ˆ"><a href="#1-æ€»è§ˆ" class="headerlink" title="1.æ€»è§ˆ"></a>1.æ€»è§ˆ</h1><div class="table-container"><table><thead><tr><th style="text-align:left">APIç±»å‹</th><th style="text-align:left">æƒ…æ™¯</th><th style="text-align:left">ç¼–ç ç±»å‹</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td style="text-align:left">String</td><td style="text-align:left">åªæœ‰æ•´æ•°ï¼Œä¸”èŒƒå›´åœ¨longçš„èŒƒå›´å†…ï¼ˆ8å­—èŠ‚ï¼‰</td><td style="text-align:left">INT</td><td>ptrç›´æ¥å­˜æ•´æ•°</td></tr><tr><td style="text-align:left">String</td><td style="text-align:left">å­—ç¬¦ä¸²é•¿åº¦å°äº44å­—èŠ‚</td><td style="text-align:left">EMBSTR</td><td>rdisObjectå°¾éƒ¨ç›´æ¥å’ŒSDSç‰©ç†ä¸Šç›¸è¿</td></tr><tr><td style="text-align:left">String</td><td style="text-align:left">ä¸æ˜¯æ•´æ•°ï¼Œä¸”å­—ç¬¦ä¸²å¤§äº44å­—èŠ‚ï¼ˆå³é€šç”¨æƒ…æ™¯ï¼‰</td><td style="text-align:left">RAW</td><td></td></tr><tr><td style="text-align:left">List</td><td style="text-align:left">Redis3.2ä¹‹å‰</td><td style="text-align:left">LinkedList+ZipList</td><td></td></tr><tr><td style="text-align:left">List</td><td style="text-align:left">Redis3.2ä¹‹å</td><td style="text-align:left">QuickList</td><td></td></tr><tr><td style="text-align:left">Set</td><td style="text-align:left">setçš„å…ƒç´ åªæœ‰æ•´æ•°</td><td style="text-align:left">IntSet</td><td>èŠ‚çœç©ºé—´ï¼Œä¸”æ•ˆç‡ä¹Ÿä¸ä¼šå¾ˆä½ï¼ˆäºŒåˆ†ï¼‰</td></tr><tr><td style="text-align:left">Set</td><td style="text-align:left">setçš„å…ƒç´ åªæœ‰æ•´æ•°ä½†æ˜¯è¶…è¿‡é˜ˆå€¼ï¼Œæˆ–è€…ä¸æ˜¯åªæœ‰æ•´æ•°ï¼ˆå³é€šç”¨æƒ…æ™¯ï¼‰</td><td style="text-align:left">HT</td><td></td></tr><tr><td style="text-align:left">ZSet</td><td style="text-align:left">æ•°æ®é‡å°æ—¶</td><td style="text-align:left">ZipList</td><td></td></tr><tr><td style="text-align:left">ZSet</td><td style="text-align:left">æ•°æ®é‡å¤§æ—¶</td><td style="text-align:left">HT+SkipList</td><td></td></tr><tr><td style="text-align:left">Hash</td><td style="text-align:left">æ•°æ®é‡å°æ—¶</td><td style="text-align:left">ZipList</td><td></td></tr><tr><td style="text-align:left">Hash</td><td style="text-align:left">æ•°æ®é‡å¤§æ—¶</td><td style="text-align:left">HT</td></tr></tbody></table></div><h1 id="2-åŠ¨æ€å­—ç¬¦ä¸²SDS"><a href="#2-åŠ¨æ€å­—ç¬¦ä¸²SDS" class="headerlink" title="2.åŠ¨æ€å­—ç¬¦ä¸²SDS"></a>2.åŠ¨æ€å­—ç¬¦ä¸²SDS</h1><h2 id="åŸºæœ¬ä»‹ç»"><a href="#åŸºæœ¬ä»‹ç»" class="headerlink" title="åŸºæœ¬ä»‹ç»"></a>åŸºæœ¬ä»‹ç»</h2><p>Redisæ„å»ºäº†ä¸€ç§å­—ç¬¦ä¸²ç»“æ„ï¼Œç§°ä¸ºç®€å•åŠ¨æ€å­—ç¬¦ä¸²ï¼ˆSimple Dynamic Stringï¼‰ï¼Œç®€ç§°SDSã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">set</span> name <span class="string">&quot;zhangsan&quot;</span></span><br></pre></td></tr></table></figure><p>Rediså°†åœ¨åº•å±‚åˆ›å»ºä¸¤ä¸ªSDSï¼Œå…¶ä¸­ä¸€ä¸ªæ˜¯åŒ…å«â€œnameâ€çš„SDSï¼Œå¦ä¸€ä¸ªæ˜¯åŒ…å«â€œzhangsanâ€çš„SDSã€‚</p><h2 id="æºç "><a href="#æºç " class="headerlink" title="æºç "></a>æºç </h2><p>Redisæ˜¯Cè¯­è¨€å®ç°çš„ï¼Œå…¶ä¸­SDSæ˜¯ä¸€ä¸ªç»“æ„ä½“ï¼Œæºç å¦‚ä¸‹ï¼š</p><p><img src="http://cdn.leesin.fun/typora/s3/img/image-20230329104551453.png" alt="image-20230329104551453"></p><p>ä¾‹å¦‚ï¼Œä¸€ä¸ªåŒ…å«å­—ç¬¦ä¸²â€œnameâ€çš„sdsç»“æ„å¦‚ä¸‹ï¼š</p><p><img src="http://cdn.leesin.fun/typora/s3/img/image-20230329104636403.png" alt="image-20230329104636403"></p><p>SDSä¹‹æ‰€ä»¥å«åšåŠ¨æ€å­—ç¬¦ä¸²ï¼Œæ˜¯å› ä¸ºå®ƒå…·å¤‡åŠ¨æ€æ‰©å®¹çš„èƒ½åŠ›ï¼Œä¾‹å¦‚ä¸€ä¸ªå†…å®¹ä¸ºâ€œhiâ€çš„SDSï¼š</p><p><img src="http://cdn.leesin.fun/typora/s3/img/image-20230329104703683.png" alt="image-20230329104703683"></p><p>å‡å¦‚æˆ‘ä»¬è¦ç»™SDSè¿½åŠ ä¸€æ®µå­—ç¬¦ä¸²â€œ,Amyâ€ï¼Œè¿™é‡Œé¦–å…ˆä¼šç”³è¯·æ–°å†…å­˜ç©ºé—´ï¼š</p><ul><li>å¦‚æœæ–°å­—ç¬¦ä¸²å°äº1Mï¼Œåˆ™æ–°ç©ºé—´ä¸ºæ‰©å±•åå­—ç¬¦ä¸²é•¿åº¦çš„ä¸¤å€+1ï¼›</li><li>å¦‚æœæ–°å­—ç¬¦ä¸²å¤§äº1Mï¼Œåˆ™æ–°ç©ºé—´ä¸ºæ‰©å±•åå­—ç¬¦ä¸²é•¿åº¦+1M+1ã€‚ç§°ä¸º<strong>å†…å­˜é¢„åˆ†é…</strong>ã€‚</li></ul><p><img src="http://cdn.leesin.fun/typora/s3/img/image-20230329104752263.png" alt="image-20230329104752263"></p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>åŠ¨æ€å­—ç¬¦ä¸²çš„ä¼˜ç‚¹ï¼š</p><ul><li>è·å–å­—ç¬¦ä¸²é•¿åº¦çš„æ—¶é—´å¤æ‚åº¦ä¸ºO(1)</li><li>æ”¯æŒåŠ¨æ€æ‰©å®¹</li><li>å‡å°‘å†…å­˜åˆ†é…æ¬¡æ•°</li><li>äºŒè¿›åˆ¶å®‰å…¨</li></ul><h1 id="3-IntSet"><a href="#3-IntSet" class="headerlink" title="3.IntSet"></a>3.IntSet</h1><h2 id="åŸºæœ¬ä»‹ç»-1"><a href="#åŸºæœ¬ä»‹ç»-1" class="headerlink" title="åŸºæœ¬ä»‹ç»"></a>åŸºæœ¬ä»‹ç»</h2><p>IntSetæ˜¯Redisä¸­seté›†åˆçš„ä¸€ç§å®ç°æ–¹å¼ï¼ŒåŸºäºæ•´æ•°æ•°ç»„æ¥å®ç°ï¼Œå¹¶ä¸”å…·å¤‡é•¿åº¦å¯å˜ã€æœ‰åºç­‰ç‰¹å¾ã€‚</p><h2 id="æºç -1"><a href="#æºç -1" class="headerlink" title="æºç "></a>æºç </h2><p>ç»“æ„å¦‚ä¸‹ï¼š</p><p><img src="http://cdn.leesin.fun/typora/s3/img/1653984923322.png" alt="1653984923322"></p><p>å…¶ä¸­çš„encodingåŒ…å«ä¸‰ç§æ¨¡å¼ï¼Œè¡¨ç¤ºå­˜å‚¨çš„æ•´æ•°å¤§å°ä¸åŒï¼š</p><p><img src="http://cdn.leesin.fun/typora/s3/img/1653984942385.png" alt="1653984942385"></p><p>ä¸ºäº†æ–¹ä¾¿æŸ¥æ‰¾ï¼ŒRedisä¼šå°†intsetä¸­æ‰€æœ‰çš„æ•´æ•°æŒ‰ç…§å‡åºä¾æ¬¡ä¿å­˜åœ¨contentsæ•°ç»„ä¸­ï¼Œç»“æ„å¦‚å›¾ï¼š</p><p><img src="http://cdn.leesin.fun/typora/s3/img/image-20230329105017965.png" alt="image-20230329105017965"></p><h2 id="IntSetå‡çº§"><a href="#IntSetå‡çº§" class="headerlink" title="IntSetå‡çº§"></a>IntSetå‡çº§</h2><p>ç°åœ¨ï¼Œæ•°ç»„ä¸­æ¯ä¸ªæ•°å­—éƒ½åœ¨int16_tçš„èŒƒå›´å†…ï¼Œå› æ­¤é‡‡ç”¨çš„ç¼–ç æ–¹å¼æ˜¯INTSET_ENC_INT16ï¼Œæ¯éƒ¨åˆ†å ç”¨çš„å­—èŠ‚å¤§å°ä¸ºï¼š</p><blockquote><p>encodingï¼š4å­—èŠ‚<br>lengthï¼š4å­—èŠ‚<br>contentsï¼š2å­—èŠ‚ * 3  = 6å­—èŠ‚</p></blockquote><p><img src="http://cdn.leesin.fun/typora/s3/img/image-20230329105142575.png" alt="image-20230329105142575"></p><p>æˆ‘ä»¬å‘è¯¥å…¶ä¸­æ·»åŠ ä¸€ä¸ªæ•°å­—ï¼š50000ï¼Œè¿™ä¸ªæ•°å­—è¶…å‡ºäº†int16_tçš„èŒƒå›´ï¼Œintsetä¼šè‡ªåŠ¨<strong>å‡çº§</strong>ç¼–ç æ–¹å¼åˆ°åˆé€‚çš„å¤§å°ã€‚<br>ä»¥å½“å‰æ¡ˆä¾‹æ¥è¯´æµç¨‹å¦‚ä¸‹ï¼š</p><ul><li>å‡çº§ç¼–ç ä¸ºINTSET_ENC_INT32, æ¯ä¸ªæ•´æ•°å 4å­—èŠ‚ï¼Œå¹¶æŒ‰ç…§æ–°çš„ç¼–ç æ–¹å¼åŠå…ƒç´ ä¸ªæ•°æ‰©å®¹æ•°ç»„</li><li>å€’åºä¾æ¬¡å°†æ•°ç»„ä¸­çš„å…ƒç´ æ‹·è´åˆ°æ‰©å®¹åçš„æ­£ç¡®ä½ç½®</li><li>å°†å¾…æ·»åŠ çš„å…ƒç´ æ”¾å…¥æ•°ç»„æœ«å°¾</li><li>æœ€åï¼Œå°†insetçš„encodingå±æ€§æ”¹ä¸ºINTSET_ENC_INT32ï¼Œå°†lengthå±æ€§æ”¹ä¸º4</li></ul><p><img src="http://cdn.leesin.fun/typora/s3/img/image-20230329105224462.png" alt="image-20230329105224462"></p><h2 id="IntSetæ–°å¢æµç¨‹ï¼ˆæºç ï¼‰"><a href="#IntSetæ–°å¢æµç¨‹ï¼ˆæºç ï¼‰" class="headerlink" title="IntSetæ–°å¢æµç¨‹ï¼ˆæºç ï¼‰"></a>IntSetæ–°å¢æµç¨‹ï¼ˆæºç ï¼‰</h2><p><img src="http://cdn.leesin.fun/typora/s3/img/image-20230329105252842.png" alt="image-20230329105252842"></p><p><img src="http://cdn.leesin.fun/typora/s3/img/image-20230329105258508.png" alt="image-20230329105258508"></p><h2 id="æ€»ç»“-1"><a href="#æ€»ç»“-1" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>Intsetå¯ä»¥çœ‹åšæ˜¯ç‰¹æ®Šçš„æ•´æ•°æ•°ç»„ï¼Œå…·å¤‡ä¸€äº›ç‰¹ç‚¹ï¼š</p><ul><li>Redisä¼šç¡®ä¿Intsetä¸­çš„å…ƒç´ å”¯ä¸€ã€æœ‰åº</li><li>å…·å¤‡ç±»å‹å‡çº§æœºåˆ¶ï¼Œå¯ä»¥èŠ‚çœå†…å­˜ç©ºé—´</li><li>åº•å±‚é‡‡ç”¨äºŒåˆ†æŸ¥æ‰¾æ–¹å¼æ¥æŸ¥è¯¢</li></ul><h1 id="4-Dict"><a href="#4-Dict" class="headerlink" title="4.Dict"></a>4.Dict</h1><h2 id="åŸºæœ¬ä»‹ç»-2"><a href="#åŸºæœ¬ä»‹ç»-2" class="headerlink" title="åŸºæœ¬ä»‹ç»"></a>åŸºæœ¬ä»‹ç»</h2><p>æˆ‘ä»¬çŸ¥é“Redisæ˜¯ä¸€ä¸ªé”®å€¼å‹ï¼ˆKey-Value Pairï¼‰çš„æ•°æ®åº“ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®é”®å®ç°å¿«é€Ÿçš„å¢åˆ æ”¹æŸ¥ã€‚è€Œé”®ä¸å€¼çš„æ˜ å°„å…³ç³»æ­£æ˜¯é€šè¿‡Dictæ¥å®ç°çš„ã€‚<br>Dictç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼Œåˆ†åˆ«æ˜¯ï¼šå“ˆå¸Œè¡¨ï¼ˆDictHashTableï¼‰ã€å“ˆå¸ŒèŠ‚ç‚¹ï¼ˆDictEntryï¼‰ã€å­—å…¸ï¼ˆDictï¼‰</p><p>å½“æˆ‘ä»¬å‘Dictæ·»åŠ é”®å€¼å¯¹æ—¶ï¼ŒRedisé¦–å…ˆæ ¹æ®keyè®¡ç®—å‡ºhashå€¼ï¼ˆhï¼‰ï¼Œç„¶ååˆ©ç”¨ h &amp; sizemaskæ¥è®¡ç®—å…ƒç´ åº”è¯¥å­˜å‚¨åˆ°æ•°ç»„ä¸­çš„å“ªä¸ªç´¢å¼•ä½ç½®ã€‚</p><p>æˆ‘ä»¬å­˜å‚¨k1=v1ï¼Œå‡è®¾k1çš„å“ˆå¸Œå€¼h =1ï¼Œåˆ™1&amp;3 =1ï¼Œå› æ­¤k1=v1è¦å­˜å‚¨åˆ°æ•°ç»„è§’æ ‡1ä½ç½®ã€‚</p><p><img src="http://cdn.leesin.fun/typora/s3/img/1653985497735.png" alt="1653985497735"></p><p>Dictç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼Œåˆ†åˆ«æ˜¯ï¼šå“ˆå¸Œè¡¨ï¼ˆDictHashTableï¼‰ã€å“ˆå¸ŒèŠ‚ç‚¹ï¼ˆDictEntryï¼‰ã€å­—å…¸ï¼ˆDictï¼‰</p><p><img src="http://cdn.leesin.fun/typora/s3/img/1653985570612.png" alt="1653985570612"></p><p><img src="http://cdn.leesin.fun/typora/s3/img/image-20230329105507913.png" alt="image-20230329105507913"></p><h2 id="Dictçš„æ‰©å®¹"><a href="#Dictçš„æ‰©å®¹" class="headerlink" title="Dictçš„æ‰©å®¹"></a>Dictçš„æ‰©å®¹</h2><p>Dictä¸­çš„HashTableå°±æ˜¯æ•°ç»„ç»“åˆå•å‘é“¾è¡¨çš„å®ç°ï¼Œå½“é›†åˆä¸­å…ƒç´ è¾ƒå¤šæ—¶ï¼Œå¿…ç„¶å¯¼è‡´å“ˆå¸Œå†²çªå¢å¤šï¼Œé“¾è¡¨è¿‡é•¿ï¼Œåˆ™æŸ¥è¯¢æ•ˆç‡ä¼šå¤§å¤§é™ä½ã€‚<br>Dictåœ¨æ¯æ¬¡æ–°å¢é”®å€¼å¯¹æ—¶éƒ½ä¼šæ£€æŸ¥è´Ÿè½½å› å­ï¼ˆLoadFactor = used/sizeï¼‰ ï¼Œæ»¡è¶³ä»¥ä¸‹ä¸¤ç§æƒ…å†µæ—¶ä¼šè§¦å‘å“ˆå¸Œè¡¨æ‰©å®¹ï¼š<br>å“ˆå¸Œè¡¨çš„ LoadFactor &gt;= 1ï¼Œå¹¶ä¸”æœåŠ¡å™¨æ²¡æœ‰æ‰§è¡Œ BGSAVE æˆ–è€… BGREWRITEAOF ç­‰åå°è¿›ç¨‹ï¼›<br>å“ˆå¸Œè¡¨çš„ LoadFactor &gt; 5 ï¼›</p><p><img src="http://cdn.leesin.fun/typora/s3/img/1653985716275.png" alt="1653985716275"></p><p><img src="http://cdn.leesin.fun/typora/s3/img/1653985743412.png" alt="1653985743412"></p><h2 id="Dictçš„rehash"><a href="#Dictçš„rehash" class="headerlink" title="Dictçš„rehash"></a>Dictçš„rehash</h2><p>ä¸ç®¡æ˜¯æ‰©å®¹è¿˜æ˜¯æ”¶ç¼©ï¼Œå¿…å®šä¼šåˆ›å»ºæ–°çš„å“ˆå¸Œè¡¨ï¼Œå¯¼è‡´å“ˆå¸Œè¡¨çš„sizeå’Œsizemaskå˜åŒ–ï¼Œè€Œkeyçš„æŸ¥è¯¢ä¸sizemaskæœ‰å…³ã€‚å› æ­¤å¿…é¡»å¯¹å“ˆå¸Œè¡¨ä¸­çš„æ¯ä¸€ä¸ªkeyé‡æ–°è®¡ç®—ç´¢å¼•ï¼Œæ’å…¥æ–°çš„å“ˆå¸Œè¡¨ï¼Œè¿™ä¸ªè¿‡ç¨‹ç§°ä¸ºrehashã€‚è¿‡ç¨‹æ˜¯è¿™æ ·çš„ï¼š</p><ul><li><p>è®¡ç®—æ–°hashè¡¨çš„realeSizeï¼Œå€¼å–å†³äºå½“å‰è¦åšçš„æ˜¯æ‰©å®¹è¿˜æ˜¯æ”¶ç¼©ï¼š</p><ul><li>å¦‚æœæ˜¯æ‰©å®¹ï¼Œåˆ™æ–°sizeä¸ºç¬¬ä¸€ä¸ªå¤§äºç­‰äºdict.ht[0].used + 1çš„2^n</li><li>å¦‚æœæ˜¯æ”¶ç¼©ï¼Œåˆ™æ–°sizeä¸ºç¬¬ä¸€ä¸ªå¤§äºç­‰äºdict.ht[0].usedçš„2^n ï¼ˆä¸å¾—å°äº4ï¼‰</li></ul></li><li><p>æŒ‰ç…§æ–°çš„realeSizeç”³è¯·å†…å­˜ç©ºé—´ï¼Œåˆ›å»ºdicthtï¼Œå¹¶èµ‹å€¼ç»™dict.ht[1]</p></li><li>è®¾ç½®dict.rehashidx = 0ï¼Œæ ‡ç¤ºå¼€å§‹rehash</li><li>å°†dict.ht[0]ä¸­çš„æ¯ä¸€ä¸ªdictEntryéƒ½rehashåˆ°dict.ht[1]</li><li>å°†dict.ht[1]èµ‹å€¼ç»™dict.ht[0]ï¼Œç»™dict.ht[1]åˆå§‹åŒ–ä¸ºç©ºå“ˆå¸Œè¡¨ï¼Œé‡Šæ”¾åŸæ¥çš„dict.ht[0]çš„å†…å­˜</li><li>å°†rehashidxèµ‹å€¼ä¸º-1ï¼Œä»£è¡¨rehashç»“æŸ</li><li>åœ¨rehashè¿‡ç¨‹ä¸­ï¼Œæ–°å¢æ“ä½œï¼Œåˆ™ç›´æ¥å†™å…¥ht[1]ï¼ŒæŸ¥è¯¢ã€ä¿®æ”¹å’Œåˆ é™¤åˆ™ä¼šåœ¨dict.ht[0]å’Œdict.ht[1]ä¾æ¬¡æŸ¥æ‰¾å¹¶æ‰§è¡Œã€‚è¿™æ ·å¯ä»¥ç¡®ä¿ht[0]çš„æ•°æ®åªå‡ä¸å¢ï¼Œéšç€rehashæœ€ç»ˆä¸ºç©º</li></ul><p>æ•´ä¸ªè¿‡ç¨‹å¯ä»¥æè¿°æˆï¼š</p><p><img src="http://cdn.leesin.fun/typora/s3/img/1653985824540.png" alt="1653985824540"></p><h2 id="æ€»ç»“-2"><a href="#æ€»ç»“-2" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>Dictçš„ç»“æ„ï¼š</p><ul><li>ç±»ä¼¼javaçš„HashTableï¼Œåº•å±‚æ˜¯æ•°ç»„åŠ é“¾è¡¨æ¥è§£å†³å“ˆå¸Œå†²çª</li><li>DictåŒ…å«ä¸¤ä¸ªå“ˆå¸Œè¡¨ï¼Œht[0]å¹³å¸¸ç”¨ï¼Œht[1]ç”¨æ¥rehash</li></ul><p>Dictçš„ä¼¸ç¼©ï¼š</p><ul><li>å½“LoadFactorå¤§äº5æˆ–è€…LoadFactorå¤§äº1å¹¶ä¸”æ²¡æœ‰å­è¿›ç¨‹ä»»åŠ¡æ—¶ï¼ŒDictæ‰©å®¹</li><li>å½“LoadFactorå°äº0.1æ—¶ï¼ŒDictæ”¶ç¼©</li><li>æ‰©å®¹å¤§å°ä¸ºç¬¬ä¸€ä¸ªå¤§äºç­‰äºused + 1çš„2^n</li><li>æ”¶ç¼©å¤§å°ä¸ºç¬¬ä¸€ä¸ªå¤§äºç­‰äºused çš„2^n</li><li><strong>Dicté‡‡ç”¨æ¸è¿›å¼rehashï¼Œæ¯æ¬¡è®¿é—®Dictæ—¶æ‰§è¡Œä¸€æ¬¡rehash</strong></li><li>rehashæ—¶ht[0]åªå‡ä¸å¢ï¼Œæ–°å¢æ“ä½œåªåœ¨ht[1]æ‰§è¡Œï¼Œå…¶å®ƒæ“ä½œåœ¨ä¸¤ä¸ªå“ˆå¸Œè¡¨</li></ul><h1 id="5-ZipList"><a href="#5-ZipList" class="headerlink" title="5.ZipList"></a>5.ZipList</h1><h2 id="åŸºæœ¬ä»‹ç»-3"><a href="#åŸºæœ¬ä»‹ç»-3" class="headerlink" title="åŸºæœ¬ä»‹ç»"></a>åŸºæœ¬ä»‹ç»</h2><p>ZipList æ˜¯ä¸€ç§ç‰¹æ®Šçš„â€œåŒç«¯é“¾è¡¨â€ ï¼Œç”±ä¸€ç³»åˆ—ç‰¹æ®Šç¼–ç çš„è¿ç»­å†…å­˜å—ç»„æˆã€‚å¯ä»¥åœ¨ä»»æ„ä¸€ç«¯è¿›è¡Œå‹å…¥/å¼¹å‡ºæ“ä½œ, å¹¶ä¸”è¯¥æ“ä½œçš„æ—¶é—´å¤æ‚åº¦ä¸º O(1)ã€‚</p><p><img src="http://cdn.leesin.fun/typora/s3/img/ZipListç»“æ„å›¾.png" alt="ZipListç»“æ„å›¾"></p><div class="table-container"><table><thead><tr><th style="text-align:center"><strong>å±æ€§</strong></th><th style="text-align:center"><strong>ç±»å‹</strong></th><th style="text-align:center"><strong>é•¿åº¦</strong></th><th style="text-align:center"><strong>ç”¨é€”</strong></th></tr></thead><tbody><tr><td style="text-align:center">zlbytes</td><td style="text-align:center">uint32_t</td><td style="text-align:center">4 å­—èŠ‚</td><td style="text-align:center">è®°å½•æ•´ä¸ªå‹ç¼©åˆ—è¡¨å ç”¨çš„å†…å­˜å­—èŠ‚æ•°</td></tr><tr><td style="text-align:center">zltail</td><td style="text-align:center">uint32_t</td><td style="text-align:center">4 å­—èŠ‚</td><td style="text-align:center">è®°å½•å‹ç¼©åˆ—è¡¨è¡¨å°¾èŠ‚ç‚¹è·ç¦»å‹ç¼©åˆ—è¡¨çš„èµ·å§‹åœ°å€æœ‰å¤šå°‘å­—èŠ‚ï¼Œé€šè¿‡è¿™ä¸ªåç§»é‡ï¼Œå¯ä»¥ç¡®å®šè¡¨å°¾èŠ‚ç‚¹çš„åœ°å€ã€‚</td></tr><tr><td style="text-align:center">zllen</td><td style="text-align:center">uint16_t</td><td style="text-align:center">2 å­—èŠ‚</td><td style="text-align:center">è®°å½•äº†å‹ç¼©åˆ—è¡¨åŒ…å«çš„èŠ‚ç‚¹æ•°é‡ã€‚ æœ€å¤§å€¼ä¸ºUINT16_MAX ï¼ˆ65534ï¼‰ï¼Œå¦‚æœè¶…è¿‡è¿™ä¸ªå€¼ï¼Œæ­¤å¤„ä¼šè®°å½•ä¸º65535ï¼Œä½†èŠ‚ç‚¹çš„çœŸå®æ•°é‡éœ€è¦éå†æ•´ä¸ªå‹ç¼©åˆ—è¡¨æ‰èƒ½è®¡ç®—å¾—å‡ºã€‚</td></tr><tr><td style="text-align:center">entry</td><td style="text-align:center">åˆ—è¡¨èŠ‚ç‚¹</td><td style="text-align:center">ä¸å®š</td><td style="text-align:center">å‹ç¼©åˆ—è¡¨åŒ…å«çš„å„ä¸ªèŠ‚ç‚¹ï¼ŒèŠ‚ç‚¹çš„é•¿åº¦ç”±èŠ‚ç‚¹ä¿å­˜çš„å†…å®¹å†³å®šã€‚</td></tr><tr><td style="text-align:center">zlend</td><td style="text-align:center">uint8_t</td><td style="text-align:center">1 å­—èŠ‚</td><td style="text-align:center">ç‰¹æ®Šå€¼ 0xFF ï¼ˆåè¿›åˆ¶ 255 ï¼‰ï¼Œç”¨äºæ ‡è®°å‹ç¼©åˆ—è¡¨çš„æœ«ç«¯ã€‚</td></tr></tbody></table></div><h2 id="ZipListEntry"><a href="#ZipListEntry" class="headerlink" title="ZipListEntry"></a>ZipListEntry</h2><p>ZipList ä¸­çš„Entryå¹¶ä¸åƒæ™®é€šé“¾è¡¨é‚£æ ·è®°å½•å‰åèŠ‚ç‚¹çš„æŒ‡é’ˆï¼Œ<strong>å› ä¸ºè®°å½•ä¸¤ä¸ªæŒ‡é’ˆè¦å ç”¨16ä¸ªå­—èŠ‚ï¼Œæµªè´¹å†…å­˜</strong>ã€‚è€Œæ˜¯é‡‡ç”¨äº†ä¸‹é¢çš„ç»“æ„ï¼š</p><p><img src="http://cdn.leesin.fun/typora/s3/img/1653986055253.png" alt="1653986055253"></p><ul><li><p>previous_entry_lengthï¼šå‰ä¸€èŠ‚ç‚¹çš„é•¿åº¦ï¼Œå 1ä¸ªæˆ–5ä¸ªå­—èŠ‚ã€‚</p><ul><li>å¦‚æœå‰ä¸€èŠ‚ç‚¹çš„é•¿åº¦å°äº254å­—èŠ‚ï¼Œåˆ™é‡‡ç”¨1ä¸ªå­—èŠ‚æ¥ä¿å­˜è¿™ä¸ªé•¿åº¦å€¼</li><li>å¦‚æœå‰ä¸€èŠ‚ç‚¹çš„é•¿åº¦å¤§äº254å­—èŠ‚ï¼Œåˆ™é‡‡ç”¨5ä¸ªå­—èŠ‚æ¥ä¿å­˜è¿™ä¸ªé•¿åº¦å€¼ï¼Œç¬¬ä¸€ä¸ªå­—èŠ‚ä¸º0xfeï¼Œåå››ä¸ªå­—èŠ‚æ‰æ˜¯çœŸå®é•¿åº¦æ•°æ®</li></ul></li><li><p>encodingï¼šç¼–ç å±æ€§ï¼Œè®°å½•contentçš„æ•°æ®ç±»å‹ï¼ˆå­—ç¬¦ä¸²è¿˜æ˜¯æ•´æ•°ï¼‰ä»¥åŠé•¿åº¦ï¼Œå ç”¨1ä¸ªã€2ä¸ªæˆ–5ä¸ªå­—èŠ‚</p></li><li>contentsï¼šè´Ÿè´£ä¿å­˜èŠ‚ç‚¹çš„æ•°æ®ï¼Œå¯ä»¥æ˜¯å­—ç¬¦ä¸²æˆ–æ•´æ•°</li></ul><p>ZipListä¸­æ‰€æœ‰å­˜å‚¨é•¿åº¦çš„æ•°å€¼å‡é‡‡ç”¨å°ç«¯å­—èŠ‚åºï¼Œå³ä½ä½å­—èŠ‚åœ¨å‰ï¼Œé«˜ä½å­—èŠ‚åœ¨åã€‚ä¾‹å¦‚ï¼šæ•°å€¼0x1234ï¼Œé‡‡ç”¨å°ç«¯å­—èŠ‚åºåå®é™…å­˜å‚¨å€¼ä¸ºï¼š0x3412</p><h3 id="Encodingç¼–ç "><a href="#Encodingç¼–ç " class="headerlink" title="Encodingç¼–ç "></a>Encodingç¼–ç </h3><p>ZipListEntryä¸­çš„encodingç¼–ç åˆ†ä¸ºå­—ç¬¦ä¸²å’Œæ•´æ•°ä¸¤ç§ï¼š<br>å­—ç¬¦ä¸²ï¼šå¦‚æœencodingæ˜¯ä»¥â€œ00â€ã€â€œ01â€æˆ–è€…â€œ10â€å¼€å¤´ï¼Œåˆ™è¯æ˜contentæ˜¯å­—ç¬¦ä¸²</p><div class="table-container"><table><thead><tr><th><strong>ç¼–ç </strong></th><th><strong>ç¼–ç é•¿åº¦</strong></th><th><strong>å­—ç¬¦ä¸²å¤§å°</strong></th></tr></thead><tbody><tr><td>\</td><td>00pppppp\</td><td></td><td>1 bytes</td><td>&lt;= 63 bytes</td></tr><tr><td>\</td><td>01pppppp\</td><td>qqqqqqqq\</td><td></td><td>2 bytes</td><td>&lt;= 16383 bytes</td></tr><tr><td>\</td><td>10000000\</td><td>qqqqqqqq\</td><td>rrrrrrrr\</td><td>ssssssss\</td><td>tttttttt\</td><td></td><td>5 bytes</td><td>&lt;= 4294967295 bytes</td></tr></tbody></table></div><p>ä¾‹å¦‚ï¼Œæˆ‘ä»¬è¦ä¿å­˜å­—ç¬¦ä¸²ï¼šâ€œabâ€å’Œ â€œbcâ€</p><p><img src="http://cdn.leesin.fun/typora/s3/img/image-20230329142258967.png" alt="image-20230329142258967"></p><p> ZipListEntryä¸­çš„encodingç¼–ç åˆ†ä¸º<strong>å­—ç¬¦ä¸²</strong>å’Œ<strong>æ•´æ•°</strong>ä¸¤ç§ï¼š</p><ul><li>æ•´æ•°ï¼šå¦‚æœencodingæ˜¯ä»¥â€œ11â€å¼€å§‹ï¼Œåˆ™è¯æ˜contentæ˜¯æ•´æ•°ï¼Œä¸”encodingå›ºå®šåªå ç”¨1ä¸ªå­—èŠ‚</li></ul><div class="table-container"><table><thead><tr><th><strong>ç¼–ç </strong></th><th><strong>ç¼–ç é•¿åº¦</strong></th><th><strong>æ•´æ•°ç±»å‹</strong></th></tr></thead><tbody><tr><td>11000000</td><td>1</td><td>int16_tï¼ˆ2 bytesï¼‰</td></tr><tr><td>11010000</td><td>1</td><td>int32_tï¼ˆ4 bytesï¼‰</td></tr><tr><td>11100000</td><td>1</td><td>int64_tï¼ˆ8 bytesï¼‰</td></tr><tr><td>11110000</td><td>1</td><td>24ä½æœ‰ç¬¦æ•´æ•°(3 bytes)</td></tr><tr><td>11111110</td><td>1</td><td>8ä½æœ‰ç¬¦æ•´æ•°(1 bytes)</td></tr><tr><td>1111xxxx</td><td>1</td><td>ç›´æ¥åœ¨xxxxä½ç½®ä¿å­˜æ•°å€¼ï¼ŒèŒƒå›´ä»0001~1101ï¼Œå‡1åç»“æœä¸ºå®é™…å€¼</td></tr></tbody></table></div><p>ä¾‹å¦‚ï¼Œä¸€ä¸ªZipListä¸­åŒ…å«ä¸¤ä¸ªæ•´æ•°å€¼ï¼šâ€œ2â€å’Œâ€œ5â€ å¯¹åº”çš„encodingä¸ºâ€œ1111 0011â€ï¼ˆ0xf3ï¼‰å’Œâ€œ1111 0110â€(0xf6)ï¼Œä»–ä»¬æ˜¯æ²¡æœ‰contentçš„</p><p><img src="http://cdn.leesin.fun/typora/s3/img/1653986282879.png" alt="1653986282879"></p><h2 id="ZipListçš„è¿é”æ›´æ–°é—®é¢˜"><a href="#ZipListçš„è¿é”æ›´æ–°é—®é¢˜" class="headerlink" title="ZipListçš„è¿é”æ›´æ–°é—®é¢˜"></a>ZipListçš„è¿é”æ›´æ–°é—®é¢˜</h2><p>ZipListçš„æ¯ä¸ªEntryéƒ½åŒ…å«previous_entry_lengthæ¥è®°å½•ä¸Šä¸€ä¸ªèŠ‚ç‚¹çš„å¤§å°ï¼Œé•¿åº¦æ˜¯1ä¸ªæˆ–5ä¸ªå­—èŠ‚ï¼š<br>å¦‚æœå‰ä¸€èŠ‚ç‚¹çš„é•¿åº¦å°äº254å­—èŠ‚ï¼Œåˆ™é‡‡ç”¨1ä¸ªå­—èŠ‚æ¥ä¿å­˜è¿™ä¸ªé•¿åº¦å€¼<br>å¦‚æœå‰ä¸€èŠ‚ç‚¹çš„é•¿åº¦å¤§äºç­‰äº254å­—èŠ‚ï¼Œåˆ™é‡‡ç”¨5ä¸ªå­—èŠ‚æ¥ä¿å­˜è¿™ä¸ªé•¿åº¦å€¼ï¼Œç¬¬ä¸€ä¸ªå­—èŠ‚ä¸º0xfeï¼Œåå››ä¸ªå­—èŠ‚æ‰æ˜¯çœŸå®é•¿åº¦æ•°æ®<br>ç°åœ¨ï¼Œå‡è®¾æˆ‘ä»¬æœ‰Nä¸ªè¿ç»­çš„ã€é•¿åº¦ä¸º250~253å­—èŠ‚ä¹‹é—´çš„entryï¼Œå› æ­¤entryçš„previous_entry_lengthå±æ€§ç”¨1ä¸ªå­—èŠ‚å³å¯è¡¨ç¤ºï¼Œå¦‚å›¾æ‰€ç¤ºï¼š</p><p><img src="http://cdn.leesin.fun/typora/s3/img/1653986328124.png" alt="1653986328124"></p><p>ZipListè¿™ç§ç‰¹æ®Šæƒ…å†µä¸‹äº§ç”Ÿçš„è¿ç»­å¤šæ¬¡ç©ºé—´æ‰©å±•æ“ä½œç§°ä¹‹ä¸ºè¿é”æ›´æ–°ï¼ˆCascade Updateï¼‰ã€‚æ–°å¢ã€åˆ é™¤éƒ½å¯èƒ½å¯¼è‡´è¿é”æ›´æ–°çš„å‘ç”Ÿã€‚</p><h2 id="æ€»ç»“-3"><a href="#æ€»ç»“-3" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p><strong>ZipListç‰¹æ€§ï¼š</strong></p><ul><li>å‹ç¼©åˆ—è¡¨çš„å¯ä»¥çœ‹åšä¸€ç§è¿ç»­å†…å­˜ç©ºé—´çš„â€åŒå‘é“¾è¡¨â€</li><li>åˆ—è¡¨çš„èŠ‚ç‚¹ä¹‹é—´ä¸æ˜¯é€šè¿‡æŒ‡é’ˆè¿æ¥ï¼Œè€Œæ˜¯è®°å½•ä¸Šä¸€èŠ‚ç‚¹å’Œæœ¬èŠ‚ç‚¹é•¿åº¦æ¥å¯»å€ï¼Œå†…å­˜å ç”¨è¾ƒä½</li><li>å¦‚æœåˆ—è¡¨æ•°æ®è¿‡å¤šï¼Œå¯¼è‡´é“¾è¡¨è¿‡é•¿ï¼Œå¯èƒ½å½±å“æŸ¥è¯¢æ€§èƒ½</li><li>å¢æˆ–åˆ è¾ƒå¤§æ•°æ®æ—¶æœ‰å¯èƒ½å‘ç”Ÿè¿ç»­æ›´æ–°é—®é¢˜ï¼ˆè¿é”å‡çº§é—®é¢˜ï¼‰</li></ul><h1 id="6-QuickList"><a href="#6-QuickList" class="headerlink" title="6.QuickList"></a>6.QuickList</h1><h2 id="åŸºæœ¬ä»‹ç»-4"><a href="#åŸºæœ¬ä»‹ç»-4" class="headerlink" title="åŸºæœ¬ä»‹ç»"></a>åŸºæœ¬ä»‹ç»</h2><p>é—®é¢˜1ï¼šZipListè™½ç„¶èŠ‚çœå†…å­˜ï¼Œä½†ç”³è¯·å†…å­˜å¿…é¡»æ˜¯è¿ç»­ç©ºé—´ï¼Œå¦‚æœå†…å­˜å ç”¨è¾ƒå¤šï¼Œç”³è¯·å†…å­˜æ•ˆç‡å¾ˆä½ã€‚æ€ä¹ˆåŠï¼Ÿ</p><p>â€‹    ç­”ï¼šä¸ºäº†ç¼“è§£è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¿…é¡»é™åˆ¶ZipListçš„é•¿åº¦å’Œentryå¤§å°ã€‚</p><p>é—®é¢˜2ï¼šä½†æ˜¯æˆ‘ä»¬è¦å­˜å‚¨å¤§é‡æ•°æ®ï¼Œè¶…å‡ºäº†ZipListæœ€ä½³çš„ä¸Šé™è¯¥æ€ä¹ˆåŠï¼Ÿ</p><p>â€‹    ç­”ï¼šæˆ‘ä»¬å¯ä»¥åˆ›å»ºå¤šä¸ªZipListæ¥åˆ†ç‰‡å­˜å‚¨æ•°æ®ã€‚</p><p>é—®é¢˜3ï¼šæ•°æ®æ‹†åˆ†åæ¯”è¾ƒåˆ†æ•£ï¼Œä¸æ–¹ä¾¿ç®¡ç†å’ŒæŸ¥æ‰¾ï¼Œè¿™å¤šä¸ªZipListå¦‚ä½•å»ºç«‹è”ç³»ï¼Ÿ</p><p>â€‹    ç­”ï¼šRedisåœ¨3.2ç‰ˆæœ¬å¼•å…¥äº†æ–°çš„æ•°æ®ç»“æ„QuickListï¼Œå®ƒæ˜¯ä¸€ä¸ªåŒç«¯é“¾è¡¨ï¼Œåªä¸è¿‡é“¾è¡¨ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹éƒ½æ˜¯ä¸€ä¸ªZipListã€‚</p><p><img src="http://cdn.leesin.fun/typora/s3/img/image-20230329142805328.png" alt="image-20230329142805328"></p><p>ä¸ºäº†é¿å…QuickListä¸­çš„æ¯ä¸ªZipListä¸­entryè¿‡å¤šï¼ŒRedisæä¾›äº†ä¸€ä¸ªé…ç½®é¡¹ï¼šlist-max-ziplist-sizeæ¥é™åˆ¶ã€‚</p><ul><li>å¦‚æœå€¼ä¸ºæ­£ï¼Œåˆ™ä»£è¡¨ZipListçš„å…è®¸çš„entryä¸ªæ•°çš„æœ€å¤§å€¼</li><li>å¦‚æœå€¼ä¸ºè´Ÿï¼Œåˆ™ä»£è¡¨ZipListçš„æœ€å¤§å†…å­˜å¤§å°ï¼Œåˆ†5ç§æƒ…å†µï¼š<ul><li>-1ï¼šæ¯ä¸ªZipListçš„å†…å­˜å ç”¨ä¸èƒ½è¶…è¿‡4kb</li><li>-2ï¼šæ¯ä¸ªZipListçš„å†…å­˜å ç”¨ä¸èƒ½è¶…è¿‡8kb</li><li>-3ï¼šæ¯ä¸ªZipListçš„å†…å­˜å ç”¨ä¸èƒ½è¶…è¿‡16kb</li><li>-4ï¼šæ¯ä¸ªZipListçš„å†…å­˜å ç”¨ä¸èƒ½è¶…è¿‡32kb</li><li>-5ï¼šæ¯ä¸ªZipListçš„å†…å­˜å ç”¨ä¸èƒ½è¶…è¿‡64kb</li></ul></li></ul><p>å…¶é»˜è®¤å€¼ä¸º -2ï¼š</p><p><img src="http://cdn.leesin.fun/typora/s3/img/image-20230329142848293.png" alt="image-20230329142848293"></p><h2 id="æºç -2"><a href="#æºç -2" class="headerlink" title="æºç "></a>æºç </h2><p>ä»¥ä¸‹æ˜¯QuickListçš„å’ŒQuickListNodeçš„ç»“æ„æºç ï¼š</p><p><img src="http://cdn.leesin.fun/typora/s3/img/1653986667228.png" alt="1653986667228"></p><p>æˆ‘ä»¬æ¥ä¸‹æ¥ç”¨ä¸€æ®µæµç¨‹å›¾æ¥æè¿°å½“å‰çš„è¿™ä¸ªç»“æ„</p><p><img src="http://cdn.leesin.fun/typora/s3/img/1653986718554.png" alt="1653986718554"></p><h2 id="æ€»ç»“-4"><a href="#æ€»ç»“-4" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>QuickListçš„ç‰¹ç‚¹ï¼š</p><ul><li>æ˜¯ä¸€ä¸ªèŠ‚ç‚¹ä¸ºZipListçš„åŒç«¯é“¾è¡¨</li><li>èŠ‚ç‚¹é‡‡ç”¨ZipListï¼Œè§£å†³äº†ä¼ ç»Ÿé“¾è¡¨çš„å†…å­˜å ç”¨é—®é¢˜</li><li>æ§åˆ¶äº†ZipListå¤§å°ï¼Œè§£å†³è¿ç»­å†…å­˜ç©ºé—´ç”³è¯·æ•ˆç‡é—®é¢˜</li><li>ä¸­é—´èŠ‚ç‚¹å¯ä»¥å‹ç¼©ï¼Œè¿›ä¸€æ­¥èŠ‚çœäº†å†…å­˜</li></ul><h1 id="7-SkipList"><a href="#7-SkipList" class="headerlink" title="7.SkipList"></a>7.SkipList</h1><p>SkipListï¼ˆè·³è¡¨ï¼‰é¦–å…ˆæ˜¯é“¾è¡¨ï¼Œä½†ä¸ä¼ ç»Ÿé“¾è¡¨ç›¸æ¯”æœ‰å‡ ç‚¹å·®å¼‚ï¼š</p><ul><li>å…ƒç´ æŒ‰ç…§å‡åºæ’åˆ—å­˜å‚¨</li><li>èŠ‚ç‚¹å¯èƒ½åŒ…å«å¤šä¸ªæŒ‡é’ˆï¼ŒæŒ‡é’ˆè·¨åº¦ä¸åŒã€‚</li></ul><p><img src="http://cdn.leesin.fun/typora/s3/img/è·³è¡¨ç»“æ„.jpg" alt="è·³è¡¨ç»“æ„"></p><h2 id="æºç -3"><a href="#æºç -3" class="headerlink" title="æºç "></a>æºç </h2><p><img src="http://cdn.leesin.fun/typora/s3/img/è·³è¡¨æºç .png" alt="è·³è¡¨æºç "></p><h2 id="ä¸€çº§è·³è¡¨ç»“æ„"><a href="#ä¸€çº§è·³è¡¨ç»“æ„" class="headerlink" title="ä¸€çº§è·³è¡¨ç»“æ„"></a>ä¸€çº§è·³è¡¨ç»“æ„</h2><p><img src="http://cdn.leesin.fun/typora/s3/img/1çº§è·³è¡¨ç»“æ„.png" alt="1çº§è·³è¡¨ç»“æ„"></p><h2 id="å¤šçº§è·³è¡¨ç»“æ„"><a href="#å¤šçº§è·³è¡¨ç»“æ„" class="headerlink" title="å¤šçº§è·³è¡¨ç»“æ„"></a>å¤šçº§è·³è¡¨ç»“æ„</h2><p><img src="http://cdn.leesin.fun/typora/s3/img/å¤šçº§è·³è¡¨ç»“æ„.png" alt="å¤šçº§è·³è¡¨ç»“æ„"></p><h2 id="æ€»ç»“-5"><a href="#æ€»ç»“-5" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>SkipListçš„ç‰¹ç‚¹ï¼š</p><ul><li>è·³è·ƒè¡¨æ˜¯ä¸€ä¸ªåŒå‘é“¾è¡¨ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½åŒ…å«scoreå’Œeleå€¼</li><li>èŠ‚ç‚¹æŒ‰ç…§scoreå€¼æ’åºï¼Œscoreå€¼ä¸€æ ·åˆ™æŒ‰ç…§eleå­—å…¸æ’åº</li><li>æ¯ä¸ªèŠ‚ç‚¹éƒ½å¯ä»¥åŒ…å«å¤šå±‚æŒ‡é’ˆï¼Œå±‚æ•°æ˜¯1åˆ°32ä¹‹é—´çš„éšæœºæ•°</li><li>ä¸åŒå±‚æŒ‡é’ˆåˆ°ä¸‹ä¸€ä¸ªèŠ‚ç‚¹çš„è·¨åº¦ä¸åŒï¼Œå±‚çº§è¶Šé«˜ï¼Œè·¨åº¦è¶Šå¤§</li><li>å¢åˆ æ”¹æŸ¥æ•ˆç‡ä¸çº¢é»‘æ ‘åŸºæœ¬ä¸€è‡´ï¼Œå®ç°å´æ›´ç®€å•</li></ul><h1 id="8-RedisObject"><a href="#8-RedisObject" class="headerlink" title="8.RedisObject"></a>8.RedisObject</h1><h2 id="åŸºæœ¬ä»‹ç»-5"><a href="#åŸºæœ¬ä»‹ç»-5" class="headerlink" title="åŸºæœ¬ä»‹ç»"></a>åŸºæœ¬ä»‹ç»</h2><p>Redisä¸­çš„ä»»æ„æ•°æ®ç±»å‹çš„é”®å’Œå€¼éƒ½ä¼šè¢«å°è£…ä¸ºä¸€ä¸ªRedisObjectï¼Œä¹Ÿå«åšRediså¯¹è±¡ï¼Œæºç å¦‚ä¸‹ï¼š</p><p><img src="http://cdn.leesin.fun/typora/s3/img/image-20230329163444988.png" alt="image-20230329163444988"></p><h2 id="Redisçš„ç¼–ç æ–¹å¼"><a href="#Redisçš„ç¼–ç æ–¹å¼" class="headerlink" title="Redisçš„ç¼–ç æ–¹å¼"></a>Redisçš„ç¼–ç æ–¹å¼</h2><p>Redisä¸­ä¼šæ ¹æ®å­˜å‚¨çš„æ•°æ®ç±»å‹ä¸åŒï¼Œé€‰æ‹©ä¸åŒçš„ç¼–ç æ–¹å¼ï¼Œå…±åŒ…å«11ç§ä¸åŒç±»å‹ï¼š</p><div class="table-container"><table><thead><tr><th><strong>ç¼–å·</strong></th><th><strong>ç¼–ç æ–¹å¼</strong></th><th><strong>è¯´æ˜</strong></th></tr></thead><tbody><tr><td>0</td><td>OBJ_ENCODING_RAW</td><td>rawç¼–ç åŠ¨æ€å­—ç¬¦ä¸²</td></tr><tr><td>1</td><td>OBJ_ENCODING_INT</td><td>longç±»å‹çš„æ•´æ•°çš„å­—ç¬¦ä¸²</td></tr><tr><td>2</td><td>OBJ_ENCODING_HT</td><td>hashè¡¨ï¼ˆå­—å…¸dictï¼‰</td></tr><tr><td>3</td><td>OBJ_ENCODING_ZIPMAP</td><td>å·²åºŸå¼ƒ</td></tr><tr><td>4</td><td>OBJ_ENCODING_LINKEDLIST</td><td>åŒç«¯é“¾è¡¨</td></tr><tr><td>5</td><td>OBJ_ENCODING_ZIPLIST</td><td>å‹ç¼©åˆ—è¡¨</td></tr><tr><td>6</td><td>OBJ_ENCODING_INTSET</td><td>æ•´æ•°é›†åˆ</td></tr><tr><td>7</td><td>OBJ_ENCODING_SKIPLIST</td><td>è·³è¡¨</td></tr><tr><td>8</td><td>OBJ_ENCODING_EMBSTR</td><td>embstrçš„åŠ¨æ€å­—ç¬¦ä¸²</td></tr><tr><td>9</td><td>OBJ_ENCODING_QUICKLIST</td><td>å¿«é€Ÿåˆ—è¡¨</td></tr><tr><td>10</td><td>OBJ_ENCODING_STREAM</td><td>Streamæµ</td></tr></tbody></table></div><h2 id="äº”ç§æ•°æ®ç»“æ„"><a href="#äº”ç§æ•°æ®ç»“æ„" class="headerlink" title="äº”ç§æ•°æ®ç»“æ„"></a>äº”ç§æ•°æ®ç»“æ„</h2><p>Redisä¸­ä¼šæ ¹æ®å­˜å‚¨çš„æ•°æ®ç±»å‹ä¸åŒï¼Œé€‰æ‹©ä¸åŒçš„ç¼–ç æ–¹å¼ã€‚æ¯ç§æ•°æ®ç±»å‹çš„ä½¿ç”¨çš„ç¼–ç æ–¹å¼å¦‚ä¸‹ï¼š</p><div class="table-container"><table><thead><tr><th><strong>æ•°æ®ç±»å‹</strong></th><th><strong>ç¼–ç æ–¹å¼</strong></th></tr></thead><tbody><tr><td>OBJ_STRING</td><td>intã€embstrã€raw</td></tr><tr><td>OBJ_LIST</td><td>LinkedListå’ŒZipList(3.2ä»¥å‰)ã€QuickListï¼ˆ3.2ä»¥åï¼‰</td></tr><tr><td>OBJ_SET</td><td>intsetã€HT</td></tr><tr><td>OBJ_ZSET</td><td>ZipListã€HTã€SkipList</td></tr><tr><td>OBJ_HASH</td><td>ZipListã€HT</td></tr></tbody></table></div><h1 id="9-String"><a href="#9-String" class="headerlink" title="9.String"></a>9.String</h1><p>Stringæ˜¯Redisä¸­æœ€å¸¸è§çš„æ•°æ®å­˜å‚¨ç±»å‹ï¼š</p><ul><li>RAWç¼–ç </li><li>EMBSTRç¼–ç </li><li>INTç¼–ç </li></ul><h2 id="RAWç¼–ç "><a href="#RAWç¼–ç " class="headerlink" title="RAWç¼–ç "></a>RAWç¼–ç </h2><p>StringåŸºæœ¬çš„ç¼–ç æ–¹å¼æ˜¯RAWï¼ŒåŸºäºç®€å•åŠ¨æ€å­—ç¬¦ä¸²ï¼ˆSDSï¼‰å®ç°ï¼Œå­˜å‚¨ä¸Šé™ä¸º512mbã€‚</p><p><img src="http://cdn.leesin.fun/typora/s3/img/image-20230329163845339.png" alt="image-20230329163845339"></p><h2 id="EMBSTRç¼–ç "><a href="#EMBSTRç¼–ç " class="headerlink" title="EMBSTRç¼–ç "></a>EMBSTRç¼–ç </h2><p>å¦‚æœå­˜å‚¨çš„SDSé•¿åº¦<strong>å°äº44å­—èŠ‚</strong>ï¼Œåˆ™ä¼šé‡‡ç”¨EMBSTRç¼–ç ï¼Œæ­¤æ—¶object headä¸SDSæ˜¯ä¸€æ®µè¿ç»­ç©ºé—´ã€‚ç”³è¯·å†…å­˜æ—¶åªéœ€è¦è°ƒç”¨ä¸€æ¬¡å†…å­˜åˆ†é…å‡½æ•°ï¼Œæ•ˆç‡æ›´é«˜ã€‚</p><p><img src="http://cdn.leesin.fun/typora/s3/img/image-20230329164238937.png" alt="image-20230329164238937"></p><p><strong>ä¸ºä»€ä¹ˆæ˜¯44å­—èŠ‚ï¼Ÿ64å­—èŠ‚æ°å¥½æ˜¯redisçš„ä¸€ä¸ªåˆ†ç‰‡å¤§å°ã€‚</strong></p><h2 id="INTç¼–ç "><a href="#INTç¼–ç " class="headerlink" title="INTç¼–ç "></a>INTç¼–ç </h2><p>å¦‚æœå­˜å‚¨çš„å­—ç¬¦ä¸²æ˜¯<strong>æ•´æ•°å€¼</strong>ï¼Œå¹¶ä¸”å¤§å°åœ¨LONG_MAXèŒƒå›´å†…ï¼Œåˆ™ä¼šé‡‡ç”¨<strong>INT</strong>ç¼–ç ï¼šç›´æ¥å°†æ•°æ®ä¿å­˜åœ¨RedisObjectçš„ptræŒ‡é’ˆä½ç½®ï¼ˆåˆšå¥½8å­—èŠ‚ï¼‰ï¼Œä¸å†éœ€è¦SDSäº†ã€‚</p><p><img src="http://cdn.leesin.fun/typora/s3/img/image-20230329164434280.png" alt="image-20230329164434280"></p><h2 id="æ€»ç»“-6"><a href="#æ€»ç»“-6" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p><img src="http://cdn.leesin.fun/typora/s3/img/image-20230329164521535.png" alt="image-20230329164521535"></p><h1 id="10-List"><a href="#10-List" class="headerlink" title="10.List"></a>10.List</h1><p>Redisçš„Listç±»å‹å¯ä»¥ä»é¦–ã€å°¾æ“ä½œåˆ—è¡¨ä¸­çš„å…ƒç´ ã€‚å“ªä¸€ä¸ªæ•°æ®ç»“æ„èƒ½æ»¡è¶³ä¸Šè¿°ç‰¹å¾ï¼Ÿ</p><ul><li>LinkedList ï¼šæ™®é€šé“¾è¡¨ï¼Œå¯ä»¥ä»åŒç«¯è®¿é—®ï¼Œå†…å­˜å ç”¨è¾ƒé«˜ï¼Œå†…å­˜ç¢ç‰‡è¾ƒå¤š</li><li>ZipList ï¼šå‹ç¼©åˆ—è¡¨ï¼Œå¯ä»¥ä»åŒç«¯è®¿é—®ï¼Œå†…å­˜å ç”¨ä½ï¼Œå­˜å‚¨ä¸Šé™ä½</li><li>QuickListï¼šLinkedList + ZipListï¼Œå¯ä»¥ä»åŒç«¯è®¿é—®ï¼Œå†…å­˜å ç”¨è¾ƒä½ï¼ŒåŒ…å«å¤šä¸ªZipListï¼Œå­˜å‚¨ä¸Šé™é«˜</li></ul><p>Redisçš„Listç»“æ„ç±»ä¼¼ä¸€ä¸ªåŒç«¯é“¾è¡¨ï¼Œå¯ä»¥ä»é¦–ã€å°¾æ“ä½œåˆ—è¡¨ä¸­çš„å…ƒç´ ï¼š</p><p>åœ¨3.2ç‰ˆæœ¬ä¹‹å‰ï¼ŒRedisé‡‡ç”¨ZipListå’ŒLinkedListæ¥å®ç°Listï¼Œå½“å…ƒç´ æ•°é‡å°äº512å¹¶ä¸”å…ƒç´ å¤§å°å°äº64å­—èŠ‚æ—¶é‡‡ç”¨ZipListç¼–ç ï¼Œè¶…è¿‡åˆ™é‡‡ç”¨LinkedListç¼–ç ã€‚</p><p>åœ¨3.2ç‰ˆæœ¬ä¹‹åï¼ŒRedisç»Ÿä¸€é‡‡ç”¨QuickListæ¥å®ç°Listï¼š</p><p><img src="http://cdn.leesin.fun/typora/s3/img/image-20230329164708011.png" alt="image-20230329164708011"></p><h1 id="11-Set"><a href="#11-Set" class="headerlink" title="11.Set"></a>11.Set</h1><p>Setæ˜¯Redisä¸­çš„é›†åˆï¼Œä¸ä¸€å®šç¡®ä¿å…ƒç´ æœ‰åºï¼Œå¯ä»¥æ»¡è¶³å…ƒç´ å”¯ä¸€ã€æŸ¥è¯¢æ•ˆç‡è¦æ±‚æé«˜ã€‚</p><ul><li>å½“å­˜å‚¨çš„æ‰€æœ‰æ•°æ®<strong>éƒ½æ˜¯æ•´æ•°</strong>ï¼Œå¹¶ä¸”å…ƒç´ æ•°é‡ä¸è¶…è¿‡set-max-intset-entriesï¼ˆé…ç½®æ–‡ä»¶é…ç½®ï¼‰æ—¶ï¼ŒSetä¼šé‡‡ç”¨IntSetç¼–ç ï¼Œä»¥èŠ‚çœå†…å­˜ã€‚<ul><li>ä¾‹å¦‚ï¼Œä¸€ä¸ªSetåªæ·»åŠ äº†ä¸‰ä¸ªæ•´æ•°å…ƒç´ ï¼Œç»“æ„å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</li></ul></li></ul><p><img src="http://cdn.leesin.fun/typora/s3/img/image-20230329170745910.png" alt="image-20230329170745910"></p><ul><li>ä¸ºäº†æŸ¥è¯¢æ•ˆç‡å’Œå”¯ä¸€æ€§ï¼Œseté‡‡ç”¨HTç¼–ç ï¼ˆDictï¼‰ã€‚Dictä¸­çš„keyç”¨æ¥å­˜å‚¨å…ƒç´ ï¼Œvalueç»Ÿä¸€ä¸ºnullã€‚<ul><li>ä¾‹å¦‚ï¼Œå½“ä¸Šè¿°çš„Setï¼Œæ·»åŠ äº†ä¸€ä¸ªéæ•´æ•°çš„å…ƒç´ ä¹‹åï¼Œåº•å±‚æ•°æ®ç»“æ„ä¼šä»IntSetå˜æˆDict</li></ul></li></ul><p><img src="http://cdn.leesin.fun/typora/s3/img/image-20230329171403161.png" alt="image-20230329171403161"></p><h2 id="æºç -4"><a href="#æºç -4" class="headerlink" title="æºç "></a>æºç </h2><p>Dictå’ŒIntSetçš„é€‰æ‹©</p><p><img src="http://cdn.leesin.fun/typora/s3/img/image-20230329170924001.png" alt="image-20230329170924001"></p><p>æ·»åŠ å…ƒç´ æ—¶çš„é€»è¾‘</p><p><img src="http://cdn.leesin.fun/typora/s3/img/image-20230329171002576.png" alt="image-20230329171002576"></p><h1 id="12-ZSet"><a href="#12-ZSet" class="headerlink" title="12.ZSet"></a>12.ZSet</h1><p>ZSetä¹Ÿå°±æ˜¯SortedSetï¼Œå…¶ä¸­æ¯ä¸€ä¸ªå…ƒç´ éƒ½éœ€è¦æŒ‡å®šä¸€ä¸ªscoreå€¼å’Œmemberå€¼ï¼š</p><ul><li>å¯ä»¥æ ¹æ®scoreå€¼æ’åºå</li><li>memberå¿…é¡»å”¯ä¸€</li><li>å¯ä»¥æ ¹æ®memberæŸ¥è¯¢åˆ†æ•°</li></ul><p>å› æ­¤ï¼Œzsetåº•å±‚æ•°æ®ç»“æ„å¿…é¡»æ»¡è¶³<strong>é”®å€¼å­˜å‚¨</strong>ã€<strong>é”®å¿…é¡»å”¯ä¸€</strong>ã€<strong>å¯æ’åº</strong>è¿™å‡ ä¸ªéœ€æ±‚ã€‚ä¹‹å‰å­¦ä¹ çš„å“ªç§ç¼–ç ç»“æ„å¯ä»¥æ»¡è¶³ï¼Ÿ</p><ul><li><strong>SkipList</strong>ï¼šå¯ä»¥æ’åºï¼Œå¹¶ä¸”å¯ä»¥åŒæ—¶å­˜å‚¨scoreå’Œeleå€¼ï¼ˆmemberï¼‰</li><li><strong>HTï¼ˆDictï¼‰</strong>ï¼šå¯ä»¥é”®å€¼å­˜å‚¨ï¼Œå¹¶ä¸”å¯ä»¥æ ¹æ®keyæ‰¾value</li></ul><h2 id="åº•å±‚ç»“æ„"><a href="#åº•å±‚ç»“æ„" class="headerlink" title="åº•å±‚ç»“æ„"></a>åº•å±‚ç»“æ„</h2><p><img src="http://cdn.leesin.fun/typora/s3/img/image-20230329190449760.png" alt="image-20230329190449760"></p><h3 id="æ•°æ®é‡å°æ—¶ï¼šZipList"><a href="#æ•°æ®é‡å°æ—¶ï¼šZipList" class="headerlink" title="æ•°æ®é‡å°æ—¶ï¼šZipList"></a>æ•°æ®é‡å°æ—¶ï¼šZipList</h3><p>å½“å…ƒç´ æ•°é‡ä¸å¤šæ—¶ï¼ŒHTå’ŒSkipListçš„ä¼˜åŠ¿ä¸æ˜æ˜¾ï¼Œè€Œä¸”æ›´è€—å†…å­˜ã€‚å› æ­¤zsetè¿˜ä¼šé‡‡ç”¨ZipListç»“æ„æ¥èŠ‚çœå†…å­˜ï¼Œä¸è¿‡éœ€è¦åŒæ—¶æ»¡è¶³ä¸¤ä¸ªæ¡ä»¶ï¼š</p><ul><li>å…ƒç´ æ•°é‡å°äºzset_max_ziplist_entriesï¼Œé»˜è®¤å€¼128</li><li>æ¯ä¸ªå…ƒç´ éƒ½å°äºzset_max_ziplist_valueå­—èŠ‚ï¼Œé»˜è®¤å€¼64</li></ul><p>ziplistæœ¬èº«æ²¡æœ‰æ’åºåŠŸèƒ½ï¼Œè€Œä¸”æ²¡æœ‰é”®å€¼å¯¹çš„æ¦‚å¿µï¼Œå› æ­¤éœ€è¦æœ‰zseté€šè¿‡ç¼–ç å®ç°ï¼š</p><ul><li>ZipListæ˜¯è¿ç»­å†…å­˜ï¼Œå› æ­¤scoreå’Œelementæ˜¯ç´§æŒ¨åœ¨ä¸€èµ·çš„ä¸¤ä¸ªentryï¼Œ elementåœ¨å‰ï¼Œscoreåœ¨å</li><li>scoreè¶Šå°è¶Šæ¥è¿‘é˜Ÿé¦–ï¼Œscoreè¶Šå¤§è¶Šæ¥è¿‘é˜Ÿå°¾ï¼ŒæŒ‰ç…§scoreå€¼å‡åºæ’åˆ—</li></ul><p><img src="http://cdn.leesin.fun/typora/s3/img/image-20230329190637447.png" alt="image-20230329190637447"></p><h3 id="æ•°æ®é‡å¤§æ—¶ï¼šHT-SkipList"><a href="#æ•°æ®é‡å¤§æ—¶ï¼šHT-SkipList" class="headerlink" title="æ•°æ®é‡å¤§æ—¶ï¼šHT+SkipList"></a>æ•°æ®é‡å¤§æ—¶ï¼šHT+SkipList</h3><p>ç»“æ„ä½“å£°æ˜å¦‚ä¸‹ï¼š</p><p><img src="http://cdn.leesin.fun/typora/s3/img/1653992121692.png" alt="1653992121692"></p><p>ç»“æ„å›¾å¦‚ä¸‹ï¼š</p><p><img src="http://cdn.leesin.fun/typora/s3/img/1653992172526.png" alt="1653992172526"></p><h1 id="13-Hash"><a href="#13-Hash" class="headerlink" title="13.Hash"></a>13.Hash</h1><h2 id="Hashä¸Zsetå¯¹æ¯”"><a href="#Hashä¸Zsetå¯¹æ¯”" class="headerlink" title="Hashä¸Zsetå¯¹æ¯”"></a>Hashä¸Zsetå¯¹æ¯”</h2><p>Hashç»“æ„ä¸Redisä¸­çš„Zsetéå¸¸ç±»ä¼¼ï¼š</p><ul><li>éƒ½æ˜¯é”®å€¼å­˜å‚¨</li><li>éƒ½éœ€æ±‚æ ¹æ®é”®è·å–å€¼</li><li>é”®å¿…é¡»å”¯ä¸€</li></ul><p>åŒºåˆ«å¦‚ä¸‹ï¼š</p><ul><li>zsetçš„é”®æ˜¯memberï¼Œå€¼æ˜¯scoreï¼›hashçš„é”®å’Œå€¼éƒ½æ˜¯ä»»æ„å€¼</li><li>zsetè¦æ ¹æ®scoreæ’åºï¼›hashåˆ™æ— éœ€æ’åº</li></ul><p>hashç»“æ„å¦‚ä¸‹ï¼š</p><p><img src="http://cdn.leesin.fun/typora/s3/img/1653992339937.png" alt="1653992339937"></p><p>zseté›†åˆå¦‚ä¸‹ï¼š</p><p><img src="http://cdn.leesin.fun/typora/s3/img/1653992360355.png" alt="1653992360355"></p><h2 id="åº•å±‚ç»“æ„-1"><a href="#åº•å±‚ç»“æ„-1" class="headerlink" title="åº•å±‚ç»“æ„"></a>åº•å±‚ç»“æ„</h2><h3 id="æ•°æ®é‡å°æ—¶ï¼šZipList-1"><a href="#æ•°æ®é‡å°æ—¶ï¼šZipList-1" class="headerlink" title="æ•°æ®é‡å°æ—¶ï¼šZipList"></a>æ•°æ®é‡å°æ—¶ï¼šZipList</h3><p>Hashç»“æ„é»˜è®¤é‡‡ç”¨ZipListç¼–ç ï¼Œç”¨ä»¥èŠ‚çœå†…å­˜ã€‚ ZipListä¸­ç›¸é‚»çš„ä¸¤ä¸ªentry åˆ†åˆ«ä¿å­˜fieldå’Œvalue</p><p><img src="http://cdn.leesin.fun/typora/s3/img/image-20230329192017966.png" alt="image-20230329192017966"></p><h3 id="æ•°æ®é‡å¤§æ—¶ï¼šHT"><a href="#æ•°æ®é‡å¤§æ—¶ï¼šHT" class="headerlink" title="æ•°æ®é‡å¤§æ—¶ï¼šHT"></a>æ•°æ®é‡å¤§æ—¶ï¼šHT</h3><p>å½“æ•°æ®é‡è¾ƒå¤§æ—¶ï¼ŒHashç»“æ„ä¼šè½¬ä¸ºHTç¼–ç ï¼Œä¹Ÿå°±æ˜¯Dictï¼Œè§¦å‘æ¡ä»¶æœ‰ä¸¤ä¸ªï¼š</p><ol><li>ZipListä¸­çš„å…ƒç´ æ•°é‡è¶…è¿‡äº†hash-max-ziplist-entriesï¼ˆé»˜è®¤512ï¼‰</li><li>ZipListä¸­çš„ä»»æ„entryå¤§å°è¶…è¿‡äº†hash-max-ziplist-valueï¼ˆé»˜è®¤64å­—èŠ‚ï¼‰</li></ol><p><img src="http://cdn.leesin.fun/typora/s3/img/image-20230329193327665.png" alt="image-20230329193327665"></p><p>è½¬ä¸ºHTç¼–ç åï¼ŒHashçš„ç»“æ„å¦‚ä¸‹ï¼š</p><p><img src="http://cdn.leesin.fun/typora/s3/img/image-20230329192113560.png" alt="image-20230329192113560"></p>]]></content>
      
      
      <categories>
          
          <category> åç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> redis </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€åŸºç¡€ã€‘redisæ•°æ®ç»“æ„</title>
      <link href="/post/11.html"/>
      <url>/post/11.html</url>
      
        <content type="html"><![CDATA[<h1 id="é€šç”¨å‘½ä»¤"><a href="#é€šç”¨å‘½ä»¤" class="headerlink" title="é€šç”¨å‘½ä»¤"></a>é€šç”¨å‘½ä»¤</h1><p>å®˜ç½‘æ•™ç¨‹ï¼š<a href="https://redis.io/commands/">https://redis.io/commands/</a></p><p>é€šç”¨æŒ‡ä»¤æ˜¯éƒ¨åˆ†æ•°æ®ç±»å‹çš„ï¼Œéƒ½å¯ä»¥ä½¿ç”¨çš„æŒ‡ä»¤ï¼Œå¸¸è§çš„æœ‰ï¼š</p><ul><li>KEYSï¼šæŸ¥çœ‹ç¬¦åˆæ¨¡æ¿çš„æ‰€æœ‰key</li><li>DELï¼šåˆ é™¤ä¸€ä¸ªæŒ‡å®šçš„key</li><li>EXISTSï¼šåˆ¤æ–­keyæ˜¯å¦å­˜åœ¨</li><li>EXPIREï¼šç»™ä¸€ä¸ªkeyè®¾ç½®æœ‰æ•ˆæœŸï¼Œæœ‰æ•ˆæœŸåˆ°æœŸæ—¶è¯¥keyä¼šè¢«è‡ªåŠ¨åˆ é™¤</li><li>TTLï¼šæŸ¥çœ‹ä¸€ä¸ªKEYçš„å‰©ä½™æœ‰æ•ˆæœŸ</li></ul><p>é€šè¿‡help [command] å¯ä»¥æŸ¥çœ‹ä¸€ä¸ªå‘½ä»¤çš„å…·ä½“ç”¨æ³•ã€‚ä»¥ä¸‹æ˜¯æ‰§è¡Œäº†helpå‘½ä»¤çš„æç¤ºï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; <span class="built_in">help</span> KEYS</span><br><span class="line">    KEYS pattern</span><br><span class="line">    summary: Find all keys matching the given pattern</span><br><span class="line">    since: 1.0.0</span><br><span class="line">    group: generic</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">help</span> DEL</span><br><span class="line">    DEL key [key ...]</span><br><span class="line">    summary: Delete a key</span><br><span class="line">    since: 1.0.0</span><br><span class="line">    group: generic</span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">help</span> EXISTS</span><br><span class="line">    EXISTS key [key ...]</span><br><span class="line">    summary: Determine <span class="keyword">if</span> a key exists</span><br><span class="line">    since: 1.0.0</span><br><span class="line">    group: generic</span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">help</span> EXPIRE</span><br><span class="line">    EXPIRE key seconds</span><br><span class="line">    summary: Set a key<span class="string">&#x27;s time to live in seconds</span></span><br><span class="line"><span class="string">    since: 1.0.0</span></span><br><span class="line"><span class="string">    group: generic</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">127.0.0.1:6379&gt; help TTL</span></span><br><span class="line"><span class="string">    TTL key</span></span><br><span class="line"><span class="string">    summary: Get the time to live for a key</span></span><br><span class="line"><span class="string">    since: 1.0.0</span></span><br><span class="line"><span class="string">    group: generic</span></span><br><span class="line"><span class="string"></span></span><br></pre></td></tr></table></figure><p>ä¸¾ä¾‹ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥è¯¢ä»¥aå¼€å¤´çš„key</span></span><br><span class="line">127.0.0.1:6379&gt; keys a*</span><br><span class="line">1) <span class="string">&quot;age&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#æ‰¹é‡æ·»åŠ æ•°æ®</span></span><br><span class="line">127.0.0.1:6379&gt; MSET k1 v1 k2 v2 k3 v3 </span><br><span class="line">OK</span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; del k1 k2 k3 k4</span><br><span class="line">(<span class="built_in">integer</span>) 3   <span class="comment">#æ­¤å¤„è¿”å›çš„æ˜¯æˆåŠŸåˆ é™¤çš„keyï¼Œç”±äºredisä¸­åªæœ‰k1,k2,k3 æ‰€ä»¥åªæˆåŠŸåˆ é™¤3ä¸ªï¼Œæœ€ç»ˆè¿”å›</span></span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; exists age</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; exists K1</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; expire age 10</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; ttl age</span><br><span class="line">(<span class="built_in">integer</span>) 8</span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; ttl age</span><br><span class="line">(<span class="built_in">integer</span>) 6</span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; ttl age</span><br><span class="line">(<span class="built_in">integer</span>) -2  <span class="comment">#å½“è¿™ä¸ªkeyè¿‡æœŸäº†ï¼Œé‚£ä¹ˆæ­¤æ—¶æŸ¥è¯¢å‡ºæ¥å°±æ˜¯-2 </span></span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; keys *</span><br><span class="line">(empty list or <span class="built_in">set</span>)</span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> age 10 <span class="comment">#å¦‚æœæ²¡æœ‰è®¾ç½®è¿‡æœŸæ—¶é—´</span></span><br><span class="line">OK</span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; ttl age</span><br><span class="line">(<span class="built_in">integer</span>) -1  <span class="comment"># ttlçš„è¿”å›å€¼å°±æ˜¯-1</span></span><br></pre></td></tr></table></figure><h1 id="Stringç±»å‹"><a href="#Stringç±»å‹" class="headerlink" title="Stringç±»å‹"></a>Stringç±»å‹</h1><p>Stringç±»å‹ï¼Œä¹Ÿå°±æ˜¯å­—ç¬¦ä¸²ç±»å‹ï¼Œæ˜¯Redisä¸­æœ€ç®€å•çš„å­˜å‚¨ç±»å‹ã€‚</p><p>å…¶valueæ˜¯å­—ç¬¦ä¸²ï¼Œä¸è¿‡æ ¹æ®å­—ç¬¦ä¸²çš„æ ¼å¼ä¸åŒï¼Œåˆå¯ä»¥åˆ†ä¸º3ç±»ï¼š</p><ul><li>stringï¼šæ™®é€šå­—ç¬¦ä¸²</li><li>intï¼šæ•´æ•°ç±»å‹ï¼Œå¯ä»¥åšè‡ªå¢.è‡ªå‡æ“ä½œ</li><li>floatï¼šæµ®ç‚¹ç±»å‹ï¼Œå¯ä»¥åšè‡ªå¢.è‡ªå‡æ“ä½œ</li></ul><p>Stringçš„å¸¸è§å‘½ä»¤æœ‰ï¼š</p><div class="table-container"><table><thead><tr><th style="text-align:center">å‘½ä»¤</th><th style="text-align:center">è¯´æ˜</th></tr></thead><tbody><tr><td style="text-align:center">SET</td><td style="text-align:center">æ·»åŠ æˆ–è€…ä¿®æ”¹å·²ç»å­˜åœ¨çš„ä¸€ä¸ªStringç±»å‹çš„é”®å€¼å¯¹</td></tr><tr><td style="text-align:center">GET</td><td style="text-align:center">æ ¹æ®keyè·å–Stringç±»å‹çš„value</td></tr><tr><td style="text-align:center">MSET</td><td style="text-align:center">æ‰¹é‡æ·»åŠ å¤šä¸ªStringç±»å‹çš„é”®å€¼å¯¹</td></tr><tr><td style="text-align:center">MGET</td><td style="text-align:center">æ ¹æ®å¤šä¸ªkeyè·å–å¤šä¸ªStringç±»å‹çš„value</td></tr><tr><td style="text-align:center">INCR</td><td style="text-align:center">è®©ä¸€ä¸ªæ•´å‹çš„keyçš„å€¼è‡ªå¢1</td></tr><tr><td style="text-align:center">INCRBY</td><td style="text-align:center">è®©ä¸€ä¸ªæ•´å‹çš„keyè‡ªå¢å¹¶æŒ‡å®šæ­¥é•¿ï¼Œä¾‹å¦‚ï¼šincrby num 2 è®©numå€¼è‡ªå¢2</td></tr><tr><td style="text-align:center">INCRBYFLOAT</td><td style="text-align:center">è®©ä¸€ä¸ªæµ®ç‚¹ç±»å‹çš„æ•°å­—è‡ªå¢å¹¶æŒ‡å®šæ­¥é•¿</td></tr><tr><td style="text-align:center">SETNX</td><td style="text-align:center">æ·»åŠ ä¸€ä¸ªStringç±»å‹çš„é”®å€¼å¯¹ï¼Œå‰ææ˜¯è¿™ä¸ªkeyä¸å­˜åœ¨ï¼Œå¦åˆ™ä¸æ‰§è¡Œ</td></tr><tr><td style="text-align:center">SETEX</td><td style="text-align:center">æ·»åŠ ä¸€ä¸ªStringç±»å‹çš„é”®å€¼å¯¹ï¼Œå¹¶ä¸”æŒ‡å®šæœ‰æ•ˆæœŸ</td></tr></tbody></table></div><p>INCRå’ŒINCRBYå’ŒDECY</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; get age </span><br><span class="line"><span class="string">&quot;10&quot;</span></span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; incr age <span class="comment"># å¢åŠ 1</span></span><br><span class="line">(<span class="built_in">integer</span>) 11</span><br><span class="line">    </span><br><span class="line">127.0.0.1:6379&gt; get age <span class="comment"># è·å¾—age</span></span><br><span class="line"><span class="string">&quot;11&quot;</span></span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; incrby age 2 <span class="comment"># ä¸€æ¬¡å¢åŠ 2</span></span><br><span class="line">(<span class="built_in">integer</span>) 13 <span class="comment"># è¿”å›ç›®å‰çš„ageçš„å€¼</span></span><br><span class="line">    </span><br><span class="line">127.0.0.1:6379&gt; incrby age 2</span><br><span class="line">(<span class="built_in">integer</span>) 15</span><br><span class="line">    </span><br><span class="line">127.0.0.1:6379&gt; incrby age -1 <span class="comment"># ä¹Ÿå¯ä»¥å¢åŠ è´Ÿæ•°ï¼Œç›¸å½“äºå‡</span></span><br><span class="line">(<span class="built_in">integer</span>) 14</span><br><span class="line">    </span><br><span class="line">127.0.0.1:6379&gt; incrby age -2 <span class="comment"># ä¸€æ¬¡å‡å°‘2ä¸ª</span></span><br><span class="line">(<span class="built_in">integer</span>) 12</span><br><span class="line">    </span><br><span class="line">127.0.0.1:6379&gt; DECR age <span class="comment"># ç›¸å½“äº incr è´Ÿæ•°ï¼Œå‡å°‘æ­£å¸¸ç”¨æ³•</span></span><br><span class="line">(<span class="built_in">integer</span>) 11</span><br><span class="line">    </span><br><span class="line">127.0.0.1:6379&gt; get age </span><br><span class="line"><span class="string">&quot;11&quot;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>SETNX</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; <span class="built_in">help</span> setnx</span><br><span class="line"></span><br><span class="line">  SETNX key value</span><br><span class="line">  summary: Set the value of a key, only <span class="keyword">if</span> the key does not exist</span><br><span class="line">  since: 1.0.0</span><br><span class="line">  group: string</span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> name Jack  <span class="comment"># è®¾ç½®åç§°</span></span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; setnx name lisi <span class="comment"># å¦‚æœkeyä¸å­˜åœ¨ï¼Œåˆ™æ·»åŠ æˆåŠŸ</span></span><br><span class="line">(<span class="built_in">integer</span>) 0</span><br><span class="line">127.0.0.1:6379&gt; get name <span class="comment"># ç”±äºnameå·²ç»å­˜åœ¨ï¼Œæ‰€ä»¥lisiçš„æ“ä½œå¤±è´¥</span></span><br><span class="line"><span class="string">&quot;Jack&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; setnx name2 lisi <span class="comment"># name2 ä¸å­˜åœ¨ï¼Œæ‰€ä»¥æ“ä½œæˆåŠŸ</span></span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; get name2 </span><br><span class="line"><span class="string">&quot;lisi&quot;</span></span><br></pre></td></tr></table></figure><p>SETEX</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; <span class="built_in">help</span> SETEX</span><br><span class="line"></span><br><span class="line">  SETEX key seconds value</span><br><span class="line">  summary: Set the value and expiration of a key</span><br><span class="line">  since: 2.0.0</span><br><span class="line">  group: string</span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; setex name 10 jack</span><br><span class="line">OK</span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; ttl name</span><br><span class="line">(<span class="built_in">integer</span>) 8</span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; ttl name</span><br><span class="line">(<span class="built_in">integer</span>) 7</span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; ttl name</span><br><span class="line">(<span class="built_in">integer</span>) 5</span><br></pre></td></tr></table></figure><h1 id="Hashç±»å‹"><a href="#Hashç±»å‹" class="headerlink" title="Hashç±»å‹"></a>Hashç±»å‹</h1><p>Hashç±»å‹ï¼Œä¹Ÿå«æ•£åˆ—ï¼Œå…¶valueæ˜¯ä¸€ä¸ªæ— åºå­—å…¸ï¼Œç±»ä¼¼äºJavaä¸­çš„HashMapç»“æ„ã€‚</p><p>Stringç»“æ„æ˜¯å°†å¯¹è±¡åºåˆ—åŒ–ä¸ºJSONå­—ç¬¦ä¸²åå­˜å‚¨ï¼Œå½“éœ€è¦ä¿®æ”¹å¯¹è±¡æŸä¸ªå­—æ®µæ—¶å¾ˆä¸æ–¹ä¾¿ï¼š</p><div class="table-container"><table><thead><tr><th style="text-align:center">KEY</th><th style="text-align:center">VALUE</th></tr></thead><tbody><tr><td style="text-align:center">user:1</td><td style="text-align:center">{name:â€jackâ€,age:21}</td></tr><tr><td style="text-align:center">user:2</td><td style="text-align:center">{name:â€roseâ€,age:22}</td></tr></tbody></table></div><p>Hashç»“æ„å¯ä»¥å°†å¯¹è±¡ä¸­çš„æ¯ä¸ªå­—æ®µç‹¬ç«‹å­˜å‚¨ï¼Œå¯ä»¥é’ˆå¯¹å•ä¸ªå­—æ®µåšCRUDï¼š</p><p><img src="http://cdn.leesin.fun/typora/s3/img/Hashçš„ç»“æ„.png" alt="Hashçš„ç»“æ„"></p><p>Hashå¸¸è§å‘½ä»¤æœ‰ï¼š</p><div class="table-container"><table><thead><tr><th style="text-align:center">å‘½ä»¤</th><th style="text-align:center">è¯´æ˜</th></tr></thead><tbody><tr><td style="text-align:center">HSET key field value</td><td style="text-align:center">æ·»åŠ æˆ–è€…ä¿®æ”¹hashç±»å‹keyçš„fieldçš„å€¼</td></tr><tr><td style="text-align:center">HGET key field</td><td style="text-align:center">è·å–ä¸€ä¸ªhashç±»å‹keyçš„fieldçš„å€¼</td></tr><tr><td style="text-align:center">HMSET</td><td style="text-align:center">æ‰¹é‡æ·»åŠ å¤šä¸ªhashç±»å‹keyçš„fieldçš„å€¼</td></tr><tr><td style="text-align:center">HMGET</td><td style="text-align:center">æ‰¹é‡è·å–å¤šä¸ªhashç±»å‹keyçš„fieldçš„å€¼</td></tr><tr><td style="text-align:center">HGETALL</td><td style="text-align:center">è·å–ä¸€ä¸ªhashç±»å‹çš„keyä¸­çš„æ‰€æœ‰çš„fieldå’Œvalue</td></tr><tr><td style="text-align:center">HKEYS</td><td style="text-align:center">è·å–ä¸€ä¸ªhashç±»å‹çš„keyä¸­çš„æ‰€æœ‰çš„field</td></tr><tr><td style="text-align:center">HINCRBY</td><td style="text-align:center">è®©ä¸€ä¸ªhashç±»å‹keyçš„å­—æ®µå€¼è‡ªå¢å¹¶æŒ‡å®šæ­¥é•¿</td></tr><tr><td style="text-align:center">HSETNX</td><td style="text-align:center">æ·»åŠ ä¸€ä¸ªhashç±»å‹çš„keyçš„fieldå€¼ï¼Œå‰ææ˜¯è¿™ä¸ªfieldä¸å­˜åœ¨ï¼Œå¦åˆ™ä¸æ‰§è¡Œ</td></tr></tbody></table></div><p>ä¸¾ä¾‹ï¼š</p><p>HSETå’ŒHGET</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; HSET user:3 name Lucy <span class="comment"># å¤§keyæ˜¯ user:3 å°keyæ˜¯nameï¼Œå°valueæ˜¯Lucy</span></span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; HSET user:3 age 21 <span class="comment"># å¦‚æœæ“ä½œä¸å­˜åœ¨çš„æ•°æ®ï¼Œåˆ™æ˜¯æ–°å¢</span></span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; HSET user:3 age 17 <span class="comment"># å¦‚æœæ“ä½œå­˜åœ¨çš„æ•°æ®ï¼Œåˆ™æ˜¯ä¿®æ”¹</span></span><br><span class="line">(<span class="built_in">integer</span>) 0</span><br><span class="line">127.0.0.1:6379&gt; HGET user:3 name </span><br><span class="line"><span class="string">&quot;Lucy&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; HGET user:3 age</span><br><span class="line"><span class="string">&quot;17&quot;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>HMSETå’ŒHMGET</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; HMSET user:4 name LiLei age 20 sex man</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; HMGET user:4 name age sex</span><br><span class="line">1) <span class="string">&quot;LiLei&quot;</span></span><br><span class="line">2) <span class="string">&quot;20&quot;</span></span><br><span class="line">3) <span class="string">&quot;man&quot;</span></span><br></pre></td></tr></table></figure><p>HGETALL</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; HGETALL user:4</span><br><span class="line">1) <span class="string">&quot;name&quot;</span></span><br><span class="line">2) <span class="string">&quot;LiLei&quot;</span></span><br><span class="line">3) <span class="string">&quot;age&quot;</span></span><br><span class="line">4) <span class="string">&quot;20&quot;</span></span><br><span class="line">5) <span class="string">&quot;sex&quot;</span></span><br><span class="line">6) <span class="string">&quot;man&quot;</span></span><br></pre></td></tr></table></figure><p>HKEYSå’ŒHVALS</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; HKEYS user:4</span><br><span class="line">1) <span class="string">&quot;name&quot;</span></span><br><span class="line">2) <span class="string">&quot;age&quot;</span></span><br><span class="line">3) <span class="string">&quot;sex&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; HVALS user:4</span><br><span class="line">1) <span class="string">&quot;LiLei&quot;</span></span><br><span class="line">2) <span class="string">&quot;20&quot;</span></span><br><span class="line">3) <span class="string">&quot;man&quot;</span></span><br></pre></td></tr></table></figure><p>HINCRBY</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; HINCRBY user:4 age 2</span><br><span class="line">(<span class="built_in">integer</span>) 22</span><br><span class="line">127.0.0.1:6379&gt; HGET user:4 age</span><br><span class="line">1) <span class="string">&quot;22&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; HINCRBY user:4 age -2</span><br><span class="line">(<span class="built_in">integer</span>) 20</span><br></pre></td></tr></table></figure><p>HSETNX</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¦‚æœæœ¬å·²å­˜åœ¨ï¼Œä¼šå¤±è´¥</span></span><br><span class="line">127.0.0.1:6379&gt; HSETNX user:4 sex woman</span><br><span class="line">(<span class="built_in">integer</span>) 0</span><br><span class="line">127.0.0.1:6379&gt; HGET user:4 sex</span><br><span class="line"><span class="string">&quot;man&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¦‚æœæœ¬ä¸å­˜åœ¨ï¼Œä¼šæˆåŠŸ</span></span><br><span class="line">127.0.0.1:6379&gt; HSETNX user:3 sex woman</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; HGETALL user:3</span><br><span class="line">1) <span class="string">&quot;name&quot;</span></span><br><span class="line">2) <span class="string">&quot;Lucy&quot;</span></span><br><span class="line">3) <span class="string">&quot;age&quot;</span></span><br><span class="line">4) <span class="string">&quot;17&quot;</span></span><br><span class="line">5) <span class="string">&quot;sex&quot;</span></span><br><span class="line">6) <span class="string">&quot;woman&quot;</span></span><br></pre></td></tr></table></figure><h1 id="Listç±»å‹"><a href="#Listç±»å‹" class="headerlink" title="Listç±»å‹"></a>Listç±»å‹</h1><p>Redisä¸­çš„Listç±»å‹ä¸Javaä¸­çš„LinkedListç±»ä¼¼ï¼Œå¯ä»¥çœ‹åšæ˜¯ä¸€ä¸ªåŒå‘é“¾è¡¨ç»“æ„ã€‚æ—¢å¯ä»¥æ”¯æŒæ­£å‘æ£€ç´¢å’Œä¹Ÿå¯ä»¥æ”¯æŒåå‘æ£€ç´¢ã€‚</p><p>ç‰¹å¾ä¹Ÿä¸LinkedListç±»ä¼¼ï¼š</p><ul><li>æœ‰åº</li><li>å…ƒç´ å¯ä»¥é‡å¤</li><li>æ’å…¥å’Œåˆ é™¤å¿«</li><li>æŸ¥è¯¢é€Ÿåº¦ä¸€èˆ¬</li></ul><p>==å¸¸ç”¨æ¥å­˜å‚¨ä¸€ä¸ªæœ‰åºæ•°æ®ï¼Œä¾‹å¦‚ï¼šæœ‹å‹åœˆç‚¹èµåˆ—è¡¨ï¼Œè¯„è®ºåˆ—è¡¨ç­‰ã€‚==</p><p>Listçš„å¸¸è§å‘½ä»¤æœ‰ï¼š</p><div class="table-container"><table><thead><tr><th style="text-align:center">å‘½ä»¤</th><th style="text-align:center">è¯´æ˜</th></tr></thead><tbody><tr><td style="text-align:center">LPUSH key element  â€¦</td><td style="text-align:center">å‘åˆ—è¡¨å·¦ä¾§æ’å…¥ä¸€ä¸ªæˆ–å¤šä¸ªå…ƒç´ </td></tr><tr><td style="text-align:center">LPOP key</td><td style="text-align:center">ç§»é™¤å¹¶è¿”å›åˆ—è¡¨å·¦ä¾§çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œæ²¡æœ‰åˆ™è¿”å›nil</td></tr><tr><td style="text-align:center">RPUSH key element  â€¦</td><td style="text-align:center">å‘åˆ—è¡¨å³ä¾§æ’å…¥ä¸€ä¸ªæˆ–å¤šä¸ªå…ƒç´ </td></tr><tr><td style="text-align:center">RPOP key</td><td style="text-align:center">ç§»é™¤å¹¶è¿”å›åˆ—è¡¨å³ä¾§çš„ç¬¬ä¸€ä¸ªå…ƒç´ </td></tr><tr><td style="text-align:center">LRANGE key start end</td><td style="text-align:center">è¿”å›ä¸€æ®µè§’æ ‡èŒƒå›´å†…çš„æ‰€æœ‰å…ƒç´ </td></tr><tr><td style="text-align:center">BLPOP key [key â€¦] timeout</td><td style="text-align:center">ä¸LPOPç±»ä¼¼ï¼Œåªä¸è¿‡åœ¨æ²¡æœ‰å…ƒç´ æ—¶ç­‰å¾…æŒ‡å®šæ—¶é—´ï¼Œè€Œä¸æ˜¯ç›´æ¥è¿”å›nil</td></tr><tr><td style="text-align:center">BRPOP key [key â€¦] timeout</td><td style="text-align:center">ä¸RPOPç±»ä¼¼ï¼Œåªä¸è¿‡åœ¨æ²¡æœ‰å…ƒç´ æ—¶ç­‰å¾…æŒ‡å®šæ—¶é—´ï¼Œè€Œä¸æ˜¯ç›´æ¥è¿”å›nil</td></tr></tbody></table></div><ul><li>LPUSHå’ŒRPUSH</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; LPUSH users <span class="number">1</span> <span class="number">2</span> <span class="number">3</span></span><br><span class="line">(integer) <span class="number">3</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; RPUSH users <span class="number">4</span> <span class="number">5</span> <span class="number">6</span></span><br><span class="line">(integer) <span class="number">6</span></span><br></pre></td></tr></table></figure><ul><li>LRANGE</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¸‹æ ‡ä»0å¼€å§‹ï¼Œ-1è¡¨ç¤ºæœ«å°¾</span></span><br><span class="line">127.0.0.1:6379&gt; LRANGE <span class="built_in">users</span> 0 -1</span><br><span class="line">1) <span class="string">&quot;3&quot;</span></span><br><span class="line">2) <span class="string">&quot;2&quot;</span></span><br><span class="line">3) <span class="string">&quot;1&quot;</span></span><br><span class="line">4) <span class="string">&quot;4&quot;</span></span><br><span class="line">5) <span class="string">&quot;5&quot;</span></span><br><span class="line">6) <span class="string">&quot;6&quot;</span></span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; LRANGE <span class="built_in">users</span> 1 2</span><br><span class="line">1) <span class="string">&quot;2&quot;</span></span><br><span class="line">2) <span class="string">&quot;1&quot;</span></span><br></pre></td></tr></table></figure><ul><li>LPOPå’ŒRPOP</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; LPOP <span class="built_in">users</span></span><br><span class="line"><span class="string">&quot;3&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; RPOP <span class="built_in">users</span></span><br><span class="line"><span class="string">&quot;6&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹é“¾è¡¨æƒ…å†µ</span></span><br><span class="line">127.0.0.1:6379&gt; lrange <span class="built_in">users</span> 0 -1</span><br><span class="line">1) <span class="string">&quot;2&quot;</span></span><br><span class="line">2) <span class="string">&quot;1&quot;</span></span><br><span class="line">3) <span class="string">&quot;4&quot;</span></span><br><span class="line">4) <span class="string">&quot;5&quot;</span></span><br></pre></td></tr></table></figure><h1 id="Setç±»å‹"><a href="#Setç±»å‹" class="headerlink" title="Setç±»å‹"></a>Setç±»å‹</h1><p>Redisçš„Setç»“æ„ä¸Javaä¸­çš„HashSetç±»ä¼¼ï¼Œå¯ä»¥çœ‹åšæ˜¯ä¸€ä¸ªvalueä¸ºnullçš„HashMapã€‚å› ä¸ºä¹Ÿæ˜¯ä¸€ä¸ªhashè¡¨ï¼Œå› æ­¤å…·å¤‡ä¸HashSetç±»ä¼¼çš„ç‰¹å¾ï¼š</p><ul><li>æ— åº</li><li>å…ƒç´ ä¸å¯é‡å¤</li><li>æŸ¥æ‰¾å¿«</li><li>æ”¯æŒäº¤é›†.å¹¶é›†.å·®é›†ç­‰åŠŸèƒ½</li></ul><p><strong>Setç±»å‹çš„å¸¸è§å‘½ä»¤</strong></p><div class="table-container"><table><thead><tr><th style="text-align:center">å‘½ä»¤</th><th style="text-align:center">è¯´æ˜</th></tr></thead><tbody><tr><td style="text-align:center">SADD key member â€¦</td><td style="text-align:center">å‘setä¸­æ·»åŠ ä¸€ä¸ªæˆ–å¤šä¸ªå…ƒç´ </td></tr><tr><td style="text-align:center">SREM key member â€¦</td><td style="text-align:center">ç§»é™¤setä¸­çš„æŒ‡å®šå…ƒç´ </td></tr><tr><td style="text-align:center">SCARD key</td><td style="text-align:center">è¿”å›setä¸­å…ƒç´ çš„ä¸ªæ•°</td></tr><tr><td style="text-align:center">SISMEMBER key member</td><td style="text-align:center">åˆ¤æ–­ä¸€ä¸ªå…ƒç´ æ˜¯å¦å­˜åœ¨äºsetä¸­</td></tr><tr><td style="text-align:center">SMEMBERS</td><td style="text-align:center">è·å–setä¸­çš„æ‰€æœ‰å…ƒç´ </td></tr><tr><td style="text-align:center">SINTER key1 key2 â€¦</td><td style="text-align:center">æ±‚key1ä¸key2çš„äº¤é›†</td></tr><tr><td style="text-align:center">SDIFF key1 key2 â€¦</td><td style="text-align:center">æ±‚key1ä¸key2çš„å·®é›†</td></tr><tr><td style="text-align:center">SUNION key1 key2 â€¦</td><td style="text-align:center">æ±‚key1å’Œkey2çš„å¹¶é›†</td></tr></tbody></table></div><p>ä¸¾ä¾‹</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; sadd s1 a b c</span><br><span class="line">(<span class="built_in">integer</span>) 3</span><br><span class="line">127.0.0.1:6379&gt; smembers s1</span><br><span class="line">1) <span class="string">&quot;c&quot;</span></span><br><span class="line">2) <span class="string">&quot;b&quot;</span></span><br><span class="line">3) <span class="string">&quot;a&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; srem s1 a</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">    </span><br><span class="line">127.0.0.1:6379&gt; SISMEMBER s1 a</span><br><span class="line">(<span class="built_in">integer</span>) 0</span><br><span class="line">    </span><br><span class="line">127.0.0.1:6379&gt; SISMEMBER s1 b</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">    </span><br><span class="line">127.0.0.1:6379&gt; SCARD s1</span><br><span class="line">(<span class="built_in">integer</span>) 2</span><br></pre></td></tr></table></figure><h1 id="SortedSetç±»å‹"><a href="#SortedSetç±»å‹" class="headerlink" title="SortedSetç±»å‹"></a>SortedSetç±»å‹</h1><p>Redisçš„SortedSetæ˜¯ä¸€ä¸ªå¯æ’åºçš„seté›†åˆï¼Œä¸Javaä¸­çš„TreeSetæœ‰äº›ç±»ä¼¼ï¼Œä½†åº•å±‚æ•°æ®ç»“æ„å´å·®åˆ«å¾ˆå¤§ã€‚SortedSetä¸­çš„æ¯ä¸€ä¸ªå…ƒç´ éƒ½å¸¦æœ‰ä¸€ä¸ªscoreå±æ€§ï¼Œå¯ä»¥åŸºäºscoreå±æ€§å¯¹å…ƒç´ æ’åºï¼Œåº•å±‚çš„å®ç°æ˜¯ä¸€ä¸ª==è·³è¡¨ï¼ˆSkipListï¼‰åŠ  hashè¡¨==ã€‚</p><p>SortedSetå…·å¤‡ä¸‹åˆ—ç‰¹æ€§ï¼š</p><ul><li>å¯æ’åº</li><li>å…ƒç´ ä¸é‡å¤</li><li>æŸ¥è¯¢é€Ÿåº¦å¿«</li></ul><p>å› ä¸ºSortedSetçš„å¯æ’åºç‰¹æ€§ï¼Œç»å¸¸è¢«ç”¨æ¥å®ç°==æ’è¡Œæ¦œ==è¿™æ ·çš„åŠŸèƒ½ã€‚</p><p><strong>SortedSetçš„å¸¸è§å‘½ä»¤æœ‰ï¼š</strong></p><div class="table-container"><table><thead><tr><th style="text-align:center">å‘½ä»¤</th><th style="text-align:center">è¯´æ˜</th></tr></thead><tbody><tr><td style="text-align:center">ZADD key score member</td><td style="text-align:center">æ·»åŠ ä¸€ä¸ªæˆ–å¤šä¸ªå…ƒç´ åˆ°sorted set ï¼Œå¦‚æœå·²ç»å­˜åœ¨åˆ™æ›´æ–°å…¶scoreå€¼</td></tr><tr><td style="text-align:center">ZREM key member</td><td style="text-align:center">åˆ é™¤sorted setä¸­çš„ä¸€ä¸ªæŒ‡å®šå…ƒç´ </td></tr><tr><td style="text-align:center">ZSCORE key member</td><td style="text-align:center">è·å–sorted setä¸­çš„æŒ‡å®šå…ƒç´ çš„scoreå€¼</td></tr><tr><td style="text-align:center">ZRANK key member</td><td style="text-align:center">è·å–sorted set ä¸­çš„æŒ‡å®šå…ƒç´ çš„æ’åï¼ˆå‡åºï¼‰</td></tr><tr><td style="text-align:center">ZREVRANK key memeber</td><td style="text-align:center">è·å–sorted set ä¸­çš„æŒ‡å®šå…ƒç´ çš„æ’åï¼ˆé™åºï¼‰</td></tr><tr><td style="text-align:center">ZCARD key</td><td style="text-align:center">è·å–sorted setä¸­çš„å…ƒç´ ä¸ªæ•°</td></tr><tr><td style="text-align:center">ZCOUNT key min max</td><td style="text-align:center">ç»Ÿè®¡scoreå€¼åœ¨ç»™å®šèŒƒå›´å†…çš„æ‰€æœ‰å…ƒç´ çš„ä¸ªæ•°</td></tr><tr><td style="text-align:center">ZINCRBY key increment member</td><td style="text-align:center">è®©sorted setä¸­çš„æŒ‡å®šå…ƒç´ è‡ªå¢ï¼Œæ­¥é•¿ä¸ºæŒ‡å®šçš„incrementå€¼</td></tr><tr><td style="text-align:center">ZRANGE key min max</td><td style="text-align:center">æŒ‰ç…§scoreæ’åºåï¼Œè·å–æŒ‡å®š==æ’åèŒƒå›´==å†…çš„å…ƒç´ </td></tr><tr><td style="text-align:center">ZRANGEBYSCORE key min max</td><td style="text-align:center">æŒ‰ç…§scoreæ’åºåï¼Œè·å–æŒ‡å®š==scoreèŒƒå›´==å†…çš„å…ƒç´ </td></tr><tr><td style="text-align:center">ZDIFF numkeys key [key â€¦]</td><td style="text-align:center">æ±‚å·®é›†</td></tr><tr><td style="text-align:center">ZINTER numkeys key [key â€¦]</td><td style="text-align:center">æ±‚äº¤é›†</td></tr><tr><td style="text-align:center">ZUNION numkeys key [key â€¦]</td><td style="text-align:center">æ±‚å¹¶é›†</td></tr></tbody></table></div><p>æ³¨æ„ï¼šæ‰€æœ‰çš„æ’åéƒ½æ˜¯==é»˜è®¤å‡åº==ï¼Œå¦‚æœè¦é™åºåˆ™åœ¨å‘½ä»¤çš„Zåé¢æ·»åŠ REVå³å¯ï¼Œä¾‹å¦‚ï¼š</p><ul><li><strong>å‡åº</strong>è·å–sorted set ä¸­çš„æŒ‡å®šå…ƒç´ çš„æ’åï¼šZRANK key member</li><li><strong>é™åº</strong>è·å–sorted set ä¸­çš„æŒ‡å®šå…ƒç´ çš„æ’åï¼šZREVRANK key memeber</li></ul>]]></content>
      
      
      <categories>
          
          <category> åç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> redis </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€è§£å†³ã€‘chromè®¿é—®åšå®¢åŠ è½½å›¾ç‰‡å¤±è´¥é—®é¢˜</title>
      <link href="/post/10.html"/>
      <url>/post/10.html</url>
      
        <content type="html"><![CDATA[<h1 id="é—®é¢˜æè¿°"><a href="#é—®é¢˜æè¿°" class="headerlink" title="é—®é¢˜æè¿°"></a>é—®é¢˜æè¿°</h1><ul><li>è°·æ­Œæµè§ˆå™¨ä¸ºäº†å®‰å…¨ï¼Œå›¾ç‰‡æ— æ³•æ˜¾ç¤ºã€‚ä½†â€œåœ¨æ–°æ ‡ç­¾é¡µæ‰“å¼€å›¾ç‰‡â€å´èƒ½æ˜¾ç¤ºï¼Œè¯´æ˜å›¾ç‰‡æ˜¯å­˜åœ¨çš„ã€‚</li><li>å¦‚æœä½¿ç”¨ç«ç‹æµè§ˆå™¨ï¼Œä¹Ÿæ˜¯èƒ½æ­£å¸¸è®¿é—®çš„ã€‚</li></ul><h1 id="çœŸå®åŸå› "><a href="#çœŸå®åŸå› " class="headerlink" title="çœŸå®åŸå› "></a>çœŸå®åŸå› </h1><p>å­˜åœ¨ä¸ƒç‰›äº‘çš„å›¾ç‰‡çš„é“¾æ¥æ˜¯httpåè®®çš„ï¼Œè°·æ­Œæµè§ˆå™¨è‡ªåŠ¨å°†åè®®å˜æˆäº†httpsåè®®ï¼Œæ‰€ä»¥è®¿é—®å›¾ç‰‡å¤±è´¥ã€‚</p><h1 id="è§£å†³åŠæ³•1"><a href="#è§£å†³åŠæ³•1" class="headerlink" title="è§£å†³åŠæ³•1"></a>è§£å†³åŠæ³•1</h1><p>ç‚¹å‡»ç½‘ç«™åœ°å€æ å·¦è¾¹çš„é”å¤´å›¾æ ‡ï¼Œè¿›å…¥ç½‘ç«™è®¾ç½®</p><p><img src="http://cdn.leesin.fun/typora/s3/img/image-20230327200340841.png" alt="image-20230327200340841"></p><p>æŠŠä¸å®Œå…¨å†…å®¹ä¿®æ”¹ä¸ºâ€œå…è®¸â€ï¼Œå³å¯ã€‚</p><p><img src="http://cdn.leesin.fun/typora/s3/img/image-20230327200513995.png" alt="image-20230327200513995"></p><h1 id="è§£å†³åŠæ³•2"><a href="#è§£å†³åŠæ³•2" class="headerlink" title="è§£å†³åŠæ³•2"></a>è§£å†³åŠæ³•2</h1><p>ä½¿ç”¨ç«ç‹æµè§ˆå™¨è®¿é—®ã€‚ã€‚ã€‚</p><h1 id="è§£å†³åŠæ³•3"><a href="#è§£å†³åŠæ³•3" class="headerlink" title="è§£å†³åŠæ³•3"></a>è§£å†³åŠæ³•3</h1><p>å›¾åºŠå‡çº§ä¸ºhttpsã€‚</p><ol><li>å»é˜¿é‡Œäº‘è´­ä¹°å…è´¹çš„sslè¯ä¹¦ï¼Œå¹¶ç­‰å¾…CAéªŒè¯</li><li>éªŒè¯æˆåŠŸåï¼Œä¸‹è½½è¯ä¹¦ï¼Œé€‰æ‹© <code>pem/key</code> è¯ä¹¦æ ¼å¼</li><li>ç™»å½•ä¸ƒç‰›äº‘ï¼Œæ¥åˆ°sslè¯ä¹¦é¡µé¢ï¼Œç‚¹å‡»â€œä¸Šä¼ è‡ªæœ‰è¯ä¹¦â€ã€‚ï¼ˆè¯ä¹¦å†…å®¹ï¼šå¯¹åº”ä¸‹è½½ SSL è¯ä¹¦ä¸­çš„ pem æ–‡ä»¶ä¸­çš„å†…å®¹ï¼‰ï¼ˆè¯ä¹¦ç§åŒ™ ï¼šå¯¹åº”key æ–‡ä»¶é‡Œé¢çš„å†…å®¹ï¼‰</li><li>éƒ¨ç½²è¯ä¹¦</li><li>ç­‰å¾…ä¸ƒç‰›äº‘å‡çº§åè®®https</li></ol>]]></content>
      
      
      <categories>
          
          <category> åšå®¢ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>ã€ç®—æ³•ã€‘åŠ›æ‰£142ï¼ˆç¯å½¢é“¾è¡¨IIï¼‰</title>
      <link href="/post/17.html"/>
      <url>/post/17.html</url>
      
        <content type="html"><![CDATA[<h1 id="é¢˜ç›®æè¿°"><a href="#é¢˜ç›®æè¿°" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h1><p>ç»™å®šä¸€ä¸ªé“¾è¡¨çš„å¤´èŠ‚ç‚¹  head ï¼Œè¿”å›é“¾è¡¨å¼€å§‹å…¥ç¯çš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ã€‚ å¦‚æœé“¾è¡¨æ— ç¯ï¼Œåˆ™è¿”å› nullã€‚</p><p>å¦‚æœé“¾è¡¨ä¸­æœ‰æŸä¸ªèŠ‚ç‚¹ï¼Œå¯ä»¥é€šè¿‡è¿ç»­è·Ÿè¸ª next æŒ‡é’ˆå†æ¬¡åˆ°è¾¾ï¼Œåˆ™é“¾è¡¨ä¸­å­˜åœ¨ç¯ã€‚ ä¸ºäº†è¡¨ç¤ºç»™å®šé“¾è¡¨ä¸­çš„ç¯ï¼Œè¯„æµ‹ç³»ç»Ÿå†…éƒ¨ä½¿ç”¨æ•´æ•° pos æ¥è¡¨ç¤ºé“¾è¡¨å°¾è¿æ¥åˆ°é“¾è¡¨ä¸­çš„ä½ç½®ï¼ˆç´¢å¼•ä» 0 å¼€å§‹ï¼‰ã€‚å¦‚æœ pos æ˜¯ -1ï¼Œåˆ™åœ¨è¯¥é“¾è¡¨ä¸­æ²¡æœ‰ç¯ã€‚æ³¨æ„ï¼špos ä¸ä½œä¸ºå‚æ•°è¿›è¡Œä¼ é€’ï¼Œä»…ä»…æ˜¯ä¸ºäº†æ ‡è¯†é“¾è¡¨çš„å®é™…æƒ…å†µã€‚</p><p>ä¸å…è®¸ä¿®æ”¹ é“¾è¡¨ã€‚</p><p>ç¤ºä¾‹ï¼š</p><p><img src="https://assets.leetcode.com/uploads/2018/12/07/circularlinkedlist.png" alt></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥ï¼šhead = [3,2,0,-4], pos = 1</span><br><span class="line">è¾“å‡ºï¼šè¿”å›ç´¢å¼•ä¸º 1 çš„é“¾è¡¨èŠ‚ç‚¹</span><br><span class="line">è§£é‡Šï¼šé“¾è¡¨ä¸­æœ‰ä¸€ä¸ªç¯ï¼Œå…¶å°¾éƒ¨è¿æ¥åˆ°ç¬¬äºŒä¸ªèŠ‚ç‚¹ã€‚</span><br></pre></td></tr></table></figure><h1 id="å¿«æ…¢æŒ‡é’ˆè§£æ³•"><a href="#å¿«æ…¢æŒ‡é’ˆè§£æ³•" class="headerlink" title="å¿«æ…¢æŒ‡é’ˆè§£æ³•"></a>å¿«æ…¢æŒ‡é’ˆè§£æ³•</h1><p>ã€å¿«æ…¢æŒ‡é’ˆè§£æ³•ã€‘slowèµ°ä¸€æ­¥ï¼Œfastèµ°ä¸¤æ­¥ã€‚</p><p>  åˆ¤æ–­æ˜¯å¦æœ‰ç¯ï¼šfasté‡åˆ°äº†nullè¡¨ç¤ºæ— ç¯ã€‚</p><p>  å¦‚æœæœ‰ç¯ï¼Œslowå’Œfastä¸€å®šåœ¨ç¯å†…ç›¸é‡ã€‚ä¸ºä»€ä¹ˆï¼Ÿå› ä¸ºfastè‚¯å®šæ˜¯å…ˆæ¯”slowè¿›å…¥ç¯å†…çš„ï¼Œå½“slowä¹Ÿè¿›å…¥ç¯å†…åï¼Œç›¸å½“äºfastèµ°ä¸€æ­¥ï¼ŒslowåŸåœ°ä¸åŠ¨ï¼Œæœ€åfastä¸€å®šä¼šè¿½ä¸Šslowã€‚ï¼ˆfastç›¸å¯¹é€Ÿåº¦ä¸º1ï¼‰</p><p>  é‚£ä¹ˆæˆ‘ä»¬åˆ†æç¬¬ä¸€æ¬¡ç›¸é‡çš„æ—¶åˆ»ã€‚è®¾aä¸ºå…¥ç¯å‰çš„é“¾è¡¨é•¿åº¦ï¼ˆä¸åŒ…æ‹¬å…¥å£èŠ‚ç‚¹ï¼‰ï¼Œè®¾bä¸ºç¯çš„é“¾è¡¨é•¿åº¦ï¼ˆåŒ…æ‹¬å…¥å£èŠ‚ç‚¹ï¼‰ã€‚è®¾fastèµ°äº†fæ­¥ï¼Œslowèµ°äº†sæ­¥ï¼Œåˆ™f=2sã€‚</p><p>  ç›¸é‡æ—¶ï¼Œf=s+nb ï¼ˆè§£é‡Šï¼šç›¸é‡æ—¶ï¼Œfastæ¯”slowå¤šèµ°äº†nåœˆï¼‰</p><p>  ä¸¤å¼ç›¸å‡å¾—s=nb ï¼ˆç†è§£ï¼šç›¸é‡æ—¶ï¼Œslowèµ°äº†çš„è·ç¦»å’Œnbç›¸ç­‰ï¼‰</p><p>  ç„¶åï¼Œæˆ‘ä»¬è¿™æ ·æƒ³ï¼Œslowèµ°åˆ°å…¥å£èŠ‚ç‚¹çš„è¡¨è¾¾å¼æ˜¯ä»€ä¹ˆï¼Ÿa+nbï¼</p><p>  æ­¤æ—¶ï¼Œs=nbï¼Œslowå·²ç»èµ°äº†nbæ­¥éª¤äº†ï¼Œå†èµ°aæ­¥å°±èƒ½èµ°åˆ°å…¥å£èŠ‚ç‚¹äº†ï¼</p><p>  æƒ³åŠæ³•è®©ä»–èµ°aæ­¥å°±å®Œäº‹å•¦ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> ListNode <span class="title function_">detectCycle</span><span class="params">(ListNode head)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (head == <span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">slow</span> <span class="operator">=</span> head, fast = head;</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            fast = fast.next;</span><br><span class="line">            <span class="keyword">if</span> (fast == <span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">            fast = fast.next;</span><br><span class="line">            <span class="keyword">if</span> (fast == <span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">            slow = slow.next;</span><br><span class="line">        &#125; <span class="keyword">while</span> (fast != slow);</span><br><span class="line"></span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">tmp</span> <span class="operator">=</span> head;</span><br><span class="line">        <span class="keyword">while</span> (tmp != slow) &#123;</span><br><span class="line">            tmp = tmp.next;</span><br><span class="line">            slow = slow.next;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> slow;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">æ—¶é—´å¤æ‚åº¦O(n)</span></span><br><span class="line"><span class="comment">ç©ºé—´å¤æ‚åº¦O(1)</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><blockquote><p>å½“ç„¶ä¹Ÿå¯ä»¥ç”¨setæ¥è®°å½•èŠ‚ç‚¹ï¼Œå¦‚æœé‡å¤å‡ºç°åˆ™æœ‰ç¯ï¼Œä¸”é‡å¤å‡ºç°çš„èŠ‚ç‚¹ä¸ºå…¥å£èŠ‚ç‚¹ã€‚ç©ºé—´å¤æ‚åº¦å‡ä¸ºO(n)</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> ç®—æ³• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> åŒæŒ‡é’ˆ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>juc</title>
      <link href="/post/7.html"/>
      <url>/post/7.html</url>
      
        <content type="html"><![CDATA[<h1 id="CAS"><a href="#CAS" class="headerlink" title="CAS"></a>CAS</h1><h2 id="æ¨¡æ‹Ÿç½‘ç«™è®¡æ•°å™¨"><a href="#æ¨¡æ‹Ÿç½‘ç«™è®¡æ•°å™¨" class="headerlink" title="æ¨¡æ‹Ÿç½‘ç«™è®¡æ•°å™¨"></a>æ¨¡æ‹Ÿç½‘ç«™è®¡æ•°å™¨</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lyf.juc.cas;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.CountDownLatch;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo04</span> &#123;</span><br><span class="line">    <span class="comment">// æ€»è®¿é—®é‡</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">volatile</span> <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ¨¡æ‹Ÿè®¿é—®çš„æ–¹æ³•</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">request</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// æš‚åœæ¯«ç§’</span></span><br><span class="line">        <span class="keyword">try</span>&#123; TimeUnit.MILLISECONDS.sleep(<span class="number">5</span>); &#125; <span class="keyword">catch</span> (InterruptedException e) &#123; e.printStackTrace(); &#125;</span><br><span class="line">        <span class="type">int</span> expectValue;</span><br><span class="line">        <span class="keyword">while</span> (!compareAndSet(expectValue = getCount(), expectValue + <span class="number">1</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">compareAndSet</span><span class="params">(<span class="type">int</span> expectValue, <span class="type">int</span> newValue)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (getCount() == expectValue) &#123;</span><br><span class="line">            count = newValue;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">getCount</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> count;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="type">long</span> <span class="variable">start</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        <span class="type">int</span> <span class="variable">threadSize</span> <span class="operator">=</span> <span class="number">100</span>;</span><br><span class="line">        <span class="type">CountDownLatch</span> <span class="variable">countDownLatch</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CountDownLatch</span>(threadSize);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; threadSize; i++) &#123;</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">                <span class="keyword">try</span>&#123;</span><br><span class="line">                    <span class="comment">// æ¨¡æ‹Ÿç”¨æˆ·è¡Œä¸ºï¼Œæ¯ä¸ªç”¨æˆ·è®¿é—®10æ¬¡ç½‘ç«™</span></span><br><span class="line">                    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; <span class="number">10</span>; j++) &#123;</span><br><span class="line">                        request();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                    countDownLatch.countDown();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;, <span class="string">&quot;t&quot;</span> + i).start();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        countDownLatch.await();</span><br><span class="line">        <span class="type">long</span> <span class="variable">end</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        System.out.println(<span class="string">&quot;è€—æ—¶ï¼š&quot;</span> + (end - start) + <span class="string">&quot;ms&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;count=&quot;</span> + count);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="å¦‚ä½•ä½¿ç”¨Javaçš„CASï¼Ÿ"><a href="#å¦‚ä½•ä½¿ç”¨Javaçš„CASï¼Ÿ" class="headerlink" title="å¦‚ä½•ä½¿ç”¨Javaçš„CASï¼Ÿ"></a>å¦‚ä½•ä½¿ç”¨Javaçš„CASï¼Ÿ</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åœ¨ sun.misc.Unsafeä¸­</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">native</span> <span class="type">boolean</span> <span class="title function_">compareAndSwapObject</span><span class="params">(Object var1, <span class="type">long</span> var2, Object var4, Object var5)</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">native</span> <span class="type">boolean</span> <span class="title function_">compareAndSwapInt</span><span class="params">(Object var1, <span class="type">long</span> var2, <span class="type">int</span> var4, <span class="type">int</span> var5)</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">native</span> <span class="type">boolean</span> <span class="title function_">compareAndSwapLong</span><span class="params">(Object var1, <span class="type">long</span> var2, <span class="type">long</span> var4, <span class="type">long</span> var6)</span>;</span><br></pre></td></tr></table></figure><div class="table-container"><table><thead><tr><th style="text-align:center">å‚æ•°</th><th style="text-align:center">è¯´æ˜</th></tr></thead><tbody><tr><td style="text-align:center">var1</td><td style="text-align:center">è¡¨ç¤ºè¦æ“ä½œçš„å¯¹è±¡</td></tr><tr><td style="text-align:center">var2</td><td style="text-align:center">è¡¨ç¤ºè¦æ“ä½œå¯¹è±¡ä¸­å±æ€§çš„åœ°å€åç§»é‡</td></tr><tr><td style="text-align:center">var4</td><td style="text-align:center">è¡¨ç¤ºè¦ä¿®æ”¹çš„æ•°æ®æœŸæœ›å€¼</td></tr><tr><td style="text-align:center">var5</td><td style="text-align:center">è¡¨ç¤ºè¦ä¿®æ”¹çš„æ•°æ®çš„æ–°å€¼</td></tr></tbody></table></div><h2 id="ABAé—®é¢˜"><a href="#ABAé—®é¢˜" class="headerlink" title="ABAé—®é¢˜"></a>ABAé—®é¢˜</h2><h1 id="LongAdder"><a href="#LongAdder" class="headerlink" title="LongAdder"></a>LongAdder</h1><h2 id="ä¸ºä»€ä¹ˆä¸ä½¿ç”¨AtomicLong"><a href="#ä¸ºä»€ä¹ˆä¸ä½¿ç”¨AtomicLong" class="headerlink" title="ä¸ºä»€ä¹ˆä¸ä½¿ç”¨AtomicLong?"></a>ä¸ºä»€ä¹ˆä¸ä½¿ç”¨AtomicLong?</h2><p>é«˜å¹¶å‘ä¸‹ï¼ŒCASæˆåŠŸç‡å¤ªä½ï¼Œå¯¼è‡´CPUå¼€é”€é«˜ï¼Œæ•ˆç‡ä¹Ÿä½ã€‚</p><p>è€Œä½¿ç”¨LongAdderå¯ä»¥å‡å°‘é‡è¯•æ¬¡æ•°ï¼Œé«˜å¹¶å‘ä¸‹æ•ˆç‡æå‡å¾ˆé«˜ã€‚ä½†æ˜¯ä»–çš„ç¼ºç‚¹å°±æ˜¯å¼±ä¸€è‡´æ€§ï¼Œåªèƒ½ä¿è¯æœ€ç»ˆä¸€è‡´æ€§ã€‚</p><p><img src="http://cdn.leef.fun/typora/s3/img/LongAdder.png" alt="LongAdder"></p><blockquote><p>cellæ•°ç»„è¿˜æ”¯æŒåŠ¨æ€æ‰©å®¹ï¼Œæœ€å¤§ä¸è¶…è¿‡CPUæ ¸å¿ƒæ•°</p></blockquote><h1 id="ThreadLocal"><a href="#ThreadLocal" class="headerlink" title="ThreadLocal"></a>ThreadLocal</h1><p>çº¿ç¨‹ä¿ç•™è‡ªå·±çš„æ•°æ®</p><p>keyé‡‡ç”¨å¼±å¼•ç”¨</p><p>mapçš„ç”Ÿå‘½å‘¨æœŸå’Œå½“å‰çº¿ç¨‹ç»‘å®š</p><h2 id="å†…å­˜æ³„æ¼"><a href="#å†…å­˜æ³„æ¼" class="headerlink" title="å†…å­˜æ³„æ¼"></a>å†…å­˜æ³„æ¼</h2><h3 id="å‡è®¾ThreadLocalMapä¸­çš„keyä½¿ç”¨äº†å¼ºå¼•ç”¨ï¼Œé‚£ä¹ˆä¼šå‡ºç°å†…å­˜æ³„æ¼å—"><a href="#å‡è®¾ThreadLocalMapä¸­çš„keyä½¿ç”¨äº†å¼ºå¼•ç”¨ï¼Œé‚£ä¹ˆä¼šå‡ºç°å†…å­˜æ³„æ¼å—" class="headerlink" title="å‡è®¾ThreadLocalMapä¸­çš„keyä½¿ç”¨äº†å¼ºå¼•ç”¨ï¼Œé‚£ä¹ˆä¼šå‡ºç°å†…å­˜æ³„æ¼å— ?"></a>å‡è®¾ThreadLocalMapä¸­çš„keyä½¿ç”¨äº†å¼ºå¼•ç”¨ï¼Œé‚£ä¹ˆä¼šå‡ºç°å†…å­˜æ³„æ¼å— ?</h3><p><img src="http://cdn.leef.fun/typora/s3/img/ThreadLocalå†…å­˜æ³„æ¼.png" alt="ThreadLocalå†…å­˜æ³„æ¼"></p><ol><li>å‡è®¾åœ¨ä¸šåŠ¡ä»£ç ä¸­ä½¿ç”¨å®ŒThreadLocal ï¼ŒthreadLocal Refè¢«å›æ”¶äº†</li><li>ä½†æ˜¯å› ä¸ºthreadLocalMapçš„Entryå¼ºå¼•ç”¨äº†threadLocalï¼Œé€ æˆthreadLocalæ— æ³•è¢«å›æ”¶</li><li>åœ¨æ²¡æœ‰æ‰‹åŠ¨åˆ é™¤è¿™ä¸ªEntryä»¥åŠCurrentThreadä¾ç„¶è¿è¡Œçš„å‰æä¸‹å§‹ç»ˆæœ‰å¼ºå¼•ç”¨é“¾ threadRef-&gt;currentThread-&gt;threadLocalMap-&gt;entryï¼ŒEntryå°±ä¸ä¼šè¢«å›æ”¶(Entryä¸­åŒ…æ‹¬äº†ThreadLocalå®ä¾‹å’Œvalue)ï¼Œå¯¼è‡´Entryå†…å­˜æ³„æ¼ï¼Œå³Entryä¸­çš„keyå’Œvalueå¯¹è±¡éƒ½ä¸ä¼šå†ç”¨åˆ°äº†ï¼Œä½†æ˜¯è¿˜æ˜¯å­˜åœ¨åœ¨å†…å­˜ä¸­ã€‚</li></ol><blockquote><p> ç»“è®ºï¼šä¹Ÿå°±æ˜¯è¯´ï¼ŒThreadLocalMapä¸­çš„keyä½¿ç”¨äº†å¼ºå¼•ç”¨ï¼Œæ˜¯æ— æ³•å®Œå…¨é¿å…å†…å­˜æ³„æ¼çš„ã€‚</p></blockquote><h3 id="é‚£ä¹ˆThreadLocalMapä¸­çš„keyä½¿ç”¨äº†å¼±å¼•ç”¨ï¼Œä¼šå‡ºç°å†…å­˜æ³„æ¼å—"><a href="#é‚£ä¹ˆThreadLocalMapä¸­çš„keyä½¿ç”¨äº†å¼±å¼•ç”¨ï¼Œä¼šå‡ºç°å†…å­˜æ³„æ¼å—" class="headerlink" title="é‚£ä¹ˆThreadLocalMapä¸­çš„keyä½¿ç”¨äº†å¼±å¼•ç”¨ï¼Œä¼šå‡ºç°å†…å­˜æ³„æ¼å— ?"></a>é‚£ä¹ˆThreadLocalMapä¸­çš„keyä½¿ç”¨äº†å¼±å¼•ç”¨ï¼Œä¼šå‡ºç°å†…å­˜æ³„æ¼å— ?</h3><ol><li>åŒæ ·å‡è®¾åœ¨ä¸šåŠ¡ä»£ç ä¸­ä½¿ç”¨å®ŒThreadLocal ï¼ŒthreadLocal Refè¢«å›æ”¶äº†</li><li>ç”±äºThreadLocalMapåªæŒæœ‰ThreadLocalçš„å¼±å¼•ç”¨ï¼Œæ²¡æœ‰ä»»ä½•å¼ºå¼•ç”¨æŒ‡å‘threadlocalå®ä¾‹ï¼Œæ‰€ä»¥threadlocalå°±å¯ä»¥é¡ºåˆ©è¢«gcå›æ”¶ï¼Œæ­¤æ—¶Entryä¸­çš„key= null.</li><li>ä½†æ˜¯åœ¨æ²¡æœ‰æ‰‹åŠ¨åˆ é™¤è¿™ä¸ªEntryä»¥åŠCurrentThreadä¾ç„¶è¿è¡Œçš„å‰æä¸‹ï¼Œä¹Ÿå­˜åœ¨æœ‰å¼ºå¼•ç”¨é“¾ threadRef-&gt;currentThread-&gt;threadLocalMap-&gt;entry -&gt;value ï¼Œvalueä¸ä¼šè¢«å›æ”¶ ï¼Œè€Œè¿™å—valueæ°¸è¿œä¸ä¼šè¢«è®¿é—®åˆ°äº†ï¼Œå¯¼è‡´valueå†…å­˜æ³„æ¼ã€‚</li></ol><blockquote><p> ä¹Ÿå°±æ˜¯è¯´ï¼ŒThreadLocalMapä¸­çš„keyä½¿ç”¨äº†å¼±å¼•ç”¨ï¼Œä¹Ÿæœ‰å¯èƒ½å†…å­˜æ³„æ¼ã€‚</p></blockquote><h3 id="å‡ºç°å†…å­˜æ³„æ¼çš„çœŸå®åŸå› "><a href="#å‡ºç°å†…å­˜æ³„æ¼çš„çœŸå®åŸå› " class="headerlink" title="å‡ºç°å†…å­˜æ³„æ¼çš„çœŸå®åŸå› "></a>å‡ºç°å†…å­˜æ³„æ¼çš„çœŸå®åŸå› </h3><p>æ¯”è¾ƒä»¥ä¸Šä¸¤ç§æƒ…å†µï¼Œæˆ‘ä»¬å°±ä¼šå‘ç°ï¼Œå†…å­˜æ³„æ¼çš„å‘ç”Ÿè·ŸThreadLocalMapä¸­çš„keyæ˜¯å¦ä½¿ç”¨å¼±å¼•ç”¨æ˜¯æ²¡æœ‰å…³ç³»çš„ã€‚</p><p>é‚£ä¹ˆå†…å­˜æ³„æ¼çš„çš„çœŸæ­£åŸå› æ˜¯ä»€ä¹ˆå‘¢ ?<br>åœ¨ä»¥ä¸Šä¸¤ç§å†…å­˜æ³„æ¼çš„æƒ…å†µä¸­ï¼Œéƒ½æœ‰ä¸¤ä¸ªå‰æ :</p><ol><li>æ²¡æœ‰æ‰‹åŠ¨åˆ é™¤è¿™ä¸ªEntry</li><li>CurrentThreadä¾ç„¶è¿è¡Œ</li></ol><p>ç¬¬ä¸€ç‚¹å¾ˆå¥½ç†è§£ï¼Œåªè¦åœ¨ä½¿ç”¨å®ŒThreadLocalï¼Œè°ƒç”¨å…¶removeæ–¹æ³•åˆ é™¤å¯¹åº”çš„Entryï¼Œå°±èƒ½é¿å…å†…å­˜æ³„æ¼ã€‚</p><p>ç¬¬äºŒç‚¹ç¨å¾®å¤æ‚ä¸€ç‚¹ï¼Œç”±äºThreadLocalMapæ˜¯Threadçš„ä¸€ä¸ªå±æ€§ï¼Œè¢«å½“å‰çº¿ç¨‹æ‰€å¼•ç”¨ï¼Œæ‰€ä»¥å®ƒçš„ç”Ÿå‘½å‘¨æœŸè·ŸThreadä¸€æ ·é•¿ã€‚é‚£ä¹ˆåœ¨ä½¿ç”¨å®ŒThreadLocalçš„ä½¿ç”¨ï¼Œå¦‚æœå½“å‰Threadä¹Ÿéšä¹‹æ‰§è¡Œç»“æŸï¼ŒThreadLocalMapè‡ªç„¶ä¹Ÿä¼šè¢«gcå›æ”¶ï¼Œä»æ ¹æºä¸Šé¿å…äº†å†…å­˜æ³„æ¼ã€‚</p><p>ç»¼ä¸Šï¼ŒThreadLocalå†…å­˜æ³„æ¼çš„æ ¹æºæ˜¯:ç”±äºThreadLocalMapçš„ç”Ÿå‘½å‘¨æœŸè·ŸThreadä¸€æ ·é•¿ï¼Œå¦‚æœæ²¡æœ‰æ‰‹åŠ¨åˆ é™¤å¯¹åº”keyå°±ä¼šå¯¼è‡´å†…å­˜æ³„æ¼</p><blockquote><p>æ€»ç»“ï¼Œç”¨å®ŒThreadLocalåä¸€å®šè¦æ‰‹åŠ¨remove</p></blockquote><h3 id="ä¸ºä»€ä¹ˆä½¿ç”¨å¼±å¼•ç”¨"><a href="#ä¸ºä»€ä¹ˆä½¿ç”¨å¼±å¼•ç”¨" class="headerlink" title="ä¸ºä»€ä¹ˆä½¿ç”¨å¼±å¼•ç”¨"></a>ä¸ºä»€ä¹ˆä½¿ç”¨å¼±å¼•ç”¨</h3><p>æ ¹æ®åˆšæ‰çš„åˆ†æ,æˆ‘ä»¬çŸ¥é“äº†: æ— è®ºThreadLocalMapä¸­çš„keyä½¿ç”¨å“ªç§ç±»å‹å¼•ç”¨éƒ½æ— æ³•å®Œå…¨é¿å…å†…å­˜æ³„æ¼ï¼Œè·Ÿä½¿ç”¨å¼±å¼•ç”¨æ²¡æœ‰å…³ç³»</p><p>è¦é¿å…å†…å­˜æ³„æ¼æœ‰ä¸¤ç§æ–¹å¼:</p><ol><li><p>ä½¿ç”¨å®ŒThreadLocalï¼Œè°ƒç”¨å…¶removeæ–¹æ³•åˆ é™¤å¯¹åº”çš„Entry</p></li><li><p>ä½¿ç”¨å®ŒThreadLocalï¼Œå½“å‰Threadä¹Ÿ,éšä¹‹è¿è¡Œç»“æŸ</p></li></ol><p>ç›¸å¯¹ç¬¬ä¸€ç§æ–¹å¼ï¼Œç¬¬äºŒç§æ–¹å¼æ˜¾ç„¶æ›´ä¸å¥½æ§åˆ¶ï¼Œç‰¹åˆ«æ˜¯ä½¿ç”¨çº¿ç¨‹æ± çš„æ—¶å€™ï¼Œçº¿ç¨‹ç»“æŸæ˜¯ä¸ä¼šé”€æ¯çš„</p><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œåªè¦è®°å¾—åœ¨ä½¿ç”¨å®ŒThreadLocalåŠæ—¶çš„è°ƒç”¨removeï¼Œæ— è®ºkeyæ˜¯å¼ºå¼•ç”¨è¿˜æ˜¯å¼±å¼•ç”¨éƒ½ä¸ä¼šæœ‰é—®é¢˜ï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆkeyè¦ç”¨å¼±å¼•ç”¨å‘¢ ?</p><p>äº‹å®ä¸Šï¼Œåœ¨ThreadLocalMapä¸­çš„set/getEntryæ–¹æ³•ä¸­ï¼Œä¼šå¯¹keyä¸ºnull( ä¹Ÿå³æ˜¯ThreadLocaä¸ºnull) è¿›è¡Œåˆ¤æ–°ã€‚å¦‚æœä¸ºnullçš„è¯ï¼Œé‚£ä¹ˆæ˜¯ä¼šå¯¹valueç½®ä¸ºnullçš„ã€‚<br>è¿™å°±æ„å‘³ç€ä½¿ç”¨å®ŒThreadLocalï¼ŒCurrentThreadä¾ç„¶è¿è¡Œçš„å‰æä¸‹ï¼Œ<strong>å°±ç®—å¿˜è®°è°ƒç”¨removeæ–¹æ³•ï¼Œå¼±å¼•ç”¨æ¯”å¼ºå¼•ç”¨å¯ä»¥å¤šä¸€å±‚ä¿éšœ</strong>ï¼šå¼±å¼•ç”¨çš„ThreadLocalä¼šè¢«å›æ”¶ï¼Œå¯¹åº”çš„valueåœ¨ä¸‹ä¸€æ¬¡ThreadLocalMapè°ƒç”¨set,get,removeä¸­çš„ä»»ä¸€æ–¹æ³•çš„æ—¶å€™ä¼šè¢«æ¸…é™¤ï¼Œä»è€Œé¿å…å†…å­˜æ³„æ¼ã€‚</p><h1 id="ConcurrentHashMap"><a href="#ConcurrentHashMap" class="headerlink" title="ConcurrentHashMap"></a>ConcurrentHashMap</h1><h1 id="SychronizedåŸç†"><a href="#SychronizedåŸç†" class="headerlink" title="SychronizedåŸç†"></a>SychronizedåŸç†</h1><h2 id="Javaå¯¹è±¡å¤´ï¼ˆä»¥32ä½ä¸ºä¾‹ï¼‰"><a href="#Javaå¯¹è±¡å¤´ï¼ˆä»¥32ä½ä¸ºä¾‹ï¼‰" class="headerlink" title="Javaå¯¹è±¡å¤´ï¼ˆä»¥32ä½ä¸ºä¾‹ï¼‰"></a>Javaå¯¹è±¡å¤´ï¼ˆä»¥32ä½ä¸ºä¾‹ï¼‰</h2><p>32ä½çš„æ™®é€šå¯¹è±¡</p><p><img src="32ä½æ™®é€šå¯¹è±¡.png" alt="32ä½æ™®é€šå¯¹è±¡"></p><p>32ä½çš„æ•°ç»„å¯¹è±¡</p><p><img src="32ä½æ•°ç»„å¯¹è±¡.png" alt="32ä½æ•°ç»„å¯¹è±¡"></p><p>32ä½çš„ Mark Word ç»“æ„ä¸º</p><p><img src="32ä½Mark Wordç»“æ„.png" alt="32ä½Mark Wordç»“æ„"></p><p>64ä½çš„ Mark Word ç»“æ„ä¸º</p><p><img src="64ä½Mark Wordç»“æ„.png" alt="64ä½Mark Wordç»“æ„"></p><h2 id="é”å‡çº§"><a href="#é”å‡çº§" class="headerlink" title="é”å‡çº§"></a>é”å‡çº§</h2><p>åå‘é” -&gt; è½»é‡çº§é” -&gt; é‡é‡é”</p><h2 id="åå‘é”"><a href="#åå‘é”" class="headerlink" title="åå‘é”"></a>åå‘é”</h2><p>åå‘é”æ˜¯æŒ‡å½“ä¸€æ®µåŒæ­¥ä»£ç ä¸€ç›´è¢«åŒä¸€ä¸ªçº¿ç¨‹æ‰€è®¿é—®æ—¶ï¼Œå³ä¸å­˜åœ¨å¤šä¸ªçº¿ç¨‹çš„ç«äº‰æ—¶ï¼Œé‚£ä¹ˆè¯¥çº¿ç¨‹åœ¨åç»­è®¿é—®æ—¶ä¾¿ä¼šè‡ªåŠ¨è·å¾—é”ï¼Œä»è€Œé™ä½è·å–é”å¸¦æ¥çš„æ¶ˆè€—ï¼Œå³æé«˜æ€§èƒ½ã€‚</p><p>åªæœ‰ç¬¬ä¸€æ¬¡ä½¿ç”¨ CAS å°†çº¿ç¨‹ ID è®¾ç½®åˆ°å¯¹è±¡çš„ Mark Word å¤´ï¼Œä¹‹åå‘ç° è¿™ä¸ªçº¿ç¨‹ ID æ˜¯è‡ªå·±çš„å°±è¡¨ç¤ºæ²¡æœ‰ç«äº‰ï¼Œä¸ç”¨é‡æ–° CASã€‚ä»¥ååªè¦ä¸å‘ç”Ÿç«äº‰ï¼Œè¿™ä¸ªå¯¹è±¡å°±å½’è¯¥çº¿ç¨‹æ‰€æœ‰ã€‚</p><h3 id="æ’¤é”€åå‘çŠ¶æ€â€”â€”è°ƒç”¨hashCode"><a href="#æ’¤é”€åå‘çŠ¶æ€â€”â€”è°ƒç”¨hashCode" class="headerlink" title="æ’¤é”€åå‘çŠ¶æ€â€”â€”è°ƒç”¨hashCode"></a>æ’¤é”€åå‘çŠ¶æ€â€”â€”è°ƒç”¨hashCode</h3><p>è°ƒç”¨äº†å¯¹è±¡çš„ hashCodeï¼Œä½†åå‘é”çš„å¯¹è±¡ MarkWord ä¸­å­˜å‚¨çš„æ˜¯çº¿ç¨‹ idï¼Œå¦‚æœè°ƒç”¨ hashCode ä¼šå¯¼è‡´åå‘é”è¢« æ’¤é”€ã€‚ï¼ˆä¸æ‡‚çš„è¯å°±çœ‹å¯¹è±¡å¤´ç»“æ„ã€‚ï¼‰</p><blockquote><p>ä¸ºä»€ä¹ˆè½»é‡çº§é”å’Œé‡é‡çº§é”ï¼Œå°±ä¸ä¼šå‘ç”Ÿè¿™ç§æƒ…å†µå‘¢ï¼Ÿ</p><ul><li>è½»é‡çº§é”ä¼šåœ¨é”è®°å½•ä¸­è®°å½• hashCode</li><li>é‡é‡çº§é”ä¼šåœ¨ Monitor ä¸­è®°å½• hashCode</li></ul></blockquote><h3 id="æ’¤é”€åå‘çŠ¶æ€â€”â€”å…¶å®ƒçº¿ç¨‹äº¤é”™ä½¿ç”¨å¯¹è±¡"><a href="#æ’¤é”€åå‘çŠ¶æ€â€”â€”å…¶å®ƒçº¿ç¨‹äº¤é”™ä½¿ç”¨å¯¹è±¡" class="headerlink" title="æ’¤é”€åå‘çŠ¶æ€â€”â€”å…¶å®ƒçº¿ç¨‹äº¤é”™ä½¿ç”¨å¯¹è±¡"></a>æ’¤é”€åå‘çŠ¶æ€â€”â€”å…¶å®ƒçº¿ç¨‹äº¤é”™ä½¿ç”¨å¯¹è±¡</h3><p>æ­¤æ—¶ä¼šå‡çº§ä¸ºè½»é‡çº§é”</p><h3 id="æ’¤é”€-è°ƒç”¨-wait-notify"><a href="#æ’¤é”€-è°ƒç”¨-wait-notify" class="headerlink" title="æ’¤é”€ - è°ƒç”¨ wait/notify"></a>æ’¤é”€ - è°ƒç”¨ wait/notify</h3><p>æ­¤æ—¶ä¼šå‡çº§ä¸ºé‡é‡çº§é”ï¼Œé‡é‡çº§é”æ‰æœ‰wait/notify</p><h2 id="è½»é‡çº§é”-è‡ªæ—‹é”"><a href="#è½»é‡çº§é”-è‡ªæ—‹é”" class="headerlink" title="è½»é‡çº§é”/è‡ªæ—‹é”"></a>è½»é‡çº§é”/è‡ªæ—‹é”</h2><p>å¦‚æœä¸€ä¸ªå¯¹è±¡è™½ç„¶æœ‰å¤šçº¿ç¨‹è¦åŠ é”ï¼Œä½†åŠ é”çš„æ—¶é—´æ˜¯é”™å¼€çš„ï¼ˆä¹Ÿå°±æ˜¯æ²¡æœ‰ç«äº‰ï¼‰ï¼Œé‚£ä¹ˆå¯ä»¥ ä½¿ç”¨è½»é‡çº§é”æ¥ä¼˜åŒ–ã€‚</p><ul><li>åˆ›å»ºé”è®°å½•ï¼ˆLock Recordï¼‰å¯¹è±¡ï¼Œæ¯ä¸ªçº¿ç¨‹çš„æ ˆå¸§éƒ½ä¼šåŒ…å«ä¸€ä¸ªé”è®°å½•çš„ç»“æ„ï¼Œå†…éƒ¨å¯ä»¥å­˜å‚¨é”å®šå¯¹è±¡çš„ Mark Word</li></ul><p><img src="a1.png" alt="a1"></p><ul><li>è®©é”è®°å½•ä¸­ Object reference æŒ‡å‘é”å¯¹è±¡ï¼Œå¹¶å°è¯•ç”¨ cas æ›¿æ¢ Object çš„ Mark Wordï¼Œå°† Mark Word çš„å€¼å­˜ å…¥é”è®°å½•</li></ul><p><img src="a2.png" alt="a2"></p><ul><li>å¦‚æœ cas æ›¿æ¢æˆåŠŸï¼Œå¯¹è±¡å¤´ä¸­å­˜å‚¨äº† <code>é”è®°å½•åœ°å€å’ŒçŠ¶æ€ 00</code> ï¼Œè¡¨ç¤ºç”±è¯¥çº¿ç¨‹ç»™å¯¹è±¡åŠ é”ï¼Œè¿™æ—¶å›¾ç¤ºå¦‚ä¸‹</li></ul><p><img src="a3.png" alt="a3"></p><ul><li>å¦‚æœ cas å¤±è´¥ï¼Œæœ‰ä¸¤ç§æƒ…å†µ<ul><li>å¦‚æœæ˜¯å…¶å®ƒçº¿ç¨‹å·²ç»æŒæœ‰äº†è¯¥ Object çš„è½»é‡çº§é”ï¼Œè¿™æ—¶è¡¨æ˜æœ‰ç«äº‰ï¼Œè¿›å…¥é”è†¨èƒ€è¿‡ç¨‹ </li><li>å¦‚æœæ˜¯è‡ªå·±æ‰§è¡Œäº† synchronized é”é‡å…¥ï¼Œé‚£ä¹ˆå†æ·»åŠ ä¸€æ¡ Lock Record ä½œä¸ºé‡å…¥çš„è®¡æ•°</li></ul></li></ul><p><img src="http://cdn.leesin.fun/typora/s3/img/a4.png" alt="a4"></p><ul><li>å½“é€€å‡º synchronized ä»£ç å—ï¼ˆè§£é”æ—¶ï¼‰å¦‚æœæœ‰å–å€¼ä¸º null çš„é”è®°å½•ï¼Œè¡¨ç¤ºæœ‰é‡å…¥ï¼Œè¿™æ—¶é‡ç½®é”è®°å½•ï¼Œè¡¨ç¤ºé‡ å…¥è®¡æ•°å‡ä¸€</li></ul><p><img src="http://cdn.leesin.fun/typora/s3/img/a5.png" alt="a5"></p><ul><li>å½“é€€å‡º synchronized ä»£ç å—ï¼ˆè§£é”æ—¶ï¼‰é”è®°å½•çš„å€¼ä¸ä¸º nullï¼Œè¿™æ—¶ä½¿ç”¨ cas å°† Mark Word çš„å€¼æ¢å¤ç»™å¯¹è±¡ å¤´<ul><li>æˆåŠŸï¼Œåˆ™è§£é”æˆåŠŸ</li><li>å¤±è´¥ï¼Œè¯´æ˜è½»é‡çº§é”è¿›è¡Œäº†é”è†¨èƒ€æˆ–å·²ç»å‡çº§ä¸ºé‡é‡çº§é”ï¼Œè¿›å…¥é‡é‡çº§é”è§£é”æµç¨‹</li></ul></li></ul><h2 id="é”è†¨èƒ€"><a href="#é”è†¨èƒ€" class="headerlink" title="é”è†¨èƒ€"></a>é”è†¨èƒ€</h2><p>å¦‚æœåœ¨å°è¯•åŠ è½»é‡çº§é”çš„è¿‡ç¨‹ä¸­ï¼ŒCAS æ“ä½œæ— æ³•æˆåŠŸï¼Œè¿™æ—¶ä¸€ç§æƒ…å†µå°±æ˜¯æœ‰å…¶å®ƒçº¿ç¨‹ä¸ºæ­¤å¯¹è±¡åŠ ä¸Šäº†è½»é‡çº§é”ï¼ˆæœ‰ ç«äº‰ï¼‰ï¼Œè¿™æ—¶éœ€è¦è¿›è¡Œé”è†¨èƒ€ï¼Œå°†è½»é‡çº§é”å˜ä¸ºé‡é‡çº§é”ã€‚</p><ul><li>å½“ Thread-1 è¿›è¡Œè½»é‡çº§åŠ é”æ—¶ï¼ŒThread-0 å·²ç»å¯¹è¯¥å¯¹è±¡åŠ äº†è½»é‡çº§é”</li></ul><p><img src="http://cdn.leesin.fun/typora/s3/img/b1.png" alt="b1"></p><ul><li>è¿™æ—¶ Thread-1 åŠ è½»é‡çº§é”å¤±è´¥ï¼Œè¿›å…¥é”è†¨èƒ€æµç¨‹<ul><li>å³ä¸º Object å¯¹è±¡ç”³è¯· Monitor é”ï¼Œè®© Object æŒ‡å‘é‡é‡çº§é”åœ°å€ </li><li>ç„¶åè‡ªå·±è¿›å…¥ Monitor çš„ EntryList BLOCKED</li></ul></li></ul><p><img src="http://cdn.leesin.fun/typora/s3/img/b2.png" alt="b2"></p><ul><li>å½“ Thread-0 é€€å‡ºåŒæ­¥å—è§£é”æ—¶ï¼Œä½¿ç”¨ cas å°† Mark Word çš„å€¼æ¢å¤ç»™å¯¹è±¡å¤´ï¼Œå¤±è´¥ã€‚è¿™æ—¶ä¼šè¿›å…¥é‡é‡çº§è§£é” æµç¨‹ï¼Œå³æŒ‰ç…§ Monitor åœ°å€æ‰¾åˆ° Monitor å¯¹è±¡ï¼Œè®¾ç½® Owner ä¸º nullï¼Œå”¤é†’ EntryList ä¸­ BLOCKED çº¿ç¨‹</li></ul><h2 id="åå‘é”vsè½»é‡çº§é”"><a href="#åå‘é”vsè½»é‡çº§é”" class="headerlink" title="åå‘é”vsè½»é‡çº§é”"></a>åå‘é”vsè½»é‡çº§é”</h2><p><img src="åå‘é”.png" alt="åå‘é”"></p><p><img src="è½»é‡çº§é”.png" alt="è½»é‡çº§é”"></p><h2 id="MonitoråŸç†"><a href="#MonitoråŸç†" class="headerlink" title="MonitoråŸç†"></a>MonitoråŸç†</h2><p>Monitor è¢«ç¿»è¯‘ä¸º<strong>ç›‘è§†å™¨</strong>æˆ–<strong>ç®¡ç¨‹</strong></p><p>æ¯ä¸ª Java å¯¹è±¡éƒ½å¯ä»¥å…³è”ä¸€ä¸ª Monitor å¯¹è±¡ï¼Œå¦‚æœä½¿ç”¨ synchronized ç»™å¯¹è±¡ä¸Šé”==ï¼ˆé‡é‡çº§ï¼‰==ä¹‹åï¼Œè¯¥å¯¹è±¡å¤´çš„ Mark Word ä¸­å°±è¢«è®¾ç½®æŒ‡å‘ Monitor å¯¹è±¡çš„æŒ‡é’ˆã€‚</p><p>Monitorç»“æ„å¦‚ä¸‹ï¼š</p><p><img src="Monitorç»“æ„.png" alt="Monitorç»“æ„"></p><ul><li><p>åˆšå¼€å§‹ Monitor ä¸­ Owner ä¸º null </p></li><li><p>å½“ Thread-2 æ‰§è¡Œ<code>synchronized(obj)</code>å°±ä¼šå°† Monitor çš„æ‰€æœ‰è€… Owner ç½®ä¸º Thread-2ï¼ŒMonitorä¸­åªèƒ½æœ‰ä¸€ ä¸ª Owner </p></li><li><p>åœ¨ Thread-2 ä¸Šé”çš„è¿‡ç¨‹ä¸­ï¼Œå¦‚æœ Thread-3ï¼ŒThread-4ï¼ŒThread-5 ä¹Ÿæ¥æ‰§è¡Œ <code>synchronized(obj)</code>ï¼Œå°±ä¼šè¿›å…¥ EntryList BLOCKED </p></li><li><p>Thread-2 æ‰§è¡Œå®ŒåŒæ­¥ä»£ç å—çš„å†…å®¹ï¼Œç„¶åå”¤é†’ EntryList ä¸­ç­‰å¾…çš„çº¿ç¨‹æ¥ç«äº‰é”ï¼Œç«äº‰çš„æ—¶æ˜¯éå…¬å¹³çš„ </p></li><li><p>å›¾ä¸­ WaitSet ä¸­çš„ Thread-0ï¼ŒThread-1 æ˜¯ä¹‹å‰è·å¾—è¿‡é”ï¼Œä½†æ¡ä»¶ä¸æ»¡è¶³è¿›å…¥ WAITING çŠ¶æ€çš„çº¿ç¨‹ï¼Œåé¢è®² wait-notify æ—¶ä¼šåˆ†æ</p></li></ul><blockquote><p>æ³¨æ„ï¼š </p><ul><li>synchronized å¿…é¡»æ˜¯è¿›å…¥åŒä¸€ä¸ªå¯¹è±¡çš„ monitor æ‰æœ‰ä¸Šè¿°çš„æ•ˆæœ </li><li>ä¸åŠ  synchronized çš„å¯¹è±¡ä¸ä¼šå…³è”ç›‘è§†å™¨ï¼Œä¸éµä»ä»¥ä¸Šè§„åˆ™</li></ul></blockquote><h2 id="wait-notify-åŸç†"><a href="#wait-notify-åŸç†" class="headerlink" title="wait notify åŸç†"></a>wait notify åŸç†</h2><p><img src="Monitorç»“æ„.png" alt="Monitorç»“æ„"></p><ul><li><p>Owner çº¿ç¨‹å‘ç°æ¡ä»¶ä¸æ»¡è¶³ï¼Œè°ƒç”¨ wait æ–¹æ³•ï¼Œå³å¯è¿›å…¥ WaitSet å˜ä¸º WAITING çŠ¶æ€ </p></li><li><p>BLOCKED å’Œ WAITING çš„çº¿ç¨‹éƒ½å¤„äºé˜»å¡çŠ¶æ€ï¼Œä¸å ç”¨ CPU æ—¶é—´ç‰‡ </p></li><li><p>BLOCKED çº¿ç¨‹ä¼šåœ¨ Owner çº¿ç¨‹é‡Šæ”¾é”æ—¶å”¤é†’ </p></li><li><p>WAITING çº¿ç¨‹ä¼šåœ¨ Owner çº¿ç¨‹è°ƒç”¨ notify æˆ– notifyAll æ—¶å”¤é†’ï¼Œä½†å”¤é†’åå¹¶ä¸æ„å‘³è€…ç«‹åˆ»è·å¾—é”ï¼Œ<strong>ä»éœ€è¿›å…¥ EntryList é‡æ–°ç«äº‰</strong></p></li></ul><h1 id="ThreadPool"><a href="#ThreadPool" class="headerlink" title="ThreadPool"></a>ThreadPool</h1><h2 id="ExecutorServiceç»§æ‰¿ä½“ç³»å›¾"><a href="#ExecutorServiceç»§æ‰¿ä½“ç³»å›¾" class="headerlink" title="ExecutorServiceç»§æ‰¿ä½“ç³»å›¾"></a>ExecutorServiceç»§æ‰¿ä½“ç³»å›¾</h2><p><img src="ExecutorServiceç»§æ‰¿ä½“ç³»å›¾.png" alt="ExecutorServiceç»§æ‰¿ä½“ç³»å›¾"></p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å¤šçº¿ç¨‹ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>rediså®‰è£…</title>
      <link href="/post/16.html"/>
      <url>/post/16.html</url>
      
        <content type="html"><![CDATA[<h1 id="å®‰è£…redis"><a href="#å®‰è£…redis" class="headerlink" title="å®‰è£…redis"></a>å®‰è£…redis</h1><p>å®‰è£…Redisæ‰€éœ€è¦çš„gccä¾èµ–</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y gcc tcl</span><br></pre></td></tr></table></figure><p>æŠŠ<code>redis-6.2.6.tar.gz</code> ä¸Šä¼ è‡³ <code>/usr/local/src</code>  ä¸Š</p><p>è§£å‹ç¼©</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -zxvf redis-6.2.6.tar.gz</span><br></pre></td></tr></table></figure><p>è¿›å…¥redisç›®å½•</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> redis-6.2.6</span><br></pre></td></tr></table></figure><p>è¿è¡Œç¼–è¯‘å‘½ä»¤ï¼Œå¦‚æœæ²¡æœ‰å‡ºé”™ï¼Œåº”è¯¥å°±å®‰è£…æˆåŠŸäº†ã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></table></figure><p>é»˜è®¤çš„å®‰è£…è·¯å¾„æ˜¯åœ¨ <code>/usr/local/bin</code>ç›®å½•ä¸‹</p><p>è¯¥ç›®å½•ä»¥åŠé»˜è®¤é…ç½®åˆ°ç¯å¢ƒå˜é‡ï¼Œå› æ­¤å¯ä»¥åœ¨ä»»æ„ç›®å½•ä¸‹è¿è¡Œè¿™äº›å‘½ä»¤ã€‚å…¶ä¸­ï¼š</p><ul><li>redis-cliï¼šæ˜¯redisæä¾›çš„å‘½ä»¤è¡Œå®¢æˆ·ç«¯</li><li>redis-serverï¼šæ˜¯redisçš„æœåŠ¡ç«¯å¯åŠ¨è„šæœ¬</li><li>redis-sentinelï¼šæ˜¯redisçš„å“¨å…µå¯åŠ¨è„šæœ¬</li></ul><h2 id="å¯åŠ¨æµ‹è¯•"><a href="#å¯åŠ¨æµ‹è¯•" class="headerlink" title="å¯åŠ¨æµ‹è¯•"></a>å¯åŠ¨æµ‹è¯•</h2><blockquote><p>redisçš„å¯åŠ¨æ–¹å¼æœ‰å¾ˆå¤šç§ï¼Œä¾‹å¦‚ï¼š</p><ul><li>é»˜è®¤å¯åŠ¨</li><li>æŒ‡å®šé…ç½®å¯åŠ¨</li><li>å¼€æœºè‡ªå¯</li></ul></blockquote><h3 id="é»˜è®¤å¯åŠ¨ï¼šåœ¨ä»»æ„ç›®å½•ä¸‹æ‰§è¡Œ"><a href="#é»˜è®¤å¯åŠ¨ï¼šåœ¨ä»»æ„ç›®å½•ä¸‹æ‰§è¡Œ" class="headerlink" title="é»˜è®¤å¯åŠ¨ï¼šåœ¨ä»»æ„ç›®å½•ä¸‹æ‰§è¡Œ"></a>é»˜è®¤å¯åŠ¨ï¼šåœ¨ä»»æ„ç›®å½•ä¸‹æ‰§è¡Œ</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-server</span><br></pre></td></tr></table></figure><p>è¿™ç§å¯åŠ¨å±äº<code>å‰å°å¯åŠ¨</code>ï¼Œä¼šé˜»å¡æ•´ä¸ªä¼šè¯çª—å£ï¼Œçª—å£å…³é—­æˆ–è€…æŒ‰ä¸‹<code>CTRL + C</code>åˆ™Redisåœæ­¢ã€‚ä¸æ¨èä½¿ç”¨ã€‚</p><h3 id="æŒ‡å®šé…ç½®å¯åŠ¨"><a href="#æŒ‡å®šé…ç½®å¯åŠ¨" class="headerlink" title="æŒ‡å®šé…ç½®å¯åŠ¨"></a>æŒ‡å®šé…ç½®å¯åŠ¨</h3><p>å¦‚æœè¦è®©Redisä»¥<code>åå°</code>æ–¹å¼å¯åŠ¨ï¼Œåˆ™å¿…é¡»ä¿®æ”¹Redisé…ç½®æ–‡ä»¶ï¼Œå°±åœ¨æˆ‘ä»¬ä¹‹å‰è§£å‹çš„rediså®‰è£…åŒ…ä¸‹ï¼ˆ<code>/usr/local/src/redis-6.2.6</code>ï¼‰ï¼Œåå­—å«redis.conf</p><p>å…ˆå¤‡ä»½ä¸€ä¸‹é»˜è®¤çš„é…ç½®æ–‡ä»¶</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cp</span> redis.conf redis.conf.bck</span><br></pre></td></tr></table></figure><p>ç„¶åä¿®æ”¹redis.confæ–‡ä»¶ä¸­çš„ä¸€äº›é…ç½®</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å…è®¸è®¿é—®çš„åœ°å€ï¼Œé»˜è®¤æ˜¯127.0.0.1ï¼Œä¼šå¯¼è‡´åªèƒ½åœ¨æœ¬åœ°è®¿é—®ã€‚ä¿®æ”¹ä¸º0.0.0.0åˆ™å¯ä»¥åœ¨ä»»æ„IPè®¿é—®ï¼Œç”Ÿäº§ç¯å¢ƒä¸è¦è®¾ç½®ä¸º0.0.0.0</span></span><br><span class="line"><span class="built_in">bind</span> 0.0.0.0</span><br><span class="line"><span class="comment"># å®ˆæŠ¤è¿›ç¨‹ï¼Œä¿®æ”¹ä¸ºyesåå³å¯åå°è¿è¡Œ</span></span><br><span class="line">daemonize <span class="built_in">yes</span> </span><br><span class="line"><span class="comment"># å¯†ç ï¼Œè®¾ç½®åè®¿é—®Rediså¿…é¡»è¾“å…¥å¯†ç </span></span><br><span class="line">requirepass yourpassword</span><br><span class="line"><span class="comment"># æ³¨æ„ï¼švimåº•è¡Œæ¨¡å¼ï¼Œè¾“å…¥/requirepasså›è½¦å³å¯æœç´¢ã€‚</span></span><br></pre></td></tr></table></figure><p>Redisçš„å…¶å®ƒå¸¸è§é…ç½®ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç›‘å¬çš„ç«¯å£</span></span><br><span class="line">port 6379</span><br><span class="line"><span class="comment"># å·¥ä½œç›®å½•ï¼Œé»˜è®¤æ˜¯å½“å‰ç›®å½•ï¼Œä¹Ÿå°±æ˜¯è¿è¡Œredis-serveræ—¶çš„å‘½ä»¤ï¼Œæ—¥å¿—ã€æŒä¹…åŒ–ç­‰æ–‡ä»¶ä¼šä¿å­˜åœ¨è¿™ä¸ªç›®å½•</span></span><br><span class="line"><span class="built_in">dir</span> .</span><br><span class="line"><span class="comment"># æ•°æ®åº“æ•°é‡ï¼Œè®¾ç½®ä¸º1ï¼Œä»£è¡¨åªä½¿ç”¨1ä¸ªåº“ï¼Œé»˜è®¤æœ‰16ä¸ªåº“ï¼Œç¼–å·0~15</span></span><br><span class="line">databases 1</span><br><span class="line"><span class="comment"># è®¾ç½®redisèƒ½å¤Ÿä½¿ç”¨çš„æœ€å¤§å†…å­˜</span></span><br><span class="line">maxmemory 512mb</span><br><span class="line"><span class="comment"># æ—¥å¿—æ–‡ä»¶ï¼Œé»˜è®¤ä¸ºç©ºï¼Œä¸è®°å½•æ—¥å¿—ï¼Œå¯ä»¥æŒ‡å®šæ—¥å¿—æ–‡ä»¶å</span></span><br><span class="line">logfile <span class="string">&quot;redis.log&quot;</span></span><br></pre></td></tr></table></figure><p>å¯åŠ¨redis</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è¿›å…¥rediså®‰è£…ç›®å½• </span></span><br><span class="line"><span class="built_in">cd</span> /usr/local/src/redis-6.2.6</span><br><span class="line"><span class="comment"># å¯åŠ¨</span></span><br><span class="line">redis-server redis.conf</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹è¿›ç¨‹</span></span><br><span class="line">ps -ef | grep redis</span><br></pre></td></tr></table></figure><p>åœæ­¢æœåŠ¡</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ©ç”¨redis-cliæ¥æ‰§è¡Œ shutdown å‘½ä»¤ï¼Œå³å¯åœæ­¢ Redis æœåŠ¡ï¼Œ</span></span><br><span class="line"><span class="comment"># å› ä¸ºä¹‹å‰é…ç½®äº†å¯†ç ï¼Œå› æ­¤éœ€è¦é€šè¿‡ -u æ¥æŒ‡å®šå¯†ç </span></span><br><span class="line">redis-cli -a yourpassword shutdown</span><br><span class="line"></span><br><span class="line"><span class="comment"># æˆ–è€…ç”¨kill</span></span><br><span class="line"><span class="built_in">kill</span> -9 è¿›ç¨‹<span class="built_in">id</span></span><br></pre></td></tr></table></figure><h3 id="å¼€æœºè‡ªå¯"><a href="#å¼€æœºè‡ªå¯" class="headerlink" title="å¼€æœºè‡ªå¯"></a>å¼€æœºè‡ªå¯</h3><p>æ–°å»ºä¸€ä¸ªç³»ç»ŸæœåŠ¡æ–‡ä»¶</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/systemd/system/redis.service</span><br></pre></td></tr></table></figure><p>å†…å®¹å¦‚ä¸‹</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Description=redis-server</span><br><span class="line">After=network.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=forking</span><br><span class="line">ExecStart=/usr/local/bin/redis-server /usr/local/src/redis-6.2.6/redis.conf</span><br><span class="line">PrivateTmp=<span class="literal">true</span></span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure><p>ç„¶åé‡è½½ç³»ç»ŸæœåŠ¡</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl daemon-reload</span><br></pre></td></tr></table></figure><p>ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ä¸‹é¢è¿™ç»„å‘½ä»¤æ¥æ“ä½œredisäº†</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¯åŠ¨</span></span><br><span class="line">systemctl start redis</span><br><span class="line"><span class="comment"># åœæ­¢</span></span><br><span class="line">systemctl stop redis</span><br><span class="line"><span class="comment"># é‡å¯</span></span><br><span class="line">systemctl restart redis</span><br><span class="line"><span class="comment"># æŸ¥çœ‹çŠ¶æ€</span></span><br><span class="line">systemctl status redis</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼Œå¯ä»¥è®©rediså¼€æœºè‡ªå¯ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl <span class="built_in">enable</span> redis</span><br></pre></td></tr></table></figure><h2 id="Rediså‘½ä»¤è¡Œå®¢æˆ·ç«¯"><a href="#Rediså‘½ä»¤è¡Œå®¢æˆ·ç«¯" class="headerlink" title="Rediså‘½ä»¤è¡Œå®¢æˆ·ç«¯"></a>Rediså‘½ä»¤è¡Œå®¢æˆ·ç«¯</h2><p>Rediså®‰è£…å®Œæˆåå°±è‡ªå¸¦äº†å‘½ä»¤è¡Œå®¢æˆ·ç«¯ï¼šredis-cliï¼Œä½¿ç”¨æ–¹å¼å¦‚ä¸‹ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli [options] [commonds]</span><br></pre></td></tr></table></figure><p>å…¶ä¸­å¸¸è§çš„optionsæœ‰ï¼š</p><ul><li><code>-h 127.0.0.1</code>ï¼šæŒ‡å®šè¦è¿æ¥çš„redisèŠ‚ç‚¹çš„IPåœ°å€ï¼Œé»˜è®¤æ˜¯127.0.0.1</li><li><code>-p 6379</code>ï¼šæŒ‡å®šè¦è¿æ¥çš„redisèŠ‚ç‚¹çš„ç«¯å£ï¼Œé»˜è®¤æ˜¯6379</li><li><code>-a 123321</code>ï¼šæŒ‡å®šredisçš„è®¿é—®å¯†ç  </li></ul><p>å…¶ä¸­çš„commondså°±æ˜¯Redisçš„æ“ä½œå‘½ä»¤ï¼Œä¾‹å¦‚ï¼š</p><ul><li><code>ping</code>ï¼šä¸redisæœåŠ¡ç«¯åšå¿ƒè·³æµ‹è¯•ï¼ŒæœåŠ¡ç«¯æ­£å¸¸ä¼šè¿”å›<code>pong</code></li></ul><p>ä¸æŒ‡å®šcommondæ—¶ï¼Œä¼šè¿›å…¥<code>redis-cli</code>çš„äº¤äº’æ§åˆ¶å°ï¼š</p>]]></content>
      
      
      <categories>
          
          <category> åç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> redis </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hello World</title>
      <link href="/post/5.html"/>
      <url>/post/5.html</url>
      
        <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p><h1 id="ä½ å¥½"><a href="#ä½ å¥½" class="headerlink" title="ä½ å¥½"></a>ä½ å¥½</h1><p>å“ˆå“ˆ</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ä»£ç éšæƒ³å½•</title>
      <link href="/post/2.html"/>
      <url>/post/2.html</url>
      
        <content type="html"><![CDATA[<h1 id="æ•°ç»„"><a href="#æ•°ç»„" class="headerlink" title="æ•°ç»„"></a>æ•°ç»„</h1><h4 id="704-äºŒåˆ†æŸ¥æ‰¾"><a href="#704-äºŒåˆ†æŸ¥æ‰¾" class="headerlink" title="704. äºŒåˆ†æŸ¥æ‰¾"></a><a href="https://leetcode.cn/problems/binary-search/">704. äºŒåˆ†æŸ¥æ‰¾</a></h4><h4 id="27-ç§»é™¤å…ƒç´ "><a href="#27-ç§»é™¤å…ƒç´ " class="headerlink" title="27. ç§»é™¤å…ƒç´ "></a><a href="https://leetcode.cn/problems/remove-element/">27. ç§»é™¤å…ƒç´ </a></h4><h4 id="977-æœ‰åºæ•°ç»„çš„å¹³æ–¹"><a href="#977-æœ‰åºæ•°ç»„çš„å¹³æ–¹" class="headerlink" title="977. æœ‰åºæ•°ç»„çš„å¹³æ–¹"></a><a href="https://leetcode.cn/problems/squares-of-a-sorted-array/">977. æœ‰åºæ•°ç»„çš„å¹³æ–¹</a></h4><h4 id="209-é•¿åº¦æœ€å°çš„å­æ•°ç»„â­"><a href="#209-é•¿åº¦æœ€å°çš„å­æ•°ç»„â­" class="headerlink" title="209. é•¿åº¦æœ€å°çš„å­æ•°ç»„â­"></a><a href="https://leetcode.cn/problems/minimum-size-subarray-sum/">209. é•¿åº¦æœ€å°çš„å­æ•°ç»„</a>â­</h4><h4 id="59-èºæ—‹çŸ©é˜µ-IIâ­â­"><a href="#59-èºæ—‹çŸ©é˜µ-IIâ­â­" class="headerlink" title="59. èºæ—‹çŸ©é˜µ IIâ­â­"></a><a href="https://leetcode.cn/problems/spiral-matrix-ii/">59. èºæ—‹çŸ©é˜µ II</a>â­â­</h4><p>é¢˜è§£<a href="https://leetcode.cn/problems/spiral-matrix-ii/solution/spiral-matrix-ii-mo-ni-fa-she-ding-bian-jie-qing-x/">https://leetcode.cn/problems/spiral-matrix-ii/solution/spiral-matrix-ii-mo-ni-fa-she-ding-bian-jie-qing-x/</a></p><h1 id="é“¾è¡¨"><a href="#é“¾è¡¨" class="headerlink" title="é“¾è¡¨"></a>é“¾è¡¨</h1><h4 id="203-ç§»é™¤é“¾è¡¨å…ƒç´ "><a href="#203-ç§»é™¤é“¾è¡¨å…ƒç´ " class="headerlink" title="203. ç§»é™¤é“¾è¡¨å…ƒç´ "></a><a href="https://leetcode.cn/problems/remove-linked-list-elements/">203. ç§»é™¤é“¾è¡¨å…ƒç´ </a></h4><h4 id="707-è®¾è®¡é“¾è¡¨"><a href="#707-è®¾è®¡é“¾è¡¨" class="headerlink" title="707. è®¾è®¡é“¾è¡¨"></a><a href="https://leetcode.cn/problems/design-linked-list/">707. è®¾è®¡é“¾è¡¨</a></h4><h4 id="206-åè½¬é“¾è¡¨"><a href="#206-åè½¬é“¾è¡¨" class="headerlink" title="206. åè½¬é“¾è¡¨"></a><a href="https://leetcode.cn/problems/reverse-linked-list/">206. åè½¬é“¾è¡¨</a></h4><h4 id="24-ä¸¤ä¸¤äº¤æ¢é“¾è¡¨ä¸­çš„èŠ‚ç‚¹"><a href="#24-ä¸¤ä¸¤äº¤æ¢é“¾è¡¨ä¸­çš„èŠ‚ç‚¹" class="headerlink" title="24. ä¸¤ä¸¤äº¤æ¢é“¾è¡¨ä¸­çš„èŠ‚ç‚¹"></a><a href="https://leetcode.cn/problems/swap-nodes-in-pairs/">24. ä¸¤ä¸¤äº¤æ¢é“¾è¡¨ä¸­çš„èŠ‚ç‚¹</a></h4><h4 id="19-åˆ é™¤é“¾è¡¨çš„å€’æ•°ç¬¬-N-ä¸ªç»“ç‚¹"><a href="#19-åˆ é™¤é“¾è¡¨çš„å€’æ•°ç¬¬-N-ä¸ªç»“ç‚¹" class="headerlink" title="19. åˆ é™¤é“¾è¡¨çš„å€’æ•°ç¬¬ N ä¸ªç»“ç‚¹"></a><a href="https://leetcode.cn/problems/remove-nth-node-from-end-of-list/">19. åˆ é™¤é“¾è¡¨çš„å€’æ•°ç¬¬ N ä¸ªç»“ç‚¹</a></h4><h4 id="160-ç›¸äº¤é“¾è¡¨â­"><a href="#160-ç›¸äº¤é“¾è¡¨â­" class="headerlink" title="160. ç›¸äº¤é“¾è¡¨â­"></a><a href="https://leetcode.cn/problems/intersection-of-two-linked-lists/">160. ç›¸äº¤é“¾è¡¨</a>â­</h4><h4 id="142-ç¯å½¢é“¾è¡¨-IIâ­"><a href="#142-ç¯å½¢é“¾è¡¨-IIâ­" class="headerlink" title="142. ç¯å½¢é“¾è¡¨ IIâ­"></a><a href="https://leetcode.cn/problems/linked-list-cycle-ii/">142. ç¯å½¢é“¾è¡¨ II</a>â­</h4><h1 id="å“ˆå¸Œè¡¨"><a href="#å“ˆå¸Œè¡¨" class="headerlink" title="å“ˆå¸Œè¡¨"></a>å“ˆå¸Œè¡¨</h1><h4 id="242-æœ‰æ•ˆçš„å­—æ¯å¼‚ä½è¯"><a href="#242-æœ‰æ•ˆçš„å­—æ¯å¼‚ä½è¯" class="headerlink" title="242. æœ‰æ•ˆçš„å­—æ¯å¼‚ä½è¯"></a><a href="https://leetcode.cn/problems/valid-anagram/">242. æœ‰æ•ˆçš„å­—æ¯å¼‚ä½è¯</a></h4><h4 id="349-ä¸¤ä¸ªæ•°ç»„çš„äº¤é›†"><a href="#349-ä¸¤ä¸ªæ•°ç»„çš„äº¤é›†" class="headerlink" title="349. ä¸¤ä¸ªæ•°ç»„çš„äº¤é›†"></a><a href="https://leetcode.cn/problems/intersection-of-two-arrays/">349. ä¸¤ä¸ªæ•°ç»„çš„äº¤é›†</a></h4><h4 id="202-å¿«ä¹æ•°â­â­"><a href="#202-å¿«ä¹æ•°â­â­" class="headerlink" title="202. å¿«ä¹æ•°â­â­"></a><a href="https://leetcode.cn/problems/happy-number/">202. å¿«ä¹æ•°</a>â­â­</h4><h4 id="1-ä¸¤æ•°ä¹‹å’Œ"><a href="#1-ä¸¤æ•°ä¹‹å’Œ" class="headerlink" title="1. ä¸¤æ•°ä¹‹å’Œ"></a><a href="https://leetcode.cn/problems/two-sum/">1. ä¸¤æ•°ä¹‹å’Œ</a></h4><h4 id="454-å››æ•°ç›¸åŠ -IIâ­"><a href="#454-å››æ•°ç›¸åŠ -IIâ­" class="headerlink" title="454. å››æ•°ç›¸åŠ  IIâ­"></a><a href="https://leetcode.cn/problems/4sum-ii/">454. å››æ•°ç›¸åŠ  IIâ­</a></h4><h4 id="383-èµé‡‘ä¿¡"><a href="#383-èµé‡‘ä¿¡" class="headerlink" title="383. èµé‡‘ä¿¡"></a><a href="https://leetcode.cn/problems/ransom-note/">383. èµé‡‘ä¿¡</a></h4><h4 id="15-ä¸‰æ•°ä¹‹å’Œâ­â­â­"><a href="#15-ä¸‰æ•°ä¹‹å’Œâ­â­â­" class="headerlink" title="15. ä¸‰æ•°ä¹‹å’Œâ­â­â­"></a><a href="https://leetcode.cn/problems/3sum/">15. ä¸‰æ•°ä¹‹å’Œ</a>â­â­â­</h4><h4 id="18-å››æ•°ä¹‹å’Œ"><a href="#18-å››æ•°ä¹‹å’Œ" class="headerlink" title="18. å››æ•°ä¹‹å’Œ"></a><a href="https://leetcode.cn/problems/4sum/">18. å››æ•°ä¹‹å’Œ</a></h4><h1 id="å­—ç¬¦ä¸²"><a href="#å­—ç¬¦ä¸²" class="headerlink" title="å­—ç¬¦ä¸²"></a>å­—ç¬¦ä¸²</h1><h4 id="344-åè½¬å­—ç¬¦ä¸²"><a href="#344-åè½¬å­—ç¬¦ä¸²" class="headerlink" title="344. åè½¬å­—ç¬¦ä¸²"></a><a href="https://leetcode.cn/problems/reverse-string/">344. åè½¬å­—ç¬¦ä¸²</a></h4><h4 id="541-åè½¬å­—ç¬¦ä¸²-II"><a href="#541-åè½¬å­—ç¬¦ä¸²-II" class="headerlink" title="541. åè½¬å­—ç¬¦ä¸² II"></a><a href="https://leetcode.cn/problems/reverse-string-ii/">541. åè½¬å­—ç¬¦ä¸² II</a></h4><h4 id="å‰‘æŒ‡-Offer-05-æ›¿æ¢ç©ºæ ¼"><a href="#å‰‘æŒ‡-Offer-05-æ›¿æ¢ç©ºæ ¼" class="headerlink" title="å‰‘æŒ‡ Offer 05. æ›¿æ¢ç©ºæ ¼"></a><a href="https://leetcode.cn/problems/ti-huan-kong-ge-lcof/">å‰‘æŒ‡ Offer 05. æ›¿æ¢ç©ºæ ¼</a></h4><h4 id="151-åè½¬å­—ç¬¦ä¸²ä¸­çš„å•è¯"><a href="#151-åè½¬å­—ç¬¦ä¸²ä¸­çš„å•è¯" class="headerlink" title="151. åè½¬å­—ç¬¦ä¸²ä¸­çš„å•è¯"></a><a href="https://leetcode.cn/problems/reverse-words-in-a-string/">151. åè½¬å­—ç¬¦ä¸²ä¸­çš„å•è¯</a></h4><h4 id="å‰‘æŒ‡-Offer-58-II-å·¦æ—‹è½¬å­—ç¬¦ä¸²"><a href="#å‰‘æŒ‡-Offer-58-II-å·¦æ—‹è½¬å­—ç¬¦ä¸²" class="headerlink" title="å‰‘æŒ‡ Offer 58 - II. å·¦æ—‹è½¬å­—ç¬¦ä¸²"></a><a href="https://leetcode.cn/problems/zuo-xuan-zhuan-zi-fu-chuan-lcof/">å‰‘æŒ‡ Offer 58 - II. å·¦æ—‹è½¬å­—ç¬¦ä¸²</a></h4><h4 id="28-æ‰¾å‡ºå­—ç¬¦ä¸²ä¸­ç¬¬ä¸€ä¸ªåŒ¹é…é¡¹çš„ä¸‹æ ‡"><a href="#28-æ‰¾å‡ºå­—ç¬¦ä¸²ä¸­ç¬¬ä¸€ä¸ªåŒ¹é…é¡¹çš„ä¸‹æ ‡" class="headerlink" title="28. æ‰¾å‡ºå­—ç¬¦ä¸²ä¸­ç¬¬ä¸€ä¸ªåŒ¹é…é¡¹çš„ä¸‹æ ‡"></a><a href="https://leetcode.cn/problems/find-the-index-of-the-first-occurrence-in-a-string/">28. æ‰¾å‡ºå­—ç¬¦ä¸²ä¸­ç¬¬ä¸€ä¸ªåŒ¹é…é¡¹çš„ä¸‹æ ‡</a></h4><h4 id="459-é‡å¤çš„å­å­—ç¬¦ä¸²"><a href="#459-é‡å¤çš„å­å­—ç¬¦ä¸²" class="headerlink" title="459. é‡å¤çš„å­å­—ç¬¦ä¸²"></a><a href="https://leetcode.cn/problems/repeated-substring-pattern/">459. é‡å¤çš„å­å­—ç¬¦ä¸²</a></h4><h1 id="åŒæŒ‡é’ˆ"><a href="#åŒæŒ‡é’ˆ" class="headerlink" title="åŒæŒ‡é’ˆ"></a>åŒæŒ‡é’ˆ</h1><h4 id="27-ç§»é™¤å…ƒç´ -1"><a href="#27-ç§»é™¤å…ƒç´ -1" class="headerlink" title="27. ç§»é™¤å…ƒç´ "></a><a href="https://leetcode.cn/problems/remove-element/">27. ç§»é™¤å…ƒç´ </a></h4><h4 id="344-åè½¬å­—ç¬¦ä¸²-1"><a href="#344-åè½¬å­—ç¬¦ä¸²-1" class="headerlink" title="344. åè½¬å­—ç¬¦ä¸²"></a><a href="https://leetcode.cn/problems/reverse-string/">344. åè½¬å­—ç¬¦ä¸²</a></h4><h4 id="å‰‘æŒ‡-Offer-05-æ›¿æ¢ç©ºæ ¼-1"><a href="#å‰‘æŒ‡-Offer-05-æ›¿æ¢ç©ºæ ¼-1" class="headerlink" title="å‰‘æŒ‡ Offer 05. æ›¿æ¢ç©ºæ ¼"></a><a href="https://leetcode.cn/problems/ti-huan-kong-ge-lcof/">å‰‘æŒ‡ Offer 05. æ›¿æ¢ç©ºæ ¼</a></h4><h4 id="151-åè½¬å­—ç¬¦ä¸²ä¸­çš„å•è¯-1"><a href="#151-åè½¬å­—ç¬¦ä¸²ä¸­çš„å•è¯-1" class="headerlink" title="151. åè½¬å­—ç¬¦ä¸²ä¸­çš„å•è¯"></a><a href="https://leetcode.cn/problems/reverse-words-in-a-string/">151. åè½¬å­—ç¬¦ä¸²ä¸­çš„å•è¯</a></h4><h4 id="206-åè½¬é“¾è¡¨-1"><a href="#206-åè½¬é“¾è¡¨-1" class="headerlink" title="206. åè½¬é“¾è¡¨"></a><a href="https://leetcode.cn/problems/reverse-linked-list/">206. åè½¬é“¾è¡¨</a></h4><h4 id="19-åˆ é™¤é“¾è¡¨çš„å€’æ•°ç¬¬-N-ä¸ªç»“ç‚¹-1"><a href="#19-åˆ é™¤é“¾è¡¨çš„å€’æ•°ç¬¬-N-ä¸ªç»“ç‚¹-1" class="headerlink" title="19. åˆ é™¤é“¾è¡¨çš„å€’æ•°ç¬¬ N ä¸ªç»“ç‚¹"></a><a href="https://leetcode.cn/problems/remove-nth-node-from-end-of-list/">19. åˆ é™¤é“¾è¡¨çš„å€’æ•°ç¬¬ N ä¸ªç»“ç‚¹</a></h4><h4 id="160-ç›¸äº¤é“¾è¡¨"><a href="#160-ç›¸äº¤é“¾è¡¨" class="headerlink" title="160. ç›¸äº¤é“¾è¡¨"></a><a href="https://leetcode.cn/problems/intersection-of-two-linked-lists/">160. ç›¸äº¤é“¾è¡¨</a></h4><h4 id="142-ç¯å½¢é“¾è¡¨-II"><a href="#142-ç¯å½¢é“¾è¡¨-II" class="headerlink" title="142. ç¯å½¢é“¾è¡¨ II"></a><a href="https://leetcode.cn/problems/linked-list-cycle-ii/">142. ç¯å½¢é“¾è¡¨ II</a></h4><h4 id="15-ä¸‰æ•°ä¹‹å’Œâ­â­â­-1"><a href="#15-ä¸‰æ•°ä¹‹å’Œâ­â­â­-1" class="headerlink" title="15. ä¸‰æ•°ä¹‹å’Œâ­â­â­"></a><a href="https://leetcode.cn/problems/3sum/">15. ä¸‰æ•°ä¹‹å’Œ</a>â­â­â­</h4><h4 id="18-å››æ•°ä¹‹å’Œ-1"><a href="#18-å››æ•°ä¹‹å’Œ-1" class="headerlink" title="18. å››æ•°ä¹‹å’Œ"></a><a href="https://leetcode.cn/problems/4sum/">18. å››æ•°ä¹‹å’Œ</a></h4><h1 id="æ ˆä¸é˜Ÿåˆ—"><a href="#æ ˆä¸é˜Ÿåˆ—" class="headerlink" title="æ ˆä¸é˜Ÿåˆ—"></a>æ ˆä¸é˜Ÿåˆ—</h1><p>232.ç”¨æ ˆå®ç°é˜Ÿåˆ—</p><ol><li>ç”¨é˜Ÿåˆ—å®ç°æ ˆ</li></ol><ol><li><p>æœ‰æ•ˆçš„æ‹¬å·</p><ol><li>åˆ é™¤å­—ç¬¦ä¸²ä¸­çš„æ‰€æœ‰ç›¸é‚»é‡å¤é¡¹</li></ol></li><li><p>é€†æ³¢å…°è¡¨è¾¾å¼æ±‚å€¼</p></li><li><p>æ»‘åŠ¨çª—å£æœ€å¤§å€¼</p></li></ol><p>347.å‰ K ä¸ªé«˜é¢‘å…ƒç´ </p><h1 id="äºŒå‰æ ‘"><a href="#äºŒå‰æ ‘" class="headerlink" title="äºŒå‰æ ‘"></a>äºŒå‰æ ‘</h1><p>äºŒå‰æ ‘çš„é€’å½’éå†</p><p>äºŒå‰æ ‘çš„è¿­ä»£éå†</p><p>äºŒå‰æ ‘çš„ç»Ÿä¸€è¿­ä»£æ³•</p><p>äºŒå‰æ ‘å±‚åºéå†</p><p>226.ç¿»è½¬äºŒå‰æ ‘</p><ol><li>å¯¹ç§°äºŒå‰æ ‘</li></ol><p>104.äºŒå‰æ ‘çš„æœ€å¤§æ·±åº¦</p><p>111.äºŒå‰æ ‘çš„æœ€å°æ·±åº¦</p><p>222.å®Œå…¨äºŒå‰æ ‘çš„èŠ‚ç‚¹ä¸ªæ•°</p><p>110.å¹³è¡¡äºŒå‰æ ‘</p><ol><li>äºŒå‰æ ‘çš„æ‰€æœ‰è·¯å¾„<br>404.å·¦å¶å­ä¹‹å’Œ</li></ol><p>513.æ‰¾æ ‘å·¦ä¸‹è§’çš„å€¼</p><ol><li>è·¯å¾„æ€»å’Œ</li></ol><p>106.ä»ä¸­åºä¸ååºéå†åºåˆ—æ„é€ äºŒå‰æ ‘</p><p>654.æœ€å¤§äºŒå‰æ ‘</p><p>617.åˆå¹¶äºŒå‰æ ‘</p><p>700.äºŒå‰æœç´¢æ ‘ä¸­çš„æœç´¢</p><p>98.éªŒè¯äºŒå‰æœç´¢æ ‘</p><p>530.äºŒå‰æœç´¢æ ‘çš„æœ€å°ç»å¯¹å·®</p><p>501.äºŒå‰æœç´¢æ ‘ä¸­çš„ä¼—æ•°</p><ol><li><p>äºŒå‰æ ‘çš„æœ€è¿‘å…¬å…±ç¥–å…ˆ</p></li><li><p>äºŒå‰æœç´¢æ ‘çš„æœ€è¿‘å…¬å…±ç¥–å…ˆ</p></li></ol><p>701.äºŒå‰æœç´¢æ ‘ä¸­çš„æ’å…¥æ“ä½œ</p><p>450.åˆ é™¤äºŒå‰æœç´¢æ ‘ä¸­çš„èŠ‚ç‚¹</p><ol><li>ä¿®å‰ªäºŒå‰æœç´¢æ ‘</li></ol><p>108.å°†æœ‰åºæ•°ç»„è½¬æ¢ä¸ºäºŒå‰æœç´¢æ ‘</p><p>538.æŠŠäºŒå‰æœç´¢æ ‘è½¬æ¢ä¸ºç´¯åŠ æ ‘</p><h1 id="å•è°ƒæ ˆâ­â­â­"><a href="#å•è°ƒæ ˆâ­â­â­" class="headerlink" title="å•è°ƒæ ˆâ­â­â­"></a>å•è°ƒæ ˆâ­â­â­</h1><h4 id="739-æ¯æ—¥æ¸©åº¦"><a href="#739-æ¯æ—¥æ¸©åº¦" class="headerlink" title="739. æ¯æ—¥æ¸©åº¦"></a><a href="https://leetcode.cn/problems/daily-temperatures/">739. æ¯æ—¥æ¸©åº¦</a></h4><h4 id="496-ä¸‹ä¸€ä¸ªæ›´å¤§å…ƒç´ -I"><a href="#496-ä¸‹ä¸€ä¸ªæ›´å¤§å…ƒç´ -I" class="headerlink" title="496. ä¸‹ä¸€ä¸ªæ›´å¤§å…ƒç´  I"></a><a href="https://leetcode.cn/problems/next-greater-element-i/">496. ä¸‹ä¸€ä¸ªæ›´å¤§å…ƒç´  I</a></h4><h4 id="503-ä¸‹ä¸€ä¸ªæ›´å¤§å…ƒç´ -IIâ­"><a href="#503-ä¸‹ä¸€ä¸ªæ›´å¤§å…ƒç´ -IIâ­" class="headerlink" title="503. ä¸‹ä¸€ä¸ªæ›´å¤§å…ƒç´  IIâ­"></a><a href="https://leetcode.cn/problems/next-greater-element-ii/">503. ä¸‹ä¸€ä¸ªæ›´å¤§å…ƒç´  II</a>â­</h4><h4 id="42-æ¥é›¨æ°´"><a href="#42-æ¥é›¨æ°´" class="headerlink" title="42. æ¥é›¨æ°´"></a><a href="https://leetcode.cn/problems/trapping-rain-water/">42. æ¥é›¨æ°´</a></h4><h1 id="ä¼˜å…ˆé˜Ÿåˆ—ï¼ˆå †ï¼‰"><a href="#ä¼˜å…ˆé˜Ÿåˆ—ï¼ˆå †ï¼‰" class="headerlink" title="ä¼˜å…ˆé˜Ÿåˆ—ï¼ˆå †ï¼‰"></a>ä¼˜å…ˆé˜Ÿåˆ—ï¼ˆå †ï¼‰</h1><h4 id="215-æ•°ç»„ä¸­çš„ç¬¬Kä¸ªæœ€å¤§å…ƒç´ "><a href="#215-æ•°ç»„ä¸­çš„ç¬¬Kä¸ªæœ€å¤§å…ƒç´ " class="headerlink" title="215. æ•°ç»„ä¸­çš„ç¬¬Kä¸ªæœ€å¤§å…ƒç´ "></a><a href="https://leetcode.cn/problems/kth-largest-element-in-an-array/">215. æ•°ç»„ä¸­çš„ç¬¬Kä¸ªæœ€å¤§å…ƒç´ </a></h4><h4 id="347-å‰-K-ä¸ªé«˜é¢‘å…ƒç´ "><a href="#347-å‰-K-ä¸ªé«˜é¢‘å…ƒç´ " class="headerlink" title="347. å‰ K ä¸ªé«˜é¢‘å…ƒç´ "></a><a href="https://leetcode.cn/problems/top-k-frequent-elements/">347. å‰ K ä¸ªé«˜é¢‘å…ƒç´ </a></h4><h1 id="è…¾è®¯"><a href="#è…¾è®¯" class="headerlink" title="è…¾è®¯"></a>è…¾è®¯</h1><h4 id="679-24-ç‚¹æ¸¸æˆ"><a href="#679-24-ç‚¹æ¸¸æˆ" class="headerlink" title="679. 24 ç‚¹æ¸¸æˆ"></a><a href="https://leetcode.cn/problems/24-game/">679. 24 ç‚¹æ¸¸æˆ</a></h4><h4 id="1262-å¯è¢«ä¸‰æ•´é™¤çš„æœ€å¤§å’Œ"><a href="#1262-å¯è¢«ä¸‰æ•´é™¤çš„æœ€å¤§å’Œ" class="headerlink" title="1262. å¯è¢«ä¸‰æ•´é™¤çš„æœ€å¤§å’Œ"></a><a href="https://leetcode.cn/problems/greatest-sum-divisible-by-three/">1262. å¯è¢«ä¸‰æ•´é™¤çš„æœ€å¤§å’Œ</a></h4><h4 id="é¢è¯•é¢˜-02-02-è¿”å›å€’æ•°ç¬¬-k-ä¸ªèŠ‚ç‚¹"><a href="#é¢è¯•é¢˜-02-02-è¿”å›å€’æ•°ç¬¬-k-ä¸ªèŠ‚ç‚¹" class="headerlink" title="é¢è¯•é¢˜ 02.02. è¿”å›å€’æ•°ç¬¬ k ä¸ªèŠ‚ç‚¹"></a><a href="https://leetcode.cn/problems/kth-node-from-end-of-list-lcci/">é¢è¯•é¢˜ 02.02. è¿”å›å€’æ•°ç¬¬ k ä¸ªèŠ‚ç‚¹</a></h4><h4 id="53-æœ€å¤§å­æ•°ç»„å’Œ"><a href="#53-æœ€å¤§å­æ•°ç»„å’Œ" class="headerlink" title="53. æœ€å¤§å­æ•°ç»„å’Œ"></a><a href="https://leetcode.cn/problems/maximum-subarray/">53. æœ€å¤§å­æ•°ç»„å’Œ</a></h4>]]></content>
      
      
      <categories>
          
          <category> ç®—æ³• </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>JVM</title>
      <link href="/post/8.html"/>
      <url>/post/8.html</url>
      
        <content type="html"><![CDATA[<h1 id="HotSpot-VM"><a href="#HotSpot-VM" class="headerlink" title="HotSpot VM"></a>HotSpot VM</h1><h3 id="JVMæ¶æ„ç®€å›¾"><a href="#JVMæ¶æ„ç®€å›¾" class="headerlink" title="JVMæ¶æ„ç®€å›¾"></a>JVMæ¶æ„ç®€å›¾</h3><p><img src="http://cdn.leesin.fun/typora/s3/img/ç¬¬02ç« _JVMæ¶æ„-ç®€å›¾.jpg" alt="ç¬¬02ç« _JVMæ¶æ„-ç®€å›¾" style="zoom:33%;"></p><h3 id="JVMæ¶æ„è¯¦ç»†å›¾ï¼ˆä¸­æ–‡ï¼‰"><a href="#JVMæ¶æ„è¯¦ç»†å›¾ï¼ˆä¸­æ–‡ï¼‰" class="headerlink" title="JVMæ¶æ„è¯¦ç»†å›¾ï¼ˆä¸­æ–‡ï¼‰"></a>JVMæ¶æ„è¯¦ç»†å›¾ï¼ˆä¸­æ–‡ï¼‰</h3><p><img src="http://cdn.leesin.fun/typora/s3/img/ç¬¬02ç« _JVMæ¶æ„-ä¸­.jpg" alt="ç¬¬02ç« _JVMæ¶æ„-ä¸­" style="zoom:33%;"></p><h3 id="JVMæ¶æ„è¯¦ç»†å›¾ï¼ˆè‹±æ–‡ï¼‰"><a href="#JVMæ¶æ„è¯¦ç»†å›¾ï¼ˆè‹±æ–‡ï¼‰" class="headerlink" title="JVMæ¶æ„è¯¦ç»†å›¾ï¼ˆè‹±æ–‡ï¼‰"></a>JVMæ¶æ„è¯¦ç»†å›¾ï¼ˆè‹±æ–‡ï¼‰</h3><p><img src="http://cdn.leesin.fun/typora/s3/img/ç¬¬02ç« _JVMæ¶æ„-è‹±.jpg" alt="ç¬¬02ç« _JVMæ¶æ„-è‹±" style="zoom: 33%;"></p><h1 id="Class-Loader-Subsystem"><a href="#Class-Loader-Subsystem" class="headerlink" title="Class Loader Subsystem"></a>Class Loader Subsystem</h1><p><img src="http://cdn.leesin.fun/typora/s3/img/ç±»åŠ è½½å­ç³»ç»Ÿ.png" alt="ç±»åŠ è½½å­ç³»ç»Ÿ" style="zoom:33%;"></p><h3 id="ç±»çš„åŠ è½½è¿‡ç¨‹"><a href="#ç±»çš„åŠ è½½è¿‡ç¨‹" class="headerlink" title="ç±»çš„åŠ è½½è¿‡ç¨‹"></a>ç±»çš„åŠ è½½è¿‡ç¨‹</h3><p><img src="http://cdn.leesin.fun/typora/s3/img/ç±»çš„åŠ è½½è¿‡ç¨‹.png" alt="ç±»çš„åŠ è½½è¿‡ç¨‹"></p><h5 id="åŠ è½½loading"><a href="#åŠ è½½loading" class="headerlink" title="åŠ è½½loading"></a>åŠ è½½loading</h5><ol><li>é€šè¿‡ä¸€ä¸ªç±»çš„å…¨é™å®šåè·å–å®šä¹‰æ­¤ç±»çš„äºŒè¿›åˆ¶å­—èŠ‚æµã€‚</li><li>å°†è¿™ä¸ªå­—èŠ‚æµæ‰€ä»£è¡¨çš„é™æ€å­˜å‚¨ç»“æ„è½¬åŒ–ä¸ºæ–¹æ³•åŒºçš„è¿è¡Œæ—¶æ•°æ®ç»“æ„</li><li>==åœ¨å†…å­˜ä¸­ç”Ÿæˆä¸€ä¸ªä»£è¡¨è¿™ä¸ªç±»çš„java.lang.Classå¯¹è±¡==ï¼Œä½œä¸ºæ–¹æ³•åŒºè¿™ä¸ªç±»çš„å„ç§æ•°æ®çš„è®¿é—®å…¥å£ã€‚</li></ol><h5 id="é“¾æ¥Linking-â€”-éªŒè¯Verification"><a href="#é“¾æ¥Linking-â€”-éªŒè¯Verification" class="headerlink" title="é“¾æ¥Linking â€” éªŒè¯Verification"></a>é“¾æ¥Linking â€” éªŒè¯Verification</h5><ul><li>ç›®çš„åœ¨äºç¡®ä¿classæ–‡ä»¶çš„å­—èŠ‚æµä¸­åŒ…å«ä¿¡æ¯ç¬¦åˆå½“å‰è™šæ‹Ÿæœºè¦æ±‚ï¼Œä¿è¯è¢«åŠ è½½ç±»çš„æ­£ç¡®æ€§ï¼Œä¿è¯ä¸ä¼šå±å®³è™šæ‹Ÿæœºè‡ªèº«å®‰å…¨ã€‚</li><li>ä¸»è¦åŒ…æ‹¬å››ç§éªŒè¯ï¼šæ–‡ä»¶æ ¼å¼éªŒè¯ï¼Œå…ƒæ•°æ®éªŒè¯ï¼Œå­—èŠ‚ç éªŒè¯ï¼Œç¬¦å·å¼•ç”¨éªŒè¯ã€‚</li></ul><h5 id="é“¾æ¥Linking-â€”-å‡†å¤‡Prepare"><a href="#é“¾æ¥Linking-â€”-å‡†å¤‡Prepare" class="headerlink" title="é“¾æ¥Linking â€” å‡†å¤‡Prepare"></a>é“¾æ¥Linking â€” å‡†å¤‡Prepare</h5><ul><li>ä¸ºç±»å˜é‡ï¼ˆstaticï¼‰åˆ†é…å†…å­˜ï¼Œå¹¶ä¸”è®¾ç½®è¯¥ç±»å˜é‡çš„é»˜è®¤åˆå§‹å€¼ï¼ˆå³é›¶å€¼ï¼‰<ul><li>==è¿™é‡Œçš„ç±»å˜é‡ä¸åŒ…å«ç”¨finalä¿®é¥°çš„staticã€‚==å› ä¸ºfinalåœ¨ç¼–è¯‘çš„æ—¶å€™å°±ä¼šåˆ†é…äº†ï¼Œå‡†å¤‡é˜¶æ®µä¼šæ˜¾ç¤ºåˆå§‹åŒ–</li></ul></li><li>==å‡†å¤‡é˜¶æ®µä¸ä¼šä¸ºå®ä¾‹å˜é‡åˆ†é…åˆå§‹åŒ–ã€‚==ç±»å˜é‡åˆ†é…åœ¨æ–¹æ³•åŒºä¸­ï¼Œè€Œå®ä¾‹å˜é‡ä¼šéšç€å¯¹è±¡ä¸€èµ·åˆ†é…åˆ°Javaå †ä¸­ã€‚</li></ul><h5 id="é“¾æ¥Linking-â€”-è§£æResolve"><a href="#é“¾æ¥Linking-â€”-è§£æResolve" class="headerlink" title="é“¾æ¥Linking â€” è§£æResolve"></a>é“¾æ¥Linking â€” è§£æResolve</h5><ul><li>å°†å¸¸é‡æ± å†…çš„ç¬¦å·å¼•ç”¨è½¬æ¢ä¸ºç›´æ¥å¼•ç”¨çš„è¿‡ç¨‹ã€‚</li><li>äº‹å®ä¸Šï¼Œè§£ææ“ä½œå¾€å¾€ä¼šä¼´éšç€JVMåœ¨æ‰§è¡Œå®Œåˆå§‹åŒ–ä¹‹åå†æ‰§è¡Œã€‚</li></ul><h5 id="åˆå§‹åŒ–Initialization"><a href="#åˆå§‹åŒ–Initialization" class="headerlink" title="åˆå§‹åŒ–Initialization"></a>åˆå§‹åŒ–Initialization</h5><ul><li><p>==åˆå§‹åŒ–é˜¶æ®µå°±æ˜¯æ‰§è¡Œç±»æ„é€ å™¨æ–¹æ³• <code>&lt;clinit&gt;()</code> çš„è¿‡ç¨‹ã€‚==</p></li><li><p>æ­¤æ–¹æ³•ä¸éœ€è¦å®šä¹‰ï¼Œæ˜¯javacç¼–è¯‘å™¨è‡ªåŠ¨æ”¶é›†ç±»ä¸­çš„æ‰€æœ‰ç±»å˜é‡çš„èµ‹å€¼åŠ¨ä½œå’Œé™æ€ä»£ç å—ä¸­çš„è¯­å¥åˆå¹¶è€Œæ¥ã€‚</p></li><li>ç±»æ„é€ å™¨æ–¹æ³•ä¸­æŒ‡ä»¤æŒ‰è¯­å¥åœ¨æºæ–‡ä»¶ä¸­å‡ºç°çš„é¡ºåºæ‰§è¡Œã€‚</li><li><code>&lt;clinit&gt;()</code> ä¸åŒäºç±»çš„æ„é€ å™¨ã€‚ï¼ˆæ„é€ å™¨åœ¨è™šæ‹Ÿæœºè§†è§’ä¸‹æ˜¯ <code>&lt;init&gt;()</code> ï¼‰</li><li>è‹¥è¯¥ç±»å…·æœ‰çˆ¶ç±»ï¼ŒJVMä¼šä¿è¯å­ç±»çš„ <code>&lt;clinit&gt;()</code> æ‰§è¡Œå‰ï¼Œçˆ¶ç±»çš„ <code>&lt;clinit&gt;()</code> å·²ç»æ‰§è¡Œå®Œæ¯•ã€‚</li><li>è™šæ‹Ÿæœºå¿…é¡»ä¿è¯ä¸€ä¸ªç±»çš„ <code>&lt;clinit&gt;()</code> æ–¹æ³•åœ¨å¤šçº¿ç¨‹ä¸‹è¢«åŒæ­¥åŠ é”ã€‚</li></ul><h3 id="ç±»åŠ è½½å™¨"><a href="#ç±»åŠ è½½å™¨" class="headerlink" title="ç±»åŠ è½½å™¨"></a>ç±»åŠ è½½å™¨</h3><ul><li><p>æœ‰ä¸¤ç§ï¼š==å¼•å¯¼ç±»åŠ è½½å™¨ï¼ˆBootstrap ClassLoaderï¼‰==å’Œ==è‡ªå®šä¹‰ç±»åŠ è½½å™¨(User-Defined ClassLoaderï¼‰==</p></li><li><p>æ‰€æœ‰æ´¾ç”ŸäºæŠ½è±¡ç±»ClassLoaderçš„ç±»åŠ è½½å™¨éƒ½åˆ’åˆ†ä¸ºè‡ªå®šä¹‰ç±»åŠ è½½å™¨ã€‚</p></li></ul><p><img src="http://cdn.leesin.fun/typora/s3/img/ç±»åŠ è½½å™¨çš„åˆ†ç±».png" alt="ç±»åŠ è½½å™¨çš„åˆ†ç±»" style="zoom:33%;"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ClassLoaderTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//è·å–ç³»ç»Ÿç±»åŠ è½½å™¨</span></span><br><span class="line">        <span class="type">ClassLoader</span> <span class="variable">systemClassLoader</span> <span class="operator">=</span> ClassLoader.getSystemClassLoader();</span><br><span class="line">    System.out.println(systemClassLoader);</span><br><span class="line">        <span class="comment">//sun.misc.Launcher$AppClassLoader@18b4aac2</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//è·å–å…¶ä¸Šå±‚ï¼šæ‰©å±•ç±»åŠ è½½å™¨</span></span><br><span class="line">        <span class="type">ClassLoader</span> <span class="variable">extClassLoader</span> <span class="operator">=</span> systemClassLoader.getParent();</span><br><span class="line">       System.out.println(extClassLoader);</span><br><span class="line">        <span class="comment">//sun.misc.Launcher$ExtClassLoader@1b6d3586</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//è·å–å…¶ä¸Šå±‚ï¼šè·å–ä¸åˆ°å¼•å¯¼ç±»åŠ è½½å™¨</span></span><br><span class="line">        <span class="type">ClassLoader</span> <span class="variable">bootstrapClassLoader</span> <span class="operator">=</span> extClassLoader.getParent();</span><br><span class="line">        System.out.println(bootstrapClassLoader);<span class="comment">//null</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//å¯¹äºç”¨æˆ·è‡ªå®šä¹‰ç±»æ¥è¯´ï¼šé»˜è®¤ä½¿ç”¨ç³»ç»Ÿç±»åŠ è½½å™¨è¿›è¡ŒåŠ è½½</span></span><br><span class="line">        <span class="type">ClassLoader</span> <span class="variable">classLoader</span> <span class="operator">=</span> ClassLoaderTest.class.getClassLoader();</span><br><span class="line">        System.out.println(classLoader);</span><br><span class="line">        <span class="comment">//sun.misc.Launcher$AppClassLoader@18b4aac2</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//Stringç±»ä½¿ç”¨å¼•å¯¼ç±»åŠ è½½å™¨è¿›è¡ŒåŠ è½½çš„ã€‚---&gt; Javaçš„æ ¸å¿ƒç±»åº“éƒ½æ˜¯ä½¿ç”¨å¼•å¯¼ç±»åŠ è½½å™¨è¿›è¡ŒåŠ è½½çš„ã€‚</span></span><br><span class="line">        <span class="type">ClassLoader</span> <span class="variable">classLoader1</span> <span class="operator">=</span> String.class.getClassLoader();</span><br><span class="line">        System.out.println(classLoader1);<span class="comment">//null</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="å¯åŠ¨ç±»åŠ è½½å™¨ï¼ˆå¼•å¯¼ç±»åŠ è½½å™¨ï¼ŒBoostrap-ClassLoaderï¼‰"><a href="#å¯åŠ¨ç±»åŠ è½½å™¨ï¼ˆå¼•å¯¼ç±»åŠ è½½å™¨ï¼ŒBoostrap-ClassLoaderï¼‰" class="headerlink" title="å¯åŠ¨ç±»åŠ è½½å™¨ï¼ˆå¼•å¯¼ç±»åŠ è½½å™¨ï¼ŒBoostrap ClassLoaderï¼‰"></a>å¯åŠ¨ç±»åŠ è½½å™¨ï¼ˆå¼•å¯¼ç±»åŠ è½½å™¨ï¼ŒBoostrap ClassLoaderï¼‰</h5><ul><li>è¿™ä¸ªç±»åŠ è½½å™¨ä½¿ç”¨==C/C++è¯­è¨€å®ç°çš„==ï¼ŒåµŒå¥—åœ¨JVMå†…éƒ¨</li><li>å®ƒç”¨æ¥åŠ è½½Javaçš„æ ¸å¿ƒåº“ï¼ˆjAVA_HOME/jre/lib/rt.jarã€resources.jaræˆ–sun.boot.class.path è·¯å¾„ä¸‹çš„å†…å®¹ï¼‰ï¼Œç”¨äºæä¾›JVMè‡ªèº«éœ€è¦çš„ç±»</li><li>å¹¶ä¸ç»§æ‰¿ java.lang.ClassLoader ï¼Œæ²¡æœ‰çˆ¶åŠ è½½å™¨</li><li>åŠ è½½æ‰©å±•ç±»å’Œåº”ç”¨ç¨‹åºç±»åŠ è½½å™¨ï¼Œå¹¶æŒ‡å®šä¸ºä»–ä»¬çš„çˆ¶åŠ è½½å™¨</li><li>å‡ºäºå®‰å…¨è€ƒè™‘ï¼ŒBootstrap å¯åŠ¨ç±»åŠ è½½å™¨åªåŠ è½½åŒ…åä¸º javaã€javaxã€sunç­‰å¼€å¤´çš„ç±»ã€‚</li></ul><h5 id="æ‰©å±•ç±»åŠ è½½å™¨ï¼ˆExtension-ClassLoaderï¼‰"><a href="#æ‰©å±•ç±»åŠ è½½å™¨ï¼ˆExtension-ClassLoaderï¼‰" class="headerlink" title="æ‰©å±•ç±»åŠ è½½å™¨ï¼ˆExtension ClassLoaderï¼‰"></a>æ‰©å±•ç±»åŠ è½½å™¨ï¼ˆExtension ClassLoaderï¼‰</h5><ul><li>==Javaè¯­è¨€ç¼–å†™==ï¼Œç”± sun.misc.Launcher$ExtClassLoader å®ç°</li><li>==æ˜¯ java.lang.ClassLoader çš„å­ç±»==</li><li>çˆ¶åŠ è½½å™¨ä¸ºå¯åŠ¨ç±»åŠ è½½å™¨</li><li>ä» java.ext.dirs ç³»ç»Ÿå±æ€§æ‰€æŒ‡å®šçš„ç›®å½•ä¸­åŠ è½½ç±»åº“ï¼Œæˆ–ä» JDK çš„å®‰è£…ç›®å½•çš„ jre/lib/ext å­ç›®å½•ï¼ˆæ‰©å±•ç›®å½•ï¼‰ä¸‹åŠ è½½ç±»åº“ã€‚==å¦‚æœç”¨æˆ·åˆ›å»ºçš„ JAR æ”¾åœ¨æ­¤ç›®å½•ä¸‹ï¼Œä¹Ÿä¼šè‡ªåŠ¨ç”±æ‰©å±•ç±»åŠ è½½å™¨åŠ è½½ã€‚==</li></ul><h5 id="åº”ç”¨ç±»åŠ è½½å™¨ï¼ˆç³»ç»Ÿç±»åŠ è½½å™¨ï¼ŒAppClassLoaderï¼‰"><a href="#åº”ç”¨ç±»åŠ è½½å™¨ï¼ˆç³»ç»Ÿç±»åŠ è½½å™¨ï¼ŒAppClassLoaderï¼‰" class="headerlink" title="åº”ç”¨ç±»åŠ è½½å™¨ï¼ˆç³»ç»Ÿç±»åŠ è½½å™¨ï¼ŒAppClassLoaderï¼‰"></a>åº”ç”¨ç±»åŠ è½½å™¨ï¼ˆç³»ç»Ÿç±»åŠ è½½å™¨ï¼ŒAppClassLoaderï¼‰</h5><ul><li>Javaè¯­è¨€ç¼–å†™ï¼Œç”± sun.misc.Launcher$AppClassLoader å®ç°</li><li>==æ˜¯ java.lang.ClassLoader çš„å­ç±»==</li><li>çˆ¶åŠ è½½å™¨ä¸ºæ‰©å±•ç±»åŠ è½½å™¨</li><li>å®ƒè´Ÿè´£åŠ è½½ç¯å¢ƒå˜é‡ classpath æˆ–ç³»ç»Ÿå±æ€§ java.class.path æŒ‡å®šè·¯å¾„ä¸‹çš„ç±»åº“</li><li>å®ƒæ˜¯ç¨‹åºä¸­é»˜è®¤çš„ç±»åŠ è½½å™¨ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œ Java åº”ç”¨çš„ç±»éƒ½æ˜¯ç”±å®ƒæ¥å®ŒæˆåŠ è½½</li><li>é€šè¿‡ <code>ClassLoader.getSystemClassLoader()</code> æ–¹æ³•ï¼Œå¯ä»¥è·å–åˆ°è¯¥ç±»åŠ è½½å™¨</li></ul><h5 id="è‡ªå®šä¹‰ç±»åŠ è½½å™¨"><a href="#è‡ªå®šä¹‰ç±»åŠ è½½å™¨" class="headerlink" title="è‡ªå®šä¹‰ç±»åŠ è½½å™¨"></a>è‡ªå®šä¹‰ç±»åŠ è½½å™¨</h5><p>ä»¥ä¸Šçš„å¯åŠ¨ç±»åŠ è½½å™¨ã€æ‰©å±•ç±»åŠ è½½å™¨ã€åº”ç”¨ç±»åŠ è½½å™¨ï¼Œéƒ½æ˜¯è™šæ‹Ÿæœºè‡ªå¸¦çš„åŠ è½½å™¨ã€‚ä¸‹é¢æˆ‘ä»¬å­¦ä¹ è‡ªå®šä¹‰ç±»åŠ è½½å™¨ã€‚</p><p>ç•¥ï¼Œåç»­è¡¥å……ã€‚</p><h3 id="åŒäº²å§”æ´¾æœºåˆ¶"><a href="#åŒäº²å§”æ´¾æœºåˆ¶" class="headerlink" title="åŒäº²å§”æ´¾æœºåˆ¶"></a>åŒäº²å§”æ´¾æœºåˆ¶</h3><p>Java è™šæ‹Ÿæœºå¯¹ class æ–‡ä»¶é‡‡ç”¨çš„æ˜¯<strong>æŒ‰éœ€åŠ è½½</strong>çš„æ–¹å¼ï¼Œä¹Ÿå°±æ˜¯è¯´å½“éœ€è¦ä½¿ç”¨è¯¥ç±»æ—¶æ‰ä¼šå°†å®ƒçš„ class æ–‡ä»¶åŠ è½½åˆ°å†…å­˜ç”Ÿæˆ Class å¯¹è±¡ã€‚è€Œä¸”åŠ è½½æŸä¸ªç±»çš„ class æ–‡ä»¶æ—¶ï¼ŒJava è™šæ‹Ÿæœºé‡‡ç”¨çš„æ˜¯<strong>åŒäº²å§”æ´¾æ¨¡å¼</strong>ï¼Œå³æŠŠè¯·æ±‚äº¤ç”±çˆ¶ç±»å¤„ç†ï¼Œå®ƒæ˜¯ä¸€ç§ä»»åŠ¡å§”æ´¾æ¨¡å¼ã€‚</p><p><img src="http://cdn.leesin.fun/typora/s3/img/åŒäº²å§”æ´¾æ¨¡å¼-å·¥ä½œåŸç†.png" alt="åŒäº²å§”æ´¾æ¨¡å¼-å·¥ä½œåŸç†" style="zoom: 50%;"></p><blockquote><p>åŒäº²å§”æ´¾æœºåˆ¶çš„ä¼˜ç‚¹:</p><ul><li>é¿å…ç±»çš„é‡å¤åŠ è½½</li><li>ä¿æŠ¤ç¨‹åºå®‰å…¨ï¼Œé˜²æ­¢æ ¸å¿ƒAPIè¢«éšæ„ç¯¡æ”¹</li></ul></blockquote><h1 id="è¿è¡Œæ—¶æ•°æ®åŒºRuntime-Data-Area"><a href="#è¿è¡Œæ—¶æ•°æ®åŒºRuntime-Data-Area" class="headerlink" title="è¿è¡Œæ—¶æ•°æ®åŒºRuntime Data Area"></a>è¿è¡Œæ—¶æ•°æ®åŒºRuntime Data Area</h1><p><img src="http://cdn.leesin.fun/typora/s3/img/è¿è¡Œæ—¶æ•°æ®åŒº.png" alt="è¿è¡Œæ—¶æ•°æ®åŒº" style="zoom: 50%;"></p><blockquote><p>çº¢è‰²åŒºåŸŸæ˜¯çº¿ç¨‹å…±äº«çš„ï¼Œç°è‰²åŒºåŸŸæ˜¯çº¿ç¨‹ç§æœ‰çš„ã€‚</p></blockquote><p><img src="http://cdn.leesin.fun/typora/s3/img/è¿è¡Œæ—¶æ•°æ®åŒº-é˜¿é‡Œç‰ˆ.png" alt="è¿è¡Œæ—¶æ•°æ®åŒº-é˜¿é‡Œç‰ˆ"></p><blockquote><p>å…ƒæ•°æ®åŒºæ˜¯æ–¹æ³•åŒºçš„è½åœ°å®ç°ã€‚</p></blockquote><h3 id="PCå¯„å­˜å™¨"><a href="#PCå¯„å­˜å™¨" class="headerlink" title="PCå¯„å­˜å™¨"></a>PCå¯„å­˜å™¨</h3><ul><li>çº¿ç¨‹ç§æœ‰</li><li>å”¯ä¸€ä¸€ä¸ªä¸ä¼šOOMçš„åŒºåŸŸ</li><li>ä¸ç”¨GC</li></ul><h3 id="è™šæ‹Ÿæœºæ ˆ"><a href="#è™šæ‹Ÿæœºæ ˆ" class="headerlink" title="è™šæ‹Ÿæœºæ ˆ"></a>è™šæ‹Ÿæœºæ ˆ</h3><ul><li><p>çº¿ç¨‹ç§æœ‰çš„</p></li><li><p>æ ˆä¸ç”¨GCï¼Œä½†æ˜¯å¯èƒ½OOM</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-Xss256k <span class="comment">// è®¾ç½®çº¿ç¨‹çš„æœ€å¤§æ ˆç©ºé—´</span></span><br></pre></td></tr></table></figure><ul><li>çº¿ç¨‹ä¸Šæ­£åœ¨æ‰§è¡Œçš„æ¯ä¸ªæ–¹æ³•éƒ½å„è‡ªå¯¹åº”ä¸€ä¸ªæ ˆå¸§ï¼ˆStack Frameï¼‰</li><li>æ ˆå¸§å†…éƒ¨åˆåŒ…å«5ä¸ªéƒ¨åˆ†ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</li></ul><p><img src="http://cdn.leesin.fun/typora/s3/img/ç¬¬05ç« _æ ˆæ¡¢å†…éƒ¨ç»“æ„.jpg" alt="ç¬¬05ç« _æ ˆæ¡¢å†…éƒ¨ç»“æ„"></p><h5 id="å±€éƒ¨å˜é‡è¡¨"><a href="#å±€éƒ¨å˜é‡è¡¨" class="headerlink" title="å±€éƒ¨å˜é‡è¡¨"></a>å±€éƒ¨å˜é‡è¡¨</h5><ul><li>ä¹Ÿå«åšæœ¬åœ°å˜é‡è¡¨</li><li>==å®šä¹‰ä¸ºä¸€ä¸ªæ•°å­—æ•°ç»„ï¼Œä¸»è¦ç”¨äºå­˜å‚¨æ–¹æ³•å‚æ•°å’Œå®šä¹‰åœ¨æ–¹æ³•ä½“å†…çš„å±€éƒ¨å˜é‡==ï¼Œè¿™äº›æ•°æ®ç±»å‹åŒ…æ‹¬å„ç±»åŸºæœ¬æ•°æ®ç±»å‹ã€å¯¹è±¡å¼•ç”¨ï¼ˆreferenceï¼‰ï¼Œä»¥åŠreturnAddressç±»å‹ã€‚</li><li>ç”±äºå±€éƒ¨å˜é‡è¡¨æ˜¯å»ºç«‹åœ¨çº¿ç¨‹çš„æ ˆä¸Šï¼Œæ˜¯çº¿ç¨‹ç§æœ‰æ•°æ®ï¼Œå› æ­¤==ä¸å­˜åœ¨æ•°æ®å®‰å…¨é—®é¢˜==ã€‚</li><li>==å±€éƒ¨å˜é‡è¡¨æ‰€éœ€çš„å®¹é‡å¤§å°æ˜¯åœ¨ç¼–è¯‘æœŸç¡®å®šä¸‹æ¥çš„==ï¼Œå¹¶ä¿å­˜åœ¨æ–¹æ³•çš„ Code å±æ€§çš„ maximum local variables æ•°æ®é¡¹ä¸­ã€‚åœ¨æ–¹æ³•è¿è¡ŒæœŸé—´æ˜¯ä¸ä¼šæ”¹å˜å±€éƒ¨å˜é‡è¡¨çš„å¤§å°çš„ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LocalVariablesTest</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">LocalVariablesTest</span> <span class="variable">test</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">LocalVariablesTest</span>();</span><br><span class="line">        <span class="type">int</span> <span class="variable">num</span> <span class="operator">=</span> <span class="number">10</span>;</span><br><span class="line">        test.test1();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test1</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Date</span> <span class="variable">date</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Date</span>();</span><br><span class="line">        <span class="type">String</span> <span class="variable">name1</span> <span class="operator">=</span> <span class="string">&quot;atguigu.com&quot;</span>;</span><br><span class="line">        System.out.println(date + name1);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>mainæ–¹æ³•æœ‰ä¸‰ä¸ªå˜é‡ï¼šargs[]ã€testã€num</p><p>æ•…Maximum local variableså€¼ä¸º3ï¼ˆå¦‚ä¸‹å›¾ï¼‰</p></blockquote><p><img src="http://cdn.leesin.fun/typora/s3/img/å±€éƒ¨å˜é‡è¡¨ç¤ºä¾‹1.png" alt="å±€éƒ¨å˜é‡è¡¨ç¤ºä¾‹1" style="zoom: 50%;"></p><p><img src="http://cdn.leesin.fun/typora/s3/img/å±€éƒ¨å˜é‡è¡¨ç¤ºä¾‹2.png" alt="å±€éƒ¨å˜é‡è¡¨ç¤ºä¾‹2"></p><blockquote><p>Start PCï¼šå­—èŠ‚ç æŒ‡ä»¤è¡Œå·</p><p>Lengthï¼šå˜é‡æœ‰æ•ˆçš„é•¿åº¦</p><p>å…³äºæ§½ï¼ˆslotï¼‰çš„ç†è§£</p><ul><li>å±€éƒ¨å˜é‡è¡¨ ==æœ€åŸºæœ¬çš„å­˜å‚¨å•å…ƒæ˜¯ Slotï¼ˆå˜é‡æ§½ï¼‰==</li><li>åœ¨å±€éƒ¨å˜é‡è¡¨ä¸­ï¼Œ==32ä½ä»¥å†…çš„ç±»å‹åªå ç”¨ä¸€ä¸ªslotï¼ˆåŒ…æ‹¬returnAddressç±»å‹ï¼‰ï¼Œ64ä½çš„ç±»å‹ï¼ˆlongå’Œdoubleï¼‰å ç”¨ä¸¤ä¸ªslotã€‚==<ul><li>byteã€shortã€charåœ¨å­˜å‚¨å‰è¢«è½¬æ¢ä¸º int</li><li>boolean ä¹Ÿè¢«è½¬æ¢ä¸º int ï¼Œ0è¡¨ç¤º falseï¼Œé0è¡¨ç¤º true</li><li>long å’Œ double åˆ™å æ®ä¸¤ä¸ª slot</li></ul></li><li>å¦‚æœå½“å‰å¸§æ˜¯ç”±<strong>æ„é€ æ–¹æ³•</strong>æˆ–è€…<strong>å®ä¾‹æ–¹æ³•</strong>åˆ›å»ºçš„ï¼Œ==é‚£ä¹ˆè¯¥å¯¹è±¡å¼•ç”¨ this å°†ä¼šå­˜æ”¾åœ¨ index ä¸º0çš„ slot å¤„ï¼Œ==å…¶ä½™çš„å‚æ•°æŒ‰ç…§å‚æ•°è¡¨é¡ºåºç»§ç»­æ’åˆ—ã€‚ï¼ˆä¸‹é¢ç»™å‡ºç¤ºä¾‹ï¼‰</li></ul></blockquote><p><img src="http://cdn.leesin.fun/typora/s3/img/å±€éƒ¨å˜é‡è¡¨ç¤ºä¾‹3.png" alt="å±€éƒ¨å˜é‡è¡¨ç¤ºä¾‹3" style="zoom:33%;"></p><blockquote><ul><li>==æ ˆå¸§ä¸­çš„å±€éƒ¨å˜é‡è¡¨ä¸­çš„æ§½ä½æ˜¯å¯ä»¥é‡ç”¨çš„==ï¼Œå¦‚æœä¸€ä¸ªå±€éƒ¨å˜é‡è¿‡äº†å…¶ä½œç”¨åŸŸï¼Œé‚£ä¹ˆåœ¨å…¶ä½œç”¨åŸŸä¹‹åå£°æ˜çš„æ–°çš„å±€éƒ¨å˜é‡å°±å¾ˆæœ‰å¯èƒ½æœç”¨è¿‡æœŸçš„å±€éƒ¨å˜é‡çš„æ§½ä½ï¼Œä»è€Œè¾¾åˆ°èŠ‚çœèµ„æºçš„ç›®çš„ã€‚</li></ul></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test4</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">a</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10</span>; i++)&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//å˜é‡cä½¿ç”¨ä¹‹å‰å·²ç»é”€æ¯çš„å˜é‡iå æ®çš„slotçš„ä½ç½®</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">c</span> <span class="operator">=</span> a + <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="http://cdn.leesin.fun/typora/s3/img/å±€éƒ¨å˜é‡è¡¨ç¤ºä¾‹4.png" alt="å±€éƒ¨å˜é‡è¡¨ç¤ºä¾‹4" style="zoom:33%;"></p><blockquote><p>è¡¥å……è¯´æ˜</p><ul><li><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">â‘  æˆå‘˜å˜é‡ï¼šåœ¨ä½¿ç”¨å‰ï¼Œéƒ½ç»å†è¿‡é»˜è®¤åˆå§‹åŒ–èµ‹å€¼</span><br><span class="line">ç±»å˜é‡ï¼š linkingçš„prepareé˜¶æ®µï¼šç»™ç±»å˜é‡é»˜è®¤èµ‹å€¼  ---&gt; initialé˜¶æ®µï¼šç»™ç±»å˜é‡æ˜¾å¼èµ‹å€¼å³é™æ€ä»£ç å—èµ‹å€¼</span><br><span class="line">å®ä¾‹å˜é‡ï¼šéšç€å¯¹è±¡çš„åˆ›å»ºï¼Œä¼šåœ¨å †ç©ºé—´ä¸­åˆ†é…å®ä¾‹å˜é‡ç©ºé—´ï¼Œå¹¶è¿›è¡Œé»˜è®¤èµ‹å€¼</span><br><span class="line">â‘¡ å±€éƒ¨å˜é‡ï¼šåœ¨ä½¿ç”¨å‰ï¼Œå¿…é¡»è¦è¿›è¡Œæ˜¾å¼èµ‹å€¼çš„ï¼å¦åˆ™ï¼Œç¼–è¯‘ä¸é€šè¿‡</span><br></pre></td></tr></table></figure></li><li><p>åœ¨æ ˆå¸§ä¸­ï¼Œä¸æ€§èƒ½è°ƒä¼˜å…³ç³»æœ€ä¸ºå¯†åˆ‡çš„éƒ¨åˆ†å°±æ˜¯å±€éƒ¨å˜é‡è¡¨ã€‚</p><p>åœ¨æ–¹æ³•æ‰§è¡Œæ—¶ï¼Œè™šæ‹Ÿæœºä½¿ç”¨å±€éƒ¨å˜é‡è¡¨å®Œæˆæ–¹æ³•çš„ä¼ é€’ã€‚</p></li><li><p>==å±€éƒ¨å˜é‡è¡¨ä¸­çš„å˜é‡ä¹Ÿæ˜¯é‡è¦çš„åƒåœ¾å›æ”¶æ ¹èŠ‚ç‚¹ï¼Œåªè¦è¢«å±€éƒ¨å˜é‡è¡¨ä¸­ç›´æ¥æˆ–é—´æ¥å¼•ç”¨çš„å¯¹è±¡éƒ½ä¸ä¼šè¢«å›æ”¶ã€‚==</p></li></ul></blockquote><h5 id="æ“ä½œæ•°æ ˆ"><a href="#æ“ä½œæ•°æ ˆ" class="headerlink" title="æ“ä½œæ•°æ ˆ"></a>æ“ä½œæ•°æ ˆ</h5><p>ç•¥</p><h5 id="åŠ¨æ€é“¾æ¥ï¼ˆæŒ‡å‘è¿è¡Œæ—¶å¸¸é‡æ± çš„æ–¹æ³•å¼•ç”¨ï¼‰"><a href="#åŠ¨æ€é“¾æ¥ï¼ˆæŒ‡å‘è¿è¡Œæ—¶å¸¸é‡æ± çš„æ–¹æ³•å¼•ç”¨ï¼‰" class="headerlink" title="åŠ¨æ€é“¾æ¥ï¼ˆæŒ‡å‘è¿è¡Œæ—¶å¸¸é‡æ± çš„æ–¹æ³•å¼•ç”¨ï¼‰"></a>åŠ¨æ€é“¾æ¥ï¼ˆæŒ‡å‘è¿è¡Œæ—¶å¸¸é‡æ± çš„æ–¹æ³•å¼•ç”¨ï¼‰</h5><ul><li><p>æ¯ä¸€ä¸ªæ ˆå¸§å†…éƒ¨éƒ½åŒ…å«ä¸€ä¸ªæŒ‡å‘<strong>è¿è¡Œæ—¶å¸¸é‡æ± </strong>ä¸­<strong>è¯¥æ ˆå¸§æ‰€å±æ–¹æ³•çš„å¼•ç”¨</strong>ã€‚åŒ…å«è¿™ä¸ªå¼•ç”¨çš„ç›®çš„å°±æ˜¯ä¸ºäº†æ”¯æŒå½“å‰æ–¹æ³•çš„ä»£ç èƒ½å¤Ÿå®ç°<strong>åŠ¨æ€é“¾æ¥ï¼ˆDynamic Linkingï¼‰</strong>ã€‚æ¯”å¦‚ï¼šinvokedynamicæŒ‡ä»¤</p></li><li><p>åœ¨Javaæºæ–‡ä»¶è¢«ç¼–è¯‘åˆ°å­—èŠ‚ç æ–‡ä»¶ä¸­æ—¶ï¼Œæ‰€æœ‰çš„å˜é‡å’Œæ–¹æ³•å¼•ç”¨éƒ½ä½œä¸ºç¬¦å·å¼•ç”¨ï¼ˆSymbolic Referenceï¼‰ä¿å­˜åœ¨classæ–‡ä»¶çš„å¸¸é‡æ± é‡Œã€‚æ¯”å¦‚ï¼šæè¿°ä¸€ä¸ªæ–¹æ³•è°ƒç”¨äº†å¦å¤–çš„å…¶ä»–æ–¹æ³•æ—¶ï¼Œå°±æ˜¯é€šè¿‡å¸¸é‡æ± ä¸­æŒ‡å‘æ–¹æ³•çš„ç¬¦å·å¼•ç”¨æ¥è¡¨ç¤ºçš„ï¼Œé‚£ä¹ˆ<strong>åŠ¨æ€é“¾æ¥çš„ä½œç”¨å°±æ˜¯ä¸ºäº†å°†è¿™äº›ç¬¦å·å¼•ç”¨è½¬æ¢ä¸ºè°ƒç”¨æ–¹æ³•çš„ç›´æ¥å¼•ç”¨ã€‚</strong></p><p><img src="http://cdn.leesin.fun/typora/s3/img/ç¬¬09ç« _æ–¹æ³•åŒºä¸æ ˆçš„å…³è”ç»“æ„.jpg" alt="ç¬¬09ç« _æ–¹æ³•åŒºä¸æ ˆçš„å…³è”ç»“æ„"></p></li></ul><blockquote><p><strong>æ–¹æ³•è°ƒç”¨</strong></p><p>åœ¨JVMä¸­ï¼Œå°†ç¬¦å·å¼•ç”¨è½¬æ¢ä¸ºè°ƒç”¨æ–¹æ³•çš„ç›´æ¥å¼•ç”¨ä¸æ–¹æ³•çš„ç»‘å®šæœºåˆ¶iæœ‰å…³ã€‚</p><ul><li>é™æ€é“¾æ¥ï¼šå½“ä¸€ä¸ªå­—èŠ‚ç æ–‡ä»¶è¢«è£…è½½è¿› JVM å†…éƒ¨æ—¶ï¼Œå¦‚æœè¢«è°ƒç”¨çš„ç›®æ ‡æ–¹æ³•åœ¨ç¼–è¯‘æœŸå¯çŸ¥ï¼Œä¸”è¿è¡ŒæœŸä¿æŒä¸å˜æ—¶ã€‚è¿™ç§æƒ…å†µä¸‹å°†è°ƒç”¨æ–¹æ³•çš„ç¬¦å·å¼•ç”¨è½¬æ¢ä¸ºç›´æ¥å¼•ç”¨çš„è¿‡ç¨‹ç§°ä¹‹ä¸ºé™æ€é“¾æ¥ã€‚</li><li>åŠ¨æ€é“¾æ¥ï¼šå¦‚æœè¢«è°ƒç”¨çš„æ–¹æ³•åœ¨ç¼–è¯‘å™¨æ— æ³•è¢«ç¡®å®šä¸‹æ¥ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåªèƒ½å¤Ÿåœ¨ç¨‹åºè¿è¡ŒæœŸå°†è°ƒç”¨æ–¹æ³•çš„ç¬¦å·å¼•ç”¨è½¬æ¢ä¸ºç›´æ¥å¼•ç”¨ï¼Œç”±äºè¿™ç§å¼•ç”¨è½¬æ¢è¿‡ç¨‹å…·å¤‡åŠ¨æ€æ€§ï¼Œå› æ­¤ä¹Ÿå°±è¢«ç§°ä¹‹ä¸ºåŠ¨æ€é“¾æ¥ã€‚</li></ul><p><strong>æ–¹æ³•çš„è°ƒç”¨ï¼šè™šæ–¹æ³•ä¸éè™šæ–¹æ³•</strong></p><p>éè™šæ–¹æ³•ï¼š</p><ul><li>å¦‚æœæ–¹æ³•åœ¨ç¼–è¯‘æœŸå°±ç¡®å®šäº†å…·ä½“çš„è°ƒç”¨ç‰ˆæœ¬ï¼Œè¿™ä¸ªç‰ˆæœ¬åœ¨è¿è¡Œæ—¶æ—¶ä¸å¯å˜çš„ã€‚è¿™æ ·çš„æ–¹æ³•ç§°ä¸ºéè™šæ–¹æ³•ã€‚</li><li>é™æ€æ–¹æ³•ã€ç§æœ‰æ–¹æ³•ã€finalæ–¹æ³•ã€å®ä¾‹æ„é€ å™¨ã€çˆ¶ç±»æ–¹æ³•éƒ½æ˜¯éè™šæ–¹æ³•ã€‚</li><li>å…¶ä»–æ–¹æ³•ç§°ä¸ºè™šæ–¹æ³•ã€‚</li></ul><p><strong>è™šæ‹Ÿæœºä¸­æä¾›äº†ä»¥ä¸‹å‡ æ¡æ–¹æ³•è°ƒç”¨æŒ‡ä»¤ï¼š</strong></p><ul><li>æ™®é€šè°ƒç”¨æŒ‡ä»¤ï¼š<ol><li>invokestaticï¼šè°ƒç”¨é™æ€æ–¹æ³•ï¼Œè§£æé˜¶æ®µç¡®å®šå”¯ä¸€æ–¹æ³•ç‰ˆæœ¬</li><li>invokespecialï¼šè°ƒç”¨<init>æ–¹æ³•ã€ç§æœ‰æ–¹æ³•ã€çˆ¶ç±»æ–¹æ³•ï¼Œè§£æé˜¶æ®µç¡®å®šå”¯ä¸€æ–¹æ³•ç‰ˆæœ¬</init></li><li>invokevirtualï¼šè°ƒç”¨æ‰€æœ‰è™šæ–¹æ³•</li><li>invokeinterfaceï¼šè°ƒç”¨æ¥å£æ–¹æ³•</li></ol></li><li>åŠ¨æ€è°ƒç”¨æŒ‡ä»¤ï¼š<ol><li>invokedynamicï¼šåŠ¨æ€è§£æå‡ºéœ€è¦è°ƒç”¨çš„æ–¹æ³•ï¼Œç„¶åæ‰§è¡Œ</li></ol></li></ul><p>å‰4æ¡æŒ‡ä»¤å›ºåŒ–åœ¨è™šæ‹Ÿæœºå†…éƒ¨ï¼Œæ–¹æ³•çš„è°ƒç”¨æ‰§è¡Œä¸å¯è®¤ä¸ºå¹²é¢„ï¼Œè€ŒinvokedynamicæŒ‡ä»¤åˆ™æ”¯æŒç”±ç”¨æˆ·ç¡®å®šæ–¹æ³•ç‰ˆæœ¬ã€‚<strong>å…¶ä¸­invokestaticæŒ‡ä»¤å’ŒinvokespecialæŒ‡ä»¤è°ƒç”¨çš„æ–¹æ³•ç§°ä¸ºéè™šæ–¹æ³•ï¼Œå…¶ä½™çš„ï¼ˆfinalä¿®é¥°çš„é™¤å¤–ï¼‰ç§°ä¸ºè™šæ–¹æ³•ã€‚</strong></p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lyf.JVM;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è§£æè°ƒç”¨ä¸­éè™šæ–¹æ³•ã€è™šæ–¹æ³•çš„æµ‹è¯•</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * invokestaticæŒ‡ä»¤å’ŒinvokespecialæŒ‡ä»¤è°ƒç”¨çš„æ–¹æ³•ç§°ä¸ºéè™šæ–¹æ³•</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> shkstart</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2020 ä¸‹åˆ 12:07</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Father</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Father</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;fatherçš„æ„é€ å™¨&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">showStatic</span><span class="params">(String str)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;father &quot;</span> + str);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">showFinal</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;father show final&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">showCommon</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;father æ™®é€šæ–¹æ³•&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Son</span> <span class="keyword">extends</span> <span class="title class_">Father</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Son</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//invokespecial</span></span><br><span class="line">        <span class="built_in">super</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Son</span><span class="params">(<span class="type">int</span> age)</span> &#123;</span><br><span class="line">        <span class="comment">//invokespecial</span></span><br><span class="line">        <span class="built_in">this</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//ä¸æ˜¯é‡å†™çš„çˆ¶ç±»çš„é™æ€æ–¹æ³•ï¼Œå› ä¸ºé™æ€æ–¹æ³•ä¸èƒ½è¢«é‡å†™ï¼</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">showStatic</span><span class="params">(String str)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;son &quot;</span> + str);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">showPrivate</span><span class="params">(String str)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;son private&quot;</span> + str);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">show</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//invokestatic</span></span><br><span class="line">        showStatic(<span class="string">&quot;atguigu.com&quot;</span>);</span><br><span class="line">        <span class="comment">//invokestatic</span></span><br><span class="line">        <span class="built_in">super</span>.showStatic(<span class="string">&quot;good!&quot;</span>);</span><br><span class="line">        <span class="comment">//invokespecial</span></span><br><span class="line">        showPrivate(<span class="string">&quot;hello!&quot;</span>);</span><br><span class="line">        <span class="comment">//invokespecial</span></span><br><span class="line">        <span class="built_in">super</span>.showCommon();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//invokevirtual</span></span><br><span class="line">        showFinal();<span class="comment">//å› ä¸ºæ­¤æ–¹æ³•å£°æ˜æœ‰finalï¼Œä¸èƒ½è¢«å­ç±»é‡å†™ï¼Œæ‰€ä»¥ä¹Ÿè®¤ä¸ºæ­¤æ–¹æ³•æ˜¯éè™šæ–¹æ³•ã€‚</span></span><br><span class="line">        <span class="comment">//invokespecial</span></span><br><span class="line">        <span class="built_in">super</span>.showFinal();</span><br><span class="line">        <span class="comment">//è™šæ–¹æ³•å¦‚ä¸‹ï¼š</span></span><br><span class="line">        <span class="comment">//invokevirtual</span></span><br><span class="line">        showCommon();</span><br><span class="line">        <span class="comment">//invokevirtual</span></span><br><span class="line">        info();</span><br><span class="line"></span><br><span class="line">        <span class="type">MethodInterface</span> <span class="variable">in</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="comment">//invokeinterface</span></span><br><span class="line">        in.methodA();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">info</span><span class="params">()</span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">display</span><span class="params">(Father f)</span>&#123;</span><br><span class="line">        f.showCommon();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Son</span> <span class="variable">so</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Son</span>();</span><br><span class="line">        so.show();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">MethodInterface</span>&#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">methodA</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="è¿”å›åœ°å€ï¼ˆreturn-addressï¼‰"><a href="#è¿”å›åœ°å€ï¼ˆreturn-addressï¼‰" class="headerlink" title="è¿”å›åœ°å€ï¼ˆreturn addressï¼‰"></a>è¿”å›åœ°å€ï¼ˆreturn addressï¼‰</h5><ul><li>å­˜æ”¾è°ƒç”¨è¯¥æ–¹æ³•çš„pcå¯„å­˜å™¨çš„å€¼</li><li>ä¸€ä¸ªæ–¹æ³•çš„ç»“æŸï¼Œæœ‰ä¸¤ç§æ–¹å¼ï¼š<ul><li>æ­£å¸¸æ‰§è¡Œå®Œæˆ</li><li>å‡ºç°æœªå¤„ç†çš„å¼‚å¸¸ï¼Œéæ­£å¸¸é€€å‡º</li></ul></li><li>æ— è®ºé€šè¿‡å“ªç§æ–¹å¼é€€å‡ºï¼Œåœ¨æ–¹æ³•é€€å‡ºåéƒ½è¿”å›åˆ°è¯¥æ–¹æ³•è¢«è°ƒç”¨çš„ä½ç½®ã€‚æ–¹æ³•æ­£å¸¸é€€å‡ºæ—¶ï¼Œè°ƒç”¨è€…çš„pcè®¡æ•°å™¨çš„å€¼ä½œä¸ºè¿”å›åœ°å€ï¼Œå³è°ƒç”¨è¯¥æ–¹æ³•çš„æŒ‡ä»¤çš„ä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€ã€‚è€Œé€šè¿‡å¼‚å¸¸é€€å‡ºçš„ï¼Œè¿”å›åœ°å€æ˜¯è¦é€šè¿‡å¼‚å¸¸è¡¨æ¥ç¡®å®šï¼Œæ ˆå¸§ä¸­ä¸€èˆ¬ä¸ä¼šä¿å­˜è¿™éƒ¨åˆ†ä¿¡æ¯ã€‚</li></ul><ol><li>æ‰§è¡Œå¼•æ“é‡åˆ°ä»»æ„ä¸€ä¸ªæ–¹æ³•è¿”å›çš„å­—èŠ‚ç æŒ‡ä»¤ (return)ï¼Œä¼šæœ‰è¿”å›å€¼ä¼ é€’ç»™ä¸Šå±‚çš„æ–¹æ³•è°ƒç”¨è€…ï¼Œç®€ç§°æ­£å¸¸å®Œæˆå‡ºå£ã€‚</li></ol><blockquote><ul><li>ä¸€ä¸ªæ–¹æ³•åœ¨æ­£å¸¸è°ƒç”¨å®Œæˆä¹‹åç©¶ç«Ÿéœ€è¦ä½¿ç”¨å“ªä¸€ä¸ªè¿”å›æŒ‡ä»¤è¿˜éœ€è¦æ ¹æ®æ–¹æ³•è¿”å›å€¼Oçš„å®é™…æ•°æ®ç±»å‹è€Œå®šã€‚</li><li>åœ¨å­—èŠ‚ç æŒ‡ä»¤ä¸­ï¼Œè¿”å›æŒ‡ä»¤åŒ…å«ireturn (å½“è¿”å›å€¼æ˜¯booleanã€byteã€charã€shortå’Œintç±»å‹æ—¶ä½¿ç”¨)ã€lreturnã€freturnã€dreturnä»¥åŠareturnï¼Œå¦å¤–è¿˜æœ‰ä¸€ä¸ªreturnæŒ‡ä»¤ä¾›å£°æ˜ä¸ºvoidçš„æ–¹æ³•ã€å®ä¾‹åˆå§‹åŒ–æ–¹æ³•ã€ç±»å’Œæ¥å£çš„åˆå§‹åŒ–æ–¹æ³•ä½¿ç”¨ã€‚</li></ul></blockquote><ol><li>åœ¨æ–¹æ³•æ‰§è¡Œçš„è¿‡ç¨‹ä¸­é‡åˆ°äº†å¼‚å¸¸ (Exception)ï¼Œå¹¶ä¸”è¿™ä¸ªå¼‚å¸¸æ²¡æœ‰åœ¨æ–¹æ³•å†…è¿›è¡Œå¤„ç†ï¼Œä¹Ÿå°±æ˜¯åªè¦åœ¨æœ¬æ–¹æ³•çš„å¼‚å¸¸è¡¨ä¸­æ²¡æœ‰æœç´¢åˆ°åŒ¹é…çš„å¼‚å¸¸å¤„ç†å™¨ï¼Œå°±ä¼šå¯¼è‡´æ–¹æ³•é€€å‡ºã€‚ç®€ç§°å¼‚å¸¸å®Œæˆå‡ºå£ã€‚</li></ol><h5 id="ä¸€äº›é™„åŠ ä¿¡æ¯"><a href="#ä¸€äº›é™„åŠ ä¿¡æ¯" class="headerlink" title="ä¸€äº›é™„åŠ ä¿¡æ¯"></a>ä¸€äº›é™„åŠ ä¿¡æ¯</h5><p>ç•¥</p><blockquote><p>æ ˆç›¸å…³çš„ä¸€äº›é¢è¯•é¢˜</p><ol><li>åƒåœ¾å›æ”¶æ˜¯å¦æ¶‰åŠåˆ°è™šæ‹Ÿæœºæ ˆï¼Ÿä¸ä¼šã€‚</li><li>æ–¹æ³•ä¸­å®šä¹‰çš„å±€éƒ¨å˜é‡æ˜¯å¦çº¿ç¨‹å®‰å…¨ï¼Ÿå…·ä½“é—®é¢˜å…·ä½“åˆ†æã€‚</li></ol></blockquote><h3 id="æœ¬åœ°æ–¹æ³•æ ˆ"><a href="#æœ¬åœ°æ–¹æ³•æ ˆ" class="headerlink" title="æœ¬åœ°æ–¹æ³•æ ˆ"></a>æœ¬åœ°æ–¹æ³•æ ˆ</h3><ul><li>Java è™šæ‹Ÿæœºæ ˆç”¨äºç®¡ç† Java æ–¹æ³•çš„è°ƒç”¨ï¼Œè€Œæœ¬åœ°æ–¹æ³•æ ˆç”¨äºç®¡ç†æœ¬åœ°æ–¹æ³•çš„è°ƒç”¨ã€‚</li></ul><h3 id="å †"><a href="#å †" class="headerlink" title="å †"></a>å †</h3><h4 id="å †ç©ºé—´åˆ†å¸ƒå›¾"><a href="#å †ç©ºé—´åˆ†å¸ƒå›¾" class="headerlink" title="å †ç©ºé—´åˆ†å¸ƒå›¾"></a>å †ç©ºé—´åˆ†å¸ƒå›¾</h4><p><img src="http://cdn.leesin.fun/typora/img/image-20221123101857534.png" alt="image-20221123101857534" style="zoom:50%;"></p><h4 id="å¯¹åº”è™šæ‹Ÿæœºå‚æ•°ä¸€"><a href="#å¯¹åº”è™šæ‹Ÿæœºå‚æ•°ä¸€" class="headerlink" title="å¯¹åº”è™šæ‹Ÿæœºå‚æ•°ä¸€"></a>å¯¹åº”è™šæ‹Ÿæœºå‚æ•°ä¸€</h4><h5 id="1-è®¾ç½®å †ç©ºé—´å¤§å°çš„å‚æ•°"><a href="#1-è®¾ç½®å †ç©ºé—´å¤§å°çš„å‚æ•°" class="headerlink" title="1. è®¾ç½®å †ç©ºé—´å¤§å°çš„å‚æ•°"></a>1. è®¾ç½®å †ç©ºé—´å¤§å°çš„å‚æ•°</h5><ul><li><code>-Xms</code>ç”¨æ¥è®¾ç½®å †ç©ºé—´ï¼ˆå¹´è½»ä»£+è€å¹´ä»£ï¼‰çš„åˆå§‹å†…å­˜å¤§å°ï¼Œç­‰ä»·äº<code>-XX:InitialHeapSize</code></li><li><code>-Xmx</code>ç”¨æ¥è®¾ç½®å †ç©ºé—´ï¼ˆå¹´è½»ä»£+è€å¹´ä»£ï¼‰çš„æœ€å¤§å†…å­˜å¤§å°ï¼Œç­‰ä»·äº<code>-XX:MaxHeapSize</code></li></ul><blockquote><p>ä¸€æ—¦å †åŒºä¸­çš„å†…å­˜å¤§å°è¶…è¿‡<code>-Xmx</code>æ‰€æŒ‡å®šçš„æœ€å¤§å†…å­˜æ—¶ï¼Œå°†ä¼šæŠ›å‡º OutOfMemoryError å¼‚å¸¸ã€‚</p><p>-X æ˜¯jvmçš„è¿è¡Œå‚æ•°ï¼Œ ms æ˜¯memory start</p></blockquote><h5 id="2-é»˜è®¤å †ç©ºé—´å¤§å°"><a href="#2-é»˜è®¤å †ç©ºé—´å¤§å°" class="headerlink" title="2. é»˜è®¤å †ç©ºé—´å¤§å°"></a>2. é»˜è®¤å †ç©ºé—´å¤§å°</h5><ul><li>åˆå§‹å†…å­˜å¤§å°ï¼šç‰©ç†ç”µè„‘å†…å­˜å¤§å° / 64</li><li>æœ€å¤§å†…å­˜å¤§å°ï¼šç‰©ç†ç”µè„‘å†…å­˜å¤§å° / 4</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// javaè™šæ‹Ÿæœºä¸­çš„å †å†…å­˜æ€»é‡</span></span><br><span class="line"><span class="type">long</span> <span class="variable">initialMemory</span> <span class="operator">=</span> Runtime.getRuntime().totalMemory() / <span class="number">1024</span> / <span class="number">1024</span>;</span><br><span class="line"><span class="comment">// Javaè™šæ‹Ÿæœºè¯•å›¾ä½¿ç”¨çš„æœ€å¤§å †å†…å­˜é‡</span></span><br><span class="line"><span class="type">long</span> <span class="variable">maxMemory</span> <span class="operator">=</span> Runtime.getRuntime().maxMemory() / <span class="number">1024</span> / <span class="number">1024</span>;</span><br><span class="line"></span><br><span class="line">System.out.println(<span class="string">&quot;-Xms : &quot;</span> + initialMemory + <span class="string">&quot;M&quot;</span>);</span><br><span class="line">System.out.println(<span class="string">&quot;-Xmx : &quot;</span> + maxMemory + <span class="string">&quot;M&quot;</span>);</span><br><span class="line"></span><br><span class="line">System.out.println(<span class="string">&quot;ç³»ç»Ÿå†…å­˜å¤§å°ä¸ºï¼š&quot;</span> + initialMemory * <span class="number">64</span> / <span class="number">1024</span> + <span class="string">&quot;G&quot;</span>);</span><br><span class="line">System.out.println(<span class="string">&quot;ç³»ç»Ÿå†…å­˜å¤§å°ä¸ºï¼š&quot;</span> + maxMemory * <span class="number">4</span> / <span class="number">1024</span> + <span class="string">&quot;G&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// // æ–¹å¼1éœ€è¦å¦‚ä¸‹ä»£ç </span></span><br><span class="line"><span class="comment">// try&#123;</span></span><br><span class="line"><span class="comment">//     TimeUnit.MILLISECONDS.sleep(1000000);</span></span><br><span class="line"><span class="comment">// &#125; catch (InterruptedException e) &#123;</span></span><br><span class="line"><span class="comment">//     e.printStackTrace();</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">-Xms : 368M</span></span><br><span class="line"><span class="comment">-Xmx : 5451M</span></span><br><span class="line"><span class="comment">ç³»ç»Ÿå†…å­˜å¤§å°ä¸ºï¼š23G</span></span><br><span class="line"><span class="comment">ç³»ç»Ÿå†…å­˜å¤§å°ä¸ºï¼š21G</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><h5 id="3-æ‰‹åŠ¨è®¾ç½®"><a href="#3-æ‰‹åŠ¨è®¾ç½®" class="headerlink" title="3. æ‰‹åŠ¨è®¾ç½®"></a>3. æ‰‹åŠ¨è®¾ç½®</h5><p>-Xms600m -Xmx600m</p><p>å¼€å‘ä¸­å»ºè®®å°†åˆå§‹å †å†…å­˜å’Œæœ€å¤§çš„å †å†…å­˜è®¾ç½®æˆç›¸åŒçš„å€¼ï¼Œç›®çš„æ˜¯ä¸ºäº†èƒ½å¤Ÿåœ¨Javaåƒåœ¾å›æ”¶æœºåˆ¶æ¸…ç†å®Œå †åŒºåä¸éœ€è¦é‡æ–°åˆ†éš”è®¡ç®—å †åŒºå¤§å°ï¼Œä»è€Œæé«˜æ€§èƒ½ã€‚</p><h5 id="4-æŸ¥çœ‹è®¾ç½®çš„å‚æ•°"><a href="#4-æŸ¥çœ‹è®¾ç½®çš„å‚æ•°" class="headerlink" title="4. æŸ¥çœ‹è®¾ç½®çš„å‚æ•°"></a>4. æŸ¥çœ‹è®¾ç½®çš„å‚æ•°</h5><p>ï¼ˆæ³¨ï¼šä»¥ä¸‹ä¸¤ä¸ªæ–¹å¼éƒ½ä½¿ç”¨ä¸Šä¸€ä¸ªä»£ç å—çš„ä»£ç ï¼‰</p><p>æ–¹å¼ä¸€ï¼š</p><blockquote><p>è™šæ‹Ÿæœºå‚æ•°å¦‚ä¸‹ï¼š<br><code>-Xms600m -Xmx600m</code></p><p>ç„¶åæ‰“å¼€cmdï¼š</p><p>ç¬¬ä¸€æ­¥ï¼šæŸ¥çœ‹javaè¿›ç¨‹ï¼Œä½¿ç”¨å‘½ä»¤<code>jps</code></p><p>ç¬¬äºŒæ­¥ï¼š<code>jstat -gc è¿›ç¨‹id</code></p></blockquote><p><img src="http://cdn.leesin.fun/typora/img/æŸ¥çœ‹æ ˆçš„å†…éƒ¨ç»“æ„åˆ†é…1.png" alt="æŸ¥çœ‹æ ˆçš„å†…éƒ¨ç»“æ„åˆ†é…1"></p><p>æ–¹å¼äºŒï¼š-XX:+PrintGCDetails</p><blockquote><p>è™šæ‹Ÿæœºå‚æ•°å¦‚ä¸‹ï¼š<br><code>-Xms600m -Xmx600m -XX:+PrintGCDetails</code></p></blockquote><p><img src="http://cdn.leesin.fun/typora/img/æŸ¥çœ‹æ ˆçš„å†…éƒ¨ç»“æ„åˆ†é…2.png" alt="æŸ¥çœ‹æ ˆçš„å†…éƒ¨ç»“æ„åˆ†é…2"></p><blockquote><p>ä¸ºä»€ä¹ˆæ˜æ˜å‚æ•°è®¾ç½®çš„æ˜¯600Mï¼Œå®é™…è¾“å‡ºåªæœ‰575Må‘¢ï¼Ÿ</p><p>ç­”ï¼š575M = edenåŒº + survivor0åŒº + è€å¹´ä»£åŒº</p><p>ï¼ˆsurivor0åŒºå’Œsurivor1åŒºåªç®—äº†å…¶ä¸­1ä¸ªï¼‰</p></blockquote><h4 id="å¹´è½»ä»£ä¸è€å¹´ä»£"><a href="#å¹´è½»ä»£ä¸è€å¹´ä»£" class="headerlink" title="å¹´è½»ä»£ä¸è€å¹´ä»£"></a>å¹´è½»ä»£ä¸è€å¹´ä»£</h4><p><img src="http://cdn.leesin.fun/typora/img/å¹´è½»ä»£ä¸è€å¹´ä»£.png" alt="å¹´è½»ä»£ä¸è€å¹´ä»£"></p><h5 id="åŸºæœ¬æ¦‚è¿°"><a href="#åŸºæœ¬æ¦‚è¿°" class="headerlink" title="åŸºæœ¬æ¦‚è¿°"></a>åŸºæœ¬æ¦‚è¿°</h5><ul><li><code>-XX:NewRatio</code>ï¼šè®¾ç½®æ–°ç”Ÿä»£ä¸è€å¹´ä»£çš„æ¯”ä¾‹ã€‚é»˜è®¤å€¼æ˜¯<code>-XX:NewRatio=2</code>ï¼Œå³æ–°ç”Ÿä»£:è€å¹´ä»£=1ï¼š2</li><li><code>-XX:SurvivorRatio</code>ï¼šè®¾ç½®æ–°ç”Ÿä»£ä¸­EdenåŒºä¸SurvivoråŒºçš„æ¯”ä¾‹ã€‚å¦‚<code>-XX:SurvivorRatio=8</code>ï¼Œè¡¨ç¤º EdenåŒºï¼šSurvivor1åŒºï¼šSurivivor2åŒº=8ï¼š1ï¼š1</li></ul><blockquote><ul><li>å‡ ä¹æ‰€æœ‰çš„Javaå¯¹è±¡éƒ½æ˜¯åœ¨ Eden åŒºè¢« new å‡ºæ¥çš„ã€‚</li><li>ç»å¤§éƒ¨åˆ†çš„Javaå¯¹è±¡çš„é”€æ¯éƒ½åœ¨æ–°ç”Ÿä»£è¿›è¡Œäº†ã€‚</li><li>å¯ä»¥ä½¿ç”¨é€‰é¡¹<code>-Xmn</code>è®¾ç½®æ–°ç”Ÿä»£æœ€å¤§å†…å­˜å¤§å°ã€‚ï¼ˆè¿™ä¸ªé€‰é¡¹ä¸€èˆ¬ä¸è¿›è¡Œè®¾ç½®ï¼‰</li></ul></blockquote><p>å¦‚ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è™šæ‹Ÿæœºå‚æ•°ä¸º-Xms600m -Xmx600m -XX:NewRatio=2 -XX:SurvivorRatio=8 -XX:+PrintGCDetails</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ä»è¾“å‡ºç»“æœå¯ä»¥çœ‹å‡ºæ¥</span></span><br><span class="line"><span class="comment">// æ–°ç”Ÿä»£ï¼šè€å¹´ä»£ = 200M : 400M = 1 ï¼š 2</span></span><br><span class="line"><span class="comment">// EdenåŒº ï¼š Survivor0åŒº ï¼š Survivor1åŒº = 160M : 20M : 20M = 8 : 1 : 1</span></span><br></pre></td></tr></table></figure><p><img src="http://cdn.leesin.fun/typora/img/å‚æ•°ç¤ºä¾‹1.png" alt="å‚æ•°ç¤ºä¾‹1"></p><h5 id="æ¶‰åŠçš„åƒåœ¾å›æ”¶"><a href="#æ¶‰åŠçš„åƒåœ¾å›æ”¶" class="headerlink" title="æ¶‰åŠçš„åƒåœ¾å›æ”¶"></a>æ¶‰åŠçš„åƒåœ¾å›æ”¶</h5><p><img src="http://cdn.leesin.fun/typora/img/image-20221123102127036.png" alt="image-20221123102127036" style="zoom: 50%;"></p><blockquote><ul><li>å¯¹äºå¹¸å­˜è€…s0ã€s1åŒºçš„æ€»ç»“ï¼šå¤åˆ¶ä¹‹åæœ‰äº¤æ¢ï¼Œè°ç©ºè°æ˜¯toåŒº</li><li>å…³äºåƒåœ¾å›æ”¶ï¼šé¢‘ç¹åœ¨æ–°ç”ŸåŒºæ”¶é›†ï¼Œå¾ˆå°‘åœ¨å…»è€åŒºæ”¶é›†ï¼Œå‡ ä¹ä¸åœ¨æ°¸ä¹…åŒº/å…ƒç©ºé—´æ”¶é›†ã€‚</li></ul></blockquote><p><img src="http://cdn.leesin.fun/typora/img/å¯¹è±¡åˆ†é….png" alt="å¯¹è±¡åˆ†é…"></p><h4 id="Minor-GCã€Major-GCã€Full-GC"><a href="#Minor-GCã€Major-GCã€Full-GC" class="headerlink" title="Minor GCã€Major GCã€Full GC"></a>Minor GCã€Major GCã€Full GC</h4><p>JVMåœ¨è¿›è¡ŒGCæ—¶ï¼Œå¹¶éæ¯æ¬¡éƒ½å¯¹ä¸Šé¢ä¸‰ä¸ªå†…å­˜ï¼ˆæ–°ç”Ÿä»£ã€è€å¹´ä»£ï¼›æ–¹æ³•åŒºï¼‰åŒºåŸŸä¸€èµ·å›æ”¶çš„ï¼Œå¤§éƒ¨åˆ†æ—¶å€™å›æ”¶çš„éƒ½æ˜¯æŒ‡æ–°ç”Ÿä»£ã€‚</p><p>é’ˆå¯¹HotSpot VMçš„å®ç°ï¼Œå®ƒé‡Œé¢çš„GCæŒ‰ç…§å›æ”¶åŒºåŸŸåˆåˆ†ä¸ºä¸¤å¤§ç§ç±»å‹ï¼šéƒ¨åˆ†æ”¶é›†ï¼ˆPartial GCï¼‰å’Œæ•´å †æ”¶é›†ï¼ˆFull GCï¼‰</p><ul><li>éƒ¨åˆ†æ”¶é›†ï¼šä¸æ˜¯å®Œæ•´æ”¶é›†æ•´ä¸ªJavaå †çš„åƒåœ¾æ”¶é›†ã€‚å…¶ä¸­åˆåˆ†ä¸ºï¼š<ul><li>æ–°ç”Ÿä»£æ”¶é›†ï¼ˆMinor GC/Young GCï¼‰ï¼šåªæ˜¯æ–°ç”Ÿä»£ï¼ˆEden,s0,s1ï¼‰çš„åƒåœ¾æ”¶é›†</li><li>è€å¹´ä»£æ”¶é›†ï¼ˆMajor GC/Old GCï¼‰:åªæ˜¯è€å¹´ä»£çš„åƒåœ¾æ”¶é›†ã€‚<ul><li>ç›®å‰ï¼Œåªæœ‰CMSçš„GCä¼šæœ‰å•ç‹¬æ”¶é›†è€å¹´ä»£çš„è¡Œä¸ºã€‚</li><li>æ³¨æ„ï¼Œå¾ˆå¤šæ—¶å€™Major GCä¼šå’ŒFull GCæ··æ·†ä½¿ç”¨ï¼Œä¸€å®šè¦å…·ä½“åˆ†è¾¨æ˜¯è€å¹´ä»£å›æ”¶è¿˜æ˜¯æ•´å †å›æ”¶ã€‚</li></ul></li><li>æ··åˆæ”¶é›†ï¼ˆMixed GCï¼‰ï¼šæ”¶é›†æ•´ä¸ªæ–°ç”Ÿä»£ä»¥åŠéƒ¨åˆ†è€å¹´ä»£çš„åƒåœ¾æ”¶é›†ã€‚<ul><li>ç›®å‰ï¼Œåªæœ‰G1çš„GCä¼šæœ‰è¿™ç§è¡Œä¸ºã€‚</li></ul></li></ul></li><li>æ•´å †æ”¶é›†ï¼ˆFull GCï¼‰ï¼šæ”¶é›†æ•´ä¸ªJavaå †å’Œæ–¹æ³•åŒºçš„åƒåœ¾æ”¶é›†ã€‚</li></ul><h5 id="Minor-GC"><a href="#Minor-GC" class="headerlink" title="Minor GC"></a>Minor GC</h5><ul><li>å½“å¹´è½»ä»£ç©ºé—´ä¸è¶³æ—¶ï¼Œå°±ä¼šè§¦å‘ Minor GCï¼Œè¿™é‡Œçš„å¹´è½»ä»£æ»¡æŒ‡çš„æ˜¯EdenåŒºæ»¡ï¼ŒSurvior åŒºæ»¡æ˜¯ä¸ä¼šå¼•å‘ GC çš„ã€‚ï¼ˆæ¯æ¬¡Minor GC ä¼šæ¸…ç†å¹´è½»ä»£çš„å†…å­˜ï¼‰</li><li>å› ä¸º Java å¯¹è±¡å¤§å¤šéƒ½å…·å¤‡æœç”Ÿå¤•ç­çš„ç‰¹æ€§ï¼Œæ‰€ä»¥ Minor GC éå¸¸é¢‘ç¹ï¼Œä¸€èˆ¬å›æ”¶é€Ÿåº¦ä¹Ÿæ¯”è¾ƒå¿«ã€‚</li><li>Minor GC ä¼šå¼•å‘ STWï¼Œæš‚åœå…¶ä»–ç”¨æˆ·çº¿ç¨‹ï¼Œç­‰åƒåœ¾å›æ”¶ç»“æŸï¼Œç”¨æˆ·çº¿ç¨‹æ‰æ¢å¤è¿è¡Œã€‚</li></ul><h5 id="Major-GCå’ŒFull-GC"><a href="#Major-GCå’ŒFull-GC" class="headerlink" title="Major GCå’ŒFull GC"></a>Major GCå’ŒFull GC</h5><p>æš‚æ—¶ç•¥</p><h4 id="å†…å­˜åˆ†é…ç­–ç•¥"><a href="#å†…å­˜åˆ†é…ç­–ç•¥" class="headerlink" title="å†…å­˜åˆ†é…ç­–ç•¥"></a>å†…å­˜åˆ†é…ç­–ç•¥</h4><p>é’ˆå¯¹ä¸åŒå¹´é¾„æ®µçš„å¯¹è±¡åˆ†é…åŸåˆ™å¦‚ä¸‹æ‰€ç¤ºï¼š</p><ul><li>ä¼˜å…ˆåˆ†é…åˆ° Eden</li><li>å¤§å¯¹è±¡ç›´æ¥åˆ†é…åˆ°è€å¹´ä»£<ul><li>å°½é‡é¿å…ç¨‹åºä¸­å‡ºç°è¿‡å¤šçš„å¤§å¯¹è±¡</li></ul></li><li>é•¿æœŸå­˜æ´»çš„å¯¹è±¡åˆ†é…åˆ°è€å¹´ä»£</li><li>åŠ¨æ€å¯¹è±¡å¹´é¾„åˆ¤æ–­<ul><li>å¦‚æœ Survivor åŒºä¸­ç›¸åŒå¹´é¾„çš„æ‰€æœ‰å¯¹è±¡å¤§å°çš„æ€»å’Œå¤§äº Survivor ç©ºé—´çš„ä¸€åŠï¼Œå¹´é¾„å¤§äºæˆ–ç­‰äºè¯¥å¹´é¾„çš„å¯¹è±¡å¯ä»¥ç›´æ¥è¿›å…¥è€å¹´ä»£ï¼Œæ— é¡»ç­‰åˆ° MaxTenuringThreshold ä¸­è¦æ±‚çš„å¹´é¾„ã€‚</li></ul></li><li>ç©ºé—´åˆ†é…æ‹…ä¿<ul><li><code>-XX:HandlePromotionFailure</code></li></ul></li></ul><h2 id="StringTable"><a href="#StringTable" class="headerlink" title="StringTable"></a>StringTable</h2><h3 id="å¸¸é‡æ± åŸºæœ¬æ¦‚å¿µ"><a href="#å¸¸é‡æ± åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="å¸¸é‡æ± åŸºæœ¬æ¦‚å¿µ"></a>å¸¸é‡æ± åŸºæœ¬æ¦‚å¿µ</h3><ul><li>å­—ç¬¦ä¸²å¸¸é‡æ± æ˜¯ä¸€ä¸ªå›ºå®šå¤§å°çš„ Hashtableï¼Œjdk8ä¸­é»˜è®¤å€¼å¤§å°æ˜¯60013ã€‚å¦‚æœæ”¾è¿›String Pool çš„ String éå¸¸å¤šï¼Œå°±ä¼šé€ æˆ Hash å†²çªä¸¥é‡ï¼Œä»è€Œå¯¼è‡´é“¾è¡¨ä¼šå¾ˆé•¿ï¼Œè°ƒç”¨ String.intern æ—¶æ€§èƒ½ä¼šå¤§å¹…ä¸‹é™ã€‚</li><li>ä½¿ç”¨<code>-XX:StringTableSize</code>å¯ä»¥è®¾ç½® StringTable çš„é•¿åº¦</li></ul><blockquote><ul><li>åœ¨Javaè¯­è¨€ä¸­æœ‰8ç§åŸºæœ¬æ•°æ®ç±»å‹å’Œä¸€ç§æ¯”è¾ƒç‰¹æ®Šçš„ç±»å‹Stringã€‚ä¸ºäº†ä½¿è¿™äº›ç±»å‹åœ¨è¿è¡Œç§é€Ÿåº¦æ›´å¿«ã€æ›´èŠ‚çœå†…å­˜ï¼Œéƒ½æä¾›äº†ä¸€ç§å¸¸é‡æ± çš„æ¦‚å¿µã€‚</li><li>å¸¸é‡æ± å°±ç±»ä¼¼ä¸€ä¸ªJavaç³»ç»Ÿçº§åˆ«æä¾›çš„ç¼“å­˜ã€‚8ç§åŸºæœ¬æ•°æ®ç±»å‹çš„å¸¸é‡æ± æ˜¯ç³»ç»Ÿåè°ƒçš„ï¼Œ<strong>Stringç±»å‹çš„å¸¸é‡æ± æ¯”è¾ƒç‰¹æ®Šã€‚å®ƒä¸»è¦ä½¿ç”¨æ–¹æ³•æœ‰ä¸¤ç§ï¼š</strong><ul><li>ç›´æ¥ä½¿ç”¨åŒå¼•å·å£°æ˜å‡ºæ¥çš„Stringå¯¹è±¡ä¼šç›´æ¥å­˜å‚¨åœ¨å¸¸é‡æ± ä¸­ã€‚<ul><li>æ¯”å¦‚ï¼š<code>String str = &quot;abc&quot;;</code></li></ul></li><li>å¯ä»¥ä½¿ç”¨Stringæä¾›çš„internæ–¹æ³•ã€‚</li></ul></li></ul></blockquote><h3 id="StringTableçš„å†…å­˜åˆ†é…â­â­â­"><a href="#StringTableçš„å†…å­˜åˆ†é…â­â­â­" class="headerlink" title="StringTableçš„å†…å­˜åˆ†é…â­â­â­"></a>StringTableçš„å†…å­˜åˆ†é…â­â­â­</h3><ul><li>Java 6åŠä»¥å‰ï¼Œå­—ç¬¦ä¸²å¸¸é‡æ± å­˜æ”¾åœ¨æ°¸ä¹…ä»£ã€‚</li><li>==java 7å¼€å§‹ï¼Œå­—ç¬¦ä¸²å¸¸é‡æ± æ”¾åœ¨javaå †å†…ã€‚==â­â­â­</li></ul><blockquote><p>é¢è¯•é¢˜ï¼šStringTableä¸ºä»€ä¹ˆè¿™æ ·è°ƒæ•´ä½ç½®ï¼Ÿ</p><ol><li>æ°¸ä¹…ä»£ç©ºé—´é»˜è®¤æ¯”è¾ƒå°</li><li>æ°¸ä¹…ä»£å›æ”¶é¢‘ç‡ä½</li></ol></blockquote><h3 id="å­—ç¬¦ä¸²æ‹¼æ¥æ“ä½œ"><a href="#å­—ç¬¦ä¸²æ‹¼æ¥æ“ä½œ" class="headerlink" title="å­—ç¬¦ä¸²æ‹¼æ¥æ“ä½œ"></a>å­—ç¬¦ä¸²æ‹¼æ¥æ“ä½œ</h3><ol><li>å¸¸é‡ä¸å¸¸é‡çš„æ‹¼æ¥ç»“æœåœ¨å¸¸é‡æ± ï¼ŒåŸç†æ˜¯ç¼–è¯‘æœŸï¼ˆç”Ÿæˆ.classï¼‰ä¼˜åŒ–ã€‚</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test1</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">s1</span> <span class="operator">=</span> <span class="string">&quot;a&quot;</span> + <span class="string">&quot;b&quot;</span> + <span class="string">&quot;c&quot;</span>;<span class="comment">//ç¼–è¯‘æœŸä¼˜åŒ–ï¼šç­‰åŒäº&quot;abc&quot;</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">s2</span> <span class="operator">=</span> <span class="string">&quot;abc&quot;</span>; <span class="comment">//&quot;abc&quot;ä¸€å®šæ˜¯æ”¾åœ¨å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­ï¼Œå°†æ­¤åœ°å€èµ‹ç»™s2</span></span><br><span class="line"></span><br><span class="line">    System.out.println(s1 == s2); <span class="comment">//true</span></span><br><span class="line">    System.out.println(s1.equals(s2)); <span class="comment">//true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸‹å›¾æ˜¯test1å¯¹åº”çš„å­—èŠ‚ç æŒ‡ä»¤ï¼š</p><p><img src="http://cdn.leesin.fun/typora/img/test1çš„å­—èŠ‚ç .png" alt="test1çš„å­—èŠ‚ç " style="zoom: 80%;"></p><p>ä¸‹å›¾æ˜¯å­—èŠ‚ç æ–‡ä»¶çš„åç¼–è¯‘ç»“æœï¼š</p><p><img src="http://cdn.leesin.fun/typora/img/test1çš„åç¼–è¯‘ç»“æœ.png" alt="test1çš„åç¼–è¯‘ç»“æœ"></p><ol><li>å¸¸é‡æ± ä¸­ä¸ä¼šå­˜åœ¨ç›¸åŒå†…å®¹çš„å¸¸é‡ã€‚</li><li>åªæœ‰å…¶ä¸­æœ‰ä¸€ä¸ªæ˜¯å˜é‡ï¼Œç»“æœå°±åœ¨å †ä¸­ã€‚å˜é‡æ‹¼æ¥çš„åŸç†æ˜¯StringBuilderã€‚</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test2</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">s1</span> <span class="operator">=</span> <span class="string">&quot;javaEE&quot;</span>;</span><br><span class="line">    <span class="type">String</span> <span class="variable">s2</span> <span class="operator">=</span> <span class="string">&quot;hadoop&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">String</span> <span class="variable">s3</span> <span class="operator">=</span> <span class="string">&quot;javaEEhadoop&quot;</span>;</span><br><span class="line">    <span class="type">String</span> <span class="variable">s4</span> <span class="operator">=</span> <span class="string">&quot;javaEE&quot;</span> + <span class="string">&quot;hadoop&quot;</span>;<span class="comment">//ç¼–è¯‘æœŸä¼˜åŒ–</span></span><br><span class="line"></span><br><span class="line">    <span class="type">String</span> <span class="variable">s5</span> <span class="operator">=</span> s1 + <span class="string">&quot;hadoop&quot;</span>;</span><br><span class="line">    <span class="type">String</span> <span class="variable">s6</span> <span class="operator">=</span> <span class="string">&quot;javaEE&quot;</span> + s2;</span><br><span class="line">    <span class="type">String</span> <span class="variable">s7</span> <span class="operator">=</span> s1 + s2;</span><br><span class="line"></span><br><span class="line">    System.out.println(s3 == s4);<span class="comment">//true</span></span><br><span class="line">    System.out.println(s3 == s5);<span class="comment">//false</span></span><br><span class="line">    System.out.println(s3 == s6);<span class="comment">//false</span></span><br><span class="line">    System.out.println(s3 == s7);<span class="comment">//false</span></span><br><span class="line">    System.out.println(s5 == s6);<span class="comment">//false</span></span><br><span class="line">    System.out.println(s5 == s7);<span class="comment">//false</span></span><br><span class="line">    System.out.println(s6 == s7);<span class="comment">//false</span></span><br><span class="line"></span><br><span class="line">    <span class="type">String</span> <span class="variable">s8</span> <span class="operator">=</span> s6.intern();</span><br><span class="line">    System.out.println(s3 == s8);<span class="comment">//true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test3</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">s1</span> <span class="operator">=</span> <span class="string">&quot;a&quot;</span>;</span><br><span class="line">    <span class="type">String</span> <span class="variable">s2</span> <span class="operator">=</span> <span class="string">&quot;b&quot;</span>;</span><br><span class="line">    <span class="type">String</span> <span class="variable">s3</span> <span class="operator">=</span> <span class="string">&quot;ab&quot;</span>;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    å¦‚ä¸‹çš„s1 + s2 çš„æ‰§è¡Œç»†èŠ‚ï¼š(å˜é‡sæ˜¯æˆ‘ä¸´æ—¶å®šä¹‰çš„ï¼‰</span></span><br><span class="line"><span class="comment">    â‘  StringBuilder s = new StringBuilder();</span></span><br><span class="line"><span class="comment">    â‘¡ s.append(&quot;a&quot;)</span></span><br><span class="line"><span class="comment">    â‘¢ s.append(&quot;b&quot;)</span></span><br><span class="line"><span class="comment">    â‘£ s.toString()  --&gt; çº¦ç­‰äº new String(&quot;ab&quot;)</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">s4</span> <span class="operator">=</span> s1 + s2;</span><br><span class="line">    System.out.println(s3 == s4);<span class="comment">//false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>test3çš„å­—èŠ‚ç å¦‚ä¸‹ï¼š</p><p><img src="http://cdn.leesin.fun/typora/img/test3çš„å­—èŠ‚ç .png" alt="test3çš„å­—èŠ‚ç "></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test4</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">final</span> <span class="type">String</span> <span class="variable">s1</span> <span class="operator">=</span> <span class="string">&quot;a&quot;</span>;</span><br><span class="line">    <span class="keyword">final</span> <span class="type">String</span> <span class="variable">s2</span> <span class="operator">=</span> <span class="string">&quot;b&quot;</span>;</span><br><span class="line">    <span class="type">String</span> <span class="variable">s3</span> <span class="operator">=</span> <span class="string">&quot;ab&quot;</span>;</span><br><span class="line">    <span class="type">String</span> <span class="variable">s4</span> <span class="operator">=</span> s1 + s2;</span><br><span class="line">    System.out.println(s3 == s4);<span class="comment">//true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç»ƒä¹ ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ç»ƒä¹ ï¼š</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test5</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">s1</span> <span class="operator">=</span> <span class="string">&quot;javaEEhadoop&quot;</span>;</span><br><span class="line">    <span class="type">String</span> <span class="variable">s2</span> <span class="operator">=</span> <span class="string">&quot;javaEE&quot;</span>;</span><br><span class="line">    <span class="type">String</span> <span class="variable">s3</span> <span class="operator">=</span> s2 + <span class="string">&quot;hadoop&quot;</span>;</span><br><span class="line">    System.out.println(s1 == s3);<span class="comment">//false</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">final</span> <span class="type">String</span> <span class="variable">s4</span> <span class="operator">=</span> <span class="string">&quot;javaEE&quot;</span>;<span class="comment">//s4:å¸¸é‡</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">s5</span> <span class="operator">=</span> s4 + <span class="string">&quot;hadoop&quot;</span>;</span><br><span class="line">    System.out.println(s1 == s5);<span class="comment">//true</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li>å¦‚æœæ‹¼æ¥çš„ç»“æœè°ƒç”¨intern()æ–¹æ³•ï¼Œåˆ™ä¸»åŠ¨å°†å¸¸é‡æ± ä¸­è¿˜æ²¡æœ‰çš„å­—ç¬¦ä¸²å¯¹è±¡æ”¾å…¥æ± ä¸­ï¼Œå¹¶è¿”å›æ­¤å¯¹è±¡åœ°å€ã€‚ï¼ˆåé¢è¯¦ç»†è®²ï¼‰</li></ol><h3 id="å­—ç¬¦ä¸²æ‹¼æ¥ä¸StringBuilderçš„appendæ“ä½œçš„æ•ˆç‡å¯¹æ¯”"><a href="#å­—ç¬¦ä¸²æ‹¼æ¥ä¸StringBuilderçš„appendæ“ä½œçš„æ•ˆç‡å¯¹æ¯”" class="headerlink" title="å­—ç¬¦ä¸²æ‹¼æ¥ä¸StringBuilderçš„appendæ“ä½œçš„æ•ˆç‡å¯¹æ¯”"></a>å­—ç¬¦ä¸²æ‹¼æ¥ä¸StringBuilderçš„appendæ“ä½œçš„æ•ˆç‡å¯¹æ¯”</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test6</span><span class="params">()</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">long</span> <span class="variable">start</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// method1(100000);// 4014ms</span></span><br><span class="line">    method2(<span class="number">100000</span>);<span class="comment">// 7ms</span></span><br><span class="line"></span><br><span class="line">    <span class="type">long</span> <span class="variable">end</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line"></span><br><span class="line">    System.out.println(<span class="string">&quot;èŠ±è´¹çš„æ—¶é—´ä¸ºï¼š&quot;</span> + (end - start));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">method1</span><span class="params">(<span class="type">int</span> highLevel)</span>&#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">src</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>;i &lt; highLevel;i++)&#123;</span><br><span class="line">        src = src + <span class="string">&quot;a&quot;</span>;<span class="comment">//æ¯æ¬¡å¾ªç¯éƒ½ä¼šåˆ›å»ºä¸€ä¸ªStringBuilderã€String</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">method2</span><span class="params">(<span class="type">int</span> highLevel)</span>&#123;</span><br><span class="line">    <span class="comment">//åªéœ€è¦åˆ›å»ºä¸€ä¸ªStringBuilder</span></span><br><span class="line">    <span class="type">StringBuilder</span> <span class="variable">src</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; highLevel; i++) &#123;</span><br><span class="line">        src.append(<span class="string">&quot;a&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>ä½“ä¼šæ‰§è¡Œæ•ˆç‡ï¼šé€šè¿‡StringBuilderçš„append()çš„æ–¹å¼æ·»åŠ å­—ç¬¦ä¸²çš„æ•ˆç‡è¦è¿œé«˜äºä½¿ç”¨Stringçš„å­—ç¬¦ä¸²æ‹¼æ¥æ–¹å¼ï¼</p><ol><li><p>StringBuilderçš„append()çš„æ–¹å¼ï¼šè‡ªå§‹è‡³ç»ˆä¸­åªåˆ›å»ºè¿‡ä¸€ä¸ªStringBuilderçš„å¯¹è±¡</p><p>ä½¿ç”¨Stringçš„å­—ç¬¦ä¸²æ‹¼æ¥æ–¹å¼ï¼šåˆ›å»ºè¿‡å¤šä¸ªStringBuilderå’ŒStringçš„å¯¹è±¡</p></li><li><p>ä½¿ç”¨Stringçš„å­—ç¬¦ä¸²æ‹¼æ¥æ–¹å¼ï¼šå†…å­˜ä¸­ç”±äºåˆ›å»ºäº†è¾ƒå¤šçš„StringBuilderå’ŒStringçš„å¯¹è±¡ï¼Œå†…å­˜å ç”¨æ›´å¤§ï¼›</p><p>å¦‚æœè¿›è¡ŒGCï¼Œéœ€è¦èŠ±è´¹é¢å¤–çš„æ—¶é—´ã€‚</p></li></ol><p>æ”¹è¿›çš„ç©ºé—´ï¼šåœ¨å®é™…å¼€å‘ä¸­ï¼Œå¦‚æœåŸºæœ¬ç¡®å®šè¦å‰å‰ååæ·»åŠ çš„å­—ç¬¦ä¸²é•¿åº¦ä¸é«˜äºæŸä¸ªé™å®šå€¼highLevelçš„æƒ…å†µä¸‹,å»ºè®®ä½¿ç”¨æ„é€ å™¨å®ä¾‹åŒ–ï¼šStringBuilder s = new StringBuilder(highLevel);//new char[highLevel]</p></blockquote><h3 id="intern-çš„ä½¿ç”¨"><a href="#intern-çš„ä½¿ç”¨" class="headerlink" title="intern()çš„ä½¿ç”¨"></a>intern()çš„ä½¿ç”¨</h3><h5 id="å¦‚ä½•ä¿è¯å˜é‡sæŒ‡å‘çš„æ˜¯å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­çš„æ•°æ®å‘¢"><a href="#å¦‚ä½•ä¿è¯å˜é‡sæŒ‡å‘çš„æ˜¯å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­çš„æ•°æ®å‘¢" class="headerlink" title="å¦‚ä½•ä¿è¯å˜é‡sæŒ‡å‘çš„æ˜¯å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­çš„æ•°æ®å‘¢?"></a>å¦‚ä½•ä¿è¯å˜é‡sæŒ‡å‘çš„æ˜¯å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­çš„æ•°æ®å‘¢?</h5><blockquote><p>æœ‰ä¸¤ç§æ–¹å¼ï¼š</p><ol><li><p>å­—é¢é‡å®šä¹‰çš„æ–¹å¼ <code>String s = &quot;hello&quot;;</code></p></li><li><p>è°ƒç”¨intern() <code>String s = new String(&quot;hello&quot;).intern();</code></p><p>æˆ– <code>String s = new StringBuilder(&quot;hello&quot;).toString().intern();</code></p><p>ç­‰</p></li></ol></blockquote><h5 id="é—®é¢˜1ï¼š-new-String-quot-ab-quot-ä¼šåˆ›å»ºå‡ ä¸ªå¯¹è±¡å‘¢ï¼Ÿâ­â­â­"><a href="#é—®é¢˜1ï¼š-new-String-quot-ab-quot-ä¼šåˆ›å»ºå‡ ä¸ªå¯¹è±¡å‘¢ï¼Ÿâ­â­â­" class="headerlink" title="é—®é¢˜1ï¼š new String(&quot;ab&quot;) ä¼šåˆ›å»ºå‡ ä¸ªå¯¹è±¡å‘¢ï¼Ÿâ­â­â­"></a>é—®é¢˜1ï¼š <code>new String(&quot;ab&quot;)</code> ä¼šåˆ›å»ºå‡ ä¸ªå¯¹è±¡å‘¢ï¼Ÿâ­â­â­</h5><blockquote><p>ç­”æ¡ˆï¼š2ä¸ªå¯¹è±¡ï¼Œä»å­—èŠ‚ç çŸ¥é“ã€‚</p><ul><li><p>ä¸€ä¸ªå¯¹è±¡æ˜¯ï¼šnew å…³é”®å­—åœ¨å †ç©ºé—´ä¸­åˆ›å»ºçš„</p></li><li><p>å¦ä¸€ä¸ªå¯¹è±¡æ˜¯ï¼šå­—ç¬¦ä¸²å¸¸é‡æ± ä¸­çš„å¯¹è±¡ã€‚å­—èŠ‚ç æŒ‡ä»¤ï¼šldc</p></li></ul></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;ab&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="http://cdn.leesin.fun/typora/img/new Stringçš„å­—èŠ‚ç .png" alt="new Stringçš„å­—èŠ‚ç "></p><h5 id="é—®é¢˜2ï¼š-new-String-quot-a-quot-new-String-quot-b-quot-ä¼šåˆ›å»ºå‡ ä¸ªå¯¹è±¡å‘¢ï¼Ÿ"><a href="#é—®é¢˜2ï¼š-new-String-quot-a-quot-new-String-quot-b-quot-ä¼šåˆ›å»ºå‡ ä¸ªå¯¹è±¡å‘¢ï¼Ÿ" class="headerlink" title="é—®é¢˜2ï¼š new String(&quot;a&quot;) + new String(&quot;b&quot;) ä¼šåˆ›å»ºå‡ ä¸ªå¯¹è±¡å‘¢ï¼Ÿ"></a>é—®é¢˜2ï¼š <code>new String(&quot;a&quot;) + new String(&quot;b&quot;)</code> ä¼šåˆ›å»ºå‡ ä¸ªå¯¹è±¡å‘¢ï¼Ÿ</h5><blockquote><p>ç­”æ¡ˆï¼š6ä¸ªå¯¹è±¡ï¼Œä»å­—èŠ‚ç çŸ¥é“ã€‚</p><ul><li>å¯¹è±¡1ï¼šnew StringBuilder()</li><li>å¯¹è±¡2ï¼šnew String(â€œaâ€)   åœ¨å †ä¸­</li><li>å¯¹è±¡3ï¼šå¸¸é‡æ± ä¸­çš„â€aâ€</li><li>å¯¹è±¡4ï¼šnew String(â€œbâ€)   åœ¨å †ä¸­</li><li>å¯¹è±¡5ï¼šå¸¸é‡æ± ä¸­çš„â€bâ€</li><li>å¯¹è±¡6ï¼šStringBuilderçš„toString()<ul><li>new String(â€œabâ€)</li><li>==<strong>å¼ºè°ƒä¸€ä¸‹ï¼štoString()çš„è°ƒç”¨ï¼Œåœ¨å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­ï¼Œæ²¡æœ‰ç”Ÿæˆâ€abâ€</strong>==</li></ul></li></ul></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;a&quot;</span>) + <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;b&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>mainæ–¹æ³•çš„å­—èŠ‚ç ï¼š</p><p><img src="http://cdn.leesin.fun/typora/img/new String + new String çš„å­—èŠ‚ç .png" alt="new String + new String çš„å­—èŠ‚ç "></p><p>StringBuilderçš„toString()æ–¹æ³•çš„æºç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// Create a copy, don&#x27;t share the array</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">String</span>(value, <span class="number">0</span>, count);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><p>StringBuilderçš„toString()æ–¹æ³•çš„å­—èŠ‚ç ï¼š</p><p><img src="http://cdn.leesin.fun/typora/img/StringBuilderçš„toString(" alt="StringBuilderçš„toString()æ–¹æ³•çš„å­—èŠ‚ç ">æ–¹æ³•çš„å­—èŠ‚ç .png)</p><blockquote><p>å¯ä»¥çœ‹åˆ°ï¼ŒStringBuilderçš„toString()æ–¹æ³•çš„å­—èŠ‚ç å¹¶æ²¡æœ‰ldcæŒ‡ä»¤ã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œè°ƒç”¨StringBuilderçš„toString()æ–¹æ³•ï¼Œä¸ä¼šåœ¨å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­ç”Ÿæˆâ€abâ€</p></blockquote><h5 id="ä¸€é“é¢è¯•éš¾é¢˜çš„å¼•å…¥"><a href="#ä¸€é“é¢è¯•éš¾é¢˜çš„å¼•å…¥" class="headerlink" title="ä¸€é“é¢è¯•éš¾é¢˜çš„å¼•å…¥"></a>ä¸€é“é¢è¯•éš¾é¢˜çš„å¼•å…¥</h5><p>æœ‰äº†å‰é¢ä¸¤ä¸ªé—®é¢˜çš„åŸºç¡€ï¼Œä¸‹é¢æ¥çœ‹è¿™é“é¢è¯•éš¾é¢˜ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä»¥ä¸‹è¾“å‡ºä»€ä¹ˆï¼Ÿ</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;1&quot;</span>);</span><br><span class="line">    s.intern();</span><br><span class="line">    <span class="type">String</span> <span class="variable">s2</span> <span class="operator">=</span> <span class="string">&quot;1&quot;</span>;</span><br><span class="line">    System.out.println(s == s2);</span><br><span class="line"></span><br><span class="line">    <span class="type">String</span> <span class="variable">s3</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;1&quot;</span>) + <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;1&quot;</span>);</span><br><span class="line">    s3.intern();</span><br><span class="line">    <span class="type">String</span> <span class="variable">s4</span> <span class="operator">=</span> <span class="string">&quot;11&quot;</span>;</span><br><span class="line">    System.out.println(s3 == s4);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç­”æ¡ˆè§£æå¦‚ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;1&quot;</span>);</span><br><span class="line">    s.intern();<span class="comment">//è°ƒç”¨æ­¤æ–¹æ³•ä¹‹å‰ï¼Œå­—ç¬¦ä¸²å¸¸é‡æ± ä¸­å·²ç»å­˜åœ¨äº†&quot;1&quot;</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">s2</span> <span class="operator">=</span> <span class="string">&quot;1&quot;</span>;</span><br><span class="line">    System.out.println(s == s2);<span class="comment">// false</span></span><br><span class="line"></span><br><span class="line">    <span class="type">String</span> <span class="variable">s3</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;1&quot;</span>) + <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;1&quot;</span>);<span class="comment">//s3å˜é‡è®°å½•çš„åœ°å€ä¸ºï¼šnew String(&quot;11&quot;)</span></span><br><span class="line">    <span class="comment">//æ‰§è¡Œå®Œä¸Šä¸€è¡Œä»£ç ä»¥åï¼Œå­—ç¬¦ä¸²å¸¸é‡æ± ä¸­ï¼Œæ˜¯å¦å­˜åœ¨&quot;11&quot;å‘¢ï¼Ÿç­”æ¡ˆï¼šä¸å­˜åœ¨ï¼ï¼</span></span><br><span class="line">    s3.intern();<span class="comment">//åœ¨å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­ç”Ÿæˆ&quot;11&quot;ã€‚å¦‚ä½•ç†è§£ï¼šæ­¤æ—¶å¸¸é‡ä¸­å¹¶æ²¡æœ‰åˆ›å»º&quot;11&quot;,è€Œæ˜¯åˆ›å»ºä¸€ä¸ªæŒ‡å‘å †ç©ºé—´ä¸­new String(&quot;11&quot;)çš„åœ°å€</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">s4</span> <span class="operator">=</span> <span class="string">&quot;11&quot;</span>;<span class="comment">//s4å˜é‡è®°å½•çš„åœ°å€ï¼šä½¿ç”¨çš„æ˜¯ä¸Šä¸€è¡Œä»£ç ä»£ç æ‰§è¡Œæ—¶ï¼Œåœ¨å¸¸é‡æ± ä¸­ç”Ÿæˆçš„&quot;11&quot;çš„åœ°å€</span></span><br><span class="line">    System.out.println(s3 == s4);<span class="comment">//true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å†…å­˜å›¾å¦‚ä¸‹ï¼š</p><p><img src="http://cdn.leesin.fun/typora/img/é¢è¯•éš¾é¢˜å†…å­˜å›¾.png" alt="é¢è¯•éš¾é¢˜å†…å­˜å›¾"></p><h5 id="é¢è¯•é¢˜çš„æ‹“å±•"><a href="#é¢è¯•é¢˜çš„æ‹“å±•" class="headerlink" title="é¢è¯•é¢˜çš„æ‹“å±•"></a>é¢è¯•é¢˜çš„æ‹“å±•</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">s3</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;1&quot;</span>) + <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;1&quot;</span>);<span class="comment">//new String(&quot;11&quot;)</span></span><br><span class="line">    <span class="comment">//æ‰§è¡Œå®Œä¸Šä¸€è¡Œä»£ç ä»¥åï¼Œå­—ç¬¦ä¸²å¸¸é‡æ± ä¸­ï¼Œæ˜¯å¦å­˜åœ¨&quot;11&quot;å‘¢ï¼Ÿç­”æ¡ˆï¼šä¸å­˜åœ¨ï¼ï¼</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">s4</span> <span class="operator">=</span> <span class="string">&quot;11&quot;</span>;<span class="comment">//åœ¨å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­ç”Ÿæˆå¯¹è±¡&quot;11&quot;</span></span><br><span class="line">    s3.intern();</span><br><span class="line">    System.out.println(s3 == s4);<span class="comment">//false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="æ€»ç»“intern-çš„ä½¿ç”¨"><a href="#æ€»ç»“intern-çš„ä½¿ç”¨" class="headerlink" title="æ€»ç»“intern()çš„ä½¿ç”¨"></a>æ€»ç»“intern()çš„ä½¿ç”¨</h5><blockquote><p><code>å­—ç¬¦ä¸²å¯¹è±¡.intern()</code> çš„åŸç†</p><p>jdk7èµ·ï¼Œå°†è¿™ä¸ªå­—ç¬¦ä¸²å¯¹è±¡å°è¯•æ”¾å…¥ä¸²æ± ã€‚</p><pre><code>1. å¦‚æœä¸²æ± ä¸­æœ‰ï¼Œåˆ™å¹¶ä¸ä¼šæ”¾å…¥ã€‚è¿”å›å·²æœ‰çš„ä¸²æ± ä¸­çš„å¯¹è±¡åœ°å€ã€‚1. å¦‚æœæ²¡æœ‰ï¼Œåˆ™ä¼šæŠŠ==å¯¹è±¡çš„å¼•ç”¨åœ°å€å¤åˆ¶ä¸€ä»½==ï¼Œæ”¾å…¥ä¸²æ± ï¼Œå¹¶è¿”å›ä¸²æ± ä¸­çš„å¼•ç”¨åœ°å€ã€‚</code></pre></blockquote><h5 id="ç»ƒä¹ 1"><a href="#ç»ƒä¹ 1" class="headerlink" title="ç»ƒä¹ 1"></a>ç»ƒä¹ 1</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;a&quot;</span>) + <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;b&quot;</span>);</span><br><span class="line">    <span class="comment">// æ­¤æ—¶ä¸²æ± æœ‰&quot;a&quot;å’Œ&quot;b&quot;ï¼Œå¹¶æ²¡æœ‰&quot;ab&quot;</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">s2</span> <span class="operator">=</span> s.intern(); <span class="comment">// ä¸²æ± ä¸­æ²¡æœ‰åˆ›å»ºå­—ç¬¦ä¸²&quot;ab&quot;ï¼Œè€Œæ˜¯åˆ›å»ºä¸€ä¸ªå¼•ç”¨ï¼Œå€¼ä¸ºsã€‚å³s2 = s</span></span><br><span class="line"></span><br><span class="line">    System.out.println(s2 == <span class="string">&quot;ab&quot;</span>); <span class="comment">// true</span></span><br><span class="line">    System.out.println(s == <span class="string">&quot;ab&quot;</span>); <span class="comment">// true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="http://cdn.leesin.fun/typora/img/ç»ƒä¹ 1å†…å­˜å›¾.png" alt="ç»ƒä¹ 1å†…å­˜å›¾"></p><h5 id="ç»ƒä¹ 2"><a href="#ç»ƒä¹ 2" class="headerlink" title="ç»ƒä¹ 2"></a>ç»ƒä¹ 2</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">X</span> <span class="operator">=</span> <span class="string">&quot;ab&quot;</span>; <span class="comment">// ä¸²æ± ä¸­åˆ›å»ºäº†&quot;ab&quot;å¯¹è±¡</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;a&quot;</span>) + <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;b&quot;</span>);</span><br><span class="line">    <span class="type">String</span> <span class="variable">s2</span> <span class="operator">=</span> s.intern();</span><br><span class="line"></span><br><span class="line">    System.out.println(s2 == <span class="string">&quot;ab&quot;</span>); <span class="comment">// true</span></span><br><span class="line">    System.out.println(s == <span class="string">&quot;ab&quot;</span>); <span class="comment">// false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="http://cdn.leesin.fun/typora/img/ç»ƒä¹ 2å†…å­˜å›¾.png" alt="ç»ƒä¹ 2å†…å­˜å›¾"></p><h5 id="ç»ƒä¹ 3"><a href="#ç»ƒä¹ 3" class="headerlink" title="ç»ƒä¹ 3"></a>ç»ƒä¹ 3</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">s1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;a&quot;</span>) + <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;b&quot;</span>);</span><br><span class="line">    s1.intern();</span><br><span class="line">    <span class="type">String</span> <span class="variable">s2</span> <span class="operator">=</span> <span class="string">&quot;ab&quot;</span>;</span><br><span class="line">    System.out.println(s1 == s2); <span class="comment">// true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="ç»ƒä¹ 4"><a href="#ç»ƒä¹ 4" class="headerlink" title="ç»ƒä¹ 4"></a>ç»ƒä¹ 4</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">s1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;ab&quot;</span>);</span><br><span class="line">    s1.intern();</span><br><span class="line">    <span class="type">String</span> <span class="variable">s2</span> <span class="operator">=</span> <span class="string">&quot;ab&quot;</span>;</span><br><span class="line">    System.out.println(s1 == s2); <span class="comment">// false</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// s1æ˜¯å †ä¸­çš„å¯¹è±¡ï¼Œs2æ˜¯ä¸²æ± ä¸­çš„å¯¹è±¡</span></span><br></pre></td></tr></table></figure><h1 id="æœ¬åœ°æ–¹æ³•æ¥å£"><a href="#æœ¬åœ°æ–¹æ³•æ¥å£" class="headerlink" title="æœ¬åœ°æ–¹æ³•æ¥å£"></a>æœ¬åœ°æ–¹æ³•æ¥å£</h1><p>ç•¥</p><h1 id="GC"><a href="#GC" class="headerlink" title="GC"></a>GC</h1><h2 id="æ ‡è®°é˜¶æ®µ"><a href="#æ ‡è®°é˜¶æ®µ" class="headerlink" title="æ ‡è®°é˜¶æ®µ"></a>æ ‡è®°é˜¶æ®µ</h2><h3 id="å¯¹è±¡å­˜æ´»åˆ¤æ–­"><a href="#å¯¹è±¡å­˜æ´»åˆ¤æ–­" class="headerlink" title="å¯¹è±¡å­˜æ´»åˆ¤æ–­"></a>å¯¹è±¡å­˜æ´»åˆ¤æ–­</h3><p>å½“ä¸€ä¸ªå¯¹è±¡å·²ç»ä¸å†è¢«ä»»ä½•çš„å­˜æ´»å¯¹è±¡ç»§ç»­å¼•ç”¨æ—¶ï¼Œå°±å¯ä»¥å®£åˆ¤ä¸ºå·²ç»æ­»äº¡ã€‚</p><h3 id="1-å¼•ç”¨è®¡æ•°ç®—æ³•"><a href="#1-å¼•ç”¨è®¡æ•°ç®—æ³•" class="headerlink" title="1.å¼•ç”¨è®¡æ•°ç®—æ³•"></a>1.å¼•ç”¨è®¡æ•°ç®—æ³•</h3><p>å¼•ç”¨è®¡æ•°ç®—æ³•(Reference Counting)æ¯”è¾ƒç®€å•ï¼Œå¯¹æ¯ä¸ªå¯¹è±¡ä¿å­˜ä¸€ä¸ªæ•´å‹çš„<strong>å¼•ç”¨è®¡æ•°å™¨å±æ€§</strong>ã€‚<u>ç”¨äºè®°å½•å¯¹è±¡è¢«å¼•ç”¨çš„æƒ…å†µã€‚</u></p><blockquote><p>å¯¹äºä¸€ä¸ªå¯¹è±¡Aï¼Œåªè¦æœ‰ä»»ä½•ä¸€ä¸ªå¯¹è±¡å¼•ç”¨äº†Aï¼Œåˆ™Açš„å¼•ç”¨è®¡æ•°å™¨å°±åŠ 1;å½“å¼•ç”¨å¤±æ•ˆæ—¶ï¼Œå¼•ç”¨è®¡æ•°å™¨å°±å‡1ã€‚åªè¦å¯¹è±¡Açš„å¼•ç”¨è®¡æ•°å™¨çš„å€¼ä¸º0ï¼Œå³è¡¨ç¤ºå¯¹è±¡Aä¸å¯èƒ½å†è¢«ä½¿ç”¨ï¼Œå¯è¿›è¡Œå›æ”¶ã€‚</p></blockquote><h5 id="ä¼˜ç‚¹"><a href="#ä¼˜ç‚¹" class="headerlink" title="ä¼˜ç‚¹"></a>ä¼˜ç‚¹</h5><ul><li><p>å®ç°ç®€å•ï¼Œåƒåœ¾å¯¹è±¡ä¾¿äºè¾¨è¯†;</p></li><li><p>åˆ¤å®šæ•ˆç‡é«˜ï¼Œå›æ”¶æ²¡æœ‰å»¶è¿Ÿæ€§ã€‚</p></li></ul><h5 id="ç¼ºç‚¹"><a href="#ç¼ºç‚¹" class="headerlink" title="ç¼ºç‚¹"></a>ç¼ºç‚¹</h5><ul><li>å®ƒéœ€è¦å•ç‹¬çš„å­—æ®µå­˜å‚¨è®¡æ•°å™¨ï¼Œè¿™æ ·çš„åšæ³•<strong>å¢åŠ äº†å­˜å‚¨ç©ºé—´çš„å¼€é”€</strong>.</li><li>æ¯æ¬¡èµ‹å€¼éƒ½éœ€è¦æ›´æ–°è®¡æ•°å™¨ï¼Œä¼´éšç€åŠ æ³•å’Œå‡æ³•æ“ä½œï¼Œè¿™<strong>å¢åŠ äº†æ—¶é—´å¼€é”€</strong>ã€‚</li><li>å¼•ç”¨è®¡æ•°å™¨æœ‰ä¸€ä¸ªä¸¥é‡çš„é—®é¢˜ï¼Œå³<strong>æ— æ³•å¤„ç†å¾ªç¯å¼•ç”¨</strong>çš„æƒ…å†µã€‚<u>è¿™æ˜¯ä¸€æ¡è‡´å‘½ç¼ºé™·å¯¼è‡´åœ¨Javaçš„åƒåœ¾å›æ”¶å™¨ä¸­æ²¡æœ‰ä½¿ç”¨è¿™ç±»ç®—æ³•ã€‚</u></li></ul><h3 id="2-å¯è¾¾æ€§åˆ†æç®—æ³•"><a href="#2-å¯è¾¾æ€§åˆ†æç®—æ³•" class="headerlink" title="2.å¯è¾¾æ€§åˆ†æç®—æ³•"></a>2.å¯è¾¾æ€§åˆ†æç®—æ³•</h3><p>åˆå«æ ¹æœç´¢ç®—æ³•ã€è¿½è¸ªæ€§åƒåœ¾æ”¶é›†</p><ul><li><p>ç›¸å¯¹äºå¼•ç”¨è®¡æ•°ç®—æ³•è€Œè¨€ï¼Œå¯è¾¾æ€§åˆ†æç®—æ³•ä¸ä»…åŒæ ·å…·å¤‡å®ç°ç®€å•å’Œæ‰§è¡Œé«˜æ•ˆç­‰ç‰¹ç‚¹ï¼Œæ›´é‡è¦çš„æ˜¯è¯¥ç®—æ³•å¯ä»¥æœ‰æ•ˆåœ°è§£å†³åœ¨å¼•ç”¨è®¡æ•°ç®—æ³•ä¸­å¾ªç¯å¼•ç”¨çš„é—®é¢˜ï¼Œé˜²æ­¢å†…å­˜æ³„æ¼çš„å‘ç”Ÿã€‚</p></li><li><p>æ‰€è°“â€GC Rootsâ€æ ¹é›†åˆå°±æ˜¯ä¸€ç»„å¿…é¡»æ´»è·ƒçš„å¼•ç”¨</p></li></ul><h5 id="åŸºæœ¬æ€è·¯"><a href="#åŸºæœ¬æ€è·¯" class="headerlink" title="åŸºæœ¬æ€è·¯"></a>åŸºæœ¬æ€è·¯</h5><ul><li>å¯è¾¾æ€§åˆ†æç®—æ³•æ˜¯ä»¥æ ¹å¯¹è±¡é›†åˆ(GC Roots)ä¸ºèµ·å§‹ç‚¹ï¼ŒæŒ‰ç…§ä»ä¸Šè‡³ä¸‹çš„æ–¹å¼<strong>æœç´¢è¢«æ ¹å¯¹è±¡é›†åˆæ‰€è¿æ¥çš„ç›®æ ‡å¯¹è±¡æ˜¯å¦å¯è¾¾ã€‚</strong></li><li>ä½¿ç”¨å¯è¾¾æ€§åˆ†æç®—æ³•åï¼Œå†…å­˜ä¸­çš„å­˜æ´»å¯¹è±¡éƒ½ä¼šè¢«æ ¹å¯¹è±¡é›†åˆç›´æ¥æˆ–é—´æ¥è¿æ¥ç€ï¼Œæœç´¢æ‰€èµ°è¿‡çš„è·¯å¾„ç§°ä¸º<strong>å¼•ç”¨é“¾(Reference chain)</strong></li><li>å¦‚æœç›®æ ‡å¯¹è±¡æ²¡æœ‰ä»»ä½•å¼•ç”¨é“¾ç›¸è¿ï¼Œåˆ™æ˜¯ä¸å¯è¾¾çš„ï¼Œå°±æ„å‘³ç€è¯¥å¯¹è±¡å·±ç»æ­»äº¡ã€‚</li><li>åœ¨å¯è¾¾æ€§åˆ†æç®—æ³•ä¸­ï¼Œåªæœ‰èƒ½å¤Ÿè¢«æ ¹å¯¹è±¡é›†åˆç›´æ¥æˆ–è€…é—´æ¥è¿æ¥çš„å¯¹è±¡æ‰æ˜¯å­˜æ´»å¯¹è±¡ã€‚</li></ul><p><img src="http://cdn.leesin.fun/typora/s3/img/å¯è¾¾æ€§åˆ†æç®—æ³•.png" alt="å¯è¾¾æ€§åˆ†æç®—æ³•"></p><h5 id="GC-ROOTâ­â­â­"><a href="#GC-ROOTâ­â­â­" class="headerlink" title="GC ROOTâ­â­â­"></a>GC ROOTâ­â­â­</h5><p>åœ¨Java è¯­è¨€ä¸­ï¼Œ GC Roots åŒ…æ‹¬ä»¥ä¸‹å‡ ç±»å…ƒç´ :</p><ul><li><p>è™šæ‹Ÿæœºæ ˆä¸­å¼•ç”¨çš„å¯¹è±¡</p><ul><li>æ¯”å¦‚:å„ä¸ªçº¿ç¨‹è¢«è°ƒç”¨çš„æ–¹æ³•ä¸­ä½¿ç”¨åˆ°çš„å‚æ•°ã€å±€éƒ¨å˜é‡ç­‰ã€‚</li></ul></li><li><p>æœ¬åœ°æ–¹æ³•æ ˆå†…JNI(é€šå¸¸è¯´çš„æœ¬åœ°æ–¹æ³•)å¼•ç”¨çš„å¯¹è±¡</p></li><li><p>æ–¹æ³•åŒºä¸­ç±»é™æ€å±æ€§å¼•ç”¨çš„å¯¹è±¡</p><ul><li>æ¯”å¦‚: Javaç±»çš„å¼•ç”¨ç±»å‹é™æ€å˜é‡</li></ul></li><li><p>æ–¹æ³•åŒºä¸­å¸¸é‡å¼•ç”¨çš„å¯¹è±¡</p><ul><li>æ¯”å¦‚:å­—ç¬¦ä¸²å¸¸é‡æ± (string Table)é‡Œçš„å¼•ç”¨</li></ul></li><li><p>æ‰€æœ‰è¢«åŒæ­¥é”synchronizedæŒæœ‰çš„å¯¹è±¡</p></li><li><p>Javaè™šæ‹Ÿæœºå†…éƒ¨çš„å¼•ç”¨ã€‚</p><ul><li>åŸºæœ¬æ•°æ®ç±»å‹å¯¹åº”çš„classå¯¹è±¡ï¼Œä¸€äº›å¸¸é©»çš„å¼‚å¸¸å¯¹è±¡ (å¦‚:NullPointerExceptionã€OutOfMemoryError)ï¼Œç³»ç»Ÿç±»åŠ è½½å™¨ã€‚</li></ul></li><li>åæ˜ javaè™šæ‹Ÿæœºå†…éƒ¨æƒ…å†µçš„JMXBeanã€JVMTIä¸­æ³¨å†Œçš„å›è°ƒã€æœ¬åœ°ä»£ç ç¼“å­˜ç­‰ã€‚</li></ul><h2 id="æ¸…é™¤é˜¶æ®µ"><a href="#æ¸…é™¤é˜¶æ®µ" class="headerlink" title="æ¸…é™¤é˜¶æ®µ"></a>æ¸…é™¤é˜¶æ®µ</h2><h3 id="1-æ ‡è®°-æ¸…é™¤ï¼ˆMark-sweepï¼‰ç®—æ³•"><a href="#1-æ ‡è®°-æ¸…é™¤ï¼ˆMark-sweepï¼‰ç®—æ³•" class="headerlink" title="1.æ ‡è®°-æ¸…é™¤ï¼ˆMark-sweepï¼‰ç®—æ³•"></a>1.æ ‡è®°-æ¸…é™¤ï¼ˆMark-sweepï¼‰ç®—æ³•</h3><h5 id="æ‰§è¡Œè¿‡ç¨‹"><a href="#æ‰§è¡Œè¿‡ç¨‹" class="headerlink" title="æ‰§è¡Œè¿‡ç¨‹"></a>æ‰§è¡Œè¿‡ç¨‹</h5><p>å½“å †ä¸­çš„æœ‰æ•ˆå†…å­˜ç©ºé—´ (available memory)è¢«è€—å°½çš„æ—¶å€™ï¼Œå°±ä¼šåœæ­¢æ•´ä¸ªç¨‹åº(ä¹Ÿè¢«ç§°ä¸ºstop the world)ï¼Œç„¶åè¿›è¡Œä¸¤é¡¹å·¥ä½œï¼Œç¬¬ä¸€é¡¹åˆ™æ˜¯æ ‡è®°,ç¬¬äºŒé¡¹åˆ™æ˜¯æ¸…é™¤ã€‚</p><ul><li>æ ‡è®°: Collectorä»å¼•ç”¨æ ¹èŠ‚ç‚¹å¼€å§‹éå†ï¼Œæ ‡è®°æ‰€æœ‰è¢«å¼•ç”¨çš„å¯¹è±¡ã€‚ä¸€èˆ¬æ˜¯åœ¨å¯¹è±¡çš„Headerä¸­è®°å½•ä¸ºå¯è¾¾å¯¹è±¡ã€‚</li><li>æ¸…é™¤: Collectorå¯¹å †å†…å­˜ä»å¤´åˆ°å°¾è¿›è¡Œçº¿æ€§çš„éå†ï¼Œå¦‚æœå‘ç°æŸä¸ªå¯¹è±¡åœ¨å…¶Headerä¸­æ²¡æœ‰æ ‡è®°ä¸ºå¯è¾¾å¯¹è±¡ï¼Œåˆ™å°†å…¶å›æ”¶ã€‚</li></ul><p><img src="http://cdn.leesin.fun/typora/s3/img/ç¬¬14ç« _æ ‡è®°-æ¸…é™¤ç®—æ³•.jpg" alt="ç¬¬14ç« _æ ‡è®°-æ¸…é™¤ç®—æ³•"></p><h5 id="ç¼ºç‚¹-1"><a href="#ç¼ºç‚¹-1" class="headerlink" title="ç¼ºç‚¹"></a>ç¼ºç‚¹</h5><ul><li>æ•ˆç‡ä¸ç®—é«˜</li><li>åœ¨è¿›è¡ŒGCçš„æ—¶å€™ï¼Œéœ€è¦åœæ­¢æ•´ä¸ªåº”ç”¨ç¨‹åºï¼Œå¯¼è‡´ç”¨æˆ·ä½“éªŒå·®</li><li>è¿™ç§æ–¹å¼æ¸…ç†å‡ºæ¥çš„ç©ºé—²å†…å­˜æ˜¯ä¸è¿ç»­çš„ï¼Œäº§ç”Ÿå†…å­˜ç¢ç‰‡ã€‚éœ€è¦ç»´æŠ¤ä¸€ä¸ªç©ºé—²åˆ—è¡¨</li></ul><blockquote><p>æ³¨æ„:ä½•ä¸ºæ¸…é™¤?<br>è¿™é‡Œæ‰€è°“çš„æ¸…é™¤å¹¶ä¸æ˜¯çœŸçš„ç½®ç©ºï¼Œè€Œæ˜¯æŠŠéœ€è¦æ¸…é™¤çš„å¯¹è±¡åœ°å€ä¿å­˜åœ¨ç©ºé—²çš„åœ°å€åˆ—è¡¨é‡Œã€‚ä¸‹æ¬¡æœ‰æ–°å¯¹è±¡éœ€è¦åŠ è½½æ—¶ï¼Œåˆ¤æ–­åƒåœ¾çš„ä½ç½®ç©ºé—´æ˜¯å¦å¤Ÿï¼Œå¦‚æœå¤Ÿï¼Œå°±å­˜æ”¾ã€‚</p></blockquote><h3 id="2-å¤åˆ¶ï¼ˆCopyingï¼‰ç®—æ³•"><a href="#2-å¤åˆ¶ï¼ˆCopyingï¼‰ç®—æ³•" class="headerlink" title="2.å¤åˆ¶ï¼ˆCopyingï¼‰ç®—æ³•"></a>2.å¤åˆ¶ï¼ˆCopyingï¼‰ç®—æ³•</h3><h5 id="æ ¸å¿ƒæ€æƒ³"><a href="#æ ¸å¿ƒæ€æƒ³" class="headerlink" title="æ ¸å¿ƒæ€æƒ³"></a>æ ¸å¿ƒæ€æƒ³</h5><p>å°†æ´»ç€çš„å†…å­˜ç©ºé—´åˆ†ä¸ºä¸¤å—ï¼Œæ¯æ¬¡åªä½¿ç”¨å…¶ä¸­ä¸€å—ï¼Œåœ¨åƒåœ¾å›æ”¶æ—¶å°†æ­£åœ¨ä½¿ç”¨çš„å†…å­˜ä¸­çš„å­˜æ´»å¯¹è±¡å¤åˆ¶åˆ°æœªè¢«ä½¿ç”¨çš„å†…å­˜å—ä¸­ï¼Œä¹‹åæ¸…é™¤æ­£åœ¨ä½¿ç”¨çš„å†…å­˜å—ä¸­çš„æ‰€æœ‰å¯¹è±¡ï¼Œäº¤æ¢ä¸¤ä¸ªå†…å­˜çš„è§’è‰²ï¼Œæœ€åå®Œæˆåƒåœ¾å›æ”¶ã€‚</p><p><img src="http://cdn.leesin.fun/typora/s3/img/ç¬¬14ç« _å¤åˆ¶ç®—æ³•.jpg" alt="ç¬¬14ç« _å¤åˆ¶ç®—æ³•"></p><h5 id="ä¼˜ç‚¹-1"><a href="#ä¼˜ç‚¹-1" class="headerlink" title="ä¼˜ç‚¹"></a>ä¼˜ç‚¹</h5><ul><li>æ²¡æœ‰æ ‡è®°å’Œæ¸…é™¤è¿‡ç¨‹ï¼Œå®ç°ç®€å•ï¼Œè¿è¡Œé«˜æ•ˆ</li><li>å¤åˆ¶è¿‡å»ä»¥åä¿è¯ç©ºé—´çš„è¿ç»­æ€§ï¼Œä¸ä¼šå‡ºç°â€œç¢ç‰‡â€é—®é¢˜</li></ul><h5 id="ç¼ºç‚¹-2"><a href="#ç¼ºç‚¹-2" class="headerlink" title="ç¼ºç‚¹"></a>ç¼ºç‚¹</h5><ul><li>éœ€è¦ä¸¤å€çš„å†…å­˜ç©ºé—´ã€‚</li><li>å¯¹äºG1è¿™ç§åˆ†æ‹†æˆä¸ºå¤§é‡regionçš„GCï¼Œå¤åˆ¶è€Œä¸æ˜¯ç§»åŠ¨ï¼Œæ„å‘³ç€GCéœ€è¦ç»´æŠ¤regionä¹‹é—´å¯¹è±¡å¼•ç”¨å…³ç³»ï¼Œä¸ç®¡æ˜¯å†…å­˜å ç”¨æˆ–è€…æ—¶é—´å¼€é”€ä¹Ÿä¸å°ã€‚</li><li>ç‰¹åˆ«çš„:å¦‚æœç³»ç»Ÿä¸­çš„åƒåœ¾å¯¹è±¡å¾ˆå¤šï¼Œå¤åˆ¶ç®—æ³•æ•ˆç‡ä¸ä¼šå¾ˆç†æƒ³ã€‚</li></ul><h5 id="åº”ç”¨åœºæ™¯"><a href="#åº”ç”¨åœºæ™¯" class="headerlink" title="åº”ç”¨åœºæ™¯"></a>åº”ç”¨åœºæ™¯</h5><p>åœ¨æ–°ç”Ÿä»£ï¼Œå¯¹å¸¸è§„åº”ç”¨çš„åƒåœ¾å›æ”¶ï¼Œä¸€æ¬¡é€šå¸¸å¯ä»¥å›æ”¶70%-99%çš„å†…å­˜ç©ºé—´ã€‚å›æ”¶æ€§ä»·æ¯”å¾ˆé«˜ã€‚æ‰€ä»¥ç°åœ¨çš„å•†ä¸šè™šæ‹Ÿæœºéƒ½æ˜¯ç”¨è¿™ç§æ”¶é›†ç®—æ³•å›æ”¶æ–°ç”Ÿä»£ã€‚ï¼ˆè€å¹´ä»£ä¸é€‚åˆç”¨è¿™ä¸ªç®—æ³•ï¼‰</p><h3 id="3-æ ‡è®°-å‹ç¼©ï¼ˆMark-compactï¼‰ç®—æ³•-ï¼ˆä¹Ÿå«æ ‡è®°-æ•´ç†ç®—æ³•ï¼‰"><a href="#3-æ ‡è®°-å‹ç¼©ï¼ˆMark-compactï¼‰ç®—æ³•-ï¼ˆä¹Ÿå«æ ‡è®°-æ•´ç†ç®—æ³•ï¼‰" class="headerlink" title="3.æ ‡è®°-å‹ç¼©ï¼ˆMark-compactï¼‰ç®—æ³•  ï¼ˆä¹Ÿå«æ ‡è®°-æ•´ç†ç®—æ³•ï¼‰"></a>3.æ ‡è®°-å‹ç¼©ï¼ˆMark-compactï¼‰ç®—æ³•  ï¼ˆä¹Ÿå«æ ‡è®°-æ•´ç†ç®—æ³•ï¼‰</h3><h5 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h5><ul><li>å¤åˆ¶ç®—æ³•çš„é«˜æ•ˆæ€§æ˜¯å»ºç«‹åœ¨å­˜æ´»å¯¹è±¡å°‘ã€åƒåœ¾å¯¹è±¡å¤šçš„å‰æä¸‹çš„ã€‚è¿™ç§æƒ…å†µåœ¨æ–°ç”Ÿä»£ç»å¸¸å‘ç”Ÿï¼Œä½†æ˜¯åœ¨è€å¹´ä»£ï¼Œæ›´å¸¸è§çš„æƒ…å†µæ˜¯å¤§éƒ¨åˆ†å¯¹è±¡éƒ½æ˜¯å­˜æ´»å¯¹è±¡ã€‚å¦‚æœä¾ç„¶ä½¿ç”¨å¤åˆ¶ç®—æ³•ç”±äºå­˜æ´»å¯¹è±¡è¾ƒå¤šï¼Œå¤åˆ¶çš„æˆæœ¬ä¹Ÿå°†å¾ˆé«˜ã€‚å› æ­¤ï¼ŒåŸºäºè€å¹´ä»£åƒåœ¾å›æ”¶çš„ç‰¹æ€§ï¼Œéœ€è¦ä½¿ç”¨å…¶ä»–çš„ç®—æ³•ã€‚</li><li>æ ‡è®°ä¸€æ¸…é™¤ç®—æ³•çš„ç¡®å¯ä»¥åº”ç”¨åœ¨è€å¹´ä»£ä¸­ï¼Œä½†æ˜¯è¯¥ç®—æ³•ä¸ä»…æ‰§è¡Œæ•ˆç‡ä½ä¸‹ï¼Œè€Œä¸”åœ¨æ‰§è¡Œå®Œå†…å­˜å›æ”¶åè¿˜ä¼šäº§ç”Ÿå†…å­˜ç¢ç‰‡ï¼Œæ‰€ä»¥JVM çš„è®¾è®¡è€…éœ€è¦åœ¨æ­¤åŸºç¡€ä¹‹ä¸Šè¿›è¡Œæ”¹è¿›ã€‚æ ‡è®°ï¼Œå‹ç¼© (Mark - Compact)ç®—æ³•ç”±æ­¤è¯ç”Ÿã€‚</li><li>1970 å¹´å‰åï¼Œ Gï¼ŒL.Steele ã€C.Jï¼Œchene å’ŒD.Sã€‚wise ç­‰ç ”ç©¶è€…å‘å¸ƒæ ‡è®°å‹ç¼©ç®—æ³•ã€‚åœ¨è®¸å¤šç°ä»£çš„åƒåœ¾æ”¶é›†å™¨ä¸­ï¼Œäººä»¬éƒ½ä½¿ç”¨äº†æ ‡è®°-å‹ç¼©ç®—æ³•æˆ–å…¶æ”¹è¿›ç‰ˆæœ¬ã€‚</li></ul><h5 id="æ‰§è¡Œè¿‡ç¨‹-1"><a href="#æ‰§è¡Œè¿‡ç¨‹-1" class="headerlink" title="æ‰§è¡Œè¿‡ç¨‹"></a>æ‰§è¡Œè¿‡ç¨‹</h5><ul><li>ç¬¬ä¸€é˜¶æ®µå’Œæ ‡è®°-æ¸…é™¤ç®—æ³•ä¸€æ ·ï¼Œä»æ ¹èŠ‚ç‚¹å¼€å§‹æ ‡è®°æ‰€æœ‰è¢«å¼•ç”¨å¯¹è±¡ã€‚</li><li>ç¬¬äºŒé˜¶æ®µå°†æ‰€æœ‰çš„å­˜æ´»å¯¹è±¡å‹ç¼©åˆ°å†…å­˜çš„ä¸€ç«¯ï¼ŒæŒ‰é¡ºåºæ’æ”¾ã€‚<br>ä¹‹åï¼Œæ¸…ç†è¾¹ç•Œå¤–æ‰€æœ‰çš„ç©ºé—´</li></ul><p><img src="http://cdn.leesin.fun/typora/s3/img/ç¬¬14ç« _æ ‡è®°-å‹ç¼©ç®—æ³•.jpg" alt="ç¬¬14ç« _æ ‡è®°-å‹ç¼©ç®—æ³•"></p><blockquote><ul><li>æ ‡è®°-å‹ç¼©ç®—æ³•çš„æœ€ç»ˆæ•ˆæœç­‰åŒäºæ ‡è®°-æ¸…é™¤ç®—æ³•æ‰§è¡Œå®Œæˆåï¼Œå†è¿›è¡Œä¸€æ¬¡å†…å­˜ç¢ç‰‡æ•´ç†ï¼Œå› æ­¤ï¼Œä¹Ÿå¯ä»¥æŠŠå®ƒç§°ä¸ºæ ‡è®°-æ¸…é™¤-å‹ç¼©(Mark-Sweep-Compact)ç®—æ³•</li></ul><ul><li>äºŒè€…çš„æœ¬è´¨å·®å¼‚åœ¨äºæ ‡è®°-æ¸…é™¤ç®—æ³•æ˜¯ä¸€ç§éç§»åŠ¨å¼çš„å›æ”¶ç®—æ³•ï¼Œæ ‡è®°-å‹ç¼©æ˜¯ç§»åŠ¨å¼çš„ã€‚æ˜¯å¦ç§»åŠ¨å›æ”¶åçš„å­˜æ´»å¯¹è±¡æ˜¯ä¸€é¡¹ä¼˜ç¼ºç‚¹å¹¶å­˜çš„é£é™©å†³ç­–.</li></ul><ul><li>å¯ä»¥çœ‹åˆ°ï¼Œæ ‡è®°çš„å­˜æ´»å¯¹è±¡å°†ä¼šè¢«æ•´ç†ï¼ŒæŒ‰ç…§å†…å­˜åœ°å€ä¾æ¬¡æ’åˆ—ï¼Œè€Œæœªè¢«æ ‡è®°çš„å†…å­˜ä¼šè¢«æ¸…ç†æ‰ã€‚å¦‚æ­¤ä¸€æ¥ï¼Œå½“æˆ‘ä»¬éœ€è¦ç»™æ–°å¯¹è±¡åˆ†é…å†…å­˜æ—¶ï¼ŒJVMåªéœ€è¦æŒæœ‰ä¸€ä¸ªå†…å­˜çš„èµ·å§‹åœ°å€å³å¯ï¼Œè¿™æ¯”ç»´æŠ¤ä¸€ä¸ªç©ºé—²åˆ—è¡¨æ˜¾ç„¶å°‘äº†è®¸å¤šå¼€é”€ã€‚</li></ul></blockquote><h5 id="ä¼˜ç‚¹-2"><a href="#ä¼˜ç‚¹-2" class="headerlink" title="ä¼˜ç‚¹"></a>ä¼˜ç‚¹</h5><ul><li>æ¶ˆé™¤äº†æ ‡è®°-æ¸…é™¤ç®—æ³•å½“ä¸­ï¼Œå†…å­˜åŒºåŸŸåˆ†æ•£çš„ç¼ºç‚¹ï¼Œæˆ‘ä»¬éœ€è¦ç»™æ–°å¯¹è±¡åˆ†é…å†…å­˜æ—¶ï¼ŒJVMåªéœ€è¦æŒæœ‰ä¸€ä¸ªå†…å­˜çš„èµ·å§‹åœ°å€å³å¯</li><li>æ¶ˆé™¤äº†å¤åˆ¶ç®—æ³•å½“ä¸­ï¼Œå†…å­˜å‡åŠçš„é«˜é¢ä»£ä»·ã€‚</li></ul><h5 id="ç¼ºç‚¹-3"><a href="#ç¼ºç‚¹-3" class="headerlink" title="ç¼ºç‚¹"></a>ç¼ºç‚¹</h5><ul><li>ä»æ•ˆç‡ä¸Šæ¥è¯´ï¼Œæ ‡è®°-æ•´ç†ç®—æ³•è¦ä½äºå¤åˆ¶ç®—æ³•</li><li>ç§»åŠ¨å¯¹è±¡çš„åŒæ—¶ï¼Œå¦‚æœå¯¹è±¡è¢«å…¶ä»–å¯¹è±¡å¼•ç”¨ï¼Œåˆ™è¿˜éœ€è¦è°ƒæ•´å¼•ç”¨çš„åœ°å€ã€‚</li><li>ç§»åŠ¨è¿‡ç¨‹ä¸­ï¼Œéœ€è¦å…¨ç¨‹æš‚åœç”¨æˆ·åº”ç”¨ç¨‹åºã€‚å³:STW</li></ul><h3 id="æŒ‡é’ˆç¢°æ’-Bumpthe-Pointer"><a href="#æŒ‡é’ˆç¢°æ’-Bumpthe-Pointer" class="headerlink" title="æŒ‡é’ˆç¢°æ’(Bumpthe Pointer)"></a>æŒ‡é’ˆç¢°æ’(Bumpthe Pointer)</h3><p>å¦‚æœå†…å­˜ç©ºé—´ä»¥è§„æ•´å’Œæœ‰åºçš„æ–¹å¼åˆ†å¸ƒï¼Œå³å·²ç”¨å’Œæœªç”¨çš„å†…å­˜éƒ½å„è‡ªä¸€è¾¹ï¼Œå½¼æ­¤ä¹‹é—´ç»´ç³»ç€ä¸€ä¸ªè®°å½•ä¸‹ä¸€æ¬¡åˆ†é…èµ·å§‹ç‚¹çš„æ ‡è®°æŒ‡é’ˆï¼Œå½“ä¸ºæ–°å¯¹è±¡åˆ†é…å†…å­˜æ—¶åªéœ€è¦é€šè¿‡ä¿®æ”¹æŒ‡é’ˆçš„åç§»é‡å°†æ–°å¯¹è±¡åˆ†é…åœ¨ç¬¬ä¸€ä¸ªç©ºé—²å†…å­˜ä½ç½®ä¸Šï¼Œè¿™ç§åˆ†é…æ–¹å¼å°±å«åšæŒ‡é’ˆç¢°æ’ (Bump the Pointer)ã€‚</p><h3 id="åˆ†ä»£å›æ”¶ç®—æ³•"><a href="#åˆ†ä»£å›æ”¶ç®—æ³•" class="headerlink" title="åˆ†ä»£å›æ”¶ç®—æ³•"></a>åˆ†ä»£å›æ”¶ç®—æ³•</h3><p><strong>ç›®å‰å‡ ä¹æ‰€æœ‰çš„GCéƒ½æ˜¯é‡‡ç”¨åˆ†ä»£æ”¶é›† (Generational collecting) ç®—æ³•æ‰§è¡Œåƒåœ¾å›æ”¶çš„</strong><br>åœ¨HotSpotä¸­ï¼ŒåŸºäºåˆ†ä»£çš„æ¦‚å¿µï¼ŒGCæ‰€ä½¿ç”¨çš„å†…å­˜å›æ”¶ç®—æ³•å¿…é¡»ç»“åˆå¹´è½»ä»£å’Œè€å¹´ä»£å„è‡ªçš„ç‰¹<br>ç‚¹</p><h5 id="å¹´è½»ä»£-Young-Gen"><a href="#å¹´è½»ä»£-Young-Gen" class="headerlink" title="å¹´è½»ä»£(Young Gen)"></a>å¹´è½»ä»£(Young Gen)</h5><ul><li><p>å¹´è½»ä»£ç‰¹ç‚¹:åŒºåŸŸç›¸å¯¹è€å¹´ä»£è¾ƒå°ï¼Œå¯¹è±¡ç”Ÿå‘½å‘¨æœŸçŸ­ã€å­˜æ´»ç‡ä½,å›æ”¶é¢‘ç¹ã€‚</p></li><li><p>è¿™ç§æƒ…å†µ<strong>å¤åˆ¶ç®—æ³•</strong>çš„å›æ”¶æ•´ç†ï¼Œé€Ÿåº¦æ˜¯æœ€å¿«çš„ã€‚å¤åˆ¶ç®—æ³•çš„æ•ˆç‡åªå’Œå½“å‰å­˜æ´»å¯¹è±¡å¤§å°æœ‰å…³ï¼Œå› æ­¤å¾ˆé€‚ç”¨äº<br>å¹´è½»ä»£çš„å›æ”¶ã€‚è€Œå¤åˆ¶ç®—æ³•å†…å­˜åˆ©ç”¨ç‡ä¸é«˜çš„é—®é¢˜ï¼Œé€šè¿‡hotspotä¸­çš„ä¸¤ä¸ªsurvivorçš„è®¾è®¡å¾—åˆ°ç¼“è§£ã€‚ï¼ˆ8ï¼š1ï¼š1ï¼‰</p></li></ul><h5 id="è€å¹´ä»£-Tenured-Gen"><a href="#è€å¹´ä»£-Tenured-Gen" class="headerlink" title="è€å¹´ä»£(Tenured Gen)"></a>è€å¹´ä»£(Tenured Gen)</h5><ul><li><p>è€å¹´ä»£ç‰¹ç‚¹:åŒºåŸŸè¾ƒå¤§ï¼Œå¯¹è±¡ç”Ÿå‘½å‘¨æœŸé•¿ã€å­˜æ´»ç‡é«˜ï¼Œå›æ”¶ä¸åŠå¹´è½»ä»£é¢‘ç¹ã€‚</p></li><li><p>è¿™ç§æƒ…å†µå­˜åœ¨å¤§é‡å­˜æ´»ç‡é«˜çš„å¯¹è±¡ï¼Œå¤åˆ¶ç®—æ³•æ˜æ˜¾å˜å¾—ä¸åˆé€‚ã€‚ä¸€èˆ¬æ˜¯ç”±æ ‡è®°-æ¸…é™¤æˆ–è€…æ˜¯æ ‡è®°-æ¸…é™¤ä¸æ ‡è®°æ•´ç†çš„æ··åˆå®ç°ã€‚</p></li></ul><blockquote><p>Marké˜¶æ®µçš„å¼€é”€ä¸å­˜æ´»å¯¹è±¡çš„æ•°é‡æˆæ­£æ¯”<br>sweepé˜¶æ®µçš„å¼€é”€ä¸æ‰€ç®¡ç†åŒºåŸŸçš„å¤§å°æˆæ­£ç›¸å…³<br>compacté˜¶æ®µçš„å¼€é”€ä¸å­˜æ´»å¯¹è±¡çš„æ•°æ®æˆæ­£æ¯”ã€‚</p></blockquote><p>ä¸¾ä¾‹</p><p>ä»¥HotSpotä¸­çš„CMSå›æ”¶å™¨ä¸ºä¾‹ï¼ŒCMSæ˜¯åŸºäºMark-Sweepå®ç°çš„ï¼Œå¯¹äºå¯¹è±¡çš„å›æ”¶æ•ˆç‡å¾ˆé«˜ã€‚è€Œå¯¹äºç¢ç‰‡é—®é¢˜ï¼ŒCMSé‡‡ç”¨åŸºäºMark-Compactç®—æ³•çš„Serial oldå›æ”¶å™¨ä½œä¸ºè¡¥å¿æªæ–½:å½“å†…å­˜å›æ”¶ä¸ä½³(ç¢ç‰‡å¯¼è‡´çš„concurrent ModeFailureæ—¶)ï¼Œå°†é‡‡ç”¨serial oldæ‰§è¡ŒFul1 GCä»¥è¾¾åˆ°å¯¹è€å¹´ä»£å†…å­˜çš„æ•´ç†<br>åˆ†ä»£çš„æ€æƒ³è¢«ç°æœ‰çš„è™šæ‹Ÿæœºå¹¿æ³›ä½¿ç”¨ã€‚å‡ ä¹æ‰€æœ‰çš„åƒåœ¾å›æ”¶å™¨éƒ½åŒºåˆ†æ–°ç”Ÿä»£å’Œè€å¹´ä»£</p><h1 id="åƒåœ¾å›æ”¶ç›¸å…³æ¦‚å¿µ"><a href="#åƒåœ¾å›æ”¶ç›¸å…³æ¦‚å¿µ" class="headerlink" title="åƒåœ¾å›æ”¶ç›¸å…³æ¦‚å¿µ"></a>åƒåœ¾å›æ”¶ç›¸å…³æ¦‚å¿µ</h1><h2 id="System-gc-çš„ç†è§£"><a href="#System-gc-çš„ç†è§£" class="headerlink" title="System.gc()çš„ç†è§£"></a>System.gc()çš„ç†è§£</h2><p>åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œé€šè¿‡System.gc()æˆ–è€…Runtime.getRuntime().gc()çš„è°ƒç”¨ï¼Œä¼šæ˜¾å¼è§¦å‘Ful1 GCï¼ŒåŒæ—¶å¯¹è€å¹´ä»£å’Œæ–°ç”Ÿä»£è¿›è¡Œå›æ”¶ï¼Œå°è¯•é‡Šæ”¾è¢«ä¸¢å¼ƒå¯¹è±¡å ç”¨çš„å†…å­˜ã€‚<br>ç„¶è€Œsystem.gc() è°ƒç”¨é™„å¸¦ä¸€ä¸ªå…è´£å£°æ˜ï¼Œæ— æ³•ä¿è¯å¯¹åƒåœ¾æ”¶é›†å™¨çš„è°ƒç”¨ã€‚</p><h2 id="å†…å­˜æº¢å‡º"><a href="#å†…å­˜æº¢å‡º" class="headerlink" title="å†…å­˜æº¢å‡º"></a>å†…å­˜æº¢å‡º</h2><p>javadocä¸­å¯¹outofMemoryErrorçš„è§£é‡Šæ˜¯ï¼Œæ²¡æœ‰ç©ºé—²å†…å­˜ï¼Œå¹¶ä¸”åƒåœ¾æ”¶é›†å™¨ä¹Ÿæ— æ³•æä¾›æ›´å¤šå†…å­˜ã€‚</p><p>åŸå› ï¼š</p><p>(1)Javaè™šæ‹Ÿæœºçš„å†…å­˜è®¾ç½®ä¸å¤Ÿ<br>(2)ä»£ç ä¸­åˆ›å»ºäº†å¤§é‡å¤§å¯¹è±¡ï¼Œå¹¶ä¸”é•¿æ—¶é—´ä¸èƒ½è¢«åƒåœ¾æ”¶å™¨æ”¶(å­˜åœ¨è¢«å¼•ç”¨)</p><p>è¿™é‡Œé¢éšå«ç€ä¸€å±‚æ„æ€æ˜¯ï¼Œåœ¨æŠ›å‡ºoutofMemoryErrorä¹‹å‰ï¼Œé€šå¸¸åƒåœ¾æ”¶é›†å™¨ä¼šè¢«è§¦å‘ï¼Œå°½å…¶æ‰€èƒ½å»æ¸…ç†å‡ºç©ºé—´ã€‚</p><ul><li>ä¾‹å¦‚:åœ¨å¼•ç”¨æœºåˆ¶åˆ†æä¸­ï¼Œæ¶‰åŠåˆ°JVMä¼šå»å°è¯•å›æ”¶è½¯å¼•ç”¨æŒ‡å‘çš„å¯¹è±¡ç­‰</li></ul><p>å½“ç„¶ï¼Œä¹Ÿä¸æ˜¯åœ¨ä»»ä½•æƒ…å†µä¸‹åƒåœ¾æ”¶é›†å™¨éƒ½ä¼šè¢«è§¦å‘çš„</p><ul><li>æ¯”å¦‚ï¼Œæˆ‘ä»¬å»åˆ†é…ä¸€ä¸ªè¶…å¤§å¯¹è±¡ï¼Œç±»ä¼¼ä¸€ä¸ªè¶…å¤§æ•°ç»„è¶…è¿‡å †çš„æœ€å¤§å€¼ï¼ŒJVMå¯ä»¥åˆ¤æ–­å‡ºåƒåœ¾æ”¶é›†å¹¶ä¸èƒ½è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæ‰€ä»¥ç›´æ¥æŠ›å‡ºOutofMemoryErrorã€‚</li></ul><h2 id="å†…å­˜æ³„æ¼"><a href="#å†…å­˜æ³„æ¼" class="headerlink" title="å†…å­˜æ³„æ¼"></a>å†…å­˜æ³„æ¼</h2><p>ä¸¥æ ¼æ¥è¯´ï¼Œåªæœ‰å¯¹è±¡ä¸ä¼šå†è¢«ç¨‹åºç”¨åˆ°äº†ï¼Œä½†æ˜¯GCåˆä¸èƒ½å›æ”¶ä»–ä»¬çš„æƒ…å†µï¼Œæ‰å«å†…å­˜æ³„æ¼ã€‚</p><p>å°½ç®¡å†…å­˜æ³„æ¼å¹¶ä¸ä¼šç«‹åˆ»å¼•èµ·ç¨‹åºå´©æºƒï¼Œä½†æ˜¯ä¸€æ—¦å‘ç”Ÿå†…å­˜æ³„æ¼ï¼Œç¨‹åºä¸­çš„å¯ç”¨å†…å­˜å°±ä¼šè¢«é€æ­¥èš•é£Ÿï¼Œç›´è‡³è€—å°½æ‰€æœ‰å†…å­˜ï¼Œæœ€ç»ˆå‡ºç°OutofMemoryå¼‚å¸¸å¯¼è‡´ç¨‹åºå´©æºƒã€‚<br>æ³¨æ„ï¼Œè¿™é‡Œçš„å­˜å‚¨ç©ºé—´å¹¶ä¸æ˜¯æŒ‡ç‰©ç†å†…å­˜ï¼Œè€Œæ˜¯æŒ‡è™šæ‹Ÿå†…å­˜å¤§å°ï¼Œè¿™ä¸ªè™šæ‹Ÿå†…å­˜å¤§å°å–å†³äºç£ç›˜äº¤æ¢åŒºè®¾å®šçš„å¤§å°ã€‚</p><p><img src="http://cdn.leesin.fun/typora/s3/img/å†…å­˜æ³„æ¼.png" alt="å†…å­˜æ³„æ¼"></p><p>ä¸¾ä¾‹ï¼šThreadLocal</p><h2 id="Stop-The-World"><a href="#Stop-The-World" class="headerlink" title="Stop The World"></a>Stop The World</h2><p>stop-the-world ï¼Œç®€ç§°STWï¼ŒæŒ‡çš„æ˜¯GCäº‹ä»¶å‘ç”Ÿè¿‡ç¨‹ä¸­ï¼Œä¼šäº§ç”Ÿåº”ç”¨ç¨‹åºçš„åœé¡¿ã€‚åœé¡¿äº§ç”Ÿæ—¶æ•´ä¸ªåº”ç”¨ç¨‹åºçº¿ç¨‹éƒ½ä¼šè¢«æš‚åœï¼Œæ²¡æœ‰ä»»ä½•å“åº”æœ‰ç‚¹åƒå¡æ­»çš„æ„Ÿè§‰ï¼Œè¿™ä¸ªåœé¡¿ç§°ä¸ºSTWã€‚</p><ul><li><p>å¦‚ï¼šå¯è¾¾æ€§åˆ†æç®—æ³•ä¸­æšä¸¾æ ¹èŠ‚ç‚¹ (GC Roots)ä¼šå¯¼è‡´æ‰€æœ‰Javaæ‰§è¡Œçº¿ç¨‹åœé¡¿ã€‚</p><ul><li>åˆ†æå·¥ä½œå¿…é¡»åœ¨ä¸€ä¸ªèƒ½ç¡®ä¿ä¸€è‡´æ€§çš„å¿«ç…§ä¸­è¿›è¡Œ</li><li>ä¸€è‡´æ€§æŒ‡æ•´ä¸ªåˆ†ææœŸé—´ï¼Œæ•´ä¸ªæ‰§è¡Œç³»ç»Ÿçœ‹èµ·æ¥åƒè¢«å†»ç»“åœ¨æŸä¸ªæ—¶é—´ç‚¹ä¸Š</li><li>å¦‚æœå‡ºç°åˆ†æè¿‡ç¨‹ä¸­å¯¹è±¡å¼•ç”¨å…³ç³»è¿˜åœ¨ä¸æ–­å˜åŒ–ï¼Œåˆ™åˆ†æç»“æœçš„å‡†ç¡®æ€§æ— æ³•ä¿è¯</li></ul></li></ul><p>è¢«STWä¸­æ–­çš„åº”ç”¨ç¨‹åºçº¿ç¨‹ä¼šåœ¨å®ŒæˆGCä¹‹åæ¢å¤ï¼Œé¢‘ç¹ä¸­æ–­ä¼šè®©ç”¨æˆ·æ„Ÿè§‰åƒæ˜¯ç½‘é€Ÿä¸å¿«é€ æˆç”µå½±å¡å¸¦ä¸€æ ·ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å‡å°‘STWçš„å‘ç”Ÿã€‚</p><h2 id="åƒåœ¾å›æ”¶çš„å¹¶è¡Œä¸å¹¶å‘"><a href="#åƒåœ¾å›æ”¶çš„å¹¶è¡Œä¸å¹¶å‘" class="headerlink" title="åƒåœ¾å›æ”¶çš„å¹¶è¡Œä¸å¹¶å‘"></a>åƒåœ¾å›æ”¶çš„å¹¶è¡Œä¸å¹¶å‘</h2><h5 id="å¹¶è¡Œ"><a href="#å¹¶è¡Œ" class="headerlink" title="å¹¶è¡Œ"></a>å¹¶è¡Œ</h5><p>å¹¶è¡Œ(Parallel):æŒ‡å¤šæ¡åƒåœ¾æ”¶é›†çº¿ç¨‹å¹¶è¡Œå·¥ä½œï¼Œä½†æ­¤æ—¶ç”¨æˆ·çº¿ç¨‹ä»å¤„äºç­‰å¾…çŠ¶æ€ã€‚</p><ul><li>å¦‚ParNewã€Parallel Scavengeã€Parallel Old;</li></ul><p>ä¸²è¡Œ (Serial)</p><ul><li>ç›¸è¾ƒäºå¹¶è¡Œçš„æ¦‚å¿µï¼Œå•çº¿ç¨‹æ‰§è¡Œã€‚</li><li>å¦‚æœå†…å­˜ä¸å¤Ÿï¼Œåˆ™ç¨‹åºæš‚åœï¼Œå¯åŠ¨JVMåƒåœ¾å›æ”¶å™¨è¿›è¡Œåƒåœ¾å›æ”¶ã€‚å›æ”¶å®Œï¼Œå†å¯åŠ¨ç¨‹åºçš„çº¿ç¨‹ã€‚</li></ul><p><img src="http://cdn.leesin.fun/typora/s3/img/åƒåœ¾å›æ”¶å™¨çš„å¹¶è¡Œ.png" alt="åƒåœ¾å›æ”¶å™¨çš„å¹¶è¡Œ"></p><h5 id="å¹¶å‘"><a href="#å¹¶å‘" class="headerlink" title="å¹¶å‘"></a>å¹¶å‘</h5><p>å¹¶å‘ (Concurrent):æŒ‡ç”¨æˆ·çº¿ç¨‹ä¸åƒåœ¾æ”¶é›†çº¿ç¨‹åŒæ—¶æ‰§è¡Œ (ä½†ä¸ä¸€å®šæ˜¯å¹¶è¡Œçš„ï¼Œå¯èƒ½ä¼šäº¤æ›¿æ‰§è¡Œ)ï¼Œåƒåœ¾å›æ”¶çº¿ç¨‹åœ¨æ‰§è¡Œæ—¶ä¸ä¼šåœé¡¿ç”¨æˆ·ç¨‹åºçš„è¿è¡Œã€‚</p><ul><li>ç”¨æˆ·ç¨‹åºåœ¨ç»§ç»­è¿è¡Œï¼Œè€Œåƒåœ¾æ”¶é›†ç¨‹åºçº¿ç¨‹è¿è¡Œäºå¦ä¸€ä¸ªCPUä¸Š;</li><li>å¦‚: CMSã€G1</li></ul><p><img src="http://cdn.leesin.fun/typora/s3/img/åƒåœ¾å›æ”¶å™¨çš„å¹¶å‘.png" alt="åƒåœ¾å›æ”¶å™¨çš„å¹¶å‘"></p><h2 id="å®‰å…¨ç‚¹ä¸å®‰å…¨åŒºåŸŸ"><a href="#å®‰å…¨ç‚¹ä¸å®‰å…¨åŒºåŸŸ" class="headerlink" title="å®‰å…¨ç‚¹ä¸å®‰å…¨åŒºåŸŸ"></a>å®‰å…¨ç‚¹ä¸å®‰å…¨åŒºåŸŸ</h2><h2 id="å¼ºè½¯å¼±è™šå¼•ç”¨"><a href="#å¼ºè½¯å¼±è™šå¼•ç”¨" class="headerlink" title="å¼ºè½¯å¼±è™šå¼•ç”¨"></a>å¼ºè½¯å¼±è™šå¼•ç”¨</h2><p>åœ¨JDK 1.2ç‰ˆä¹‹åï¼ŒJavaå¯¹å¼•ç”¨çš„æ¦‚å¿µè¿›è¡Œäº†æ‰©å……ï¼Œå°†å¼•ç”¨åˆ†ä¸ºå¼ºå¼•ç”¨(strongReference)ã€è½¯å¼•ç”¨ (SoftReference)ã€å¼±å¼•ç”¨ (WeakReference)å’Œè™šå¼•ç”¨(PhantomReference) 4ç§ï¼Œ<strong>è¿™4ç§å¼•ç”¨å¼ºåº¦ä¾æ¬¡é€æ¸å‡å¼±ã€‚</strong><br>é™¤å¼ºå¼•ç”¨å¤–ï¼Œå…¶ä»–3ç§å¼•ç”¨å‡å¯ä»¥åœ¨iava.lang.refåŒ…ä¸­æ‰¾åˆ°å®ƒä»¬çš„èº«å½±ã€‚</p><ul><li>å¼ºå¼•ç”¨ (strongReference) ï¼šæœ€ä¼ ç»Ÿçš„â€œå¼•ç”¨â€çš„å®šä¹‰ï¼Œæ˜¯æŒ‡åœ¨ç¨‹åºä»£ç ä¹‹ä¸­æ™®éå­˜åœ¨çš„å¼•ç”¨èµ‹å€¼ï¼Œå³ç±»ä¼¼â€œobject obj=new object()â€è¿™ç§å¼•ç”¨å…³ç³»ã€‚<strong>æ— è®ºä»»ä½•æƒ…å†µä¸‹ï¼Œåªè¦å¼ºå¼•ç”¨å…³ç³»è¿˜å­˜åœ¨ï¼Œåƒåœ¾æ”¶é›†å™¨å°±æ°¸è¿œä¸ä¼šå›æ”¶æ‰è¢«å¼•ç”¨çš„å¯¹è±¡ã€‚</strong></li><li>è½¯å¼•ç”¨ (softReference)ï¼š<strong>å†…å­˜ä¸è¶³å°±ä¼šGCå›æ”¶è½¯å¼•ç”¨</strong>ã€‚å¦‚æœè¿™æ¬¡å›æ”¶åè¿˜æ²¡æœ‰è¶³å¤Ÿçš„å†…å­˜ï¼Œæ‰ä¼šæŠ›å‡ºå†…å­˜æº¢å‡ºå¼‚å¸¸ã€‚ </li><li>å¼±å¼•ç”¨ (WeakReference)ï¼šè¢«å¼±å¼•ç”¨å…³è”çš„å¯¹è±¡åªèƒ½ç”Ÿå­˜åˆ°ä¸‹ä¸€æ¬¡åƒåœ¾æ”¶é›†ä¹‹å‰ã€‚<strong>å½“åƒåœ¾æ”¶é›†å™¨å·¥ä½œæ—¶ï¼Œæ— è®ºå†…å­˜ç©ºé—´æ˜¯å¦è¶³å¤Ÿï¼Œéƒ½ä¼šå›æ”¶æ‰è¢«å¼±å¼•ç”¨å…³è”çš„å¯¹è±¡ã€‚</strong></li><li>è™šå¼•ç”¨ (PhantomReference)ï¼šä¸€ä¸ªå¯¹è±¡æ˜¯å¦æœ‰è™šå¼•ç”¨çš„å­˜åœ¨ï¼Œå®Œå…¨ä¸ä¼šå¯¹å…¶ç”Ÿå­˜æ—¶é—´æ„æˆå½±å“ï¼Œä¹Ÿæ— æ³•é€šè¿‡è™šå¼•ç”¨æ¥è·å¾—ä¸€ä¸ªå¯¹è±¡çš„å®ä¾‹ã€‚ä¸ºä¸€ä¸ªå¯¹è±¡è®¾ç½®è™šå¼•ç”¨å…³è”çš„<strong>å”¯ä¸€ç›®çš„å°±æ˜¯èƒ½åœ¨è¿™ä¸ªå¯¹è±¡è¢«æ”¶é›†å™¨å›æ”¶æ—¶æ”¶åˆ°ä¸€ä¸ªç³»ç»Ÿé€šçŸ¥ã€‚</strong></li></ul><h1 id="åƒåœ¾å›æ”¶å™¨"><a href="#åƒåœ¾å›æ”¶å™¨" class="headerlink" title="åƒåœ¾å›æ”¶å™¨"></a>åƒåœ¾å›æ”¶å™¨</h1><h2 id="GCåˆ†ç±»"><a href="#GCåˆ†ç±»" class="headerlink" title="GCåˆ†ç±»"></a>GCåˆ†ç±»</h2><p>æŒ‰<strong>çº¿ç¨‹</strong>åˆ†ï¼Œåˆ†ä¸º<u>ä¸²è¡Œåƒåœ¾å›æ”¶å™¨</u>å’Œ<u>å¹¶è¡Œåƒåœ¾å›æ”¶å™¨</u></p><p><img src="http://cdn.leesin.fun/typora/s3/img/åƒåœ¾å›æ”¶å™¨æŒ‰çº¿ç¨‹åˆ†ç±».png" alt="åƒåœ¾å›æ”¶å™¨æŒ‰çº¿ç¨‹åˆ†ç±»"></p><p>æŒ‰<strong>å·¥ä½œæ¨¡å¼</strong>åˆ†ï¼Œåˆ†ä¸º<u>ç‹¬å å¼åƒåœ¾å›æ”¶å™¨</u>å’Œ<u>å¹¶å‘å¼åƒåœ¾å›æ”¶å™¨</u>ã€‚</p><ul><li><p>ç‹¬å å¼åƒåœ¾å›æ”¶å™¨(stop the world)ä¸€æ—¦è¿è¡Œï¼Œå°±åœæ­¢åº”ç”¨ç¨‹åºä¸­çš„æ‰€æœ‰ç”¨æˆ·çº¿ç¨‹ï¼Œç›´åˆ°åƒåœ¾å›æ”¶è¿‡ç¨‹å®Œå…¨ç»“æŸ</p></li><li><p>å¹¶å‘å¼åƒåœ¾å›æ”¶å™¨ä¸åº”ç”¨ç¨‹åºçº¿ç¨‹äº¤æ›¿å·¥ä½œï¼Œä»¥å°½å¯èƒ½å‡å°‘åº”ç”¨ç¨‹åºçš„åœé¡¿æ—¶é—´</p></li></ul><p><img src="http://cdn.leesin.fun/typora/s3/img/åƒåœ¾å›æ”¶å™¨æŒ‰å·¥ä½œæ¨¡å¼åˆ†ç±».png" alt="åƒåœ¾å›æ”¶å™¨æŒ‰å·¥ä½œæ¨¡å¼åˆ†ç±»"></p><p>æŒ‰<strong>ç¢ç‰‡å¤„ç†æ–¹å¼</strong>åˆ†ï¼Œåˆ†ä¸º<u>å‹ç¼©å¼åƒåœ¾å›æ”¶å™¨</u>å’Œ<u>éå‹ç¼©å¼åƒåœ¾å›æ”¶å™¨</u></p><ul><li><p>å‹ç¼©å¼åƒåœ¾å›æ”¶å™¨ä¼šåœ¨å›æ”¶å®Œæˆåï¼Œå¯¹å­˜æ´»å¯¹è±¡è¿›è¡Œå‹ç¼©æ•´ç†ï¼Œæ¶ˆé™¤å›æ”¶åçš„ç¢ç‰‡ã€‚</p><ul><li>å†åˆ†é…å¯¹è±¡ç©ºé—´ä½¿ç”¨ï¼šæŒ‡é’ˆç¢°æ’</li></ul></li><li><p>éå‹ç¼©å¼çš„åƒåœ¾å›æ”¶å™¨ä¸è¿›è¡Œè¿™æ­¥æ“ä½œ</p><ul><li>å†åˆ†é…å¯¹è±¡ç©ºé—´ä½¿ç”¨ï¼šç©ºé—²åˆ—è¡¨</li></ul></li></ul><p>æŒ‰<strong>å·¥ä½œçš„å†…å­˜åŒºé—´</strong>åˆ†ï¼Œåˆå¯åˆ†ä¸º<u>å¹´è½»ä»£åƒåœ¾å›æ”¶å™¨</u>å’Œ<u>è€å¹´ä»£åƒåœ¾å›æ”¶å™¨</u></p><h2 id="è¯„ä¼°GCçš„æ€§èƒ½æŒ‡æ ‡"><a href="#è¯„ä¼°GCçš„æ€§èƒ½æŒ‡æ ‡" class="headerlink" title="è¯„ä¼°GCçš„æ€§èƒ½æŒ‡æ ‡"></a>è¯„ä¼°GCçš„æ€§èƒ½æŒ‡æ ‡</h2><ul><li><strong>ååé‡: è¿è¡Œç”¨æˆ·ä»£ç çš„æ—¶é—´å æ€»è¿è¡Œæ—¶é—´çš„æ¯”ä¾‹</strong><ul><li>(æ€»è¿è¡Œæ—¶é—´:ç¨‹åºçš„è¿è¡Œæ—¶é—´ + å†…å­˜å›æ”¶çš„æ—¶é—´)</li></ul></li><li>åƒåœ¾æ”¶é›†å¼€é”€:ååé‡çš„è¡¥æ•°ï¼Œåƒåœ¾æ”¶é›†æ‰€ç”¨æ—¶é—´ä¸æ€»è¿è¡Œæ—¶é—´çš„æ¯”ä¾‹</li><li><strong>æš‚åœæ—¶é—´:æ‰§è¡Œåƒåœ¾æ”¶é›†æ—¶ï¼Œç¨‹åºçš„å·¥ä½œçº¿ç¨‹è¢«æš‚åœçš„æ—¶é—´</strong></li><li>æ”¶é›†é¢‘ç‡:ç›¸å¯¹äºåº”ç”¨ç¨‹åºçš„æ‰§è¡Œï¼Œæ”¶é›†æ“ä½œå‘ç”Ÿçš„é¢‘ç‡</li><li><strong>å†…å­˜å ç”¨: java å †åŒºæ‰€å çš„å†…å­˜å¤§å°ã€‚</strong></li><li>å¿«é€Ÿ:ä¸€ä¸ªå¯¹è±¡ä»è¯ç”Ÿåˆ°è¢«å›æ”¶æ‰€ç»å†çš„æ—¶é—´.</li></ul><blockquote><p>åœ¨è®¾è®¡ (æˆ–ä½¿ç”¨) GCç®—æ³•æ—¶ï¼Œæˆ‘ä»¬å¿…é¡»ç¡®å®šæˆ‘ä»¬çš„ç›®æ ‡ï¼šä¸€ä¸ªGCç®—æ³•åªå¯èƒ½é’ˆå¯¹ä¸¤ä¸ªç›®æ ‡ä¹‹ä¸€(å³åªä¸“æ³¨äºè¾ƒå¤§ååé‡æˆ–æœ€å°æš‚åœæ—¶é—´)ï¼Œæˆ–å°è¯•æ‰¾åˆ°ä¸€ä¸ªäºŒè€…çš„æŠ˜è¡·ã€‚<br>ç°åœ¨æ ‡å‡†:åœ¨æœ€å¤§ååé‡ä¼˜å…ˆçš„æƒ…å†µä¸‹ï¼Œé™ä½åœé¡¿æ—¶é—´ã€‚</p></blockquote><h2 id="ä¸åŒçš„åƒåœ¾å›æ”¶å™¨æ¦‚è¿°"><a href="#ä¸åŒçš„åƒåœ¾å›æ”¶å™¨æ¦‚è¿°" class="headerlink" title="ä¸åŒçš„åƒåœ¾å›æ”¶å™¨æ¦‚è¿°"></a>ä¸åŒçš„åƒåœ¾å›æ”¶å™¨æ¦‚è¿°</h2><p><img src="http://cdn.leesin.fun/typora/s3/img/ç¬¬17ç« _ç»å…¸çš„7ç§GC.jpg" alt="ç¬¬17ç« _ç»å…¸çš„7ç§GC"></p><p><img src="http://cdn.leesin.fun/typora/s3/img/ç¬¬17ç« _åƒåœ¾æ”¶é›†å™¨ç»„åˆ.jpg" alt="ç¬¬17ç« _åƒåœ¾æ”¶é›†å™¨ç»„åˆ"></p><h2 id="Serialå›æ”¶å™¨ï¼šä¸²è¡Œå›æ”¶"><a href="#Serialå›æ”¶å™¨ï¼šä¸²è¡Œå›æ”¶" class="headerlink" title="Serialå›æ”¶å™¨ï¼šä¸²è¡Œå›æ”¶"></a>Serialå›æ”¶å™¨ï¼šä¸²è¡Œå›æ”¶</h2><ul><li><p>Serial æ”¶é›†å™¨é‡‡ç”¨<strong>å¤åˆ¶ç®—æ³•</strong>ã€<strong>ä¸²è¡Œå›æ”¶</strong>å’Œ<strong>â€stop-the-worldâ€æœºåˆ¶</strong>çš„æ–¹å¼æ‰§è¡Œå†…å­˜å›æ”¶ã€‚</p></li><li><p>Serial  Oldæ”¶é›†å™¨é‡‡ç”¨<strong>æ ‡è®°-å‹ç¼©ç®—æ³•</strong>ã€<strong>ä¸²è¡Œå›æ”¶</strong>å’Œ<strong>â€stop-the-worldâ€æœºåˆ¶</strong>çš„æ–¹å¼æ‰§è¡Œå†…å­˜å›æ”¶ã€‚</p></li><li><p>ä¼˜åŠ¿ï¼šç®€å•é«˜æ•ˆ</p></li></ul><p><img src="http://cdn.leesin.fun/typora/s3/img/Serialå’ŒSerial Oldæ”¶é›†å™¨.png" alt="Serialå’ŒSerial Oldæ”¶é›†å™¨"></p><p>è™šæ‹Ÿæœºå‚æ•°ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-XX:+UseSerialGC</span><br><span class="line"><span class="comment">// ç­‰ä»·äºæ–°ç”Ÿä»£ç”¨Serialï¼Œè€å¹´ä»£ç”¨Serial Old</span></span><br></pre></td></tr></table></figure><h2 id="ParNewå›æ”¶å™¨ï¼šå¹¶è¡Œå›æ”¶"><a href="#ParNewå›æ”¶å™¨ï¼šå¹¶è¡Œå›æ”¶" class="headerlink" title="ParNewå›æ”¶å™¨ï¼šå¹¶è¡Œå›æ”¶"></a>ParNewå›æ”¶å™¨ï¼šå¹¶è¡Œå›æ”¶</h2><ul><li><p>å¦‚æœè¯´Serial GCæ˜¯å¹´è½»ä»£ä¸­çš„å•çº¿ç¨‹åƒåœ¾æ”¶é›†å™¨ï¼Œé‚£ä¹ˆParNewæ”¶é›†å™¨åˆ™æ˜¯serialæ”¶é›†å™¨çš„å¤šçº¿ç¨‹ç‰ˆæœ¬ã€‚</p><ul><li>ï¼ˆParæ˜¯Parallelçš„ç¼©å†™ï¼ŒNew:<strong>åªèƒ½å¤„ç†çš„æ˜¯æ–°ç”Ÿä»£</strong>ï¼‰</li></ul></li><li><p>ParNewæ”¶é›†å™¨é‡‡ç”¨<strong>å¤åˆ¶ç®—æ³•</strong>ã€<strong>å¹¶è¡Œå›æ”¶</strong>å’Œ<strong>â€œstop-the-worldâ€æœºåˆ¶</strong>ã€‚</p><ul><li>ï¼ˆParNew æ”¶é›†å™¨é™¤äº†é‡‡ç”¨å¹¶è¡Œå›æ”¶çš„æ–¹å¼æ‰§è¡Œå†…å­˜å›æ”¶å¤–ï¼Œä¸¤æ¬¾åƒåœ¾æ”¶é›†å™¨ä¹‹é—´å‡ ä¹æ²¡æœ‰ä»»ä½•åŒºåˆ«ï¼‰</li></ul></li></ul><p><img src="http://cdn.leesin.fun/typora/s3/img/ParNewå’ŒSerial Oldæ”¶é›†å™¨.png" alt="ParNewå’ŒSerial Oldæ”¶é›†å™¨"></p><p>è™šæ‹Ÿæœºå‚æ•°ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-XX:+UseParNewGC</span><br></pre></td></tr></table></figure><h2 id="Parallelå›æ”¶å™¨ï¼šååé‡ä¼˜å…ˆ"><a href="#Parallelå›æ”¶å™¨ï¼šååé‡ä¼˜å…ˆ" class="headerlink" title="Parallelå›æ”¶å™¨ï¼šååé‡ä¼˜å…ˆ"></a>Parallelå›æ”¶å™¨ï¼šååé‡ä¼˜å…ˆ</h2><ul><li><p>Parallel Scavengeæ”¶é›†å™¨é‡‡ç”¨<strong>å¤åˆ¶ç®—æ³•</strong>ã€<strong>å¹¶è¡Œå›æ”¶</strong>å’Œ<strong>â€stopthe worldâ€æœºåˆ¶</strong>ã€‚</p></li><li><p>Parallel old æ”¶é›†å™¨é‡‡ç”¨<strong>æ ‡è®°-å‹ç¼©ç®—æ³•</strong>ï¼Œ<strong>å¹¶è¡Œå›æ”¶</strong>å’Œ<strong>â€stop-the-worldâ€æœºåˆ¶</strong>ã€‚</p></li><li>==JDK8ä¸­é»˜è®¤ä½¿ç”¨Parallelå›æ”¶å™¨==</li></ul><blockquote><p>é‚£ä¹ˆParalleæ”¶é›†å™¨çš„å‡ºç°æ˜¯å¦å¤šæ­¤ä¸€ä¸¾?</p><ul><li>å’ŒParNewæ”¶é›†å™¨ä¸åŒï¼ŒParallel Scavengeæ”¶é›†å™¨çš„ç›®æ ‡åˆ™æ˜¯è¾¾åˆ°ä¸€ä¸ª<strong>å¯æ§åˆ¶çš„ååé‡</strong> (Throughput)ï¼Œå®ƒä¹Ÿè¢«ç§°ä¸ºååé‡ä¼˜å…ˆçš„åƒåœ¾æ”¶é›†å™¨ã€‚</li><li>è‡ªé€‚åº”è°ƒèŠ‚ç­–ç•¥ä¹Ÿæ˜¯Parallel Scavengeä¸ParNewä¸€ä¸ªé‡è¦åŒºåˆ«</li></ul><p>é«˜ååé‡åˆ™å¯ä»¥é«˜æ•ˆç‡åœ°åˆ©ç”¨ CPU æ—¶é—´ï¼Œå°½å¿«å®Œæˆç¨‹åºçš„è¿ç®—ä»»åŠ¡ï¼Œä¸»è¦<strong>é€‚åˆåœ¨åå°è¿ç®—è€Œä¸éœ€è¦å¤ªå¤šäº¤äº’çš„ä»»åŠ¡</strong>ã€‚å› æ­¤ï¼Œå¸¸è§åœ¨æœåŠ¡å™¨ç¯å¢ƒä¸­ä½¿ç”¨ã€‚ä¾‹å¦‚ï¼Œé‚£äº›æ‰§è¡Œ==æ‰¹é‡å¤„ç†ã€è®¢å•å¤„ç†ã€å·¥èµ„æ”¯ä»˜ã€ç§‘å­¦è®¡ç®—==çš„åº”ç”¨ç¨‹åºã€‚</p></blockquote><p>è™šæ‹Ÿæœºå‚æ•°ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-XX:+UseParallelGC</span><br><span class="line">-XX:+UseParallelOldGC</span><br><span class="line"><span class="comment">// ä¸Šé¢ä¸¤ä¸ªå‚æ•°ï¼Œé»˜è®¤å¼€å¯ä¸€ä¸ªï¼Œå¦ä¸€ä¸ªä¹Ÿä¼šè¢«å¼€å¯(äº’ç›¸æ¿€æ´»)</span></span><br></pre></td></tr></table></figure><h2 id="CMSå›æ”¶å™¨ï¼šä½å»¶è¿Ÿ"><a href="#CMSå›æ”¶å™¨ï¼šä½å»¶è¿Ÿ" class="headerlink" title="CMSå›æ”¶å™¨ï¼šä½å»¶è¿Ÿ"></a>CMSå›æ”¶å™¨ï¼šä½å»¶è¿Ÿ</h2><ul><li><p>åœ¨ JDK 1.5 æ—¶æœŸï¼ŒHotspot æ¨å‡ºäº†ä¸€æ¬¾åœ¨å¼ºäº¤äº’åº”ç”¨ä¸­å‡ ä¹å¯è®¤ä¸ºæœ‰åˆ’æ—¶ä»£æ„ä¹‰çš„åƒåœ¾æ”¶é›†å™¨ï¼šCMS (Concurrent-Mark-Sweep)æ”¶é›†å™¨ï¼Œè¿™æ¬¾æ”¶é›†å™¨æ˜¯Hotspotè™šæ‹Ÿæœºä¸­ç¬¬ä¸€æ¬¾çœŸæ­£æ„ä¹‰ä¸Šçš„å¹¶å‘æ”¶é›†å™¨ï¼Œå®ƒç¬¬ä¸€æ¬¡å®ç°äº†è®©<strong>åƒåœ¾æ”¶é›†çº¿ç¨‹ä¸ç”¨æˆ·çº¿ç¨‹åŒæ—¶å·¥ä½œ</strong>ã€‚</p></li><li><p>CMSæ”¶é›†å™¨çš„å…³æ³¨ç‚¹æ˜¯å°½å¯èƒ½ç¼©çŸ­åƒåœ¾æ”¶é›†æ—¶ç”¨æˆ·çº¿ç¨‹çš„åœé¡¿æ—¶é—´ã€‚åœé¡¿æ—¶é—´è¶ŠçŸ­ï¼ˆä½å»¶è¿Ÿï¼‰å°±è¶Šé€‚åˆä¸ç”¨æˆ·äº¤äº’çš„ç¨‹åºï¼Œè‰¯å¥½çš„å“åº”é€Ÿåº¦èƒ½æå‡ç”¨æˆ·ä½“éªŒã€‚</p></li><li>ç›®å‰å¾ˆå¤§ä¸€éƒ¨åˆ†çš„Javaåº”ç”¨é›†ä¸­åœ¨äº’è”ç½‘ç«™æˆ–è€…B/Sç³»ç»Ÿçš„æœåŠ¡ç«¯ä¸Šï¼Œè¿™ç±»åº”ç”¨å°¤å…¶é‡è§†æœåŠ¡çš„å“åº”é€Ÿåº¦ï¼Œå¸Œæœ›ç³»ç»Ÿåœé¡¿æ—¶é—´æœ€çŸ­ï¼Œä»¥ç»™ç”¨æˆ·å¸¦æ¥è¾ƒå¥½çš„ä½“éªŒCMSæ”¶é›†å™¨å°±éå¸¸ç¬¦åˆè¿™ç±»åº”ç”¨çš„éœ€æ±‚ã€‚</li><li>CMSçš„åƒåœ¾æ”¶é›†ç®—æ³•é‡‡ç”¨<strong>æ ‡è®°-æ¸…é™¤ç®—æ³•</strong>ï¼Œå¹¶ä¸”ä¹Ÿä¼š<strong>â€stop-the-worldâ€</strong></li></ul><blockquote><ul><li>ä¸å¹¸çš„æ˜¯ï¼ŒCMS ä½œä¸ºè€å¹´ä»£çš„æ”¶é›†å™¨ï¼Œå´æ— æ³•ä¸ JDK 1.4. ä¸­å·²ç»å­˜åœ¨çš„æ–°ç”Ÿä»£æ”¶é›†å™¨Parallel Scavenge é…åˆå·¥ä½œï¼Œæ‰€ä»¥åœ¨JDK 1.5ä¸­ä½¿ç”¨CMSæ¥æ”¶é›†è€å¹´ä»£çš„æ—¶å€™ï¼Œæ–°ç”Ÿä»£åªèƒ½é€‰æ‹©ParNewæˆ–è€…Serialæ”¶é›†å™¨ä¸­çš„ä¸€ä¸ªã€‚</li><li>åœ¨G1å‡ºç°ä¹‹å‰ï¼ŒCMSä½¿ç”¨è¿˜æ˜¯éå¸¸å¹¿æ³›çš„ã€‚ä¸€ç›´åˆ°ä»Šå¤©ï¼Œä»ç„¶æœ‰å¾ˆå¤šç³»ç»Ÿä½¿ç”¨CMS GCã€‚</li></ul></blockquote><h5 id="å·¥ä½œåŸç†"><a href="#å·¥ä½œåŸç†" class="headerlink" title="å·¥ä½œåŸç†"></a>å·¥ä½œåŸç†</h5><p><img src="http://cdn.leesin.fun/typora/s3/img/CMSæ”¶é›†å™¨.png" alt="CMSæ”¶é›†å™¨"></p><p>CMSæ•´ä¸ªè¿‡ç¨‹æ¯”ä¹‹å‰çš„æ”¶é›†å™¨è¦å¤æ‚,æ•´ä¸ªè¿‡ç¨‹åˆ†ä¸º4ä¸ªä¸»è¦é˜¶æ®µï¼Œå³åˆå§‹æ ‡è®°é˜¶æ®µã€å¹¶å‘æ ‡è®°é˜¶æ®µã€é‡æ–°æ ‡è®°é˜¶æ®µå’Œå¹¶å‘æ¸…é™¤é˜¶æ®µã€‚</p><ul><li>åˆå§‹æ ‡è®° ï¼ˆInitial-Markï¼‰é˜¶æ®µï¼šåœ¨è¿™ä¸ªé˜¶æ®µä¸­ï¼Œç¨‹åºä¸­æ‰€æœ‰çš„å·¥ä½œçº¿ç¨‹éƒ½å°†ä¼šå› ä¸ºâ€œstop-the-worldâ€æœºåˆ¶è€Œå‡ºç°çŸ­æš‚çš„æš‚åœï¼Œè¿™ä¸ªé˜¶æ®µçš„ä¸»è¦ä»»åŠ¡==ä»…ä»…åªæ˜¯æ ‡è®°å‡ºGC Rootsèƒ½ç›´æ¥å…³è”åˆ°çš„å¯¹è±¡ã€‚==ä¸€æ—¦æ ‡è®°å®Œæˆä¹‹åå°±ä¼šæ¢å¤ä¹‹å‰è¢«æš‚åœçš„æ‰€æœ‰åº”ç”¨çº¿ç¨‹ã€‚ç”±äºç›´æ¥å…³è”å¯¹è±¡æ¯”è¾ƒå°ï¼Œæ‰€ä»¥è¿™é‡Œçš„==é€Ÿåº¦éå¸¸å¿«ã€‚==</li><li>å¹¶å‘æ ‡è®° ï¼ˆConcurrent-Markï¼‰ é˜¶æ®µï¼š ä»GC Rootsçš„ç›´æ¥å…³è”å¯¹è±¡å¼€å§‹éå†æ•´ä¸ªå¯¹è±¡å›¾çš„è¿‡ç¨‹ï¼Œè¿™ä¸ªè¿‡ç¨‹<strong>è€—æ—¶è¾ƒé•¿</strong>ä½†æ˜¯<strong>ä¸éœ€è¦åœé¡¿ç”¨æˆ·çº¿ç¨‹</strong>ï¼Œå¯ä»¥ä¸åƒåœ¾æ”¶é›†çº¿ç¨‹ä¸€èµ·å¹¶å‘è¿è¡Œã€‚</li><li>é‡æ–°æ ‡è®° ï¼ˆRemarkï¼‰é˜¶æ®µï¼š ç”±äºåœ¨å¹¶å‘æ ‡è®°é˜¶æ®µä¸­ï¼Œç¨‹åºçš„å·¥ä½œçº¿ç¨‹ä¼šå’Œåƒåœ¾æ”¶é›†çº¿ç¨‹åŒæ—¶è¿è¡Œæˆ–è€…äº¤å‰è¿è¡Œï¼Œå› æ­¤ä¸ºäº†ä¿®æ­£å¹¶å‘æ ‡è®°æœŸé—´ï¼Œå› ç”¨æˆ·ç¨‹åºç»§ç»­è¿ä½œè€Œå¯¼è‡´æ ‡è®°äº§ç”Ÿå˜åŠ¨çš„é‚£ä¸€éƒ¨åˆ†å¯¹è±¡çš„æ ‡è®°è®°å½•ï¼Œè¿™ä¸ªé˜¶æ®µçš„åœé¡¿æ—¶é—´é€šå¸¸ä¼šæ¯”åˆå§‹æ ‡è®°é˜¶æ®µç¨é•¿ä¸€äº›ï¼Œä½†ä¹Ÿè¿œæ¯”å¹¶å‘æ ‡è®°é˜¶æ®µçš„æ—¶é—´çŸ­ã€‚</li><li>å¹¶å‘æ¸…é™¤ ï¼ˆconcurrent-Sweepï¼‰é˜¶æ®µï¼šæ­¤é˜¶æ®µæ¸…ç†åˆ é™¤æ‰æ ‡è®°é˜¶æ®µåˆ¤æ–­çš„å·²ç»æ­»äº¡çš„å¯¹è±¡ï¼Œé‡Šæ”¾å†…å­˜ç©ºé—´ã€‚ç”±äºä¸éœ€è¦ç§»åŠ¨å­˜æ´»å¯¹è±¡ï¼Œæ‰€ä»¥è¿™ä¸ªé˜¶æ®µä¹Ÿæ˜¯å¯ä»¥ä¸ç”¨æˆ·çº¿ç¨‹åŒæ—¶å¹¶å‘çš„</li></ul><h2 id="G1å›æ”¶å™¨ï¼šåŒºåŸŸåŒ–åˆ†ä»£å¼"><a href="#G1å›æ”¶å™¨ï¼šåŒºåŸŸåŒ–åˆ†ä»£å¼" class="headerlink" title="G1å›æ”¶å™¨ï¼šåŒºåŸŸåŒ–åˆ†ä»£å¼"></a>G1å›æ”¶å™¨ï¼šåŒºåŸŸåŒ–åˆ†ä»£å¼</h2><h4 id="åŸºæœ¬ä»‹ç»"><a href="#åŸºæœ¬ä»‹ç»" class="headerlink" title="åŸºæœ¬ä»‹ç»"></a>åŸºæœ¬ä»‹ç»</h4><ul><li><p>å®˜æ–¹ç»™G1è®¾å®šçš„ç›®æ ‡æ˜¯åœ¨å»¶è¿Ÿå¯æ§çš„æƒ…å†µä¸‹è·å¾—å°½å¯èƒ½é«˜çš„ååé‡ï¼Œæ‰€ä»¥æ‰æ‹…å½“èµ·â€œå…¨åŠŸèƒ½æ”¶é›†å™¨â€çš„é‡ä»»ä¸æœŸæœ›ã€‚</p></li><li><p>G1 GCæœ‰è®¡åˆ’åœ°é¿å…åœ¨æ•´ä¸ªJava å †ä¸­è¿›è¡Œå…¨åŒºåŸŸçš„åƒåœ¾æ”¶é›†ã€‚G1 è·Ÿè¸ªå„ä¸ª Regioné‡Œé¢çš„åƒåœ¾å †ç§¯çš„ä»·å€¼å¤§å°ï¼ˆå›æ”¶æ‰€è·å¾—çš„ç©ºé—´å¤§å°ä»¥åŠå›æ”¶æ‰€éœ€æ—¶é—´çš„ç»éªŒå€¼ï¼‰ï¼Œåœ¨åå°ç»´æŠ¤ä¸€ä¸ªä¼˜å…ˆåˆ—è¡¨ï¼Œæ¯æ¬¡æ ¹æ®å…è®¸çš„æ”¶é›†æ—¶é—´ï¼Œä¼˜å…ˆå›æ”¶ä»·å€¼æœ€å¤§çš„Regionã€‚</p></li></ul><h4 id="G1å›æ”¶å™¨çš„ç‰¹ç‚¹ï¼ˆä¼˜åŠ¿ï¼‰"><a href="#G1å›æ”¶å™¨çš„ç‰¹ç‚¹ï¼ˆä¼˜åŠ¿ï¼‰" class="headerlink" title="G1å›æ”¶å™¨çš„ç‰¹ç‚¹ï¼ˆä¼˜åŠ¿ï¼‰"></a>G1å›æ”¶å™¨çš„ç‰¹ç‚¹ï¼ˆä¼˜åŠ¿ï¼‰</h4><h5 id="ç©ºé—´æ•´åˆ"><a href="#ç©ºé—´æ•´åˆ" class="headerlink" title="ç©ºé—´æ•´åˆ"></a>ç©ºé—´æ•´åˆ</h5><ul><li><p>CMSï¼šâ€œæ ‡è®°-æ¸…é™¤â€ç®—æ³•ã€å†…å­˜ç¢ç‰‡ã€è‹¥å¹²æ¬¡GCåè¿›è¡Œä¸€æ¬¡ç¢ç‰‡æ•´ç†ã€‚</p></li><li><p>G1å°†å†…å­˜åˆ’åˆ†ä¸ºä¸€ä¸ªä¸ªçš„regionã€‚å†…å­˜çš„å›æ”¶æ˜¯ä»¥regionä½œä¸ºåŸºæœ¬å•ä½çš„<strong>Regionä¹‹é—´æ˜¯å¤åˆ¶ç®—æ³•</strong>ï¼Œä½†æ•´ä½“ä¸Šå®é™…å¯çœ‹ä½œæ˜¯ <u>æ ‡è®°-å‹ç¼© ï¼ˆMark-Compactï¼‰ç®—æ³•</u> ï¼Œä¸¤ç§ç®—æ³•éƒ½å¯ä»¥é¿å…å†…å­˜ç¢ç‰‡ã€‚è¿™ç§ç‰¹æ€§æœ‰åˆ©äºç¨‹åºé•¿æ—¶é—´è¿è¡Œï¼Œåˆ†é…å¤§å¯¹è±¡æ—¶ä¸ä¼šå› ä¸ºæ— æ³•æ‰¾åˆ°è¿ç»­å†…å­˜ç©ºé—´è€Œæå‰è§¦å‘ä¸‹ä¸€æ¬¡ GCã€‚å°¤å…¶æ˜¯å½“Javaå †éå¸¸å¤§çš„æ—¶å€™ï¼ŒG1çš„ä¼˜åŠ¿æ›´åŠ æ˜æ˜¾ã€‚</p></li></ul><h5 id="å¯é¢„æµ‹çš„åœé¡¿æ—¶é—´æ¨¡å‹ï¼ˆå³-è½¯å®æ—¶soft-real-timeï¼‰"><a href="#å¯é¢„æµ‹çš„åœé¡¿æ—¶é—´æ¨¡å‹ï¼ˆå³-è½¯å®æ—¶soft-real-timeï¼‰" class="headerlink" title="å¯é¢„æµ‹çš„åœé¡¿æ—¶é—´æ¨¡å‹ï¼ˆå³: è½¯å®æ—¶soft real-timeï¼‰"></a>å¯é¢„æµ‹çš„åœé¡¿æ—¶é—´æ¨¡å‹ï¼ˆå³: è½¯å®æ—¶soft real-timeï¼‰</h5><p>è¿™æ˜¯ G1 ç›¸å¯¹äº CMS çš„å¦ä¸€å¤§ä¼˜åŠ¿ï¼ŒG1é™¤äº†è¿½æ±‚ä½åœé¡¿å¤–ï¼Œè¿˜èƒ½å»ºç«‹å¯é¢„æµ‹çš„åœé¡¿æ—¶é—´æ¨¡å‹ï¼Œèƒ½è®©ä½¿ç”¨è€…æ˜ç¡®æŒ‡å®šåœ¨ä¸€ä¸ªé•¿åº¦ä¸º M æ¯«ç§’çš„æ—¶é—´ç‰‡æ®µå†…ï¼Œæ¶ˆè€—åœ¨åƒåœ¾æ”¶é›†ä¸Šçš„æ—¶é—´ä¸å¾—è¶…è¿‡  N æ¯«ç§’ã€‚</p><ul><li><p>ç”±äºåˆ†åŒºçš„åŸå› ï¼ŒG1å¯ä»¥åªé€‰å–éƒ¨åˆ†åŒºåŸŸè¿›è¡Œå†…å­˜å›æ”¶ï¼Œè¿™æ ·ç¼©å°äº†å›æ”¶çš„èŒƒå›´ï¼Œå› æ­¤å¯¹äºå…¨å±€åœé¡¿æƒ…å†µçš„å‘ç”Ÿä¹Ÿèƒ½å¾—åˆ°è¾ƒå¥½çš„æ§åˆ¶ã€‚</p></li><li><p>G1 è·Ÿè¸ªå„ä¸ª Region é‡Œé¢çš„åƒåœ¾å †ç§¯çš„ä»·å€¼å¤§å°ï¼ˆå›æ”¶æ‰€è·å¾—çš„ç©ºé—´å¤§å°ä»¥åŠå›æ”¶æ‰€éœ€æ—¶é—´çš„ç»éªŒå€¼ï¼‰ï¼Œåœ¨åå°ç»´æŠ¤ä¸€ä¸ªä¼˜å…ˆåˆ—è¡¨ï¼Œ==æ¯æ¬¡æ ¹æ®å…è®¸çš„æ”¶é›†æ—¶é—´ï¼Œä¼˜å…ˆå›æ”¶ä»·å€¼æœ€å¤§çš„Region==ã€‚ä¿è¯äº† G1 æ”¶é›†å™¨åœ¨æœ‰é™çš„æ—¶é—´å†…å¯ä»¥è·å–å°½å¯èƒ½é«˜çš„æ”¶é›†æ•ˆç‡ã€‚</p></li><li><p>ç›¸æ¯”äºCMS GCï¼ŒG1æœªå¿…èƒ½åšåˆ°CMSåœ¨æœ€å¥½æƒ…å†µä¸‹çš„å»¶æ—¶åœé¡¿ï¼Œä½†æ˜¯æœ€å·®æƒ…å†µè¦å¥½å¾ˆå¤šã€‚</p></li></ul><h4 id="G1å›æ”¶å™¨çš„ç¼ºç‚¹"><a href="#G1å›æ”¶å™¨çš„ç¼ºç‚¹" class="headerlink" title="G1å›æ”¶å™¨çš„ç¼ºç‚¹"></a>G1å›æ”¶å™¨çš„ç¼ºç‚¹</h4><p>ä»ç»éªŒä¸Šæ¥è¯´ï¼Œåœ¨å°å†…å­˜åº”ç”¨ä¸ŠCMSçš„è¡¨ç°å¤§æ¦‚ç‡ä¼šä¼˜äºG1ï¼Œè€ŒG1åœ¨å¤§å†…å­˜åº”ç”¨ä¸Šåˆ™å‘æŒ¥å…¶ä¼˜åŠ¿ã€‚å¹³è¡¡ç‚¹åœ¨6-8GBä¹‹é—´ã€‚</p><h4 id="G1å›æ”¶å™¨çš„å‚æ•°è®¾ç½®"><a href="#G1å›æ”¶å™¨çš„å‚æ•°è®¾ç½®" class="headerlink" title="G1å›æ”¶å™¨çš„å‚æ•°è®¾ç½®"></a>G1å›æ”¶å™¨çš„å‚æ•°è®¾ç½®</h4><p><code>-XX: +UseG1GC</code>ï¼šæ‰‹åŠ¨æŒ‡å®šä½¿ç”¨G1æ”¶é›†å™¨æ‰§è¡Œå†…å­˜å›æ”¶ä»»åŠ¡ã€‚</p><p><code>-XX:G1HeapRegionSize</code>ï¼šè®¾ç½®æ¯ä¸ªRegionçš„å¤§å°ã€‚å€¼æ˜¯2çš„å¹‚ï¼ŒèŒƒå›´æ˜¯1MBåˆ°32MBä¹‹é—´ï¼Œç›®æ ‡æ˜¯æ ¹æ®æœ€å°çš„Javaå †å¤§å°åˆ’åˆ†å‡ºçº¦2048ä¸ªåŒºåŸŸã€‚é»˜è®¤æ˜¯å †å†…å­˜çš„1/2000ã€‚</p><p><code>-XX:MaxGCPauseMillis</code>ï¼šè®¾ç½®æœŸæœ›è¾¾åˆ°çš„æœ€å¤§GCåœé¡¿æ—¶é—´æŒ‡æ ‡(JVMä¼šå°½åŠ›å®ç°ï¼Œä½†ä¸ä¿è¯è¾¾åˆ°)ã€‚é»˜è®¤å€¼æ˜¯200ms</p><p><code>-XX: ParallelGCThread</code>ï¼šè®¾ç½®STWå·¥ä½œçº¿ç¨‹æ•°çš„å€¼ã€‚æœ€å¤šè®¾ç½®ä¸º8</p><p><code>-XX:ConcGCThreads</code>ï¼šè®¾ç½®å¹¶å‘æ ‡è®°çš„çº¿ç¨‹æ•°ã€‚å°†nè®¾ç½®ä¸ºå¹¶è¡Œåƒåœ¾å›æ”¶çº¿ç¨‹æ•°(ParallelGCThreads)çš„1/4å·¦å³ã€‚</p><p><code>-XX:InitiatingHeapOccupancyPercent</code>ï¼šè®¾ç½®è§¦å‘å¹¶å‘GCå‘¨æœŸçš„Javaå †å ç”¨ç‡é˜ˆå€¼ã€‚è¶…è¿‡æ­¤å€¼ï¼Œå°±è§¦å‘GCã€‚é»˜è®¤å€¼æ˜¯45ã€‚</p><blockquote><p>G1çš„è®¾è®¡åŸåˆ™å°±æ˜¯ç®€åŒ– JVM æ€§èƒ½è°ƒä¼˜ï¼Œå¼€å‘äººå‘˜åªéœ€è¦ç®€å•çš„ä¸‰æ­¥å³å¯å®Œæˆè°ƒä¼˜:</p><p>ç¬¬ä¸€æ­¥:å¼€å¯G1åƒåœ¾æ”¶é›†å™¨</p><p>ç¬¬äºŒæ­¥:è®¾ç½®å †çš„æœ€å¤§å†…å­˜</p><p>ç¬¬ä¸‰æ­¥:è®¾ç½®æœ€å¤§çš„åœé¡¿æ—¶é—´</p><p>G1ä¸­æä¾›äº†ä¸‰ç§åƒåœ¾å›æ”¶æ¨¡å¼: YoungGcã€Mixed GCå’ŒFull GCï¼Œåœ¨ä¸åŒçš„æ¡ä»¶ä¸‹è¢«è§¦å‘ã€‚</p></blockquote><h4 id="G1å›æ”¶å™¨çš„é€‚ç”¨åœºæ™¯"><a href="#G1å›æ”¶å™¨çš„é€‚ç”¨åœºæ™¯" class="headerlink" title="G1å›æ”¶å™¨çš„é€‚ç”¨åœºæ™¯"></a>G1å›æ”¶å™¨çš„é€‚ç”¨åœºæ™¯</h4><ul><li><p>é¢å‘æœåŠ¡ç«¯åº”ç”¨ï¼Œé’ˆå¯¹å…·æœ‰å¤§å†…å­˜ã€å¤šå¤„ç†å™¨çš„æœºå™¨ã€‚(åœ¨æ™®é€šå¤§å°çš„å †é‡Œè¡¨ç°å¹¶ä¸æƒŠå–œ)</p></li><li><p>æœ€ä¸»è¦çš„åº”ç”¨æ˜¯éœ€è¦ä½GCå»¶è¿Ÿï¼Œå¹¶å…·æœ‰å¤§å †çš„åº”ç”¨ç¨‹åºæä¾›è§£å†³æ–¹æ¡ˆ;</p><ul><li>å¦‚:åœ¨å †å¤§å°çº¦6GBæˆ–æ›´å¤§æ—¶ï¼Œå¯é¢„æµ‹çš„æš‚åœæ—¶é—´å¯ä»¥ä½äº0.5ç§’ï¼›(G1é€šè¿‡æ¯æ¬¡åªæ¸…ç†ä¸€éƒ¨åˆ†è€Œä¸æ˜¯å…¨éƒ¨çš„Regionçš„å¢é‡å¼æ¸…ç†æ¥ä¿è¯æ¯æ¬¡GCåœé¡¿æ—¶é—´ä¸ä¼šè¿‡é•¿)ã€‚</li></ul></li><li><p>ç”¨æ¥æ›¿æ¢æ‰JDK1.5ä¸­çš„CMSæ”¶é›†å™¨;</p><ul><li><p>åœ¨ä¸‹é¢çš„æƒ…å†µæ—¶ï¼Œä½¿ç”¨G1å¯èƒ½æ¯”CMSå¥½:</p><ol><li><p>è¶…è¿‡50%çš„Javaå †è¢«æ´»åŠ¨æ•°æ®å ç”¨;</p></li><li><p>å¯¹è±¡åˆ†é…é¢‘ç‡æˆ–å¹´ä»£æå‡é¢‘ç‡å˜åŒ–å¾ˆå¤§ï¼›</p></li><li><p>GCåœé¡¿æ—¶é—´è¿‡é•¿(é•¿äº0.5è‡³1ç§’)ã€‚</p></li></ol></li></ul></li></ul><blockquote><p>Hotspot åƒåœ¾æ”¶é›†å™¨é‡Œï¼Œé™¤äº†G1ä»¥å¤–ï¼Œå…¶ä»–çš„åƒåœ¾æ”¶é›†å™¨ä½¿ç”¨å†…ç½®çš„JVMçº¿ç¨‹æ‰§è¡ŒGCçš„å¤šçº¿ç¨‹æ“ä½œï¼Œè€ŒG1 GCå¯ä»¥é‡‡ç”¨åº”ç”¨çº¿ç¨‹æ‰¿æ‹…åå°è¿è¡Œçš„GCå·¥ä½œï¼Œå³å½“JVMçš„GCçº¿ç¨‹å¤„ç†é€Ÿåº¦æ…¢æ—¶ï¼Œç³»ç»Ÿä¼šè°ƒç”¨åº”ç”¨ç¨‹åºçº¿ç¨‹å¸®åŠ©åŠ é€Ÿåƒåœ¾å›æ”¶è¿‡ç¨‹</p></blockquote><h4 id="åˆ†åŒºRegionï¼šåŒ–æ•´ä¸ºé›¶"><a href="#åˆ†åŒºRegionï¼šåŒ–æ•´ä¸ºé›¶" class="headerlink" title="åˆ†åŒºRegionï¼šåŒ–æ•´ä¸ºé›¶"></a>åˆ†åŒºRegionï¼šåŒ–æ•´ä¸ºé›¶</h4><p>ä½¿ç”¨ G1 æ”¶é›†å™¨æ—¶ï¼Œå®ƒå°†æ•´ä¸ªJavaå †åˆ’åˆ†æˆçº¦2048ä¸ªå¤§å°ç›¸åŒçš„ç‹¬ç«‹Regionå—ï¼Œæ¯ä¸ªRegionå—å¤§å°æ ¹æ®å †ç©ºé—´çš„å®é™…å¤§å°è€Œå®šï¼Œæ•´ä½“è¢«æ§åˆ¶åœ¨1MBåˆ°32MBä¹‹é—´ï¼Œä¸”ä¸º2çš„Næ¬¡å¹‚ï¼Œå³1MBï¼Œ2MBï¼Œ4MBï¼Œ8MBï¼Œ16MBï¼Œ32MBã€‚å¯ä»¥é€šè¿‡-XX:G1HeapRegionSizeè®¾å®šã€‚<strong>æ‰€æœ‰çš„Regionå¤§å°ç›¸åŒï¼Œä¸”åœ¨JVMç”Ÿå‘½å‘¨æœŸå†…ä¸ä¼šè¢«æ”¹å˜ã€‚</strong></p><p>è™½ç„¶è¿˜ä¿ç•™æœ‰æ–°ç”Ÿä»£å’Œè€å¹´ä»£çš„æ¦‚å¿µï¼Œä½†æ–°ç”Ÿä»£å’Œè€å¹´ä»£ä¸å†æ˜¯ç‰©ç†éš”ç¦»çš„äº†ï¼Œå®ƒä»¬éƒ½æ˜¯ä¸€éƒ¨åˆ†Region(ä¸éœ€è¦è¿ç»­)çš„é›†åˆã€‚é€šè¿‡Regionçš„åŠ¨æ€åˆ†é…æ–¹å¼å®ç°é€»è¾‘ä¸Šçš„è¿ç»­ã€‚</p><p><img src="http://cdn.leesin.fun/typora/s3/img/G1çš„åˆ†åŒºRegion.png" alt="G1çš„åˆ†åŒºRegion"></p><p>ä¸€ä¸ª region æœ‰å¯èƒ½å±äº Edenï¼ŒSurvivor æˆ–è€… old/Tenured å†…å­˜åŒºåŸŸã€‚ä½†æ˜¯ä¸€ä¸ªregionåªå¯èƒ½å±äºä¸€ä¸ªè§’è‰²ã€‚å›¾ä¸­çš„ E è¡¨ç¤ºè¯¥regionå±äºEdenå†…å­˜åŒºåŸŸï¼Œsè¡¨ç¤ºå±äºsurvivorå†…å­˜åŒºåŸŸï¼Œoè¡¨ç¤ºå±äºoldå†…å­˜åŒºåŸŸã€‚å›¾ä¸­ç©ºç™½çš„è¡¨ç¤ºæœªä½¿ç”¨çš„å†…å­˜ç©ºé—´ã€‚</p><p>G1 åƒåœ¾æ”¶é›†å™¨è¿˜å¢åŠ äº†ä¸€ç§æ–°çš„å†…å­˜åŒºåŸŸï¼Œå«åš Humongous å†…å­˜åŒºåŸŸï¼Œå¦‚å›¾ä¸­çš„ Hå—ã€‚ä¸»è¦ç”¨äºå­˜å‚¨å¤§å¯¹è±¡ï¼Œå¦‚æœè¶…è¿‡1.5ä¸ªregionï¼Œå°±æ”¾åˆ°Hã€‚</p><p>è®¾ç½®Hçš„åŸå› :<br>å¯¹äºå †ä¸­çš„å¤§å¯¹è±¡ï¼Œé»˜è®¤ç›´æ¥ä¼šè¢«åˆ†é…åˆ°è€å¹´ä»£ï¼Œä½†æ˜¯å¦‚æœå®ƒæ˜¯ä¸€ä¸ªçŸ­æœŸå­˜åœ¨çš„å¤§å¯¹è±¡ï¼Œå°±ä¼šå¯¹åƒåœ¾æ”¶é›†å™¨é€ æˆè´Ÿé¢å½±å“ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒG1åˆ’åˆ†äº†ä¸€ä¸ªHumongousåŒºï¼Œå®ƒç”¨æ¥ä¸“é—¨å­˜æ”¾å¤§å¯¹è±¡ã€‚<strong>å¦‚æœä¸€ä¸ªHåŒºè£…ä¸ä¸‹ä¸€ä¸ªå¤§å¯¹è±¡ï¼Œé‚£ä¹ˆG1ä¼šå¯»æ‰¾è¿ç»­çš„HåŒºæ¥å­˜å‚¨</strong>ã€‚ä¸ºäº†èƒ½æ‰¾åˆ°è¿ç»­çš„HåŒºï¼Œæœ‰æ—¶å€™ä¸å¾—ä¸å¯åŠ¨Ful1 GCã€‚G1çš„å¤§å¤šæ•°è¡Œä¸ºéƒ½æŠŠHåŒºä½œä¸ºè€å¹´ä»£çš„ä¸€éƒ¨åˆ†æ¥çœ‹å¾…ã€‚</p><h5 id="åˆ†åŒºRegionçš„ç»†èŠ‚ï¼šæŒ‡é’ˆç¢°æ’"><a href="#åˆ†åŒºRegionçš„ç»†èŠ‚ï¼šæŒ‡é’ˆç¢°æ’" class="headerlink" title="åˆ†åŒºRegionçš„ç»†èŠ‚ï¼šæŒ‡é’ˆç¢°æ’"></a>åˆ†åŒºRegionçš„ç»†èŠ‚ï¼šæŒ‡é’ˆç¢°æ’</h5><p><img src="http://cdn.leesin.fun/typora/s3/img/åˆ†åŒºregionçš„ç»†èŠ‚.png" alt="åˆ†åŒºregionçš„ç»†èŠ‚"></p><h4 id="Remebered-Set"><a href="#Remebered-Set" class="headerlink" title="Remebered Set"></a>Remebered Set</h4><p><img src="http://cdn.leesin.fun/typora/s3/img/Rset.png" alt="Rset"></p><p>ä¸€ä¸ªå¯¹è±¡è¢«ä¸åŒåŒºåŸŸå¼•ç”¨çš„é—®é¢˜ï¼šä¸€ä¸ªRegionä¸å¯èƒ½æ˜¯å­¤ç«‹çš„ï¼Œä¸€ä¸ªRegionä¸­çš„å¯¹è±¡å¯èƒ½è¢«å…¶ä»–ä»»æ„Regionä¸­å¯¹è±¡å¼•ç”¨åˆ¤æ–­å¯¹è±¡å­˜æ´»æ—¶ï¼Œæ˜¯å¦éœ€è¦æ‰«ææ•´ä¸ªJavaå †æ‰èƒ½ä¿è¯å‡†ç¡®ï¼Ÿå›æ”¶æ–°ç”Ÿä»£ä¹Ÿä¸å¾—ä¸åŒæ—¶æ‰«æè€å¹´ä»£ï¼Ÿè¿™æ ·çš„è¯ä¼šé™ä½minor GCçš„æ•ˆç‡;</p><p>è§£å†³æ–¹æ³•:</p><ul><li><p>æ— è®ºG1è¿˜æ˜¯å…¶ä»–åˆ†ä»£æ”¶é›†å™¨ï¼ŒJVMéƒ½æ˜¯ä½¿ç”¨Remembered Setæ¥é¿å…å…¨å±€æ‰«æï¼š</p></li><li><p>æ¯ä¸ªRegionéƒ½æœ‰ä¸€ä¸ªå¯¹åº”çš„Remembered Set;</p></li><li><p>æ¯æ¬¡Referenceç±»å‹æ•°æ®å†™æ“ä½œæ—¶ï¼Œéƒ½ä¼šäº§ç”Ÿä¸€ä¸ªwrite Barrieræš‚æ—¶ä¸­æ–­æ“ä½œ;</p></li><li><p>ç„¶åæ£€æŸ¥å°†è¦å†™å…¥çš„å¼•ç”¨æŒ‡å‘çš„å¯¹è±¡æ˜¯å¦å’Œè¯¥Referenceç±»å‹æ•°æ®åœ¨ä¸åŒçš„Region(å…¶ä»–æ”¶é›†å™¨:æ£€æŸ¥è€å¹´ä»£å¯¹è±¡æ˜¯å¦å¼•ç”¨äº†æ–°ç”Ÿä»£å¯¹è±¡);</p></li><li><p>å¦‚æœä¸åŒï¼Œé€šè¿‡CardTableæŠŠç›¸å…³å¼•ç”¨ä¿¡æ¯è®°å½•åˆ°å¼•ç”¨æŒ‡å‘å¯¹è±¡çš„æ‰€åœ¨Regionå¯¹åº”çš„Remembered Setä¸­ï¼›</p></li><li><p>å½“è¿›è¡Œåƒåœ¾æ”¶é›†æ—¶ï¼Œ==<strong>åœ¨GCæ ¹èŠ‚ç‚¹çš„æšä¸¾èŒƒå›´åŠ å…¥Remembered Set;</strong>== å°±å¯ä»¥ä¿è¯ä¸è¿›è¡Œå…¨å±€æ‰«æï¼Œä¹Ÿä¸ä¼šæœ‰é—æ¼ã€‚</p></li></ul><h2 id="åƒåœ¾å›æ”¶å™¨æ€»ç»“â­â­â­"><a href="#åƒåœ¾å›æ”¶å™¨æ€»ç»“â­â­â­" class="headerlink" title="åƒåœ¾å›æ”¶å™¨æ€»ç»“â­â­â­"></a>åƒåœ¾å›æ”¶å™¨æ€»ç»“â­â­â­</h2><p>å¦‚æœä½ æƒ³è¦æœ€å°åŒ–åœ°ä½¿ç”¨å†…å­˜å’Œå¹¶è¡Œå¼€é”€ï¼Œè¯·é€‰Serial GC;</p><p>å¦‚æœä½ æƒ³è¦æœ€å¤§åŒ–åº”ç”¨ç¨‹åºçš„ååé‡ï¼Œè¯·é€‰Parallel GC</p><p>å¦‚æœä½ æƒ³è¦æœ€å°åŒ–GCçš„ä¸­æ–­æˆ–åœé¡¿æ—¶é—´ï¼Œè¯·é€‰CMS GC</p><div class="table-container"><table><thead><tr><th style="text-align:center">åƒåœ¾æ”¶é›†å™¨</th><th style="text-align:center">åˆ†ç±»</th><th style="text-align:center">ä½œç”¨ä½ç½®</th><th style="text-align:center">ä½¿ç”¨ç®—æ³•</th><th style="text-align:center">ç‰¹ç‚¹</th><th style="text-align:center">é€‚ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td style="text-align:center">Serial</td><td style="text-align:center">ä¸²è¡Œ</td><td style="text-align:center">æ–°ç”Ÿä»£</td><td style="text-align:center">å¤åˆ¶ç®—æ³•</td><td style="text-align:center">å“åº”é€Ÿåº¦ä¼˜å…ˆ</td><td style="text-align:center">å•CPUç¯å¢ƒä¸‹çš„clientæ¨¡å¼</td></tr><tr><td style="text-align:center">ParNew</td><td style="text-align:center">å¹¶è¡Œ</td><td style="text-align:center">æ–°ç”Ÿä»£</td><td style="text-align:center">å¤åˆ¶ç®—æ³•</td><td style="text-align:center">å“åº”é€Ÿåº¦ä¼˜å…ˆ</td><td style="text-align:center">å¤šCPUç¯å¢ƒServeræ¨¡å¼ä¸‹ä¸CMSé…åˆä½¿ç”¨</td></tr><tr><td style="text-align:center">Parallel</td><td style="text-align:center">å¹¶è¡Œ</td><td style="text-align:center">æ–°ç”Ÿä»£</td><td style="text-align:center">å¤åˆ¶ç®—æ³•</td><td style="text-align:center">ååé‡ä¼˜å…ˆ</td><td style="text-align:center">åå°è¿ç®—ï¼Œä¸éœ€è¦å¤ªå¤šäº¤äº’</td></tr><tr><td style="text-align:center">Serial Old</td><td style="text-align:center">ä¸²è¡Œ</td><td style="text-align:center">è€å¹´ä»£</td><td style="text-align:center">æ ‡è®°-å‹ç¼©ç®—æ³•</td><td style="text-align:center">å“åº”é€Ÿåº¦ä¼˜å…ˆ</td><td style="text-align:center">å•CPUç¯å¢ƒä¸‹çš„clientæ¨¡å¼</td></tr><tr><td style="text-align:center">Parallel Old</td><td style="text-align:center">å¹¶è¡Œ</td><td style="text-align:center">è€å¹´ä»£</td><td style="text-align:center">æ ‡è®°-å‹ç¼©ç®—æ³•</td><td style="text-align:center">ååé‡ä¼˜å…ˆ</td><td style="text-align:center">åå°è¿ç®—ï¼Œä¸éœ€è¦å¤ªå¤šäº¤äº’</td></tr><tr><td style="text-align:center">CMS</td><td style="text-align:center">å¹¶å‘</td><td style="text-align:center">è€å¹´ä»£</td><td style="text-align:center">æ ‡è®°-æ¸…é™¤ç®—æ³•</td><td style="text-align:center">å“åº”é€Ÿåº¦ä¼˜å…ˆ</td><td style="text-align:center">äº’è”ç½‘æˆ–B/Sä¸šåŠ¡</td></tr><tr><td style="text-align:center">G1</td><td style="text-align:center">å¹¶å‘ã€å¹¶è¡Œ</td><td style="text-align:center">æ–°ç”Ÿä»£ã€è€å¹´ä»£</td><td style="text-align:center">æ ‡è®°-å‹ç¼©ç®—æ³•ã€å¤åˆ¶ç®—æ³•</td><td style="text-align:center">å“åº”é€Ÿåº¦ä¼˜å…ˆ</td><td style="text-align:center">é¢å‘æœåŠ¡ç«¯åº”ç”¨</td></tr></tbody></table></div><h2 id="GCæ—¥å¿—åˆ†æ"><a href="#GCæ—¥å¿—åˆ†æ" class="headerlink" title="GCæ—¥å¿—åˆ†æ"></a>GCæ—¥å¿—åˆ†æ</h2><h2 id="åƒåœ¾å›æ”¶å™¨çš„æ–°å‘å±•"><a href="#åƒåœ¾å›æ”¶å™¨çš„æ–°å‘å±•" class="headerlink" title="åƒåœ¾å›æ”¶å™¨çš„æ–°å‘å±•"></a>åƒåœ¾å›æ”¶å™¨çš„æ–°å‘å±•</h2>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ“ä½œç³»ç»Ÿ </tag>
            
            <tag> åç«¯ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MySQLé«˜çº§</title>
      <link href="/post/1.html"/>
      <url>/post/1.html</url>
      
        <content type="html"><![CDATA[<h1 id="1-å…¶ä»–"><a href="#1-å…¶ä»–" class="headerlink" title="1.å…¶ä»–"></a>1.å…¶ä»–</h1><h2 id="1-1-DDLï¼ˆæ•°æ®å®šä¹‰è¯­è¨€ï¼‰"><a href="#1-1-DDLï¼ˆæ•°æ®å®šä¹‰è¯­è¨€ï¼‰" class="headerlink" title="1.1.DDLï¼ˆæ•°æ®å®šä¹‰è¯­è¨€ï¼‰"></a>1.1.DDLï¼ˆæ•°æ®å®šä¹‰è¯­è¨€ï¼‰</h2><p>æ•°æ®åº“æ“ä½œ</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># æŸ¥è¯¢æ‰€æœ‰æ•°æ®åº“</span><br><span class="line"><span class="keyword">show</span> databases;</span><br><span class="line"># æŸ¥è¯¢å½“å‰ä½¿ç”¨çš„æ•°æ®åº“</span><br><span class="line"><span class="keyword">select</span> database();</span><br><span class="line"># åˆ›å»ºæ•°æ®åº“</span><br><span class="line"><span class="keyword">create</span> database [if <span class="keyword">not</span> <span class="keyword">exists</span>] æ•°æ®åº“å [<span class="keyword">default</span> charset å­—ç¬¦é›†] [<span class="keyword">collate</span> æ’åºè§„åˆ™];</span><br><span class="line"># åˆ é™¤æ•°æ®åº“</span><br><span class="line"><span class="keyword">drop</span> database [ if exitsts ] æ•°æ®åº“å;</span><br><span class="line"># ä½¿ç”¨æ•°æ®åº“</span><br><span class="line">use æ•°æ®åº“å;</span><br></pre></td></tr></table></figure><p>è¡¨æ“ä½œ</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># æŸ¥è¯¢å½“å‰æ•°æ®åº“æ‰€æœ‰è¡¨</span><br><span class="line"><span class="keyword">show</span> tables;</span><br><span class="line"># æŸ¥è¯¢è¡¨ç»“æ„</span><br><span class="line"><span class="keyword">desc</span> è¡¨å;</span><br><span class="line"># æŸ¥è¯¢æŒ‡å®šè¡¨çš„å»ºè¡¨è¯­å¥</span><br><span class="line"><span class="keyword">show</span> <span class="keyword">create</span> <span class="keyword">table</span> è¡¨å;</span><br><span class="line"># æ·»åŠ å­—æ®µ</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> è¡¨å <span class="keyword">add</span> å­—æ®µå ç±»å‹(é•¿åº¦) [comment æ³¨é‡Š] [çº¦æŸ];</span><br><span class="line"># ä¿®æ”¹æ•°æ®ç±»å‹</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> è¡¨å modify å­—æ®µå æ–°æ•°æ®ç±»å‹(é•¿åº¦);</span><br><span class="line"># ä¿®æ”¹å­—æ®µåå’Œå­—æ®µç±»å‹</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> è¡¨å change æ—§å­—æ®µå æ–°å­—æ®µå ç±»å‹(é•¿åº¦) [comment æ³¨é‡Š] [çº¦æŸ];</span><br></pre></td></tr></table></figure><h2 id="1-2-DMLï¼ˆæ•°æ®æ“ä½œè¯­è¨€ï¼‰"><a href="#1-2-DMLï¼ˆæ•°æ®æ“ä½œè¯­è¨€ï¼‰" class="headerlink" title="1.2.DMLï¼ˆæ•°æ®æ“ä½œè¯­è¨€ï¼‰"></a>1.2.DMLï¼ˆæ•°æ®æ“ä½œè¯­è¨€ï¼‰</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> ...</span><br><span class="line"><span class="keyword">update</span> ...</span><br><span class="line"><span class="keyword">delete</span> ...</span><br></pre></td></tr></table></figure><h2 id="1-3-DQLï¼ˆæ•°æ®æŸ¥è¯¢è¯­è¨€ï¼‰"><a href="#1-3-DQLï¼ˆæ•°æ®æŸ¥è¯¢è¯­è¨€ï¼‰" class="headerlink" title="1.3.DQLï¼ˆæ•°æ®æŸ¥è¯¢è¯­è¨€ï¼‰"></a>1.3.DQLï¼ˆæ•°æ®æŸ¥è¯¢è¯­è¨€ï¼‰</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> ...</span><br></pre></td></tr></table></figure><p>DQLæ‰§è¡Œé¡ºåº:</p><p>FROM -&gt; WHERE -&gt; GROUP BY -&gt; SELECT -&gt; ORDER BY -&gt; LIMIT</p><h2 id="1-4-DCLï¼ˆç®¡ç†ç”¨æˆ·ï¼‰"><a href="#1-4-DCLï¼ˆç®¡ç†ç”¨æˆ·ï¼‰" class="headerlink" title="1.4.DCLï¼ˆç®¡ç†ç”¨æˆ·ï¼‰"></a>1.4.DCLï¼ˆç®¡ç†ç”¨æˆ·ï¼‰</h2><h1 id="2-äº‹åŠ¡"><a href="#2-äº‹åŠ¡" class="headerlink" title="2.äº‹åŠ¡"></a>2.äº‹åŠ¡</h1><h2 id="2-1-äº‹åŠ¡ç®€ä»‹"><a href="#2-1-äº‹åŠ¡ç®€ä»‹" class="headerlink" title="2.1.äº‹åŠ¡ç®€ä»‹"></a>2.1.äº‹åŠ¡ç®€ä»‹</h2><p>äº‹åŠ¡ æ˜¯ä¸€ç»„æ“ä½œçš„é›†åˆï¼Œå®ƒæ˜¯ä¸€ä¸ªä¸å¯åˆ†å‰²çš„å·¥ä½œå•ä½ï¼Œäº‹åŠ¡ä¼šæŠŠæ‰€æœ‰çš„æ“ä½œä½œä¸ºä¸€ä¸ªæ•´ä½“ä¸€èµ·å‘ç³»ç»Ÿæäº¤æˆ–æ’¤é”€æ“ä½œè¯·æ±‚ï¼Œå³è¿™äº›æ“ä½œ==è¦ä¹ˆåŒæ—¶æˆåŠŸï¼Œè¦ä¹ˆåŒæ—¶å¤±è´¥ã€‚==</p><p><strong>é»˜è®¤MySQLçš„äº‹åŠ¡æ˜¯è‡ªåŠ¨æäº¤çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå½“æ‰§è¡Œä¸€æ¡DMLè¯­å¥ï¼ŒMySQLä¼šç«‹å³éšå¼çš„æäº¤äº‹åŠ¡ã€‚</strong></p><h2 id="2-2-äº‹åŠ¡æ“ä½œ"><a href="#2-2-äº‹åŠ¡æ“ä½œ" class="headerlink" title="2.2.äº‹åŠ¡æ“ä½œ"></a>2.2.äº‹åŠ¡æ“ä½œ</h2><p>æ–¹å¼1ï¼Œå°†äº‹åŠ¡è®¾ç½®ä¸ºæ‰‹åŠ¨æäº¤</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># æŸ¥çœ‹äº‹åŠ¡çš„æäº¤æ–¹å¼ï¼Œ<span class="number">1</span>è¡¨ç¤ºè‡ªåŠ¨æäº¤ï¼Œ<span class="number">0</span>è¡¨ç¤ºæ‰‹åŠ¨æäº¤</span><br><span class="line"><span class="keyword">select</span> @<span class="variable">@autocommit</span>;</span><br><span class="line"></span><br><span class="line"># è®¾ç½®äº‹åŠ¡æäº¤æ–¹å¼ä¸ºæ‰‹åŠ¨æäº¤</span><br><span class="line"><span class="keyword">set</span> @<span class="variable">@autocommit</span><span class="operator">=</span><span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"># æäº¤äº‹åŠ¡</span><br><span class="line"><span class="keyword">commit</span>;</span><br><span class="line"></span><br><span class="line"># å›æ»šäº‹åŠ¡</span><br><span class="line"><span class="keyword">rollback</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æ–¹å¼2ï¼Œä¸ä¿®æ”¹äº‹åŠ¡çš„æäº¤æ–¹å¼</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># å¼€å¯äº‹åŠ¡ï¼Œä»¥ä¸‹ä¸¤æ¡è¯­å¥éƒ½æ˜¯å¯ä»¥çš„ã€‚</span><br><span class="line"><span class="keyword">start</span> transaction;</span><br><span class="line"><span class="keyword">begin</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># æäº¤äº‹åŠ¡</span><br><span class="line"><span class="keyword">commit</span>;</span><br><span class="line"></span><br><span class="line"># å›æ»šäº‹åŠ¡</span><br><span class="line"><span class="keyword">rollback</span>;</span><br></pre></td></tr></table></figure><h2 id="2-3-äº‹åŠ¡å››å¤§ç‰¹æ€§ACIDâ­â­â­"><a href="#2-3-äº‹åŠ¡å››å¤§ç‰¹æ€§ACIDâ­â­â­" class="headerlink" title="2.3.äº‹åŠ¡å››å¤§ç‰¹æ€§ACIDâ­â­â­"></a>2.3.äº‹åŠ¡å››å¤§ç‰¹æ€§ACIDâ­â­â­</h2><p>åŸå­æ€§ (Atomicity)ï¼šäº‹åŠ¡æ˜¯ä¸å¯åˆ†å‰²çš„æœ€å°æ“ä½œå•å…ƒï¼Œè¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥</p><p>ä¸€è‡´æ€§(Consistency)ï¼šäº‹åŠ¡å®Œæˆæ—¶ï¼Œå¿…é¡»ä½¿æ‰€æœ‰çš„æ•°æ®éƒ½ä¿æŒä¸€è‡´çŠ¶æ€ã€‚</p><p>éš”ç¦»æ€§ (lsolation)ï¼šæ•°æ®åº“ç³»ç»Ÿæä¾›çš„éš”ç¦»æœºåˆ¶ï¼Œä¿è¯äº‹åŠ¡åœ¨ä¸å—å¤–éƒ¨å¹¶å‘æ“ä½œå½±å“çš„ç‹¬ç«‹ç¯å¢ƒä¸‹è¿è¡Œã€‚</p><p>æŒä¹…æ€§ (Durability)ï¼šäº‹åŠ¡ä¸€æ—¦æäº¤æˆ–å›æ»šï¼Œå®ƒå¯¹æ•°æ®åº“ä¸­çš„æ•°æ®çš„æ”¹å˜å°±æ˜¯æ°¸ä¹…çš„ã€‚</p><h2 id="2-4-å¹¶å‘äº‹åŠ¡é—®é¢˜â­â­â­"><a href="#2-4-å¹¶å‘äº‹åŠ¡é—®é¢˜â­â­â­" class="headerlink" title="2.4.å¹¶å‘äº‹åŠ¡é—®é¢˜â­â­â­"></a>2.4.å¹¶å‘äº‹åŠ¡é—®é¢˜â­â­â­</h2><p>è„è¯»ï¼šä¸€ä¸ªäº‹åŠ¡è¯»å–åˆ°å¦ä¸€ä¸ªäº‹åŠ¡è¿˜æ²¡æœ‰æäº¤çš„æ•°æ®ã€‚</p><p>ä¸å¯é‡å¤è¯»ï¼šä¸€ä¸ªäº‹åŠ¡å…ˆåè¯»å–åŒä¸€æ¡è®°å½•ï¼Œä½†ä¸¤æ¬¡è¯»å–çš„æ•°æ®ä¸åŒã€‚</p><p>å¹»è¯»ï¼šä¸€ä¸ªäº‹åŠ¡æŒ‰ç…§æ¡ä»¶æŸ¥è¯¢æ•°æ®æ—¶ï¼Œæ²¡æœ‰å¯¹åº”çš„æ•°æ®è¡Œï¼Œä½†æ˜¯åœ¨æ’å…¥æ•°æ®æ—¶ï¼Œåˆå‘ç°è¿™è¡Œæ•°æ®å·²ç»å­˜åœ¨äº†ï¼Œå¥½åƒå‡ºç°äº†â€å¹»å½±â€œã€‚</p><h2 id="2-5-äº‹åŠ¡çš„éš”ç¦»çº§åˆ«â­â­â­"><a href="#2-5-äº‹åŠ¡çš„éš”ç¦»çº§åˆ«â­â­â­" class="headerlink" title="2.5.äº‹åŠ¡çš„éš”ç¦»çº§åˆ«â­â­â­"></a>2.5.äº‹åŠ¡çš„éš”ç¦»çº§åˆ«â­â­â­</h2><p>ä¸åŒéš”ç¦»çº§åˆ«èƒ½è§£å†³çš„é—®é¢˜ï¼š </p><div class="table-container"><table><thead><tr><th style="text-align:center">éš”ç¦»çº§åˆ«</th><th style="text-align:center">è„è¯»</th><th style="text-align:center">ä¸å¯é‡å¤è¯»</th><th style="text-align:center">å¹»è¯»</th></tr></thead><tbody><tr><td style="text-align:center">Read uncommitted</td><td style="text-align:center">Ã—</td><td style="text-align:center">Ã—</td><td style="text-align:center">Ã—</td></tr><tr><td style="text-align:center">Read committed</td><td style="text-align:center">âˆš</td><td style="text-align:center">Ã—</td><td style="text-align:center">Ã—</td></tr><tr><td style="text-align:center">Repeatable Read(é»˜è®¤)</td><td style="text-align:center">âˆš</td><td style="text-align:center">âˆš</td><td style="text-align:center">Ã—</td></tr><tr><td style="text-align:center">Serializable</td><td style="text-align:center">âˆš</td><td style="text-align:center">âˆš</td><td style="text-align:center">âˆš</td></tr></tbody></table></div><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"># æŸ¥çœ‹äº‹åŠ¡çš„éš”ç¦»çº§åˆ«</span><br><span class="line"><span class="keyword">select</span> @<span class="variable">@transaction</span>_isolation;</span><br><span class="line"></span><br><span class="line"># è®¾ç½®äº‹åŠ¡çš„éš”ç¦»çº§åˆ«</span><br><span class="line"><span class="keyword">set</span> [session <span class="operator">|</span> <span class="keyword">global</span>] transaction isolation level &#123;read uncommitted <span class="operator">|</span> read committed <span class="operator">|</span> repeatable read <span class="operator">|</span> serializable&#125;;</span><br><span class="line"></span><br><span class="line"># è®¾ç½®æœ¬ä¼šè¯çš„äº‹åŠ¡çº§åˆ«ä¸º è¯»æœªæäº¤</span><br><span class="line"><span class="keyword">set</span> session transaction isolation level read uncommitted;</span><br><span class="line"># è®¾ç½®æœ¬ä¼šè¯çš„äº‹åŠ¡çº§åˆ«ä¸º è¯»å·²æäº¤</span><br><span class="line"><span class="keyword">set</span> session transaction isolation level read committed;</span><br><span class="line"># è®¾ç½®æœ¬ä¼šè¯çš„äº‹åŠ¡çº§åˆ«ä¸º å¯é‡å¤è¯»</span><br><span class="line"><span class="keyword">set</span> session transaction isolation level repeatable read;</span><br><span class="line"># è®¾ç½®æœ¬ä¼šè¯çš„äº‹åŠ¡çº§åˆ«ä¸º ä¸²è¡ŒåŒ–</span><br><span class="line"><span class="keyword">set</span> session transaction isolation level serializable;</span><br><span class="line"></span><br><span class="line"># ç»æˆ‘åˆæ­¥æµ‹è¯•ï¼šè®¾ç½®<span class="keyword">global</span>çš„äº‹åŠ¡çº§åˆ«ï¼Œéœ€è¦é‡å¯ä¼šè¯æ‰èƒ½ç”Ÿæ•ˆã€‚</span><br><span class="line"># è®¾ç½®å…¨å±€çš„äº‹åŠ¡çº§åˆ«ä¸º è¯»æœªæäº¤</span><br><span class="line"><span class="keyword">set</span> <span class="keyword">global</span> transaction isolation level read uncommitted;</span><br><span class="line"># è®¾ç½®å…¨å±€çš„äº‹åŠ¡çº§åˆ«ä¸º è¯»å·²æäº¤</span><br><span class="line"><span class="keyword">set</span> <span class="keyword">global</span> transaction isolation level read committed;</span><br><span class="line"># è®¾ç½®å…¨å±€çš„äº‹åŠ¡çº§åˆ«ä¸º å¯é‡å¤è¯»</span><br><span class="line"><span class="keyword">set</span> <span class="keyword">global</span> transaction isolation level repeatable read;</span><br><span class="line"># è®¾ç½®å…¨å±€çš„äº‹åŠ¡çº§åˆ«ä¸º ä¸²è¡ŒåŒ–</span><br><span class="line"><span class="keyword">set</span> <span class="keyword">global</span> transaction isolation level serializable;</span><br></pre></td></tr></table></figure><h1 id="3-MySQLä½“ç³»ç»“æ„"><a href="#3-MySQLä½“ç³»ç»“æ„" class="headerlink" title="3.MySQLä½“ç³»ç»“æ„"></a>3.MySQLä½“ç³»ç»“æ„</h1><p><img src="http://cdn.leesin.fun/typora/s3/img/image-20230308221800263.png" alt="image-20230308221800263"></p><ul><li>è¿æ¥å±‚ï¼šæœ€ä¸Šå±‚æ˜¯ä¸€äº›å®¢æˆ·ç«¯å’Œé“¾æ¥æœåŠ¡ï¼Œä¸»è¦å®Œæˆä¸€äº›ç±»ä¼¼äºè¿æ¥å¤„ç†ã€æˆæƒè®¤è¯ã€åŠç›¸å…³çš„å®‰å…¨æ–¹æ¡ˆã€‚æœåŠ¡å™¨ä¹Ÿä¼šä¸ºå®‰å…¨æ¥å…¥çš„æ¯ä¸ªå®¢æˆ·ç«¯éªŒè¯å®ƒæ‰€å…·æœ‰çš„æ“ä½œæƒé™ã€‚</li><li>æœåŠ¡å±‚ï¼šç¬¬äºŒå±‚æ¶æ„ä¸»è¦å®Œæˆå¤§å¤šæ•°çš„æ ¸å¿ƒæœåŠ¡åŠŸèƒ½ï¼Œå¦‚SQLæ¥å£ï¼Œå¹¶å®Œæˆç¼“å­˜çš„æŸ¥è¯¢ï¼ŒSQLçš„åˆ†æå’Œä¼˜åŒ–ï¼Œéƒ¨åˆ†å†…ç½®å‡½æ•°çš„æ‰§è¡Œã€‚æ‰€æœ‰è·¨å­˜å‚¨å¼•æ“çš„åŠŸèƒ½ä¹Ÿåœ¨è¿™ä¸€å±‚å®ç°ï¼Œå¦‚ è¿‡ç¨‹ã€å‡½æ•°ç­‰ã€‚</li><li>å¼•æ“å±‚ï¼šå­˜å‚¨å¼•æ“çœŸæ­£çš„è´Ÿè´£äº†MySQLä¸­æ•°æ®çš„å­˜å‚¨å’Œæå–ï¼ŒæœåŠ¡å™¨é€šè¿‡APIå’Œå­˜å‚¨å¼•æ“è¿›è¡Œé€šä¿¡ã€‚ä¸åŒçš„å­˜å‚¨å¼•æ“å…·æœ‰ä¸åŒçš„åŠŸèƒ½ï¼Œè¿™æ ·æˆ‘ä»¬å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€è¦ï¼Œæ¥é€‰å–åˆé€‚çš„å­˜å‚¨å¼•æ“ã€‚</li><li>å­˜å‚¨å±‚ï¼šä¸»è¦æ˜¯å°†æ•°æ®å­˜å‚¨åœ¨æ–‡ä»¶ç³»ç»Ÿä¹‹ä¸Šï¼Œå¹¶å®Œæˆä¸å­˜å‚¨å¼•æ“çš„äº¤äº’ã€‚</li></ul><h1 id="4-å­˜å‚¨å¼•æ“"><a href="#4-å­˜å‚¨å¼•æ“" class="headerlink" title="4.å­˜å‚¨å¼•æ“"></a>4.å­˜å‚¨å¼•æ“</h1><h2 id="4-1-InnoDB-é€»è¾‘å­˜å‚¨ç»“æ„"><a href="#4-1-InnoDB-é€»è¾‘å­˜å‚¨ç»“æ„" class="headerlink" title="4.1.InnoDB é€»è¾‘å­˜å‚¨ç»“æ„"></a>4.1.InnoDB é€»è¾‘å­˜å‚¨ç»“æ„</h2><p><img src="http://cdn.leesin.fun/typora/s3/img/image-20230308215852555.png" alt="image-20230308215852555"></p><h2 id="4-2-InnoDBå’ŒMyISAMå’ŒMemoryå¯¹æ¯”"><a href="#4-2-InnoDBå’ŒMyISAMå’ŒMemoryå¯¹æ¯”" class="headerlink" title="4.2.InnoDBå’ŒMyISAMå’ŒMemoryå¯¹æ¯”"></a>4.2.InnoDBå’ŒMyISAMå’ŒMemoryå¯¹æ¯”</h2><div class="table-container"><table><thead><tr><th style="text-align:center">ç‰¹ç‚¹</th><th style="text-align:center">InnoDB</th><th style="text-align:center">MyISAM</th><th style="text-align:center">Memory</th></tr></thead><tbody><tr><td style="text-align:center">å­˜å‚¨é™åˆ¶</td><td style="text-align:center">64TB</td><td style="text-align:center">æœ‰</td><td style="text-align:center">æœ‰</td></tr><tr><td style="text-align:center">äº‹åŠ¡å®‰å…¨</td><td style="text-align:center">==æ”¯æŒ==</td><td style="text-align:center">-</td><td style="text-align:center">-</td></tr><tr><td style="text-align:center">é”æœºåˆ¶</td><td style="text-align:center">==è¡Œé”==</td><td style="text-align:center">è¡¨é”</td><td style="text-align:center">è¡¨é”</td></tr><tr><td style="text-align:center">B+treeç´¢å¼•</td><td style="text-align:center">æ”¯æŒ</td><td style="text-align:center">æ”¯æŒ</td><td style="text-align:center">æ”¯æŒ</td></tr><tr><td style="text-align:center">Hashç´¢å¼•</td><td style="text-align:center">-</td><td style="text-align:center">-</td><td style="text-align:center"><strong>æ”¯æŒ</strong></td></tr><tr><td style="text-align:center">å…¨æ–‡ç´¢å¼•</td><td style="text-align:center">æ”¯æŒï¼ˆ5.6ç‰ˆæœ¬ä¹‹åï¼‰</td><td style="text-align:center">æ”¯æŒ</td><td style="text-align:center">-</td></tr><tr><td style="text-align:center">ç©ºé—´ä½¿ç”¨</td><td style="text-align:center">é«˜</td><td style="text-align:center">ä½</td><td style="text-align:center">N/A</td></tr><tr><td style="text-align:center">å†…å­˜ä½¿ç”¨</td><td style="text-align:center">é«˜</td><td style="text-align:center">ä½</td><td style="text-align:center">ä¸­ç­‰</td></tr><tr><td style="text-align:center">æ‰¹é‡æ’å…¥é€Ÿåº¦</td><td style="text-align:center">ä½</td><td style="text-align:center">é«˜</td><td style="text-align:center">é«˜</td></tr><tr><td style="text-align:center">æ”¯æŒå¤–é”®</td><td style="text-align:center">==æ”¯æŒ==</td><td style="text-align:center">-</td><td style="text-align:center">-</td></tr></tbody></table></div><blockquote><p><strong>æ€»ç»“ï¼šInnoDBæ”¯æŒäº‹åŠ¡ï¼Œè¡Œçº§é”ï¼Œå¤–é”®ã€‚</strong></p></blockquote><h2 id="4-3-å­˜å‚¨å¼•æ“çš„é€‰æ‹©"><a href="#4-3-å­˜å‚¨å¼•æ“çš„é€‰æ‹©" class="headerlink" title="4.3.å­˜å‚¨å¼•æ“çš„é€‰æ‹©"></a>4.3.å­˜å‚¨å¼•æ“çš„é€‰æ‹©</h2><p>åœ¨é€‰æ‹©å­˜å‚¨å¼•æ“æ—¶ï¼Œåº”è¯¥æ ¹æ®åº”ç”¨ç³»ç»Ÿçš„ç‰¹ç‚¹é€‰æ‹©åˆé€‚çš„å­˜å‚¨å¼•æ“ã€‚å¯¹äºå¤æ‚çš„åº”ç”¨ç³»ç»Ÿï¼Œè¿˜å¯ä»¥æ ¹æ®å®é™…æƒ…å†µé€‰æ‹©å¤šç§å­˜å‚¨å¼•æ“è¿›è¡Œç»„åˆã€‚</p><ul><li>InnoDB: å¦‚æœåº”ç”¨å¯¹äº‹ç‰©çš„å®Œæ•´æ€§æœ‰æ¯”è¾ƒé«˜çš„è¦æ±‚ï¼Œåœ¨å¹¶å‘æ¡ä»¶ä¸‹è¦æ±‚æ•°æ®çš„ä¸€è‡´æ€§ï¼Œæ•°æ®æ“ä½œé™¤äº†æ’å…¥å’ŒæŸ¥è¯¢ä¹‹å¤–ï¼Œè¿˜åŒ…å«å¾ˆå¤šçš„æ›´æ–°ã€åˆ é™¤æ“ä½œï¼Œåˆ™ InnoDB æ˜¯æ¯”è¾ƒåˆé€‚çš„é€‰æ‹©</li><li>MyISAM: å¦‚æœåº”ç”¨æ˜¯ä»¥è¯»æ“ä½œå’Œæ’å…¥æ“ä½œä¸ºä¸»ï¼Œåªæœ‰å¾ˆå°‘çš„æ›´æ–°å’Œåˆ é™¤æ“ä½œï¼Œå¹¶ä¸”å¯¹äº‹åŠ¡çš„å®Œæ•´æ€§ã€å¹¶å‘æ€§è¦æ±‚ä¸é«˜ï¼Œé‚£è¿™ä¸ªå­˜å‚¨å¼•æ“æ˜¯éå¸¸åˆé€‚çš„ã€‚<strong>ï¼ˆè¢«MongoDBæ›¿ä»£äº†ï¼‰</strong></li><li>Memory: å°†æ‰€æœ‰æ•°æ®ä¿å­˜åœ¨å†…å­˜ä¸­ï¼Œè®¿é—®é€Ÿåº¦å¿«ï¼Œé€šå¸¸ç”¨äºä¸´æ—¶è¡¨åŠç¼“å­˜ã€‚Memory çš„ç¼ºé™·æ˜¯å¯¹è¡¨çš„å¤§å°æœ‰é™åˆ¶ï¼Œå¤ªå¤§çš„è¡¨æ— æ³•ç¼“å­˜åœ¨å†…å­˜ä¸­ï¼Œè€Œä¸”æ— æ³•ä¿éšœæ•°æ®çš„å®‰å…¨æ€§<strong>ï¼ˆè¢«Redisæ›¿ä»£äº†ï¼‰</strong></li></ul><p>ç”µå•†ä¸­çš„è¶³è¿¹å’Œè¯„è®ºé€‚åˆä½¿ç”¨ MyISAM å¼•æ“ï¼Œç¼“å­˜é€‚åˆä½¿ç”¨ Memory å¼•æ“ã€‚</p><h1 id="5-ç´¢å¼•"><a href="#5-ç´¢å¼•" class="headerlink" title="5.ç´¢å¼•"></a>5.ç´¢å¼•</h1><h2 id="5-1-ä¼˜ç¼ºç‚¹"><a href="#5-1-ä¼˜ç¼ºç‚¹" class="headerlink" title="5.1.ä¼˜ç¼ºç‚¹"></a>5.1.ä¼˜ç¼ºç‚¹</h2><div class="table-container"><table><thead><tr><th style="text-align:left">ä¼˜ç‚¹</th><th style="text-align:left">ç¼ºç‚¹</th></tr></thead><tbody><tr><td style="text-align:left">æé«˜æ•°æ®æ£€ç´¢æ•ˆç‡ï¼Œé™ä½æ•°æ®åº“çš„IOæˆæœ¬</td><td style="text-align:left">ç´¢å¼•åˆ—ä¹Ÿæ˜¯è¦å ç”¨ç©ºé—´çš„</td></tr><tr><td style="text-align:left">é€šè¿‡ç´¢å¼•åˆ—å¯¹æ•°æ®è¿›è¡Œæ’åºï¼Œé™ä½æ•°æ®æ’åºçš„æˆæœ¬ï¼Œé™ä½CPUçš„æ¶ˆè€—</td><td style="text-align:left">ç´¢å¼•å¤§å¤§æé«˜äº†æŸ¥è¯¢æ•ˆç‡ï¼Œä½†é™ä½äº†æ›´æ–°çš„é€Ÿåº¦ï¼Œæ¯”å¦‚ INSERTã€UPDATEã€DELETE</td></tr></tbody></table></div><h2 id="5-2-ç´¢å¼•ç»“æ„"><a href="#5-2-ç´¢å¼•ç»“æ„" class="headerlink" title="5.2.ç´¢å¼•ç»“æ„"></a>5.2.ç´¢å¼•ç»“æ„</h2><div class="table-container"><table><thead><tr><th>ç´¢å¼•ç»“æ„</th><th>æè¿°</th></tr></thead><tbody><tr><td>B+Tree</td><td>æœ€å¸¸è§çš„ç´¢å¼•ç±»å‹ï¼Œå¤§éƒ¨åˆ†å¼•æ“éƒ½æ”¯æŒB+æ ‘ç´¢å¼•</td></tr><tr><td>Hash</td><td>åº•å±‚æ•°æ®ç»“æ„æ˜¯ç”¨å“ˆå¸Œè¡¨å®ç°ï¼Œåªæœ‰ç²¾ç¡®åŒ¹é…ç´¢å¼•åˆ—çš„æŸ¥è¯¢æ‰æœ‰æ•ˆï¼Œ<strong>ä¸æ”¯æŒèŒƒå›´æŸ¥è¯¢</strong></td></tr><tr><td>R-Tree(ç©ºé—´ç´¢å¼•)</td><td>ç©ºé—´ç´¢å¼•æ˜¯ MyISAM å¼•æ“çš„ä¸€ä¸ªç‰¹æ®Šç´¢å¼•ç±»å‹ï¼Œä¸»è¦ç”¨äºåœ°ç†ç©ºé—´æ•°æ®ç±»å‹ï¼Œé€šå¸¸ä½¿ç”¨è¾ƒå°‘</td></tr><tr><td>Full-Text(å…¨æ–‡ç´¢å¼•)</td><td>æ˜¯ä¸€ç§é€šè¿‡å»ºç«‹å€’æ’ç´¢å¼•ï¼Œå¿«é€ŸåŒ¹é…æ–‡æ¡£çš„æ–¹å¼ï¼Œç±»ä¼¼äº Lucene, Solr, ES</td></tr></tbody></table></div><p>æ”¯æŒæƒ…å†µï¼š</p><div class="table-container"><table><thead><tr><th>ç´¢å¼•</th><th>InnoDB</th><th>MyISAM</th><th>Memory</th></tr></thead><tbody><tr><td>B+Treeç´¢å¼•</td><td>æ”¯æŒ</td><td>æ”¯æŒ</td><td>æ”¯æŒ</td></tr><tr><td>Hashç´¢å¼•</td><td>ä¸æ”¯æŒ</td><td>ä¸æ”¯æŒ</td><td>æ”¯æŒ</td></tr><tr><td>R-Treeç´¢å¼•</td><td>ä¸æ”¯æŒ</td><td>æ”¯æŒ</td><td>ä¸æ”¯æŒ</td></tr><tr><td>Full-text</td><td>5.6ç‰ˆæœ¬åæ”¯æŒ</td><td>æ”¯æŒ</td><td>ä¸æ”¯æŒ</td></tr></tbody></table></div><blockquote><p>æ³¨ï¼šæˆ‘ä»¬å¹³å¸¸æ‰€è¯´çš„ç´¢å¼•ï¼Œå¦‚æœæ²¡æœ‰ç‰¹åˆ«æŒ‡æ˜ï¼Œéƒ½æ˜¯æŒ‡B+æ ‘ç»“æ„ç»„ç»‡çš„ç´¢å¼•ã€‚</p></blockquote><h3 id="5-2-1-äºŒå‰æœç´¢æ ‘"><a href="#5-2-1-äºŒå‰æœç´¢æ ‘" class="headerlink" title="5.2.1.äºŒå‰æœç´¢æ ‘"></a>5.2.1.äºŒå‰æœç´¢æ ‘</h3><p><img src="http://cdn.leesin.fun/typora/s3/img/äºŒå‰æœç´¢æ ‘.png" alt="äºŒå‰æœç´¢æ ‘"></p><p><strong>äºŒå‰æ ‘ç¼ºç‚¹: é¡ºåºæ’å…¥æ—¶ï¼Œä¼šå½¢æˆä¸€ä¸ªé“¾è¡¨ï¼ŒæŸ¥è¯¢æ€§èƒ½å¤§å¤§é™ä½ã€‚æ—¶é—´å¤æ‚åº¦ä¸ºO(N)</strong></p><blockquote><p>ä¸ºä»€ä¹ˆä¸ç”¨çº¢é»‘æ ‘ï¼Ÿ</p><p>çº¢é»‘æ ‘ä¹Ÿæ˜¯äºŒå‰æ ‘ï¼Œå¤§æ•°æ®é‡æƒ…å†µä¸‹ï¼Œå±‚çº§è¾ƒæ·±ï¼Œæ£€ç´¢é€Ÿåº¦æ…¢ã€‚</p></blockquote><h3 id="5-2-2-B-Treeï¼ˆå¤šè·¯å¹³è¡¡æŸ¥æ‰¾æ ‘ï¼‰"><a href="#5-2-2-B-Treeï¼ˆå¤šè·¯å¹³è¡¡æŸ¥æ‰¾æ ‘ï¼‰" class="headerlink" title="5.2.2.B-Treeï¼ˆå¤šè·¯å¹³è¡¡æŸ¥æ‰¾æ ‘ï¼‰"></a>5.2.2.B-Treeï¼ˆå¤šè·¯å¹³è¡¡æŸ¥æ‰¾æ ‘ï¼‰</h3><p>ä¸ºäº†è§£å†³å±‚çº§è¾ƒæ·±é—®é¢˜ï¼Œé‡‡ç”¨B-Treeã€‚</p><p>ä»¥5é˜¶B-Treeä¸ºä¾‹ï¼ˆæ¯ä¸ªèŠ‚ç‚¹æœ€å¤šå­˜å‚¨4ä¸ªkeyï¼Œ5ä¸ªæŒ‡é’ˆï¼‰</p><p><img src="http://cdn.leesin.fun/typora/s3/img/image-20230308223104616.png" alt="image-20230308223104616"></p><h3 id="5-2-3-B-Tree"><a href="#5-2-3-B-Tree" class="headerlink" title="5.2.3.B+Tree"></a>5.2.3.B+Tree</h3><p><img src="http://cdn.leesin.fun/typora/s3/img/image-20230308223830882.png" alt="image-20230308223830882"></p><blockquote><p>ä¸ B-Tree çš„åŒºåˆ«ï¼š</p><ul><li>æ‰€æœ‰çš„æ•°æ®éƒ½ä¼šå‡ºç°åœ¨å¶å­èŠ‚ç‚¹</li><li>å¶å­èŠ‚ç‚¹å½¢æˆä¸€ä¸ªå•å‘é“¾è¡¨</li></ul></blockquote><h3 id="5-2-4-MySQLçš„B-Tree"><a href="#5-2-4-MySQLçš„B-Tree" class="headerlink" title="5.2.4.MySQLçš„B+Tree"></a>5.2.4.MySQLçš„B+Tree</h3><p>MySQL ç´¢å¼•æ•°æ®ç»“æ„å¯¹ç»å…¸çš„ B+Tree è¿›è¡Œäº†ä¼˜åŒ–ã€‚åœ¨åŸ B+Tree çš„åŸºç¡€ä¸Šï¼Œå¢åŠ ä¸€ä¸ªæŒ‡å‘ç›¸é‚»å¶å­èŠ‚ç‚¹çš„é“¾è¡¨æŒ‡é’ˆï¼Œå°±å½¢æˆäº†å¸¦æœ‰é¡ºåºæŒ‡é’ˆçš„ B+Treeï¼Œæé«˜åŒºé—´è®¿é—®çš„æ€§èƒ½ã€‚</p><p><img src="http://cdn.leesin.fun/typora/s3/img/image-20230308224034350.png" alt="image-20230308224034350"></p><h3 id="5-2-5-Hash"><a href="#5-2-5-Hash" class="headerlink" title="5.2.5.Hash"></a>5.2.5.Hash</h3><p><img src="http://cdn.leesin.fun/typora/s3/img/image-20230308224658146.png" alt="image-20230308224658146"></p><blockquote><p>Hashç´¢å¼•ç‰¹ç‚¹ï¼š</p><ul><li>Hashç´¢å¼•åªèƒ½ç”¨äºå¯¹ç­‰æ¯”è¾ƒï¼ˆ=ã€inï¼‰ï¼Œä¸æ”¯æŒèŒƒå›´æŸ¥è¯¢ï¼ˆbetwwnã€&gt;ã€&lt;ã€â€¦ï¼‰</li><li>æ— æ³•åˆ©ç”¨ç´¢å¼•å®Œæˆæ’åºæ“ä½œ</li><li>æŸ¥è¯¢æ•ˆç‡é«˜ï¼Œé€šå¸¸åªéœ€è¦ä¸€æ¬¡æ£€ç´¢å°±å¯ä»¥äº†ï¼Œæ•ˆç‡é€šå¸¸è¦é«˜äº B+Tree ç´¢å¼•</li></ul><p>è§£å†³å“ˆå¸Œå†²çªçš„æ–¹å¼ä¸ºï¼šæ‹‰é“¾æ³•ã€‚</p><p>åœ¨MySQLä¸­ï¼Œæ”¯æŒhashç´¢å¼•çš„æ˜¯Memoryå¼•æ“ï¼Œè€ŒlnnoDBä¸­å…·æœ‰è‡ªé€‚åº”hashåŠŸèƒ½ï¼Œhashç´¢å¼•æ˜¯å­˜å‚¨å¼•æ“æ ¹æ®B+Treeç´¢å¼•åœ¨æŒ‡å®šæ¡ä»¶ä¸‹è‡ªåŠ¨æ„<br>å»ºçš„ã€‚</p></blockquote><h3 id="5-2-6-é¢è¯•é¢˜â­â­â­"><a href="#5-2-6-é¢è¯•é¢˜â­â­â­" class="headerlink" title="5.2.6.é¢è¯•é¢˜â­â­â­"></a>5.2.6.é¢è¯•é¢˜â­â­â­</h3><ol><li>ä¸ºä»€ä¹ˆ InnoDB å­˜å‚¨å¼•æ“é€‰æ‹©ä½¿ç”¨ B+Tree ç´¢å¼•ç»“æ„ï¼Ÿ</li></ol><ul><li>ç›¸å¯¹äºäºŒå‰æ ‘ï¼Œå±‚çº§æ›´å°‘ï¼Œæœç´¢æ•ˆç‡é«˜</li><li>å¯¹äº B-Treeï¼Œæ— è®ºæ˜¯å¶å­èŠ‚ç‚¹è¿˜æ˜¯éå¶å­èŠ‚ç‚¹ï¼Œéƒ½ä¼šä¿å­˜æ•°æ®ï¼Œè¿™æ ·å¯¼è‡´ä¸€é¡µä¸­å­˜å‚¨çš„é”®å€¼å‡å°‘ï¼ŒæŒ‡é’ˆä¹Ÿè·Ÿç€å‡å°‘ï¼Œè¦åŒæ ·ä¿å­˜å¤§é‡æ•°æ®ï¼Œåªèƒ½å¢åŠ æ ‘çš„é«˜åº¦ï¼Œå¯¼è‡´æ€§èƒ½é™ä½</li><li>ç›¸å¯¹äº Hash ç´¢å¼•ï¼ŒB+Tree æ”¯æŒèŒƒå›´åŒ¹é…åŠæ’åºæ“ä½œ</li></ul><h2 id="5-3-ç´¢å¼•åˆ†ç±»"><a href="#5-3-ç´¢å¼•åˆ†ç±»" class="headerlink" title="5.3.ç´¢å¼•åˆ†ç±»"></a>5.3.ç´¢å¼•åˆ†ç±»</h2><div class="table-container"><table><thead><tr><th>åˆ†ç±»</th><th style="text-align:left">å«ä¹‰</th><th>ç‰¹ç‚¹</th><th>å…³é”®å­—</th></tr></thead><tbody><tr><td>ä¸»é”®ç´¢å¼•</td><td style="text-align:left">é’ˆå¯¹äºè¡¨ä¸­ä¸»é”®åˆ›å»ºçš„ç´¢å¼•</td><td>é»˜è®¤è‡ªåŠ¨åˆ›å»ºï¼Œåªèƒ½æœ‰ä¸€ä¸ª</td><td>PRIMARY</td></tr><tr><td>å”¯ä¸€ç´¢å¼•</td><td style="text-align:left">é¿å…åŒä¸€ä¸ªè¡¨ä¸­æŸæ•°æ®åˆ—ä¸­çš„å€¼é‡å¤</td><td>å¯ä»¥æœ‰å¤šä¸ª</td><td>UNIQUE</td></tr><tr><td>å¸¸è§„ç´¢å¼•</td><td style="text-align:left">å¿«é€Ÿå®šä½ç‰¹å®šæ•°æ®</td><td>å¯ä»¥æœ‰å¤šä¸ª</td><td></td></tr><tr><td>å…¨æ–‡ç´¢å¼•</td><td style="text-align:left">å…¨æ–‡ç´¢å¼•æŸ¥æ‰¾çš„æ˜¯æ–‡æœ¬ä¸­çš„å…³é”®è¯ï¼Œè€Œä¸æ˜¯æ¯”è¾ƒç´¢å¼•ä¸­çš„å€¼</td><td>å¯ä»¥æœ‰å¤šä¸ª</td><td>FULLTEXT</td></tr></tbody></table></div><p>åœ¨ InnoDB å­˜å‚¨å¼•æ“ä¸­ï¼Œæ ¹æ®ç´¢å¼•çš„å­˜å‚¨å½¢å¼ï¼Œåˆå¯ä»¥åˆ†ä¸ºä»¥ä¸‹ä¸¤ç§ï¼š</p><div class="table-container"><table><thead><tr><th>åˆ†ç±»</th><th>å«ä¹‰</th><th>ç‰¹ç‚¹</th></tr></thead><tbody><tr><td>èšé›†ç´¢å¼•(Clustered Index)</td><td>å°†æ•°æ®å­˜å‚¨ä¸ç´¢å¼•æ”¾ä¸€å—ï¼Œç´¢å¼•ç»“æ„çš„å¶å­èŠ‚ç‚¹ä¿å­˜äº†è¡Œæ•°æ®</td><td>æœ‰ä¸”åªæœ‰ä¸€ä¸ª</td></tr><tr><td>äºŒçº§ç´¢å¼•(Secondary Index)</td><td>å°†æ•°æ®ä¸ç´¢å¼•åˆ†å¼€å­˜å‚¨ï¼Œç´¢å¼•ç»“æ„çš„å¶å­èŠ‚ç‚¹å…³è”çš„æ˜¯å¯¹åº”çš„ä¸»é”®</td><td>å¯ä»¥å­˜åœ¨å¤šä¸ª</td></tr></tbody></table></div><p>èšé›†ç´¢å¼•é€‰å–è§„åˆ™ï¼š</p><ul><li>å¦‚æœå­˜åœ¨ä¸»é”®ï¼Œä¸»é”®ç´¢å¼•å°±æ˜¯èšé›†ç´¢å¼•</li><li>å¦‚æœä¸å­˜åœ¨ä¸»é”®ï¼Œå°†ä½¿ç”¨ç¬¬ä¸€ä¸ªå”¯ä¸€(UNIQUE)ç´¢å¼•ä½œä¸ºèšé›†ç´¢å¼•</li><li>å¦‚æœè¡¨æ²¡æœ‰ä¸»é”®æˆ–æ²¡æœ‰åˆé€‚çš„å”¯ä¸€ç´¢å¼•ï¼Œåˆ™ InnoDB ä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ª rowid ä½œä¸ºéšè—çš„èšé›†ç´¢å¼•</li></ul><p><img src="http://cdn.leesin.fun/typora/s3/img/image-20230310105816240.png" alt="image-20230310105816240"></p><h5 id="å›è¡¨â­â­â­"><a href="#å›è¡¨â­â­â­" class="headerlink" title="å›è¡¨â­â­â­"></a>å›è¡¨â­â­â­</h5><p><img src="http://cdn.leesin.fun/typora/s3/img/image-20230310105825769.png" alt="image-20230310105825769"></p><h2 id="5-4-æ€è€ƒé¢˜"><a href="#5-4-æ€è€ƒé¢˜" class="headerlink" title="5.4.æ€è€ƒé¢˜"></a>5.4.æ€è€ƒé¢˜</h2><p>1. ä»¥ä¸‹ SQL è¯­å¥ï¼Œå“ªä¸ªæ‰§è¡Œæ•ˆç‡é«˜ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> <span class="keyword">user</span> <span class="keyword">where</span> id <span class="operator">=</span> <span class="number">10</span>;</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> <span class="keyword">user</span> <span class="keyword">where</span> name <span class="operator">=</span> <span class="string">&#x27;Arm&#x27;</span>;</span><br><span class="line"><span class="comment">-- å¤‡æ³¨ï¼šidä¸ºä¸»é”®ï¼Œnameå­—æ®µåˆ›å»ºçš„æœ‰ç´¢å¼•</span></span><br></pre></td></tr></table></figure><p>ç­”ï¼šç¬¬ä¸€æ¡è¯­å¥ï¼Œå› ä¸ºç¬¬äºŒæ¡éœ€è¦å›è¡¨æŸ¥è¯¢ï¼Œç›¸å½“äºä¸¤ä¸ªæ­¥éª¤ã€‚</p><p>2. InnoDB ä¸»é”®ç´¢å¼•çš„ B+Tree é«˜åº¦ä¸ºå¤šå°‘ï¼Ÿ</p><p>ç­”ï¼šå‡è®¾ä¸€è¡Œæ•°æ®å¤§å°ä¸º1kï¼Œä¸€é¡µä¸­å¯ä»¥å­˜å‚¨16è¡Œè¿™æ ·çš„æ•°æ®ã€‚InnoDB çš„æŒ‡é’ˆå ç”¨6ä¸ªå­—èŠ‚çš„ç©ºé—´ï¼Œä¸»é”®å‡è®¾ä¸ºbigintï¼Œå ç”¨å­—èŠ‚æ•°ä¸º8.<br>å¯å¾—å…¬å¼ï¼š<code>n * 8 + (n + 1) * 6 = 16 * 1024</code>ï¼Œå…¶ä¸­ 8 è¡¨ç¤º bigint å ç”¨çš„å­—èŠ‚æ•°ï¼Œn è¡¨ç¤ºå½“å‰èŠ‚ç‚¹å­˜å‚¨çš„keyçš„æ•°é‡ï¼Œ(n + 1) è¡¨ç¤ºæŒ‡é’ˆæ•°é‡ï¼ˆæ¯”keyå¤šä¸€ä¸ªï¼‰ã€‚ç®—å‡ºnçº¦ä¸º1170ã€‚</p><p>å¦‚æœæ ‘çš„é«˜åº¦ä¸º2ï¼Œé‚£ä¹ˆä»–èƒ½å­˜å‚¨çš„æ•°æ®é‡å¤§æ¦‚ä¸ºï¼š<code>1171 * 16 = 18736</code>ï¼›<br>å¦‚æœæ ‘çš„é«˜åº¦ä¸º3ï¼Œé‚£ä¹ˆä»–èƒ½å­˜å‚¨çš„æ•°æ®é‡å¤§æ¦‚ä¸ºï¼š<code>1171 * 1171 * 16 = 21939856</code>ã€‚</p><p>å¦å¤–ï¼Œå¦‚æœæœ‰æˆåƒä¸Šä¸‡çš„æ•°æ®ï¼Œé‚£ä¹ˆå°±è¦è€ƒè™‘åˆ†è¡¨ï¼Œæ¶‰åŠè¿ç»´ç¯‡çŸ¥è¯†ã€‚</p><h2 id="5-5-ç´¢å¼•è¯­æ³•"><a href="#5-5-ç´¢å¼•è¯­æ³•" class="headerlink" title="5.5.ç´¢å¼•è¯­æ³•"></a>5.5.ç´¢å¼•è¯­æ³•</h2><p>åˆ›å»ºç´¢å¼•<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> [ <span class="keyword">UNIQUE</span> <span class="operator">|</span> FULLTEXT ] INDEX index_name <span class="keyword">ON</span> table_name (index_col_name, ...);</span><br></pre></td></tr></table></figure></p><p>å¦‚æœä¸åŠ  CREATE åé¢ä¸åŠ ç´¢å¼•ç±»å‹å‚æ•°ï¼Œåˆ™åˆ›å»ºçš„æ˜¯å¸¸è§„ç´¢å¼•</p><p>æŸ¥çœ‹ç´¢å¼•</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SHOW</span> INDEX <span class="keyword">FROM</span> table_name;</span><br></pre></td></tr></table></figure><p>åˆ é™¤ç´¢å¼•</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> INDEX index_name <span class="keyword">ON</span> table_name;</span><br></pre></td></tr></table></figure><h2 id="5-6-ç´¢å¼•æ€§èƒ½åˆ†æ"><a href="#5-6-ç´¢å¼•æ€§èƒ½åˆ†æ" class="headerlink" title="5.6.ç´¢å¼•æ€§èƒ½åˆ†æ"></a>5.6.ç´¢å¼•æ€§èƒ½åˆ†æ</h2><h3 id="5-6-1-æŸ¥çœ‹æ‰§è¡Œé¢‘æ¬¡"><a href="#5-6-1-æŸ¥çœ‹æ‰§è¡Œé¢‘æ¬¡" class="headerlink" title="5.6.1.æŸ¥çœ‹æ‰§è¡Œé¢‘æ¬¡"></a>5.6.1.æŸ¥çœ‹æ‰§è¡Œé¢‘æ¬¡</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="keyword">global</span> status <span class="keyword">like</span> <span class="string">&#x27;Com_______&#x27;</span>;</span><br></pre></td></tr></table></figure><p><img src="http://cdn.leesin.fun/typora/s3/img/show global status like &#39;Com_______&#39;;.png" alt="show global status like &#39;Com_______&#39;;"></p><h3 id="5-6-2-æ…¢æŸ¥è¯¢æ—¥å¿—â­â­â­"><a href="#5-6-2-æ…¢æŸ¥è¯¢æ—¥å¿—â­â­â­" class="headerlink" title="5.6.2.æ…¢æŸ¥è¯¢æ—¥å¿—â­â­â­"></a>5.6.2.æ…¢æŸ¥è¯¢æ—¥å¿—â­â­â­</h3><p>æ…¢æŸ¥è¯¢æ—¥å¿—è®°å½•äº†æ‰€æœ‰æ‰§è¡Œæ—¶é—´è¶…è¿‡æŒ‡å®šå‚æ•° ï¼ˆlong_query_timeï¼Œå•ä½: ç§’ï¼Œé»˜è®¤10ç§’ï¼‰çš„æ‰€æœ‰SQLè¯­å¥çš„æ—¥å¿—ã€‚</p><p>MySQLçš„æ…¢æŸ¥è¯¢æ—¥å¿—é»˜è®¤æ²¡æœ‰å¼€å¯çš„ï¼ŒæŸ¥çœ‹æ˜¯å¦å¼€å¯çš„å‘½ä»¤å¦‚ä¸‹ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">show</span> variables <span class="keyword">like</span> <span class="string">&#x27;slow_query_log&#x27;</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">----------------+-------+</span></span><br><span class="line"><span class="operator">|</span> Variable_name  <span class="operator">|</span> <span class="keyword">Value</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------------+-------+</span></span><br><span class="line"><span class="operator">|</span> slow_query_log <span class="operator">|</span> OFF   <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------------+-------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span>, <span class="number">1</span> warning (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><p>éœ€è¦åœ¨MySQLçš„é…ç½®æ–‡ä»¶ ï¼ˆ/etc/my.cnfï¼‰ä¸­é…ç½®å¦‚ä¸‹ä¿¡æ¯:</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># å¼€å¯MySQLæ…¢æ—¥å¿—æŸ¥è¯¢å¼€å…³</span><br><span class="line">slow_query_log<span class="operator">=</span><span class="number">1</span></span><br><span class="line"># è®¾ç½®æ…¢æ—¥å¿—çš„æ—¶é—´ä¸º<span class="number">2</span>ç§’ï¼Œ<span class="keyword">SQL</span>è¯­å¥æ‰§è¡Œæ—¶é—´è¶…è¿‡<span class="number">2</span>ç§’ï¼Œå°±ä¼šè§†ä¸ºæ…¢æŸ¥è¯¢ï¼Œè®°å½•æ…¢æŸ¥è¯¢æ—¥å¿—</span><br><span class="line">long_query_time<span class="operator">=</span><span class="number">2</span></span><br></pre></td></tr></table></figure><p>é…ç½®å®Œæ¯•ä¹‹åï¼Œé‡æ–°å¯åŠ¨MySQLæœåŠ¡å™¨</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart mysqld</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹æ…¢æ—¥å¿—æ–‡ä»¶ä¸­è®°å½•çš„ä¿¡æ¯</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è¿›å…¥æ…¢æŸ¥è¯¢æ—¥å¿—æ‰€åœ¨çš„ç›®å½•</span></span><br><span class="line"><span class="built_in">cd</span> /var/lib/mysql</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹æœ‰ä»€ä¹ˆæ–‡ä»¶ï¼Œå…¶ä¸­æ…¢æŸ¥è¯¢æ—¥å¿—æ–‡ä»¶æ˜¯xxx-slow.log</span></span><br><span class="line">ll</span><br><span class="line"></span><br><span class="line">[root@itachi102 mysql]<span class="comment"># cat itachi102-slow.log </span></span><br><span class="line">/usr/sbin/mysqld, Version: 8.0.25 (MySQL Community Server - GPL). started with:</span><br><span class="line">Tcp port: 3306  Unix socket: /var/lib/mysql/mysql.sock</span><br><span class="line">Time                 Id Command    Argument</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œæ…¢æŸ¥è¯¢æ—¥å¿—ä¸ä¼šè®°å½•ç®¡ç†è¯­å¥ï¼Œä¹Ÿä¸ä¼šè®°å½•ä¸ä½¿ç”¨ç´¢å¼•è¿›è¡ŒæŸ¥æ‰¾çš„æŸ¥è¯¢ã€‚éœ€è¦åœ¨MySQLçš„é…ç½®æ–‡ä»¶ ï¼ˆ/etc/my.cnfï¼‰ä¸­é…ç½®å¦‚ä¸‹ä¿¡æ¯æ¥æ›´æ”¹æ­¤è¡Œä¸ºï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#è®°å½•æ‰§è¡Œè¾ƒæ…¢çš„ç®¡ç†è¯­å¥</span></span><br><span class="line">log_slow_admin_statements=1</span><br><span class="line"><span class="comment">#è®°å½•æ‰§è¡Œè¾ƒæ…¢çš„æœªä½¿ç”¨ç´¢å¼•çš„è¯­å¥</span></span><br><span class="line">log_queries_not_using_indexes=1</span><br></pre></td></tr></table></figure><h3 id="5-6-3-profileæ“ä½œ"><a href="#5-6-3-profileæ“ä½œ" class="headerlink" title="5.6.3.profileæ“ä½œ"></a>5.6.3.profileæ“ä½œ</h3><blockquote><p>show profiles èƒ½å¤Ÿåœ¨åšSQLä¼˜åŒ–æ—¶å¸®åŠ©æˆ‘ä»¬äº†è§£æ—¶é—´éƒ½è€—è´¹åˆ°å“ªé‡Œå»äº†ã€‚</p></blockquote><p>æŸ¥çœ‹å½“å‰MySQLæ˜¯å¦æ”¯æŒprofileæ“ä½œ</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> @<span class="variable">@have</span>_profiling;</span><br><span class="line"><span class="operator">+</span><span class="comment">------------------+</span></span><br><span class="line"><span class="operator">|</span> @<span class="variable">@have</span>_profiling <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------------------+</span></span><br><span class="line"><span class="operator">|</span> YES              <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------------------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span>, <span class="number">1</span> warning (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><p>é»˜è®¤profilingæ˜¯å…³é—­çš„ï¼Œå¯ä»¥é€šè¿‡setè¯­å¥åœ¨session/globalçº§åˆ«å¼€å¯profiling</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"># æŸ¥çœ‹profilingçš„å¼€å…³çŠ¶æ€ï¼Œ<span class="number">0</span>è¡¨ç¤ºå…³é—­ï¼Œ<span class="number">1</span>è¡¨ç¤ºå¼€å¯</span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> @<span class="variable">@profiling</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">-------------+</span></span><br><span class="line"><span class="operator">|</span> @<span class="variable">@profiling</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------------+</span></span><br><span class="line"><span class="operator">|</span>           <span class="number">0</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span>, <span class="number">1</span> warning (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line"># å°†profilingå¼€å¯</span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">set</span> profiling <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected, <span class="number">1</span> warning (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line"># æŸ¥çœ‹æ˜¯å¦å°†profilingæˆåŠŸå¼€å¯</span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> @<span class="variable">@profiling</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">-------------+</span></span><br><span class="line"><span class="operator">|</span> @<span class="variable">@profiling</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------------+</span></span><br><span class="line"><span class="operator">|</span>           <span class="number">1</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span>, <span class="number">1</span> warning (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æ‰§è¡Œæµ‹è¯•çš„sqlè¯­å¥åï¼Œä½¿ç”¨profileæŸ¥çœ‹æ€§èƒ½</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">#æŸ¥çœ‹æ¯ä¸€æ¡<span class="keyword">SQL</span>çš„è€—æ—¶åŸºæœ¬æƒ…å†µ</span><br><span class="line"><span class="keyword">show</span> profiles;</span><br><span class="line"></span><br><span class="line">#æŸ¥çœ‹æŒ‡å®šquery_idçš„<span class="keyword">SQL</span>è¯­å¥å„ä¸ªé˜¶æ®µçš„è€—æ—¶æƒ…å†µ</span><br><span class="line"><span class="keyword">show</span> profile <span class="keyword">for</span> query query_id;</span><br><span class="line"></span><br><span class="line">#æŸ¥çœ‹æŒ‡å®šquery_idçš„<span class="keyword">SQL</span>è¯­å¥CPUçš„ä½¿ç”¨æƒ…å†µ</span><br><span class="line"><span class="keyword">show</span> profile cpu <span class="keyword">for</span> query query_id;</span><br></pre></td></tr></table></figure><h3 id="5-6-4-explainæ‰§è¡Œè®¡åˆ’"><a href="#5-6-4-explainæ‰§è¡Œè®¡åˆ’" class="headerlink" title="5.6.4.explainæ‰§è¡Œè®¡åˆ’"></a>5.6.4.explainæ‰§è¡Œè®¡åˆ’</h3><blockquote><p>EXPLAIN æˆ–è€… DESCå‘½ä»¤è·å– MySQL å¦‚ä½•æ‰§è¡Œ SELECT è¯­å¥çš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬åœ¨ SELECT è¯­å¥æ‰§è¡Œè¿‡ç¨‹ä¸­è¡¨å¦‚ä½•è¿æ¥å’Œè¿æ¥çš„é¡ºåºã€‚</p></blockquote><p>è¯­æ³•ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># ç›´æ¥åœ¨<span class="keyword">select</span>è¯­å¥ä¹‹å‰åŠ ä¸Šå…³é”®å­—explainæˆ–<span class="keyword">desc</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>EXPLAIN å„å­—æ®µå«ä¹‰ï¼š</p><ul><li>idï¼šselect æŸ¥è¯¢çš„åºåˆ—å·ï¼Œè¡¨ç¤ºæŸ¥è¯¢ä¸­æ‰§è¡Œ select å­å¥æˆ–è€…æ“ä½œè¡¨çš„é¡ºåºï¼ˆidç›¸åŒï¼Œæ‰§è¡Œé¡ºåºä»ä¸Šåˆ°ä¸‹ï¼›idä¸åŒï¼Œå€¼è¶Šå¤§è¶Šå…ˆæ‰§è¡Œï¼‰</li><li>select_typeï¼šè¡¨ç¤º SELECT çš„ç±»å‹ï¼Œå¸¸è§å–å€¼æœ‰ SIMPLEï¼ˆç®€å•è¡¨ï¼Œå³ä¸é€‚ç”¨è¡¨è¿æ¥æˆ–è€…å­æŸ¥è¯¢ï¼‰ã€PRIMARYï¼ˆä¸»æŸ¥è¯¢ï¼Œå³å¤–å±‚çš„æŸ¥è¯¢ï¼‰ã€UNIONï¼ˆUNIONä¸­çš„ç¬¬äºŒä¸ªæˆ–è€…åé¢çš„æŸ¥è¯¢è¯­å¥ï¼‰ã€SUBQUERYï¼ˆSELECT/WHEREä¹‹ååŒ…å«äº†å­æŸ¥è¯¢ï¼‰ç­‰</li><li>typeï¼šè¡¨ç¤ºè¿æ¥ç±»å‹ï¼Œæ€§èƒ½ç”±å¥½åˆ°å·®çš„è¿æ¥ç±»å‹ä¸º NULLã€systemã€constã€eq_refã€refã€rangeã€indexã€all</li><li>possible_keyï¼šå¯èƒ½åº”ç”¨åœ¨è¿™å¼ è¡¨ä¸Šçš„ç´¢å¼•ï¼Œä¸€ä¸ªæˆ–å¤šä¸ª</li><li>Keyï¼šå®é™…ä½¿ç”¨çš„ç´¢å¼•ï¼Œå¦‚æœä¸º NULLï¼Œåˆ™æ²¡æœ‰ä½¿ç”¨ç´¢å¼•</li><li>Key_lenï¼šè¡¨ç¤ºç´¢å¼•ä¸­ä½¿ç”¨çš„å­—èŠ‚æ•°ï¼Œè¯¥å€¼ä¸ºç´¢å¼•å­—æ®µæœ€å¤§å¯èƒ½é•¿åº¦ï¼Œå¹¶éå®é™…ä½¿ç”¨é•¿åº¦ï¼Œåœ¨ä¸æŸå¤±ç²¾ç¡®æ€§çš„å‰æä¸‹ï¼Œé•¿åº¦è¶ŠçŸ­è¶Šå¥½</li><li>rowsï¼šMySQLè®¤ä¸ºå¿…é¡»è¦æ‰§è¡Œçš„è¡Œæ•°ï¼Œåœ¨InnoDBå¼•æ“çš„è¡¨ä¸­ï¼Œæ˜¯ä¸€ä¸ªä¼°è®¡å€¼ï¼Œå¯èƒ½å¹¶ä¸æ€»æ˜¯å‡†ç¡®çš„</li><li>filteredï¼šè¡¨ç¤ºè¿”å›ç»“æœçš„è¡Œæ•°å éœ€è¯»å–è¡Œæ•°çš„ç™¾åˆ†æ¯”ï¼Œfilteredçš„å€¼è¶Šå¤§è¶Šå¥½</li></ul><h2 id="5-7-ç´¢å¼•ä½¿ç”¨è§„åˆ™"><a href="#5-7-ç´¢å¼•ä½¿ç”¨è§„åˆ™" class="headerlink" title="5.7.ç´¢å¼•ä½¿ç”¨è§„åˆ™"></a>5.7.ç´¢å¼•ä½¿ç”¨è§„åˆ™</h2><h3 id="5-7-1-æœ€å·¦å‰ç¼€æ³•åˆ™â­â­â­"><a href="#5-7-1-æœ€å·¦å‰ç¼€æ³•åˆ™â­â­â­" class="headerlink" title="5.7.1.æœ€å·¦å‰ç¼€æ³•åˆ™â­â­â­"></a>5.7.1.æœ€å·¦å‰ç¼€æ³•åˆ™â­â­â­</h3><ul><li>å¦‚æœç´¢å¼•å…³è”äº†å¤šåˆ—ï¼ˆè”åˆç´¢å¼•ï¼‰ï¼Œè¦éµå®ˆæœ€å·¦å‰ç¼€æ³•åˆ™ï¼Œæœ€å·¦å‰ç¼€æ³•åˆ™æŒ‡çš„æ˜¯æŸ¥è¯¢ä»ç´¢å¼•çš„æœ€å·¦åˆ—å¼€å§‹ï¼Œå¹¶ä¸”ä¸è·³è¿‡ç´¢å¼•ä¸­çš„åˆ—ã€‚</li><li>å¦‚æœè·³è·ƒæŸä¸€åˆ—ï¼Œç´¢å¼•å°†éƒ¨åˆ†å¤±æ•ˆï¼ˆåé¢çš„å­—æ®µç´¢å¼•å¤±æ•ˆï¼‰ã€‚</li><li>è”åˆç´¢å¼•ä¸­ï¼Œå‡ºç°èŒƒå›´æŸ¥è¯¢ï¼ˆ&lt;, &gt;ï¼‰ï¼ŒèŒƒå›´æŸ¥è¯¢å³ä¾§çš„åˆ—ç´¢å¼•å¤±æ•ˆã€‚å¯ä»¥ç”¨&gt;=æˆ–è€…&lt;=æ¥è§„é¿ç´¢å¼•å¤±æ•ˆé—®é¢˜ã€‚</li></ul><h3 id="5-7-2-ç´¢å¼•å¤±æ•ˆæƒ…å†µâ­â­â­"><a href="#5-7-2-ç´¢å¼•å¤±æ•ˆæƒ…å†µâ­â­â­" class="headerlink" title="5.7.2.ç´¢å¼•å¤±æ•ˆæƒ…å†µâ­â­â­"></a>5.7.2.ç´¢å¼•å¤±æ•ˆæƒ…å†µâ­â­â­</h3><ol><li>åœ¨ç´¢å¼•åˆ—ä¸Š<strong>è¿›è¡Œè¿ç®—æ“ä½œ</strong>ï¼Œç´¢å¼•å°†å¤±æ•ˆã€‚å¦‚ï¼š<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># å…¶ä¸­ phone å­—æ®µæœ‰ç´¢å¼•</span><br><span class="line">explain <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> tb_user <span class="keyword">where</span> <span class="built_in">substring</span>(phone, <span class="number">10</span>, <span class="number">2</span>) <span class="operator">=</span> <span class="string">&#x27;15&#x27;</span>;</span><br></pre></td></tr></table></figure></li><li>å­—ç¬¦ä¸²ç±»å‹å­—æ®µä½¿ç”¨æ—¶ï¼Œä¸åŠ å¼•å·ï¼Œç´¢å¼•å°†å¤±æ•ˆã€‚å¦‚ï¼š<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># phone å­—æ®µæ˜¯å­—ç¬¦ä¸²ç±»å‹å­—æ®µï¼Œä¸”æ­¤å¤„æ²¡ç”¨ä½¿ç”¨å¼•å·åŒ…è£¹èµ·æ¥ï¼Œç´¢å¼•å°†å¤±æ•ˆï¼Œå› ä¸ºä¼šç±»å‹è½¬æ¢</span><br><span class="line">explain <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> tb_user <span class="keyword">where</span> phone <span class="operator">=</span> <span class="number">17799990015</span>;</span><br></pre></td></tr></table></figure></li><li>æ¨¡ç³ŠæŸ¥è¯¢ä¸­ï¼Œå¦‚æœä»…ä»…æ˜¯å°¾éƒ¨æ¨¡ç³ŠåŒ¹é…ï¼Œç´¢å¼•ä¸ä¼šæ˜¯å¤±æ•ˆï¼›å¦‚æœæ˜¯<strong>å¤´éƒ¨æ¨¡ç³ŠåŒ¹é…</strong>ï¼Œç´¢å¼•å¤±æ•ˆã€‚å¦‚ï¼š<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># ç´¢å¼•å¤±æ•ˆä¸¾ä¾‹</span><br><span class="line">explain <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> tb_user <span class="keyword">where</span> profession <span class="keyword">like</span> <span class="string">&#x27;%å·¥ç¨‹&#x27;</span>;</span><br><span class="line"></span><br><span class="line"># å¦‚æœæ˜¯å¤´éƒ¨æ²¡æœ‰ç”¨æ¨¡ç³ŠåŒ¹é…ï¼Œåˆ™ä¸ä¼šå¤±æ•ˆ</span><br><span class="line">explain <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> tb_user <span class="keyword">where</span> profession <span class="keyword">like</span> <span class="string">&#x27;è½¯ä»¶%&#x27;</span>;</span><br></pre></td></tr></table></figure></li><li>ç”¨ or åˆ†å‰²å¼€çš„æ¡ä»¶ï¼Œ<strong>å¦‚æœ or å…¶ä¸­ä¸€ä¸ªæ¡ä»¶çš„åˆ—æ²¡æœ‰ç´¢å¼•</strong>ï¼Œé‚£ä¹ˆæ¶‰åŠçš„ç´¢å¼•éƒ½ä¸ä¼šè¢«ç”¨åˆ°ã€‚</li><li><strong>å¦‚æœ MySQL è¯„ä¼°ä½¿ç”¨ç´¢å¼•æ¯”å…¨è¡¨æ›´æ…¢</strong>ï¼Œåˆ™ä¸ä½¿ç”¨ç´¢å¼•ã€‚</li></ol><h3 id="5-7-3-SQL-æç¤º"><a href="#5-7-3-SQL-æç¤º" class="headerlink" title="5.7.3.SQL æç¤º"></a>5.7.3.SQL æç¤º</h3><p>æ˜¯ä¼˜åŒ–æ•°æ®åº“çš„ä¸€ä¸ªé‡è¦æ‰‹æ®µï¼Œç®€å•æ¥è¯´ï¼Œå°±æ˜¯åœ¨SQLè¯­å¥ä¸­åŠ å…¥ä¸€äº›äººä¸ºçš„æç¤ºæ¥è¾¾åˆ°ä¼˜åŒ–æ“ä½œçš„ç›®çš„ã€‚</p><p>ä¾‹å¦‚ï¼Œä½¿ç”¨ç´¢å¼•ï¼š<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explain <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> tb_user use index(idx_user_pro) <span class="keyword">where</span> profession<span class="operator">=</span>&quot;è½¯ä»¶å·¥ç¨‹&quot;;</span><br></pre></td></tr></table></figure><br>ä¸ä½¿ç”¨å“ªä¸ªç´¢å¼•ï¼š<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explain <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> tb_user ignore index(idx_user_pro) <span class="keyword">where</span> profession<span class="operator">=</span>&quot;è½¯ä»¶å·¥ç¨‹&quot;;</span><br></pre></td></tr></table></figure><br>å¿…é¡»ä½¿ç”¨å“ªä¸ªç´¢å¼•ï¼š<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explain <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> tb_user force index(idx_user_pro) <span class="keyword">where</span> profession<span class="operator">=</span>&quot;è½¯ä»¶å·¥ç¨‹&quot;;</span><br></pre></td></tr></table></figure></p><blockquote><ul><li><p>use æ˜¯å»ºè®®ï¼Œå®é™…ä½¿ç”¨å“ªä¸ªç´¢å¼• MySQL è¿˜ä¼šè‡ªå·±æƒè¡¡è¿è¡Œé€Ÿåº¦å»æ›´æ”¹</p></li><li><p>forceå°±æ˜¯æ— è®ºå¦‚ä½•éƒ½å¼ºåˆ¶ä½¿ç”¨è¯¥ç´¢å¼•ã€‚</p></li></ul></blockquote><h3 id="5-7-4-è¦†ç›–ç´¢å¼•-amp-å›è¡¨æŸ¥è¯¢â­â­â­"><a href="#5-7-4-è¦†ç›–ç´¢å¼•-amp-å›è¡¨æŸ¥è¯¢â­â­â­" class="headerlink" title="5.7.4.è¦†ç›–ç´¢å¼•&amp;å›è¡¨æŸ¥è¯¢â­â­â­"></a>5.7.4.è¦†ç›–ç´¢å¼•&amp;å›è¡¨æŸ¥è¯¢â­â­â­</h3><p>å°½é‡ä½¿ç”¨è¦†ç›–ç´¢å¼•ï¼ˆæŸ¥è¯¢ä½¿ç”¨äº†ç´¢å¼•ï¼Œå¹¶ä¸”éœ€è¦è¿”å›çš„åˆ—ï¼Œåœ¨è¯¥ç´¢å¼•ä¸­å·²ç»å…¨éƒ¨èƒ½æ‰¾åˆ°ï¼‰ï¼Œå‡å°‘ select *ã€‚</p><blockquote><p><strong>explain ä¸­ extra å­—æ®µå«ä¹‰</strong><br><code>using index condition</code>ï¼šæŸ¥æ‰¾ä½¿ç”¨äº†ç´¢å¼•ï¼Œä½†æ˜¯éœ€è¦å›è¡¨æŸ¥è¯¢æ•°æ®<br><code>using where; using index;</code>ï¼šæŸ¥æ‰¾ä½¿ç”¨äº†ç´¢å¼•ï¼Œä½†æ˜¯éœ€è¦çš„æ•°æ®éƒ½åœ¨ç´¢å¼•åˆ—ä¸­èƒ½æ‰¾åˆ°ï¼Œæ‰€ä»¥ä¸éœ€è¦å›è¡¨æŸ¥è¯¢</p></blockquote><p><img src="http://cdn.leesin.fun/typora/s3/img/è¦†ç›–ç´¢å¼•-16785139464682.png" alt="è¦†ç›–ç´¢å¼•"></p><p>åœ¨ä¸Šå›¾ä¸­ï¼Œidä¸ºä¸»é”®ä¸”æœ‰èšé›†ç´¢å¼•ï¼Œnameæœ‰äºŒçº§ç´¢å¼•ã€‚</p><p>â‘ å·sqlè¯­å¥ä½¿ç”¨èšé›†ç´¢å¼•ï¼Œåªéœ€è¦èµ°ä¸€æ¬¡ç´¢å¼•ï¼Œæ•ˆç‡é«˜ã€‚</p><p>â‘¡å·sqlè¯­å¥è™½ç„¶ä½¿ç”¨nameå­—æ®µçš„äºŒçº§ç´¢å¼•ï¼Œä½†æ˜¯ä»–åªéœ€è¦ id å­—æ®µå’Œ name å­—æ®µï¼Œä¹Ÿåªéœ€è¦èµ°ä¸€æ¬¡äºŒçº§ç´¢å¼•å°±OKï¼Œæ•ˆç‡é«˜ã€‚</p><p>â‘¢å·sqlè¯­å¥ä½¿ç”¨nameå­—æ®µçš„äºŒçº§ç´¢å¼•ï¼Œä¸”éœ€è¦çš„å­—æ®µé™¤äº† idï¼Œname å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ª gender å­—æ®µï¼Œå¦‚æœåªèµ°ä¸€æ¬¡äºŒçº§ç´¢å¼•æ— æ³•æ‰¾åˆ° gender å­—æ®µï¼Œæ‰€ä»¥åªèƒ½æ ¹æ® æŸ¥æ‰¾åˆ°çš„ id å­—æ®µï¼Œå›è¡¨æŸ¥è¯¢ï¼Œå†èµ°ä¸€æ¬¡èšé›†ç´¢å¼•ï¼Œæ‰èƒ½æ‰¾åˆ° gender å­—æ®µï¼Œæ•ˆç‡ç›¸å¯¹è¾ƒä½ã€‚</p><p>æ‰€ä»¥å°½é‡ä¸è¦ç”¨<code>select *</code>ï¼Œå®¹æ˜“å‡ºç°å›è¡¨æŸ¥è¯¢ï¼Œé™ä½æ•ˆç‡ï¼Œé™¤éæœ‰è”åˆç´¢å¼•åŒ…å«äº†æ‰€æœ‰å­—æ®µ</p><h5 id="é¢è¯•é¢˜â­â­â­"><a href="#é¢è¯•é¢˜â­â­â­" class="headerlink" title="é¢è¯•é¢˜â­â­â­"></a>é¢è¯•é¢˜â­â­â­</h5><ol><li>ä¸€å¼ è¡¨ï¼Œæœ‰å››ä¸ªå­—æ®µï¼ˆid, username, password, statusï¼‰ï¼Œç”±äºæ•°æ®é‡å¤§ï¼Œéœ€è¦å¯¹ä»¥ä¸‹SQLè¯­å¥è¿›è¡Œä¼˜åŒ–ï¼Œè¯¥å¦‚ä½•è¿›è¡Œæ‰æ˜¯æœ€ä¼˜æ–¹æ¡ˆï¼š<br><code>select id, username, password from tb_user where username=&#39;itcast&#39;;</code></li></ol><blockquote><p>è§£ï¼šç»™usernameå’Œpasswordå­—æ®µå»ºç«‹è”åˆç´¢å¼•ï¼Œåˆ™ä¸éœ€è¦å›è¡¨æŸ¥è¯¢ï¼Œç›´æ¥è¦†ç›–ç´¢å¼•</p></blockquote><ol><li>ä¸ºä»€ä¹ˆå°½é‡ä¸è¦ç”¨select *</li></ol><blockquote><p>ç­”ï¼šé¿å…å›è¡¨æ“ä½œ</p></blockquote><h3 id="5-7-5-å‰ç¼€ç´¢å¼•"><a href="#5-7-5-å‰ç¼€ç´¢å¼•" class="headerlink" title="5.7.5.å‰ç¼€ç´¢å¼•"></a>5.7.5.å‰ç¼€ç´¢å¼•</h3><p>å½“å­—æ®µç±»å‹ä¸ºå­—ç¬¦ä¸²(varcharï¼Œtextç­‰)æ—¶ï¼Œæœ‰æ—¶å€™éœ€è¦ç´¢å¼•å¾ˆé•¿çš„å­—ç¬¦ä¸²ï¼Œè¿™ä¼šè®©ç´¢å¼•å˜å¾—å¾ˆå¤§ï¼ŒæŸ¥è¯¢æ—¶ï¼Œæµªè´¹å¤§é‡çš„ç£ç›˜IOï¼Œå½±å“æŸ¥è¯¢æ•ˆç‡ã€‚æ­¤æ—¶å¯ä»¥åªå°†å­—ç¬¦ä¸²çš„ä¸€éƒ¨åˆ†å‰ç¼€ï¼Œå»ºç«‹ç´¢å¼•ï¼Œè¿™æ ·å¯ä»¥å¤§å¤§èŠ‚çº¦ç´¢å¼•ç©ºé—´ï¼Œä»è€Œæé«˜ç´¢å¼•æ•ˆç‡ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> index idx_xxxx <span class="keyword">on</span> table_name(columnn(n));</span><br></pre></td></tr></table></figure><p>å‰ç¼€é•¿åº¦ï¼šå¯ä»¥æ ¹æ®ç´¢å¼•çš„é€‰æ‹©æ€§æ¥å†³å®šï¼Œè€Œé€‰æ‹©æ€§æ˜¯æŒ‡ä¸é‡å¤çš„ç´¢å¼•å€¼ï¼ˆåŸºæ•°ï¼‰å’Œæ•°æ®è¡¨çš„è®°å½•æ€»æ•°çš„æ¯”å€¼ï¼Œç´¢å¼•é€‰æ‹©æ€§è¶Šé«˜åˆ™æŸ¥è¯¢æ•ˆç‡è¶Šé«˜ï¼Œå”¯ä¸€ç´¢å¼•çš„é€‰æ‹©æ€§æ˜¯1ï¼Œè¿™æ˜¯æœ€å¥½çš„ç´¢å¼•é€‰æ‹©æ€§ï¼Œæ€§èƒ½ä¹Ÿæ˜¯æœ€å¥½çš„ã€‚<br>æ±‚é€‰æ‹©æ€§å…¬å¼ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="built_in">count</span>(<span class="keyword">distinct</span> email) <span class="operator">/</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">from</span> tb_user;</span><br><span class="line"><span class="keyword">select</span> <span class="built_in">count</span>(<span class="keyword">distinct</span> <span class="built_in">substring</span>(email, <span class="number">1</span>, <span class="number">5</span>)) <span class="operator">/</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">from</span> tb_user;</span><br></pre></td></tr></table></figure><p>show index é‡Œé¢çš„sub_partå¯ä»¥çœ‹åˆ°æ¥å–çš„é•¿åº¦ã€‚</p><p><img src="http://cdn.leesin.fun/typora/s3/img/å‰ç¼€ç´¢å¼•.png" alt="å‰ç¼€ç´¢å¼•"></p><h3 id="5-7-6-è®¾è®¡åŸåˆ™"><a href="#5-7-6-è®¾è®¡åŸåˆ™" class="headerlink" title="5.7.6.è®¾è®¡åŸåˆ™"></a>5.7.6.è®¾è®¡åŸåˆ™</h3><ol><li>é’ˆå¯¹äºæ•°æ®é‡è¾ƒå¤§ï¼Œä¸”æŸ¥è¯¢æ¯”è¾ƒé¢‘ç¹çš„è¡¨å»ºç«‹ç´¢å¼•</li><li>é’ˆå¯¹äºå¸¸ä½œä¸ºæŸ¥è¯¢æ¡ä»¶ï¼ˆwhereï¼‰ã€æ’åºï¼ˆorder byï¼‰ã€åˆ†ç»„ï¼ˆgroup byï¼‰æ“ä½œçš„å­—æ®µå»ºç«‹ç´¢å¼•</li><li>å°½é‡é€‰æ‹©åŒºåˆ†åº¦é«˜çš„åˆ—ä½œä¸ºç´¢å¼•ï¼Œå°½é‡å»ºç«‹å”¯ä¸€ç´¢å¼•ï¼ŒåŒºåˆ†åº¦è¶Šé«˜ï¼Œä½¿ç”¨ç´¢å¼•çš„æ•ˆç‡è¶Šé«˜</li><li>å¦‚æœæ˜¯å­—ç¬¦ä¸²ç±»å‹çš„å­—æ®µï¼Œå­—æ®µé•¿åº¦è¾ƒé•¿ï¼Œå¯ä»¥é’ˆå¯¹äºå­—æ®µçš„ç‰¹ç‚¹ï¼Œå»ºç«‹å‰ç¼€ç´¢å¼•</li><li>å°½é‡ä½¿ç”¨è”åˆç´¢å¼•ï¼Œå‡å°‘å•åˆ—ç´¢å¼•ï¼ŒæŸ¥è¯¢æ—¶ï¼Œè”åˆç´¢å¼•å¾ˆå¤šæ—¶å€™å¯ä»¥è¦†ç›–ç´¢å¼•ï¼ŒèŠ‚çœå­˜å‚¨ç©ºé—´ï¼Œé¿å…å›è¡¨ï¼Œæé«˜æŸ¥è¯¢æ•ˆç‡</li><li>è¦æ§åˆ¶ç´¢å¼•çš„æ•°é‡ï¼Œç´¢å¼•å¹¶ä¸æ˜¯å¤šå¤šç›Šå–„ï¼Œç´¢å¼•è¶Šå¤šï¼Œç»´æŠ¤ç´¢å¼•ç»“æ„çš„ä»£ä»·å°±è¶Šå¤§ï¼Œä¼šå½±å“å¢åˆ æ”¹çš„æ•ˆç‡</li><li>å¦‚æœç´¢å¼•åˆ—ä¸èƒ½å­˜å‚¨NULLå€¼ï¼Œè¯·åœ¨åˆ›å»ºè¡¨æ—¶ä½¿ç”¨NOT NULLçº¦æŸå®ƒã€‚å½“ä¼˜åŒ–å™¨çŸ¥é“æ¯åˆ—æ˜¯å¦åŒ…å«NULLå€¼æ—¶ï¼Œå®ƒå¯ä»¥æ›´å¥½åœ°ç¡®å®šå“ªä¸ªç´¢å¼•æœ€æœ‰æ•ˆåœ°ç”¨äºæŸ¥è¯¢</li></ol><h1 id="6-SQLä¼˜åŒ–"><a href="#6-SQLä¼˜åŒ–" class="headerlink" title="6.SQLä¼˜åŒ–"></a>6.SQLä¼˜åŒ–</h1><h2 id="6-1-æ’å…¥æ•°æ®"><a href="#6-1-æ’å…¥æ•°æ®" class="headerlink" title="6.1.æ’å…¥æ•°æ®"></a>6.1.æ’å…¥æ•°æ®</h2><p><code>insert</code> ä¼˜åŒ–</p><ul><li>æ‰¹é‡æ’å…¥</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> tb_test <span class="keyword">values</span>(<span class="number">1</span>,<span class="string">&#x27;Tom&#x27;</span>),(<span class="number">2</span>,<span class="string">&#x27;Cat&#x27;</span>),(<span class="number">3</span>, <span class="string">&#x27;Jerry&#x27;</span>);</span><br></pre></td></tr></table></figure><ul><li>æ‰‹åŠ¨æäº¤äº‹åŠ¡</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">start</span> transaction;</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> tb_test <span class="keyword">values</span>(<span class="number">1</span>,<span class="string">&#x27;Tom&#x27;</span>),(<span class="number">2</span>,<span class="string">&#x27;Cat&#x27;</span>),(<span class="number">3</span>, <span class="string">&#x27;Jerry&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> tb_test <span class="keyword">values</span>(<span class="number">4</span>,<span class="string">&#x27;Tom&#x27;</span>),(<span class="number">5</span>,<span class="string">&#x27;Cat&#x27;</span>),(<span class="number">6</span>, <span class="string">&#x27;Jerry&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> tb_test <span class="keyword">values</span>(<span class="number">7</span>,<span class="string">&#x27;Tom&#x27;</span>),(<span class="number">8</span>,<span class="string">&#x27;Cat&#x27;</span>),(<span class="number">9</span>, <span class="string">&#x27;Jerry&#x27;</span>);</span><br><span class="line"><span class="keyword">commit</span>;</span><br></pre></td></tr></table></figure><ul><li>ä¸»é”®é¡ºåºæ’å…¥</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ä¸»é”®ä¹±åºæ’å…¥ : <span class="number">8</span> <span class="number">1</span> <span class="number">9</span> <span class="number">21</span> <span class="number">88</span> <span class="number">2</span> <span class="number">4</span> <span class="number">15</span> <span class="number">89</span> <span class="number">5</span> <span class="number">7</span> <span class="number">3</span></span><br><span class="line">ä¸»é”®é¡ºåºæ’å…¥ : <span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">4</span> <span class="number">5</span> <span class="number">7</span> <span class="number">8</span> <span class="number">9</span> <span class="number">15</span> <span class="number">21</span> <span class="number">88</span> <span class="number">89</span></span><br></pre></td></tr></table></figure><ul><li>å¤§æ‰¹é‡æ’å…¥æ•°æ®</li></ul><p>å¦‚æœä¸€æ¬¡æ€§éœ€è¦æ’å…¥å¤§æ‰¹é‡æ•°æ®ï¼Œä½¿ç”¨ <code>insert</code> è¯­å¥æ’å…¥æ€§èƒ½è¾ƒä½ï¼Œæ­¤æ—¶å¯ä»¥ä½¿ç”¨ MySQL æ•°æ®åº“æä¾›çš„ <code>load</code> æŒ‡ä»¤è¿›è¡Œæ’å…¥ã€‚æ“ä½œå¦‚ä¸‹:</p><p><img src="http://cdn.leesin.fun/typora/s3/img/loadæŒ‡ä»¤.png" alt="loadæŒ‡ä»¤"></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># å®¢æˆ·ç«¯è¿æ¥æœåŠ¡ç«¯æ—¶ï¼ŒåŠ ä¸Šå‚æ•° <span class="comment">--local-infileï¼ˆè¿™ä¸€è¡Œåœ¨bash/cmdç•Œé¢è¾“å…¥ï¼‰</span></span><br><span class="line">mysql <span class="comment">--local-infile -u root -p</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># è®¾ç½®å…¨å±€å‚æ•°local_infileä¸º<span class="number">1</span>ï¼Œå¼€å¯ä»æœ¬åœ°åŠ è½½æ–‡ä»¶å¯¼å…¥æ•°æ®çš„å¼€å…³</span><br><span class="line"><span class="keyword">set</span> <span class="keyword">global</span> local_infile <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"><span class="keyword">select</span> @<span class="variable">@local</span>_infile;</span><br><span class="line"># æ‰§è¡ŒloadæŒ‡ä»¤å°†å‡†å¤‡å¥½çš„æ•°æ®ï¼ŒåŠ è½½åˆ°è¡¨ç»“æ„ä¸­</span><br><span class="line">load data <span class="keyword">local</span> infile <span class="string">&#x27;/root/sql1.log&#x27;</span> <span class="keyword">into</span> <span class="keyword">table</span> <span class="string">&#x27;tb_user&#x27;</span> fields terminated <span class="keyword">by</span> <span class="string">&#x27;,&#x27;</span> lines terminated <span class="keyword">by</span> <span class="string">&#x27;\n&#x27;</span>;</span><br></pre></td></tr></table></figure><h2 id="6-2-ä¸»é”®ä¼˜åŒ–"><a href="#6-2-ä¸»é”®ä¼˜åŒ–" class="headerlink" title="6.2.ä¸»é”®ä¼˜åŒ–"></a>6.2.ä¸»é”®ä¼˜åŒ–</h2><ul><li>æ•°æ®ç»„ç»‡æ–¹å¼</li></ul><p>åœ¨InnoDBå­˜å‚¨å¼•æ“ä¸­ï¼Œè¡¨æ•°æ®éƒ½æ˜¯æ ¹æ®ä¸»é”®é¡ºåºç»„ç»‡å­˜æ”¾çš„ï¼Œè¿™ç§å­˜å‚¨æ–¹å¼çš„è¡¨ç§°ä¸ºç´¢å¼•ç»„ç»‡è¡¨ï¼ˆIndex organized table, IOTï¼‰</p><ul><li>é¡µåˆ†è£‚</li></ul><p>ä¸»é”®ä¹±åºæ’å…¥å¯èƒ½å¼•èµ·é¡µåˆ†è£‚</p><blockquote><p><a href="https://www.bilibili.com/video/BV1Kr4y1i7ru?t=220.7&amp;p=90">https://www.bilibili.com/video/BV1Kr4y1i7ru?t=220.7&amp;p=90</a></p></blockquote><ul><li>é¡µåˆå¹¶</li></ul><p>å½“åˆ é™¤ä¸€è¡Œè®°å½•æ—¶ï¼Œå®é™…ä¸Šè®°å½•å¹¶æ²¡æœ‰è¢«ç‰©ç†åˆ é™¤ï¼Œåªæ˜¯è®°å½•è¢«æ ‡è®°ï¼ˆflagedï¼‰ä¸ºåˆ é™¤å¹¶ä¸”å®ƒçš„ç©ºé—´å˜å¾—å…è®¸è¢«å…¶ä»–è®°å½•å£°æ˜ä½¿ç”¨ã€‚å½“é¡µä¸­åˆ é™¤çš„è®°å½•åˆ°è¾¾ MERGE_THRESHOLDï¼ˆé»˜è®¤ä¸ºé¡µçš„50%ï¼‰ï¼ŒInnoDBä¼šå¼€å§‹å¯»æ‰¾æœ€é è¿‘çš„é¡µï¼ˆå‰åï¼‰çœ‹çœ‹æ˜¯å¦å¯ä»¥å°†è¿™ä¸¤ä¸ªé¡µåˆå¹¶ä»¥ä¼˜åŒ–ç©ºé—´ä½¿ç”¨ã€‚</p><blockquote><p><a href="https://www.bilibili.com/video/BV1Kr4y1i7ru?t=484.7&amp;p=90">https://www.bilibili.com/video/BV1Kr4y1i7ru?t=484.7&amp;p=90</a></p></blockquote><ul><li><p><strong>ä¸»é”®è®¾è®¡åŸåˆ™</strong></p><ul><li><p>æ»¡è¶³ä¸šåŠ¡éœ€æ±‚çš„æƒ…å†µä¸‹ï¼Œå°½é‡é™ä½ä¸»é”®çš„é•¿åº¦</p></li><li><p>æ’å…¥æ•°æ®æ—¶ï¼Œå°½é‡é€‰æ‹©é¡ºåºæ’å…¥ï¼Œé€‰æ‹©ä½¿ç”¨ AUTO_INCREMENT è‡ªå¢ä¸»é”®</p></li><li><p>å°½é‡ä¸è¦ä½¿ç”¨ UUID åšä¸»é”®æˆ–è€…æ˜¯å…¶ä»–çš„è‡ªç„¶ä¸»é”®ï¼Œå¦‚èº«ä»½è¯å·</p></li><li><p>ä¸šåŠ¡æ“ä½œæ—¶ï¼Œé¿å…å¯¹ä¸»é”®çš„ä¿®æ”¹</p></li></ul></li></ul><h2 id="6-3-order-by-ä¼˜åŒ–"><a href="#6-3-order-by-ä¼˜åŒ–" class="headerlink" title="6.3. order by ä¼˜åŒ–"></a>6.3. <code>order by</code> ä¼˜åŒ–</h2><blockquote><p><strong>explain ä¸­ extra å­—æ®µå«ä¹‰</strong></p><p><code>Using filesort</code>ï¼šé€šè¿‡è¡¨çš„ç´¢å¼•æˆ–å…¨è¡¨æ‰«æï¼Œè¯»å–æ»¡è¶³æ¡ä»¶çš„æ•°æ®è¡Œï¼Œç„¶ååœ¨æ’åºç¼“å†²åŒº sort buffer ä¸­å®Œæˆæ’åºæ“ä½œï¼Œæ‰€æœ‰ä¸æ˜¯é€šè¿‡ç´¢å¼•ç›´æ¥è¿”å›æ’åºç»“æœçš„æ’åºéƒ½å« FileSort æ’åº</p><p><code>Using index</code>ï¼šé€šè¿‡æœ‰åºç´¢å¼•é¡ºåºæ‰«æç›´æ¥è¿”å›æœ‰åºæ•°æ®ï¼Œè¿™ç§æƒ…å†µå³ä¸º using indexï¼Œä¸éœ€è¦é¢å¤–æ’åºï¼Œæ“ä½œæ•ˆç‡é«˜</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"># åˆ é™¤ä¹‹å‰åˆ›å»ºçš„ç´¢å¼•ï¼Œä»¥å…å¹²æ‰°æµ‹è¯•</span><br><span class="line"></span><br><span class="line">#æ²¡æœ‰åˆ›å»ºç´¢å¼•æ—¶ï¼Œæ ¹æ®age, phoneè¿›è¡Œæ’åº</span><br><span class="line">#æ­¤æ—¶ extra å­—æ®µæ˜¾ç¤ºçš„æ˜¯ <span class="keyword">Using</span> filesort</span><br><span class="line">explain <span class="keyword">select</span> id,age,phone <span class="keyword">from</span> tb_user <span class="keyword">order</span> <span class="keyword">by</span> age, phone;</span><br><span class="line"></span><br><span class="line">#åˆ›å»ºç´¢å¼•</span><br><span class="line"><span class="keyword">create</span> index idx_user_age_phone_aa <span class="keyword">on</span> tb_user(age,phone);</span><br><span class="line"></span><br><span class="line">#åˆ›å»ºç´¢å¼•åï¼Œæ ¹æ®age,phoneè¿›è¡Œå‡åºæ’åº</span><br><span class="line">#æ­¤æ—¶ extra å­—æ®µæ˜¾ç¤ºçš„æ˜¯ <span class="keyword">Using</span> indexæ•ˆç‡é«˜</span><br><span class="line">explain <span class="keyword">select</span> id,age,phone <span class="keyword">from</span> tb_user <span class="keyword">order</span> <span class="keyword">by</span> age, phone;</span><br><span class="line"></span><br><span class="line">#åˆ›å»ºç´¢å¼•åï¼Œæ ¹æ®age, phoneè¿›è¡Œé™åºæ’åº</span><br><span class="line">#æ­¤æ—¶ extra å­—æ®µæ˜¾ç¤ºçš„æ˜¯ Backward index scan, <span class="keyword">Using</span> indexæ•ˆç‡é«˜</span><br><span class="line">explain <span class="keyword">select</span> id,age,phone <span class="keyword">from</span> tb_user <span class="keyword">order</span> <span class="keyword">by</span> age <span class="keyword">desc</span>, phone <span class="keyword">desc</span>;</span><br><span class="line"></span><br><span class="line">#æ ¹æ®age,phoneè¿›è¡Œé™åºä¸€ä¸ªå‡åºï¼Œä¸€ä¸ªé™åº</span><br><span class="line">#æ­¤æ—¶ extra å­—æ®µæ˜¾ç¤ºçš„æ˜¯ <span class="keyword">Using</span> index; <span class="keyword">Using</span> filesort</span><br><span class="line">explain <span class="keyword">select</span> id,age,phone <span class="keyword">from</span> tb_user <span class="keyword">order</span> <span class="keyword">by</span> age <span class="keyword">asc</span>, phone <span class="keyword">desc</span>;</span><br><span class="line"></span><br><span class="line">#åˆ›å»ºç´¢å¼•ï¼Œå¯¹ä¸Šä¸€ä¸ª<span class="keyword">sql</span>è¿›è¡Œä¼˜åŒ–</span><br><span class="line"><span class="keyword">create</span> index idx_user_age_phone_ad <span class="keyword">on</span> tb_user(age <span class="keyword">asc</span>, phone <span class="keyword">desc</span>);</span><br><span class="line"></span><br><span class="line">#æ ¹æ®age,phoneè¿›è¡Œé™åºä¸€ä¸ªå‡åºï¼Œä¸€ä¸ªé™åº</span><br><span class="line">#æ­¤æ—¶ extra å­—æ®µæ˜¾ç¤ºçš„æ˜¯ <span class="keyword">Using</span> index æ•ˆç‡é«˜</span><br><span class="line">explain <span class="keyword">select</span> id,age,phone <span class="keyword">from</span> tb_user <span class="keyword">order</span> <span class="keyword">by</span> age <span class="keyword">asc</span>, phone <span class="keyword">desc</span>;</span><br></pre></td></tr></table></figure><p><img src="http://cdn.leesin.fun/typora/s3/img/order byä¼˜åŒ–.png" alt="order byä¼˜åŒ–"></p><p><strong>æ€»ç»“ï¼š</strong></p><ul><li>æ ¹æ®æ’åºå­—æ®µå»ºç«‹åˆé€‚çš„ç´¢å¼•ï¼Œå¤šå­—æ®µæ’åºæ—¶ï¼Œä¹Ÿéµå¾ªæœ€å·¦å‰ç¼€æ³•åˆ™</li><li>å°½é‡ä½¿ç”¨è¦†ç›–ç´¢å¼•</li><li>å¤šå­—æ®µæ’åºï¼Œä¸€ä¸ªå‡åºä¸€ä¸ªé™åºï¼Œæ­¤æ—¶éœ€è¦æ³¨æ„è”åˆç´¢å¼•åœ¨åˆ›å»ºæ—¶çš„è§„åˆ™ï¼ˆASC/DESCï¼‰</li><li>å¦‚æœä¸å¯é¿å…å‡ºç°filesortï¼Œå¤§æ•°æ®é‡æ’åºæ—¶ï¼Œå¯ä»¥é€‚å½“å¢å¤§æ’åºç¼“å†²åŒºå¤§å° sort_buffer_sizeï¼ˆé»˜è®¤256kï¼‰</li></ul><h2 id="6-4-group-by-ä¼˜åŒ–"><a href="#6-4-group-by-ä¼˜åŒ–" class="headerlink" title="6.4. group by ä¼˜åŒ–"></a>6.4. <code>group by</code> ä¼˜åŒ–</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"># åˆ é™¤ä¹‹å‰åˆ›å»ºçš„ç´¢å¼•ï¼Œä»¥å…å¹²æ‰°æµ‹è¯•</span><br><span class="line"></span><br><span class="line">#æ‰§è¡Œåˆ†ç»„æ“ä½œï¼Œæ ¹æ®professionå­—æ®µåˆ†ç»„</span><br><span class="line">#ç”±äºæ²¡æœ‰ç´¢å¼•ï¼Œæ‰€ä»¥æ­¤æ¬¡æ“ä½œæ˜¯å…¨è¡¨æ‰«æ</span><br><span class="line">#æ­¤æ—¶ extra å­—æ®µæ˜¾ç¤ºçš„æ˜¯ <span class="keyword">Using</span> temporary è¡¨ç¤ºä½¿ç”¨äº†ä¸´æ—¶è¡¨</span><br><span class="line">explain <span class="keyword">select</span> profession, <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">from</span> tb_user <span class="keyword">group</span> <span class="keyword">by</span> profession;</span><br><span class="line"></span><br><span class="line">#åˆ›å»ºè”åˆç´¢å¼•</span><br><span class="line"><span class="keyword">Create</span> index idx_user_pro_age_sta <span class="keyword">on</span> tb_user(profession, age, status);</span><br><span class="line"></span><br><span class="line">#æ‰§è¡Œåˆ†ç»„æ“ä½œï¼Œæ ¹æ®professionå­—æ®µåˆ†ç»„</span><br><span class="line">#æ­¤æ—¶ extra å­—æ®µæ˜¾ç¤ºçš„æ˜¯ <span class="keyword">Using</span> index æ•ˆç‡é«˜</span><br><span class="line">explain <span class="keyword">select</span> profession, <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">from</span> tb_user <span class="keyword">group</span> <span class="keyword">by</span> profession;</span><br><span class="line"></span><br><span class="line">#æ‰§è¡Œåˆ†ç»„æ“ä½œï¼Œæ ¹æ®professionå­—æ®µåˆ†ç»„</span><br><span class="line">#æ­¤æ—¶ extra å­—æ®µæ˜¾ç¤ºçš„æ˜¯ <span class="keyword">Using</span> index æ•ˆç‡é«˜</span><br><span class="line">explain <span class="keyword">select</span> profession, <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">from</span> tb_user <span class="keyword">group</span> <span class="keyword">by</span> profession, age;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#æ­¤æ—¶ extra å­—æ®µæ˜¾ç¤ºçš„æ˜¯ <span class="keyword">Using</span> index æ•ˆç‡é«˜</span><br><span class="line">explain <span class="keyword">select</span> age, <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">from</span> tb_user <span class="keyword">where</span> profession<span class="operator">=</span><span class="string">&#x27;è½¯ä»¶å·¥ç¨‹&#x27;</span> <span class="keyword">group</span> <span class="keyword">by</span> age;</span><br></pre></td></tr></table></figure><ul><li>åœ¨åˆ†ç»„æ“ä½œæ—¶ï¼Œå¯ä»¥é€šè¿‡ç´¢å¼•æ¥æé«˜æ•ˆç‡</li><li>åˆ†ç»„æ“ä½œæ—¶ï¼Œç´¢å¼•çš„ä½¿ç”¨ä¹Ÿæ˜¯æ»¡è¶³æœ€å·¦å‰ç¼€æ³•åˆ™çš„</li></ul><h2 id="6-5-limit-ä¼˜åŒ–"><a href="#6-5-limit-ä¼˜åŒ–" class="headerlink" title="6.5. limit ä¼˜åŒ–"></a>6.5. <code>limit</code> ä¼˜åŒ–</h2><p>å¯¹äºlimitæ¥è¯´ï¼Œåœ¨å¤§æ•°æ®é‡ä¸‹è¿›è¡Œåˆ†é¡µæ“ä½œï¼Œè¶Šå¾€åæ•ˆç‡è¶Šä½ã€‚</p><p>ä¸ªå¸¸è§åˆéå¸¸å¤´ç–¼çš„é—®é¢˜å°±æ˜¯ <code>limt 2000000,10</code> ï¼Œæ­¤æ—¶éœ€è¦MySQLæ’å¸­å‰2000010 è®°å½•ï¼Œä»…ä»…è¿”å›2000000 - 2000010çš„è®°å½•ï¼Œå…¶ä»–è®°å½•ä¸¢å¼ƒï¼ŒæŸ¥è¯¢æ’åºçš„ä»£ä»·éå¸¸å¤§ã€‚</p><p>ä¼˜åŒ–æ€è·¯: ä¸€èˆ¬åˆ†é¡µæŸ¥è¯¢æ—¶ï¼Œé€šè¿‡åˆ›å»º è¦†ç›–ç´¢å¼• èƒ½å¤Ÿæ¯”è¾ƒå¥½åœ°æé«˜æ€§èƒ½ï¼Œå¯ä»¥é€šè¿‡<strong>è¦†ç›–ç´¢å¼•</strong>åŠ <strong>å­æŸ¥è¯¢</strong>å½¢å¼è¿›è¡Œä¼˜åŒ–ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># ä¼˜åŒ–å‰ï¼ŒèŠ±è´¹<span class="number">19.39</span>ç§’</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> </span><br><span class="line"><span class="keyword">from</span> tb_sku </span><br><span class="line">limit <span class="number">9000000</span>,<span class="number">10</span>;</span><br><span class="line"></span><br><span class="line"># ä¼˜åŒ–åï¼ŒèŠ±è´¹<span class="number">11.46</span>ç§’</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> </span><br><span class="line"><span class="keyword">from</span> tb_sku t , (<span class="keyword">select</span> id </span><br><span class="line">                 <span class="keyword">from</span> tb_sku </span><br><span class="line">                 <span class="keyword">order</span> <span class="keyword">by</span> id </span><br><span class="line">                 limit <span class="number">9000000</span>,<span class="number">10</span>) a </span><br><span class="line"><span class="keyword">where</span> t.id <span class="operator">=</span> a.id;</span><br></pre></td></tr></table></figure><h2 id="6-6-count-ä¼˜åŒ–"><a href="#6-6-count-ä¼˜åŒ–" class="headerlink" title="6.6. count ä¼˜åŒ–"></a>6.6. <code>count</code> ä¼˜åŒ–</h2><ul><li>MyISAMå¼•æ“æŠŠä¸€ä¸ªè¡¨çš„æ€»è¡Œæ•°å­˜åœ¨äº†ç£ç›˜ä¸Šï¼Œå› æ­¤æ‰§è¡Œcount(*)çš„æ—¶å€™ä¼šç›´æ¥è¿”å›è¿™ä¸ªæ•°ï¼Œæ•ˆç‡å¾ˆé«˜</li><li>InnoDBå¼•æ“å°±éº»çƒ¦äº†ï¼Œå®ƒæ‰§è¡Œcount(*)çš„æ—¶å€™ï¼Œéœ€è¦æŠŠæ•°æ®ä¸€è¡Œä¸€è¡Œåœ°ä»å¼•æ“é‡Œé¢è¯»å‡ºæ¥ï¼Œç„¶åç´¯ç§¯è®¡æ•°</li></ul><blockquote><p><strong>ä¼˜åŒ–æ€è·¯: è‡ªå·±è®¡æ•°ã€‚</strong>ä½¿ç”¨redisæ¥è®¡æ•°</p></blockquote><p><strong>countçš„å‡ ç§ç”¨æ³•</strong></p><ul><li><p><code>count(ä¸»é”®)</code><br>InnoDBå¼•æ“ä¼šéå†æ•´å¼ è¡¨ï¼ŒæŠŠæ¯ä¸€è¡Œçš„ä¸»é”®idå€¼éƒ½å–å‡ºæ¥ï¼Œè¿”å›ç»™æœåŠ¡å±‚ã€‚æœåŠ¡å±‚æ‹¿åˆ°ä¸»é”®åï¼Œä¸ç”¨åˆ¤ç©ºï¼Œç›´æ¥æŒ‰è¡Œè¿›è¡Œç´¯åŠ ï¼ˆä¸»é”®ä¸å¯èƒ½ä¸ºnullï¼‰</p></li><li><p><code>count(å­—æ®µ)</code></p><p>æ²¡æœ‰not null çº¦æŸï¼šInnoDBå¼•æ“ä¼šéå†æ•´å¼ è¡¨æŠŠæ¯ä¸€è¡Œçš„å­—æ®µå€¼éƒ½å–å‡ºæ¥ï¼Œè¿”å›ç»™æœåŠ¡å±‚ï¼ŒæœåŠ¡å±‚åˆ¤æ–­æ˜¯å¦ä¸ºnullã€‚ä¸ä¸ºnullï¼Œè®¡æ•°ç´¯åŠ ï¼›ä¸ºnullï¼Œä¸åŠ ã€‚<br>æœ‰not nullçº¦æŸï¼šInnoDB å¼•æ“ä¼šéå†æ•´å¼ è¡¨æŠŠæ¯ä¸€è¡Œçš„å­—æ®µå€¼éƒ½å–å‡ºæ¥ï¼Œè¿”å›ç»™æœåŠ¡å±‚ï¼Œä¸ç”¨åˆ¤ç©ºï¼Œç›´æ¥æŒ‰è¡Œè¿›è¡Œç´¯åŠ ã€‚</p></li><li><p><code>count(1)</code><br>InnoDBå¼•æ“éå†æ•´å¼ è¡¨ï¼Œä½†ä¸å–å€¼ã€‚æœåŠ¡å±‚å¯¹äºè¿”å›çš„æ¯ä¸€è¡Œï¼Œæ”¾ä¸€ä¸ªæ•°å­—â€œ1â€œè¿›å»ï¼Œç›´æ¥æŒ‰è¡Œè¿›è¡Œç´¯åŠ ã€‚</p></li><li><p><code>count(*)</code><br>lnnoDBå¼•æ“å¹¶ä¸ä¼šæŠŠå…¨éƒ¨å­—æ®µå–å‡ºæ¥ï¼Œè€Œæ˜¯ä¸“é—¨åšäº†ä¼˜åŒ–ï¼Œä¸å–å€¼ï¼ŒæœåŠ¡å±‚ç›´æ¥æŒ‰è¡Œè¿›è¡Œç´¯åŠ ã€‚</p></li></ul><p><strong>æ€»ç»“</strong></p><p>æŒ‰ç…§æ•ˆç‡æ’åºçš„è¯ï¼Œ<code>count(å­—æ®µ)</code>&lt; <code>count(ä¸»é”® id)</code>&lt; <code>count(1)</code> â‰ˆ<code>count(*)</code>ï¼Œæ‰€ä»¥å°½é‡ä½¿ç”¨ <code>count(*)</code></p><h2 id="6-7-update-ä¼˜åŒ–ï¼ˆé¿å…è¡Œé”å‡çº§ä¸ºè¡¨é”ï¼‰"><a href="#6-7-update-ä¼˜åŒ–ï¼ˆé¿å…è¡Œé”å‡çº§ä¸ºè¡¨é”ï¼‰" class="headerlink" title="6.7. update ä¼˜åŒ–ï¼ˆé¿å…è¡Œé”å‡çº§ä¸ºè¡¨é”ï¼‰"></a>6.7. <code>update</code> ä¼˜åŒ–ï¼ˆé¿å…è¡Œé”å‡çº§ä¸ºè¡¨é”ï¼‰</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># idå­—æ®µæœ‰ç´¢å¼•ï¼Œæ­¤<span class="keyword">sql</span>è¯­å¥åŠ è¡Œé”</span><br><span class="line"><span class="keyword">update</span> student <span class="keyword">set</span> <span class="keyword">no</span> <span class="operator">=</span> <span class="string">&#x27;2000100100&#x27;</span> <span class="keyword">where</span> id <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"># nameå­—æ®µæ²¡æœ‰è®¾ç½®ç´¢å¼•ï¼Œæ­¤<span class="keyword">sql</span>è¯­å¥åŠ è¡¨é”</span><br><span class="line"><span class="keyword">update</span> student <span class="keyword">set</span> <span class="keyword">no</span> <span class="operator">=</span><span class="string">&#x27;2000100105&#x27;</span> <span class="keyword">where</span> name <span class="operator">=</span><span class="string">&#x27;éŸ¦ä¸€ç¬‘&#x27;</span>;</span><br></pre></td></tr></table></figure><p>lnnoDBçš„è¡Œé”æ˜¯é’ˆå¯¹ç´¢å¼•åŠ çš„é”ï¼Œä¸æ˜¯é’ˆå¯¹è®°å½•åŠ çš„é”ï¼Œå¹¶ä¸”è¯¥ç´¢å¼•ä¸èƒ½å¤±æ•ˆï¼Œå¦åˆ™ä¼šä»è¡Œé”å‡çº§ä¸ºè¡¨é”</p><h1 id="7-é”"><a href="#7-é”" class="headerlink" title="7.é”"></a>7.é”</h1><p>MySQLä¸­çš„é”ï¼ŒæŒ‰ç…§é”çš„ç²’åº¦åˆ†ï¼Œåˆ†ä¸ºä»¥ä¸‹ä¸‰ç±»:<br>1.å…¨å±€é”ï¼šé”å®šæ•°æ®åº“ä¸­çš„æ‰€æœ‰è¡¨<br>2.è¡¨çº§é”ï¼šæ¯æ¬¡æ“ä½œé”ä½æ•´å¼ è¡¨ã€‚<br>3.è¡Œçº§é”ï¼šæ¯æ¬¡æ“ä½œé”ä½å¯¹åº”çš„è¡Œæ•°æ®ã€‚</p><h2 id="7-1-å…¨å±€é”"><a href="#7-1-å…¨å±€é”" class="headerlink" title="7.1.å…¨å±€é”"></a>7.1.å…¨å±€é”</h2><p>å…¨å±€é”å°±æ˜¯å¯¹æ•´ä¸ªæ•°æ®åº“å®ä¾‹åŠ é”ï¼ŒåŠ é”åæ•´ä¸ªå®ä¾‹å°±å¤„äºåªè¯»çŠ¶æ€ï¼Œåç»­çš„DMLçš„å†™è¯­å¥ï¼ŒDDLè¯­å¥ï¼Œå·²ç»æ›´æ–°æ“ä½œçš„äº‹åŠ¡æäº¤è¯­å¥éƒ½å°†è¢«é˜»å¡ã€‚<br>å…¶å…¸å‹çš„ä½¿ç”¨åœºæ™¯æ˜¯åšå…¨åº“çš„é€»è¾‘å¤‡ä»½ï¼Œå¯¹æ‰€æœ‰çš„è¡¨è¿›è¡Œé”å®šï¼Œä»è€Œè·å–ä¸€è‡´æ€§è§†å›¾ï¼Œä¿è¯æ•°æ®çš„å®Œæ•´æ€§ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># åŠ å…¨å±€é”</span><br><span class="line">flush tables <span class="keyword">with</span> read lock;</span><br><span class="line"></span><br><span class="line"># é‡Šæ”¾å…¨å±€é”</span><br><span class="line">unlock tables;</span><br></pre></td></tr></table></figure><p>æ•°æ®åº“ä¸­åŠ å…¨å±€é”ï¼Œæ˜¯ä¸€ä¸ªæ¯”è¾ƒé‡çš„æ“ä½œï¼Œå­˜åœ¨ä»¥ä¸‹é—®é¢˜:</p><ol><li><p>å¦‚æœåœ¨ä¸»åº“ä¸Šå¤‡ä»½ï¼Œé‚£ä¹ˆåœ¨å¤‡ä»½æœŸé—´éƒ½ä¸èƒ½æ‰§è¡Œæ›´æ–°ï¼Œä¸šåŠ¡åŸºæœ¬ä¸Šå°±å¾—åœæ‘†ã€‚</p></li><li><p>å¦‚æœåœ¨ä»åº“ä¸Šå¤‡ä»½ï¼Œé‚£ä¹ˆåœ¨å¤‡ä»½æœŸé—´ä»åº“ä¸èƒ½æ‰§è¡Œä¸»åº“åŒæ­¥è¿‡æ¥çš„äºŒè¿›åˆ¶æ—¥å¿—(binlog)ï¼Œä¼šå¯¼è‡´ä¸»ä»å»¶è¿Ÿã€‚</p></li></ol><p><strong>ç™½é›ªè­¦å‘Š</strong></p><p>åœ¨innoDBå¼•æ“ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å¤‡ä»½æ—¶åŠ ä¸Šå‚æ•° <code>--single-transaction</code> å‚æ•°æ¥å®Œæˆä¸åŠ é”çš„ä¸€è‡´æ€§æ•°æ®å¤‡ä»½</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqldump <span class="comment">--single-transaction -uroot -proot itcast &gt; itcast.sql</span></span><br></pre></td></tr></table></figure><h2 id="7-2-è¡¨çº§é”"><a href="#7-2-è¡¨çº§é”" class="headerlink" title="7.2.è¡¨çº§é”"></a>7.2.è¡¨çº§é”</h2><h3 id="7-2-1-è¯»å†™é”"><a href="#7-2-1-è¯»å†™é”" class="headerlink" title="7.2.1.è¯»å†™é”"></a>7.2.1.è¯»å†™é”</h3><ol><li><p>è¡¨å…±äº«è¯»é” (read lock)ï¼šä¸ä¼šé˜»å¡æ‰€æœ‰å®¢æˆ·ç«¯çš„è¯»ï¼Œä½†æ˜¯ä¼šé˜»å¡æ‰€æœ‰çš„å†™ã€‚</p></li><li><p>è¡¨ç‹¬å å†™é” (write lock)ï¼šå…¶ä»–å®¢æˆ·ç«¯ä¸èƒ½è¯»ä¹Ÿä¸èƒ½å†™ï¼Œ</p></li></ol><div class="table-container"><table><thead><tr><th></th><th>è·å–é”çš„å®¢æˆ·ç«¯</th><th>å…¶ä»–å®¢æˆ·ç«¯</th></tr></thead><tbody><tr><td>å…±äº«è¯»é”</td><td>å¯ä»¥è¯»ï¼Œä¸å¯ä»¥å†™</td><td>å¯ä»¥è¯»ï¼Œä¸å¯ä»¥å†™</td></tr><tr><td>ç‹¬å å†™é”</td><td>å¯ä»¥è¯»ï¼Œå¯ä»¥å†™</td><td>ä¸å¯ä»¥è¯»ï¼Œä¸å¯ä»¥å†™</td></tr></tbody></table></div><p>è¯­æ³•:</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># ç»™tb_useråŠ å…±äº«è¯»é”</span><br><span class="line">lock tables tb_user read;</span><br><span class="line"># é‡Šæ”¾é”</span><br><span class="line">unlock tables;</span><br><span class="line"></span><br><span class="line"># ç»™tb_useråŠ ç‹¬å å†™é”</span><br><span class="line">lock tables tb_user write;</span><br><span class="line"># é‡Šæ”¾é”</span><br><span class="line">unlock tables;</span><br></pre></td></tr></table></figure><p>å®¢æˆ·ç«¯æ–­å¼€è¿æ¥ï¼Œä¹Ÿä¼šè‡ªåŠ¨é‡Šæ”¾é”ã€‚</p><h3 id="7-2-2-å…ƒæ•°æ®é”-meta-data-lockï¼Œ-MDL"><a href="#7-2-2-å…ƒæ•°æ®é”-meta-data-lockï¼Œ-MDL" class="headerlink" title="7.2.2.å…ƒæ•°æ®é” (meta data lockï¼Œ MDL)"></a>7.2.2.å…ƒæ•°æ®é” (meta data lockï¼Œ MDL)</h3><p>MDLåŠ é”è¿‡ç¨‹æ˜¯ç³»ç»Ÿè‡ªåŠ¨æ§åˆ¶ï¼Œæ— éœ€æ˜¾å¼ä½¿ç”¨ï¼Œåœ¨è®¿é—®ä¸€å¼ è¡¨çš„æ—¶å€™ä¼šè‡ªåŠ¨åŠ ä¸Šã€‚MDLé”ä¸»è¦ä½œç”¨æ˜¯ç»´æŠ¤è¡¨å…ƒæ•°æ®çš„æ•°æ®ä¸€è‡´æ€§ï¼Œåœ¨è¡¨ä¸Šæœ‰æ´»åŠ¨äº‹åŠ¡çš„æ—¶å€™ï¼Œä¸å¯ä»¥å¯¹å…ƒæ•°æ®è¿›è¡Œå†™å…¥æ“ä½œã€‚ä¸ºäº†é¿å…DMLä¸DDLå†²çªï¼Œä¿è¯è¯»å†™çš„æ­£ç¡®æ€§ã€‚<br>åœ¨MySQL5.5ä¸­å¼•å…¥äº†MDLï¼Œå½“å¯¹ä¸€å¼ è¡¨è¿›è¡Œå¢åˆ æ”¹æŸ¥çš„æ—¶å€™ï¼ŒåŠ MDLè¯»é”(å…±äº«)ï¼Œå½“å¯¹è¡¨ç»“æ„è¿›è¡Œå˜æ›´æ“ä½œçš„æ—¶å€™ï¼ŒåŠ MDLå†™é”(æ’ä»–)ã€‚</p><div class="table-container"><table><thead><tr><th>å¯¹åº”SQL</th><th>é”ç±»å‹</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>lock tables xxx read</td><td>SHARED_READ_ONLY</td><td></td></tr><tr><td>lock tables xxx write</td><td>SHARED_NO_READ_WRITE</td><td></td></tr><tr><td>selectã€select â€¦ lock in share mode</td><td>SHARED_READ</td><td>ä¸SHARED_READã€SHARED_WRITEå…¼å®¹ï¼Œä¸EXCLUSIVEäº’æ–¥</td></tr><tr><td>insertã€updateã€deleteã€select â€¦ for update</td><td>SHARED_WRITE</td><td>ä¸SHARED_READã€SHARED_WRITEå…¼å®¹ï¼Œä¸EXCLUSIVEäº’æ–¥</td></tr><tr><td>alter table â€¦</td><td>EXCLUSIVE</td><td>ä¸å…¶ä»–çš„MDLéƒ½äº’æ–¥</td></tr></tbody></table></div><p>æŸ¥çœ‹å…ƒæ•°æ®é”ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> object_type,object_schema,object_name,lock_type,lock_duration <span class="keyword">from</span> performance_schema.metadata_locks;</span><br></pre></td></tr></table></figure><h3 id="7-2-3-æ„å‘é”"><a href="#7-2-3-æ„å‘é”" class="headerlink" title="7.2.3.æ„å‘é”"></a>7.2.3.æ„å‘é”</h3><p>ä¸ºäº†é¿å…DMLåœ¨æ‰§è¡Œæ—¶ï¼ŒåŠ çš„è¡Œé”ä¸è¡¨é”çš„å†²çªï¼Œåœ¨InnoDBä¸­å¼•å…¥äº†æ„å‘é”ï¼Œä½¿å¾—è¡¨é”ä¸ç”¨æ£€æŸ¥æ¯è¡Œæ•°æ®æ˜¯å¦åŠ é”ï¼Œä½¿ç”¨æ„å‘é”æ¥å‡å°‘è¡¨é”çš„æ£€æŸ¥ã€‚</p><ol><li>æ„å‘å…±äº«é” (IS)ï¼šç”±è¯­å¥ selectâ€¦lock in share modeæ·»åŠ ã€‚ä¸è¡¨å…±äº«è¯»é”ï¼ˆreadï¼‰å…¼å®¹ï¼Œä¸è¡¨ç‹¬å å†™é”ï¼ˆwriteï¼‰äº’æ–¥ã€‚</li><li>æ„å‘æ’ä»–é” (IX)ï¼šç”±insertã€updateã€deleteã€selectâ€¦for update æ·»åŠ ã€‚ä¸è¡¨å…±äº«è¯»é”ï¼ˆreadï¼‰åŠè¡¨ç‹¬å å†™é”ï¼ˆwriteï¼‰éƒ½äº’æ–¥ã€‚</li><li>æ„å‘é”ä¹‹é—´ä¸ä¼šäº’æ–¥ã€‚</li></ol><p>å¯ä»¥é€šè¿‡ä»¥ä¸‹SQLï¼ŒæŸ¥çœ‹æ„å‘é”åŠè¡Œé”çš„åŠ é”æƒ…å†µ:</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> object_schema,object_name,index_name,lock_type,lock_mode,lock_data <span class="keyword">from</span> performance_schema.data_locks;</span><br></pre></td></tr></table></figure><blockquote><p>è¯´äººè¯ï¼Œå¦‚æœäº‹åŠ¡Aæ‰§è¡Œäº† <code>select...lock in share mode</code> ï¼Œé‚£ä¹ˆå°±ä¼šåŠ æ„å‘å…±äº«é” (IS)ï¼Œæ­¤æ—¶ï¼Œå¦ä¸€å®¢æˆ·ç«¯å°è¯•åŠ è¡¨å…±äº«è¯»é”æ˜¯OKçš„ï¼Œå°è¯•åŠ è¡¨ç‹¬å å†™é”æ˜¯ä¸è¡Œçš„ï¼Œä¼šè¢«é˜»å¡ä½ã€‚</p><p>å¦‚æœäº‹åŠ¡Bæ‰§è¡Œäº† <code>insertã€updateã€deleteã€select...for update</code> è¿™äº›è¯­å¥ï¼Œé‚£ä¹ˆå°±ä¼šåŠ æ„å‘æ’ä»–é” (IX)ï¼Œæ­¤æ—¶ï¼Œå¦ä¸€å®¢æˆ·ç«¯å°è¯•åŠ è¡¨å…±äº«è¯»é”æˆ–è¡¨ç‹¬å å†™é”éƒ½æ˜¯ä¸è¡Œçš„ï¼Œä¼šè¢«é˜»å¡ä½ã€‚</p><p><a href="https://www.bilibili.com/video/BV1Kr4y1i7ru?p=127">https://www.bilibili.com/video/BV1Kr4y1i7ru?p=127</a></p></blockquote><h2 id="7-3-è¡Œçº§é”"><a href="#7-3-è¡Œçº§é”" class="headerlink" title="7.3.è¡Œçº§é”"></a>7.3.è¡Œçº§é”</h2><p>è¡Œçº§é”ï¼Œæ¯æ¬¡æ“ä½œé”ä½å¯¹åº”çš„è¡Œæ•°æ®ã€‚é”å®šç²’åº¦æœ€å°ï¼Œå‘ç”Ÿé”å†²çªçš„æ¦‚ç‡æœ€ä½ï¼Œå¹¶å‘åº¦æœ€é«˜ã€‚åº”ç”¨åœ¨InnoDBå­˜å‚¨å¼•æ“ä¸­ã€‚</p><p>lnnoDBçš„æ•°æ®æ˜¯åŸºäºç´¢å¼•ç»„ç»‡çš„ï¼Œ<strong>è¡Œé”æ˜¯é€šè¿‡å¯¹ç´¢å¼•ä¸Šçš„ç´¢å¼•é¡¹åŠ é”æ¥å®ç°çš„ï¼Œè€Œä¸æ˜¯å¯¹è®°å½•åŠ çš„é”</strong>ã€‚å¯¹äºè¡Œçº§é”ï¼Œä¸»è¦åˆ†ä¸ºä»¥ä¸‹ä¸‰ç±»:</p><ol><li>è¡Œé”(Record Lock)ï¼šé”å®šå•ä¸ªè¡Œè®°å½•çš„é”ï¼Œé˜²æ­¢å…¶ä»–äº‹åŠ¡å¯¹æ­¤è¡Œè¿›è¡Œupdateå’Œdeleteã€‚åœ¨RCã€RRéš”ç¦»çº§åˆ«ä¸‹éƒ½æ”¯æŒã€‚</li></ol><p><img src="http://cdn.leesin.fun/typora/s3/img/è¡Œé”.png" alt="è¡Œé”"></p><ol><li>é—´éš™é”(Gap Lock)ï¼šé”å®šç´¢å¼•è®°å½•é—´éš™(ä¸å«è¯¥è®°å½•)ï¼Œç¡®ä¿ç´¢å¼•è®°å½•é—´éš™ä¸å˜ï¼Œé˜²æ­¢å…¶ä»–äº‹åŠ¡åœ¨è¿™ä¸ªé—´éš™è¿›è¡Œinsetï¼Œäº§ç”Ÿå¹»è¯»ã€‚åœ¨RRéš”ç¦»çº§åˆ«ä¸‹éƒ½æ”¯æŒ</li></ol><p><img src="http://cdn.leesin.fun/typora/s3/img/é—´éš™é”.png" alt="é—´éš™é”"></p><ol><li>ä¸´é”®é”(Next-Key Lock)ï¼šè¡Œé”å’Œé—´éš™é”ç»„åˆï¼ŒåŒæ—¶é”ä½æ•°æ®ï¼Œå¹¶é”ä½æ•°æ®å‰é¢çš„é—´éš™Gapã€‚åœ¨RRéš”ç¦»çº§åˆ«ä¸‹æ”¯æŒ</li></ol><p><img src="http://cdn.leesin.fun/typora/s3/img/ä¸´é”®é”.png" alt="ä¸´é”®é”"></p><h3 id="7-3-1-è¡Œé”"><a href="#7-3-1-è¡Œé”" class="headerlink" title="7.3.1.è¡Œé”"></a>7.3.1.è¡Œé”</h3><p>InnoDBå®ç°äº†ä»¥ä¸‹ä¸¤ç§ç±»å‹çš„è¡Œé”:</p><ol><li>å…±äº«é”(S)ï¼šå…è®¸ä¸€ä¸ªäº‹åŠ¡å»è¯»ä¸€è¡Œï¼Œé˜»æ­¢å…¶ä»–äº‹åŠ¡è·å¾—ç›¸åŒæ•°æ®é›†çš„æ’å®ƒé”ã€‚</li><li>æ’ä»–é”(X)ï¼šå…è®¸è·å–æ’ä»–é”çš„äº‹åŠ¡æ›´æ–°æ•°æ®ï¼Œé˜»æ­¢å…¶ä»–äº‹åŠ¡è·å¾—ç›¸åŒæ•°æ®é›†çš„å…±äº«é”å’Œæ’ä»–é”ã€‚</li></ol><div class="table-container"><table><thead><tr><th style="text-align:left">SQL</th><th>è¡Œé”ç±»å‹</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td style="text-align:left">insert â€¦</td><td>æ’ä»–é”</td><td>è‡ªåŠ¨åŠ é”</td></tr><tr><td style="text-align:left">update â€¦</td><td>æ’ä»–é”</td><td>è‡ªåŠ¨åŠ é”</td></tr><tr><td style="text-align:left">delete â€¦</td><td>æ’ä»–é”</td><td>è‡ªåŠ¨åŠ é”</td></tr><tr><td style="text-align:left">select</td><td>ä¸åŠ ä»»ä½•é”</td><td></td></tr><tr><td style="text-align:left">select â€¦ lock in share mode</td><td>å…±äº«é”</td><td>éœ€è¦æ‰‹åŠ¨åœ¨selectä¹‹ååŠ lock in share mode</td></tr><tr><td style="text-align:left">select â€¦ for update</td><td>æ’ä»–é”</td><td>éœ€è¦æ‰‹åŠ¨åœ¨selectä¹‹ååŠ for update</td></tr></tbody></table></div><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒInnoDBåœ¨ REPEATABLE READäº‹åŠ¡éš”ç¦»çº§åˆ«è¿è¡Œï¼ŒInnoDBä½¿ç”¨ ä¸´é”®é”è¿›è¡Œæœç´¢å’Œç´¢å¼•æ‰«æï¼Œä»¥é˜²æ­¢å¹»è¯»ã€‚</p><ol><li><p>é’ˆå¯¹å”¯ä¸€ç´¢å¼•è¿›è¡Œæ£€ç´¢æ—¶ï¼Œå¯¹å·²å­˜åœ¨çš„è®°å½•è¿›è¡Œç­‰å€¼åŒ¹é…æ—¶ï¼Œå°†ä¼šè‡ªåŠ¨ä¼˜åŒ–ä¸ºè¡Œé”ã€‚</p></li><li><p>InnoDBçš„è¡Œé”æ˜¯é’ˆå¯¹äºç´¢å¼•åŠ çš„é”ï¼Œä¸é€šè¿‡ç´¢å¼•æ¡ä»¶æ£€ç´¢æ•°æ®ï¼Œé‚£ä¹ˆlnnoDBå°†å¯¹è¡¨ä¸­çš„æ‰€æœ‰è®°å½•åŠ é”ï¼Œæ­¤æ—¶ å°±ä¼š<strong>å‡çº§ä¸ºè¡¨é”ã€‚</strong></p></li></ol><p>å¯ä»¥é€šè¿‡ä»¥ä¸‹SQLï¼ŒæŸ¥çœ‹æ„å‘é”åŠè¡Œé”çš„åŠ é”æƒ…å†µ</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> object_schema,object_name,index_name,lock_type,lock_mode,lock_data <span class="keyword">from</span> performance_schema.data_locks;</span><br></pre></td></tr></table></figure><h3 id="7-3-2-é—´éš™é”-ä¸´é”®é”ï¼ˆå­¦çš„ä¸æ˜¯å¾ˆæ‡‚â­â­â­ï¼‰"><a href="#7-3-2-é—´éš™é”-ä¸´é”®é”ï¼ˆå­¦çš„ä¸æ˜¯å¾ˆæ‡‚â­â­â­ï¼‰" class="headerlink" title="7.3.2.é—´éš™é”/ä¸´é”®é”ï¼ˆå­¦çš„ä¸æ˜¯å¾ˆæ‡‚â­â­â­ï¼‰"></a>7.3.2.é—´éš™é”/ä¸´é”®é”ï¼ˆå­¦çš„ä¸æ˜¯å¾ˆæ‡‚â­â­â­ï¼‰</h3><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒlnnoDBåœ¨ REPEATABLE READäº‹åŠ¡éš”ç¦»çº§åˆ«è¿è¡Œï¼ŒInnoDBä½¿ç”¨ ä¸´é”® é”è¿›è¡Œæœç´¢å’Œç´¢å¼•æ‰«æï¼Œä»¥é˜²æ­¢å¹»è¯»ã€‚</p><ol><li>ç´¢å¼•ä¸Šçš„ç­‰å€¼æŸ¥è¯¢(å”¯ä¸€ç´¢å¼•)ï¼Œç»™ä¸å­˜åœ¨çš„è®°å½•åŠ é”æ—¶ï¼Œä¼˜åŒ–ä¸ºé—´éš™é” ã€‚</li></ol><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">ä¾‹å¦‚ï¼š</span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> account;</span><br><span class="line"><span class="operator">+</span><span class="comment">----+------+-------+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span> name <span class="operator">|</span> money <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+------+-------+</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">1</span> <span class="operator">|</span> å¼ ä¸‰ <span class="operator">|</span>  <span class="number">2000</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">2</span> <span class="operator">|</span> æå›› <span class="operator">|</span>  <span class="number">1000</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">5</span> <span class="operator">|</span> ç‹äº” <span class="operator">|</span>  <span class="number">2000</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">9</span> <span class="operator">|</span> æå…­ <span class="operator">|</span>  <span class="number">2000</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+------+-------+</span></span><br><span class="line"></span><br><span class="line"># åœ¨è¿™æ ·çš„è¡¨ç»“æ„ä¸‹ï¼Œå¼€å¯ä¸€ä¸ªäº‹åŠ¡ï¼Œæ‰§è¡Œä»¥ä¸‹è¯­å¥</span><br><span class="line"><span class="keyword">begin</span>;</span><br><span class="line"><span class="keyword">update</span> account <span class="keyword">set</span> money<span class="operator">=</span><span class="number">100</span> <span class="keyword">where</span> id<span class="operator">=</span><span class="number">7</span>;</span><br><span class="line"># å› ä¸ºid<span class="operator">=</span><span class="number">7</span>æ˜¯ä¸å­˜åœ¨çš„è®°å½•ï¼Œæ‰€ä»¥ä¼šä¼˜åŒ–æˆid<span class="operator">=</span><span class="number">5</span>åˆ°id<span class="operator">=</span><span class="number">9</span>çš„é—´éš™é”ã€‚</span><br><span class="line"></span><br><span class="line"># ç„¶ååœ¨å¦ä¸€ä¸ªå®¢æˆ·ç«¯å¼€å¯ä¸€ä¸ªäº‹åŠ¡ï¼Œæ‰§è¡Œæµ‹è¯•</span><br><span class="line"><span class="keyword">begin</span>;</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> account <span class="keyword">value</span>(<span class="number">6</span>,<span class="string">&#x27;lily&#x27;</span>,<span class="number">2000</span>);</span><br><span class="line"># ä¼šè¢«é˜»å¡ä½ï¼Œå› ä¸ºè¢«ä¸Šäº†é—´éš™é”</span><br></pre></td></tr></table></figure><ol><li>ç´¢å¼•ä¸Šçš„ç­‰å€¼æŸ¥è¯¢(æ™®é€šç´¢å¼•)ï¼Œå‘å³éå†æ—¶æœ€åä¸€ä¸ªå€¼ä¸æ»¡è¶³æŸ¥è¯¢éœ€æ±‚æ—¶ï¼Œä¸´é”®é”é€€åŒ–ä¸ºé—´éš™é”</li><li>ç´¢å¼•ä¸Šçš„èŒƒå›´æŸ¥è¯¢(å”¯ä¸€ç´¢å¼•)â€”ä¼šè®¿é—®åˆ°ä¸æ»¡è¶³æ¡ä»¶çš„ç¬¬ä¸€ä¸ªå€¼ä¸ºæ­¢ã€‚</li></ol><p>æ³¨æ„:é—´éš™é”å”¯ä¸€ç›®çš„æ˜¯é˜²æ­¢å…¶ä»–äº‹åŠ¡æ’å…¥é—´éš™ã€‚é—´éš™é”å¯ä»¥å…±å­˜ï¼Œä¸€ä¸ªäº‹åŠ¡é‡‡ç”¨çš„é—´éš™é”ä¸ä¼šé˜»æ­¢å¦ä¸€ä¸ªäº‹åŠ¡åœ¨åŒä¸€é—´éš™ä¸Šé‡‡ç”¨é—´éš™é”ã€‚</p><h1 id="8-InnoDBå¼•æ“"><a href="#8-InnoDBå¼•æ“" class="headerlink" title="8.InnoDBå¼•æ“"></a>8.InnoDBå¼•æ“</h1><h2 id="8-1-InnoDBé€»è¾‘å­˜å‚¨ç»“æ„"><a href="#8-1-InnoDBé€»è¾‘å­˜å‚¨ç»“æ„" class="headerlink" title="8.1.InnoDBé€»è¾‘å­˜å‚¨ç»“æ„"></a>8.1.InnoDBé€»è¾‘å­˜å‚¨ç»“æ„</h2><p><img src="http://cdn.leesin.fun/typora/s3/img/InnoDBé€»è¾‘å­˜å‚¨ç»“æ„.png" alt="InnoDBé€»è¾‘å­˜å‚¨ç»“æ„"></p><h2 id="8-2-æ¶æ„"><a href="#8-2-æ¶æ„" class="headerlink" title="8.2.æ¶æ„"></a>8.2.æ¶æ„</h2><p>å·¦ä¾§æ˜¯å†…å­˜ç»“æ„ï¼Œå³ä¾§æ˜¯ç£ç›˜ç»“æ„</p><p><img src="http://cdn.leesin.fun/typora/s3/img/InnoDBæ¶æ„.png" alt="InnoDBæ¶æ„"></p><h3 id="8-2-1-å†…å­˜æ¶æ„"><a href="#8-2-1-å†…å­˜æ¶æ„" class="headerlink" title="8.2.1.å†…å­˜æ¶æ„"></a>8.2.1.å†…å­˜æ¶æ„</h3><p><img src="http://cdn.leesin.fun/typora/s3/img/InnoDBæ¶æ„-å†…å­˜æ¶æ„.png" alt="InnoDBæ¶æ„-å†…å­˜æ¶æ„"></p><p><img src="http://cdn.leesin.fun/typora/s3/img/InnoDBæ¶æ„-å†…å­˜æ¶æ„2.png" alt="InnoDBæ¶æ„-å†…å­˜æ¶æ„2"></p><p><img src="http://cdn.leesin.fun/typora/s3/img/InnoDBæ¶æ„-å†…å­˜æ¶æ„3.png" alt="InnoDBæ¶æ„-å†…å­˜æ¶æ„3"></p><p><img src="http://cdn.leesin.fun/typora/s3/img/InnoDBæ¶æ„-å†…å­˜æ¶æ„4.png" alt="InnoDBæ¶æ„-å†…å­˜æ¶æ„4"></p><h3 id="8-2-2-ç£ç›˜ç»“æ„"><a href="#8-2-2-ç£ç›˜ç»“æ„" class="headerlink" title="8.2.2.ç£ç›˜ç»“æ„"></a>8.2.2.ç£ç›˜ç»“æ„</h3><p><img src="http://cdn.leesin.fun/typora/s3/img/InnoDBæ¶æ„-ç£ç›˜æ¶æ„1.png" alt="InnoDBæ¶æ„-ç£ç›˜æ¶æ„1"></p><p><img src="http://cdn.leesin.fun/typora/s3/img/InnoDBæ¶æ„-ç£ç›˜æ¶æ„2.png" alt="InnoDBæ¶æ„-ç£ç›˜æ¶æ„2"></p><p><img src="http://cdn.leesin.fun/typora/s3/img/InnoDBæ¶æ„-ç£ç›˜æ¶æ„3.png" alt="InnoDBæ¶æ„-ç£ç›˜æ¶æ„3"></p><h3 id="8-2-3-åå°çº¿ç¨‹"><a href="#8-2-3-åå°çº¿ç¨‹" class="headerlink" title="8.2.3.åå°çº¿ç¨‹"></a>8.2.3.åå°çº¿ç¨‹</h3><p><img src="http://cdn.leesin.fun/typora/s3/img/InnoDBæ¶æ„-åå°çº¿ç¨‹.png" alt="InnoDBæ¶æ„-åå°çº¿ç¨‹"></p><h2 id="8-3-äº‹åŠ¡åŸç†â­â­â­"><a href="#8-3-äº‹åŠ¡åŸç†â­â­â­" class="headerlink" title="8.3.äº‹åŠ¡åŸç†â­â­â­"></a>8.3.äº‹åŠ¡åŸç†â­â­â­</h2><p><img src="http://cdn.leesin.fun/typora/s3/img/äº‹åŠ¡åŸç†.png" alt="äº‹åŠ¡åŸç†"></p><h3 id="8-3-1-redo-log"><a href="#8-3-1-redo-log" class="headerlink" title="8.3.1.redo log"></a>8.3.1.redo log</h3><p>==è§£å†³äº‹åŠ¡çš„æŒä¹…æ€§==</p><p>é‡åšæ—¥å¿—ï¼Œè®°å½•çš„æ˜¯äº‹åŠ¡æäº¤æ—¶æ•°æ®é¡µçš„ç‰©ç†ä¿®æ”¹ï¼Œæ˜¯ç”¨æ¥å®ç°äº‹åŠ¡çš„<strong>æŒä¹…æ€§</strong>ã€‚<br>è¯¥æ—¥å¿—æ–‡ä»¶ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼šé‡åšæ—¥å¿—ç¼“å†²(redo log buffer)ä»¥åŠé‡åšæ—¥å¿—æ–‡ä»¶(redo og file)ï¼Œå‰è€…æ˜¯åœ¨å†…å­˜ä¸­ï¼Œåè€…åœ¨ç£ç›˜ä¸­ã€‚å½“äº‹åŠ¡æäº¤ä¹‹åä¼šæŠŠæ‰€æœ‰ä¿®æ”¹ä¿¡æ¯éƒ½å­˜åˆ°è¯¥æ—¥å¿—æ–‡ä»¶ä¸­ï¼Œç”¨äºåœ¨åˆ·æ–°è„é¡µåˆ°ç£ç›˜ï¼Œå‘ç”Ÿé”™è¯¯æ—¶ï¼Œè¿›è¡Œæ•°æ®æ¢å¤ä½¿ç”¨ã€‚    </p><p><img src="http://cdn.leesin.fun/typora/s3/img/redo log.png" alt="redo log"></p><h3 id="8-3-2-undo-log"><a href="#8-3-2-undo-log" class="headerlink" title="8.3.2.undo log"></a>8.3.2.undo log</h3><p>==è§£å†³äº‹åŠ¡çš„åŸå­æ€§==</p><p>å›æ»šæ—¥å¿—ï¼Œç”¨äºè®°å½•æ•°æ®è¢«ä¿®æ”¹å‰çš„ä¿¡æ¯ï¼Œä½œç”¨åŒ…å«ä¸¤ä¸ª:æä¾›<strong>å›æ»š</strong> å’Œ <strong>MVCC</strong>(å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶)ã€‚</p><p>undo logå’Œredo logè®°å½•ç‰©ç†æ—¥å¿—ä¸ä¸€æ ·ï¼Œå®ƒæ˜¯é€»è¾‘æ—¥å¿—ã€‚å¯ä»¥è®¤ä¸ºå½“deleteä¸€æ¡è®°å½•æ—¶ï¼Œundo logä¸­ä¼šè®°å½•ä¸€æ¡å¯¹åº”çš„insertè®°å½•ï¼Œåä¹‹äº¦ç„¶ï¼Œå½“updateä¸€æ¡è®°å½•æ—¶ï¼Œå®ƒè®°å½•ä¸€æ¡å¯¹åº”ç›¸åçš„updateè®°å½•ã€‚å½“æ‰§è¡Œrollbackæ—¶ï¼Œå°±å¯ä»¥ä»undo logä¸­çš„é€»è¾‘è®°å½•è¯»å–åˆ°ç›¸åº”çš„å†…å®¹å¹¶è¿›è¡Œå›æ»šã€‚</p><ul><li><p>undo logé”€æ¯ï¼šundo logåœ¨äº‹åŠ¡æ‰§è¡Œæ—¶äº§ç”Ÿï¼Œäº‹åŠ¡æäº¤æ—¶ï¼Œå¹¶ä¸ä¼šç«‹å³åˆ é™¤undo logï¼Œå› ä¸ºè¿™äº›æ—¥å¿—å¯èƒ½è¿˜ç”¨äºMVCC.</p></li><li><p>undo logå­˜å‚¨ï¼šundo logé‡‡ç”¨æ®µçš„æ–¹å¼è¿›è¡Œç®¡ç†å’Œè®°å½•ï¼Œå­˜æ”¾åœ¨å‰é¢ä»‹ç»çš„ rollback segment å›æ»šæ®µä¸­ï¼Œå†…éƒ¨åŒ…å«1024ä¸ªundo log segmentã€‚</p></li></ul><h3 id="8-3-3-MVCCâ­â­â­"><a href="#8-3-3-MVCCâ­â­â­" class="headerlink" title="8.3.3.MVCCâ­â­â­"></a>8.3.3.MVCCâ­â­â­</h3><h4 id="8-3-3-1-åŸºæœ¬æ¦‚å¿µ"><a href="#8-3-3-1-åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="8.3.3.1.åŸºæœ¬æ¦‚å¿µ"></a>8.3.3.1.åŸºæœ¬æ¦‚å¿µ</h4><h5 id="å½“å‰è¯»"><a href="#å½“å‰è¯»" class="headerlink" title="å½“å‰è¯»"></a>å½“å‰è¯»</h5><p>è¯»å–çš„æ˜¯è®°å½•çš„æœ€æ–°ç‰ˆæœ¬ï¼Œè¯»å–æ—¶è¿˜è¦ä¿è¯å…¶ä»–å¹¶å‘äº‹åŠ¡ä¸èƒ½ä¿®æ”¹å½“å‰è®°å½•ï¼Œä¼šå¯¹è¯»å–çš„è®°å½•è¿›è¡ŒåŠ é”ã€‚å¯¹äºæˆ‘ä»¬æ—¥å¸¸çš„æ“ä½œï¼Œå¦‚ï¼šselect â€¦ lock in share mode(å…±äº«é”)ï¼Œ select â€¦ for updteã€ updateã€ insertã€delete(æ’ä»–é”)éƒ½æ˜¯ä¸€ç§å½“å‰è¯»ã€‚</p><h5 id="å¿«ç…§è¯»"><a href="#å¿«ç…§è¯»" class="headerlink" title="å¿«ç…§è¯»"></a>å¿«ç…§è¯»</h5><p>ç®€å•çš„select(ä¸åŠ é”)å°±æ˜¯å¿«ç…§è¯»ï¼Œå¿«ç…§è¯»ï¼Œè¯»å–çš„æ˜¯è®°å½•æ•°æ®çš„å¯è§ç‰ˆæœ¬ï¼Œæœ‰å¯èƒ½æ˜¯å†å²æ•°æ®ï¼Œä¸åŠ é”ï¼Œæ˜¯éé˜»å¡è¯»ã€‚</p><ul><li>Read Committedï¼šæ¯æ¬¡selectï¼Œéƒ½ç”Ÿæˆä¸€ä¸ªå¿«ç…§è¯»ã€‚</li><li>Repeatable Readï¼šå¼€å¯äº‹åŠ¡åç¬¬ä¸€ä¸ªselectè¯­å¥æ‰æ˜¯å¿«ç…§è¯»çš„åœ°æ–¹</li><li>Serializableï¼šå¿«ç…§è¯»ä¼šé€€åŒ–ä¸ºå½“å‰è¯»ã€‚    </li></ul><h5 id="MVCC"><a href="#MVCC" class="headerlink" title="MVCC"></a>MVCC</h5><p>å…¨ç§° Multi-Version Concurrency ontrolï¼Œ<strong>å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶</strong>ã€‚æŒ‡ç»´æŠ¤ä¸€ä¸ªæ•°æ®çš„å¤šä¸ªç‰ˆæœ¬ï¼Œä½¿å¾—è¯»å†™æ“ä½œæ²¡æœ‰å†²çªï¼Œå¿«ç…§è¯»ä¸ºMySQLå®ç°MVCCæä¾›äº†ä¸€ä¸ªéé˜»å¡è¯»åŠŸèƒ½ã€‚MVCCçš„å…·ä½“å®ç°ï¼Œè¿˜éœ€è¦ä¾èµ–äºæ•°æ®åº“è®°å½•ä¸­çš„ä¸‰ä¸ªéšå¼å­—æ®µã€undo logæ—¥å¿—ã€readViewã€‚</p><h5 id="è®°å½•ä¸­çš„éšè—å­—æ®µ"><a href="#è®°å½•ä¸­çš„éšè—å­—æ®µ" class="headerlink" title="è®°å½•ä¸­çš„éšè—å­—æ®µ"></a>è®°å½•ä¸­çš„éšè—å­—æ®µ</h5><p><img src="http://cdn.leesin.fun/typora/s3/img/è®°å½•ä¸­çš„éšè—å­—æ®µ.png" alt="è®°å½•ä¸­çš„éšè—å­—æ®µ"></p><h5 id="undo-log"><a href="#undo-log" class="headerlink" title="undo log"></a>undo log</h5><p>å›æ»šæ—¥å¿—ï¼Œåœ¨insertã€updateã€deleteçš„æ—¶å€™äº§ç”Ÿçš„ä¾¿äºæ•°æ®å›æ»šçš„æ—¥å¿—ã€‚</p><p><strong>å½“insertçš„æ—¶å€™</strong>ï¼Œäº§ç”Ÿçš„undo logæ—¥å¿—åªåœ¨å›æ»šæ—¶éœ€è¦ï¼Œ<strong>åœ¨äº‹åŠ¡æäº¤åï¼Œå¯è¢«ç«‹å³åˆ é™¤</strong>ã€‚</p><p><strong>è€Œupdateã€deleteçš„æ—¶å€™</strong>ï¼Œäº§ç”Ÿçš„undo logæ—¥å¿—<strong>ä¸ä»…åœ¨å›æ»šæ—¶éœ€è¦</strong>ï¼Œ<strong>åœ¨å¿«ç…§è¯»æ—¶ä¹Ÿéœ€è¦</strong>ï¼Œä¸ä¼šç«‹å³è¢«åˆ é™¤ã€‚</p><h5 id="undo-logç‰ˆæœ¬é“¾"><a href="#undo-logç‰ˆæœ¬é“¾" class="headerlink" title="undo logç‰ˆæœ¬é“¾"></a>undo logç‰ˆæœ¬é“¾</h5><p><img src="http://cdn.leesin.fun/typora/s3/img/undo logç‰ˆæœ¬é“¾.png" alt="undo logç‰ˆæœ¬é“¾"></p><p>ä¸åŒäº‹åŠ¡æˆ–ç›¸åŒäº‹åŠ¡å¯¹åŒä¸€æ¡è®°å½•è¿›è¡Œä¿®æ”¹ï¼Œä¼šå¯¼è‡´è¯¥è®°å½•çš„undo logç”Ÿæˆä¸€æ¡è®°å½•ç‰ˆæœ¬é“¾è¡¨ï¼Œé“¾è¡¨çš„å¤´éƒ¨æ˜¯æœ€æ–°çš„æ—§è®°å½•ï¼Œé“¾è¡¨å°¾éƒ¨æ˜¯æœ€æ—©çš„æ—§è®°å½•ã€‚</p><h5 id="readview"><a href="#readview" class="headerlink" title="readview"></a>readview</h5><p>ReadView(è¯»è§†å›¾)æ˜¯ <strong>å¿«ç…§è¯»</strong> SQLæ‰§è¡Œæ—¶MVCCæå–æ•°æ®çš„ä¾æ®ï¼Œè®°å½•å¹¶ç»´æŠ¤ç³»ç»Ÿå½“å‰æ´»è·ƒçš„äº‹åŠ¡(æœªæäº¤çš„)idã€‚<br>ReadViewä¸­åŒ…å«äº†å››ä¸ªæ ¸å¿ƒå­—æ®µï¼š</p><div class="table-container"><table><thead><tr><th>å­—æ®µ</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td>m_ids</td><td>å½“å‰æ´»è·ƒçš„äº‹åŠ¡IDé›†åˆ</td></tr><tr><td>min_trx_id</td><td>æœ€å°æ´»è·ƒäº‹åŠ¡ID</td></tr><tr><td>max_trx_id</td><td>é¢„åˆ†é…äº‹åŠ¡IDï¼Œå½“å‰æœ€å¤§äº‹åŠ¡ID+1ï¼ˆå› ä¸ºäº‹åŠ¡IDæ˜¯è‡ªå¢çš„ï¼‰</td></tr><tr><td>creator_trx_id</td><td>ReadViewåˆ›å»ºè€…çš„äº‹åŠ¡ID</td></tr></tbody></table></div><p><img src="http://cdn.leesin.fun/typora/s3/img/readView.png" alt="readView"></p><p>==ä¸åŒçš„éš”ç¦»çº§åˆ«ï¼Œç”ŸæˆReadViewçš„æ—¶æœºä¸åŒï¼š==</p><ul><li>==READ COMMITTEDï¼šåœ¨äº‹åŠ¡ä¸­æ¯ä¸€æ¬¡æ‰§è¡Œå¿«ç…§è¯»æ—¶ç”ŸæˆReadViewã€‚==</li><li>==REPEATABLE READï¼šä»…åœ¨äº‹åŠ¡ä¸­ç¬¬ä¸€æ¬¡æ‰§è¡Œå¿«ç…§è¯»æ—¶ç”ŸæˆReadViewï¼Œåç»­å¤ç”¨è¯¥ReadViewã€‚==</li></ul><p>ä¸‹é¢ä¸¾ä¾‹è¯´æ˜</p><p>ä¸¾ä¾‹1ï¼Œread committedï¼ˆå¯ä»¥çœ‹è§†é¢‘<a href="https://www.bilibili.com/video/BV1Kr4y1i7ru?p=145ï¼‰">https://www.bilibili.com/video/BV1Kr4y1i7ru?p=145ï¼‰</a></p><p><img src="http://cdn.leesin.fun/typora/s3/img/readviewä¸¾ä¾‹ä¹‹read committed1.png" alt="readviewä¸¾ä¾‹ä¹‹read committed1"></p><p><img src="http://cdn.leesin.fun/typora/s3/img/readviewä¸¾ä¾‹ä¹‹read committed2.png" alt="readviewä¸¾ä¾‹ä¹‹read committed2"></p><p>ä¸¾ä¾‹2ï¼Œrepeatable readï¼ˆå¯ä»¥çœ‹è§†é¢‘<a href="https://www.bilibili.com/video/BV1Kr4y1i7ru?p=146ï¼‰">https://www.bilibili.com/video/BV1Kr4y1i7ru?p=146ï¼‰</a></p><p><img src="http://cdn.leesin.fun/typora/s3/img/readviewä¸¾ä¾‹ä¹‹repeatable read.png" alt="readviewä¸¾ä¾‹ä¹‹repeatable read"></p><h3 id="8-3-4-äº‹åŠ¡åŸç†æ€»ç»“â­â­â­"><a href="#8-3-4-äº‹åŠ¡åŸç†æ€»ç»“â­â­â­" class="headerlink" title="8.3.4.äº‹åŠ¡åŸç†æ€»ç»“â­â­â­"></a>8.3.4.äº‹åŠ¡åŸç†æ€»ç»“â­â­â­</h3><p><img src="http://cdn.leesin.fun/typora/s3/img/äº‹åŠ¡åŸç†æ€»ç»“.png" alt="äº‹åŠ¡åŸç†æ€»ç»“"></p><h1 id="9-MySQLç®¡ç†"><a href="#9-MySQLç®¡ç†" class="headerlink" title="9.MySQLç®¡ç†"></a>9.MySQLç®¡ç†</h1><h2 id="9-1-ç³»ç»Ÿæ•°æ®åº“"><a href="#9-1-ç³»ç»Ÿæ•°æ®åº“" class="headerlink" title="9.1.ç³»ç»Ÿæ•°æ®åº“"></a>9.1.ç³»ç»Ÿæ•°æ®åº“</h2><p>Mysqlæ•°æ®åº“å®‰è£…å®Œæˆåï¼Œè‡ªå¸¦äº†ä¸€ä¸‹å››ä¸ªæ•°æ®åº“ï¼Œå…·ä½“ä½œç”¨å¦‚ä¸‹ï¼š</p><div class="table-container"><table><thead><tr><th>æ•°æ®åº“</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td>mysql</td><td>å­˜å‚¨MySQLæœåŠ¡å™¨æ­£å¸¸è¿è¡Œæ‰€éœ€è¦çš„å„ç§ä¿¡æ¯ (æ—¶åŒºã€ä¸»ä»ã€ç”¨æˆ·ã€æƒé™ç­‰)</td></tr><tr><td>information_schema</td><td>æä¾›äº†è®¿é—®æ•°æ®åº“å…ƒæ•°æ®çš„å„ç§è¡¨å’Œè§†å›¾ï¼ŒåŒ…å«æ•°æ®åº“ã€è¡¨ã€å­—æ®µç±»å‹åŠè®¿é—®æƒé™ç­‰</td></tr><tr><td>performance_schema</td><td>ä¸ºMysQLæœåŠ¡å™¨é€è¡Œæ—¶çŠ¶æ€æä¾›äº†ä¸€ä¸ªåº•å±‚ç›‘æ§åŠŸèƒ½ï¼Œä¸»è¦ç”¨äºæ”¶é›†æ•°æ®åº“æœåŠ¡å™¨æ€§èƒ½å‚æ•°</td></tr><tr><td>sys</td><td>åŒ…å«äº†ä¸€ç³»åˆ—æ–¹ä¾¿DBAå’Œå¼€å‘äººå‘˜åˆ©ç”¨ performance schemaæ€§èƒ½æ•°æ®åº“è¿›è¡Œæ€§èƒ½è°ƒä¼˜å’Œè¯Šæ–­çš„è§†å›¾</td></tr></tbody></table></div><h2 id="9-2-å¸¸ç”¨å·¥å…·"><a href="#9-2-å¸¸ç”¨å·¥å…·" class="headerlink" title="9.2.å¸¸ç”¨å·¥å…·"></a>9.2.å¸¸ç”¨å·¥å…·</h2><h3 id="9-2-1-mysql"><a href="#9-2-1-mysql" class="headerlink" title="9.2.1.mysql"></a>9.2.1.mysql</h3><p>è¯¥mysqlä¸æ˜¯æŒ‡mysqlæœåŠ¡ï¼Œè€Œæ˜¯æŒ‡mysqlçš„å®¢æˆ·ç«¯å·¥å…·ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">è¯­æ³• :</span><br><span class="line">mysql [options] [database]</span><br><span class="line">é€‰é¡¹:</span><br><span class="line">    -u, --user=name    <span class="comment">#æŒ‡å®šç”¨æˆ·å</span></span><br><span class="line">    -p,--password[=namel    <span class="comment">#æŒ‡å®šå¯†ç </span></span><br><span class="line">    -h, --host=name    <span class="comment">#æŒ‡å®šæœåŠ¡å™¨IPæˆ–åŸŸå</span></span><br><span class="line">    -P,--port=port    <span class="comment">#æŒ‡å®šè¿æ¥ç«¯å£</span></span><br><span class="line">    -e,--execute=name    <span class="comment">#æ‰§è¡ŒSQLè¯­å¥å¹¶é€€å‡º</span></span><br><span class="line"></span><br><span class="line">ä¾‹å¦‚ï¼š</span><br><span class="line">mysql -hitachi102 -uroot -proot -P3306</span><br></pre></td></tr></table></figure><p>-eé€‰é¡¹å¯ä»¥åœ¨Mysqlå®¢æˆ·ç«¯æ‰§è¡ŒSQLè¯­å¥ï¼Œè€Œä¸ç”¨è¿æ¥åˆ°MyQLæ•°æ®åº“å†æ‰§è¡Œï¼Œå¯¹äºä¸€äº›æ‰¹å¤„ç†è„šæœ¬ï¼Œè¿™ç§æ–¹å¼å°¤å…¶æ–¹ä¾¿ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -uroot -proot db01 -e<span class="string">&quot;select * from stu&quot;</span></span><br></pre></td></tr></table></figure><h3 id="9-2-2-mysqladmin"><a href="#9-2-2-mysqladmin" class="headerlink" title="9.2.2.mysqladmin"></a>9.2.2.mysqladmin</h3><p>mysqladmin æ˜¯ä¸€ä¸ªæ‰§è¡Œç®¡ç†æ“ä½œçš„å®¢æˆ·ç«¯ç¨‹åºã€‚å¯ä»¥ç”¨å®ƒæ¥æ£€æŸ¥æœåŠ¡å™¨çš„é…ç½®å’Œå½“å‰çŠ¶æ€ã€åˆ›å»ºå¹¶åˆ é™¤æ•°æ®åº“ç­‰ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é€šè¿‡å¸®åŠ©æ–‡æ¡£æŸ¥çœ‹é€‰é¡¹</span></span><br><span class="line">mysqladmin --<span class="built_in">help</span></span><br></pre></td></tr></table></figure><h3 id="9-2-3-mysqlbinlogâ­â­â­"><a href="#9-2-3-mysqlbinlogâ­â­â­" class="headerlink" title="9.2.3.mysqlbinlogâ­â­â­"></a>9.2.3.mysqlbinlogâ­â­â­</h3><p>ç”±äºæœåŠ¡å™¨ç”Ÿæˆçš„äºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶ä»¥äºŒè¿›åˆ¶æ ¼å¼ä¿å­˜ï¼Œæ‰€ä»¥å¦‚æœæƒ³è¦æ£€æŸ¥è¿™äº›æ–‡æœ¬çš„æ–‡æœ¬æ ¼å¼ï¼Œå°±ä¼šä½¿ç”¨åˆ°myslbinlog æ—¥å¿—ç®¡ç†å·¥å…·ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">è¯­æ³• :</span><br><span class="line">mysqlbinlog [options] log-files1 ...</span><br><span class="line">é€‰é¡¹ :</span><br><span class="line"><span class="comment"># æŒ‡å®šæ•°æ®åº“åç§°ï¼Œåªåˆ—å‡ºæŒ‡å®šçš„æ•°æ®åº“ç›¸å…³æ“ä½œã€‚</span></span><br><span class="line">    -d,--database=name</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># å¿½ç•¥æ‰æ—¥å¿—ä¸­çš„å‰nè¡Œå‘½ä»¤ã€‚</span></span><br><span class="line">    -o,--offset=</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># å°†è¡Œäº‹ä»¶ï¼ˆæ•°æ®å˜æ›´ï¼‰é‡æ„ä¸ºSQLè¯­å¥</span></span><br><span class="line">    -v</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># å°†è¡Œäº‹ä»¶ï¼ˆæ•°æ®å˜æ›´ï¼‰é‡æ„ä¸ºSQLè¯­å¥ï¼Œå¹¶è¾“å‡ºæ³¨é‡Šä¿¡æ¯</span></span><br><span class="line">    -w</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># å°†è¾“å‡ºçš„æ–‡æœ¬æ ¼å¼æ—¥å¿—è¾“å‡ºåˆ°æŒ‡å®šæ–‡ä»¶ã€‚</span></span><br><span class="line">    -r,--result-file=name</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># æ˜¾ç¤ºç®€å•æ ¼å¼ï¼Œçœç•¥æ‰ä¸€äº›ä¿¡æ¯ã€‚</span></span><br><span class="line">    -s, --short-form</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># æŒ‡å®šæ—¥æœŸé—´éš”å†…çš„æ‰€æœ‰æ—¥å¿—</span></span><br><span class="line">    --start-datatime=date1 --stop-datetime=date2</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># æŒ‡å®šä½ç½®é—´éš”å†…çš„æ‰€æœ‰æ—¥å¿—ã€‚</span></span><br><span class="line">    --start-position=pos1 --stop-position=pos2</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ä¸¾ä¾‹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è¿›å…¥Linux</span></span><br><span class="line"><span class="comment"># è¿›å…¥mysqlæ—¥å¿—æ–‡ä»¶å­˜æ”¾çš„ä½ç½®</span></span><br><span class="line"><span class="comment"># llæŸ¥çœ‹æ–‡ä»¶</span></span><br><span class="line"><span class="comment"># mysqlbinlogæŸ¥çœ‹æ—¥å¿—æ–‡ä»¶</span></span><br><span class="line">[root@itachi102 mysql]<span class="comment"># cd /var/lib/mysql</span></span><br><span class="line">[root@itachi102 mysql]<span class="comment"># ll</span></span><br><span class="line">[root@itachi102 mysql]<span class="comment"># mysqlbinlog binlog.000001</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="9-2-4-mysqlshow"><a href="#9-2-4-mysqlshow" class="headerlink" title="9.2.4.mysqlshow"></a>9.2.4.mysqlshow</h3><p>mysqlshow å®¢æˆ·ç«¯å¯¹è±¡æŸ¥æ‰¾å·¥å…·ï¼Œç”¨æ¥å¾ˆå¿«åœ°æŸ¥æ‰¾å­˜åœ¨å“ªäº›æ•°æ®åº“ã€æ•°æ®åº“ä¸­çš„è¡¨ã€è¡¨ä¸­çš„åˆ—æˆ–è€…ç´¢å¼•ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">è¯­æ³• :</span><br><span class="line">mysqlshow [options] [db_name[table_name[col_name]]]</span><br><span class="line">é€‰é¡¹:</span><br><span class="line">--count<span class="comment"># æ˜¾ç¤ºæ•°æ®åº“åŠè¡¨çš„ç»Ÿè®¡ä¿¡æ¯ (æ•°æ®åº“ï¼Œè¡¨ å‡å¯ä»¥ä¸æŒ‡å®š)</span></span><br><span class="line">-i<span class="comment"># æ˜¾ç¤ºæŒ‡å®šæ•°æ®åº“æˆ–è€…æŒ‡å®šè¡¨çš„çŠ¶æ€ä¿¡æ¯</span></span><br></pre></td></tr></table></figure><p>ä¸¾ä¾‹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#æŸ¥è¯¢æ¯ä¸ªæ•°æ®åº“çš„è¡¨çš„æ•°é‡åŠè¡¨ä¸­è®°å½•çš„æ•°é‡</span></span><br><span class="line">mysqlshow -uroot -proot --count</span><br><span class="line"></span><br><span class="line"><span class="comment">#æŸ¥è¯¢teståº“ä¸­æ¯ä¸ªè¡¨ä¸­çš„å­—æ®µæ•°ï¼ŒåŠè¡Œæ•°</span></span><br><span class="line">mysqlshow -uroot -proot <span class="built_in">test</span> --count</span><br><span class="line"></span><br><span class="line"><span class="comment">#æŸ¥è¯¢teståº“ä¸­bookè¡¨çš„è¯¦ç»†æƒ…å†µ</span></span><br><span class="line">mysqlshow -uroot -proot <span class="built_in">test</span> book --count</span><br></pre></td></tr></table></figure><h3 id="9-2-5-mysqldump"><a href="#9-2-5-mysqldump" class="headerlink" title="9.2.5.mysqldump"></a>9.2.5.mysqldump</h3><p>mysqldump å®¢æˆ·ç«¯å·¥å…·ç”¨å¤‡ä»½æ•°æ®åº“æˆ–åœ¨ä¸åŒæ•°æ®åº“ä¹‹é—´è¿›è¡Œæ•°æ®è¿ç§»ã€‚å¤‡ä»½å†…å®¹åŒ…å«åˆ›å»ºè¡¨ï¼ŒåŠæ’å…¥è¡¨çš„SOLè¯­å¥ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">è¯­æ³•ï¼š</span><br><span class="line">mysqldump [options] db_name [tables]</span><br><span class="line">mysqldump [options] --database/-B db1 [db2 db3...]</span><br><span class="line">mysqldump [options] --all-databases/-A</span><br><span class="line"></span><br><span class="line">è¿æ¥é€‰é¡¹ï¼š</span><br><span class="line">-u,--user=name<span class="comment">#æŒ‡å®šç”¨æˆ·å</span></span><br><span class="line">-p,--password[=name]<span class="comment">#æŒ‡å®šå¯†ç </span></span><br><span class="line">-h,--host=name<span class="comment">#æŒ‡å®šæœåŠ¡å™¨ipæˆ–åŸŸå</span></span><br><span class="line">-P,--port=<span class="comment">#æŒ‡å®šè¿æ¥ç«¯å£</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">è¾“å‡ºé€‰é¡¹ï¼š</span><br><span class="line"></span><br><span class="line"><span class="comment">#åœ¨æ¯ä¸ªæ•°æ®åº“åˆ›å»ºè¯­å¥å‰åŠ ä¸Š drop database è¯­å¥</span></span><br><span class="line">--add-drop-database</span><br><span class="line"><span class="comment">#åœ¨æ¯ä¸ªè¡¨åˆ›å»ºè¯­å¥å‰åŠ ä¸Š drop table è¯­å¥ï¼Œé»˜è®¤å¼€å¯ ;ä¸å¼€å¯(--skip-add-drop-table)</span></span><br><span class="line">--add-drop-table</span><br><span class="line">    <span class="comment">#ä¸åŒ…å«æ•°æ®åº“çš„åˆ›å»ºè¯­å¥</span></span><br><span class="line">-n,--no-create-db</span><br><span class="line"><span class="comment">#ä¸åŒ…å«æ•°æ®è¡¨çš„åˆ›å»ºè¯­å¥</span></span><br><span class="line">-t,--no-create-info</span><br><span class="line"><span class="comment">#ä¸åŒ…å«æ•°æ®</span></span><br><span class="line">-d --no-data</span><br><span class="line"><span class="comment">#è‡ªåŠ¨ç”Ÿæˆä¸¤ä¸ªæ–‡ä»¶:ä¸€ä¸ª.sqlæ–‡ä»¶ï¼Œåˆ›å»ºè¡¨ç»“æ„çš„è¯­å¥;ä¸€ä¸ª.txtæ–‡ä»¶ï¼Œæ•°æ®æ–‡ä»¶</span></span><br><span class="line">-T,--tab=name</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ä¸¾ä¾‹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¤‡ä»½æ•°æ®åº“db01</span></span><br><span class="line">mysqldump -uroot -proot db01 &gt; db01.sql</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¤‡ä»½æ•°æ®åº“db01ï¼Œåªå¤‡ä»½è¡¨ç»“æ„ä¸å¤‡ä»½æ•°æ®</span></span><br><span class="line">mysqldump -uroot -proot -d db01 &gt; db02.sql</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¤‡ä»½æ•°æ®åº“db01ä¸‹çš„scoreè¡¨ï¼Œå¹¶ä¸”å°†è¡¨ç»“æ„è¾“å‡ºä¸º.sqlæ–‡ä»¶ï¼Œå°†æ•°æ®è¾“å‡ºä¸º.txtæ–‡ä»¶</span></span><br><span class="line"><span class="comment"># å¹¶æŒ‡å®šè¾“å‡ºçš„ç›®å½•ä¸º/var/lib/mysql-files/</span></span><br><span class="line">mysqldump -uroot -proot -T /var/lib/mysql-files/ db01 score</span><br></pre></td></tr></table></figure><h3 id="9-2-6-mysqlimport"><a href="#9-2-6-mysqlimport" class="headerlink" title="9.2.6.mysqlimport"></a>9.2.6.mysqlimport</h3><p>mysqlimportæ˜¯å®¢æˆ·ç«¯æ•°æ®å¯¼å…¥å·¥å…·ï¼Œç”¨æ¥å¯¼å…¥mysqldump åŠ -Tå‚æ•°åå¯¼å‡ºçš„æ–‡æœ¬æ–‡ä»¶ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">è¯­æ³•ï¼š</span><br><span class="line">mysqlimport [options] db_name textfile1 [textfile2 ...]</span><br><span class="line">ç¤ºä¾‹ï¼š</span><br><span class="line">mysqlimport -uroot -proot db01 /var/lib/mysql-files/score.txt</span><br><span class="line"><span class="comment"># æ³¨æ„ï¼šæ–‡ä»¶åå°±æ˜¯è¡¨å</span></span><br></pre></td></tr></table></figure><h3 id="9-2-7-source"><a href="#9-2-7-source" class="headerlink" title="9.2.7.source"></a>9.2.7.source</h3><p>å¦‚æœéœ€è¦å¯¼å…¥sqlæ–‡ä»¶ï¼Œå¯ä»¥ä½¿ç”¨sourceæŒ‡ä»¤ï¼Œä½†æ˜¯è¿™ä¸ªæŒ‡ä»¤è¦è¿›å…¥mysqlä¸­çš„</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">è¯­æ³•ï¼š</span><br><span class="line"><span class="built_in">source</span> /.../xxx.sql</span><br></pre></td></tr></table></figure><h1 id="10-è¿ç»´"><a href="#10-è¿ç»´" class="headerlink" title="10.è¿ç»´"></a>10.è¿ç»´</h1><h2 id="10-1-æ—¥å¿—â­â­â­"><a href="#10-1-æ—¥å¿—â­â­â­" class="headerlink" title="10.1.æ—¥å¿—â­â­â­"></a>10.1.æ—¥å¿—â­â­â­</h2><h3 id="10-1-1-é”™è¯¯æ—¥å¿—"><a href="#10-1-1-é”™è¯¯æ—¥å¿—" class="headerlink" title="10.1.1.é”™è¯¯æ—¥å¿—"></a>10.1.1.é”™è¯¯æ—¥å¿—</h3><p>é”™è¯¯æ—¥å¿—æ˜¯ MySQL ä¸­æœ€é‡è¦çš„æ—¥å¿—ä¹‹ä¸€ï¼Œå®ƒè®°å½•äº†å½“ mysld å¯åŠ¨å’Œåœæ­¢æ—¶ï¼Œä»¥åŠæœåŠ¡å™¨åœ¨è¿è¡Œè¿‡ç¨‹ä¸­å‘ç”Ÿä»»ä½•ä¸¥é‡é”™è¯¯æ—¶çš„ç›¸å…³ä¿¡æ¯ã€‚<strong>å½“æ•°æ®åº“å‡ºç°ä»»ä½•æ•…éšœå¯¼è‡´æ— æ³•æ­£å¸¸ä½¿ç”¨æ—¶ï¼Œå»ºè®®é¦–å…ˆæŸ¥çœ‹æ­¤æ—¥å¿—ã€‚</strong></p><p>è¯¥æ—¥å¿—æ˜¯é»˜è®¤å¼€å¯çš„ï¼Œé»˜è®¤å­˜æ”¾ç›®å½• <code>/var/log/</code> ï¼Œé»˜è®¤çš„æ—¥å¿—æ–‡ä»¶åä¸º <code>mysqld.log</code> ã€‚</p><p>è¿›å…¥mysqlæŸ¥çœ‹æ—¥å¿—ä½ç½®:</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">show</span> variables <span class="keyword">like</span> <span class="string">&#x27;log_error&#x27;</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">---------------+---------------------+</span></span><br><span class="line"><span class="operator">|</span> Variable_name <span class="operator">|</span> <span class="keyword">Value</span>               <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------------+---------------------+</span></span><br><span class="line"><span class="operator">|</span> log_error     <span class="operator">|</span> <span class="operator">/</span>var<span class="operator">/</span>log<span class="operator">/</span>mysqld.log <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------------+---------------------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.07</span> sec)</span><br></pre></td></tr></table></figure><p>ä¾‹å¦‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">tail</span> -50 /var/log/mysqld.log </span><br><span class="line"><span class="built_in">tail</span> -f /var/log/mysqld.log </span><br></pre></td></tr></table></figure><h3 id="10-1-2-äºŒè¿›åˆ¶æ—¥å¿—"><a href="#10-1-2-äºŒè¿›åˆ¶æ—¥å¿—" class="headerlink" title="10.1.2.äºŒè¿›åˆ¶æ—¥å¿—"></a>10.1.2.äºŒè¿›åˆ¶æ—¥å¿—</h3><p>äºŒè¿›åˆ¶æ—¥å¿—ï¼ˆBINLOGï¼‰è®°å½•äº†æ‰€æœ‰çš„ DDLï¼ˆæ•°æ®å®šä¹‰è¯­è¨€ï¼‰è¯­å¥å’Œ DMLï¼ˆæ•°æ®æ“çºµè¯­è¨€ï¼‰è¯­å¥ï¼Œä½†ä¸åŒ…æ‹¬æ•°æ®æŸ¥è¯¢(SELECTã€SHOW)è¯­å¥ã€‚</p><p>ä½œç”¨ï¼š</p><ol><li><p><strong>ç¾éš¾æ—¶çš„æ•°æ®æ¢å¤</strong></p></li><li><p><strong>MSQLçš„ä¸»ä»å¤åˆ¶</strong></p></li></ol><p>åœ¨MySL8ç‰ˆæœ¬ä¸­ï¼Œé»˜è®¤äºŒè¿›åˆ¶æ—¥å¿—æ˜¯å¼€å¯ç€çš„ï¼Œæ¶‰åŠåˆ°çš„å‚æ•°å¦‚ä¸‹:</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">show</span> variables <span class="keyword">like</span> <span class="string">&#x27;%log_bin%&#x27;</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">---------------------------------+-----------------------------+</span></span><br><span class="line"><span class="operator">|</span> Variable_name                   <span class="operator">|</span> <span class="keyword">Value</span>                       <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------------------------------+-----------------------------+</span></span><br><span class="line"><span class="operator">|</span> log_bin                         <span class="operator">|</span> <span class="keyword">ON</span>                          <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> log_bin_basename                <span class="operator">|</span> <span class="operator">/</span>var<span class="operator">/</span>lib<span class="operator">/</span>mysql<span class="operator">/</span>binlog       <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> log_bin_index                   <span class="operator">|</span> <span class="operator">/</span>var<span class="operator">/</span>lib<span class="operator">/</span>mysql<span class="operator">/</span>binlog.index <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> log_bin_trust_function_creators <span class="operator">|</span> OFF                         <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> log_bin_use_v1_row_events       <span class="operator">|</span> OFF                         <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> sql_log_bin                     <span class="operator">|</span> <span class="keyword">ON</span>                          <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------------------------------+-----------------------------+</span></span><br><span class="line"><span class="number">6</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><p>åœ¨linuxçœ‹çœ‹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@itachi102 mysql-files]<span class="comment"># cd /var/lib/mysql/</span></span><br><span class="line">[root@itachi102 mysql]<span class="comment"># ll</span></span><br><span class="line">-rw-r-----. 1 mysql mysql      998 3æœˆ  10 17:43 binlog.000001</span><br><span class="line">-rw-r-----. 1 mysql mysql     9824 3æœˆ  12 18:28 binlog.000002</span><br><span class="line">-rw-r-----. 1 mysql mysql       32 3æœˆ  10 17:44 binlog.index</span><br><span class="line">[root@itachi102 mysql]<span class="comment"># cat binlog.index </span></span><br><span class="line">./binlog.000001</span><br><span class="line">./binlog.000002</span><br></pre></td></tr></table></figure><h4 id="æ—¥å¿—æ ¼å¼"><a href="#æ—¥å¿—æ ¼å¼" class="headerlink" title="æ—¥å¿—æ ¼å¼"></a>æ—¥å¿—æ ¼å¼</h4><p>MySQLæœåŠ¡å™¨ä¸­æä¾›äº†å¤šç§æ ¼å¼æ¥è®°å½•äºŒè¿›åˆ¶æ—¥å¿—:</p><div class="table-container"><table><thead><tr><th>æ—¥å¿—æ ¼å¼</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td>STATEMENT</td><td>åŸºäºSQLè¯­å¥çš„æ—¥å¿—è®°å½•ï¼Œè®°å½•çš„æ˜¯SQLè¯­å¥ï¼Œå¯¹æ•°æ®è¿›è¡Œä¿®æ”¹çš„SQLéƒ½ä¼šè®°å½•åœ¨æ—¥å¿—æ–‡ä»¶ä¸­ã€‚</td></tr><tr><td>ROW</td><td>åŸºäºè¡Œçš„æ—¥å¿—è®°å½•ï¼Œè®°å½•çš„æ˜¯æ¯ä¸€è¡Œçš„æ•°æ®å˜æ›´ã€‚(é»˜è®¤)</td></tr><tr><td>MIXED</td><td>æ··åˆäº†STATEMENTå’ŒROWä¸¤ç§æ ¼å¼ï¼Œé»˜è®¤é‡‡ç”¨STATEMENTï¼Œåœ¨æŸäº›ç‰¹æ®Šæƒ…å†µä¸‹ä¼šè‡ªåŠ¨åˆ‡æ¢ä¸ºROWè¿›è¡Œè®°å½•ã€‚</td></tr></tbody></table></div><p>æŸ¥çœ‹å½“å‰mysqlç‰ˆæœ¬ä¸­ï¼Œé»˜è®¤çš„æ—¥å¿—æ ¼å¼æ˜¯å“ªç§</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">show</span> variables <span class="keyword">like</span> <span class="string">&#x27;binlog_format&#x27;</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">---------------+-------+</span></span><br><span class="line"><span class="operator">|</span> Variable_name <span class="operator">|</span> <span class="keyword">Value</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------------+-------+</span></span><br><span class="line"><span class="operator">|</span> binlog_format <span class="operator">|</span> <span class="type">ROW</span>   <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------------+-------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><h4 id="æ—¥å¿—æŸ¥çœ‹"><a href="#æ—¥å¿—æŸ¥çœ‹" class="headerlink" title="æ—¥å¿—æŸ¥çœ‹"></a>æ—¥å¿—æŸ¥çœ‹</h4><p>å‰é¢æœ‰ç¬”è®°  6.2.3.mysqlbinlog</p><h4 id="æ—¥å¿—åˆ é™¤"><a href="#æ—¥å¿—åˆ é™¤" class="headerlink" title="æ—¥å¿—åˆ é™¤"></a>æ—¥å¿—åˆ é™¤</h4><p>å¯¹äºæ¯”è¾ƒç¹å¿™çš„ä¸šåŠ¡ç³»ç»Ÿï¼Œæ¯å¤©ç”Ÿæˆçš„binlogæ•°æ®å·¨å¤§ï¼Œå¦‚æœé•¿æ—¶é—´ä¸æ¸…é™¤ï¼Œå°†ä¼šå ç”¨å¤§é‡ç£ç›˜ç©ºé—´ã€‚å¯ä»¥é€šè¿‡ä»¥ä¸‹å‡ ç§æ–¹å¼æ¸…ç†æ—¥å¿—:</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># åˆ é™¤å…¨éƒ¨binlogæ—¥å¿—ï¼Œåˆ é™¤ä¹‹åï¼Œæ—¥å¿—ç¼–å·å°†ä¼šä»binlog<span class="number">.000001</span>å¼€å§‹ç¼–å·</span><br><span class="line">reset master</span><br><span class="line"></span><br><span class="line"># åˆ é™¤<span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span>ç¼–å·ä¹‹å‰çš„æ‰€æœ‰æ—¥å¿—</span><br><span class="line">purge master logs <span class="keyword">to</span> <span class="string">&#x27;binlog.******&#x27;</span></span><br><span class="line"></span><br><span class="line"># åˆ é™¤æ—¥å¿—ä¸º&quot;yyyy-mm-dd hh24:mi:ss&quot;ä¹‹å‰äº§ç”Ÿçš„æ‰€æœ‰æ—¥å¿—</span><br><span class="line">purge master logs before <span class="string">&#x27;yyyy-mm-dd hh24:mi:ss&#x27;</span></span><br></pre></td></tr></table></figure><p>å¦‚æœä¸æ‰‹åŠ¨åˆ é™¤ï¼Œmysqlä¹Ÿä¼šåœ¨ä¸€å®šæ—¶é—´å†…åˆ é™¤ã€‚</p><p>æŸ¥çœ‹è¿‡æœŸæ—¶é—´çš„è¯­å¥ï¼šï¼ˆé»˜è®¤æ˜¯30å¤©çš„è¿‡æœŸæ—¶é—´ï¼‰</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">show</span> variables <span class="keyword">like</span> <span class="string">&#x27;binlog_expire_logs_seconds&#x27;</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">----------------------------+---------+</span></span><br><span class="line"><span class="operator">|</span> Variable_name              <span class="operator">|</span> <span class="keyword">Value</span>   <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------------------------+---------+</span></span><br><span class="line"><span class="operator">|</span> binlog_expire_logs_seconds <span class="operator">|</span> <span class="number">2592000</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------------------------+---------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.01</span> sec)</span><br></pre></td></tr></table></figure><p>å½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨mysqlé…ç½®æ–‡ä»¶ä¸­æ‰‹åŠ¨ä¿®æ”¹äºŒè¿›åˆ¶æ–‡ä»¶çš„è¿‡æœŸæ—¶é—´ã€‚</p><h3 id="10-1-3-æŸ¥è¯¢æ—¥å¿—"><a href="#10-1-3-æŸ¥è¯¢æ—¥å¿—" class="headerlink" title="10.1.3.æŸ¥è¯¢æ—¥å¿—"></a>10.1.3.æŸ¥è¯¢æ—¥å¿—</h3><p>æŸ¥è¯¢æ—¥å¿—ä¸­è®°å½•äº†å®¢æˆ·ç«¯çš„æ‰€æœ‰æ“ä½œè¯­å¥ï¼Œè€ŒäºŒè¿›åˆ¶æ—¥å¿—ä¸åŒ…å«æŸ¥è¯¢æ•°æ®çš„SQLè¯­å¥ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒæŸ¥è¯¢æ—¥å¿—æ˜¯æœªå¼€å¯çš„ã€‚å¦‚æœéœ€è¦å¼€å¯æŸ¥è¯¢æ—¥å¿—ï¼Œå¯ä»¥å» <code>/etc/my.cnf</code>  æœ«å°¾è¿½åŠ  <code>general_log=1</code>ï¼Œç„¶åé‡å¯æœåŠ¡ã€‚</p><p>æŸ¥çœ‹é»˜è®¤æƒ…å†µçš„è¯­å¥ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">show</span> variables <span class="keyword">like</span> <span class="string">&#x27;%general%&#x27;</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">------------------+------------------------------+</span></span><br><span class="line"><span class="operator">|</span> Variable_name    <span class="operator">|</span> <span class="keyword">Value</span>                        <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------------------+------------------------------+</span></span><br><span class="line"><span class="operator">|</span> general_log      <span class="operator">|</span> OFF                          <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> general_log_file <span class="operator">|</span> <span class="operator">/</span>var<span class="operator">/</span>lib<span class="operator">/</span>mysql<span class="operator">/</span>itachi102.log <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------------------+------------------------------+</span></span><br><span class="line"><span class="number">2</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.01</span> sec)</span><br></pre></td></tr></table></figure><h3 id="10-1-4-æ…¢æŸ¥è¯¢æ—¥å¿—"><a href="#10-1-4-æ…¢æŸ¥è¯¢æ—¥å¿—" class="headerlink" title="10.1.4.æ…¢æŸ¥è¯¢æ—¥å¿—"></a>10.1.4.æ…¢æŸ¥è¯¢æ—¥å¿—</h3><p>è¯·æŸ¥çœ‹2.6.2.æ…¢æŸ¥è¯¢æ—¥å¿—</p><h2 id="10-2-ä¸»ä»å¤åˆ¶"><a href="#10-2-ä¸»ä»å¤åˆ¶" class="headerlink" title="10.2.ä¸»ä»å¤åˆ¶"></a>10.2.ä¸»ä»å¤åˆ¶</h2><h3 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h3><p>ä¸»ä»å¤åˆ¶æ˜¯æŒ‡å°†ä¸»æ•°æ®åº“çš„DDLå’Œ DML æ“ä½œé€šè¿‡äºŒè¿›åˆ¶æ—¥å¿—ä¼ åˆ°ä»åº“æœåŠ¡å™¨ä¸­ï¼Œç„¶ååœ¨ä»åº“ä¸Šå¯¹è¿™äº›æ—¥å¿—é‡æ–°æ‰§è¡Œï¼ˆä¹Ÿå«é‡åšï¼‰ï¼Œä»è€Œä½¿å¾—ä»åº“å’Œä¸»åº“çš„æ•°æ®ä¿æŒåŒæ­¥ã€‚</p><p>MySQLæ”¯æŒä¸€å°ä¸»åº“åŒæ—¶å‘å¤šå°ä»åº“è¿›è¡Œå¤åˆ¶ï¼Œä»åº“åŒæ—¶ä¹Ÿå¯ä»¥ä½œä¸ºå…¶ä»–ä»æœåŠ¡å™¨çš„ä¸»åº“ï¼Œå®ç°é“¾çŠ¶å¤åˆ¶ã€‚</p><h3 id="ä¼˜ç‚¹"><a href="#ä¼˜ç‚¹" class="headerlink" title="ä¼˜ç‚¹"></a>ä¼˜ç‚¹</h3><ol><li><p>ä¸»åº“å‡ºç°é—®é¢˜ï¼Œå¯ä»¥å¿«é€Ÿåˆ‡æ¢åˆ°ä»åº“æä¾›æœåŠ¡</p></li><li><p>å®ç°è¯»å†™åˆ†ç¦»ï¼Œé™ä½ä¸»åº“çš„è®¿é—®å‹åŠ›ã€‚</p></li><li><p>å¯ä»¥åœ¨ä»åº“ä¸­æ‰§è¡Œå¤‡ä»½ï¼Œä»¥é¿å…å¤‡ä»½æœŸé—´å½±å“ä¸»åº“æœåŠ¡ã€‚</p></li></ol><h3 id="åŸç†â­â­â­"><a href="#åŸç†â­â­â­" class="headerlink" title="åŸç†â­â­â­"></a>åŸç†â­â­â­</h3><p><img src="http://cdn.leesin.fun/typora/s3/img/ä¸»ä»å¤åˆ¶åŸç†.png" alt="ä¸»ä»å¤åˆ¶åŸç†"></p><p>ä»ä¸Šå›¾æ¥çœ‹ï¼Œå¤åˆ¶åˆ†æˆä¸‰æ­¥:</p><ol><li><p>Master ä¸»åº“åœ¨äº‹åŠ¡æäº¤æ—¶ï¼Œä¼šæŠŠæ•°æ®å˜æ›´è®°å½•åœ¨äºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶ Binlog ä¸­ã€‚</p></li><li><p>ä»åº“è¯»å–ä¸»åº“çš„äºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶Binlogï¼Œå†™å…¥åˆ°ä»åº“çš„ä¸­ç»§æ—¥å¿— Relay Logã€‚</p></li><li><p>slaveé‡åšä¸­ç»§æ—¥å¿—ä¸­çš„äº‹ä»¶ï¼Œå°†æ”¹å˜åæ˜ å®ƒè‡ªå·±çš„æ•°æ®ã€‚</p></li></ol><h3 id="æ­å»º"><a href="#æ­å»º" class="headerlink" title="æ­å»º"></a>æ­å»º</h3><p>å‡†å¤‡ä¸¤å°æœåŠ¡å™¨ï¼šitachi102å’Œitachi103</p><p>itachi102ä½œä¸ºä¸»åº“ï¼Œitachi103ä½œä¸ºä»åº“</p><h5 id="ä¸»åº“é…ç½®"><a href="#ä¸»åº“é…ç½®" class="headerlink" title="ä¸»åº“é…ç½®"></a>ä¸»åº“é…ç½®</h5><ol><li>ä¿®æ”¹<code>/etc/my.cnf</code></li></ol><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#mysqlæœåŠ¡IDï¼Œä¿è¯æ•´ä¸ªé›†ç¾¤ç¯å¢ƒä¸­å”¯ä¸€ï¼Œå–å€¼èŒƒå›´: 1 - 2^32-1ï¼Œé»˜è®¤ä¸º1</span></span><br><span class="line"><span class="attr">server-id</span>=<span class="string">1</span></span><br><span class="line"><span class="comment">#æ˜¯å¦åªè¯»,1 ä»£è¡¨åªè¯»,0ä»£è¡¨è¯»å†™</span></span><br><span class="line"><span class="attr">read-only</span>=<span class="string">0</span></span><br><span class="line"><span class="comment">#å¿½ç•¥çš„æ•°æ®,æŒ‡ä¸éœ€è¦åŒæ­¥çš„æ•°æ®åº“</span></span><br><span class="line"><span class="comment">#binlog-ignore-db=mysql</span></span><br><span class="line"><span class="comment">#æŒ‡å®šåŒæ­¥çš„æ•°æ®åº“</span></span><br><span class="line"><span class="comment">#binlog-do-db=db01</span></span><br></pre></td></tr></table></figure><ol><li>é‡å¯æœåŠ¡</li><li>ç™»å½•mysqlï¼Œåˆ›å»ºä»åº“è¿æ¥ä¸»åº“ç”¨çš„è¿œç¨‹è¿æ¥çš„è´¦å·ï¼Œå¹¶æˆäºˆä¸»ä»å¤åˆ¶æƒé™</li></ol><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># åˆ›å»ºitachiç”¨æˆ·ï¼Œè¯¥ç”¨æˆ·å¯åœ¨ä»»æ„ä¸»æœºè¿æ¥è¯¥mysqlæœåŠ¡</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">user</span> <span class="string">&#x27;itachi&#x27;</span>@<span class="string">&#x27;%&#x27;</span> IDENTIFIED <span class="keyword">WITH</span> mysql_native_password <span class="keyword">BY</span> <span class="string">&#x27;root&#x27;</span>;</span><br><span class="line"># ä¸º<span class="string">&#x27;itachi&#x27;</span>@<span class="string">&#x27;%&#x27;</span>ç”¨æˆ·åˆ†é…ä¸»ä»å¤åˆ¶æƒé™</span><br><span class="line"><span class="keyword">grant</span> replication slave <span class="keyword">on</span> <span class="operator">*</span>.<span class="operator">*</span> <span class="keyword">to</span> <span class="string">&#x27;itachi&#x27;</span>@<span class="string">&#x27;%&#x27;</span>;</span><br></pre></td></tr></table></figure><ol><li>é€šè¿‡æŒ‡ä»¤ï¼ŒæŸ¥çœ‹äºŒè¿›åˆ¶æ—¥å¿—åæ ‡</li></ol><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">show</span> master status;</span><br><span class="line"><span class="operator">+</span><span class="comment">---------------+----------+--------------+------------------+-------------------+</span></span><br><span class="line"><span class="operator">|</span> File          <span class="operator">|</span> Position <span class="operator">|</span> Binlog_Do_DB <span class="operator">|</span> Binlog_Ignore_DB <span class="operator">|</span> Executed_Gtid_Set <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------------+----------+--------------+------------------+-------------------+</span></span><br><span class="line"><span class="operator">|</span> binlog<span class="number">.000006</span> <span class="operator">|</span>      <span class="number">663</span> <span class="operator">|</span>              <span class="operator">|</span>                  <span class="operator">|</span>                   <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------------+----------+--------------+------------------+-------------------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><p>å­—æ®µå«ä¹‰è¯´æ˜:</p><ul><li>Fileï¼šä»å“ªä¸ªæ—¥å¿—æ–‡ä»¶å¼€å§‹æ¨é€æ—¥å¿—æ–‡ä»¶</li><li>Positionï¼šä»å“ªä¸ªä½ç½®å¼€å§‹æ¨é€æ—¥å¿—</li><li>Binlog_ignore_dbï¼šæŒ‡å®šä¸éœ€è¦åŒæ­¥çš„æ•°æ®åº“</li></ul><h5 id="ä»åº“é…ç½®"><a href="#ä»åº“é…ç½®" class="headerlink" title="ä»åº“é…ç½®"></a>ä»åº“é…ç½®</h5><ol><li>ä¿®æ”¹<code>/etc/my.cnf</code></li></ol><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#mysqlæœåŠ¡IDï¼Œä¿è¯æ•´ä¸ªé›†ç¾¤ç¯å¢ƒä¸­å”¯ä¸€ï¼Œå–å€¼èŒƒå›´: 1 - 2^32-1ï¼Œå’Œä¸»åº“ä¸ä¸€æ ·å³å¯</span></span><br><span class="line"><span class="attr">server-id</span>=<span class="string">2</span></span><br><span class="line"><span class="comment">#æ˜¯å¦åªè¯»,1 ä»£è¡¨åªè¯»,0ä»£è¡¨è¯»å†™</span></span><br><span class="line"><span class="attr">read-only</span>=<span class="string">1</span></span><br></pre></td></tr></table></figure><ol><li>å¦‚æœæ˜¯å…‹éš†è¿‡æ¥çš„æœºå™¨ï¼Œéœ€è¦ä¿®æ”¹uuid</li></ol><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"># ç™»å½•mysql</span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> uuid();</span><br><span class="line"><span class="operator">+</span><span class="comment">--------------------------------------+</span></span><br><span class="line"><span class="operator">|</span> uuid()                               <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">--------------------------------------+</span></span><br><span class="line"><span class="operator">|</span> b33057ff<span class="operator">-</span>bec6<span class="number">-11</span>eb<span class="operator">-</span>ad94<span class="number">-000</span>c29af6856 <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">--------------------------------------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line">â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”</span><br><span class="line"></span><br><span class="line"># é€€å‡ºmysqlï¼Œå»ä¿®æ”¹uuid</span><br><span class="line">vim <span class="operator">/</span>var<span class="operator">/</span>lib<span class="operator">/</span>mysql<span class="operator">/</span>auto.cnf</span><br><span class="line"></span><br><span class="line">systemctl restart mysqld</span><br><span class="line"></span><br></pre></td></tr></table></figure><ol><li>é‡å¯æœåŠ¡</li><li>ç™»å½•mysqlï¼Œè®¾ç½®ä¸»åº“é…ç½®</li></ol><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">change master <span class="keyword">to</span> master_host<span class="operator">=</span><span class="string">&#x27;itachi102&#x27;</span>,master_user<span class="operator">=</span><span class="string">&#x27;itachi&#x27;</span>,master_password<span class="operator">=</span><span class="string">&#x27;root&#x27;</span>,master_log_file<span class="operator">=</span><span class="string">&#x27;binlog.000006&#x27;</span>,master_log_pos<span class="operator">=</span><span class="number">663</span>;</span><br></pre></td></tr></table></figure><ol><li>å¼€å¯åŒæ­¥æ“ä½œ</li></ol><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># <span class="number">8.0</span><span class="number">.22</span>ä¹‹å</span><br><span class="line"><span class="keyword">start</span> replica; </span><br><span class="line"></span><br><span class="line"># <span class="number">8.0</span><span class="number">.22</span>.ä¹‹å‰</span><br><span class="line"><span class="keyword">start</span> slave; </span><br></pre></td></tr></table></figure><ol><li>æŸ¥çœ‹ä¸»ä»åŒæ­¥çŠ¶æ€</li></ol><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># <span class="number">8.0</span><span class="number">.22</span>ä¹‹å</span><br><span class="line"><span class="keyword">show</span> replica status\G; </span><br><span class="line"></span><br><span class="line"># <span class="number">8.0</span><span class="number">.22</span>.ä¹‹å‰</span><br><span class="line"><span class="keyword">show</span> slave status\G; </span><br></pre></td></tr></table></figure><p>ä¸»è¦çœ‹ä¸¤ä¸ªå­—æ®µï¼Œå¦‚æœè¿™ä¸¤ä¸ªå­—æ®µä¸ºYESï¼Œè¯´æ˜å°±æˆåŠŸäº†</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Slave_IO_Running: Yes</span><br><span class="line">Slave_SQL_Running: Yes</span><br></pre></td></tr></table></figure><h5 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h5><ol><li>åœ¨ä¸»åº“ä¸­åˆ›å»ºæ•°æ®åº“ã€è¡¨ï¼Œå¹¶æ’å…¥æ•°æ®</li></ol><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> database db01;</span><br><span class="line">use db01;</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> tb_user(</span><br><span class="line">id <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">primary</span> key <span class="keyword">not</span> <span class="keyword">null</span> auto_increment,</span><br><span class="line">    name <span class="type">varchar</span>(<span class="number">50</span>) <span class="keyword">not</span> <span class="keyword">null</span>,</span><br><span class="line">sex <span class="type">varchar</span>(<span class="number">1</span>)</span><br><span class="line">)engine<span class="operator">=</span>innodb <span class="keyword">default</span> charset<span class="operator">=</span>utf8mb4;</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> tb_user(id,name,sex) <span class="keyword">values</span>(<span class="keyword">null</span>,<span class="string">&#x27;Tom&#x27;</span>,<span class="string">&#x27;1&#x27;</span>),(<span class="keyword">null</span>,<span class="string">&#x27;Trigger&#x27;</span>,<span class="string">&#x27;0&#x27;</span>),(<span class="keyword">null</span>,<span class="string">&#x27;Dawn&#x27;</span>,<span class="string">&#x27;1&#x27;</span>);</span><br></pre></td></tr></table></figure><ol><li>å»ä»åº“æŸ¥è¯¢æ•°æ®ï¼ŒéªŒè¯ä¸»ä»æ˜¯å¦åŒæ­¥</li></ol><h2 id="10-3-åˆ†åº“åˆ†è¡¨"><a href="#10-3-åˆ†åº“åˆ†è¡¨" class="headerlink" title="10.3.åˆ†åº“åˆ†è¡¨"></a>10.3.åˆ†åº“åˆ†è¡¨</h2><h3 id="10-3-1-æ‹†åˆ†æ–¹å¼"><a href="#10-3-1-æ‹†åˆ†æ–¹å¼" class="headerlink" title="10.3.1.æ‹†åˆ†æ–¹å¼"></a>10.3.1.æ‹†åˆ†æ–¹å¼</h3><h3 id="10-3-2-MyCatæ¶æ„"><a href="#10-3-2-MyCatæ¶æ„" class="headerlink" title="10.3.2.MyCatæ¶æ„"></a>10.3.2.MyCatæ¶æ„</h3><p><img src="http://cdn.leesin.fun/typora/s3/img/mycatæ¶æ„.png" alt="mycatæ¶æ„"></p><h3 id="10-3-3-å…¥é—¨"><a href="#10-3-3-å…¥é—¨" class="headerlink" title="10.3.3.å…¥é—¨"></a>10.3.3.å…¥é—¨</h3><h5 id="æ¦‚è¿°-1"><a href="#æ¦‚è¿°-1" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h5><p>ç”±äº tb_order è¡¨ä¸­æ•°æ®é‡å¾ˆå¤§ï¼Œç£ç›˜ IO åŠå®¹é‡éƒ½åˆ°è¾¾äº†ç“¶é¢ˆï¼Œç°åœ¨éœ€è¦å¯¹ tb_order è¡¨è¿›è¡Œæ•°æ®åˆ†ç‰‡ï¼Œåˆ†ä¸ºä¸‰ä¸ªæ•°æ®èŠ‚ç‚¹ï¼Œæ¯ä¸€ä¸ªèŠ‚ç‚¹ä¸»æœºä½äºä¸åŒçš„æœåŠ¡å™¨ä¸Šï¼Œå…·ä½“çš„ç»“æ„å‚è€ƒä¸‹å›¾ï¼š</p><p><img src="http://cdn.leesin.fun/typora/s3/img/mycatå…¥é—¨1.png" alt="mycatå…¥é—¨1" style="zoom:50%;"></p><h5 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h5><div class="table-container"><table><thead><tr><th>æœåŠ¡å™¨</th><th>å®‰è£…è½¯ä»¶</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>itachi103</td><td>JDKå’ŒMycat</td><td>Mycatä¸­é—´ä»¶æœåŠ¡å™¨</td></tr><tr><td>itachi103</td><td>MySQL</td><td>åˆ†ç‰‡æœåŠ¡å™¨</td></tr><tr><td>itachi104</td><td>MySQL</td><td>åˆ†ç‰‡æœåŠ¡å™¨</td></tr><tr><td>itachi105</td><td>MySQL</td><td>åˆ†ç‰‡æœåŠ¡å™¨</td></tr></tbody></table></div><p>ç„¶åè¿›å…¥itachi103çš„ç›®å½•<code>/usr/local/mycat/lib</code></p><p>å°†mysqlé©±åŠ¨åŒ…æ¢æˆ8ç‰ˆæœ¬çš„</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /usr/local/mycat/lib</span><br><span class="line"></span><br><span class="line"><span class="built_in">rm</span> -f mysql-connector-java-5.1.35.jar </span><br><span class="line"></span><br><span class="line">ç„¶åå°†mysql-connector-java-8.0.22.jarä¸Šä¼ è‡³æ­¤ç›®å½•ä¸‹</span><br><span class="line"></span><br><span class="line"><span class="built_in">chmod</span> 777 mysql-connector-java-8.0.22.jar </span><br></pre></td></tr></table></figure><h5 id="å‡†å¤‡å·¥ä½œ"><a href="#å‡†å¤‡å·¥ä½œ" class="headerlink" title="å‡†å¤‡å·¥ä½œ"></a>å‡†å¤‡å·¥ä½œ</h5><p>åˆ†åˆ«åœ¨3å°mysqlæœåŠ¡å™¨ä¸­åˆ›å»ºä¸€ä¸ªç©ºçš„æ•°æ®åº“ï¼Œåå­—ä¸º<code>db01</code></p><h5 id="é…ç½®schema-xml"><a href="#é…ç½®schema-xml" class="headerlink" title="é…ç½®schema.xml"></a>é…ç½®schema.xml</h5><p>ä½äº<code>/usr/local/mycat/conf/schema.xml</code></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mycat</span>:schema <span class="keyword">SYSTEM</span> <span class="string">&quot;schema.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mycat:schema</span> <span class="attr">xmlns:mycat</span>=<span class="string">&quot;http://io.mycat/&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">schema</span> <span class="attr">name</span>=<span class="string">&quot;DB01&quot;</span> <span class="attr">checkSQLschema</span>=<span class="string">&quot;true&quot;</span> <span class="attr">sqlMaxLimit</span>=<span class="string">&quot;100&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">table</span> <span class="attr">name</span>=<span class="string">&quot;TB_ORDER&quot;</span> <span class="attr">dataNode</span>=<span class="string">&quot;dn1,dn2,dn3&quot;</span> <span class="attr">rule</span>=<span class="string">&quot;auto-sharding-long&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">schema</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dataNode</span> <span class="attr">name</span>=<span class="string">&quot;dn1&quot;</span> <span class="attr">dataHost</span>=<span class="string">&quot;dhost1&quot;</span> <span class="attr">database</span>=<span class="string">&quot;db01&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dataNode</span> <span class="attr">name</span>=<span class="string">&quot;dn2&quot;</span> <span class="attr">dataHost</span>=<span class="string">&quot;dhost2&quot;</span> <span class="attr">database</span>=<span class="string">&quot;db01&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dataNode</span> <span class="attr">name</span>=<span class="string">&quot;dn3&quot;</span> <span class="attr">dataHost</span>=<span class="string">&quot;dhost3&quot;</span> <span class="attr">database</span>=<span class="string">&quot;db01&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dataHost</span> <span class="attr">name</span>=<span class="string">&quot;dhost1&quot;</span> <span class="attr">maxCon</span>=<span class="string">&quot;1000&quot;</span> <span class="attr">minCon</span>=<span class="string">&quot;10&quot;</span> <span class="attr">balance</span>=<span class="string">&quot;0&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">writeType</span>=<span class="string">&quot;0&quot;</span> <span class="attr">dbType</span>=<span class="string">&quot;mysql&quot;</span> <span class="attr">dbDriver</span>=<span class="string">&quot;jdbc&quot;</span> <span class="attr">switchType</span>=<span class="string">&quot;1&quot;</span>  <span class="attr">slaveThreshold</span>=<span class="string">&quot;100&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">heartbeat</span>&gt;</span>select user()<span class="tag">&lt;/<span class="name">heartbeat</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">writeHost</span> <span class="attr">host</span>=<span class="string">&quot;master&quot;</span> <span class="attr">url</span>=<span class="string">&quot;jdbc:mysql://itachi103:3306?useSSL=false<span class="symbol">&amp;amp;</span>serverTimezone=Asia/Shanghai<span class="symbol">&amp;amp;</span>characterEncoding=utf8&quot;</span> <span class="attr">user</span>=<span class="string">&quot;root&quot;</span> <span class="attr">password</span>=<span class="string">&quot;root&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dataHost</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dataHost</span> <span class="attr">name</span>=<span class="string">&quot;dhost2&quot;</span> <span class="attr">maxCon</span>=<span class="string">&quot;1000&quot;</span> <span class="attr">minCon</span>=<span class="string">&quot;10&quot;</span> <span class="attr">balance</span>=<span class="string">&quot;0&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">writeType</span>=<span class="string">&quot;0&quot;</span> <span class="attr">dbType</span>=<span class="string">&quot;mysql&quot;</span> <span class="attr">dbDriver</span>=<span class="string">&quot;jdbc&quot;</span> <span class="attr">switchType</span>=<span class="string">&quot;1&quot;</span>  <span class="attr">slaveThreshold</span>=<span class="string">&quot;100&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">heartbeat</span>&gt;</span>select user()<span class="tag">&lt;/<span class="name">heartbeat</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">writeHost</span> <span class="attr">host</span>=<span class="string">&quot;master&quot;</span> <span class="attr">url</span>=<span class="string">&quot;jdbc:mysql://itachi104:3306?useSSL=false<span class="symbol">&amp;amp;</span>serverTimezone=Asia/Shanghai<span class="symbol">&amp;amp;</span>characterEncoding=utf8&quot;</span> <span class="attr">user</span>=<span class="string">&quot;root&quot;</span> <span class="attr">password</span>=<span class="string">&quot;root&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dataHost</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dataHost</span> <span class="attr">name</span>=<span class="string">&quot;dhost3&quot;</span> <span class="attr">maxCon</span>=<span class="string">&quot;1000&quot;</span> <span class="attr">minCon</span>=<span class="string">&quot;10&quot;</span> <span class="attr">balance</span>=<span class="string">&quot;0&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">writeType</span>=<span class="string">&quot;0&quot;</span> <span class="attr">dbType</span>=<span class="string">&quot;mysql&quot;</span> <span class="attr">dbDriver</span>=<span class="string">&quot;jdbc&quot;</span> <span class="attr">switchType</span>=<span class="string">&quot;1&quot;</span>  <span class="attr">slaveThreshold</span>=<span class="string">&quot;100&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">heartbeat</span>&gt;</span>select user()<span class="tag">&lt;/<span class="name">heartbeat</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">writeHost</span> <span class="attr">host</span>=<span class="string">&quot;master&quot;</span> <span class="attr">url</span>=<span class="string">&quot;jdbc:mysql://itachi105:3306?useSSL=false<span class="symbol">&amp;amp;</span>serverTimezone=Asia/Shanghai<span class="symbol">&amp;amp;</span>characterEncoding=utf8&quot;</span> <span class="attr">user</span>=<span class="string">&quot;root&quot;</span> <span class="attr">password</span>=<span class="string">&quot;root&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dataHost</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mycat:schema</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>è¿™é‡Œé…ç½®çš„æ˜¯ï¼Œé€»è¾‘åº“é€»è¾‘è¡¨ç›¸å…³ä¿¡æ¯</p></blockquote><h5 id="é…ç½®server-xml"><a href="#é…ç½®server-xml" class="headerlink" title="é…ç½®server.xml"></a>é…ç½®server.xml</h5><p>ä¿®æ”¹server.xmlç›¸åº”çš„æ ‡ç­¾ä¸ºå¦‚ä¸‹ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">user</span> <span class="attr">name</span>=<span class="string">&quot;root&quot;</span> <span class="attr">defaultAccount</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span>&gt;</span>123456<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;schemas&quot;</span>&gt;</span>DB01<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">user</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">user</span> <span class="attr">name</span>=<span class="string">&quot;user&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span>&gt;</span>123456<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;schemas&quot;</span>&gt;</span>DB01<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;readOnly&quot;</span>&gt;</span>true<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">user</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>è¿™é‡Œé…ç½®çš„æ˜¯ï¼Œç™»å½•mycatçš„è´¦å·å¯†ç </p></blockquote><h5 id="å¯åŠ¨æœåŠ¡"><a href="#å¯åŠ¨æœåŠ¡" class="headerlink" title="å¯åŠ¨æœåŠ¡"></a>å¯åŠ¨æœåŠ¡</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è¿›å…¥mycatç›®å½•</span></span><br><span class="line"><span class="built_in">cd</span> /usr/local/mycat</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯åŠ¨ï¼Œç«¯å£å·é»˜è®¤ä¸º8066</span></span><br><span class="line">bin/mycat start</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ£€æŸ¥æ˜¯å¦å¯åŠ¨æˆåŠŸï¼Œå¦‚æœå‡ºç°MyCAT Server startup successfully.åˆ™æˆåŠŸäº†</span></span><br><span class="line"><span class="built_in">tail</span> -f logs/wrapper.log</span><br><span class="line"></span><br><span class="line"><span class="comment"># åœæ­¢</span></span><br><span class="line">bin/mycat stop</span><br></pre></td></tr></table></figure><h5 id="ç™»å½•mycat"><a href="#ç™»å½•mycat" class="headerlink" title="ç™»å½•mycat"></a>ç™»å½•mycat</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -hitachi103 -P8066 -uroot -p123456 --default_auth=mysql_native_password</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">show</span> databases;</span><br><span class="line"><span class="operator">+</span><span class="comment">----------+</span></span><br><span class="line"><span class="operator">|</span> DATABASE <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------+</span></span><br><span class="line"><span class="operator">|</span> DB01     <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.01</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> use DB01;</span><br><span class="line">Database changed</span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">show</span> tables;</span><br><span class="line"><span class="operator">+</span><span class="comment">----------------+</span></span><br><span class="line"><span class="operator">|</span> Tables <span class="keyword">in</span> DB01 <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------------+</span></span><br><span class="line"><span class="operator">|</span> tb_order       <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.01</span> sec)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æ­¤æ—¶ä¸‰å°æœåŠ¡å™¨çš„mysqléƒ½è¿˜æ²¡æœ‰è¡¨ç»“æ„ï¼Œä¸Šé¢æŸ¥è¯¢å‡ºæ¥çš„åªæ˜¯mycatä¸­çš„é€»è¾‘è¡¨ç»“æ„</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> tb_order(</span><br><span class="line">    id <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">not</span> <span class="keyword">null</span>,</span><br><span class="line">    title <span class="type">varchar</span>(<span class="number">100</span>) <span class="keyword">not</span> <span class="keyword">null</span>,</span><br><span class="line">    <span class="keyword">primary</span> key(id)</span><br><span class="line">)engine<span class="operator">=</span>innodb <span class="keyword">default</span> charset<span class="operator">=</span>utf8;</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œåˆ›å»ºè¡¨åï¼Œä¸‰å°æœåŠ¡å™¨æ‰çœŸæ­£çš„åˆ›å»ºäº†è¡¨</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> tb_order(id,title) <span class="keyword">values</span>(<span class="number">1</span>,<span class="string">&#x27;godds1&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> tb_order(id,title) <span class="keyword">values</span>(<span class="number">2</span>,<span class="string">&#x27;godds2&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> tb_order(id,title) <span class="keyword">values</span>(<span class="number">3</span>,<span class="string">&#x27;godds3&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> tb_order(id,title) <span class="keyword">values</span>(<span class="number">1000000</span>,<span class="string">&#x27;godds1000000&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> tb_order(id,title) <span class="keyword">values</span>(<span class="number">10000000</span>,<span class="string">&#x27;godds10000000&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> tb_order(id,title) <span class="keyword">values</span>(<span class="number">10000001</span>,<span class="string">&#x27;godds10000001&#x27;</span>);</span><br></pre></td></tr></table></figure><p>æ’å…¥æ•°æ®åï¼Œæ ¹æ®åˆ†ç‰‡è§„åˆ™ï¼ˆschema.xmlé…ç½®ï¼‰ï¼Œæ°´å¹³æ‹†åˆ†ç»™ä¸‰å°æœåŠ¡å™¨å­˜æ”¾æ•°æ®</p><p>itachi103</p><p><img src="http://cdn.leesin.fun/typora/s3/img/itachi103.png" alt="itachi103"></p><p>itachi104</p><p><img src="http://cdn.leesin.fun/typora/s3/img/itachi104.png" alt="itachi104"></p><p>itachi105</p><p><img src="http://cdn.leesin.fun/typora/s3/img/itachi105.png" alt="itachi105"></p><h3 id="10-3-4-MyCaté…ç½®"><a href="#10-3-4-MyCaté…ç½®" class="headerlink" title="10.3.4.MyCaté…ç½®"></a>10.3.4.MyCaté…ç½®</h3><h4 id="schema-xml"><a href="#schema-xml" class="headerlink" title="schema.xml"></a>schema.xml</h4><p>schema.xmlä½œä¸ºMyCatä¸­æœ€é‡è¦çš„é…ç½®æ–‡ä»¶ä¹‹ä¸€,æ¶µç›–äº†MyCatçš„é€»è¾‘åº“ã€é€»è¾‘è¡¨ã€åˆ†ç‰‡è§„åˆ™ã€åˆ†ç‰‡èŠ‚ç‚¹åŠæ•°æ®æºçš„é…ç½®ã€‚</p><p>ä¸»è¦åŒ…å«ä»¥ä¸‹ä¸‰ç»„æ ‡ç­¾:</p><p><strong>schemaæ ‡ç­¾</strong></p><p><img src="http://cdn.leesin.fun/typora/s3/img/schema.xmlçš„sechemaæ ‡ç­¾.png" alt="schema.xmlçš„sechemaæ ‡ç­¾"></p><p>schema æ ‡ç­¾ç”¨äºå®šä¹‰ Mycatå®ä¾‹ä¸­çš„é€»è¾‘åº“ï¼Œä¸€ä¸ªMycatå®ä¾‹ä¸­ï¼Œå¯ä»¥æœ‰å¤šä¸ªé€»è¾‘åº“ï¼Œå¯ä»¥é€šè¿‡ schema æ ‡ç­¾æ¥åˆ’åˆ†ä¸åŒçš„é€»è¾‘åº“ã€‚</p><p>Mycatä¸­çš„é€»è¾‘åº“çš„æ¦‚å¿µï¼Œç­‰åŒäºMySQLä¸­çš„databaseæ¦‚å¿µï¼Œéœ€è¦æ“ä½œæŸä¸ªé€»è¾‘åº“ä¸‹çš„è¡¨æ—¶ï¼Œä¹Ÿéœ€è¦åˆ‡æ¢é€»è¾‘åº“(use xxx)ã€‚</p><blockquote><ul><li>nameï¼šæŒ‡å®šè‡ªå®šä¹‰çš„é€»è¾‘åº“åº“å</li><li><p>sqlMaxLimitï¼šå¦‚æœæœªæŒ‡å®šlimitè¿›è¡ŒæŸ¥è¯¢ï¼Œåˆ—è¡¨æŸ¥è¯¢æ¨¡å¼æŸ¥è¯¢å¤šå°‘æ¡è®°å½•</p></li><li><p>tableæ ‡ç­¾é‡Œé¢çš„å±æ€§ï¼š</p><ul><li>nameï¼šå®šä¹‰é€»è¾‘è¡¨è¡¨åï¼Œåœ¨è¯¥é€»è¾‘åº“ä¸‹å”¯ä¸€</li><li>dataNodeï¼šå®šä¹‰é€»è¾‘è¡¨æ‰€å±çš„dataNodeï¼Œè¯¥å±æ€§éœ€è¦ä¸dataNodeæ ‡ç­¾ä¸­nameå¯¹åº”</li><li>ruleï¼šåˆ†ç‰‡è§„åˆ™çš„åå­—ï¼Œåˆ†ç‰‡è§„åˆ™åå­—æ˜¯åœ¨rule.xmlä¸­å®šä¹‰çš„</li><li>primaryKeyï¼šé€»è¾‘è¡¨å¯¹åº”çœŸå®è¡¨çš„ä¸»é”®</li><li>typeï¼šé€»è¾‘è¡¨çš„ç±»å‹ï¼Œç›®å‰é€»è¾‘è¡¨åªæœ‰å…¨å±€è¡¨å’Œæ™®é€šè¡¨ï¼Œå¦‚æœæœªé…ç½®ï¼Œå°±æ˜¯æ™®é€šè¡¨ï¼›å…¨å±€è¡¨ï¼Œé…ç½®ä¸º global</li></ul></li></ul></blockquote><p><strong>datanodeæ ‡ç­¾</strong></p><p><img src="http://cdn.leesin.fun/typora/s3/img/schema.xmlçš„dataNodeæ ‡ç­¾.png" alt="schema.xmlçš„dataNodeæ ‡ç­¾"></p><p>dataNode æ ‡ç­¾ä¸­å®šä¹‰äº† MyCat ä¸­çš„æ•°æ®èŠ‚ç‚¹ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬é€šå¸¸è¯´çš„æ•°æ®åˆ†ç‰‡ã€‚ä¸€ä¸ª dataNode æ ‡ç­¾å°±æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„æ•°æ®åˆ†ç‰‡ã€‚</p><blockquote><ul><li>nameï¼šå®šä¹‰æ•°æ®èŠ‚ç‚¹åç§°</li><li>dataHostï¼šæ•°æ®åº“å®ä¾‹ä¸»æœºåç§°ï¼Œå¼•ç”¨è‡ª dataHostæ ‡ç­¾ä¸­nameå±æ€§</li><li>databaseï¼šå®šä¹‰åˆ†ç‰‡çš„æ•°æ®åº“</li></ul></blockquote><p><strong>datahostæ ‡ç­¾</strong></p><p><img src="http://cdn.leesin.fun/typora/s3/img/schema.xmlçš„dataHostæ ‡ç­¾.png" alt="schema.xmlçš„dataHostæ ‡ç­¾"></p><p>è¯¥æ ‡ç­¾åœ¨ MyCat é€»è¾‘åº“ä¸­ä½œä¸ºåº•å±‚æ ‡ç­¾å­˜åœ¨ï¼Œç›´æ¥å®šä¹‰äº†å…·ä½“çš„æ•°æ®åº“å®ä¾‹ã€è¯»å†™åˆ†ç¦»ã€å¿ƒè·³è¯­å¥ã€‚</p><blockquote><ul><li>nameï¼šå”¯ä¸€æ ‡è¯†ï¼Œä¾›ä¸Šå±‚æ ‡ç­¾ä½¿ç”¨</li><li>maxCon/minConï¼šæœ€å¤§è¿æ¥æ•°/æœ€å°è¿æ¥æ•°</li><li>balanceï¼šè´Ÿè½½å‡è¡¡ç­–ç•¥ï¼Œå–å€¼ 0,1,2,3</li><li>writeTypeï¼šå†™æ“ä½œåˆ†å‘æ–¹å¼ï¼Œå–å€¼0,1</li><li>switchTypeï¼šè®¾ç½®æ˜¯å¦è‡ªåŠ¨åˆ‡æ¢ï¼Œå–å€¼-1,1</li><li>dbDriverï¼šæ•°æ®åº“é©±åŠ¨ï¼Œæ”¯æŒ nativeã€jdbc</li></ul></blockquote><div class="table-container"><table><thead><tr><th>balanceå‚æ•°å€¼</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td>0ï¼ˆé»˜è®¤å€¼ï¼‰</td><td>ä¸å¼€å¯è¯»å†™åˆ†ç¦»æœºåˆ¶ï¼Œæ‰€æœ‰è¯»æ“ä½œéƒ½å‘é€åˆ°å½“å‰å¯ç”¨çš„writeHostä¸Š</td></tr><tr><td>1</td><td>å…¨éƒ¨çš„readHostä¸å¤‡ç”¨çš„writeHostéƒ½å‚ä¸selectè¯­å¥çš„è´Ÿè½½å‡è¡¡ï¼ˆä¸»è¦é’ˆå¯¹äºåŒä¸»åŒä»æ¨¡å¼ï¼‰</td></tr><tr><td>2</td><td>æ‰€æœ‰çš„è¯»å†™æ“ä½œéƒ½éšæœºåœ¨writeHostï¼ŒreadHostä¸Šåˆ†å‘</td></tr><tr><td>3</td><td>æ‰€æœ‰çš„è¯»è¯·æ±‚éšæœºåˆ†å‘åˆ°writeHostå¯¹åº”çš„readHostä¸Šæ‰§è¡Œã€‚writeHoståªè´Ÿæ‹…å†™å‹åŠ›ï¼Œä¸è´Ÿæ‹…è¯»å‹åŠ›</td></tr></tbody></table></div><div class="table-container"><table><thead><tr><th style="text-align:center">writeTypeå‚æ•°å€¼</th><th style="text-align:center">å«ä¹‰</th></tr></thead><tbody><tr><td style="text-align:center">0</td><td style="text-align:center">å†™æ“ä½œè½¬å‘åˆ°ç¬¬ä¸€ä¸ªwriteHostï¼Œç¬¬ä¸€ä¸ªæŒ‚äº†ï¼Œåˆ‡æ¢åˆ°ç¬¬äºŒä¸ª</td></tr><tr><td style="text-align:center">1</td><td style="text-align:center">å†™æ“ä½œéšæœºåˆ†å‘åˆ°é…ç½®çš„writeHost</td></tr></tbody></table></div><div class="table-container"><table><thead><tr><th style="text-align:center">switchå‚æ•°å€¼</th><th style="text-align:center">å«ä¹‰</th></tr></thead><tbody><tr><td style="text-align:center">-1</td><td style="text-align:center">ä¸è‡ªåŠ¨åˆ‡æ¢</td></tr><tr><td style="text-align:center">1</td><td style="text-align:center">å½“writeHost1æŒ‚äº†ä¹‹åï¼Œè‡ªåŠ¨åˆ‡æ¢è‡³writeHost2ä¸Š</td></tr></tbody></table></div><p><strong>æ€»ç»“</strong></p><p><img src="http://cdn.leesin.fun/typora/s3/img/schema.xmlæ€»ç»“.png" alt="schema.xmlæ€»ç»“"></p><h4 id="rule-xml"><a href="#rule-xml" class="headerlink" title="rule.xml"></a>rule.xml</h4><p>rule.xml ä¸­å®šä¹‰æ‰€æœ‰æ‹†åˆ†è¡¨çš„è§„åˆ™ï¼Œåœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­å¯ä»¥çµæ´»çš„ä½¿ç”¨åˆ†ç‰‡ç®—æ³•ï¼Œæˆ–è€…å¯¹åŒä¸€ä¸ªåˆ†ç‰‡ç®—æ³•ä½¿ç”¨ä¸åŒçš„å‚æ•°ï¼Œå®ƒè®©åˆ†ç‰‡è¿‡ç¨‹å¯é…ç½®åŒ–ã€‚ä¸»è¦åŒ…å«ä¸¤ç±»æ ‡ç­¾ï¼štableRuleã€Functionã€‚</p><p>ä»¥rang-longä¸ºä¾‹ï¼š</p><p><img src="http://cdn.leesin.fun/typora/s3/img/rule.xmlä¸¾ä¾‹ä¹‹rang-longç­–ç•¥.png" alt="rule.xmlä¸¾ä¾‹ä¹‹rang-longç­–ç•¥"></p><h4 id="server-xml"><a href="#server-xml" class="headerlink" title="server.xml"></a>server.xml</h4><p>server.xml é…ç½®æ–‡ä»¶åŒ…å«äº† MyCat çš„ç³»ç»Ÿé…ç½®ä¿¡æ¯ï¼Œä¸»è¦æœ‰ä¸¤ä¸ªé‡è¦çš„æ ‡ç­¾ï¼šsystemã€userã€‚</p><ul><li>systemæ ‡ç­¾</li></ul><p>â€‹    è‡ªå·±æ‰“å¼€server.xmlæ¥çœ‹ï¼Œé‡Œé¢æœ‰æ³¨é‡Š</p><ul><li>useræ ‡ç­¾</li></ul><p><img src="http://cdn.leesin.fun/typora/s3/img/mycatçš„server.xmlçš„useræ ‡ç­¾.png" alt="mycatçš„server.xmlçš„useræ ‡ç­¾"></p><p>æ³¨æ„ï¼Œå¦‚æœé…ç½®å¤šä¸ªé€»è¾‘åº“ï¼Œé€—å·éš”å¼€ï¼Œå¦‚ä¸‹ï¼šâ­â­â­</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;schemas&quot;</span>&gt;</span>DB01,DB02,DB03,DB04<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="10-3-5-å‚ç›´åˆ†åº“ç¤ºä¾‹"><a href="#10-3-5-å‚ç›´åˆ†åº“ç¤ºä¾‹" class="headerlink" title="10.3.5.å‚ç›´åˆ†åº“ç¤ºä¾‹"></a>10.3.5.å‚ç›´åˆ†åº“ç¤ºä¾‹</h3><p>åœ¨ä¸šåŠ¡ç³»ç»Ÿä¸­ï¼Œæ¶‰åŠä»¥ä¸‹è¡¨ç»“æ„ï¼Œä½†æ˜¯ç”±äºç”¨æˆ·ä¸è®¢å•æ¯å¤©éƒ½ä¼šäº§ç”Ÿå¤§é‡çš„æ•°æ®ï¼Œå•å°æœåŠ¡å™¨çš„æ•°æ®å­˜å‚¨åŠå¤„ç†èƒ½åŠ›æ˜¯æœ‰é™çš„ï¼Œå¯ä»¥å¯¹æ•°æ®åº“è¡¨è¿›è¡Œæ‹†åˆ†ã€‚å›¾çš„å·¦è¾¹åŸæœ‰çš„æ•°æ®åº“è¡¨ï¼Œå›¾çš„å³è¾¹æ˜¯å‚ç›´åˆ†åº“åçš„æƒ…å†µã€‚</p><p><img src="http://cdn.leesin.fun/typora/s3/img/å‚ç›´åˆ†åº“ç¤ºä¾‹-167869852638120.png" alt="å‚ç›´åˆ†åº“ç¤ºä¾‹"></p><p><strong>å‡†å¤‡</strong></p><p>åœ¨ä¸‰å°æœåŠ¡å™¨ä¸­éƒ½åˆ›å»ºæ•°æ®åº“<code>shopping</code></p><p><strong>é…ç½®</strong></p><p>schema.xml</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mycat</span>:schema <span class="keyword">SYSTEM</span> <span class="string">&quot;schema.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mycat:schema</span> <span class="attr">xmlns:mycat</span>=<span class="string">&quot;http://io.mycat/&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">schema</span> <span class="attr">name</span>=<span class="string">&quot;SHOPPING&quot;</span> <span class="attr">checkSQLschema</span>=<span class="string">&quot;true&quot;</span> <span class="attr">sqlMaxLimit</span>=<span class="string">&quot;100&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">table</span> <span class="attr">name</span>=<span class="string">&quot;tb_goods_base&quot;</span> <span class="attr">dataNode</span>=<span class="string">&quot;dn1&quot;</span> <span class="attr">primaryKey</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">table</span> <span class="attr">name</span>=<span class="string">&quot;tb_goods_brand&quot;</span> <span class="attr">dataNode</span>=<span class="string">&quot;dn1&quot;</span> <span class="attr">primaryKey</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">table</span> <span class="attr">name</span>=<span class="string">&quot;tb_goods_cat&quot;</span> <span class="attr">dataNode</span>=<span class="string">&quot;dn1&quot;</span> <span class="attr">primaryKey</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">table</span> <span class="attr">name</span>=<span class="string">&quot;tb_goods_desc&quot;</span> <span class="attr">dataNode</span>=<span class="string">&quot;dn1&quot;</span> <span class="attr">primaryKey</span>=<span class="string">&quot;goods_id&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">table</span> <span class="attr">name</span>=<span class="string">&quot;tb_goods_item&quot;</span> <span class="attr">dataNode</span>=<span class="string">&quot;dn1&quot;</span> <span class="attr">primaryKey</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">table</span> <span class="attr">name</span>=<span class="string">&quot;tb_order_item&quot;</span> <span class="attr">dataNode</span>=<span class="string">&quot;dn2&quot;</span> <span class="attr">primaryKey</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">table</span> <span class="attr">name</span>=<span class="string">&quot;tb_order_master&quot;</span> <span class="attr">dataNode</span>=<span class="string">&quot;dn2&quot;</span> <span class="attr">primaryKey</span>=<span class="string">&quot;order_id&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">table</span> <span class="attr">name</span>=<span class="string">&quot;tb_order_pay_log&quot;</span> <span class="attr">dataNode</span>=<span class="string">&quot;dn2&quot;</span> <span class="attr">primaryKey</span>=<span class="string">&quot;out_trade_no&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">table</span> <span class="attr">name</span>=<span class="string">&quot;tb_user&quot;</span> <span class="attr">dataNode</span>=<span class="string">&quot;dn3&quot;</span> <span class="attr">primaryKey</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">table</span> <span class="attr">name</span>=<span class="string">&quot;tb_user_address&quot;</span> <span class="attr">dataNode</span>=<span class="string">&quot;dn3&quot;</span> <span class="attr">primaryKey</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">table</span> <span class="attr">name</span>=<span class="string">&quot;tb_areas_provinces&quot;</span> <span class="attr">dataNode</span>=<span class="string">&quot;dn3&quot;</span> <span class="attr">primaryKey</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">table</span> <span class="attr">name</span>=<span class="string">&quot;tb_areas_city&quot;</span> <span class="attr">dataNode</span>=<span class="string">&quot;dn3&quot;</span> <span class="attr">primaryKey</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">table</span> <span class="attr">name</span>=<span class="string">&quot;tb_areas_region&quot;</span> <span class="attr">dataNode</span>=<span class="string">&quot;dn3&quot;</span> <span class="attr">primaryKey</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">schema</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dataNode</span> <span class="attr">name</span>=<span class="string">&quot;dn1&quot;</span> <span class="attr">dataHost</span>=<span class="string">&quot;dhost1&quot;</span> <span class="attr">database</span>=<span class="string">&quot;shopping&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dataNode</span> <span class="attr">name</span>=<span class="string">&quot;dn2&quot;</span> <span class="attr">dataHost</span>=<span class="string">&quot;dhost2&quot;</span> <span class="attr">database</span>=<span class="string">&quot;shopping&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dataNode</span> <span class="attr">name</span>=<span class="string">&quot;dn3&quot;</span> <span class="attr">dataHost</span>=<span class="string">&quot;dhost3&quot;</span> <span class="attr">database</span>=<span class="string">&quot;shopping&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dataHost</span> <span class="attr">name</span>=<span class="string">&quot;dhost1&quot;</span> <span class="attr">maxCon</span>=<span class="string">&quot;1000&quot;</span> <span class="attr">minCon</span>=<span class="string">&quot;10&quot;</span> <span class="attr">balance</span>=<span class="string">&quot;0&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">writeType</span>=<span class="string">&quot;0&quot;</span> <span class="attr">dbType</span>=<span class="string">&quot;mysql&quot;</span> <span class="attr">dbDriver</span>=<span class="string">&quot;jdbc&quot;</span> <span class="attr">switchType</span>=<span class="string">&quot;1&quot;</span>  <span class="attr">slaveThreshold</span>=<span class="string">&quot;100&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">heartbeat</span>&gt;</span>select user()<span class="tag">&lt;/<span class="name">heartbeat</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">writeHost</span> <span class="attr">host</span>=<span class="string">&quot;master&quot;</span> <span class="attr">url</span>=<span class="string">&quot;jdbc:mysql://itachi103:3306?useSSL=false<span class="symbol">&amp;amp;</span>serverTimezone=Asia/Shanghai<span class="symbol">&amp;amp;</span>characterEncoding=utf8&quot;</span> <span class="attr">user</span>=<span class="string">&quot;root&quot;</span> <span class="attr">password</span>=<span class="string">&quot;root&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dataHost</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dataHost</span> <span class="attr">name</span>=<span class="string">&quot;dhost2&quot;</span> <span class="attr">maxCon</span>=<span class="string">&quot;1000&quot;</span> <span class="attr">minCon</span>=<span class="string">&quot;10&quot;</span> <span class="attr">balance</span>=<span class="string">&quot;0&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">writeType</span>=<span class="string">&quot;0&quot;</span> <span class="attr">dbType</span>=<span class="string">&quot;mysql&quot;</span> <span class="attr">dbDriver</span>=<span class="string">&quot;jdbc&quot;</span> <span class="attr">switchType</span>=<span class="string">&quot;1&quot;</span>  <span class="attr">slaveThreshold</span>=<span class="string">&quot;100&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">heartbeat</span>&gt;</span>select user()<span class="tag">&lt;/<span class="name">heartbeat</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">writeHost</span> <span class="attr">host</span>=<span class="string">&quot;master&quot;</span> <span class="attr">url</span>=<span class="string">&quot;jdbc:mysql://itachi104:3306?useSSL=false<span class="symbol">&amp;amp;</span>serverTimezone=Asia/Shanghai<span class="symbol">&amp;amp;</span>characterEncoding=utf8&quot;</span> <span class="attr">user</span>=<span class="string">&quot;root&quot;</span> <span class="attr">password</span>=<span class="string">&quot;root&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dataHost</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dataHost</span> <span class="attr">name</span>=<span class="string">&quot;dhost3&quot;</span> <span class="attr">maxCon</span>=<span class="string">&quot;1000&quot;</span> <span class="attr">minCon</span>=<span class="string">&quot;10&quot;</span> <span class="attr">balance</span>=<span class="string">&quot;0&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">writeType</span>=<span class="string">&quot;0&quot;</span> <span class="attr">dbType</span>=<span class="string">&quot;mysql&quot;</span> <span class="attr">dbDriver</span>=<span class="string">&quot;jdbc&quot;</span> <span class="attr">switchType</span>=<span class="string">&quot;1&quot;</span>  <span class="attr">slaveThreshold</span>=<span class="string">&quot;100&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">heartbeat</span>&gt;</span>select user()<span class="tag">&lt;/<span class="name">heartbeat</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">writeHost</span> <span class="attr">host</span>=<span class="string">&quot;master&quot;</span> <span class="attr">url</span>=<span class="string">&quot;jdbc:mysql://itachi105:3306?useSSL=false<span class="symbol">&amp;amp;</span>serverTimezone=Asia/Shanghai<span class="symbol">&amp;amp;</span>characterEncoding=utf8&quot;</span> <span class="attr">user</span>=<span class="string">&quot;root&quot;</span> <span class="attr">password</span>=<span class="string">&quot;root&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dataHost</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mycat:schema</span>&gt;</span></span><br></pre></td></tr></table></figure><p>server.xml</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">user</span> <span class="attr">name</span>=<span class="string">&quot;root&quot;</span> <span class="attr">defaultAccount</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span>&gt;</span>123456<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;schemas&quot;</span>&gt;</span>SHOPPING<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">user</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">user</span> <span class="attr">name</span>=<span class="string">&quot;user&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span>&gt;</span>123456<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;schemas&quot;</span>&gt;</span>SHOPPING<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;readOnly&quot;</span>&gt;</span>true<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">user</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>ä¸Šä¼ sqlæ–‡ä»¶è‡³itachi103çš„<code>/opt/sql</code></strong></p><p><strong>åœ¨itachi103ç™»å½•mycat</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -hitachi103 -P8066 -uroot -p123456 --default_auth=mysql_native_password</span><br></pre></td></tr></table></figure><p><strong>ç„¶ååœ¨é‡Œé¢è¿è¡Œsqlæ–‡ä»¶</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> use SHOPPING;</span><br><span class="line">mysql<span class="operator">&gt;</span> source <span class="operator">/</span>home<span class="operator">/</span><span class="keyword">sql</span><span class="operator">/</span>shopping<span class="operator">-</span>table.sql</span><br><span class="line">mysql<span class="operator">&gt;</span> source <span class="operator">/</span>home<span class="operator">/</span><span class="keyword">sql</span><span class="operator">/</span>shopping<span class="operator">-</span>insert.sql</span><br></pre></td></tr></table></figure><p><strong>åœ¨datagripæŸ¥çœ‹æ¯ä¸€ä¸ªMysqlæœåŠ¡å™¨æ˜¯å¦æœ‰å“åº”æ•°æ®</strong></p><p><strong>æµ‹è¯•å¤šè¡¨è”æŸ¥</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> ua.user_id, ua.contact, p.province, c.city, r.area, ua.address</span><br><span class="line"><span class="keyword">from</span> tb_user_address ua, tb_areas_provinces p, tb_areas_city c, tb_areas_region r</span><br><span class="line"><span class="keyword">where</span> ua.province_id<span class="operator">=</span>p.provinceid <span class="keyword">and</span> ua.city_id<span class="operator">=</span>c.cityid <span class="keyword">and</span> ua.town_id<span class="operator">=</span>r.areaid;</span><br></pre></td></tr></table></figure><p>ä¸Šè¿°sqlåœ¨itachi105ä¸Šæ˜¯èƒ½æˆåŠŸçš„ï¼Œå› ä¸ºä¸Šè¿°sqlä½¿ç”¨çš„è¡¨åœ¨itachi105ä¸Šéƒ½æœ‰ï¼Œç„¶ååœ¨mycatä¸­æ‰§è¡Œä¹Ÿæ˜¯èƒ½æˆåŠŸçš„</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> order_id, payment, receiver, province, city, area</span><br><span class="line"><span class="keyword">from</span> tb_order_master o, tb_areas_provinces p, tb_areas_city c, tb_areas_region r</span><br><span class="line"><span class="keyword">where</span> o.receiver_province<span class="operator">=</span>p.provinceid <span class="keyword">and</span> o.receiver_city<span class="operator">=</span>c.cityid <span class="keyword">and</span> o.receiver_region<span class="operator">=</span>r.areaid;</span><br></pre></td></tr></table></figure><p>ä¸Šè¿°è¯­å¥åœ¨mycatä¸­æ‰§è¡ŒæŠ¥é”™ <code>invalid route in sql, multi tables found but datanode has no intersection</code> ï¼ŒåŸå› æ˜¯ <code>tb_order_master</code> è¡¨å’Œå…¶ä»–è¡¨ä¸å±äºåŒä¸€ä¸ªdataNodeä¸­ã€‚</p><p>â€‹    </p><p><strong>å…¨å±€è¡¨demo</strong></p><p>å› ä¸ºæœ‰è¿™æ ·çš„éœ€æ±‚ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥æŠŠ<code>tb_areas_provinces</code>ï¼Œ <code>tb_areas_city</code>ï¼Œ <code>tb_areas_region</code> è¿™ä¸‰ä¸ªè¡¨è®¾ç½®ä¸ºå…¨å±€è¡¨ã€‚è¿™æ ·æ“ä½œåï¼Œä¸‰å°mysqlæœåŠ¡å™¨ä¸­éƒ½ä¼šå«æœ‰è¿™ä¸‰ä¸ªè¡¨ã€‚</p><p>æ­¥éª¤ï¼šåœæ‰mycat  -&gt; å»data gripå…ˆå°†ä¸‰ä¸ªmysqlä¸­çš„shoppingæ•°æ®åº“çš„è¡¨éƒ½åˆ é™¤æ‰ -&gt; é‡å¤ä¸Šè¿°æ­¥éª¤ï¼Œä»…ä»…æ˜¯å°†é…ç½®æ–‡ä»¶ä¿®æ”¹ä¸€ä¸‹ï¼š</p><p>schema.xml</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">table</span> <span class="attr">name</span>=<span class="string">&quot;tb_areas_provinces&quot;</span> <span class="attr">dataNode</span>=<span class="string">&quot;dn1,dn2,dn3&quot;</span> <span class="attr">primaryKey</span>=<span class="string">&quot;id&quot;</span> <span class="attr">type</span>=<span class="string">&quot;global&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">table</span> <span class="attr">name</span>=<span class="string">&quot;tb_areas_city&quot;</span> <span class="attr">dataNode</span>=<span class="string">&quot;dn1,dn2,dn3&quot;</span> <span class="attr">primaryKey</span>=<span class="string">&quot;id&quot;</span> <span class="attr">type</span>=<span class="string">&quot;global&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">table</span> <span class="attr">name</span>=<span class="string">&quot;tb_areas_region&quot;</span> <span class="attr">dataNode</span>=<span class="string">&quot;dn1,dn2,dn3&quot;</span> <span class="attr">primaryKey</span>=<span class="string">&quot;id&quot;</span> <span class="attr">type</span>=<span class="string">&quot;global&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure><p>ç„¶ååœ¨mycatä¸­æµ‹è¯•ï¼Œå°±èƒ½æˆåŠŸæ‰§è¡Œä¸Šè¿°ä¸¤æ¡sqläº†ã€‚</p><h2 id="10-4-è¯»å†™åˆ†ç¦»"><a href="#10-4-è¯»å†™åˆ†ç¦»" class="headerlink" title="10.4.è¯»å†™åˆ†ç¦»"></a>10.4.è¯»å†™åˆ†ç¦»</h2><p>MyCatçš„schema.xmlä¸­çš„dataHostæ ‡ç­¾çš„balanceå±æ€§</p><div class="table-container"><table><thead><tr><th>balanceå‚æ•°å€¼</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td>0ï¼ˆé»˜è®¤å€¼ï¼‰</td><td>ä¸å¼€å¯è¯»å†™åˆ†ç¦»æœºåˆ¶ï¼Œæ‰€æœ‰è¯»æ“ä½œéƒ½å‘é€åˆ°å½“å‰å¯ç”¨çš„writeHostä¸Š</td></tr><tr><td>1</td><td>å…¨éƒ¨çš„readHostä¸å¤‡ç”¨çš„writeHostéƒ½å‚ä¸selectè¯­å¥çš„è´Ÿè½½å‡è¡¡ï¼ˆä¸»è¦é’ˆå¯¹äºåŒä¸»åŒä»æ¨¡å¼ï¼‰</td></tr><tr><td>2</td><td>æ‰€æœ‰çš„è¯»å†™æ“ä½œéƒ½éšæœºåœ¨writeHostï¼ŒreadHostä¸Šåˆ†å‘</td></tr><tr><td>3</td><td>æ‰€æœ‰çš„è¯»è¯·æ±‚éšæœºåˆ†å‘åˆ°writeHostå¯¹åº”çš„readHostä¸Šæ‰§è¡Œã€‚writeHoståªè´Ÿæ‹…å†™å‹åŠ›ï¼Œä¸è´Ÿæ‹…è¯»å‹åŠ›</td></tr></tbody></table></div><h3 id="10-4-1-ä¸€ä¸»ä¸€ä»è¯»å†™åˆ†ç¦»"><a href="#10-4-1-ä¸€ä¸»ä¸€ä»è¯»å†™åˆ†ç¦»" class="headerlink" title="10.4.1.ä¸€ä¸»ä¸€ä»è¯»å†™åˆ†ç¦»"></a>10.4.1.ä¸€ä¸»ä¸€ä»è¯»å†™åˆ†ç¦»</h3><ol><li>å‡†å¤‡å¥½ä¸€ä¸»ä¸€ä»ï¼Œitachi106ä¸ºä¸»åº“ï¼Œitachi107ä¸ºä»åº“ï¼Œå¹¶ä¸”åœ¨ä¸»åº“å®‰è£…å¥½MyCat</li><li>å»ä¸»åº“æ‰§è¡Œsql</li></ol><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> database itachi;</span><br><span class="line"></span><br><span class="line">use itachi;</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> tb_user(</span><br><span class="line">id <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">not</span> <span class="keyword">null</span>,</span><br><span class="line">name <span class="type">varchar</span>(<span class="number">50</span>) <span class="keyword">not</span> <span class="keyword">null</span>,</span><br><span class="line">sex <span class="type">varchar</span>(<span class="number">1</span>),</span><br><span class="line"><span class="keyword">primary</span> key (id)</span><br><span class="line">)engine<span class="operator">=</span>innodb <span class="keyword">default</span> charset<span class="operator">=</span>utf8;</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> tb_user(id,name,sex) <span class="keyword">values</span>(<span class="number">1</span>,<span class="string">&#x27;Tom&#x27;</span>,<span class="string">&#x27;1&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> tb_user(id,name,sex) <span class="keyword">values</span>(<span class="number">2</span>,<span class="string">&#x27;Trigger&#x27;</span>,<span class="string">&#x27;0&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> tb_user(id,name,sex) <span class="keyword">values</span>(<span class="number">3</span>,<span class="string">&#x27;Dawn&#x27;</span>,<span class="string">&#x27;1&#x27;</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure><ol><li>mycaté…ç½®</li></ol><p>schema.xml</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mycat</span>:schema <span class="keyword">SYSTEM</span> <span class="string">&quot;schema.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mycat:schema</span> <span class="attr">xmlns:mycat</span>=<span class="string">&quot;http://io.mycat/&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">schema</span> <span class="attr">name</span>=<span class="string">&quot;ITACHI_RW&quot;</span> <span class="attr">checkSQLschema</span>=<span class="string">&quot;true&quot;</span> <span class="attr">sqlMaxLimit</span>=<span class="string">&quot;100&quot;</span> <span class="attr">dataNode</span>=<span class="string">&quot;dn1&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">schema</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dataNode</span> <span class="attr">name</span>=<span class="string">&quot;dn1&quot;</span> <span class="attr">dataHost</span>=<span class="string">&quot;dhost1&quot;</span> <span class="attr">database</span>=<span class="string">&quot;itachi&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dataHost</span> <span class="attr">name</span>=<span class="string">&quot;dhost1&quot;</span> <span class="attr">maxCon</span>=<span class="string">&quot;1000&quot;</span> <span class="attr">minCon</span>=<span class="string">&quot;10&quot;</span> <span class="attr">balance</span>=<span class="string">&quot;3&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">writeType</span>=<span class="string">&quot;0&quot;</span> <span class="attr">dbType</span>=<span class="string">&quot;mysql&quot;</span> <span class="attr">dbDriver</span>=<span class="string">&quot;jdbc&quot;</span> <span class="attr">switchType</span>=<span class="string">&quot;1&quot;</span>  <span class="attr">slaveThreshold</span>=<span class="string">&quot;100&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">heartbeat</span>&gt;</span>select user()<span class="tag">&lt;/<span class="name">heartbeat</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">writeHost</span> <span class="attr">host</span>=<span class="string">&quot;master&quot;</span> <span class="attr">url</span>=<span class="string">&quot;jdbc:mysql://itachi106:3306?useSSL=false<span class="symbol">&amp;amp;</span>serverTimezone=Asia/Shanghai<span class="symbol">&amp;amp;</span>characterEncoding=utf8&quot;</span> <span class="attr">user</span>=<span class="string">&quot;root&quot;</span> <span class="attr">password</span>=<span class="string">&quot;root&quot;</span> &gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">readHost</span> <span class="attr">host</span>=<span class="string">&quot;slave&quot;</span> <span class="attr">url</span>=<span class="string">&quot;jdbc:mysql://itachi107:3306?useSSL=false<span class="symbol">&amp;amp;</span>serverTimezone=Asia/Shanghai<span class="symbol">&amp;amp;</span>characterEncoding=utf8&quot;</span> <span class="attr">user</span>=<span class="string">&quot;root&quot;</span> <span class="attr">password</span>=<span class="string">&quot;root&quot;</span> &gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">readHost</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">writeHost</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dataHost</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">mycat:schema</span>&gt;</span></span><br></pre></td></tr></table></figure><p>server.xml</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">user</span> <span class="attr">name</span>=<span class="string">&quot;root&quot;</span> <span class="attr">defaultAccount</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span>&gt;</span>123456<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;schemas&quot;</span>&gt;</span>ITACHI_RW<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">user</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">user</span> <span class="attr">name</span>=<span class="string">&quot;user&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span>&gt;</span>123456<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;schemas&quot;</span>&gt;</span>ITACHI_RW<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;readOnly&quot;</span>&gt;</span>true<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">user</span>&gt;</span></span><br></pre></td></tr></table></figure><ol><li>ç™»å½•mycatæµ‹è¯•</li></ol><p>åœ¨itachi107ä»åº“ä¸­ä¿®æ”¹è¡¨ä¸­çš„æŸé¡¹æ•°æ®ï¼Œç„¶åå»mycatä¸­æŸ¥çœ‹ï¼Œç»“æœæŸ¥çœ‹çš„æ•°æ®ä¸€ç›´æ˜¯itachi107çš„æ•°æ®ï¼Œå¤šè¯•å‡ æ¬¡è¿˜æ˜¯è¿™æ ·ï¼Œè¯´æ˜è¯»çš„æ—¶å€™æ˜¯å»ä»åº“è¯»å–çš„ã€‚</p><p>åœ¨mycatä¸­æ’å…¥ä¸€è¡Œæ•°æ®ï¼Œä½†æ˜¯åœ¨itachi106ä¸»åº“å’Œitachi107ä¸»åº“éƒ½èƒ½æŸ¥å¾—åˆ°è¿™è¡Œæ–°æ•°æ®ï¼Œè¯´æ˜å†™æ•°æ®æ˜¯åœ¨ä¸»åº“ä¸­è¿›è¡Œçš„ï¼Œå› ä¸ºå¦‚æœåœ¨ä»åº“ä¸­å†™å…¥æ˜¯ä¸ä¼šåŒæ­¥åˆ°ä¸»åº“çš„ã€‚</p><p><strong>é—®é¢˜ï¼šä¸»èŠ‚ç‚¹Masterå®•æœºä¹‹åï¼Œä¸šåŠ¡ç³»ç»Ÿå°±åªèƒ½å¤Ÿè¯»ï¼Œè€Œä¸èƒ½å†™å…¥æ•°æ®äº†ã€‚</strong></p><h3 id="10-4-2-åŒä¸»åŒä»è¯»å†™åˆ†ç¦»"><a href="#10-4-2-åŒä¸»åŒä»è¯»å†™åˆ†ç¦»" class="headerlink" title="10.4.2.åŒä¸»åŒä»è¯»å†™åˆ†ç¦»"></a>10.4.2.åŒä¸»åŒä»è¯»å†™åˆ†ç¦»</h3><h5 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h5><p>ä¸€ä¸ªä¸»æœº Master1 ç”¨äºå¤„ç†æ‰€æœ‰å†™è¯·æ±‚ï¼Œå®ƒçš„ä»æœº Slave1 å’Œå¦ä¸€å°ä¸»æœº Master2 è¿˜æœ‰å®ƒçš„ä»æœº Slave2 è´Ÿè´£æ‰€æœ‰è¯»è¯·æ±‚ã€‚å½“Master1ä¸»æœºå®•æœºåï¼ŒMaster2 ä¸»æœºè´Ÿè´£å†™è¯·æ±‚ï¼ŒMaster1ã€Master2 äº’ä¸ºå¤‡æœºã€‚æ¶æ„å›¾å¦‚ä¸‹ï¼š</p><p><img src="http://cdn.leesin.fun/typora/s3/img/åŒä¸»åŒä».png" alt="åŒä¸»åŒä»"></p><h5 id="å‡†å¤‡å·¥ä½œ-1"><a href="#å‡†å¤‡å·¥ä½œ-1" class="headerlink" title="å‡†å¤‡å·¥ä½œ"></a>å‡†å¤‡å·¥ä½œ</h5><p>å‡†å¤‡5å°æœåŠ¡å™¨</p><div class="table-container"><table><thead><tr><th style="text-align:center">ç¼–å·</th><th style="text-align:center">ä¸»æœº</th><th style="text-align:center">é¢„è£…è½¯ä»¶</th><th style="text-align:center">è§’è‰²</th></tr></thead><tbody><tr><td style="text-align:center">1</td><td style="text-align:center">itachi108</td><td style="text-align:center">mycatã€mysql</td><td style="text-align:center">mycatä¸­é—´ä»¶æœåŠ¡å™¨</td></tr><tr><td style="text-align:center">2</td><td style="text-align:center">itachi109</td><td style="text-align:center">mysql</td><td style="text-align:center">master1</td></tr><tr><td style="text-align:center">3</td><td style="text-align:center">itachi110</td><td style="text-align:center">mysql</td><td style="text-align:center">slave1</td></tr><tr><td style="text-align:center">4</td><td style="text-align:center">itachi111</td><td style="text-align:center">mysql</td><td style="text-align:center">maste2</td></tr><tr><td style="text-align:center">5</td><td style="text-align:center">itachi112</td><td style="text-align:center">mysql</td><td style="text-align:center">slave2</td></tr></tbody></table></div><p>å¦‚æœæ˜¯å…‹éš†è¿‡æ¥çš„æœºå™¨ï¼Œéœ€è¦ä¿®æ”¹æ¯å°mysqlçš„uuidï¼Œç¡®ä¿ä¸åŒ</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"># ç™»å½•mysql</span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> uuid();</span><br><span class="line"><span class="operator">+</span><span class="comment">--------------------------------------+</span></span><br><span class="line"><span class="operator">|</span> uuid()                               <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">--------------------------------------+</span></span><br><span class="line"><span class="operator">|</span> b33057ff<span class="operator">-</span>bec6<span class="number">-11</span>eb<span class="operator">-</span>ad94<span class="number">-000</span>c29af6856 <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">--------------------------------------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line">â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”</span><br><span class="line"></span><br><span class="line"># é€€å‡ºmysqlï¼Œå»ä¿®æ”¹uuid</span><br><span class="line">vim <span class="operator">/</span>var<span class="operator">/</span>lib<span class="operator">/</span>mysql<span class="operator">/</span>auto.cnf</span><br><span class="line"></span><br><span class="line">systemctl restart mysqld</span><br><span class="line"></span><br></pre></td></tr></table></figure><h5 id="æ­å»º-1"><a href="#æ­å»º-1" class="headerlink" title="æ­å»º"></a>æ­å»º</h5><p>ä¸»åº“é…ç½®ï¼ˆMaster1-itachi109ï¼‰</p><ol><li>ä¿®æ”¹é…ç½®æ–‡ä»¶<code>/etc/my.cnf</code></li></ol><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># mysqlæœåŠ¡IDï¼Œä¿è¯æ•´ä¸ªé›†ç¾¤ç¯å¢ƒä¸­å”¯ä¸€ï¼Œå–å€¼èŒƒå›´: 1 - 2^32-1ï¼Œé»˜è®¤ä¸º1</span></span><br><span class="line"><span class="attr">server-id</span>=<span class="string">1</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment"># æŒ‡å®šåŒæ­¥çš„æ•°æ®åº“</span></span><br><span class="line"><span class="attr">binlog-do-db</span>=<span class="string">db01</span></span><br><span class="line"><span class="attr">binlog-do-db</span>=<span class="string">db02</span></span><br><span class="line"><span class="attr">binlog-do-db</span>=<span class="string">db03</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># å½“å½“å‰èŠ‚ç‚¹åœ¨ä½œä¸ºä»æ•°æ®åº“çš„æ—¶å€™ï¼Œæœ‰å†™å…¥æ“ä½œä¹Ÿè¦æ›´æ–°äºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶</span></span><br><span class="line"><span class="attr">log-slave-updates</span></span><br></pre></td></tr></table></figure><ol><li>é‡å¯mysqlæœåŠ¡</li><li>ç™»å½•mysqlï¼Œåˆ›å»ºä»åº“è¿æ¥ä¸»åº“ç”¨çš„è¿œç¨‹è¿æ¥çš„è´¦å·ï¼Œå¹¶æˆäºˆä¸»ä»å¤åˆ¶æƒé™</li></ol><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># åˆ›å»ºitachiç”¨æˆ·ï¼Œè¯¥ç”¨æˆ·å¯åœ¨ä»»æ„ä¸»æœºè¿æ¥è¯¥mysqlæœåŠ¡</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">user</span> <span class="string">&#x27;itachi&#x27;</span>@<span class="string">&#x27;%&#x27;</span> IDENTIFIED <span class="keyword">WITH</span> mysql_native_password <span class="keyword">BY</span> <span class="string">&#x27;root&#x27;</span>;</span><br><span class="line"># ä¸º<span class="string">&#x27;itachi&#x27;</span>@<span class="string">&#x27;%&#x27;</span>ç”¨æˆ·åˆ†é…ä¸»ä»å¤åˆ¶æƒé™</span><br><span class="line"><span class="keyword">grant</span> replication slave <span class="keyword">on</span> <span class="operator">*</span>.<span class="operator">*</span> <span class="keyword">to</span> <span class="string">&#x27;itachi&#x27;</span>@<span class="string">&#x27;%&#x27;</span>;</span><br></pre></td></tr></table></figure><ol><li>é€šè¿‡æŒ‡ä»¤ï¼ŒæŸ¥çœ‹äºŒè¿›åˆ¶æ—¥å¿—åæ ‡</li></ol><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> master status;</span><br></pre></td></tr></table></figure><p>ä¸»åº“é…ç½®ï¼ˆMaster2-itachi111ï¼‰</p><ol><li>ä¿®æ”¹é…ç½®æ–‡ä»¶<code>/etc/my.cnf</code></li></ol><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># mysqlæœåŠ¡IDï¼Œä¿è¯æ•´ä¸ªé›†ç¾¤ç¯å¢ƒä¸­å”¯ä¸€ï¼Œå–å€¼èŒƒå›´: 1 - 2^32-1ï¼Œé»˜è®¤ä¸º1</span></span><br><span class="line"><span class="attr">server-id</span>=<span class="string">3</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># æŒ‡å®šåŒæ­¥çš„æ•°æ®åº“</span></span><br><span class="line"><span class="attr">binlog-do-db</span>=<span class="string">db01</span></span><br><span class="line"><span class="attr">binlog-do-db</span>=<span class="string">db02</span></span><br><span class="line"><span class="attr">binlog-do-db</span>=<span class="string">db03</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># å½“å½“å‰èŠ‚ç‚¹åœ¨ä½œä¸ºä»æ•°æ®åº“çš„æ—¶å€™ï¼Œæœ‰å†™å…¥æ“ä½œä¹Ÿè¦æ›´æ–°äºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶</span></span><br><span class="line"><span class="attr">log-slave-updates</span></span><br></pre></td></tr></table></figure><ol><li><p>é‡å¯mysqlæœåŠ¡</p></li><li><p>ç™»å½•mysqlï¼Œåˆ›å»ºä»åº“è¿æ¥ä¸»åº“ç”¨çš„è¿œç¨‹è¿æ¥çš„è´¦å·ï¼Œå¹¶æˆäºˆä¸»ä»å¤åˆ¶æƒé™</p></li></ol><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># åˆ›å»ºitachiç”¨æˆ·ï¼Œè¯¥ç”¨æˆ·å¯åœ¨ä»»æ„ä¸»æœºè¿æ¥è¯¥mysqlæœåŠ¡</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">user</span> <span class="string">&#x27;itachi&#x27;</span>@<span class="string">&#x27;%&#x27;</span> IDENTIFIED <span class="keyword">WITH</span> mysql_native_password <span class="keyword">BY</span> <span class="string">&#x27;root&#x27;</span>;</span><br><span class="line"># ä¸º<span class="string">&#x27;itachi&#x27;</span>@<span class="string">&#x27;%&#x27;</span>ç”¨æˆ·åˆ†é…ä¸»ä»å¤åˆ¶æƒé™</span><br><span class="line"><span class="keyword">grant</span> replication slave <span class="keyword">on</span> <span class="operator">*</span>.<span class="operator">*</span> <span class="keyword">to</span> <span class="string">&#x27;itachi&#x27;</span>@<span class="string">&#x27;%&#x27;</span>;</span><br></pre></td></tr></table></figure><ol><li>é€šè¿‡æŒ‡ä»¤ï¼ŒæŸ¥çœ‹äºŒè¿›åˆ¶æ—¥å¿—åæ ‡</li></ol><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> master status;</span><br></pre></td></tr></table></figure><p>ä»åº“é…ç½®ï¼ˆSlave1-itachi110ï¼‰</p><ol><li>ä¿®æ”¹é…ç½®æ–‡ä»¶<code>/etc/my.cnf</code></li></ol><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># mysqlæœåŠ¡IDï¼Œä¿è¯æ•´ä¸ªé›†ç¾¤ç¯å¢ƒä¸­å”¯ä¸€ï¼Œå–å€¼èŒƒå›´: 1 - 2^32-1ï¼Œé»˜è®¤ä¸º1</span></span><br><span class="line"><span class="attr">server-id</span>=<span class="string">2</span></span><br></pre></td></tr></table></figure><ol><li>é‡å¯mysqlæœåŠ¡</li><li>ç™»å½•mysqlï¼Œè®¾ç½®ä¸»åº“é…ç½®</li></ol><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">change master <span class="keyword">to</span> master_host<span class="operator">=</span><span class="string">&#x27;itachi109&#x27;</span>,maaster_user<span class="operator">=</span><span class="string">&#x27;itachi&#x27;</span>,master_password<span class="operator">=</span><span class="string">&#x27;root&#x27;</span>,master_log_file<span class="operator">=</span><span class="string">&#x27;binlog.000006&#x27;</span>,master_log_pos<span class="operator">=</span><span class="number">663</span>;</span><br></pre></td></tr></table></figure><ol><li>å¼€å¯åŒæ­¥æ“ä½œ</li></ol><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">start</span> slave; </span><br></pre></td></tr></table></figure><ol><li>æŸ¥çœ‹ä¸»ä»åŒæ­¥çŠ¶æ€</li></ol><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> slave status\G; </span><br></pre></td></tr></table></figure><p>ä¸»è¦çœ‹ä¸¤ä¸ªå­—æ®µï¼Œå¦‚æœè¿™ä¸¤ä¸ªå­—æ®µä¸ºYESï¼Œè¯´æ˜å°±æˆåŠŸäº†</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Slave_IO_Running: Yes</span><br><span class="line">Slave_SQL_Running: Yes</span><br></pre></td></tr></table></figure><p>ä»åº“é…ç½®ï¼ˆSlave2-itachi112ï¼‰</p><ol><li>ä¿®æ”¹é…ç½®æ–‡ä»¶<code>/etc/my.cnf</code></li></ol><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># mysqlæœåŠ¡IDï¼Œä¿è¯æ•´ä¸ªé›†ç¾¤ç¯å¢ƒä¸­å”¯ä¸€ï¼Œå–å€¼èŒƒå›´: 1 - 2^32-1ï¼Œé»˜è®¤ä¸º1</span></span><br><span class="line"><span class="attr">server-id</span>=<span class="string">4</span></span><br></pre></td></tr></table></figure><ol><li>é‡å¯mysqlæœåŠ¡</li><li>ç™»å½•mysqlï¼Œè®¾ç½®ä¸»åº“é…ç½®</li></ol><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">change master <span class="keyword">to</span> master_host<span class="operator">=</span><span class="string">&#x27;itachi111&#x27;</span>,master_user<span class="operator">=</span><span class="string">&#x27;itachi&#x27;</span>,master_password<span class="operator">=</span><span class="string">&#x27;root&#x27;</span>,master_log_file<span class="operator">=</span><span class="string">&#x27;binlog.000007&#x27;</span>,master_log_pos<span class="operator">=</span><span class="number">663</span>;</span><br></pre></td></tr></table></figure><ol><li>å¼€å¯åŒæ­¥æ“ä½œ</li></ol><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">start</span> slave; </span><br></pre></td></tr></table></figure><ol><li>æŸ¥çœ‹ä¸»ä»åŒæ­¥çŠ¶æ€</li></ol><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> slave status\G; </span><br></pre></td></tr></table></figure><p>ä¸»è¦çœ‹ä¸¤ä¸ªå­—æ®µï¼Œå¦‚æœè¿™ä¸¤ä¸ªå­—æ®µä¸ºYESï¼Œè¯´æ˜å°±æˆåŠŸäº†</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Slave_IO_Running: Yes</span><br><span class="line">Slave_SQL_Running: Yes</span><br></pre></td></tr></table></figure><p>ä¸¤å°ä¸»åº“ç›¸äº’å¤åˆ¶</p><p>Master1å¤åˆ¶Master2ï¼ŒMaster2å¤åˆ¶Master1</p><p>åœ¨itachi109ï¼Œå³Master1ä¸­</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">change master <span class="keyword">to</span> master_host<span class="operator">=</span><span class="string">&#x27;itachi111&#x27;</span>,master_user<span class="operator">=</span><span class="string">&#x27;itachi&#x27;</span>,master_password<span class="operator">=</span><span class="string">&#x27;root&#x27;</span>,master_log_file<span class="operator">=</span><span class="string">&#x27;binlog.000007&#x27;</span>,master_log_pos<span class="operator">=</span><span class="number">663</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">start</span> slave; </span><br><span class="line"></span><br><span class="line"><span class="keyword">show</span> slave status\G; </span><br></pre></td></tr></table></figure><p>åœ¨itachi111ï¼Œå³Master2ä¸­</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">change master <span class="keyword">to</span> master_host<span class="operator">=</span><span class="string">&#x27;itachi109&#x27;</span>,master_user<span class="operator">=</span><span class="string">&#x27;itachi&#x27;</span>,master_password<span class="operator">=</span><span class="string">&#x27;root&#x27;</span>,master_log_file<span class="operator">=</span><span class="string">&#x27;binlog.000006&#x27;</span>,master_log_pos<span class="operator">=</span><span class="number">663</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">start</span> slave; </span><br><span class="line"></span><br><span class="line"><span class="keyword">show</span> slave status\G; </span><br></pre></td></tr></table></figure><h5 id="æµ‹è¯•-1"><a href="#æµ‹è¯•-1" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h5><p>åœ¨Datagripä¸­ï¼ŒMaster1æ‰§è¡Œåˆ›å»ºæ•°æ®åº“å’Œè¡¨ï¼Œçœ‹çœ‹M2å’ŒS1å’ŒS2æ˜¯å¦åŒæ­¥</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> database db01;</span><br><span class="line"></span><br><span class="line">use db01;</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> tb_user(</span><br><span class="line">id <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">not</span> <span class="keyword">null</span>,</span><br><span class="line">name <span class="type">varchar</span>(<span class="number">50</span>) <span class="keyword">not</span> <span class="keyword">null</span>,</span><br><span class="line">sex <span class="type">varchar</span>(<span class="number">1</span>),</span><br><span class="line"><span class="keyword">primary</span> key (id)</span><br><span class="line">)engine<span class="operator">=</span>innodb <span class="keyword">default</span> charset<span class="operator">=</span>utf8;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ç„¶åMaster2æ‰§è¡Œæ’å…¥æ•°æ®ï¼Œçœ‹çœ‹æ˜¯å¦åŒæ­¥</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">use db01;</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> tb_user(id,name,sex) <span class="keyword">values</span>(<span class="number">1</span>,<span class="string">&#x27;Tom&#x27;</span>,<span class="string">&#x27;1&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> tb_user(id,name,sex) <span class="keyword">values</span>(<span class="number">2</span>,<span class="string">&#x27;Trigger&#x27;</span>,<span class="string">&#x27;0&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> tb_user(id,name,sex) <span class="keyword">values</span>(<span class="number">3</span>,<span class="string">&#x27;Dawn&#x27;</span>,<span class="string">&#x27;1&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> tb_user(id,name,sex) <span class="keyword">values</span>(<span class="number">4</span>,<span class="string">&#x27;Jack Ma&#x27;</span>,<span class="string">&#x27;1&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> tb_user(id,name,sex) <span class="keyword">values</span>(<span class="number">5</span>,<span class="string">&#x27;Coco&#x27;</span>,<span class="string">&#x27;0&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> tb_user(id,name,sex) <span class="keyword">values</span>(<span class="number">6</span>,<span class="string">&#x27;Jerry&#x27;</span>,<span class="string">&#x27;1&#x27;</span>);</span><br></pre></td></tr></table></figure><p>å¦‚æœæµ‹è¯•é€šè¿‡ï¼ŒåŒä¸»åŒä»æ­å»ºå®Œæˆ</p><h5 id="æ­å»ºè¯»å†™åˆ†ç¦»â€”â€”MyCat"><a href="#æ­å»ºè¯»å†™åˆ†ç¦»â€”â€”MyCat" class="headerlink" title="æ­å»ºè¯»å†™åˆ†ç¦»â€”â€”MyCat"></a>æ­å»ºè¯»å†™åˆ†ç¦»â€”â€”MyCat</h5><p>schema.xml</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mycat</span>:schema <span class="keyword">SYSTEM</span> <span class="string">&quot;schema.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mycat:schema</span> <span class="attr">xmlns:mycat</span>=<span class="string">&quot;http://io.mycat/&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">schema</span> <span class="attr">name</span>=<span class="string">&quot;ITACHI_RW2&quot;</span> <span class="attr">checkSQLschema</span>=<span class="string">&quot;true&quot;</span> <span class="attr">sqlMaxLimit</span>=<span class="string">&quot;100&quot;</span> <span class="attr">dataNode</span>=<span class="string">&quot;dn1&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">schema</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dataNode</span> <span class="attr">name</span>=<span class="string">&quot;dn1&quot;</span> <span class="attr">dataHost</span>=<span class="string">&quot;dhost1&quot;</span> <span class="attr">database</span>=<span class="string">&quot;db01&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dataHost</span> <span class="attr">name</span>=<span class="string">&quot;dhost1&quot;</span> <span class="attr">maxCon</span>=<span class="string">&quot;1000&quot;</span> <span class="attr">minCon</span>=<span class="string">&quot;10&quot;</span> <span class="attr">balance</span>=<span class="string">&quot;1&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">writeType</span>=<span class="string">&quot;0&quot;</span> <span class="attr">dbType</span>=<span class="string">&quot;mysql&quot;</span> <span class="attr">dbDriver</span>=<span class="string">&quot;jdbc&quot;</span> <span class="attr">switchType</span>=<span class="string">&quot;1&quot;</span>  <span class="attr">slaveThreshold</span>=<span class="string">&quot;100&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">heartbeat</span>&gt;</span>select user()<span class="tag">&lt;/<span class="name">heartbeat</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">writeHost</span> <span class="attr">host</span>=<span class="string">&quot;master1&quot;</span> <span class="attr">url</span>=<span class="string">&quot;jdbc:mysql://itachi109:3306?useSSL=false<span class="symbol">&amp;amp;</span>serverTimezone=Asia/Shanghai<span class="symbol">&amp;amp;</span>characterEncoding=utf8&quot;</span> <span class="attr">user</span>=<span class="string">&quot;root&quot;</span> <span class="attr">password</span>=<span class="string">&quot;root&quot;</span> &gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">readHost</span> <span class="attr">host</span>=<span class="string">&quot;slave1&quot;</span> <span class="attr">url</span>=<span class="string">&quot;jdbc:mysql://itachi110:3306?useSSL=false<span class="symbol">&amp;amp;</span>serverTimezone=Asia/Shanghai<span class="symbol">&amp;amp;</span>characterEncoding=utf8&quot;</span> <span class="attr">user</span>=<span class="string">&quot;root&quot;</span> <span class="attr">password</span>=<span class="string">&quot;root&quot;</span> &gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">readHost</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">writeHost</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">writeHost</span> <span class="attr">host</span>=<span class="string">&quot;master2&quot;</span> <span class="attr">url</span>=<span class="string">&quot;jdbc:mysql://itachi111:3306?useSSL=false<span class="symbol">&amp;amp;</span>serverTimezone=Asia/Shanghai<span class="symbol">&amp;amp;</span>characterEncoding=utf8&quot;</span> <span class="attr">user</span>=<span class="string">&quot;root&quot;</span> <span class="attr">password</span>=<span class="string">&quot;root&quot;</span> &gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">readHost</span> <span class="attr">host</span>=<span class="string">&quot;slave2&quot;</span> <span class="attr">url</span>=<span class="string">&quot;jdbc:mysql://itachi112:3306?useSSL=false<span class="symbol">&amp;amp;</span>serverTimezone=Asia/Shanghai<span class="symbol">&amp;amp;</span>characterEncoding=utf8&quot;</span> <span class="attr">user</span>=<span class="string">&quot;root&quot;</span> <span class="attr">password</span>=<span class="string">&quot;root&quot;</span> &gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">readHost</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">writeHost</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dataHost</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">mycat:schema</span>&gt;</span></span><br></pre></td></tr></table></figure><p>server.xml</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">user</span> <span class="attr">name</span>=<span class="string">&quot;root&quot;</span> <span class="attr">defaultAccount</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span>&gt;</span>123456<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;schemas&quot;</span>&gt;</span>ITACHI_RW2<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">user</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">user</span> <span class="attr">name</span>=<span class="string">&quot;user&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span>&gt;</span>123456<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;schemas&quot;</span>&gt;</span>ITACHI_RW2<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;readOnly&quot;</span>&gt;</span>true<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">user</span>&gt;</span></span><br></pre></td></tr></table></figure><h5 id="å¯åŠ¨mycat"><a href="#å¯åŠ¨mycat" class="headerlink" title="å¯åŠ¨mycat"></a>å¯åŠ¨mycat</h5><h5 id="ç™»å½•mycat-1"><a href="#ç™»å½•mycat-1" class="headerlink" title="ç™»å½•mycat"></a>ç™»å½•mycat</h5><h5 id="æµ‹è¯•ä¸»ä»å¤åˆ¶"><a href="#æµ‹è¯•ä¸»ä»å¤åˆ¶" class="headerlink" title="æµ‹è¯•ä¸»ä»å¤åˆ¶"></a>æµ‹è¯•ä¸»ä»å¤åˆ¶</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># åœ¨mycatä¸­æ’å…¥æ•°æ®ï¼Œç„¶åå»datagripçœ‹å››ä¸ªmysqlæ˜¯å¦éƒ½æœ‰ç›¸åº”æ•°æ®</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> tb_user <span class="keyword">value</span>(<span class="number">7</span>,<span class="string">&#x27;jackk&#x27;</span>,<span class="number">0</span>);</span><br></pre></td></tr></table></figure><h5 id="æµ‹è¯•é«˜å¯ç”¨"><a href="#æµ‹è¯•é«˜å¯ç”¨" class="headerlink" title="æµ‹è¯•é«˜å¯ç”¨"></a>æµ‹è¯•é«˜å¯ç”¨</h5><ol><li><p>åœæ‰master1çš„mysqlæœåŠ¡</p></li><li><p>åœ¨mycatä¸­æµ‹è¯•æ’å…¥ä¸€è¡Œæ•°æ®</p></li></ol><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">insert</span> <span class="keyword">into</span> tb_user <span class="keyword">value</span>(<span class="number">8</span>,<span class="string">&#x27;jackk&#x27;</span>,<span class="number">0</span>);</span><br><span class="line">Query OK, <span class="number">1</span> <span class="type">row</span> affected (<span class="number">0.01</span> sec)</span><br><span class="line"> OK<span class="operator">!</span></span><br></pre></td></tr></table></figure><ol><li>å»datagripå‘ç°M1è¿æ¥ä¸ä¸Šï¼ŒS1æ²¡æ–°æ•°æ®ï¼ˆå› ä¸ºM1æŒ‚äº†ï¼‰ï¼ŒM2å’ŒS2éƒ½æœ‰æ–°æ•°æ®ã€‚å¹¶ä¸”æ­¤æ—¶çš„è¯»è¯·æ±‚ä¹Ÿä¸ä¼šå»s1ä¸­æ‰§è¡Œäº†ï¼ŒæŒ‡æŒ¥åœ¨m2å’Œs2ä¸­è¯»å–æ•°æ®ã€‚</li><li>é‡æ–°å¯åŠ¨M1çš„mysqlæœåŠ¡ï¼Œå†å»datagripæŸ¥çœ‹M1ï¼Œè‡ªåŠ¨æŠŠæ–°æ•°æ®åŒæ­¥è¿‡æ¥äº†ï¼Œä¸”m1å’Œs1æ¢å¤å·¥ä½œçŠ¶æ€ã€‚ï¼ˆçƒ­æ’æ‹”ï¼Ÿï¼‰</li></ol>]]></content>
      
      
      <categories>
          
          <category> åç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ•°æ®åº“ </tag>
            
            <tag> MySQL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linux</title>
      <link href="/post/4.html"/>
      <url>/post/4.html</url>
      
        <content type="html"><![CDATA[<h1 id="ç”¨æˆ·ç®¡ç†"><a href="#ç”¨æˆ·ç®¡ç†" class="headerlink" title="ç”¨æˆ·ç®¡ç†"></a>ç”¨æˆ·ç®¡ç†</h1><h2 id="æ·»åŠ ç”¨æˆ·"><a href="#æ·»åŠ ç”¨æˆ·" class="headerlink" title="æ·»åŠ ç”¨æˆ·"></a>æ·»åŠ ç”¨æˆ·</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">useradd ç”¨æˆ·å</span><br></pre></td></tr></table></figure><blockquote><p>åˆ›å»ºç”¨æˆ·æˆåŠŸåï¼Œä¼šè‡ªåŠ¨åˆ›å»ºå’Œç”¨æˆ·åŒåçš„å®¶ç›®å½•ã€‚</p><p>å¦‚ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@itachi103 home]<span class="comment"># ls</span></span><br><span class="line">itachi</span><br><span class="line">[root@itachi103 home]<span class="comment"># useradd tom</span></span><br><span class="line">[root@itachi103 home]<span class="comment"># ls</span></span><br><span class="line">itachi  tom</span><br></pre></td></tr></table></figure></blockquote><h2 id="æŒ‡å®š-ä¿®æ”¹å¯†ç "><a href="#æŒ‡å®š-ä¿®æ”¹å¯†ç " class="headerlink" title="æŒ‡å®š/ä¿®æ”¹å¯†ç "></a>æŒ‡å®š/ä¿®æ”¹å¯†ç </h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">passwd ç”¨æˆ·å</span><br></pre></td></tr></table></figure><h2 id="åˆ é™¤ç”¨æˆ·"><a href="#åˆ é™¤ç”¨æˆ·" class="headerlink" title="åˆ é™¤ç”¨æˆ·"></a>åˆ é™¤ç”¨æˆ·</h2><ol><li>åˆ é™¤ç”¨æˆ·ï¼Œä½†æ˜¯ä¿ç•™äº†å®¶ç›®å½•</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">userdel ç”¨æˆ·å</span><br></pre></td></tr></table></figure><ol><li>åˆ é™¤ç”¨æˆ·ä»¥åŠç”¨æˆ·ä¸»ç›®å½•</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">userdel -r ç”¨æˆ·å</span><br></pre></td></tr></table></figure><h2 id="æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯æŒ‡ä»¤"><a href="#æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯æŒ‡ä»¤" class="headerlink" title="æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯æŒ‡ä»¤"></a>æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯æŒ‡ä»¤</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">id</span> ç”¨æˆ·å</span><br></pre></td></tr></table></figure><p>ä¸¾ä¾‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@itachi103 home]<span class="comment"># id root</span></span><br><span class="line">uid=0(root) gid=0(root) ç»„=0(root)</span><br><span class="line"></span><br><span class="line">[root@itachi103 home]<span class="comment"># id tom</span></span><br><span class="line">uid=1001(tom) gid=1001(tom) ç»„=1001(tom)</span><br></pre></td></tr></table></figure><h2 id="åˆ‡æ¢ç”¨æˆ·"><a href="#åˆ‡æ¢ç”¨æˆ·" class="headerlink" title="åˆ‡æ¢ç”¨æˆ·"></a>åˆ‡æ¢ç”¨æˆ·</h2><p>åœ¨æ“ä½œLinuxä¸­ï¼Œå¦‚æœå½“å‰ç”¨æˆ·çš„æƒé™ä¸å¤Ÿï¼Œå¯ä»¥é€šè¿‡su - æŒ‡ä»¤ï¼Œåˆ‡æ¢åˆ°é«˜æƒé™ç”¨æˆ·ï¼Œæ¯”å¦‚root</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">su - ç”¨æˆ·å</span><br></pre></td></tr></table></figure><blockquote><ol><li>ä»é«˜æƒé™ç”¨æˆ·åˆ‡æ¢åˆ°ä½æƒé™ç”¨æˆ·ï¼Œä¸éœ€è¦è¾“å…¥å¯†ç ï¼Œåä¹‹éœ€è¦ã€‚</li><li>å½“éœ€è¦è¿”å›åˆ°åŸæ¥ç”¨æˆ·æ—¶ï¼Œä½¿ç”¨ <code>exit</code> æˆ– <code>logout</code> æŒ‡ä»¤</li></ol></blockquote><h2 id="æŸ¥çœ‹å½“å‰ç”¨æˆ·"><a href="#æŸ¥çœ‹å½“å‰ç”¨æˆ·" class="headerlink" title="æŸ¥çœ‹å½“å‰ç”¨æˆ·"></a>æŸ¥çœ‹å½“å‰ç”¨æˆ·</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">whoami</span></span><br></pre></td></tr></table></figure><h2 id="æŸ¥çœ‹ç™»å½•ç”¨ç”¨æˆ·"><a href="#æŸ¥çœ‹ç™»å½•ç”¨ç”¨æˆ·" class="headerlink" title="æŸ¥çœ‹ç™»å½•ç”¨ç”¨æˆ·"></a>æŸ¥çœ‹ç™»å½•ç”¨ç”¨æˆ·</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">who</span> am i</span><br></pre></td></tr></table></figure><blockquote><p><code>whoami</code> æ˜¾ç¤ºçš„æ˜¯å½“å‰ä½¿ç”¨çš„èº«ä»½</p><p>è€Œ <code>who am i</code> æ˜¾ç¤ºçš„æ˜¯æœ€åˆç™»å½•çš„èº«ä»½</p></blockquote><h2 id="ç”¨æˆ·ç»„"><a href="#ç”¨æˆ·ç»„" class="headerlink" title="ç”¨æˆ·ç»„"></a>ç”¨æˆ·ç»„</h2><h3 id="æ–°å¢ç»„"><a href="#æ–°å¢ç»„" class="headerlink" title="æ–°å¢ç»„"></a>æ–°å¢ç»„</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">groupadd ç»„å</span><br></pre></td></tr></table></figure><h3 id="åˆ é™¤ç»„"><a href="#åˆ é™¤ç»„" class="headerlink" title="åˆ é™¤ç»„"></a>åˆ é™¤ç»„</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">groupdel ç»„å</span><br></pre></td></tr></table></figure><h3 id="æ·»åŠ ç”¨æˆ·æ—¶ï¼Œç»™å…¶æŒ‡å®šç»„"><a href="#æ·»åŠ ç”¨æˆ·æ—¶ï¼Œç»™å…¶æŒ‡å®šç»„" class="headerlink" title="æ·»åŠ ç”¨æˆ·æ—¶ï¼Œç»™å…¶æŒ‡å®šç»„"></a>æ·»åŠ ç”¨æˆ·æ—¶ï¼Œç»™å…¶æŒ‡å®šç»„</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">useradd -g ç»„å ç”¨æˆ·å</span><br></pre></td></tr></table></figure><blockquote><p>ä¸¾ä¾‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@itachi103 home]<span class="comment"># groupadd wudang</span></span><br><span class="line">[root@itachi103 home]<span class="comment"># useradd -g wudang zhangwuji</span></span><br><span class="line">[root@itachi103 home]<span class="comment"># id zhangwuji</span></span><br><span class="line">uid=1002(zhangwuji) gid=1002(wudang) ç»„=1002(wudang)</span><br></pre></td></tr></table></figure></blockquote><h3 id="æ·»åŠ ç”¨æˆ·æ—¶ï¼ŒæœªæŒ‡å®šæŒ‡å®šç»„"><a href="#æ·»åŠ ç”¨æˆ·æ—¶ï¼ŒæœªæŒ‡å®šæŒ‡å®šç»„" class="headerlink" title="æ·»åŠ ç”¨æˆ·æ—¶ï¼ŒæœªæŒ‡å®šæŒ‡å®šç»„"></a>æ·»åŠ ç”¨æˆ·æ—¶ï¼ŒæœªæŒ‡å®šæŒ‡å®šç»„</h3><p>æ·»åŠ ç”¨æˆ·æ—¶ï¼ŒæœªæŒ‡å®šæŒ‡å®šç»„ï¼Œåˆ™é»˜è®¤ä¼šåˆ›å»ºä¸€ä¸ªè·Ÿç”¨æˆ·åç›¸åŒçš„ç»„ï¼Œå¹¶ä¸”æŠŠè¯¥ç”¨æˆ·æ”¾åœ¨è¯¥ç»„ä¸­ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@itachi103 home]<span class="comment"># useradd leesin</span></span><br><span class="line">[root@itachi103 home]<span class="comment"># id leesin</span></span><br><span class="line">uid=1003(leesin) gid=1003(leesin) ç»„=1003(leesin)</span><br></pre></td></tr></table></figure><h2 id="ä¿®æ”¹ç”¨æˆ·çš„ç»„"><a href="#ä¿®æ”¹ç”¨æˆ·çš„ç»„" class="headerlink" title="ä¿®æ”¹ç”¨æˆ·çš„ç»„"></a>ä¿®æ”¹ç”¨æˆ·çš„ç»„</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">usermod -g ç»„å ç”¨æˆ·å</span><br></pre></td></tr></table></figure><p>ä¸¾ä¾‹ï¼šå°†zhangwujiä¿®æ”¹ç»„ä¸ºmojiao</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@itachi103 home]<span class="comment"># id zhangwuji</span></span><br><span class="line">uid=1002(zhangwuji) gid=1002(wudang) ç»„=1002(wudang)</span><br><span class="line">[root@itachi103 home]<span class="comment"># groupadd mojiao</span></span><br><span class="line">[root@itachi103 home]<span class="comment"># usermod -g mojiao zhangwuji </span></span><br><span class="line">[root@itachi103 home]<span class="comment"># id zhangwuji</span></span><br><span class="line">uid=1002(zhangwuji) gid=1003(mojiao) ç»„=1003(mojiao)</span><br></pre></td></tr></table></figure><h2 id="ç”¨æˆ·å’Œç»„çš„ç›¸å…³æ–‡ä»¶"><a href="#ç”¨æˆ·å’Œç»„çš„ç›¸å…³æ–‡ä»¶" class="headerlink" title="ç”¨æˆ·å’Œç»„çš„ç›¸å…³æ–‡ä»¶"></a>ç”¨æˆ·å’Œç»„çš„ç›¸å…³æ–‡ä»¶</h2><ul><li><code>/etc/passwd</code> æ–‡ä»¶</li></ul><p>ç”¨æˆ·çš„é…ç½®æ–‡ä»¶ï¼Œè®°å½•ç”¨æˆ·çš„å„ç§ä¿¡æ¯</p><ul><li><code>/etc/shadow</code> æ–‡ä»¶</li></ul><p>å£ä»¤çš„é…ç½®æ–‡ä»¶ï¼Œè®°å½•äº†ç”¨æˆ·åŠ å¯†è¿‡åçš„å¯†ç </p><ul><li><code>/etc/group</code> æ–‡ä»¶</li></ul><p>ç»„çš„é…ç½®æ–‡ä»¶ï¼Œè®°å½•LinuxåŒ…å«çš„ç»„çš„ä¿¡æ¯</p><h1 id="å®ç”¨æŒ‡ä»¤"><a href="#å®ç”¨æŒ‡ä»¤" class="headerlink" title="å®ç”¨æŒ‡ä»¤"></a>å®ç”¨æŒ‡ä»¤</h1><h2 id="è¿è¡Œçº§åˆ«"><a href="#è¿è¡Œçº§åˆ«" class="headerlink" title="è¿è¡Œçº§åˆ«"></a>è¿è¡Œçº§åˆ«</h2><blockquote><p>0ï¼šå…³æœº</p><p>1ï¼šå•ç”¨æˆ·ã€æ‰¾å›ä¸¢å¤±å¯†ç ã€‘</p><p>2ï¼šå¤šç”¨æˆ·çŠ¶æ€æ²¡æœ‰ç½‘ç»œæœåŠ¡</p><p>3ï¼šå¤šç”¨æˆ·çŠ¶æ€æœ‰ç½‘ç»œæœåŠ¡ï¼Œæ— ç•Œé¢</p><p>4ï¼šç³»ç»Ÿæœªä½¿ç”¨ï¼Œä¿ç•™</p><p>5ï¼šå›¾å½¢ç•Œé¢</p><p>6ï¼šç³»ç»Ÿé‡å¯</p><p>å¸¸ç”¨çš„è¿è¡Œçº§åˆ«æ˜¯3å’Œ5ï¼Œä¹Ÿå¯ä»¥æŒ‡å®šé»˜è®¤è¿è¡Œçº§åˆ«</p></blockquote><h3 id="åˆ‡æ¢è¿è¡Œçº§åˆ«"><a href="#åˆ‡æ¢è¿è¡Œçº§åˆ«" class="headerlink" title="åˆ‡æ¢è¿è¡Œçº§åˆ«"></a>åˆ‡æ¢è¿è¡Œçº§åˆ«</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">init [0/1/2/3/4/5/6]</span><br></pre></td></tr></table></figure><h3 id="æŸ¥çœ‹é»˜è®¤è¿è¡Œçº§åˆ«"><a href="#æŸ¥çœ‹é»˜è®¤è¿è¡Œçº§åˆ«" class="headerlink" title="æŸ¥çœ‹é»˜è®¤è¿è¡Œçº§åˆ«"></a>æŸ¥çœ‹é»˜è®¤è¿è¡Œçº§åˆ«</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl get-default </span><br></pre></td></tr></table></figure><p>ä¸¾ä¾‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@itachi103 ~]<span class="comment"># systemctl get-default </span></span><br><span class="line">graphical.target</span><br></pre></td></tr></table></figure><h3 id="ä¿®æ”¹é»˜è®¤è¿è¡Œçº§åˆ«"><a href="#ä¿®æ”¹é»˜è®¤è¿è¡Œçº§åˆ«" class="headerlink" title="ä¿®æ”¹é»˜è®¤è¿è¡Œçº§åˆ«"></a>ä¿®æ”¹é»˜è®¤è¿è¡Œçº§åˆ«</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl set-default TARGET.target</span><br></pre></td></tr></table></figure><blockquote><p>TARGET.targetå¯é€‰</p><ul><li>multi-user.target</li><li>graphical.target</li></ul></blockquote><p>ç¤ºä¾‹ï¼šå°†é»˜è®¤è¿è¡Œçº§åˆ«ä»5æ”¹æˆ3</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@itachi103 ~]<span class="comment"># systemctl get-default </span></span><br><span class="line">graphical.target</span><br><span class="line">[root@itachi103 ~]<span class="comment"># systemctl set-default multi-user.target </span></span><br><span class="line">Removed symlink /etc/systemd/system/default.target.</span><br><span class="line">Created symlink from /etc/systemd/system/default.target to /usr/lib/systemd/system/multi-user.target.</span><br><span class="line">[root@itachi103 ~]<span class="comment"># systemctl get-default </span></span><br><span class="line">multi-user.target</span><br><span class="line">[root@itachi103 ~]<span class="comment"># init 6</span></span><br></pre></td></tr></table></figure><p>é‡å¯ä¹‹åï¼Œå³æ˜¯æ— å›¾å½¢åŒ–ç•Œé¢çš„å¤šç”¨æˆ·çŠ¶æ€æœ‰ç½‘ç»œæœåŠ¡</p><h2 id="å¸®åŠ©æŒ‡ä»¤"><a href="#å¸®åŠ©æŒ‡ä»¤" class="headerlink" title="å¸®åŠ©æŒ‡ä»¤"></a>å¸®åŠ©æŒ‡ä»¤</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">man + æŒ‡ä»¤</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">help</span> + å‘½ä»¤</span><br></pre></td></tr></table></figure><h2 id="gt-å’Œ-gt-gt-æŒ‡ä»¤"><a href="#gt-å’Œ-gt-gt-æŒ‡ä»¤" class="headerlink" title="&gt;å’Œ&gt;&gt;æŒ‡ä»¤"></a>&gt;å’Œ&gt;&gt;æŒ‡ä»¤</h2><p><code>&gt;</code>æ˜¯è¾“å‡ºé‡å®šå‘</p><p><code>&gt;&gt;</code>æ˜¯è¿½åŠ </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> a.txt &gt; b.txt</span><br><span class="line"><span class="comment"># å°†a.txtçš„å†…å®¹è¦†ç›–åˆ°b.txtä¸­</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">cat</span> a.txt &gt;&gt; b.txt</span><br><span class="line"><span class="comment"># å°†a.txtçš„å†…å®¹è¿½åŠ åˆ°b.txtä¸­</span></span><br></pre></td></tr></table></figure><h2 id="lnæŒ‡ä»¤"><a href="#lnæŒ‡ä»¤" class="headerlink" title="lnæŒ‡ä»¤"></a>lnæŒ‡ä»¤</h2><p>è½¯é“¾æ¥ä¹Ÿç§°ä¸ºç¬¦å·é“¾æ¥ï¼Œç±»ä¼¼äºwindowsé‡Œçš„å¿«æ·æ–¹å¼ï¼Œä¸»è¦å­˜æ”¾äº†é“¾æ¥å…¶ä»–æ–‡ä»¶çš„è·¯å¾„</p><p>åŸºæœ¬è¯­æ³•</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">ln</span> -s [åŸæ–‡ä»¶æˆ–ç›®å½•] [è½¯é“¾æ¥å]</span><br></pre></td></tr></table></figure><p>ä¸¾ä¾‹1ï¼šåœ¨/homeç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªè½¯é“¾æ¥myrootï¼Œè¿æ¥åˆ°/rootç›®å½•</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">ln</span> -s /root /home/myroot</span><br></pre></td></tr></table></figure><p>ä¸¾ä¾‹2ï¼šåˆ é™¤è¯¥è½¯é“¾æ¥</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">rm</span> /home/myroot</span><br></pre></td></tr></table></figure><h2 id="historyæŒ‡ä»¤"><a href="#historyæŒ‡ä»¤" class="headerlink" title="historyæŒ‡ä»¤"></a>historyæŒ‡ä»¤</h2><p>æŸ¥çœ‹å·²ç»æ‰§è¡Œè¿‡çš„å†å²å‘½ä»¤</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">history</span></span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹æœ€è¿‘ä½¿ç”¨è¿‡çš„10æ¡å†å²å‘½ä»¤</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">history</span> 10</span><br></pre></td></tr></table></figure><h2 id="æ—¶é—´"><a href="#æ—¶é—´" class="headerlink" title="æ—¶é—´"></a>æ—¶é—´</h2><p>æŸ¥çœ‹æœ¬æœºæ—¶é—´</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">date</span></span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹æ—¥å†</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cal</span><br></pre></td></tr></table></figure><p>è®¾ç½®ç³»ç»Ÿå½“å‰æ—¶é—´</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">date</span> -s <span class="string">&quot;2020-11-11 20:00:00&quot;</span></span><br></pre></td></tr></table></figure><p>æ˜¾ç¤º2020å¹´æ—¥å†</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cal 2020</span><br></pre></td></tr></table></figure><h2 id="æœç´¢ç±»æŒ‡ä»¤"><a href="#æœç´¢ç±»æŒ‡ä»¤" class="headerlink" title="æœç´¢ç±»æŒ‡ä»¤"></a>æœç´¢ç±»æŒ‡ä»¤</h2><h3 id="findæŒ‡ä»¤"><a href="#findæŒ‡ä»¤" class="headerlink" title="findæŒ‡ä»¤"></a>findæŒ‡ä»¤</h3><blockquote><p> findæŒ‡ä»¤å°†ä»æŒ‡å®šç›®å½•å‘ä¸‹é€’å½’åœ°éå†å…¶å„ä¸ªå­ç›®å½•ï¼Œå°†æ»¡è¶³æ¡ä»¶çš„æ–‡ä»¶æˆ–è€…ç›®å½•æ˜¾ç¤ºåœ¨ç»ˆç«¯ã€‚</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find [æœç´¢èŒƒå›´] [é€‰é¡¹]</span><br></pre></td></tr></table></figure><p>é€‰é¡¹è¯´æ˜ï¼š</p><div class="table-container"><table><thead><tr><th>é€‰é¡¹</th><th>åŠŸèƒ½</th><th>ä¸¾ä¾‹</th></tr></thead><tbody><tr><td>-name &lt;æŸ¥è¯¢æ–¹å¼&gt;</td><td>æŒ‰ç…§æŒ‡å®šçš„æ–‡ä»¶åæŸ¥æ‰¾æ¨¡å¼æŸ¥æ‰¾æ–‡ä»¶</td><td><code>find /etc/ -name yum.conf</code></td></tr><tr><td>-user &lt;ç”¨æˆ·å&gt;</td><td>æŸ¥æ‰¾å±äºæŒ‡å®šç”¨æˆ·åçš„æ‰€æœ‰æ–‡ä»¶</td><td><code>find /opt -user root</code></td></tr><tr><td>-size &lt;æ–‡ä»¶å¤§å°&gt;</td><td>æŒ‰ç…§æŒ‡å®šçš„æ–‡ä»¶å¤§å°æŸ¥æ‰¾æ–‡ä»¶</td><td><code>find / -size +100M</code></td></tr></tbody></table></div><h3 id="locateæŒ‡ä»¤"><a href="#locateæŒ‡ä»¤" class="headerlink" title="locateæŒ‡ä»¤"></a>locateæŒ‡ä»¤</h3><blockquote><p>locateæŒ‡ä»¤å¯ä»¥å¿«é€Ÿå®šä½æ–‡ä»¶è·¯å¾„ã€‚locateæŒ‡ä»¤åˆ©ç”¨å®ç°å»ºç«‹çš„ç³»ç»Ÿä¸­æ‰€æœ‰æ–‡ä»¶åç§°åŠè·¯å¾„çš„locateæ•°æ®åº“å®ç°å¿«é€Ÿå®šä½ç»™å®šçš„æ–‡ä»¶ã€‚</p><p>locateæ— éœ€éå†æ•´ä¸ªæ–‡ä»¶ç³»ç»Ÿï¼ŒæŸ¥è¯¢é€Ÿåº¦è¾ƒå¿«ã€‚</p><p>ä¸ºäº†ä¿è¯æŸ¥è¯¢ç»“æœçš„å‡†ç¡®åº¦ï¼Œç®¡ç†å‘˜å¿…é¡»å®šæœŸæ›´æ–°locateæ•°æ®åº“</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">locate [æ–‡ä»¶å]</span><br></pre></td></tr></table></figure><p>ä¸¾ä¾‹ï¼šæœç´¢yum.confæ‰€åœ¨è·¯å¾„</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç”±äºlocateæŒ‡ä»¤åŸºäºæ•°æ®åº“è¿›è¡ŒæŸ¥è¯¢ï¼Œæ‰€ä»¥ç¬¬ä¸€æ¬¡è¿è¡Œå‰ï¼Œå¿…é¡»ä½¿ç”¨updatedbæŒ‡ä»¤åˆ›å»ºlocateæ•°æ®åº“</span></span><br><span class="line">[root@itachi103 etc]<span class="comment"># updatedb</span></span><br><span class="line"></span><br><span class="line">[root@itachi103 etc]<span class="comment"># locate yum.conf</span></span><br><span class="line">/etc/yum.conf</span><br><span class="line">/usr/share/man/man5/yum.conf.5</span><br></pre></td></tr></table></figure><h3 id="whichæŒ‡ä»¤"><a href="#whichæŒ‡ä»¤" class="headerlink" title="whichæŒ‡ä»¤"></a>whichæŒ‡ä»¤</h3><blockquote><p>å¯ä»¥æŸ¥çœ‹æŸä¸ªæŒ‡ä»¤åœ¨å“ªä¸ªç›®å½•ä¸‹</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">which</span> [æŒ‡ä»¤]</span><br></pre></td></tr></table></figure><p>ä¸¾ä¾‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@itachi103 etc]<span class="comment"># which ls</span></span><br><span class="line"><span class="built_in">alias</span> <span class="built_in">ls</span>=<span class="string">&#x27;ls --color=auto&#x27;</span></span><br><span class="line">/usr/bin/ls</span><br><span class="line"></span><br><span class="line">[root@itachi103 etc]<span class="comment"># which reboot</span></span><br><span class="line">/usr/sbin/reboot</span><br></pre></td></tr></table></figure><h3 id="grepæŒ‡ä»¤å’Œç®¡é“ç¬¦å·"><a href="#grepæŒ‡ä»¤å’Œç®¡é“ç¬¦å·" class="headerlink" title="grepæŒ‡ä»¤å’Œç®¡é“ç¬¦å·|"></a>grepæŒ‡ä»¤å’Œç®¡é“ç¬¦å·<code>|</code></h3><p>è¡¨ç¤ºå°†å‰ä¸€ä¸ªå‘½ä»¤çš„å¤„ç†ç»“æœè¾“å‡ºä¼ é€’ç»™åé¢çš„å‘½ä»¤å¤„ç†ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep [é€‰é¡¹] æŸ¥æ‰¾å†…å®¹ æºæ–‡ä»¶</span><br></pre></td></tr></table></figure><p>å¸¸ç”¨é€‰é¡¹</p><div class="table-container"><table><thead><tr><th style="text-align:center">é€‰é¡¹</th><th style="text-align:center">åŠŸèƒ½</th></tr></thead><tbody><tr><td style="text-align:center">-n</td><td style="text-align:center">æ˜¾ç¤ºåŒ¹é…è¡ŒåŠè¡Œå·</td></tr><tr><td style="text-align:center">-i</td><td style="text-align:center">å¿½ç•¥å­—æ¯å¤§å°å†™</td></tr></tbody></table></div><p>ä¸¾ä¾‹ï¼šè¯·åœ¨/home/hello.txtæ–‡ä»¶ä¸­ï¼ŒæŸ¥æ‰¾â€yesâ€æ‰€åœ¨è¡Œï¼Œå¹¶ä¸”æ˜¾ç¤ºè¡Œå·</p><p>æœ‰ä¸¤ç§æ–¹å¼</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@itachi103 etc]<span class="comment"># cat /home/hello.txt </span></span><br><span class="line">hello</span><br><span class="line"><span class="built_in">yes</span></span><br><span class="line">asd</span><br><span class="line">Yes</span><br><span class="line">ddd</span><br><span class="line"><span class="built_in">yes</span></span><br><span class="line">jack</span><br><span class="line">[root@itachi103 etc]<span class="comment"># grep -n &quot;yes&quot; /home/hello.txt </span></span><br><span class="line">2:<span class="built_in">yes</span></span><br><span class="line">6:<span class="built_in">yes</span></span><br><span class="line">[root@itachi103 etc]<span class="comment"># cat /home/hello.txt | grep -n &quot;yes&quot;</span></span><br><span class="line">2:<span class="built_in">yes</span></span><br><span class="line">6:<span class="built_in">yes</span></span><br></pre></td></tr></table></figure><h2 id="å‹ç¼©è§£å‹"><a href="#å‹ç¼©è§£å‹" class="headerlink" title="å‹ç¼©è§£å‹"></a>å‹ç¼©è§£å‹</h2><h3 id="gzip-gunzip-å‹ç¼©-è§£å‹ç¼©"><a href="#gzip-gunzip-å‹ç¼©-è§£å‹ç¼©" class="headerlink" title="gzip/gunzip  å‹ç¼©/è§£å‹ç¼©"></a>gzip/gunzip  å‹ç¼©/è§£å‹ç¼©</h3><h3 id="zip-unzip"><a href="#zip-unzip" class="headerlink" title="zip/unzip"></a>zip/unzip</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">zip [é€‰é¡¹] XXX.zip å°†è¦å‹ç¼©çš„å†…å®¹</span><br><span class="line">unzip [é€‰é¡¹] xxx.zip</span><br></pre></td></tr></table></figure><blockquote><p>zipå¸¸ç”¨é€‰é¡¹ï¼š<code>-r</code> é€’å½’å‹ç¼©ï¼Œå³å‹ç¼©ç›®å½•</p><p>unzipå¸¸ç”¨é€‰é¡¹ï¼š <code>-d &lt;ç›®å½•&gt;</code>     æŒ‡å®šè§£å‹åæ–‡ä»¶çš„å­˜æ”¾ç›®å½•</p></blockquote><p>ä¾‹å¦‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ¡ˆä¾‹1ï¼šå°†/homeä¸‹çš„æ‰€æœ‰æ–‡ä»¶å‹ç¼©æˆmyhome.zip</span></span><br><span class="line">zip -r myhome.zip /home/</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ¡ˆä¾‹2ï¼šå°†myhome.zipè§£å‹åˆ°/opt/tmpç›®å½•ä¸‹</span></span><br><span class="line"><span class="built_in">mkdir</span> /opt/tmp</span><br><span class="line">unzip -d /opt/tmp /home/myhome.zip</span><br></pre></td></tr></table></figure><h3 id="taræŒ‡ä»¤"><a href="#taræŒ‡ä»¤" class="headerlink" title="taræŒ‡ä»¤"></a>taræŒ‡ä»¤</h3><p>taræŒ‡ä»¤æ˜¯æ‰“åŒ…æŒ‡ä»¤ï¼Œæœ€åæ‰“åŒ…åçš„æ–‡ä»¶æ˜¯ <code>.tar.gz</code> çš„æ–‡ä»¶ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar [é€‰é¡¹] XXX.tar.gz æ‰“åŒ…å†…å®¹</span><br></pre></td></tr></table></figure><p>é€‰é¡¹è¯´æ˜</p><div class="table-container"><table><thead><tr><th>é€‰é¡¹</th><th>åŠŸèƒ½</th></tr></thead><tbody><tr><td>-c</td><td>äº§ç”Ÿ.taræ‰“åŒ…æ–‡ä»¶</td></tr><tr><td>-v</td><td>æ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯</td></tr><tr><td>-f</td><td>æŒ‡å®šå‹ç¼©åçš„æ–‡ä»¶å</td></tr><tr><td>-z</td><td>æ‰“åŒ…åŒæ—¶å‹ç¼©</td></tr><tr><td>-x</td><td>è§£åŒ….taræ–‡ä»¶</td></tr></tbody></table></div><p>ä¸¾ä¾‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ¡ˆä¾‹1ï¼šå‹ç¼©å¤šä¸ªæ–‡ä»¶ï¼Œå°†/home/pig.txtå’Œ/home/cat.txtå‹ç¼©æˆpc.tar.gz</span></span><br><span class="line"><span class="built_in">cd</span> /home</span><br><span class="line"><span class="built_in">touch</span> pig.txt</span><br><span class="line"><span class="built_in">touch</span> cat.txt</span><br><span class="line">tar -zcvf pc.tar.gz /home/pig.txt /home/cat.txt</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ¡ˆä¾‹2ï¼šåˆ é™¤/home/çš„pig.txtå’Œcat.txtï¼Œå°†pc.tar.gzè§£å‹åˆ°å½“å‰ç›®å½•</span></span><br><span class="line"><span class="built_in">rm</span> -f pig.txt cat.txt </span><br><span class="line">tar -zxvf pc.tar.gz</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ¡ˆä¾‹3ï¼šå°†/homeçš„æ–‡ä»¶å¤¹å‹ç¼©æˆmyhome.tar.gz</span></span><br><span class="line">tar -zcvf myhome.tar.gz /home/</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ¡ˆä¾‹4ï¼šå°†myhome.tar.gzè§£å‹åˆ°/opt/tmp2ç›®å½•ä¸‹</span></span><br><span class="line"><span class="built_in">mkdir</span> /opt/tmp2</span><br><span class="line">tar -zxvf /home/myhome.tar.gz -C /opt/tmp2</span><br></pre></td></tr></table></figure><h1 id="æƒé™ç®¡ç†"><a href="#æƒé™ç®¡ç†" class="headerlink" title="æƒé™ç®¡ç†"></a>æƒé™ç®¡ç†</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ls -lä¸­æ˜¾ç¤ºçš„å†…å®¹å¦‚ä¸‹ï¼š</span></span><br><span class="line">-rwxrw-r-- 1 root root 1213 Feb 2 09:39 abc</span><br></pre></td></tr></table></figure><p>0-9ä½è¯´æ˜ï¼š</p><ul><li><p>ç¬¬0ä½ç¡®å®šæ–‡ä»¶ç±»å‹ï¼ˆd, -, l, c, bï¼‰</p><ul><li><p>-æ˜¯æ™®é€šæ–‡ä»¶</p></li><li><p>læ˜¯é“¾æ¥</p></li><li><p>dæ˜¯ç›®å½•æ–‡ä»¶</p></li><li><p>cæ˜¯å­—ç¬¦è®¾å¤‡æ–‡ä»¶ï¼Œå¦‚é¼ æ ‡é”®ç›˜</p></li><li><p>bæ˜¯å—è®¾å¤‡ï¼Œå¦‚ç¡¬ç›˜</p></li></ul></li><li><p>1-3ä½ç¡®å®šæ‰€æœ‰è€…çš„æƒé™</p></li><li><p>4-6ä½ç¡®å®šæ‰€å±ç»„çš„æƒé™</p></li><li><p>7-9ä½ç¡®å®šå…¶ä»–ç”¨æˆ·æƒé™</p></li></ul><h3 id="chmodæŒ‡ä»¤"><a href="#chmodæŒ‡ä»¤" class="headerlink" title="chmodæŒ‡ä»¤"></a>chmodæŒ‡ä»¤</h3><h4 id="ç¬¬ä¸€ç§æ–¹å¼"><a href="#ç¬¬ä¸€ç§æ–¹å¼" class="headerlink" title="ç¬¬ä¸€ç§æ–¹å¼"></a>ç¬¬ä¸€ç§æ–¹å¼</h4><p>u:æ‰€æœ‰è€…  g:æ‰€æœ‰ç»„  oï¼šå…¶ä»–äºº  a:æ‰€æœ‰äºº</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chmod</span> u=rwx,g=rx,o=x [æ–‡ä»¶/ç›®å½•å]</span><br><span class="line"><span class="built_in">chmod</span> o+w [æ–‡ä»¶/ç›®å½•å]</span><br><span class="line"><span class="built_in">chmod</span> a-x [æ–‡ä»¶/ç›®å½•å]</span><br></pre></td></tr></table></figure><h4 id="ç¬¬äºŒç§æ–¹å¼"><a href="#ç¬¬äºŒç§æ–¹å¼" class="headerlink" title="ç¬¬äºŒç§æ–¹å¼"></a>ç¬¬äºŒç§æ–¹å¼</h4><p>r=4 w=2 x=1  rwx=4+2+1=7</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chmod</span> u=rwx,g=rx,o=x [æ–‡ä»¶/ç›®å½•å]</span><br><span class="line"><span class="built_in">chmod</span> 751 [æ–‡ä»¶/ç›®å½•å]</span><br></pre></td></tr></table></figure><h4 id="æ”¹å˜æ–‡ä»¶æ‰€æœ‰è€…"><a href="#æ”¹å˜æ–‡ä»¶æ‰€æœ‰è€…" class="headerlink" title="æ”¹å˜æ–‡ä»¶æ‰€æœ‰è€…"></a>æ”¹å˜æ–‡ä»¶æ‰€æœ‰è€…</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chown</span> [æ–°çš„æ‰€æœ‰è€…] [æ–‡ä»¶/ç›®å½•å]</span><br></pre></td></tr></table></figure><p>ä¸¾ä¾‹ï¼šå°†/home/abc.txtæ–‡ä»¶æ‰€æœ‰è€…ä¿®æ”¹ä¸ºtom</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chown</span> tom /home/abc.txt</span><br></pre></td></tr></table></figure><h4 id="æ”¹å˜æ–‡ä»¶æ‰€æœ‰è€…å’Œæ‰€æœ‰ç»„"><a href="#æ”¹å˜æ–‡ä»¶æ‰€æœ‰è€…å’Œæ‰€æœ‰ç»„" class="headerlink" title="æ”¹å˜æ–‡ä»¶æ‰€æœ‰è€…å’Œæ‰€æœ‰ç»„"></a>æ”¹å˜æ–‡ä»¶æ‰€æœ‰è€…å’Œæ‰€æœ‰ç»„</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chown</span> [æ–°çš„æ‰€æœ‰è€…]:[æ–°çš„ç»„] [æ–‡ä»¶/ç›®å½•å]</span><br></pre></td></tr></table></figure><p>ä¸¾ä¾‹ï¼šå°†/home/testç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶å’Œç›®å½•çš„æ‰€æœ‰è€…éƒ½ä¿®æ”¹æˆtom</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chown</span> -R tom /home/test</span><br></pre></td></tr></table></figure><h3 id="ä¿®æ”¹æ–‡ä»¶æ‰€æœ‰ç»„"><a href="#ä¿®æ”¹æ–‡ä»¶æ‰€æœ‰ç»„" class="headerlink" title="ä¿®æ”¹æ–‡ä»¶æ‰€æœ‰ç»„"></a>ä¿®æ”¹æ–‡ä»¶æ‰€æœ‰ç»„</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chgrp</span> [æ–°ç»„] [æ–‡ä»¶/ç›®å½•å]</span><br></pre></td></tr></table></figure><p>ä¸¾ä¾‹ï¼šå°†/home/testç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶å’Œç›®å½•çš„æ‰€åœ¨ç»„éƒ½ä¿®æ”¹æˆshaolin</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chgrp</span> -R shaolin /home/test</span><br></pre></td></tr></table></figure><h3 id="rwxä½œç”¨åˆ°æ–‡ä»¶"><a href="#rwxä½œç”¨åˆ°æ–‡ä»¶" class="headerlink" title="rwxä½œç”¨åˆ°æ–‡ä»¶"></a>rwxä½œç”¨åˆ°æ–‡ä»¶</h3><ul><li>rï¼šå¯ä»¥è¯»å–ï¼ŒæŸ¥çœ‹</li><li>wï¼šå¯ä»¥ä¿®æ”¹ã€‚ä½†æ˜¯ä¸ä»£è¡¨å¯ä»¥åˆ é™¤è¯¥æ–‡ä»¶ï¼Œåˆ é™¤ä¸€ä¸ªæ–‡ä»¶çš„å‰ææ¡ä»¶æ˜¯å¯¹è¯¥æ–‡ä»¶æ‰€åœ¨çš„ç›®å½•æœ‰å†™æƒé™ã€‚</li><li>xï¼šå¯ä»¥è¢«æ‰§è¡Œ</li></ul><h3 id="rwxä½œç”¨åˆ°ç›®å½•"><a href="#rwxä½œç”¨åˆ°ç›®å½•" class="headerlink" title="rwxä½œç”¨åˆ°ç›®å½•"></a>rwxä½œç”¨åˆ°ç›®å½•</h3><ul><li>rï¼šå¯ä»¥è¯»å–ï¼ŒlsæŸ¥çœ‹ç›®å½•å†…å®¹</li><li>wï¼šå¯ä»¥ä¿®æ”¹ï¼Œ<strong>å¯¹ç›®å½•å†…åˆ›å»º+åˆ é™¤+é‡å‘½å</strong></li><li>xï¼š<strong>å¯ä»¥è¿›å…¥è¯¥ç›®å½•</strong></li></ul><h1 id="å®šæ—¶ä»»åŠ¡è°ƒåº¦"><a href="#å®šæ—¶ä»»åŠ¡è°ƒåº¦" class="headerlink" title="å®šæ—¶ä»»åŠ¡è°ƒåº¦"></a>å®šæ—¶ä»»åŠ¡è°ƒåº¦</h1><h2 id="crontab"><a href="#crontab" class="headerlink" title="crontab"></a>crontab</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">crontab [é€‰é¡¹]</span><br></pre></td></tr></table></figure><div class="table-container"><table><thead><tr><th style="text-align:center">é€‰é¡¹</th><th style="text-align:center">åŠŸèƒ½</th></tr></thead><tbody><tr><td style="text-align:center">-e</td><td style="text-align:center">ç¼–è¾‘crontabå®šæ—¶ä»»åŠ¡</td></tr><tr><td style="text-align:center">-l</td><td style="text-align:center">æŸ¥è¯¢crontabä»»åŠ¡</td></tr><tr><td style="text-align:center">-r</td><td style="text-align:center">åˆ é™¤å½“å‰ç”¨æˆ·æ‰€æœ‰çš„crontabä»»åŠ¡</td></tr></tbody></table></div><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ·»åŠ ä»»åŠ¡</span></span><br><span class="line">crontab -e</span><br><span class="line"><span class="comment"># è¾“å…¥ä»»åŠ¡åˆ°æ–‡ä»¶ä¸­ï¼Œä¿å­˜å¹¶é€€å‡º</span></span><br><span class="line">*/1 * * * * <span class="built_in">ls</span> -l /etc/ &gt; /tmp/to.txt</span><br><span class="line"><span class="comment"># æ„æ€æ˜¯è¯´æ¯åˆ†é’Ÿéƒ½æ‰§è¡Œä¸€æ¬¡ls -l /etc/ &gt; /tmp/to.txtå‘½ä»¤</span></span><br></pre></td></tr></table></figure><h4 id="å‚æ•°ç»†èŠ‚è¯´æ˜"><a href="#å‚æ•°ç»†èŠ‚è¯´æ˜" class="headerlink" title="å‚æ•°ç»†èŠ‚è¯´æ˜"></a>å‚æ•°ç»†èŠ‚è¯´æ˜</h4><h5 id="5ä¸ªå ä½ç¬¦è¯´æ˜"><a href="#5ä¸ªå ä½ç¬¦è¯´æ˜" class="headerlink" title="5ä¸ªå ä½ç¬¦è¯´æ˜"></a>5ä¸ªå ä½ç¬¦è¯´æ˜</h5><div class="table-container"><table><thead><tr><th style="text-align:center">é¡¹ç›®</th><th style="text-align:center">å«ä¹‰</th><th style="text-align:center">èŒƒå›´</th></tr></thead><tbody><tr><td style="text-align:center">ç¬¬ä¸€ä¸ª *</td><td style="text-align:center">ä¸€å°æ—¶å½“ä¸­çš„ç¬¬å‡ åˆ†é’Ÿ</td><td style="text-align:center">0-59</td></tr><tr><td style="text-align:center">ç¬¬äºŒä¸ª *</td><td style="text-align:center">ä¸€å¤©å½“ä¸­çš„ç¬¬å‡ ä¸ªå°æ—¶</td><td style="text-align:center">0-23</td></tr><tr><td style="text-align:center">ç¬¬ä¸‰ä¸ª *</td><td style="text-align:center">ä¸€ä¸ªæœˆå½“ä¸­çš„ç¬¬å‡ å¤©</td><td style="text-align:center">1-31</td></tr><tr><td style="text-align:center">ç¬¬å››ä¸ª *</td><td style="text-align:center">ä¸€å¹´å½“ä¸­çš„ç¬¬å‡ æœˆ</td><td style="text-align:center">1-12</td></tr><tr><td style="text-align:center">ç¬¬äº”ä¸ª *</td><td style="text-align:center">ä¸€å‘¨å½“ä¸­çš„æ˜ŸæœŸå‡ </td><td style="text-align:center">0-7ï¼ˆ0å’Œ7éƒ½è¡¨ç¤ºæ˜ŸæœŸæ—¥ï¼‰</td></tr></tbody></table></div><h5 id="ç‰¹æ®Šç¬¦å·è¯´æ˜"><a href="#ç‰¹æ®Šç¬¦å·è¯´æ˜" class="headerlink" title="ç‰¹æ®Šç¬¦å·è¯´æ˜"></a>ç‰¹æ®Šç¬¦å·è¯´æ˜</h5><div class="table-container"><table><thead><tr><th style="text-align:center">ç‰¹æ®Šç¬¦å·</th><th style="text-align:center">å«ä¹‰</th></tr></thead><tbody><tr><td style="text-align:center">*</td><td style="text-align:center">ä»£è¡¨ä»»ä½•æ—¶é—´ï¼Œæ¯”å¦‚ç¬¬ä¸€ä¸ª*å°±ä»£è¡¨ä¸€å°æ—¶ä¸­æ¯åˆ†é’Ÿéƒ½æ‰§è¡Œä¸€æ¬¡çš„æ„æ€</td></tr><tr><td style="text-align:center">,</td><td style="text-align:center">ä»£è¡¨ä¸è¿ç»­çš„æ—¶é—´ï¼Œæ¯”å¦‚ <code>0 8,12,16 * * *</code> ï¼Œå°±ä»£è¡¨åœ¨æ¯å¤©çš„8ç‚¹0åˆ†ï¼Œ12ç‚¹0åˆ†ï¼Œ16ç‚¹0åˆ†éƒ½æ‰§è¡Œä¸€æ¬¡å‘½ä»¤</td></tr><tr><td style="text-align:center">-</td><td style="text-align:center">ä»£è¡¨è¿ç»­çš„æ—¶é—´èŒƒå›´ï¼Œæ¯”å¦‚ <code>0 5 * * 1-6</code>ï¼Œ ä»£è¡¨å‘¨ä¸€åˆ°å‘¨å…­çš„å‡Œæ™¨5ç‚¹0åˆ†æ‰§è¡Œå‘½ä»¤</td></tr><tr><td style="text-align:center">*/n</td><td style="text-align:center">ä»£è¡¨æ¯éš”å¤šä¹…æ‰§è¡Œä¸€æ¬¡ã€‚æ¯”å¦‚ <code>*/10 * * * *</code> ,ä»£è¡¨æ¯éš”10åˆ†é’Ÿå°±æ‰§è¡Œä¸€éå‘½ä»¤</td></tr></tbody></table></div><h5 id="ç‰¹æ®Šæ—¶é—´æ‰§è¡Œæ¡ˆä¾‹"><a href="#ç‰¹æ®Šæ—¶é—´æ‰§è¡Œæ¡ˆä¾‹" class="headerlink" title="ç‰¹æ®Šæ—¶é—´æ‰§è¡Œæ¡ˆä¾‹"></a>ç‰¹æ®Šæ—¶é—´æ‰§è¡Œæ¡ˆä¾‹</h5><div class="table-container"><table><thead><tr><th style="text-align:center">æ—¶é—´</th><th style="text-align:center">å«ä¹‰</th></tr></thead><tbody><tr><td style="text-align:center">45 22 <em> </em> *</td><td style="text-align:center">åœ¨22ç‚¹45åˆ†æ‰§è¡Œå‘½ä»¤</td></tr><tr><td style="text-align:center">0 17 <em> </em> 1</td><td style="text-align:center">æ¯å‘¨1çš„17ç‚¹0åˆ†æ‰§è¡Œå‘½ä»¤</td></tr><tr><td style="text-align:center">0 5 1,15 <em> </em></td><td style="text-align:center">æ¯æœˆçš„1å·å’Œ15å·çš„å‡Œæ™¨5ç‚¹0åˆ†æ‰§è¡Œå‘½ä»¤</td></tr><tr><td style="text-align:center">40 4 <em> </em> 1-5</td><td style="text-align:center">æ¯å‘¨ä¸€åˆ°å‘¨äº”çš„å‡Œæ™¨4ç‚¹40åˆ†æ‰§è¡Œå‘½ä»¤</td></tr><tr><td style="text-align:center"><em>/10 4 </em> <em> </em></td><td style="text-align:center">æ¯å¤©çš„å‡Œæ™¨4ç‚¹ï¼Œæ¯éš”10åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡å‘½ä»¤</td></tr><tr><td style="text-align:center">0 0 1,15 * 1</td><td style="text-align:center">æ¯æœˆ1å·å’Œ15å·ï¼Œæ¯å‘¨ä¸€çš„0ç‚¹0åˆ†éƒ½ä¼šæ‰§è¡Œå‘½ä»¤ã€‚</td></tr></tbody></table></div><blockquote><p>æ³¨æ„ï¼šæ˜ŸæœŸå‡ å’Œå‡ å·ï¼Œæœ€å¥½ä¸è¦åŒæ—¶å‡ºç°ï¼Œå› ä¸ºä»–ä»¬çš„å®šä¹‰éƒ½æ˜¯å¤©ï¼Œéå¸¸å®¹æ˜“è®©ç®¡ç†å‘˜æ··ä¹±ã€‚</p></blockquote><h2 id="at"><a href="#at" class="headerlink" title="at"></a>at</h2><h3 id="åŸºæœ¬ä»‹ç»"><a href="#åŸºæœ¬ä»‹ç»" class="headerlink" title="åŸºæœ¬ä»‹ç»"></a>åŸºæœ¬ä»‹ç»</h3><ul><li>atå‘½ä»¤æ˜¯ä¸€æ¬¡æ€§å®šæ—¶è®¡åˆ’ä»»åŠ¡ï¼Œatçš„å®ˆæŠ¤è¿›ç¨‹atdä¼šä»¥åå°æ¨¡å¼è¿è¡Œï¼Œæ£€æŸ¥ä½œä¸šé˜Ÿåˆ—æ¥è¿è¡Œã€‚</li><li>é»˜è®¤æƒ…å†µä¸‹ï¼Œatdå®ˆæŠ¤è¿›ç¨‹æ¯60ç§’æ£€æŸ¥ä½œä¸šé˜Ÿåˆ—ï¼Œæœ‰ä½œä¸šæ—¶ï¼Œä¼šæ£€æŸ¥ä½œä¸šè¿è¡Œæ—¶é—´ï¼Œå¦‚æœæ—¶é—´ä¸å½“å‰æ—¶é—´åŒ¹é…ï¼Œåˆ™è¿è¡Œæ­¤ä½œä¸šã€‚</li><li>atæ‰§è¡Œå®Œä¸€ä¸ªä»»åŠ¡åå°±ä¸å†æ‰§è¡Œæ­¤ä»»åŠ¡äº†ã€‚</li><li>åœ¨ä½¿ç”¨atå‘½ä»¤ä¹‹å‰ï¼Œä¸€å®šè¦ç¡®ä¿atdè¿›ç¨‹çš„å¯åŠ¨ï¼Œå¯ä»¥ä½¿ç”¨<code>ps -ef | grep atd</code> æ¥æ£€æµ‹atdæ˜¯å¦åœ¨è¿è¡Œã€‚</li></ul><h3 id="å‘½ä»¤æ ¼å¼"><a href="#å‘½ä»¤æ ¼å¼" class="headerlink" title="å‘½ä»¤æ ¼å¼"></a>å‘½ä»¤æ ¼å¼</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">at [é€‰é¡¹] [æ—¶é—´]</span><br><span class="line">ctrl + D ç»“æŸatå‘½ä»¤çš„è¾“å…¥ï¼ŒæŒ‰ä¸¤æ¬¡</span><br></pre></td></tr></table></figure><h4 id="atå‘½ä»¤é€‰é¡¹"><a href="#atå‘½ä»¤é€‰é¡¹" class="headerlink" title="atå‘½ä»¤é€‰é¡¹"></a>atå‘½ä»¤é€‰é¡¹</h4><div class="table-container"><table><thead><tr><th style="text-align:center">é€‰é¡¹</th><th style="text-align:center">å«ä¹‰</th></tr></thead><tbody><tr><td style="text-align:center">-m</td><td style="text-align:center">å½“æŒ‡å®šçš„ä»»åŠ¡è¢«å®Œæˆåï¼Œå°†ç»™ç”¨æˆ·å‘é‚®ä»¶ï¼Œå³ä½¿æ²¡æœ‰æ ‡å‡†è¾“å‡º</td></tr><tr><td style="text-align:center">-I</td><td style="text-align:center">atqçš„åˆ«å</td></tr><tr><td style="text-align:center">-d</td><td style="text-align:center">atrmçš„åˆ«å</td></tr><tr><td style="text-align:center">-v</td><td style="text-align:center">æ˜¾ç¤ºä»»åŠ¡å°†è¢«æ‰§è¡Œçš„æ—¶é—´</td></tr><tr><td style="text-align:center">-c</td><td style="text-align:center">æ‰“å°ä»»åŠ¡çš„å†…å®¹åˆ°è¾“å‡º</td></tr><tr><td style="text-align:center">-V</td><td style="text-align:center">æ˜¾ç¤ºç‰ˆæœ¬ä¿¡æ¯</td></tr><tr><td style="text-align:center">-q &lt;é˜Ÿåˆ—&gt;</td><td style="text-align:center">ä½¿ç”¨æŒ‡å®šçš„é˜Ÿåˆ—</td></tr><tr><td style="text-align:center">-f &lt;æ–‡ä»¶&gt;</td><td style="text-align:center">ä»æŒ‡å®šæ–‡ä»¶è¯»å…¥ä»»åŠ¡è€Œä¸æ˜¯ä»æ ‡å‡†è¾“å…¥è¯»å…¥</td></tr><tr><td style="text-align:center">-t &lt;æ—¶é—´å‚æ•°&gt;</td><td style="text-align:center">ä»¥æ—¶é—´å‚æ•°çš„å½¢å¼æäº¤è¦è¿è¡Œçš„ä»»åŠ¡</td></tr></tbody></table></div><h4 id="atæ—¶é—´å®šä¹‰"><a href="#atæ—¶é—´å®šä¹‰" class="headerlink" title="atæ—¶é—´å®šä¹‰"></a>atæ—¶é—´å®šä¹‰</h4><ol><li>æ¥å—åœ¨å½“å¤©çš„ hh:mm(å°æ—¶:åˆ†é’Ÿ)å¼çš„æ—¶é—´æŒ‡å®šã€‚å‡å¦‚è¯¥æ—¶é—´å·²è¿‡å»ï¼Œé‚£ä¹ˆå°±æ”¾åœ¨ç¬¬äºŒå¤©æ‰§è¡Œã€‚ ä¾‹å¦‚:04:00</li><li>ä½¿ç”¨ midmight (æ·±å¤œ)ï¼Œnon (ä¸­åˆ)ï¼Œteatime (é¥®èŒ¶æ—¶é—´ï¼Œä¸€èˆ¬æ˜¯ä¸‹åˆ 4 ç‚¹) ç­‰æ¯”è¾ƒæ¨¡ç³Šçš„è¯è¯­æ¥æŒ‡å®šæ—¶é—´.</li><li>é‡‡ç”¨ 12 å°æ—¶è®¡æ—¶åˆ¶ï¼Œå³åœ¨æ—¶é—´åé¢åŠ ä¸Š AM (ä¸Šåˆ)æˆ–PM (ä¸‹åˆï¼‰æ¥è¯´æ˜æ˜¯ä¸Šåˆè¿˜æ˜¯ä¸‹åˆã€‚ ä¾‹å¦‚: 12pmã€‚</li><li>æŒ‡å®šå‘½ä»¤æ‰§è¡Œçš„å…·ä½“æ—¥æœŸï¼ŒæŒ‡å®šæ ¼å¼ä¸º month day (æœˆ æ—¥)æˆ–mm/dd/yy (/æ—¥/å¹´)æˆ– dd.mm.yy (æ—¥.æœˆ.å¹´)ï¼ŒæŒ‡å®šçš„æ—¥æœŸå¿…é¡»è·Ÿåœ¨æŒ‡å®šæ—¶é—´çš„åé¢ã€‚ ä¾‹å¦‚:04:00 2021-03-1</li><li>ä½¿ç”¨ç›¸å¯¹è®¡æ—¶æ³•ã€‚æŒ‡å®šæ ¼å¼ä¸º:now +count time-units ,now å°±æ˜¯å½“å‰æ—¶é—´,tme-units æ˜¯æ—¶é—´å•ä½,è¿™é‡Œèƒ½å¤Ÿæ˜¯ minutes(åˆ†é’Ÿ)ã€hours (å°æ—¶)ã€days (å¤©)ã€weeks (æ˜ŸæœŸ)ã€‚count æ˜¯æ—¶é—´çš„æ•°é‡ï¼Œå‡ å¤©ï¼Œå‡ å°æ—¶ã€‚ ä¾‹å¦‚: now +5 minutes</li><li>ç›´æ¥ä½¿ç”¨ today (ä»Šå¤©)ã€tomorrow (æ˜å¤©) æ¥æŒ‡å®šå®Œæˆå‘½ä»¤çš„æ—¶é—´ã€‚</li></ol><h3 id="æ¡ˆä¾‹"><a href="#æ¡ˆä¾‹" class="headerlink" title="æ¡ˆä¾‹"></a>æ¡ˆä¾‹</h3><p>2å¤©åçš„ä¸‹åˆ5ç‚¹æ‰§è¡Œ /bin/ls /home</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@itachi103 tmp]<span class="comment"># at 5pm + 2 days</span></span><br><span class="line">at&gt; /bin/ls /home&lt;EOT&gt;</span><br><span class="line">job 1 at Mon Feb 27 17:00:00 2023</span><br></pre></td></tr></table></figure><p>atqå‘½ä»¤æŸ¥çœ‹ç³»ç»Ÿä¸­æ²¡æœ‰æ‰§è¡Œçš„å·¥ä½œä»»åŠ¡</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@itachi103 tmp]<span class="comment"># atq</span></span><br><span class="line">1Mon Feb 27 17:00:00 2023 a root</span><br></pre></td></tr></table></figure><h1 id="ç£ç›˜ç®¡ç†"><a href="#ç£ç›˜ç®¡ç†" class="headerlink" title="ç£ç›˜ç®¡ç†"></a>ç£ç›˜ç®¡ç†</h1><h2 id="ç£ç›˜åˆ†åŒºã€æŒ‚è½½"><a href="#ç£ç›˜åˆ†åŒºã€æŒ‚è½½" class="headerlink" title="ç£ç›˜åˆ†åŒºã€æŒ‚è½½"></a>ç£ç›˜åˆ†åŒºã€æŒ‚è½½</h2><p>ä»¥å¢åŠ ä¸€å—ç¡¬ç›˜ä¸ºä¾‹æ¥ç†Ÿæ‚‰ä¸‹ç£ç›˜çš„ç›¸å…³æŒ‡ä»¤å’Œæ·±å…¥ç†è§£ç£ç›˜åˆ†åŒºã€æŒ‚è½½ã€å¸è½½çš„æ¦‚å¿µã€‚</p><h4 id="1-è™šæ‹Ÿæœºæ·»åŠ ç¡¬ç›˜"><a href="#1-è™šæ‹Ÿæœºæ·»åŠ ç¡¬ç›˜" class="headerlink" title="1.è™šæ‹Ÿæœºæ·»åŠ ç¡¬ç›˜"></a>1.è™šæ‹Ÿæœºæ·»åŠ ç¡¬ç›˜</h4><p><img src="http://cdn.leesin.fun/typora/s3/img/è™šæ‹Ÿæœºæ·»åŠ ç¡¬ç›˜.png" alt="è™šæ‹Ÿæœºæ·»åŠ ç¡¬ç›˜"></p><p>ç„¶åé‡å¯æœºå™¨</p><h4 id="2-åˆ†åŒº"><a href="#2-åˆ†åŒº" class="headerlink" title="2.åˆ†åŒº"></a>2.åˆ†åŒº</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">[root@itachi103 dev]<span class="comment"># lsblk</span></span><br><span class="line">NAME            MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT</span><br><span class="line">sda               8:0    0   50G  0 disk </span><br><span class="line">â”œâ”€sda1            8:1    0  953M  0 part /boot</span><br><span class="line">â””â”€sda2            8:2    0   49G  0 part </span><br><span class="line">  â”œâ”€centos-root 253:0    0   45G  0 lvm  /</span><br><span class="line">  â””â”€centos-swap 253:1    0    4G  0 lvm  [SWAP]</span><br><span class="line">sdb               8:16   0    2G  0 disk </span><br><span class="line">sr0              11:0    1  4.4G  0 rom  </span><br><span class="line"></span><br><span class="line">[root@itachi103 dev]<span class="comment"># fdisk /dev/sdb</span></span><br><span class="line">æ¬¢è¿ä½¿ç”¨ fdisk (util-linux 2.23.2)ã€‚</span><br><span class="line"></span><br><span class="line">æ›´æ”¹å°†åœç•™åœ¨å†…å­˜ä¸­ï¼Œç›´åˆ°æ‚¨å†³å®šå°†æ›´æ”¹å†™å…¥ç£ç›˜ã€‚</span><br><span class="line">ä½¿ç”¨å†™å…¥å‘½ä»¤å‰è¯·ä¸‰æ€ã€‚</span><br><span class="line"></span><br><span class="line">Device does not contain a recognized partition table</span><br><span class="line">ä½¿ç”¨ç£ç›˜æ ‡è¯†ç¬¦ 0x7f1e1ee6 åˆ›å»ºæ–°çš„ DOS ç£ç›˜æ ‡ç­¾ã€‚</span><br><span class="line"></span><br><span class="line">å‘½ä»¤(è¾“å…¥ m è·å–å¸®åŠ©)ï¼šm</span><br><span class="line">å‘½ä»¤æ“ä½œ</span><br><span class="line">   a   toggle a bootable flag</span><br><span class="line">   b   edit bsd disklabel</span><br><span class="line">   c   toggle the dos compatibility flag</span><br><span class="line">   d   delete a partition</span><br><span class="line">   g   create a new empty GPT partition table</span><br><span class="line">   G   create an IRIX (SGI) partition table</span><br><span class="line">   l   list known partition types</span><br><span class="line">   m   <span class="built_in">print</span> this menu</span><br><span class="line">   n   add a new partition</span><br><span class="line">   o   create a new empty DOS partition table</span><br><span class="line">   p   <span class="built_in">print</span> the partition table</span><br><span class="line">   q   quit without saving changes</span><br><span class="line">   s   create a new empty Sun disklabel</span><br><span class="line">   t   change a partition<span class="string">&#x27;s system id</span></span><br><span class="line"><span class="string">   u   change display/entry units</span></span><br><span class="line"><span class="string">   v   verify the partition table</span></span><br><span class="line"><span class="string">   w   write table to disk and exit</span></span><br><span class="line"><span class="string">   x   extra functionality (experts only)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">å‘½ä»¤(è¾“å…¥ m è·å–å¸®åŠ©)ï¼šn</span></span><br><span class="line"><span class="string">Partition type:</span></span><br><span class="line"><span class="string">   p   primary (0 primary, 0 extended, 4 free)</span></span><br><span class="line"><span class="string">   e   extended</span></span><br><span class="line"><span class="string">Select (default p): p</span></span><br><span class="line"><span class="string">åˆ†åŒºå· (1-4ï¼Œé»˜è®¤ 1)ï¼š1</span></span><br><span class="line"><span class="string">èµ·å§‹ æ‰‡åŒº (2048-4194303ï¼Œé»˜è®¤ä¸º 2048)ï¼š</span></span><br><span class="line"><span class="string">å°†ä½¿ç”¨é»˜è®¤å€¼ 2048</span></span><br><span class="line"><span class="string">Last æ‰‡åŒº, +æ‰‡åŒº or +size&#123;K,M,G&#125; (2048-4194303ï¼Œé»˜è®¤ä¸º 4194303)ï¼š</span></span><br><span class="line"><span class="string">å°†ä½¿ç”¨é»˜è®¤å€¼ 4194303</span></span><br><span class="line"><span class="string">åˆ†åŒº 1 å·²è®¾ç½®ä¸º Linux ç±»å‹ï¼Œå¤§å°è®¾ä¸º 2 GiB</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">å‘½ä»¤(è¾“å…¥ m è·å–å¸®åŠ©)ï¼šw</span></span><br><span class="line"><span class="string">The partition table has been altered!</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Calling ioctl() to re-read partition table.</span></span><br><span class="line"><span class="string">æ­£åœ¨åŒæ­¥ç£ç›˜ã€‚</span></span><br><span class="line"><span class="string"></span></span><br></pre></td></tr></table></figure><h4 id="3-æ ¼å¼åŒ–ç£ç›˜"><a href="#3-æ ¼å¼åŒ–ç£ç›˜" class="headerlink" title="3.æ ¼å¼åŒ–ç£ç›˜"></a>3.æ ¼å¼åŒ–ç£ç›˜</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkfs -t ext4 /dev/sdb1 </span><br></pre></td></tr></table></figure><h4 id="4-æŒ‚è½½"><a href="#4-æŒ‚è½½" class="headerlink" title="4.æŒ‚è½½"></a>4.æŒ‚è½½</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mount [è®¾å¤‡åç§°] [æŒ‚è½½ç›®å½•]</span><br><span class="line">umount [è®¾å¤‡åç§°]</span><br><span class="line">umount [æŒ‚è½½ç›®å½•]</span><br></pre></td></tr></table></figure><p>å¦‚1ï¼šæŠŠåˆ†åŒºsdb1æŒ‚è½½åˆ°/newdiskä¸Š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@itachi103 /]<span class="comment"># mount /dev/sdb1 /newdisk/</span></span><br><span class="line">[root@itachi103 /]<span class="comment"># lsblk -f</span></span><br><span class="line">NAME            FSTYPE      LABEL           UUID                                   MOUNTPOINT</span><br><span class="line">sdb                                                                                </span><br><span class="line">â””â”€sdb1          ext4                        2ce25320-09e8-4ce5-bb9e-b55b0c313d3f   /newdisk</span><br></pre></td></tr></table></figure><blockquote><p>å¦‚æœåˆ°æ­¤æ­¥ï¼Œç”¨å‘½ä»¤è¡ŒæŒ‚è½½ï¼Œé‡å¯åä¼šå¤±æ•ˆ</p></blockquote><p>å¦‚2ï¼šæŠŠåˆ†åŒºsdb1å–æ¶ˆæŒ‚è½½</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@itachi103 /]<span class="comment"># umount /dev/sdb1</span></span><br><span class="line"></span><br><span class="line">[root@itachi103 /]<span class="comment"># lsblk -f</span></span><br><span class="line">NAME            FSTYPE      LABEL           UUID                                   MOUNTPOINT</span><br><span class="line">sdb                                                                                </span><br><span class="line">â””â”€sdb1          ext4                        2ce25320-09e8-4ce5-bb9e-b55b0c313d3f   </span><br></pre></td></tr></table></figure><h4 id="5-æ°¸ä¹…æŒ‚è½½"><a href="#5-æ°¸ä¹…æŒ‚è½½" class="headerlink" title="5.æ°¸ä¹…æŒ‚è½½"></a>5.æ°¸ä¹…æŒ‚è½½</h4><p>ä¿®æ”¹ /etc/fstab å®ç°æŒ‚è½½ï¼Œæ·»åŠ å®Œæˆåæ‰§è¡Œ<code>mount -a</code> å³åˆ»ç”Ÿæ•ˆ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åœ¨ /etc/fstab ä¸­æ·»åŠ å¦‚ä¸‹å†…å®¹</span></span><br><span class="line">/dev/sdb1       /newdisk        ext4    defaults        0 0</span><br></pre></td></tr></table></figure><h2 id="ç£ç›˜æƒ…å†µæŸ¥è¯¢"><a href="#ç£ç›˜æƒ…å†µæŸ¥è¯¢" class="headerlink" title="ç£ç›˜æƒ…å†µæŸ¥è¯¢"></a>ç£ç›˜æƒ…å†µæŸ¥è¯¢</h2><h3 id="æŸ¥è¯¢ç³»ç»Ÿæ•´ä½“ç£ç›˜ä½¿ç”¨æƒ…å†µ"><a href="#æŸ¥è¯¢ç³»ç»Ÿæ•´ä½“ç£ç›˜ä½¿ç”¨æƒ…å†µ" class="headerlink" title="æŸ¥è¯¢ç³»ç»Ÿæ•´ä½“ç£ç›˜ä½¿ç”¨æƒ…å†µ"></a>æŸ¥è¯¢ç³»ç»Ÿæ•´ä½“ç£ç›˜ä½¿ç”¨æƒ…å†µ</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">df</span> -h</span><br></pre></td></tr></table></figure><h3 id="æŸ¥è¯¢æŒ‡å®šç›®å½•ä½¿ç”¨æƒ…å†µ"><a href="#æŸ¥è¯¢æŒ‡å®šç›®å½•ä½¿ç”¨æƒ…å†µ" class="headerlink" title="æŸ¥è¯¢æŒ‡å®šç›®å½•ä½¿ç”¨æƒ…å†µ"></a>æŸ¥è¯¢æŒ‡å®šç›®å½•ä½¿ç”¨æƒ…å†µ</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">du</span> -h</span><br><span class="line"><span class="comment"># é»˜è®¤æŸ¥è¯¢å½“å‰å·¥ä½œç›®å½•</span></span><br></pre></td></tr></table></figure><p>é€‰é¡¹å¦‚ä¸‹ï¼š</p><div class="table-container"><table><thead><tr><th style="text-align:center">é€‰é¡¹</th><th style="text-align:center">åŠŸèƒ½</th></tr></thead><tbody><tr><td style="text-align:center">-s</td><td style="text-align:center">æŒ‡å®šç›®å½•å ç”¨å¤§å°æ±‡æ€»</td></tr><tr><td style="text-align:center">-h</td><td style="text-align:center">å¸¦è®¡é‡å•ä½</td></tr><tr><td style="text-align:center">-a</td><td style="text-align:center">å«æ–‡ä»¶</td></tr><tr><td style="text-align:center">â€”max-depth=1</td><td style="text-align:center">å­ç›®å½•æ·±åº¦</td></tr><tr><td style="text-align:center">-c</td><td style="text-align:center">åˆ—å‡ºæ˜ç»†çš„åŒæ—¶ï¼Œå¢åŠ æ±‡æ€»é‡</td></tr></tbody></table></div><p>ä¸¾ä¾‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@itachi103 home]<span class="comment"># du -hac --max-depth=1 /opt</span></span><br><span class="line">0/opt/rh</span><br><span class="line">0/opt</span><br><span class="line">0æ€»ç”¨é‡</span><br></pre></td></tr></table></figure><h3 id="ç£ç›˜æƒ…å†µ-å·¥ä½œå®ç”¨æŒ‡ä»¤"><a href="#ç£ç›˜æƒ…å†µ-å·¥ä½œå®ç”¨æŒ‡ä»¤" class="headerlink" title="ç£ç›˜æƒ…å†µ-å·¥ä½œå®ç”¨æŒ‡ä»¤"></a>ç£ç›˜æƒ…å†µ-å·¥ä½œå®ç”¨æŒ‡ä»¤</h3><h4 id="1-ç»Ÿè®¡-optæ–‡ä»¶å¤¹ä¸‹æ–‡ä»¶çš„ä¸ªæ•°"><a href="#1-ç»Ÿè®¡-optæ–‡ä»¶å¤¹ä¸‹æ–‡ä»¶çš„ä¸ªæ•°" class="headerlink" title="1.ç»Ÿè®¡/optæ–‡ä»¶å¤¹ä¸‹æ–‡ä»¶çš„ä¸ªæ•°"></a>1.ç»Ÿè®¡/optæ–‡ä»¶å¤¹ä¸‹æ–‡ä»¶çš„ä¸ªæ•°</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">ls</span> -l /home/ | grep <span class="string">&quot;^-&quot;</span> | <span class="built_in">wc</span>  -l</span><br></pre></td></tr></table></figure><h4 id="2-ç»Ÿè®¡-optæ–‡ä»¶å¤¹ä¸‹ç›®å½•çš„ä¸ªæ•°"><a href="#2-ç»Ÿè®¡-optæ–‡ä»¶å¤¹ä¸‹ç›®å½•çš„ä¸ªæ•°" class="headerlink" title="2.ç»Ÿè®¡/optæ–‡ä»¶å¤¹ä¸‹ç›®å½•çš„ä¸ªæ•°"></a>2.ç»Ÿè®¡/optæ–‡ä»¶å¤¹ä¸‹ç›®å½•çš„ä¸ªæ•°</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">ls</span> -l /home/ | grep <span class="string">&quot;^d&quot;</span> | <span class="built_in">wc</span>  -l</span><br></pre></td></tr></table></figure><h4 id="3-ç»Ÿè®¡-optæ–‡ä»¶å¤¹ä¸‹æ–‡ä»¶çš„ä¸ªæ•°ï¼ŒåŒ…æ‹¬å­æ–‡ä»¶å¤¹é‡Œçš„"><a href="#3-ç»Ÿè®¡-optæ–‡ä»¶å¤¹ä¸‹æ–‡ä»¶çš„ä¸ªæ•°ï¼ŒåŒ…æ‹¬å­æ–‡ä»¶å¤¹é‡Œçš„" class="headerlink" title="3.ç»Ÿè®¡/optæ–‡ä»¶å¤¹ä¸‹æ–‡ä»¶çš„ä¸ªæ•°ï¼ŒåŒ…æ‹¬å­æ–‡ä»¶å¤¹é‡Œçš„"></a>3.ç»Ÿè®¡/optæ–‡ä»¶å¤¹ä¸‹æ–‡ä»¶çš„ä¸ªæ•°ï¼ŒåŒ…æ‹¬å­æ–‡ä»¶å¤¹é‡Œçš„</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">ls</span> -lR /home/ | grep <span class="string">&quot;^-&quot;</span> | <span class="built_in">wc</span>  -l</span><br></pre></td></tr></table></figure><h4 id="4-ç»Ÿè®¡-optæ–‡ä»¶å¤¹ä¸‹ç›®å½•çš„ä¸ªæ•°ï¼ŒåŒ…æ‹¬å­æ–‡ä»¶å¤¹é‡Œçš„"><a href="#4-ç»Ÿè®¡-optæ–‡ä»¶å¤¹ä¸‹ç›®å½•çš„ä¸ªæ•°ï¼ŒåŒ…æ‹¬å­æ–‡ä»¶å¤¹é‡Œçš„" class="headerlink" title="4.ç»Ÿè®¡/optæ–‡ä»¶å¤¹ä¸‹ç›®å½•çš„ä¸ªæ•°ï¼ŒåŒ…æ‹¬å­æ–‡ä»¶å¤¹é‡Œçš„"></a>4.ç»Ÿè®¡/optæ–‡ä»¶å¤¹ä¸‹ç›®å½•çš„ä¸ªæ•°ï¼ŒåŒ…æ‹¬å­æ–‡ä»¶å¤¹é‡Œçš„</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">ls</span> -lR /home/ | grep <span class="string">&quot;^d&quot;</span> | <span class="built_in">wc</span>  -l</span><br></pre></td></tr></table></figure><h4 id="5-ä»¥æ ‘çŠ¶æ˜¾ç¤ºç›®å½•ç»“æ„treeç›®å½•ã€‚"><a href="#5-ä»¥æ ‘çŠ¶æ˜¾ç¤ºç›®å½•ç»“æ„treeç›®å½•ã€‚" class="headerlink" title="5.ä»¥æ ‘çŠ¶æ˜¾ç¤ºç›®å½•ç»“æ„treeç›®å½•ã€‚"></a>5.ä»¥æ ‘çŠ¶æ˜¾ç¤ºç›®å½•ç»“æ„treeç›®å½•ã€‚</h4><blockquote><p>å¦‚æœæ²¡æœ‰treeã€‚åˆ™ä½¿ç”¨<code>yum install tree</code> å®‰è£…</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@itachi103 usr]<span class="comment"># tree /home/</span></span><br><span class="line">\/home/</span><br><span class="line">â”œâ”€â”€ hello.txt</span><br><span class="line">â”œâ”€â”€ itachi</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ \345\205\254\345\205\261</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ \346\250\241\346\235\277</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ \350\247\206\351\242\221</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ \345\233\276\347\211\207</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ \346\226\207\346\241\243</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ \344\270\213\350\275\275</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ \351\237\263\344\271\220</span><br><span class="line">â”‚Â Â  â””â”€â”€ \346\241\214\351\235\242</span><br><span class="line">â”œâ”€â”€ tom</span><br><span class="line">â””â”€â”€ zhangwuji</span><br><span class="line"></span><br><span class="line">11 directories, 1 file</span><br></pre></td></tr></table></figure><h1 id="ç½‘ç»œç®¡ç†"><a href="#ç½‘ç»œç®¡ç†" class="headerlink" title="ç½‘ç»œç®¡ç†"></a>ç½‘ç»œç®¡ç†</h1><p><img src="http://cdn.leesin.fun/typora/s3/img/Linuxçš„NATä¸Šç½‘æ¨¡å¼.png" alt="Linuxçš„NATä¸Šç½‘æ¨¡å¼"></p><h1 id="è¿›ç¨‹ç®¡ç†"><a href="#è¿›ç¨‹ç®¡ç†" class="headerlink" title="è¿›ç¨‹ç®¡ç†"></a>è¿›ç¨‹ç®¡ç†</h1><h2 id="psæŒ‡ä»¤"><a href="#psæŒ‡ä»¤" class="headerlink" title="psæŒ‡ä»¤"></a>psæŒ‡ä»¤</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ps -aux</span><br></pre></td></tr></table></figure><div class="table-container"><table><thead><tr><th></th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>System V</td><td>å±•ç¤ºé£æ ¼</td></tr><tr><td>USER</td><td>ç”¨æˆ·åç§°</td></tr><tr><td>PID</td><td>è¿›ç¨‹å·</td></tr><tr><td>%CPU</td><td>è¿›ç¨‹å ç”¨CPUçš„ç™¾åˆ†æ¯”</td></tr><tr><td>%MEM</td><td>è¿›ç¨‹å ç”¨ç‰©ç†å†…å­˜çš„ç™¾åˆ†æ¯”</td></tr><tr><td>VSZ</td><td>è¿›ç¨‹å ç”¨çš„è™šæ‹Ÿå†…å­˜å¤§å°ï¼ˆå•ä½ï¼šKBï¼‰</td></tr><tr><td>RSS</td><td>è¿›ç¨‹å ç”¨çš„ç‰©ç†å†…å­˜å¤§å°ï¼ˆå•ä½ï¼šKBï¼‰</td></tr><tr><td>TTY</td><td>ç»ˆç«¯åç§°ï¼Œç¼©å†™</td></tr><tr><td>STAT</td><td>è¿›ç¨‹çŠ¶æ€ï¼Œå…¶ä¸­S-ç¡çœ ï¼Œs-è¡¨ç¤ºè¯¥è¿›ç¨‹æ˜¯ä¼šè¯çš„å…ˆå¯¼è¿›ç¨‹ï¼ŒN-è¡¨ç¤ºè¿›ç¨‹æ‹¥æœ‰æ¯”æ™®é€šä¼˜å…ˆçº§æ›´ä½çš„ä¼˜å…ˆçº§ï¼ŒR-æ­£åœ¨è¿è¡Œï¼ŒD-çŸ­æœŸç­‰å¾…ï¼ŒZ-åƒµæ­»è¿›ç¨‹ï¼ŒT-è¢«è·Ÿè¸ªæˆ–è€…è¢«åœæ­¢ç­‰å¾…</td></tr><tr><td>TIME</td><td>CPUæ—¶é—´ï¼Œå³è¿›ç¨‹ä½¿ç”¨CPUçš„æ€»æ—¶é—´</td></tr><tr><td>COMMAND</td><td>å¯åŠ¨è¿›ç¨‹æ‰€ç”¨çš„å‘½ä»¤å’Œå‚æ•°ï¼Œå¦‚æœè¿‡é•¿ä¼šè¢«æˆªæ–­æ˜¾ç¤º</td></tr></tbody></table></div><p>ä¸¾ä¾‹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@itachi103 ~]<span class="comment"># ps -aux</span></span><br><span class="line">USER        PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND</span><br><span class="line">root          1  0.0  0.0 194196  7324 ?        Ss   04:08   0:26 /usr/lib/systemd/systemd --switched-root --system --deserialize 22</span><br><span class="line">root          2  0.0  0.0      0     0 ?        S    04:08   0:00 [kthreadd]</span><br><span class="line">root          4  0.0  0.0      0     0 ?        S&lt;   04:08   0:00 [kworker/0:0H]</span><br><span class="line">root          6  0.0  0.0      0     0 ?        S    04:08   0:01 [ksoftirqd/0]</span><br><span class="line">root          7  0.0  0.0      0     0 ?        S    04:08   0:00 [migration/0]</span><br><span class="line">root          8  0.0  0.0      0     0 ?        S    04:08   0:00 [rcu_bh]</span><br><span class="line">root          9  0.0  0.0      0     0 ?        S    04:08   0:08 [rcu_sched]</span><br><span class="line">root         10  0.0  0.0      0     0 ?        S&lt;   04:08   0:00 [lru-add-drain]</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ps -ef</span><br></pre></td></tr></table></figure><div class="table-container"><table><thead><tr><th></th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>UID</td><td>ç”¨æˆ·ID</td></tr><tr><td>PID</td><td>è¿›ç¨‹ID</td></tr><tr><td>PPID</td><td>çˆ¶è¿›ç¨‹ID</td></tr><tr><td>C</td><td>CPUç”¨äºè®¡ç®—æ‰§è¡Œä¼˜å…ˆçº§çš„å› å­ã€‚æ•°å€¼è¶Šå¤§ï¼Œè¡¨æ˜è¿›ç¨‹æ˜¯CPUå¯†é›†å‹è¿ç®—ï¼Œæ‰§è¡Œä¼˜å…ˆçº§ä¼šé™ä½ï¼›æ•°å€¼è¶Šå°ï¼Œè¡¨æ˜è¿›ç¨‹æ˜¯I/Oå¯†é›†å‹è¿ç®—ï¼Œæ‰§è¡Œä¼˜å…ˆçº§ä¼šæé«˜</td></tr><tr><td>STIME</td><td>è¿›ç¨‹å¯åŠ¨çš„æ—¶é—´</td></tr><tr><td>TTY</td><td>å®Œæ•´çš„ç»ˆç«¯åç§°</td></tr><tr><td>TIME</td><td>CPUæ—¶é—´</td></tr><tr><td>CMD</td><td>å¯åŠ¨è¿›ç¨‹æ‰€ç”¨çš„å‘½ä»¤å’Œå‚æ•°</td></tr></tbody></table></div><blockquote><p>-e æ˜¾ç¤ºæ‰€æœ‰è¿›ç¨‹</p><p>-f å…¨æ ¼</p></blockquote><h2 id="ç»ˆæ­¢è¿›ç¨‹killå’Œkillall"><a href="#ç»ˆæ­¢è¿›ç¨‹killå’Œkillall" class="headerlink" title="ç»ˆæ­¢è¿›ç¨‹killå’Œkillall"></a>ç»ˆæ­¢è¿›ç¨‹killå’Œkillall</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é€šè¿‡è¿›ç¨‹å·ç»ˆæ­¢è¿›ç¨‹</span></span><br><span class="line"><span class="built_in">kill</span> [é€‰é¡¹] è¿›ç¨‹å·</span><br><span class="line"></span><br><span class="line"><span class="comment"># é€šè¿‡è¿›ç¨‹åç§°ç»ˆæ­¢è¿›ç¨‹ï¼Œä¹Ÿæ”¯æŒé€šé…ç¬¦ï¼Œè¿™åœ¨ç³»ç»Ÿå› è´Ÿè½½è¿‡å¤§è€Œå˜å¾—å¾ˆæ…¢æ—¶å¾ˆæœ‰ç”¨</span></span><br><span class="line">killall è¿›ç¨‹åç§°</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯ä»¥æ›´åŠ ç›´è§‚çš„æ¥çœ‹è¿›ç¨‹ä¿¡æ¯</span></span><br><span class="line">pstree [é€‰é¡¹]</span><br><span class="line"><span class="comment"># -pï¼šæ˜¾ç¤ºè¿›ç¨‹çš„PID</span></span><br><span class="line"><span class="comment"># -uï¼šæ˜¾ç¤ºè¿›ç¨‹çš„æ‰€å±ç”¨æˆ·</span></span><br></pre></td></tr></table></figure><p>å¦‚ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä»¥æ ‘çŠ¶çš„å½¢å¼æ˜¾ç¤ºè¿›ç¨‹çš„pid</span></span><br><span class="line">pstree -p</span><br><span class="line"><span class="comment"># ä»¥æ ‘çŠ¶çš„å½¢å¼æ˜¾ç¤ºè¿›ç¨‹çš„ç”¨æˆ·</span></span><br><span class="line">pstree -u</span><br></pre></td></tr></table></figure><h2 id="æœåŠ¡ç®¡ç†"><a href="#æœåŠ¡ç®¡ç†" class="headerlink" title="æœåŠ¡ç®¡ç†"></a>æœåŠ¡ç®¡ç†</h2><p>æœåŠ¡ï¼ˆserviceï¼‰æœ¬è´¨æ˜¯ä¸€ä¸ªå®ˆæŠ¤è¿›ç¨‹ï¼Œæ˜¯åœ¨åå°è¿è¡Œçš„ï¼Œé€šå¸¸ä¼šç›‘å¬æŸä¸ªç«¯å£ï¼Œç­‰å¾…å…¶ä»–ç¨‹åºçš„è¯·æ±‚ï¼Œæ¯”å¦‚ï¼ˆmysqldï¼Œsshdï¼Œé˜²ç«å¢™ç­‰ï¼‰ã€‚</p><h3 id="serviceç®¡ç†æŒ‡ä»¤"><a href="#serviceç®¡ç†æŒ‡ä»¤" class="headerlink" title="serviceç®¡ç†æŒ‡ä»¤"></a>serviceç®¡ç†æŒ‡ä»¤</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service æœåŠ¡å [start | stop | restart | reload | status]</span><br></pre></td></tr></table></figure><blockquote><ul><li><p>åœ¨centos7.0åï¼Œå¾ˆå¤šæœåŠ¡ä¸å†ä½¿ç”¨serviceäº†ï¼Œè€Œæ˜¯systemctl</p></li><li><p><strong>serviceæŒ‡ä»¤ç®¡ç†çš„æœåŠ¡åœ¨ <code>/etc/init.d</code> æŸ¥çœ‹</strong></p><ul><li>~~~bash<br>[root@itachi103 ~]# ll /etc/init.d/<br>æ€»ç”¨é‡ 40<br>-rw-râ€”râ€”. 1 root root 18281 5æœˆ  22 2020 functions<br>-rwxr-xr-x. 1 root root  4569 5æœˆ  22 2020 netconsole<br>-rwxr-xr-x. 1 root root  7928 5æœˆ  22 2020 network<br>-rw-râ€”râ€”. 1 root root  1160 10æœˆ  2 2020 README<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">### æŸ¥çœ‹æœåŠ¡</span><br><span class="line"></span><br><span class="line">~~~bash</span><br><span class="line">setup</span><br></pre></td></tr></table></figure></li></ul></li></ul></blockquote><p>é€‰ä¸­ç³»ç»ŸæœåŠ¡ï¼ŒæŒ‰å›è½¦</p><p><img src="http://cdn.leesin.fun/typora/s3/img/setup1.png" alt="setup1"></p><p>å³å¯æŸ¥çœ‹æ‰€æœ‰æœåŠ¡</p><p><img src="http://cdn.leesin.fun/typora/s3/img/setup2.png" alt="setup2"></p><p>[*]è¡¨ç¤ºå¼€æœºè‡ªå¯åŠ¨</p><p>[ ]è¡¨ç¤ºå¼€æœºä¸ä¼šè‡ªå¯åŠ¨</p><p>é€‰ä¸­æŸä¸€è¡Œï¼ŒæŒ‰ç©ºæ ¼å¯ä»¥åˆ‡æ¢æ˜¯å¦å¼€æœºè‡ªå¯</p><p>æŒ‰Tabé”®ï¼Œå¯ä»¥é€‰ä¸­â€œç¡®å®šâ€/â€œå–æ¶ˆâ€</p><h3 id="systemctlç®¡ç†æŒ‡ä»¤"><a href="#systemctlç®¡ç†æŒ‡ä»¤" class="headerlink" title="systemctlç®¡ç†æŒ‡ä»¤"></a>systemctlç®¡ç†æŒ‡ä»¤</h3><h5 id="åŸºæœ¬è¯­æ³•"><a href="#åŸºæœ¬è¯­æ³•" class="headerlink" title="åŸºæœ¬è¯­æ³•"></a>åŸºæœ¬è¯­æ³•</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl [start | stop | restart | status] æœåŠ¡å</span><br></pre></td></tr></table></figure><blockquote><p> systemctlæŒ‡ä»¤ç®¡ç†çš„æœåŠ¡åœ¨ /usr/lib/systemd/system æŸ¥çœ‹</p></blockquote><h5 id="æŸ¥çœ‹æœåŠ¡å¼€æœºå¯åŠ¨çŠ¶æ€ï¼Œå¯ä»¥ä½¿ç”¨grepè¿›è¡Œè¿‡æ»¤"><a href="#æŸ¥çœ‹æœåŠ¡å¼€æœºå¯åŠ¨çŠ¶æ€ï¼Œå¯ä»¥ä½¿ç”¨grepè¿›è¡Œè¿‡æ»¤" class="headerlink" title="æŸ¥çœ‹æœåŠ¡å¼€æœºå¯åŠ¨çŠ¶æ€ï¼Œå¯ä»¥ä½¿ç”¨grepè¿›è¡Œè¿‡æ»¤"></a>æŸ¥çœ‹æœåŠ¡å¼€æœºå¯åŠ¨çŠ¶æ€ï¼Œå¯ä»¥ä½¿ç”¨grepè¿›è¡Œè¿‡æ»¤</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl list-unit-files</span><br><span class="line">systemctl list-unit-files | grep sshd</span><br></pre></td></tr></table></figure><h5 id="è®¾ç½®æœåŠ¡å¼€æœºå¯åŠ¨"><a href="#è®¾ç½®æœåŠ¡å¼€æœºå¯åŠ¨" class="headerlink" title="è®¾ç½®æœåŠ¡å¼€æœºå¯åŠ¨"></a>è®¾ç½®æœåŠ¡å¼€æœºå¯åŠ¨</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl <span class="built_in">enable</span> æœåŠ¡å</span><br></pre></td></tr></table></figure><h5 id="å…³é—­æœåŠ¡å¼€æœºå¯åŠ¨"><a href="#å…³é—­æœåŠ¡å¼€æœºå¯åŠ¨" class="headerlink" title="å…³é—­æœåŠ¡å¼€æœºå¯åŠ¨"></a>å…³é—­æœåŠ¡å¼€æœºå¯åŠ¨</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl <span class="built_in">disable</span> æœåŠ¡å</span><br></pre></td></tr></table></figure><h5 id="æŸ¥è¯¢æŸä¸ªæœåŠ¡æ˜¯å¦å¼€æœºè‡ªå¯åŠ¨"><a href="#æŸ¥è¯¢æŸä¸ªæœåŠ¡æ˜¯å¦å¼€æœºè‡ªå¯åŠ¨" class="headerlink" title="æŸ¥è¯¢æŸä¸ªæœåŠ¡æ˜¯å¦å¼€æœºè‡ªå¯åŠ¨"></a>æŸ¥è¯¢æŸä¸ªæœåŠ¡æ˜¯å¦å¼€æœºè‡ªå¯åŠ¨</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl is-enabled æœåŠ¡å</span><br></pre></td></tr></table></figure><h5 id="ä¸¾ä¾‹ï¼šå…³é—­é˜²ç«å¢™ï¼Œä»¥åŠå…³é—­é˜²ç«å¢™å¼€æœºè‡ªå¯"><a href="#ä¸¾ä¾‹ï¼šå…³é—­é˜²ç«å¢™ï¼Œä»¥åŠå…³é—­é˜²ç«å¢™å¼€æœºè‡ªå¯" class="headerlink" title="ä¸¾ä¾‹ï¼šå…³é—­é˜²ç«å¢™ï¼Œä»¥åŠå…³é—­é˜²ç«å¢™å¼€æœºè‡ªå¯"></a>ä¸¾ä¾‹ï¼šå…³é—­é˜²ç«å¢™ï¼Œä»¥åŠå…³é—­é˜²ç«å¢™å¼€æœºè‡ªå¯</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å…³é—­é˜²ç«å¢™</span></span><br><span class="line">systemctl stop firewalld</span><br><span class="line"></span><br><span class="line"><span class="comment"># å…³é—­é˜²ç«å¢™å¼€æœºè‡ªå¯</span></span><br><span class="line">systemctl <span class="built_in">disable</span> firewalld.service</span><br></pre></td></tr></table></figure><h3 id="firewallæŒ‡ä»¤"><a href="#firewallæŒ‡ä»¤" class="headerlink" title="firewallæŒ‡ä»¤"></a>firewallæŒ‡ä»¤</h3><h5 id="æ‰“å¼€ç«¯å£"><a href="#æ‰“å¼€ç«¯å£" class="headerlink" title="æ‰“å¼€ç«¯å£"></a>æ‰“å¼€ç«¯å£</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --permanent --add-port=ç«¯å£å·/åè®®</span><br><span class="line">firewall-cmd --reload</span><br></pre></td></tr></table></figure><h5 id="å…³é—­ç«¯å£"><a href="#å…³é—­ç«¯å£" class="headerlink" title="å…³é—­ç«¯å£"></a>å…³é—­ç«¯å£</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --permanent --remove-port=ç«¯å£å·/åè®®</span><br><span class="line">firewall-cmd --reload</span><br></pre></td></tr></table></figure><h5 id="æŸ¥è¯¢ç«¯å£æ˜¯å¦å¼€æ”¾"><a href="#æŸ¥è¯¢ç«¯å£æ˜¯å¦å¼€æ”¾" class="headerlink" title="æŸ¥è¯¢ç«¯å£æ˜¯å¦å¼€æ”¾"></a>æŸ¥è¯¢ç«¯å£æ˜¯å¦å¼€æ”¾</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --query-port=ç«¯å£å·/åè®®</span><br></pre></td></tr></table></figure><h3 id="åŠ¨æ€ç›‘æ§ç³»ç»Ÿ"><a href="#åŠ¨æ€ç›‘æ§ç³»ç»Ÿ" class="headerlink" title="åŠ¨æ€ç›‘æ§ç³»ç»Ÿ"></a>åŠ¨æ€ç›‘æ§ç³»ç»Ÿ</h3><h4 id="topå‘½ä»¤"><a href="#topå‘½ä»¤" class="headerlink" title="topå‘½ä»¤"></a>topå‘½ä»¤</h4><p>topä¸pså‘½ä»¤å¾ˆç›¸ä¼¼ã€‚æœ€å¤§ä¸åŒä¹‹å¤„åœ¨äºï¼Œtopåœ¨æ‰§è¡Œä¸€æ®µæ—¶é—´å¯ä»¥æ›´æ–°æ­£åœ¨è¿è¡Œçš„è¿›ç¨‹ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">top [é€‰é¡¹]</span><br></pre></td></tr></table></figure><div class="table-container"><table><thead><tr><th style="text-align:center">é€‰é¡¹</th><th style="text-align:center">åŠŸèƒ½</th></tr></thead><tbody><tr><td style="text-align:center">-d ç§’æ•°</td><td style="text-align:center">æŒ‡å®štopå‘½ä»¤æ¯éš”å‡ ç§’æ›´æ–°ã€‚é»˜è®¤æ˜¯3ç§’</td></tr><tr><td style="text-align:center">-i</td><td style="text-align:center">ä½¿topä¸æ˜¾ç¤ºä»»ä½•é—²ç½®æˆ–è€…åƒµæ­»è¿›ç¨‹</td></tr><tr><td style="text-align:center">-p</td><td style="text-align:center">é€šè¿‡æŒ‡å®šç›‘æ§è¿›ç¨‹IDæ¥ ä»…ä»…ç›‘æ§æŸä¸ªè¿›ç¨‹çš„çŠ¶æ€</td></tr></tbody></table></div><h5 id="äº¤äº’æ“ä½œ"><a href="#äº¤äº’æ“ä½œ" class="headerlink" title="äº¤äº’æ“ä½œ"></a>äº¤äº’æ“ä½œ</h5><div class="table-container"><table><thead><tr><th style="text-align:center">æ“ä½œ</th><th style="text-align:center">åŠŸèƒ½</th></tr></thead><tbody><tr><td style="text-align:center">P</td><td style="text-align:center">ä»¥CPUä½¿ç”¨ç‡æ’åºï¼Œé»˜è®¤å°±æ˜¯æ­¤é¡¹</td></tr><tr><td style="text-align:center">M</td><td style="text-align:center">ä»¥å†…å­˜çš„ä½¿ç”¨ç‡æ’åº</td></tr><tr><td style="text-align:center">N</td><td style="text-align:center">ä»¥PIDæ’åº</td></tr><tr><td style="text-align:center">q</td><td style="text-align:center">é€€å‡ºtop</td></tr></tbody></table></div><h5 id="æ¡ˆä¾‹1ï¼šç›‘è§†ç‰¹å®šç”¨æˆ·"><a href="#æ¡ˆä¾‹1ï¼šç›‘è§†ç‰¹å®šç”¨æˆ·" class="headerlink" title="æ¡ˆä¾‹1ï¼šç›‘è§†ç‰¹å®šç”¨æˆ·"></a>æ¡ˆä¾‹1ï¼šç›‘è§†ç‰¹å®šç”¨æˆ·</h5><p>topï¼šè¾“å…¥æ­¤å‘½ä»¤ï¼ŒæŒ‰å›è½¦é”®ï¼ŒæŸ¥çœ‹æ‰§è¡Œçš„è¿›ç¨‹</p><p>u : ç„¶åè¾“å…¥â€œuâ€ ï¼ŒæŒ‰å›è½¦é”®ï¼Œå†è¾“å…¥ç”¨æˆ·åå³å¯</p><h5 id="æ¡ˆä¾‹2ï¼šç»ˆæ­¢ç‰¹å®šè¿›ç¨‹"><a href="#æ¡ˆä¾‹2ï¼šç»ˆæ­¢ç‰¹å®šè¿›ç¨‹" class="headerlink" title="æ¡ˆä¾‹2ï¼šç»ˆæ­¢ç‰¹å®šè¿›ç¨‹"></a>æ¡ˆä¾‹2ï¼šç»ˆæ­¢ç‰¹å®šè¿›ç¨‹</h5><p>topï¼šè¾“å…¥æ­¤å‘½ä»¤ï¼ŒæŒ‰å›è½¦é”®ï¼ŒæŸ¥çœ‹æ‰§è¡Œçš„è¿›ç¨‹</p><p>k: ç„¶åè¾“å…¥â€œkâ€å›è½¦ï¼Œå†è¾“å…¥è¦ç»“æŸçš„è¿›ç¨‹IDå·</p><h2 id="ç›‘æ§ç½‘ç»œçŠ¶æ€"><a href="#ç›‘æ§ç½‘ç»œçŠ¶æ€" class="headerlink" title="ç›‘æ§ç½‘ç»œçŠ¶æ€"></a>ç›‘æ§ç½‘ç»œçŠ¶æ€</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netstat [é€‰é¡¹]</span><br></pre></td></tr></table></figure><div class="table-container"><table><thead><tr><th style="text-align:center">é€‰é¡¹</th><th style="text-align:center">åŠŸèƒ½</th></tr></thead><tbody><tr><td style="text-align:center">-a</td><td style="text-align:center">æ˜¾ç¤ºæ‰€æœ‰socketï¼ŒåŒ…æ‹¬æ­£åœ¨ç›‘å¬çš„</td></tr><tr><td style="text-align:center">-n</td><td style="text-align:center">ä»¥æ•°å­—å½¢å¼æ˜¾ç¤ºåœ°å€å’Œç«¯å£å·</td></tr><tr><td style="text-align:center">-p</td><td style="text-align:center">proto æ˜¾ç¤ºprotoæŒ‡å®šçš„åè®®çš„è¿æ¥</td></tr></tbody></table></div><p>å¦‚ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¸¸ç”¨å‘½ä»¤</span></span><br><span class="line">net</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹æœåŠ¡åä¸ºsshdçš„æœåŠ¡ä¿¡æ¯</span></span><br><span class="line">netstat -anp | grep sshd</span><br></pre></td></tr></table></figure><h1 id="æ—¥å¿—"><a href="#æ—¥å¿—" class="headerlink" title="æ—¥å¿—"></a>æ—¥å¿—</h1><h2 id="ç³»ç»Ÿå¸¸ç”¨æ—¥å¿—"><a href="#ç³»ç»Ÿå¸¸ç”¨æ—¥å¿—" class="headerlink" title="ç³»ç»Ÿå¸¸ç”¨æ—¥å¿—"></a>ç³»ç»Ÿå¸¸ç”¨æ—¥å¿—</h2><p><code>/var/log</code>ç›®å½•å°±æ˜¯ç³»ç»Ÿæ—¥å¿—æ–‡ä»¶çš„ä¿å­˜ä½ç½®</p><div class="table-container"><table><thead><tr><th style="text-align:center">æ—¥å¿—æ–‡ä»¶</th><th style="text-align:center">è¯´æ˜</th></tr></thead><tbody><tr><td style="text-align:center">/var/log/boot.log</td><td style="text-align:center">ç³»ç»Ÿå¯åŠ¨æ—¥å¿—</td></tr><tr><td style="text-align:center">/var/log/cron</td><td style="text-align:center">è®°å½•ä¸ç³»ç»Ÿå®šæ—¶ä»»åŠ¡ç›¸å…³çš„æ—¥å¿—</td></tr><tr><td style="text-align:center">/var/log/lasllog</td><td style="text-align:center">è®°å½•ç³»ç»Ÿä¸­æ‰€æœ‰ç”¨æˆ·æœ€åä¸€æ¬¡çš„ç™»å½•æ—¶é—´çš„æ—¥å¿—ã€‚è¿™æ˜¯ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œè¦ä½¿ç”¨lastlogå‘½ä»¤æŸ¥çœ‹</td></tr><tr><td style="text-align:center">/var/Iog/maillog</td><td style="text-align:center">è®°å½•é‚®ä»¶ä¿¡æ¯çš„æ—¥å¿—</td></tr><tr><td style="text-align:center">/var/log/message</td><td style="text-align:center">è®°å½•ç³»ç»Ÿé‡è¦æ¶ˆæ¯çš„æ—¥å¿—ã€‚è¿™ä¸ªæ—¥å¿—æ–‡ä»¶ä¸­ä¼šè®°å½•Linuxç³»ç»Ÿçš„ç»å¤§å¤šæ•°é‡è¦ä¿¡æ¯ã€‚å¦‚æœç³»ç»Ÿå‡ºç°é—®é¢˜ï¼Œé¦–å…ˆè¦æ£€æŸ¥çš„åº”è¯¥å°±æ˜¯è¿™ä¸ªæ—¥å¿—æ–‡ä»¶</td></tr><tr><td style="text-align:center">/var/log/secure</td><td style="text-align:center">è®°å½•éªŒè¯å’Œæˆæƒæ–¹é¢çš„ä¿¡æ¯ï¼Œåªè¦æ¶‰åŠè´¦æˆ·å’Œå¯†ç çš„ç¨‹åºéƒ½ä¼šè®°å½•ã€‚æ¯”å¦‚ç³»ç»Ÿçš„ç™»å½•ã€sshçš„ç™»å½•ã€suåˆ‡æ¢ç”¨æˆ·ã€sudoæˆæƒï¼Œç”šè‡³æ·»åŠ ç”¨æˆ·å’Œä¿®æ”¹ç”¨æˆ·å¯†ç éƒ½ä¼šè®°å½•åœ¨è¿™ä¸ªæ—¥å¿—æ–‡ä»¶ä¸­ã€‚</td></tr><tr><td style="text-align:center"></td></tr></tbody></table></div><h2 id="æ—¥å¿—æœåŠ¡ç®¡ç†-rsyslogd"><a href="#æ—¥å¿—æœåŠ¡ç®¡ç†-rsyslogd" class="headerlink" title="æ—¥å¿—æœåŠ¡ç®¡ç† rsyslogd"></a>æ—¥å¿—æœåŠ¡ç®¡ç† rsyslogd</h2><h5 id="åŸºæœ¬ä»‹ç»-1"><a href="#åŸºæœ¬ä»‹ç»-1" class="headerlink" title="åŸºæœ¬ä»‹ç»"></a>åŸºæœ¬ä»‹ç»</h5><p><code>/etc/rsyslog.conf</code>æ˜¯æ—¥å¿—æœåŠ¡çš„é…ç½®æ–‡ä»¶ã€‚é»˜è®¤æ–‡ä»¶å¦‚ä¸‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Log all the mail messages <span class="keyword">in</span> one place.</span></span><br><span class="line">mail.*                                                  -/var/log/maillog</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Log cron stuff</span></span><br><span class="line">cron.*                                                  /var/log/cron</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Everybody gets emergency messages</span></span><br><span class="line">*.emerg                                                 :omusrmsg:*</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Save news errors of level crit and higher <span class="keyword">in</span> a special file.</span></span><br><span class="line">uucp,news.crit                                          /var/log/spooler</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Save boot messages also to boot.log</span></span><br><span class="line">local7.*                                                /var/log/boot.log</span><br></pre></td></tr></table></figure><p>é…ç½®çš„æ ¼å¼ä¸º:<code>*.* å­˜æ”¾æ—¥å¿—æ–‡ä»¶</code><br>å…¶ä¸­ç¬¬ä¸€ä¸ª * ä»£è¡¨æ—¥å¿—ç±»å‹ï¼Œç¬¬äºŒä¸ª * ä»£è¡¨æ—¥å¿—çº§åˆ«ã€‚</p><h5 id="æ—¥å¿—ç±»å‹"><a href="#æ—¥å¿—ç±»å‹" class="headerlink" title="æ—¥å¿—ç±»å‹"></a>æ—¥å¿—ç±»å‹</h5><div class="table-container"><table><thead><tr><th style="text-align:center">æ—¥å¿—ç±»å‹</th><th style="text-align:center">æ—¥å¿—çº§åˆ«</th></tr></thead><tbody><tr><td style="text-align:center">auth</td><td style="text-align:center">pamäº§ç”Ÿçš„æ—¥å¿—</td></tr><tr><td style="text-align:center">authpriv</td><td style="text-align:center">sshã€ftp ç­‰ç™»å½•ä¿¡æ¯çš„éªŒè¯ä¿¡æ¯</td></tr><tr><td style="text-align:center">corn</td><td style="text-align:center">æ—¶é—´ä»»åŠ¡ç›¸å…³</td></tr><tr><td style="text-align:center">kern</td><td style="text-align:center">å†…æ ¸</td></tr><tr><td style="text-align:center">lpr</td><td style="text-align:center">æ‰“å°</td></tr><tr><td style="text-align:center">mail</td><td style="text-align:center">é‚®ä»¶</td></tr><tr><td style="text-align:center">mark(syslog)-rsyslog</td><td style="text-align:center">æœåŠ¡å†…éƒ¨çš„ä¿¡æ¯ï¼Œæ—¶é—´æ ‡è¯†</td></tr><tr><td style="text-align:center">news</td><td style="text-align:center">æ–°é—»ç»„</td></tr><tr><td style="text-align:center">user</td><td style="text-align:center">ç”¨æˆ·ç¨‹åºäº§ç”Ÿçš„ç›¸å…³ä¿¡æ¯</td></tr><tr><td style="text-align:center">uucp</td><td style="text-align:center">unix to nuix copy ä¸»æœºä¹‹é—´ç›¸å…³çš„é€šä¿¡</td></tr><tr><td style="text-align:center">local 1-7</td><td style="text-align:center">è‡ªå®šä¹‰çš„æ—¥å¿—è®¾å¤‡</td></tr></tbody></table></div><h5 id="æ—¥å¿—çº§åˆ«"><a href="#æ—¥å¿—çº§åˆ«" class="headerlink" title="æ—¥å¿—çº§åˆ«"></a>æ—¥å¿—çº§åˆ«</h5><div class="table-container"><table><thead><tr><th style="text-align:center">æ—¥å¿—çº§åˆ«</th><th style="text-align:center">è¯´æ˜</th></tr></thead><tbody><tr><td style="text-align:center">debug</td><td style="text-align:center">æœ‰è°ƒè¯•ä¿¡æ¯çš„ï¼Œæ—¥å¿—é€šä¿¡æœ€å¤š</td></tr><tr><td style="text-align:center">info</td><td style="text-align:center">ä¸€èˆ¬ä¿¡æ¯æ—¥å¿—ï¼Œæœ€å¸¸ç”¨</td></tr><tr><td style="text-align:center">notice</td><td style="text-align:center">æœ€å…·æœ‰é‡è¦æ€§çš„æ™®é€šæ¡ä»¶çš„ä¿¡æ¯</td></tr><tr><td style="text-align:center">warning</td><td style="text-align:center">è­¦å‘Šçº§åˆ«</td></tr><tr><td style="text-align:center">err</td><td style="text-align:center">é”™è¯¯çº§åˆ«ï¼Œé˜»æ­¢æŸä¸ªåŠŸèƒ½æˆ–è€…æ¨¡å—ä¸èƒ½æ­£å¸¸å·¥ä½œçš„ä¿¡æ¯</td></tr><tr><td style="text-align:center">crit</td><td style="text-align:center">ä¸¥é‡çº§åˆ«ï¼Œé˜»æ­¢æ•´ä¸ªç³»ç»Ÿæˆ–è€…æ•´ä¸ªè½¯ä»¶ä¸èƒ½æ­£å¸¸å·¥ä½œçš„ä¿¡æ¯</td></tr><tr><td style="text-align:center">alert</td><td style="text-align:center">éœ€è¦ç«‹åˆ»ä¿®æ”¹çš„ä¿¡æ¯</td></tr><tr><td style="text-align:center">emerg</td><td style="text-align:center">å†…æ ¸å´©æºƒç­‰é‡è¦ä¿¡æ¯</td></tr><tr><td style="text-align:center">none</td><td style="text-align:center">ä»€ä¹ˆéƒ½ä¸è®°å½•</td></tr></tbody></table></div><p>æ³¨æ„: ä»ä¸Šåˆ°ä¸‹ï¼Œçº§åˆ«ä»ä½åˆ°é«˜ï¼Œè®°å½•ä¿¡æ¯è¶Šæ¥è¶Šå°‘</p><h5 id="æ—¥å¿—å†…å®¹æ ¼å¼"><a href="#æ—¥å¿—å†…å®¹æ ¼å¼" class="headerlink" title="æ—¥å¿—å†…å®¹æ ¼å¼"></a>æ—¥å¿—å†…å®¹æ ¼å¼</h5><p>ç”±æ—¥å¿—æœåŠ¡ rsyslogd è®°å½•çš„æ—¥å¿—æ–‡ä»¶ï¼Œæ—¥å¿—æ–‡ä»¶çš„æ ¼å¼åŒ…å«ä»¥ä¸‹ 4 åˆ—:</p><ol><li>äº‹ä»¶äº§ç”Ÿçš„æ—¶é—´</li></ol><p>2) äº§ç”Ÿäº‹ä»¶çš„æœåŠ¡å™¨çš„ä¸»æœºå<br>3) äº§ç”Ÿäº‹ä»¶çš„æœåŠ¡åæˆ–ç¨‹åºå<br>4) äº‹ä»¶çš„å…·ä½“ä¿¡æ¯</p><p>å¦‚ï¼šæŸ¥çœ‹ä¸€ä¸‹<code>/var/log/secure</code>æ—¥å¿—ï¼Œè¿™ä¸ªæ—¥å¿—ä¸­è®°å½•çš„æ˜¯ç”¨æˆ·éªŒè¯å’Œæˆæƒæ–¹é¢çš„ä¿¡æ¯ã€‚</p><p><img src="http://cdn.leesin.fun/typora/s3/img/secureæ—¥å¿—.png" alt="secureæ—¥å¿—"></p><h2 id="æ—¥å¿—è½®æ›¿"><a href="#æ—¥å¿—è½®æ›¿" class="headerlink" title="æ—¥å¿—è½®æ›¿"></a>æ—¥å¿—è½®æ›¿</h2><h5 id="åŸºæœ¬ä»‹ç»-2"><a href="#åŸºæœ¬ä»‹ç»-2" class="headerlink" title="åŸºæœ¬ä»‹ç»"></a>åŸºæœ¬ä»‹ç»</h5><p>æ—¥å¿—è½®æ›¿å°±æ˜¯æŠŠæ—§çš„æ—¥å¿—æ–‡ä»¶ç§»åŠ¨å¹¶æ”¹åï¼ŒåŒæ—¶å»ºç«‹æ–°çš„ç©ºæ—¥å¿—æ–‡ä»¶ï¼Œå½“æ—§æ—¥å¿—æ–‡ä»¶è¶…å‡ºä¿å­˜çš„èŒƒå›´ä¹‹åï¼Œå°±ä¼šè¿›è¡Œåˆ é™¤</p><ul><li>centos7ä½¿ç”¨logrotateè¿›è¡Œæ—¥å¿—è½®æ›¿ç®¡ç†ï¼Œé€šè¿‡ä¿®æ”¹<code>/etc/logrotate.conf</code>é…ç½®æ–‡ä»¶ä¸­çš„<code>dateext</code>å‚æ•°ï¼Œå¯ä»¥æ”¹å˜æ—¥å¿—è½®æ›¿æ–‡ä»¶åå­—ã€‚</li><li>å¦‚æœé…ç½®æ–‡ä»¶ä¸­æœ‰<code>dateext</code>å‚æ•°ï¼Œé‚£ä¹ˆæ—¥å¿—ä¼šç”¨<strong>æ—¥æœŸ</strong>æ¥ä½œä¸ºæ—¥å¿—æ–‡ä»¶çš„åç¼€ï¼Œä¾‹å¦‚â€œsecure-20201010â€ã€‚è¿™æ ·æ—¥å¿—æ–‡ä»¶åä¸ä¼šé‡å ï¼Œä¹Ÿå°±ä¸éœ€è¦æ—¥å¿—æ–‡ä»¶çš„æ”¹åï¼Œåªéœ€è¦æŒ‡å®šä¿å­˜æ—¥å¿—ä¸ªæ•°ï¼Œåˆ é™¤å¤šä½™çš„æ—¥å¿—æ–‡ä»¶å³å¯ã€‚</li><li>å¦‚æœé…ç½®æ–‡ä»¶ä¸­æ²¡æœ‰<code>dateext</code>å‚æ•°ï¼Œæ—¥å¿—æ–‡ä»¶å°±éœ€è¦è¿›è¡Œæ”¹åäº†ã€‚<ul><li>å½“ç¬¬ä¸€æ¬¡è¿›è¡Œæ—¥å¿—è½®æ›¿æ—¶ï¼Œå½“å‰çš„â€œsecureâ€æ—¥å¿—ä¼šè‡ªåŠ¨æ”¹åä¸ºâ€secure.1â€ï¼Œç„¶åæ–°å»ºâ€secureâ€æ—¥å¿—ï¼Œç”¨æ¥ä¿å­˜æ–°çš„æ—¥å¿—ã€‚</li><li>å½“ç¬¬äºŒæ¬¡è¿›è¡Œè½®æ›¿æ—¶ï¼Œâ€secure.1â€ä¼šè‡ªåŠ¨æ”¹åä¸ºâ€secure.2â€ï¼Œå½“å‰çš„â€secureâ€æ—¥å¿—ä¼šè‡ªåŠ¨æ”¹åä¸ºâ€secure.1â€ï¼Œç„¶åä¹Ÿä¼šæ–°å»ºâ€secureâ€æ—¥å¿—ï¼Œç”¨æ¥ä¿å­˜æ–°çš„æ—¥å¿—ï¼Œä»¥æ­¤ç±»æ¨ã€‚</li></ul></li></ul><h5 id="é…ç½®æ–‡ä»¶"><a href="#é…ç½®æ–‡ä»¶" class="headerlink" title="é…ç½®æ–‡ä»¶"></a>é…ç½®æ–‡ä»¶</h5><p><code>/etc/logrotate.conf</code>  ä¸ºlogrotateçš„å…¨å±€é…ç½®æ–‡ä»¶</p><p>é»˜è®¤å†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">see <span class="string">&quot;man logrotate&quot;</span> <span class="keyword">for</span> details</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">rotate <span class="built_in">log</span> files weekly æ¯å‘¨å¯¹æ—¥å¿—æ–‡ä»¶è¿›è¡Œä¸€æ¬¡è½®æ›¿</span></span><br><span class="line">weekly</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">keep 4 weeks worth of backlogs æœ€å¤šå…±ä¿å­˜4ä»½æ—¥å¿—æ–‡ä»¶</span></span><br><span class="line">rotate 4</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">create new (empty) <span class="built_in">log</span> files after rotating old ones æ—¥å¿—è½®æ›¿åï¼Œåˆ›å»ºæ–°çš„ç©ºçš„æ—¥å¿—æ–‡ä»¶</span></span><br><span class="line">create</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">use <span class="built_in">date</span> as a suffix of the rotated file ä½¿ç”¨æ—¥æœŸä½œä¸ºæ—¥å¿—è½®æ›¿æ–‡ä»¶çš„åç¼€</span></span><br><span class="line">dateext</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">uncomment this <span class="keyword">if</span> you want your <span class="built_in">log</span> files compressed å¦‚æœå¸Œæœ›æ—¥å¿—æ–‡ä»¶å‹ç¼©ï¼Œå°±å–æ¶ˆæ³¨é‡Š</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">compress</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">RPM packages drop <span class="built_in">log</span> rotation information into this directory</span> </span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">åŒ…å«/etc/logrotate.dä¸­çš„æ‰€æœ‰å­é…ç½®æ–‡ä»¶ã€‚ä¹Ÿå°±æ˜¯è¯´ä¼šæŠŠè¯¥ç›®å½•ä¸­çš„æ‰€æœ‰å­é…ç½®æ–‡ä»¶è¯»å–è¿›æ¥ã€‚</span></span><br><span class="line">include /etc/logrotate.d</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">no packages own wtmp and btmp -- we<span class="string">&#x27;ll rotate them here</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">ä¸‹é¢æ˜¯å•ç‹¬é…ç½®ï¼Œä¼˜å…ˆçº§æ›´é«˜</span></span></span><br><span class="line">/var/log/wtmp &#123;</span><br><span class="line"><span class="meta prompt_"> # </span><span class="language-bash"><span class="string">æ¯æœˆå¯¹æ—¥å¿—æ–‡ä»¶è¿›è¡Œä¸€æ¬¡è½®æ›¿</span></span></span><br><span class="line">    monthly</span><br><span class="line">    # å»ºç«‹çš„æ–°æ—¥å¿—æ–‡ä»¶ï¼Œæƒé™æ˜¯ 0664 ï¼Œæ‰€æœ‰è€…æ˜¯ root ï¼Œæ‰€å±ç»„æ˜¯ utmp ç»„</span><br><span class="line">    create 0664 root utmp</span><br><span class="line">    # æ—¥å¿—æ–‡ä»¶æœ€å°è½®æ›¿å¤§å°æ˜¯ 1MBã€‚ä¹Ÿå°±æ˜¯æ—¥å¿—å®šè¦è¶…è¿‡ 1MB æ‰ä¼šè½®æ›¿ï¼Œå¦åˆ™å°±ç®—æ—¶é—´è¾¾åˆ°ä¸€ä¸ªæœˆï¼Œä¹Ÿä¸è¿›è¡Œæ—¥å¿—è½¬å‚¨</span><br><span class="line">minsize 1M</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">ä»…ä¿ç•™ä¸€ä¸ªæ—¥å¿—å¤‡ä»½ã€‚ä¹Ÿå°±æ˜¯åªæœ‰ wtmp å’Œ wtmp.1 æ—¥å¿—ä¿ç•™è€Œå·²</span></span></span><br><span class="line">    rotate 1</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/var/log/btmp &#123;</span><br><span class="line">    # å¦‚æœæ—¥å¿—ä¸å­˜åœ¨ï¼Œåˆ™å¿½ç•¥è¯¥æ—¥å¿—çš„è­¦å‘Šä¿¡æ¯</span><br><span class="line">    missingok</span><br><span class="line">    monthly</span><br><span class="line">    create 0600 root utmp</span><br><span class="line">    rotate 1</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">system-specific logs may be also be configured here.</span></span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å‚æ•°è¯´æ˜</p><div class="table-container"><table><thead><tr><th style="text-align:center">å‚æ•°</th><th style="text-align:center">å‚æ•°è¯´æ˜</th></tr></thead><tbody><tr><td style="text-align:center">daily</td><td style="text-align:center">æ—¥å¿—çš„è½®æ›¿å‘¨æœŸæ˜¯æ¯å¤©</td></tr><tr><td style="text-align:center">weekly</td><td style="text-align:center">æ—¥å¿—çš„è½®æ›¿å‘¨æœŸæ˜¯æ¯å‘¨</td></tr><tr><td style="text-align:center">monthly</td><td style="text-align:center">æ—¥å¿—çš„è½®ç´å‘¨æœŸæ˜¯æ¯æœˆ</td></tr><tr><td style="text-align:center">rotate æ•°å­—</td><td style="text-align:center">ä¿ç•™çš„æ—¥å¿—æ–‡ä»¶çš„ä¸ªæ•°ã€‚0 æŒ‡æ²¡æœ‰å¤‡ä»½</td></tr><tr><td style="text-align:center">compress</td><td style="text-align:center">æ—¥å¿—è½®æ›¿æ—¶ï¼Œæ—§çš„æ—¥å¿—è¿›è¡Œå‹ç¼©</td></tr><tr><td style="text-align:center">create mode owner group</td><td style="text-align:center">å»ºç«‹æ–°æ—¥å¿—ï¼ŒåŒæ—¶æŒ‡å®šæ–°æ—¥å¿—çš„æƒé™ä¸æ‰€æœ‰è€…å’Œæ‰€å±ç»„ã€‚</td></tr><tr><td style="text-align:center">mail address</td><td style="text-align:center">å½“æ—¥å¿—è½®æ›¿æ—¶ï¼Œè¾“å‡ºå†…å®¹é€šè¿‡é‚®ä»¶å‘é€åˆ°æŒ‡å®šçš„é‚®ä»¶åœ°å€.</td></tr><tr><td style="text-align:center">missingok</td><td style="text-align:center">å¦‚æœæ—¥å¿—ä¸å­˜åœ¨ï¼Œåˆ™å¿½ç•¥è¯¥æ—¥å¿—çš„è­¦å‘Šä¿¡æ¯</td></tr><tr><td style="text-align:center">notifempty</td><td style="text-align:center">å¦‚æœæ—¥å¿—ä¸ºç©ºæ–‡ä»¶ï¼Œåˆ™ä¸è¿›è¡Œæ—¥å¿—è½®æ›¿</td></tr><tr><td style="text-align:center">minsize å¤§å°</td><td style="text-align:center">æ—¥å¿—è½®æ›¿çš„æœ€å°å€¼ã€‚ä¹Ÿå°±æ˜¯æ—¥å¿—ä¸€å®šè¦è¾¾åˆ°è¿™ä¸ªæœ€å°å€¼æ‰ä¼šè½®æ›¿ï¼Œå¦åˆ™å°±ç®—æ—¶é—´è¾¾åˆ°ä¹Ÿä¸è½®æ›¿</td></tr><tr><td style="text-align:center">size å¤§å°</td><td style="text-align:center">æ—¥å¿—åªæœ‰å¤§äºæŒ‡å®šå¤§å°æ‰è¿›è¡Œæ—¥å¿—è½®æ›¿ï¼Œè€Œä¸æ˜¯æŒ‰ç…§æ—¶é—´è½®æ›¿</td></tr><tr><td style="text-align:center">dateext</td><td style="text-align:center">ä½¿ç”¨æ—¥æœŸä½œä¸ºæ—¥å¿—è½®æ›¿æ–‡ä»¶çš„åç¼€ã€‚</td></tr><tr><td style="text-align:center">sharedscripts</td><td style="text-align:center">åœ¨æ­¤å…³é”®å­—ä¹‹åçš„è„šæœ¬åªæ‰§è¡Œä¸€æ¬¡</td></tr><tr><td style="text-align:center">prerotate</td><td style="text-align:center">åœ¨æ—¥å¿—è½®æ›¿ä¹‹å‰æ‰§è¡Œè„šæœ¬å‘½ä»¤</td></tr><tr><td style="text-align:center">endscript</td><td style="text-align:center">åœ¨æ—¥å¿—è½®æ›¿ä¹‹åæ‰§è¡Œè„šæœ¬å‘½ä»¤</td></tr></tbody></table></div><h5 id="å°†è‡ªå·±çš„æ—¥å¿—åŠ å…¥æ—¥å¿—è½®æ›¿"><a href="#å°†è‡ªå·±çš„æ—¥å¿—åŠ å…¥æ—¥å¿—è½®æ›¿" class="headerlink" title="å°†è‡ªå·±çš„æ—¥å¿—åŠ å…¥æ—¥å¿—è½®æ›¿"></a>å°†è‡ªå·±çš„æ—¥å¿—åŠ å…¥æ—¥å¿—è½®æ›¿</h5><ol><li>ç¬¬ä¸€ç§æ–¹æ³•æ˜¯ç›´æ¥åœ¨<code>/etc/logrotate.conf</code> é…ç½®æ–‡ä»¶ä¸­å†™å…¥è¯¥æ—¥å¿—çš„è½®æ›¿ç­–ç•¥</li><li>ç¬¬äºŒç§æ–¹æ³•æ˜¯åœ¨<code>/etc/logrotate.d/</code>ç›®å½•ä¸­æ–°å»ºç«‹è¯¥æ—¥å¿—çš„è½®æ›¿æ–‡ä»¶ï¼Œåœ¨è¯¥è½®æ›¿æ–‡ä»¶ä¸­å†™å…¥æ­£ç¡®çš„è½®æ›¿ç­–ç•¥ã€‚ï¼ˆå› ä¸ºè¯¥ç›®å½•ä¸­çš„æ–‡ä»¶éƒ½ä¼šè¢«â€œincludeâ€åˆ°ä¸»é…ç½®æ–‡ä»¶ä¸­ï¼Œæ‰€ä»¥ä¹Ÿå¯ä»¥æŠŠæ—¥å¿—åŠ å…¥è½®æ›¿ï¼‰</li></ol><blockquote><p>æ¨èä½¿ç”¨ç¬¬äºŒç§æ–¹æ³•ï¼Œå› ä¸ºç³»ç»Ÿä¸­éœ€è¦è½®æ›¿çš„æ—¥å¿—éå¸¸å¤šï¼Œå¦‚æœå…¨éƒ½ç›´æ¥å†™å…¥<code>/etc/logrotate.conf</code>é…ç½®æ–‡ä»¶ï¼Œé‚£ä¹ˆè¿™ä¸ªæ–‡ä»¶çš„å¯ç®¡ç†æ€§å°±ä¼šéå¸¸å·®ï¼Œä¸åˆ©äºæ­¤æ–‡ä»¶çš„ç»´æŠ¤ã€‚</p></blockquote><h2 id="æŸ¥çœ‹å†…å­˜æ—¥å¿—"><a href="#æŸ¥çœ‹å†…å­˜æ—¥å¿—" class="headerlink" title="æŸ¥çœ‹å†…å­˜æ—¥å¿—"></a>æŸ¥çœ‹å†…å­˜æ—¥å¿—</h2><p>journalctl å¯ä»¥æŸ¥çœ‹å†…å­˜æ—¥å¿—ï¼Œè¿™é‡Œæˆ‘ä»¬çœ‹çœ‹å¸¸ç”¨çš„æŒ‡ä»¤</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">journalctl <span class="comment"># æŸ¥çœ‹å…¨éƒ¨</span></span><br><span class="line">journalctl -n 3 <span class="comment"># æŸ¥çœ‹æœ€æ–°3æ¡</span></span><br><span class="line">journalctl --since 19:00 --until 19:10:10 <span class="comment"># æŸ¥çœ‹èµ·å§‹æ—¶é—´åˆ°ç»“æŸæ—¶é—´çš„æ—¥å¿—å¯åŠ æ—¥æœŸ</span></span><br><span class="line"></span><br><span class="line">journalctl -p err <span class="comment"># æŠ¥é”™æ—¥å¿—</span></span><br><span class="line">journalctl -o verbose <span class="comment"># æ—¥å¿—è¯¦ç»†å†…å®¹</span></span><br><span class="line"></span><br><span class="line">journalctl _PID=1245 _COMM=sshd <span class="comment"># æŸ¥çœ‹åŒ…å«è¿™äº›å‚æ•°çš„æ—¥å¿—(åœ¨è¯¦ç»†æ—¥å¿—æŸ¥çœ‹)</span></span><br><span class="line">journalctl | grep sshd</span><br></pre></td></tr></table></figure><p>æ³¨æ„: journalctlæŸ¥çœ‹çš„æ˜¯å†…å­˜æ—¥å¿—ï¼Œé‡å¯æ¸…ç©º</p><h1 id="å¤‡ä»½"><a href="#å¤‡ä»½" class="headerlink" title="å¤‡ä»½"></a>å¤‡ä»½</h1><p>linuxçš„å¤‡ä»½å’Œæ¢å¤å¾ˆç®€å• ï¼Œæœ‰ä¸¤ç§æ–¹å¼</p><ol><li>æŠŠéœ€è¦çš„æ–‡ä»¶(æˆ–è€…åˆ†åŒº)ç”¨TARæ‰“åŒ…å°±è¡Œï¼Œä¸‹æ¬¡éœ€è¦æ¢å¤çš„æ—¶å€™ï¼Œå†è§£å‹å¼€è¦†ç›–å³å¯</li><li>ä½¿ç”¨dumpå’Œrestoreå‘½ä»¤</li></ol><blockquote><p>å¦‚æœlinuxä¸Šæ²¡æœ‰ dump å’Œ restore æŒ‡ä»¤ï¼Œéœ€è¦å…ˆå®‰è£…</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum -y install dump</span><br><span class="line">yum -y install restore</span><br></pre></td></tr></table></figure></blockquote><h2 id="ä½¿ç”¨dumpå®Œæˆå¤‡ä»½"><a href="#ä½¿ç”¨dumpå®Œæˆå¤‡ä»½" class="headerlink" title="ä½¿ç”¨dumpå®Œæˆå¤‡ä»½"></a>ä½¿ç”¨dumpå®Œæˆå¤‡ä»½</h2><p>dump æ”¯æŒåˆ†å·å’Œå¢é‡å¤‡ä»½(æ‰€è°“å¢é‡å¤‡ä»½æ˜¯æŒ‡å¤‡ä»½ä¸Šæ¬¡å¤‡ä»½å ä¿®æ”¹/å¢åŠ è¿‡çš„æ–‡ä»¶ï¼Œä¹Ÿç§°å·®å¼‚å¤‡ä»½)ã€‚</p><h3 id="è¯­æ³•è¯´æ˜"><a href="#è¯­æ³•è¯´æ˜" class="headerlink" title="è¯­æ³•è¯´æ˜"></a>è¯­æ³•è¯´æ˜</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">dump [ -cu] [-123456789] [ -f&lt;å¤‡ä»½åæ–‡ä»¶å&gt;] [-T&lt;æ—¥æœŸ&gt;] [ç›®å½•æˆ–æ–‡ä»¶ç³»ç»Ÿ]</span><br><span class="line">dump []-wW</span><br></pre></td></tr></table></figure><div class="table-container"><table><thead><tr><th style="text-align:center"></th><th style="text-align:center"></th></tr></thead><tbody><tr><td style="text-align:center">-c</td><td style="text-align:center">åˆ›å»ºæ–°çš„å½’æ¡£æ–‡ä»¶ï¼Œå¹¶å°†ç”±ä¸€ä¸ªæˆ–å¤šä¸ªæ–‡ä»¶å‚æ•°æ‰€æŒ‡å®šçš„å†…å®¹å†™å…¥å½’æ¡£æ–‡ä»¶çš„å¼€å¤´ã€‚</td></tr><tr><td style="text-align:center">-0123456789</td><td style="text-align:center">å¤‡ä»½çš„å±‚çº§ã€‚0ä¸ºæœ€å®Œæ•´å¤‡ä»½ï¼Œä¼šå¤‡ä»½æ‰€æœ‰æ–‡ä»¶ã€‚è‹¥æŒ‡å®š0ä»¥ä¸Šçš„å±‚çº§ï¼Œåˆ™å¤‡ä»½è‡³ä¸Šä¸€æ¬¡å¤‡ä»½ä»¥æ¥ä¿®æ”¹æˆ–æ–°å¢çš„æ–‡ä»¶ã€‚åˆ°9åï¼Œå¯ä»¥å†æ¬¡è½®æ›¿ã€‚</td></tr><tr><td style="text-align:center">-f&lt;å¤‡ä»½åæ–‡ä»¶å&gt;</td><td style="text-align:center">æŒ‡å®šå¤‡ä»½åæ–‡ä»¶å</td></tr><tr><td style="text-align:center">-j</td><td style="text-align:center">è°ƒç”¨ bzlib åº“å‹ç¼©å¤‡ä»½æ–‡ä»¶ï¼Œä¹Ÿå°±æ˜¯å°†å¤‡ä»½åçš„æ–‡ä»¶å‹ç¼©æˆ bz2æ ¼å¼ï¼Œè®©æ–‡ä»¶æ›´å°</td></tr><tr><td style="text-align:center">-T&lt;æ—¥æœŸ&gt;:</td><td style="text-align:center">æŒ‡å®šå¼€å§‹å¤‡ä»½çš„æ—¶é—´ä¸æ—¥æœŸ</td></tr><tr><td style="text-align:center">-u</td><td style="text-align:center">å¤‡ä»½å®Œæ¯•åï¼Œåœ¨/etc/dumpdaresä¸­è®°å½•å¤‡ä»½çš„æ–‡ä»¶ç³»ç»Ÿï¼Œå±‚çº§ï¼Œæ—¥æœŸä¸æ—¶é—´ç­‰ã€‚</td></tr><tr><td style="text-align:center">-t</td><td style="text-align:center">æŒ‡å®šæ–‡ä»¶åï¼Œè‹¥è¯¥æ–‡ä»¶å·²å­˜åœ¨å¤‡ä»½æ–‡ä»¶ä¸­ï¼Œåˆ™åˆ—å‡ºåç§°</td></tr><tr><td style="text-align:center">-W</td><td style="text-align:center">æ˜¾ç¤ºéœ€è¦å¤‡ä»½çš„æ–‡ä»¶åŠå…¶æœ€åä¸€æ¬¡å¤‡ä»½çš„å±‚çº§ï¼Œæ—¶é—´ ï¼Œæ—¥æœŸ</td></tr><tr><td style="text-align:center">-w</td><td style="text-align:center">ä¸-Wç±»ä¼¼ï¼Œä½†ä»…æ˜¾ç¤ºéœ€è¦å¤‡ä»½çš„æ–‡ä»¶ã€‚</td></tr></tbody></table></div><h3 id="åº”ç”¨æ¡ˆä¾‹"><a href="#åº”ç”¨æ¡ˆä¾‹" class="headerlink" title="åº”ç”¨æ¡ˆä¾‹"></a>åº”ç”¨æ¡ˆä¾‹</h3><p>å°†<code>/boot</code>åˆ†åŒºæ‰€æœ‰å†…å®¹å¤‡ä»½åˆ°<code>/opt/boot.bak0.bz2</code>æ–‡ä»¶ä¸­ï¼Œå¤‡ä»½å±‚çº§ä¸º0</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dump -0uj -f /opt/boot.bak0.bz2 /boot</span><br></pre></td></tr></table></figure><p>åœ¨<code>/boot</code>ç›®å½•ä¸‹æ–°åŠ æ–‡ä»¶ï¼Œå¤‡ä»½å±‚çº§ä¸ºâ€1â€œï¼ˆåªå¤‡ä»½ä¸Šæ¬¡ä½¿ç”¨å±‚çº§â€0â€œå¤‡ä»½åå‘ç”Ÿè¿‡æ”¹å˜çš„æ•°æ®ï¼‰</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vim /boot/hello.txt <span class="comment"># éšä¾¿åŠ å†…å®¹è¿›å»</span></span><br><span class="line">dump -1uj -f /opt/boot.bak1.bz2 /boot</span><br></pre></td></tr></table></figure><p>æ¯”è¾ƒçœ‹çœ‹è¿™æ¬¡ç”Ÿæˆçš„å¤‡ä»½æ–‡ä»¶boot.bak1.bz2æœ‰å¤šå¤§</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@itachi103 /]<span class="comment"># ll -h /opt/</span></span><br><span class="line">æ€»ç”¨é‡ 140M</span><br><span class="line">-rw-r--r--. 1 root root 140M 2æœˆ  27 14:49 boot.bak0.bz2</span><br><span class="line">-rw-r--r--. 1 root root  12K 2æœˆ  27 14:52 boot.bak1.bz2</span><br></pre></td></tr></table></figure><blockquote><p>é€šè¿‡dumpå‘½ä»¤é…åˆcrontabå¯ä»¥å®ç°æ— äººå€¼å®ˆå¤‡ä»½</p></blockquote><h3 id="dump-W"><a href="#dump-W" class="headerlink" title="dump -W"></a>dump -W</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ˜¾ç¤ºéœ€è¦å¤‡ä»½çš„æ–‡ä»¶åŠå…¶æœ€åä¸€æ¬¡å¤‡ä»½çš„å±‚çº§ï¼Œæ—¶é—´ï¼Œæ—¥æœŸ</span></span><br><span class="line">[root@itachi103 /]<span class="comment"># dump -W</span></span><br><span class="line">Last dump(s) <span class="keyword">done</span> (Dump <span class="string">&#x27;&gt;&#x27;</span> file systems):</span><br><span class="line">  /dev/sdb1(/newdisk) Last dump: never</span><br><span class="line">  /dev/sda1( /boot) Last dump: Level 1, Date Mon Feb 27 14:52:36 2023</span><br></pre></td></tr></table></figure><h3 id="æŸ¥çœ‹å¤‡ä»½æ—¶é—´æ–‡ä»¶"><a href="#æŸ¥çœ‹å¤‡ä»½æ—¶é—´æ–‡ä»¶" class="headerlink" title="æŸ¥çœ‹å¤‡ä»½æ—¶é—´æ–‡ä»¶"></a>æŸ¥çœ‹å¤‡ä»½æ—¶é—´æ–‡ä»¶</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@itachi103 /]<span class="comment"># cat /etc/dumpdates </span></span><br><span class="line">/dev/sda1 0 Mon Feb 27 14:49:22 2023 +0800</span><br><span class="line">/dev/sda1 1 Mon Feb 27 14:52:36 2023 +0800</span><br></pre></td></tr></table></figure><h3 id="æ³¨æ„"><a href="#æ³¨æ„" class="headerlink" title="æ³¨æ„"></a>æ³¨æ„</h3><p>dumpåªæœ‰å¤‡ä»½åˆ†åŒºçš„æ—¶å€™æ‰æ”¯æŒå¢é‡å¤‡ä»½ã€‚</p><p>å¦‚æœå¤‡ä»½çš„æ˜¯æ–‡ä»¶æˆ–è€…ç›®å½•ï¼Œåˆ™ä¸æ”¯æŒå¢é‡å¤‡ä»½ï¼Œå³åªèƒ½ä½¿ç”¨0çº§åˆ«çš„å¤‡ä»½ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ¡ˆä¾‹ï¼šä½¿ç”¨dumpå¤‡ä»½/etcæ•´ä¸ªç›®å½•</span></span><br><span class="line">dump -0j -f /opt/etc.bak.bz2 /etc/</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸‹é¢è¯­å¥ä¼šæŠ¥é”™ï¼šDUMP: Only level 0 dumps are allowed on a subdirectory</span></span><br><span class="line">dump -1j -f /opt/etc.bak1.bz2 /etc/</span><br></pre></td></tr></table></figure><h2 id="ä½¿ç”¨restoreæ¢å¤æ–‡ä»¶"><a href="#ä½¿ç”¨restoreæ¢å¤æ–‡ä»¶" class="headerlink" title="ä½¿ç”¨restoreæ¢å¤æ–‡ä»¶"></a>ä½¿ç”¨restoreæ¢å¤æ–‡ä»¶</h2><p>restore å‘½ä»¤ç”¨æ¥æ¢å¤å·²å¤‡ä»½çš„æ–‡ä»¶ï¼Œå¯ä»¥ä»dump ç”Ÿæˆçš„å¤‡ä»½æ–‡ä»¶ä¸­æ¢å¤åŸæ–‡ä»¶</p><h3 id="åŸºæœ¬è¯­æ³•-1"><a href="#åŸºæœ¬è¯­æ³•-1" class="headerlink" title="åŸºæœ¬è¯­æ³•"></a>åŸºæœ¬è¯­æ³•</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">restore [æ¨¡å¼é€‰é¡¹] [é€‰é¡¹]</span><br></pre></td></tr></table></figure><p>è¯´æ˜ä¸‹é¢å››ä¸ªæ¨¡å¼ä¸èƒ½æ··ç”¨ï¼Œåœ¨ä¸€æ¬¡å‘½ä»¤ä¸­ï¼Œåªèƒ½æŒ‡å®šä¸€ç§ã€‚</p><div class="table-container"><table><thead><tr><th style="text-align:center">æ¨¡å¼</th><th style="text-align:center">è¯´æ˜</th></tr></thead><tbody><tr><td style="text-align:center">-C</td><td style="text-align:center">ä½¿ç”¨å¯¹æ¯”æ¨¡å¼ï¼Œå°†å¤‡ä»½çš„æ–‡ä»¶ä¸å·²å­˜åœ¨çš„æ–‡ä»¶ç›¸äº’å¯¹æ¯”ã€‚</td></tr><tr><td style="text-align:center">-i</td><td style="text-align:center">ä½¿ç”¨äº¤äº’æ¨¡å¼ï¼Œåœ¨è¿›è¡Œè¿˜åŸæ“ä½œæ—¶ï¼ŒrestorsæŒ‡ä»¤å°†ä¾åºè¯¢é—®ç”¨æˆ·</td></tr><tr><td style="text-align:center">-r</td><td style="text-align:center">è¿›è¡Œè¿˜åŸæ¨¡å¼</td></tr><tr><td style="text-align:center">-t</td><td style="text-align:center">æŸ¥çœ‹æ¨¡å¼ï¼Œçœ‹å¤‡ä»½æ–‡ä»¶æœ‰å“ªäº›æ–‡ä»¶</td></tr></tbody></table></div><p>é€‰é¡¹å¦‚ä¸‹</p><div class="table-container"><table><thead><tr><th style="text-align:center">é€‰é¡¹</th><th style="text-align:center">è¯´æ˜</th></tr></thead><tbody><tr><td style="text-align:center">-f &lt;å¤‡ä»½è®¾å¤‡&gt;</td><td style="text-align:center">ä»æŒ‡å®šçš„æ–‡ä»¶ä¸­è¯»å–å¤‡ä»½æ•°æ®ï¼Œè¿›è¡Œè¿˜åŸæ“ä½œ</td></tr></tbody></table></div><h3 id="æ¡ˆä¾‹-1"><a href="#æ¡ˆä¾‹-1" class="headerlink" title="æ¡ˆä¾‹"></a>æ¡ˆä¾‹</h3><h5 id="æ¡ˆä¾‹1ï¼šæ¯”è¾ƒæ¨¡å¼ï¼Œæ¯”è¾ƒå¤‡ä»½æ–‡ä»¶å’ŒåŸæ–‡ä»¶çš„åŒºåˆ«"><a href="#æ¡ˆä¾‹1ï¼šæ¯”è¾ƒæ¨¡å¼ï¼Œæ¯”è¾ƒå¤‡ä»½æ–‡ä»¶å’ŒåŸæ–‡ä»¶çš„åŒºåˆ«" class="headerlink" title="æ¡ˆä¾‹1ï¼šæ¯”è¾ƒæ¨¡å¼ï¼Œæ¯”è¾ƒå¤‡ä»½æ–‡ä»¶å’ŒåŸæ–‡ä»¶çš„åŒºåˆ«"></a>æ¡ˆä¾‹1ï¼šæ¯”è¾ƒæ¨¡å¼ï¼Œæ¯”è¾ƒå¤‡ä»½æ–‡ä»¶å’ŒåŸæ–‡ä»¶çš„åŒºåˆ«</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[root@itachi103 /]<span class="comment"># mv /boot/hello.txt /boot/helloxxx.txt</span></span><br><span class="line">[root@itachi103 opt]<span class="comment"># restore -C -f /opt/boot.bak1.bz2 </span></span><br><span class="line">Dump tape is compressed.</span><br><span class="line">Dump   <span class="built_in">date</span>: Mon Feb 27 14:52:36 2023</span><br><span class="line">Dumped from: Mon Feb 27 14:49:22 2023</span><br><span class="line">Level 1 dump of /boot on itachi103:/dev/sda1</span><br><span class="line">Label: none</span><br><span class="line">filesys = /boot</span><br><span class="line">restore: unable to <span class="built_in">stat</span> ./hello.txt: No such file or directory</span><br><span class="line">Some files were modified!  1 compare errors</span><br><span class="line"></span><br><span class="line">[root@itachi103 opt]<span class="comment"># mv /boot/helloxxx.txt /boot/hello.txt</span></span><br><span class="line">[root@itachi103 opt]<span class="comment"># restore -C -f /opt/boot.bak1.bz2 </span></span><br><span class="line">Dump tape is compressed.</span><br><span class="line">Dump   <span class="built_in">date</span>: Mon Feb 27 14:52:36 2023</span><br><span class="line">Dumped from: Mon Feb 27 14:49:22 2023</span><br><span class="line">Level 1 dump of /boot on itachi103:/dev/sda1</span><br><span class="line">Label: none</span><br><span class="line">filesys = /boot</span><br></pre></td></tr></table></figure><h5 id="æ¡ˆä¾‹2ï¼šæŸ¥çœ‹æ¨¡å¼ï¼ŒæŸ¥çœ‹å¤‡ä»½æ–‡ä»¶æœ‰å“ªäº›æ•°æ®-æ–‡ä»¶"><a href="#æ¡ˆä¾‹2ï¼šæŸ¥çœ‹æ¨¡å¼ï¼ŒæŸ¥çœ‹å¤‡ä»½æ–‡ä»¶æœ‰å“ªäº›æ•°æ®-æ–‡ä»¶" class="headerlink" title="æ¡ˆä¾‹2ï¼šæŸ¥çœ‹æ¨¡å¼ï¼ŒæŸ¥çœ‹å¤‡ä»½æ–‡ä»¶æœ‰å“ªäº›æ•°æ®/æ–‡ä»¶"></a>æ¡ˆä¾‹2ï¼šæŸ¥çœ‹æ¨¡å¼ï¼ŒæŸ¥çœ‹å¤‡ä»½æ–‡ä»¶æœ‰å“ªäº›æ•°æ®/æ–‡ä»¶</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@itachi103 opt]<span class="comment"># restore -t -f /opt/boot.bak1.bz2 </span></span><br><span class="line">Dump tape is compressed.</span><br><span class="line">Dump   <span class="built_in">date</span>: Mon Feb 27 14:52:36 2023</span><br><span class="line">Dumped from: Mon Feb 27 14:49:22 2023</span><br><span class="line">Level 1 dump of /boot on itachi103:/dev/sda1</span><br><span class="line">Label: none</span><br><span class="line">         2.</span><br><span class="line">       350./hello.txt</span><br></pre></td></tr></table></figure><h5 id="æ¡ˆä¾‹3ï¼šè¿˜åŸæ¨¡å¼"><a href="#æ¡ˆä¾‹3ï¼šè¿˜åŸæ¨¡å¼" class="headerlink" title="æ¡ˆä¾‹3ï¼šè¿˜åŸæ¨¡å¼"></a>æ¡ˆä¾‹3ï¼šè¿˜åŸæ¨¡å¼</h5><p>æ³¨æ„ç»†èŠ‚ï¼šå¦‚æœä½ æœ‰å¢é‡å¤‡ä»½ï¼Œéœ€è¦æŠŠå¢é‡å¤‡ä»½æ–‡ä»¶ä¹Ÿè¿›è¡Œæ¢å¤ ï¼Œæœ‰å‡ ä¸ªå¢é‡å¤‡ä»½æ–‡ä»¶ï¼Œå°±è¦æ¢å¤å‡ ä¸ªï¼ŒæŒ‰é¡ºåºæ¥æ¢å¤å³å¯ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> /opt/boottmp</span><br><span class="line"><span class="built_in">cd</span> /opt/boottmp</span><br><span class="line">restore -r -f /opt/boot.bak0.bz2 <span class="comment"># æ¢å¤åˆ°ç¬¬1æ¬¡å®Œå…¨å¤‡ä»½çŠ¶æ€</span></span><br><span class="line">restore -r -f /opt/boot.bak1.bz2 <span class="comment"># æ¢å¤åˆ°ç¬¬2æ¬¡å¢é‡å¤‡ä»½çŠ¶æ€</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> è¿ç»´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> æœåŠ¡å™¨ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>dp</title>
      <link href="/post/6.html"/>
      <url>/post/6.html</url>
      
        <content type="html"><![CDATA[<h1 id="å…¥é—¨"><a href="#å…¥é—¨" class="headerlink" title="å…¥é—¨"></a>å…¥é—¨</h1><h4 id="70-çˆ¬æ¥¼æ¢¯"><a href="#70-çˆ¬æ¥¼æ¢¯" class="headerlink" title="70. çˆ¬æ¥¼æ¢¯"></a><a href="https://leetcode.cn/problems/climbing-stairs/">70. çˆ¬æ¥¼æ¢¯</a></h4><p>å‡è®¾ä½ æ­£åœ¨çˆ¬æ¥¼æ¢¯ã€‚éœ€è¦ <code>n</code> é˜¶ä½ æ‰èƒ½åˆ°è¾¾æ¥¼é¡¶ã€‚</p><p>æ¯æ¬¡ä½ å¯ä»¥çˆ¬ <code>1</code> æˆ– <code>2</code> ä¸ªå°é˜¶ã€‚ä½ æœ‰å¤šå°‘ç§ä¸åŒçš„æ–¹æ³•å¯ä»¥çˆ¬åˆ°æ¥¼é¡¶å‘¢ï¼Ÿ</p><blockquote><p>ç¤ºä¾‹1ï¼š<br>è¾“å…¥ï¼šn = 2<br>è¾“å‡ºï¼š2<br>è§£é‡Šï¼šæœ‰ä¸¤ç§æ–¹æ³•å¯ä»¥çˆ¬åˆ°æ¥¼é¡¶ã€‚</p><ol><li>1 é˜¶ + 1 é˜¶</li><li>2 é˜¶</li></ol></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">climbStairs</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (n==<span class="number">1</span>) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        <span class="type">int</span>[] dp = <span class="keyword">new</span> <span class="title class_">int</span>[n+<span class="number">1</span>];</span><br><span class="line">        dp[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">        dp[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">2</span>; i &lt;= n; i++) &#123;</span><br><span class="line">            dp[i] = dp[i-<span class="number">1</span>] + dp[i-<span class="number">2</span>];</span><br><span class="line">            <span class="comment">// System.out.print(dp[i] + &quot; &quot;);</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dp[n];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    1.å«ä¹‰ï¼šçˆ¬åˆ°iå±‚æœ‰dp[i]ç§æ–¹æ³•ã€‚</span></span><br><span class="line"><span class="comment">    2.é€’æ¨å¼ï¼šdp[i] =  dp[i-1] + dp[i-2]</span></span><br><span class="line"><span class="comment">    3.åˆå§‹åŒ–ï¼šdp[0] = 1 dp[1] = 1 dp[2] = 2</span></span><br><span class="line"><span class="comment">    4.è®¡ç®—é¡ºåºï¼šä»å‰å¾€å</span></span><br><span class="line"><span class="comment">    5.ä¸¾ä¾‹ï¼šn=5</span></span><br><span class="line"><span class="comment">      dp[i]</span></span><br><span class="line"><span class="comment">    1   1</span></span><br><span class="line"><span class="comment">    2   2</span></span><br><span class="line"><span class="comment">    3   3</span></span><br><span class="line"><span class="comment">    4   5</span></span><br><span class="line"><span class="comment">    5   8</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><h4 id="746-ä½¿ç”¨æœ€å°èŠ±è´¹çˆ¬æ¥¼æ¢¯"><a href="#746-ä½¿ç”¨æœ€å°èŠ±è´¹çˆ¬æ¥¼æ¢¯" class="headerlink" title="746. ä½¿ç”¨æœ€å°èŠ±è´¹çˆ¬æ¥¼æ¢¯"></a><a href="https://leetcode.cn/problems/min-cost-climbing-stairs/">746. ä½¿ç”¨æœ€å°èŠ±è´¹çˆ¬æ¥¼æ¢¯</a></h4><p>ç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ cost ï¼Œå…¶ä¸­ cost[i] æ˜¯ä»æ¥¼æ¢¯ç¬¬ i ä¸ªå°é˜¶å‘ä¸Šçˆ¬éœ€è¦æ”¯ä»˜çš„è´¹ç”¨ã€‚ä¸€æ—¦ä½ æ”¯ä»˜æ­¤è´¹ç”¨ï¼Œå³å¯é€‰æ‹©å‘ä¸Šçˆ¬ä¸€ä¸ªæˆ–è€…ä¸¤ä¸ªå°é˜¶ã€‚</p><p>ä½ å¯ä»¥é€‰æ‹©ä»ä¸‹æ ‡ä¸º 0 æˆ–ä¸‹æ ‡ä¸º 1 çš„å°é˜¶å¼€å§‹çˆ¬æ¥¼æ¢¯ã€‚</p><p>è¯·ä½ è®¡ç®—å¹¶è¿”å›è¾¾åˆ°æ¥¼æ¢¯é¡¶éƒ¨çš„æœ€ä½èŠ±è´¹ã€‚</p><blockquote><p>ç¤ºä¾‹1ï¼š</p><p>è¾“å…¥ï¼šcost = [10,15,20]<br>è¾“å‡ºï¼š15<br>è§£é‡Šï¼šä½ å°†ä»ä¸‹æ ‡ä¸º 1 çš„å°é˜¶å¼€å§‹ã€‚</p><ul><li>æ”¯ä»˜ 15 ï¼Œå‘ä¸Šçˆ¬ä¸¤ä¸ªå°é˜¶ï¼Œåˆ°è¾¾æ¥¼æ¢¯é¡¶éƒ¨ã€‚ </li></ul><p>æ€»èŠ±è´¹ä¸º 15 ã€‚</p><p>ç¤ºä¾‹2ï¼š</p><p>è¾“å…¥ï¼šcost = [1,100,1,1,1,100,1,1,100,1]<br>è¾“å‡ºï¼š6<br>è§£é‡Šï¼šä½ å°†ä»ä¸‹æ ‡ä¸º 0 çš„å°é˜¶å¼€å§‹ã€‚</p><ul><li>æ”¯ä»˜ 1 ï¼Œå‘ä¸Šçˆ¬ä¸¤ä¸ªå°é˜¶ï¼Œåˆ°è¾¾ä¸‹æ ‡ä¸º 2 çš„å°é˜¶ã€‚</li><li>æ”¯ä»˜ 1 ï¼Œå‘ä¸Šçˆ¬ä¸¤ä¸ªå°é˜¶ï¼Œåˆ°è¾¾ä¸‹æ ‡ä¸º 4 çš„å°é˜¶ã€‚</li><li>æ”¯ä»˜ 1 ï¼Œå‘ä¸Šçˆ¬ä¸¤ä¸ªå°é˜¶ï¼Œåˆ°è¾¾ä¸‹æ ‡ä¸º 6 çš„å°é˜¶ã€‚</li><li>æ”¯ä»˜ 1 ï¼Œå‘ä¸Šçˆ¬ä¸€ä¸ªå°é˜¶ï¼Œåˆ°è¾¾ä¸‹æ ‡ä¸º 7 çš„å°é˜¶ã€‚</li><li>æ”¯ä»˜ 1 ï¼Œå‘ä¸Šçˆ¬ä¸¤ä¸ªå°é˜¶ï¼Œåˆ°è¾¾ä¸‹æ ‡ä¸º 9 çš„å°é˜¶ã€‚</li><li>æ”¯ä»˜ 1 ï¼Œå‘ä¸Šçˆ¬ä¸€ä¸ªå°é˜¶ï¼Œåˆ°è¾¾æ¥¼æ¢¯é¡¶éƒ¨ã€‚<br>æ€»èŠ±è´¹ä¸º 6 ã€‚</li></ul></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">minCostClimbingStairs</span><span class="params">(<span class="type">int</span>[] cost)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> cost.length;</span><br><span class="line">        <span class="type">int</span>[] dp = <span class="keyword">new</span> <span class="title class_">int</span>[n+<span class="number">1</span>];</span><br><span class="line">        dp[<span class="number">0</span>] = dp[<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">2</span>; i &lt;= n; i++) &#123;</span><br><span class="line">            dp[i] = Math.min(dp[i-<span class="number">1</span>] + cost[i-<span class="number">1</span>], dp[i-<span class="number">2</span>] + cost[i-<span class="number">2</span>]);</span><br><span class="line">            <span class="comment">// System.out.print(dp[i] + &quot; &quot;);</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dp[n];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    1.å«ä¹‰ï¼šçˆ¬åˆ°ç¬¬iå±‚ï¼Œæœ€å°èŠ±è´¹æ˜¯dp[i]</span></span><br><span class="line"><span class="comment">    2.é€’æ¨å¼ï¼šdp[i] = min(dp[i-1] + cost[i-1], dp[i-2] + cost[i-2])</span></span><br><span class="line"><span class="comment">    3.åˆå§‹åŒ–ï¼šdp[0] = dp[1] = 0 è¡¨ç¤ºä¸éœ€è¦èŠ±è´¹å°±èƒ½åˆ°è¾¾ç¬¬0/1å±‚</span></span><br><span class="line"><span class="comment">    4.è®¡ç®—é¡ºåºï¼šä»å‰å¾€å</span></span><br><span class="line"><span class="comment">    5.ä¸¾ä¾‹ï¼šcost = [1,100,1,1,1,100,1,1,100,1]</span></span><br><span class="line"><span class="comment">                    dp[i]</span></span><br><span class="line"><span class="comment">    cost[0]=1         0</span></span><br><span class="line"><span class="comment">    cost[1]=100       0</span></span><br><span class="line"><span class="comment">    cost[2]=1         1</span></span><br><span class="line"><span class="comment">    cost[3]=1         2 </span></span><br><span class="line"><span class="comment">    cost[4]=1         2</span></span><br><span class="line"><span class="comment">    cost[5]=100       3</span></span><br><span class="line"><span class="comment">    cost[6]=1         3</span></span><br><span class="line"><span class="comment">    cost[7]=1         4</span></span><br><span class="line"><span class="comment">    cost[8]=100       4</span></span><br><span class="line"><span class="comment">    cost[9]=1         5</span></span><br><span class="line"><span class="comment">    n = 10            6</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><h4 id="62-ä¸åŒè·¯å¾„"><a href="#62-ä¸åŒè·¯å¾„" class="headerlink" title="62. ä¸åŒè·¯å¾„"></a><a href="https://leetcode.cn/problems/unique-paths/">62. ä¸åŒè·¯å¾„</a></h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">uniquePaths</span><span class="params">(<span class="type">int</span> m, <span class="type">int</span> n)</span> &#123;</span><br><span class="line">        <span class="type">int</span>[][] dp = <span class="keyword">new</span> <span class="title class_">int</span>[m][n];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; m; i++) &#123;</span><br><span class="line">            dp[i][<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">            dp[<span class="number">0</span>][i] = <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; m; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">1</span>; j &lt; n; j++) &#123;</span><br><span class="line">                dp[i][j] = dp[i-<span class="number">1</span>][j] + dp[i][j-<span class="number">1</span>];</span><br><span class="line">                <span class="comment">// System.out.print(dp[i][j] + &quot; &quot;);</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// System.out.println();</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dp[m-<span class="number">1</span>][n-<span class="number">1</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    1.å«ä¹‰ï¼šåˆ°è¾¾åæ ‡ä¸º(i,j)æœ‰dp[i][j]æ¡ä¸åŒè·¯å¾„</span></span><br><span class="line"><span class="comment">    2.é€’æ¨å¼ï¼šdp[i][j] = dp[i-1][j] + dp[i][j-1]</span></span><br><span class="line"><span class="comment">    3.åˆå§‹åŒ–ï¼šdp[0][i] = dp[i][0] = 1</span></span><br><span class="line"><span class="comment">    4.è®¡ç®—é¡ºåºï¼šå†…å¤–å±‚éƒ½é¡ºåº</span></span><br><span class="line"><span class="comment">    5.ä¸¾ä¾‹ï¼šm = 3, n = 7</span></span><br><span class="line"><span class="comment">        1  2  3  4  5  6  7</span></span><br><span class="line"><span class="comment">    1   1  1  1  1  1  1  1</span></span><br><span class="line"><span class="comment">    2   1  2  3  4  5  6  7 </span></span><br><span class="line"><span class="comment">    3   1  3  6  10 15 21 28</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><h4 id="63-ä¸åŒè·¯å¾„-II"><a href="#63-ä¸åŒè·¯å¾„-II" class="headerlink" title="63. ä¸åŒè·¯å¾„ II"></a><a href="https://leetcode.cn/problems/unique-paths-ii/">63. ä¸åŒè·¯å¾„ II</a></h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">uniquePathsWithObstacles</span><span class="params">(<span class="type">int</span>[][] obstacleGrid)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> obstacleGrid.length, m = obstacleGrid[<span class="number">0</span>].length;</span><br><span class="line">        <span class="type">int</span>[][] dp = <span class="keyword">new</span> <span class="title class_">int</span>[n][m];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">            dp[i][<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span> (obstacleGrid[i][<span class="number">0</span>] == <span class="number">1</span>) &#123;</span><br><span class="line">                dp[i][<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; m; j++) &#123;</span><br><span class="line">            dp[<span class="number">0</span>][j] = <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span> (obstacleGrid[<span class="number">0</span>][j] == <span class="number">1</span>) &#123;</span><br><span class="line">                dp[<span class="number">0</span>][j] = <span class="number">0</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; n; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">1</span>; j &lt; m; j++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (obstacleGrid[i][j] == <span class="number">1</span>) &#123;</span><br><span class="line">                    dp[i][j] = <span class="number">0</span>;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    dp[i][j] = dp[i-<span class="number">1</span>][j] + dp[i][j-<span class="number">1</span>];</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// System.out.print(dp[i][j] + &quot; &quot;);</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// System.out.println();</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dp[n-<span class="number">1</span>][m-<span class="number">1</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    1.å«ä¹‰ï¼šåˆ°è¾¾åæ ‡ä¸º(i,j)æœ‰dp[i][j]æ¡ä¸åŒè·¯å¾„</span></span><br><span class="line"><span class="comment">    2.é€’æ¨å¼ï¼š</span></span><br><span class="line"><span class="comment">        å¦‚æœ(i,j)ä¸æ˜¯éšœç¢ï¼šdp[i][j] = dp[i-1][j] + dp[i][j-1]</span></span><br><span class="line"><span class="comment">        å¦‚æœ(i,j)æ˜¯éšœç¢ï¼š dp[i][j] = 0</span></span><br><span class="line"><span class="comment">    3.åˆå§‹åŒ–ï¼š</span></span><br><span class="line"><span class="comment">        ç¬¬ä¸€è¡Œï¼šéšœç¢å·¦è¾¹çš„åˆå§‹åŒ–ä¸º1ï¼Œéšœç¢å³è¾¹çš„åˆå§‹åŒ–ä¸º0</span></span><br><span class="line"><span class="comment">        ç¬¬ä¸€åˆ—ï¼šéšœç¢ä¸Šè¾¹çš„åˆå§‹åŒ–ä¸º1ï¼Œéšœç¢ä¸‹è¾¹çš„åˆå§‹åŒ–ä¸º0</span></span><br><span class="line"><span class="comment">    4.è®¡ç®—é¡ºåºï¼šå†…å¤–å±‚éƒ½é¡ºåº</span></span><br><span class="line"><span class="comment">    5.ä¸¾ä¾‹ï¼š</span></span><br><span class="line"><span class="comment">    [0,0,0]</span></span><br><span class="line"><span class="comment">    [0,1,0]</span></span><br><span class="line"><span class="comment">    [0,0,0]</span></span><br><span class="line"><span class="comment">        1  2  3</span></span><br><span class="line"><span class="comment">    1   1  1  1</span></span><br><span class="line"><span class="comment">    2   1  0  1</span></span><br><span class="line"><span class="comment">    3   1  1  2</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><h4 id="343-æ•´æ•°æ‹†åˆ†"><a href="#343-æ•´æ•°æ‹†åˆ†" class="headerlink" title="343. æ•´æ•°æ‹†åˆ†"></a><a href="https://leetcode.cn/problems/integer-break/">343. æ•´æ•°æ‹†åˆ†</a></h4><p>ç»™å®šä¸€ä¸ªæ­£æ•´æ•° <code>n</code> ï¼Œå°†å…¶æ‹†åˆ†ä¸º <code>k</code> ä¸ª <strong>æ­£æ•´æ•°</strong> çš„å’Œï¼ˆ <code>k &gt;= 2</code> ï¼‰ï¼Œå¹¶ä½¿è¿™äº›æ•´æ•°çš„ä¹˜ç§¯æœ€å¤§åŒ–ã€‚</p><p>è¿”å› <em>ä½ å¯ä»¥è·å¾—çš„æœ€å¤§ä¹˜ç§¯</em> ã€‚</p><blockquote><p>ç¤ºä¾‹1ï¼š<br>è¾“å…¥: n = 2<br>è¾“å‡º: 1<br>è§£é‡Š: 2 = 1 + 1, 1 Ã— 1 = 1ã€‚</p><p>ç¤ºä¾‹2ï¼š</p><p>è¾“å…¥: n = 10<br>è¾“å‡º: 36<br>è§£é‡Š: 10 = 3 + 3 + 4, 3 Ã— 3 Ã— 4 = 36ã€‚</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">~~~</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># å®Œå…¨èƒŒåŒ…é—®é¢˜</span><br><span class="line"></span><br><span class="line">#### <span class="number">518.</span>é›¶é’±å…‘æ¢II</span><br><span class="line"></span><br><span class="line">[é¢˜ç›®é“¾æ¥](https:<span class="comment">//leetcode-cn.com/problems/coin-change-2/)</span></span><br><span class="line"></span><br><span class="line">~~~java</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">change</span><span class="params">(<span class="type">int</span> amount, <span class="type">int</span>[] coins)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> coins.length;</span><br><span class="line">        <span class="type">int</span>[] dp = <span class="keyword">new</span> <span class="title class_">int</span>[amount+<span class="number">1</span>];</span><br><span class="line">        dp[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> coins[i]; j &lt;= amount; j++) &#123;</span><br><span class="line">                dp[j] = dp[j] + dp[j-coins[i]];</span><br><span class="line">                <span class="comment">// System.out.print(dp[j] + &quot; &quot;);</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// System.out.println();</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dp[amount];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    1.dp[j]å«ä¹‰ï¼šå®¹é‡ä¸ºjçš„èƒŒåŒ…ï¼Œè£…æ»¡æ­¤èƒŒåŒ…çš„æ–¹å¼æœ‰dp[j]ç§</span></span><br><span class="line"><span class="comment">    2.é€’æ¨å¼ï¼šdp[j] = dp[j] + dp[j-weight[i]]</span></span><br><span class="line"><span class="comment">    dp[j]æ˜¯ä¸é€‰ç‰©å“j  dp[j-weight[i]]é€‰ç‰©å“j</span></span><br><span class="line"><span class="comment">    3.åˆå§‹åŒ–ï¼šdp[0]=1ï¼Œè¡¨ç¤ºè£…æ»¡å®¹é‡0çš„èƒŒåŒ…ï¼Œæœ‰ä¸€ç§æ–¹å¼ï¼Œé‚£å°±æ˜¯ä»€ä¹ˆä¹Ÿä¸è£…</span></span><br><span class="line"><span class="comment">    4.é¡ºåºï¼šå®Œå…¨èƒŒåŒ…çš„ç»„åˆé—®é¢˜ï¼Œå¤–å±‚å…ˆéå†ç‰©å“ï¼Œå†…å±‚éå†èƒŒåŒ…ï¼Œå†…å±‚å¾ªç¯ä»å°åˆ°å¤§ï¼Œå› ä¸ºç‰©å“æ˜¯å¯ä»¥æ·»åŠ å¤šæ¬¡çš„</span></span><br><span class="line"><span class="comment">    5.ä¸¾ä¾‹ï¼šamount=5ï¼Œcoins=[1,2,5]</span></span><br><span class="line"><span class="comment">    i  j 0 1 2 3 4 5</span></span><br><span class="line"><span class="comment">    0    1 1 1 1 1 1</span></span><br><span class="line"><span class="comment">    1    1 1 2 2 3 3</span></span><br><span class="line"><span class="comment">    2    1 1 2 2 3 4</span></span><br><span class="line"><span class="comment">    </span></span><br><span class="line"><span class="comment">    å¯¹äºä»¥ä¸Šä¸¾ä¾‹ï¼Œç¨‹åºè¿è¡Œçš„è¾“å‡ºå¦‚ä¸‹ï¼š</span></span><br><span class="line"><span class="comment">    1 1 1 1 1 </span></span><br><span class="line"><span class="comment">      2 2 3 3 </span></span><br><span class="line"><span class="comment">            4 </span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><blockquote><p><strong>æ€»ç»“</strong></p><ul><li><p>å¦‚æœæ±‚ç»„åˆæ•°å°±æ˜¯å¤–å±‚forå¾ªç¯éå†ç‰©å“ï¼Œå†…å±‚foréå†èƒŒåŒ…ã€‚</p></li><li><p>å¦‚æœæ±‚æ’åˆ—æ•°å°±æ˜¯å¤–å±‚foréå†èƒŒåŒ…ï¼Œå†…å±‚forå¾ªç¯éå†ç‰©å“ã€‚</p><p>ï¼ˆæœ¬é—®é¢˜å±äºç»„åˆæ•°é—®é¢˜ï¼‰</p></li></ul></blockquote><h4 id="377-ç»„åˆæ€»å’ŒIVâ­â­â­"><a href="#377-ç»„åˆæ€»å’ŒIVâ­â­â­" class="headerlink" title="377.ç»„åˆæ€»å’ŒIVâ­â­â­"></a>377.ç»„åˆæ€»å’ŒIVâ­â­â­</h4><p><a href="https://leetcode-cn.com/problems/combination-sum-iv/">é¢˜ç›®é“¾æ¥</a></p><blockquote><p>æ­¤é¢˜ç›®åä¸ºç»„åˆï¼Œå®åˆ™æ˜¯æ’åˆ—é—®é¢˜</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">combinationSum4</span><span class="params">(<span class="type">int</span>[] nums, <span class="type">int</span> target)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> nums.length;</span><br><span class="line">        <span class="type">int</span>[] dp = <span class="keyword">new</span> <span class="title class_">int</span>[target + <span class="number">1</span>];</span><br><span class="line">        dp[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt;= target; j++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (j &gt;= nums[i]) &#123;</span><br><span class="line">                    dp[j] = dp[j] + dp[j - nums[i]];</span><br><span class="line">                    <span class="comment">// System.out.print(dp[j] + &quot; &quot;);</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// System.out.println();</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dp[target];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    1.dp[j]ï¼šè¡¨ç¤ºå‡‘æˆå®¹é‡ä¸ºjçš„èƒŒåŒ…çš„æ’åˆ—ä¸ªæ•°ä¸ºdp[j]</span></span><br><span class="line"><span class="comment">    2.é€’æ¨å¼ï¼šdp[j] = dp[j] + dp[j-nums[i]]</span></span><br><span class="line"><span class="comment">    3.åˆå§‹åŒ–ï¼šdp[0] = 1</span></span><br><span class="line"><span class="comment">    4.éå†é¡ºåºï¼šå®Œå…¨èƒŒåŒ…æ’åˆ—é—®é¢˜ï¼Œå¤–å±‚å…ˆéå†èƒŒåŒ…ï¼Œå†…å±‚éå†ç‰©å“ï¼Œå†…å±‚ä»å°åˆ°å¤§</span></span><br><span class="line"><span class="comment">    5.ä¸¾ä¾‹ï¼šnums = [1,2,3], target = 4</span></span><br><span class="line"><span class="comment">        j 0 1 2 3 4</span></span><br><span class="line"><span class="comment">    i</span></span><br><span class="line"><span class="comment">    0     1 1 1 2 4</span></span><br><span class="line"><span class="comment">    1         2 3 6 </span></span><br><span class="line"><span class="comment">    2           4 7</span></span><br><span class="line"><span class="comment">    å¯¹äºä»¥ä¸Šä¸¾ä¾‹ï¼Œç¨‹åºè¿è¡Œçš„è¾“å‡ºå¦‚ä¸‹ï¼š</span></span><br><span class="line"><span class="comment">    1 </span></span><br><span class="line"><span class="comment">    1 2 </span></span><br><span class="line"><span class="comment">    2 3 4 </span></span><br><span class="line"><span class="comment">    4 6 7 </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">å¦‚æœæŠŠé¢˜ç›®æ”¹æˆç»„åˆé—®é¢˜ï¼Œå¤–å±‚å…ˆéå†ç‰©å“ï¼Œå†…å±‚éå†èƒŒåŒ…ï¼Œä¸¾ä¾‹å¦‚ä¸‹ï¼š</span></span><br><span class="line"><span class="comment">        j 0 1 2 3 4</span></span><br><span class="line"><span class="comment">    i</span></span><br><span class="line"><span class="comment">    0     1 1 1 1 1</span></span><br><span class="line"><span class="comment">    1         2 2 3 </span></span><br><span class="line"><span class="comment">    2           3 4</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><p><img src="http://cdn.leef.fun/typora/s3/img/å®Œå…¨èƒŒåŒ…ä¹‹æ’åˆ—-ç»„åˆæ€»å’Œ4.jpg" alt="å®Œå…¨èƒŒåŒ…ä¹‹æ’åˆ—-ç»„åˆæ€»å’Œ4"></p><p><img src="http://cdn.leef.fun/typora/s3/img/å®Œå…¨èƒŒåŒ…ä¹‹ç»„åˆ-ç»„åˆæ€»å’Œ4.jpg" alt="å®Œå…¨èƒŒåŒ…ä¹‹ç»„åˆ-ç»„åˆæ€»å’Œ4"></p><blockquote><p>å¦‚æœæœ¬é¢˜è¦æŠŠæ’åˆ—éƒ½åˆ—å‡ºæ¥çš„è¯ï¼Œåªèƒ½ä½¿â½¤å›æº¯ç®—æ³•çˆ†æœã€‚</p></blockquote><h4 id="322-é›¶é’±å…‘æ¢"><a href="#322-é›¶é’±å…‘æ¢" class="headerlink" title="322.é›¶é’±å…‘æ¢"></a>322.é›¶é’±å…‘æ¢</h4><p><a href="https://leetcode.cn/problems/coin-change/">é¢˜ç›®é“¾æ¥</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">coinChange</span><span class="params">(<span class="type">int</span>[] coins, <span class="type">int</span> amount)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> coins.length;</span><br><span class="line">        <span class="type">int</span>[] dp = <span class="keyword">new</span> <span class="title class_">int</span>[amount+<span class="number">1</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= amount; i++) &#123;</span><br><span class="line">            dp[i] = Integer.MAX_VALUE;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt;= amount; j++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (j &gt;= coins[i]) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (dp[j-coins[i]] == Integer.MAX_VALUE) &#123;</span><br><span class="line">                        <span class="keyword">continue</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    dp[j] = Math.min(dp[j], dp[j-coins[i]] + <span class="number">1</span>);</span><br><span class="line">                    <span class="comment">// System.out.print(dp[j] + &quot; &quot;);</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// System.out.println();</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dp[amount] == Integer.MAX_VALUE ? -<span class="number">1</span> : dp[amount];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    1. dp[j]ï¼šè£…æ»¡å®¹é‡ä¸ºjçš„èƒŒåŒ…çš„æœ€å°ç¡¬å¸æ•°ä¸ºdp[j]</span></span><br><span class="line"><span class="comment">    2. é€’æ¨å¼ï¼šdp[j] = min(dp[j],dp[j-coins[i]+1])</span></span><br><span class="line"><span class="comment">    3. åˆå§‹åŒ–ï¼šdp[0] = 0 è¡¨ç¤ºè£…æ»¡å®¹é‡ä¸º0çš„èƒŒåŒ…çš„æœ€å°ç¡¬å¸æ•°æ˜¯0ä¸ªç¡¬å¸ï¼Œ å…¶ä»–åˆå§‹åŒ–ä¸ºæ­£æ— ç©·</span></span><br><span class="line"><span class="comment">    4. éå†é¡ºåºï¼šå¤–å±‚å…ˆéå†èƒŒåŒ…ï¼›å†…å±‚éå†ç‰©å“ï¼Œä»å°åˆ°å¤§</span></span><br><span class="line"><span class="comment">    5. ä¸¾ä¾‹ï¼šcoins = [1, 2, 5], amount = 11</span></span><br><span class="line"><span class="comment">            0 1 2 3 4 5 6 7 8 9 10 11</span></span><br><span class="line"><span class="comment">coins[0]=1  0 1 2 2 3 3 2 3 3 4 4  3 </span></span><br><span class="line"><span class="comment">coins[1]=2      1 2 2 3 2 2 3 3 4  3</span></span><br><span class="line"><span class="comment">coins[2]=5            1 2 2 3 3 2  3</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">æ ‡å‡†è¾“å‡ºä¸ºï¼š</span></span><br><span class="line"><span class="comment">1 </span></span><br><span class="line"><span class="comment">2 1 </span></span><br><span class="line"><span class="comment">2 2 </span></span><br><span class="line"><span class="comment">3 2 </span></span><br><span class="line"><span class="comment">3 3 1 </span></span><br><span class="line"><span class="comment">2 2 2 </span></span><br><span class="line"><span class="comment">3 2 2 </span></span><br><span class="line"><span class="comment">3 3 3 </span></span><br><span class="line"><span class="comment">4 3 3 </span></span><br><span class="line"><span class="comment">4 4 2 </span></span><br><span class="line"><span class="comment">3 3 3 </span></span><br><span class="line"><span class="comment">å’Œé¢„æµ‹çš„ä¸€æ¨¡ä¸€æ ·ï¼ï¼ï¼</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">ä¸¾ä¾‹2ï¼šcoins = [2], amount = 3</span></span><br><span class="line"><span class="comment">            0 1         2   3 </span></span><br><span class="line"><span class="comment">coins[0]=2  0 maxvalue  1   maxvalue</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure><blockquote><p><strong>æ€»ç»“</strong></p><p><strong>518.é›¶é’±å…‘æ¢II</strong> ä¸­æ±‚çš„æ˜¯ç»„åˆæ•°ï¼Œ<strong>377. ç»„åˆæ€»å’Œ â…£</strong> ä¸­æ±‚çš„æ˜¯æ’åˆ—æ•°ã€‚ </p><p>â½½æœ¬é¢˜æ˜¯è¦æ±‚æœ€å°‘ç¡¬å¸æ•°é‡ï¼Œç¡¬å¸æ˜¯ç»„åˆæ•°è¿˜æ˜¯æ’åˆ—æ•°éƒ½â½†æ‰€è°“ï¼æ‰€ä»¥ä¸¤ä¸ªforå¾ªç¯å…ˆåé¡ºåºæ€æ ·éƒ½å¯ä»¥ï¼</p></blockquote><h4 id="279-å®Œå…¨å¹³æ–¹æ•°"><a href="#279-å®Œå…¨å¹³æ–¹æ•°" class="headerlink" title="279.å®Œå…¨å¹³æ–¹æ•°"></a>279.å®Œå…¨å¹³æ–¹æ•°</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">numSquares</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">x</span> <span class="operator">=</span> (<span class="type">int</span>)Math.sqrt(n);</span><br><span class="line">        <span class="type">int</span>[] dp = <span class="keyword">new</span> <span class="title class_">int</span>[n + <span class="number">1</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">            dp[i] = Integer.MAX_VALUE;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= x; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt;= n; j++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (j &gt;= i * i) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (dp[j - i * i] == Integer.MAX_VALUE) &#123;</span><br><span class="line">                        <span class="keyword">continue</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    dp[j] = Math.min(dp[j], dp[j - i * i] + <span class="number">1</span>);</span><br><span class="line">                    <span class="comment">// System.out.print(dp[j] + &quot; &quot;);</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// System.out.println();</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dp[n] == Integer.MAX_VALUE ? -<span class="number">1</span> : dp[n];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">values[] = &#123;1Â², 2Â², 3Â², ... , xÂ²&#125; xä¸ºnçš„å¼€å¹³æ–¹</span></span><br><span class="line"><span class="comment">èƒŒåŒ…æ€»é‡é‡ä¸ºn</span></span><br><span class="line"><span class="comment">æœ¬é¢˜å’Œ322.é›¶é’±å…‘æ¢ä¸€è‡´ï¼Œäº”éƒ¨æ›²å°±ä¸å†èµ˜è¿°äº†ï¼Œåªåšå‡ºä¸¾ä¾‹</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">ä¸¾ä¾‹ï¼šn = 13</span></span><br><span class="line"><span class="comment">        0 1 2 3 4 5 6 7 8 9 10 11 12 13</span></span><br><span class="line"><span class="comment">1Â²=1    0 1 2 3 4 5 6 7 8 9 10 11 12 13</span></span><br><span class="line"><span class="comment">2Â²=4    0 1 2 3 1 2 3 4 2 3 4  5  3  4</span></span><br><span class="line"><span class="comment">3Â²=9    0 1 2 3 1 2 3 4 2 1 2  3  3  2</span></span><br><span class="line"><span class="comment">ç¨‹åºè¾“å‡ºä¸ºï¼š</span></span><br><span class="line"><span class="comment">1 2 3 4 5 6 7 8 9 10 11 12 13 </span></span><br><span class="line"><span class="comment">      1 2 3 4 2 3 4  5  3  4 </span></span><br><span class="line"><span class="comment">                1 2  3  3  2 </span></span><br><span class="line"><span class="comment">ä¸é¢„æµ‹çš„ä¸€è‡´</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><h4 id="139-å•è¯æ‹†åˆ†"><a href="#139-å•è¯æ‹†åˆ†" class="headerlink" title="139.å•è¯æ‹†åˆ†"></a>139.å•è¯æ‹†åˆ†</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">~~~</span><br><span class="line"></span><br><span class="line"># å…¶ä»–</span><br><span class="line"></span><br><span class="line">## è‚¡ç¥¨é—®é¢˜</span><br><span class="line"></span><br><span class="line">#### <span class="number">121.</span>ä¹°å–è‚¡ç¥¨çš„æœ€ä½³æ—¶æœº</span><br><span class="line"></span><br><span class="line">~~~java</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">maxProfit</span><span class="params">(<span class="type">int</span>[] prices)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> prices.length;</span><br><span class="line">        <span class="type">int</span> <span class="variable">dp0</span> <span class="operator">=</span> -prices[<span class="number">0</span>], dp1 = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; n; i++) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">dpi0</span> <span class="operator">=</span> Math.max(dp0, -prices[i]);</span><br><span class="line">            <span class="type">int</span> <span class="variable">dpi1</span> <span class="operator">=</span> Math.max(dp1, prices[i] + dp0);</span><br><span class="line">            dp0 = dpi0;</span><br><span class="line">            dp1 = dpi1;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dp1;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    1. dp[i][0]ï¼šæŒæœ‰è‚¡ç¥¨ä¹‹åçš„æœ€å¤§èµ„äº§</span></span><br><span class="line"><span class="comment">       dp[i][1]: ä¸æŒæœ‰è‚¡ç¥¨ï¼ˆå–æ‰è‚¡ç¥¨ï¼‰ä¹‹åçš„æœ€å¤§èµ„äº§</span></span><br><span class="line"><span class="comment">    2. é€’æ¨å¼ï¼šdp[i][0] = max(dp[i-1][0], -price[i])</span></span><br><span class="line"><span class="comment">              dp[i][1] = max(dp[i-1][1], price[i] + dp[i-1][0])</span></span><br><span class="line"><span class="comment">       æ³¨ï¼šå‡è®¾è¿™ä¸ªäººçš„åˆå§‹èµ„äº§ä¸º0ï¼Œé‚£ä¹ˆå®ƒå…¥è‚¡ç¬¬iä¸ªè‚¡ç¥¨åï¼Œä»–æŒæœ‰è‚¡ç¥¨ä¹‹åçš„èµ„äº§å°±æ˜¯-price[i]</span></span><br><span class="line"><span class="comment">        åœ¨ç¬¬ä¸€ä¸ªé€’æ¨å¼ä¸­ï¼šè¦ä¹ˆæ˜¯ä¿æŒå‰ä¸€å¤©ä¹°çš„è‚¡ç¥¨ï¼Œè¦ä¹ˆæ˜¯ä»Šå¤©ä¹°å…¥è‚¡ç¥¨ï¼Œå–å†³äºè°çš„ç»å¯¹å€¼æœ€å°ï¼Œä¹Ÿå°±æ˜¯è°çš„è‚¡ç¥¨ä¾¿å®œ</span></span><br><span class="line"><span class="comment">        åœ¨ç¬¬äºŒä¸ªé€’æ¨å¼ä¸­ï¼šè¦ä¹ˆæ˜¯å‰ä¸€å¤©çš„ç»“æœï¼Œè¦ä¹ˆæ˜¯ä»Šå¤©å–å‡ºè‚¡ç¥¨çš„åˆ©æ¶¦ï¼Œå–å†³äºè°çš„å¤§ï¼Œä¹Ÿå°±æ˜¯è°çš„åˆ©æ¶¦å¤š</span></span><br><span class="line"><span class="comment">    3. åˆå§‹åŒ–ï¼šdp[i][0] = -prices[0] </span></span><br><span class="line"><span class="comment">              dp[i][1] = 0</span></span><br><span class="line"><span class="comment">    4. è®¡ç®—é¡ºåºï¼š ä»å‰å¾€å</span></span><br><span class="line"><span class="comment">    5. ä¸¾ä¾‹ï¼š[7,1,5,3,6,4]</span></span><br><span class="line"><span class="comment">        dp[i][0]    dp[i][1]</span></span><br><span class="line"><span class="comment">    7   -7          0</span></span><br><span class="line"><span class="comment">    1   -1          0</span></span><br><span class="line"><span class="comment">    5   -1          4</span></span><br><span class="line"><span class="comment">    3   -1          4</span></span><br><span class="line"><span class="comment">    6   -1          5</span></span><br><span class="line"><span class="comment">    4   -1          5</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure><h4 id="122-ä¹°å–è‚¡ç¥¨çš„æœ€ä½³æ—¶æœºII"><a href="#122-ä¹°å–è‚¡ç¥¨çš„æœ€ä½³æ—¶æœºII" class="headerlink" title="122.ä¹°å–è‚¡ç¥¨çš„æœ€ä½³æ—¶æœºII"></a>122.ä¹°å–è‚¡ç¥¨çš„æœ€ä½³æ—¶æœºII</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">maxProfit</span><span class="params">(<span class="type">int</span>[] prices)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> prices.length;</span><br><span class="line">        <span class="type">int</span> <span class="variable">dp0</span> <span class="operator">=</span> -prices[<span class="number">0</span>], dp1 = <span class="number">0</span>;</span><br><span class="line">        <span class="comment">//System.out.println(dp0 + &quot; &quot; + dp1);</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; n; i++) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">dpi0</span> <span class="operator">=</span> Math.max(dp0, dp1-prices[i]);</span><br><span class="line">            <span class="comment">// dp0æ˜¯ä¿æŒåŸæœ‰çš„è‚¡ç¥¨ï¼Œdp1-prices[i]æ˜¯æ˜¨å¤©å–æ‰è‚¡ç¥¨ï¼Œä»Šå¤©æ–°ä¹°å…¥è‚¡ç¥¨</span></span><br><span class="line">            <span class="type">int</span> <span class="variable">dpi1</span> <span class="operator">=</span> Math.max(dp1, prices[i] + dp0);</span><br><span class="line">            <span class="comment">// dp1æ˜¯æ˜¨å¤©ä¸æŒè‚¡ç¥¨çš„æœ€å¤§èµ„äº§ï¼Œprices[i]+dp0æ˜¯ä»Šå¤©å–å‡ºè‚¡ç¥¨åçš„èµ„äº§ã€‚</span></span><br><span class="line">            dp0 = dpi0;</span><br><span class="line">            dp1 = dpi1;</span><br><span class="line">            <span class="comment">//System.out.println(dp0 + &quot; &quot; + dp1);</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dp1;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    5. ä¸¾ä¾‹ï¼š[7,1,5,3,6,4]</span></span><br><span class="line"><span class="comment">        dp[i][0]    dp[i][1]</span></span><br><span class="line"><span class="comment">    7   -7          0</span></span><br><span class="line"><span class="comment">    1   -1          0</span></span><br><span class="line"><span class="comment">    5   -1          4</span></span><br><span class="line"><span class="comment">    3   1           4</span></span><br><span class="line"><span class="comment">    6   1           7</span></span><br><span class="line"><span class="comment">    4   3           7</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><h2 id="æ•°ç»„"><a href="#æ•°ç»„" class="headerlink" title="æ•°ç»„"></a>æ•°ç»„</h2><h4 id="1143-æœ€é•¿å…¬å…±å­åºåˆ—"><a href="#1143-æœ€é•¿å…¬å…±å­åºåˆ—" class="headerlink" title="1143.æœ€é•¿å…¬å…±å­åºåˆ—"></a>1143.æœ€é•¿å…¬å…±å­åºåˆ—</h4><blockquote><p>ç»™å®šä¸¤ä¸ªå­—ç¬¦ä¸² text1 å’Œ text2ï¼Œè¿”å›å®ƒä»¬çš„æœ€é•¿å…¬å…±å­åºåˆ—çš„é•¿åº¦ã€‚å¦‚æœä¸å­˜åœ¨å…¬å…±å­åºåˆ— ï¼Œè¿”å› 0ã€‚</p><p>ï¼ˆPS:è¿™é‡Œçš„å­åºåˆ—<strong>ä¸è¦æ±‚è¿ç»­</strong>ã€‚ï¼‰</p><p>ç¤ºä¾‹1ï¼š</p><blockquote><p>è¾“å…¥ï¼štext1 = â€œabcdeâ€, text2 = â€œaceâ€<br>è¾“å‡ºï¼š3<br>è§£é‡Šï¼šæœ€é•¿å…¬å…±å­åºåˆ—æ˜¯ â€œaceâ€ ï¼Œå®ƒçš„é•¿åº¦ä¸º 3 ã€‚</p></blockquote></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">longestCommonSubsequence</span><span class="params">(String text1, String text2)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">n1</span> <span class="operator">=</span> text1.length(), n2 = text2.length();</span><br><span class="line">        <span class="type">int</span>[][] dp = <span class="keyword">new</span> <span class="title class_">int</span>[n1 + <span class="number">1</span>][n2 + <span class="number">1</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= n1; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">1</span>; j &lt;= n2; j++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (text1.charAt(i-<span class="number">1</span>) == text2.charAt(j-<span class="number">1</span>)) &#123;</span><br><span class="line">                    dp[i][j] = dp[i-<span class="number">1</span>][j-<span class="number">1</span>] + <span class="number">1</span>;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    dp[i][j] = Math.max(dp[i-<span class="number">1</span>][j], dp[i][j-<span class="number">1</span>]);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// System.out.print(dp[i][j] + &quot; &quot;);</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// System.out.println();</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dp[n1][n2];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    1.å«ä¹‰ï¼šdp[i][j]è¡¨ç¤ºtext1[0...i-1]å’Œtext2[0...j-1]çš„æœ€é•¿å…¬å…±å­åºåˆ—ä¸ºdp[i][j]</span></span><br><span class="line"><span class="comment">    2.é€’æ¨å¼ï¼š</span></span><br><span class="line"><span class="comment">        if text1[i]==text2[j] then dp[i][j] = dp[i-1][j-1] + 1</span></span><br><span class="line"><span class="comment">        else then dp[i][j] = max(dp[i][j-1], dp[i-1][j])</span></span><br><span class="line"><span class="comment">    3.åˆå§‹åŒ–ï¼šdp[0][j] = 0, dp[i][0] = 0</span></span><br><span class="line"><span class="comment">    4.è®¡ç®—é¡ºåºï¼šå¤–å±‚text1ï¼Œå†…å±‚text2ã€‚åä¹‹äº¦è¡Œ</span></span><br><span class="line"><span class="comment">    5.ä¸¾ä¾‹ï¼štext1 = &quot;abcde&quot; text2 = &quot;ace&quot;</span></span><br><span class="line"><span class="comment">    dp[i][j]  0 a c e</span></span><br><span class="line"><span class="comment">        0     0 0 0 0</span></span><br><span class="line"><span class="comment">        a     0 1 1 1</span></span><br><span class="line"><span class="comment">       b     0 1 1 1</span></span><br><span class="line"><span class="comment">        c     0 1 2 2</span></span><br><span class="line"><span class="comment">        d  0 1 2 2</span></span><br><span class="line"><span class="comment">        e  0 1 2 3</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><h4 id="300-æœ€é•¿é€’å¢å­åºåˆ—"><a href="#300-æœ€é•¿é€’å¢å­åºåˆ—" class="headerlink" title="300.æœ€é•¿é€’å¢å­åºåˆ—"></a>300.æœ€é•¿é€’å¢å­åºåˆ—</h4><blockquote><p>ç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ nums ï¼Œæ‰¾åˆ°å…¶ä¸­æœ€é•¿ä¸¥æ ¼é€’å¢å­åºåˆ—çš„é•¿åº¦ã€‚</p><p>ï¼ˆPS:è¿™é‡Œçš„å­åºåˆ—<strong>ä¸è¦æ±‚è¿ç»­</strong>ã€‚ï¼‰</p><p>ç¤ºä¾‹1ï¼š</p><blockquote><p>è¾“å…¥ï¼šnums = [10,9,2,5,3,7,101,18]<br>è¾“å‡ºï¼š4<br>è§£é‡Šï¼šæœ€é•¿é€’å¢å­åºåˆ—æ˜¯ [2,3,7,101]ï¼Œå› æ­¤é•¿åº¦ä¸º 4 ã€‚</p></blockquote></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">lengthOfLIS</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> nums.length;</span><br><span class="line">        <span class="type">int</span> <span class="variable">res</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">        <span class="type">int</span>[] dp = <span class="keyword">new</span> <span class="title class_">int</span>[n];</span><br><span class="line">        Arrays.fill(dp, <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; n; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; i; j++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (nums[i] &gt; nums[j]) &#123;</span><br><span class="line">                    dp[i] = Math.max(dp[i], dp[j] + <span class="number">1</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            res = Math.max(res, dp[i]);</span><br><span class="line">            <span class="comment">// System.out.print(dp[i] + &quot; &quot;);</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    1.å«ä¹‰ï¼šä»¥nums[i]ä¸ºç»“å°¾çš„æœ€é•¿ä¸¥æ ¼é€’å¢å­åºåˆ—é•¿åº¦ä¸ºdp[i]</span></span><br><span class="line"><span class="comment">    2.é€’æ¨å¼ï¼šdp[i] = max(dp[j] + 1) å…¶ä¸­0&lt;=j&lt;iä¸”nums[i] &gt; nums[j]</span></span><br><span class="line"><span class="comment">    3.åˆå§‹åŒ–ï¼šdp[0...i-1] = 1</span></span><br><span class="line"><span class="comment">    4.è®¡ç®—é¡ºåºï¼šé¡ºåºï¼Œä»å°åˆ°å¤§</span></span><br><span class="line"><span class="comment">    5.ä¸¾ä¾‹ï¼šnums = [10,9,2,5,3,7,101,18]</span></span><br><span class="line"><span class="comment">    nums[i]:    10 9 2 5 3 7 101 18</span></span><br><span class="line"><span class="comment">    dp[i]:      1  1 1 2 2 3 4   4</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><h4 id="718-æœ€é•¿é‡å¤å­æ•°ç»„"><a href="#718-æœ€é•¿é‡å¤å­æ•°ç»„" class="headerlink" title="718.æœ€é•¿é‡å¤å­æ•°ç»„"></a>718.æœ€é•¿é‡å¤å­æ•°ç»„</h4><blockquote><p>ç»™ä¸¤ä¸ªæ•´æ•°æ•°ç»„ nums1å’Œ nums2 ï¼Œè¿”å›ä¸¤ä¸ªæ•°ç»„ä¸­å…¬å…±çš„ ã€é•¿åº¦æœ€é•¿çš„å­æ•°ç»„çš„é•¿åº¦ã€‚</p><p>ï¼ˆPS:å­æ•°ç»„æ˜¯<strong>è¦æ±‚è¿ç»­</strong>çš„ï¼‰</p><p>ç¤ºä¾‹1ï¼š</p><blockquote><p>è¾“å…¥ï¼šnums1 = [1,2,3,2,1], nums2 = [3,2,1,4,7]<br>è¾“å‡ºï¼š3<br>è§£é‡Šï¼šé•¿åº¦æœ€é•¿çš„å…¬å…±å­æ•°ç»„æ˜¯ [3,2,1] ã€‚</p></blockquote></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">findLength</span><span class="params">(<span class="type">int</span>[] nums1, <span class="type">int</span>[] nums2)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">n1</span> <span class="operator">=</span> nums1.length, n2 = nums2.length;</span><br><span class="line">        <span class="type">int</span>[][] dp = <span class="keyword">new</span> <span class="title class_">int</span>[n1 + <span class="number">1</span>][n2 + <span class="number">1</span>];</span><br><span class="line">        <span class="type">int</span> <span class="variable">res</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= n1; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">1</span>; j &lt;= n2; j++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (nums1[i-<span class="number">1</span>] == nums2[j-<span class="number">1</span>]) &#123;</span><br><span class="line">                    dp[i][j] = dp[i-<span class="number">1</span>][j-<span class="number">1</span>] + <span class="number">1</span>;</span><br><span class="line">                    res = Math.max(res, dp[i][j]);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// System.out.print(dp[i][j] + &quot; &quot;);</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// System.out.println();</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    1.å«ä¹‰ï¼šä»¥ä¸‹æ ‡i-1ä¸ºç»“å°¾çš„nums1å’Œä»¥ä¸‹æ ‡j-1ä¸ºç»“å°¾çš„nums2ï¼Œæœ€é•¿é‡å¤å­æ•°ç»„é•¿åº¦ä¸ºdp[i][j]</span></span><br><span class="line"><span class="comment">    2.dp[i][j] = dp[i-1][j-1] + 1 , if nums[i-1]==nums[j-1]</span></span><br><span class="line"><span class="comment">    3.åˆå§‹åŒ–ï¼šdp[0][j] = dp[i][0] = 0</span></span><br><span class="line"><span class="comment">    4.è®¡ç®—é¡ºåºï¼šå¤–å±‚nums1ï¼Œå†…å±‚nums2ï¼Œåä¹‹äº¦è¡Œã€‚</span></span><br><span class="line"><span class="comment">    5.ä¸¾ä¾‹ï¼šnums1 = [1,2,3,2,1], nums2 = [3,2,1,4,7]</span></span><br><span class="line"><span class="comment">        0 3 2 1 4 7</span></span><br><span class="line"><span class="comment">    0   0 0 0 0 0 0</span></span><br><span class="line"><span class="comment">    1   0 0 0 1 0 0</span></span><br><span class="line"><span class="comment">    2   0 0 1 0 0 0</span></span><br><span class="line"><span class="comment">    3   0 1 0 0 0 0</span></span><br><span class="line"><span class="comment">    2   0 0 2 0 0 0</span></span><br><span class="line"><span class="comment">    1   0 0 0 3 0 0</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><h4 id="674-æœ€é•¿è¿ç»­é€’å¢åºåˆ—"><a href="#674-æœ€é•¿è¿ç»­é€’å¢åºåˆ—" class="headerlink" title="674. æœ€é•¿è¿ç»­é€’å¢åºåˆ—"></a><a href="https://leetcode.cn/problems/longest-continuous-increasing-subsequence/">674. æœ€é•¿è¿ç»­é€’å¢åºåˆ—</a></h4><blockquote><p>ç»™å®šä¸€ä¸ªæœªç»æ’åºçš„æ•´æ•°æ•°ç»„ï¼Œæ‰¾åˆ°æœ€é•¿ä¸”<strong>è¿ç»­</strong>é€’å¢çš„å­åºåˆ—ï¼Œå¹¶è¿”å›è¯¥åºåˆ—çš„é•¿åº¦ã€‚</p><p>ï¼ˆPSï¼š<strong>è¦æ±‚è¿ç»­</strong>ï¼‰</p><p>ç¤ºä¾‹1ï¼š</p><blockquote><p>è¾“å…¥ï¼šnums = [1,3,5,4,7]</p><p>è¾“å‡ºï¼š3</p><p>è§£é‡Šï¼šæœ€é•¿è¿ç»­é€’å¢åºåˆ—æ˜¯ [1,3,5], é•¿åº¦ä¸º3ã€‚å°½ç®¡ [1,3,5,7] ä¹Ÿæ˜¯å‡åºçš„å­åºåˆ—, ä½†å®ƒä¸æ˜¯è¿ç»­çš„ï¼Œå› ä¸º 5 å’Œ 7 åœ¨åŸæ•°ç»„é‡Œè¢« 4 éš”å¼€ã€‚</p></blockquote></blockquote><h5 id="DPè§£æ³•"><a href="#DPè§£æ³•" class="headerlink" title="DPè§£æ³•"></a>DPè§£æ³•</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">findLengthOfLCIS</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> nums.length;</span><br><span class="line">        <span class="type">int</span>[] dp = <span class="keyword">new</span> <span class="title class_">int</span>[n];</span><br><span class="line">        Arrays</span><br><span class="line">        <span class="type">int</span> <span class="variable">res</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; n; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (nums[i] &gt; nums[i-<span class="number">1</span>]) &#123;</span><br><span class="line">                dp[i] = dp[i-<span class="number">1</span>] + <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            res = Math.max(res, dp[i]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    1. dp[i]è¡¨ç¤ºä»¥nums[i]ä¸ºç»“å°¾çš„æœ€å¤§è¿ç»­é€’å¢å­åºåˆ—çš„é•¿åº¦</span></span><br><span class="line"><span class="comment">    2. é€’æ¨å¼ï¼šdp[i] = dp[i-1] + 1 ï¼ˆå¦‚æœnums[i] &gt; nums[i-1]ï¼‰</span></span><br><span class="line"><span class="comment">    3. åˆå§‹åŒ–ï¼šdp[0...n] = 1</span></span><br><span class="line"><span class="comment">    4. è®¡ç®—é¡ºåºï¼šä»å‰å¾€å</span></span><br><span class="line"><span class="comment">    5. ä¸¾ä¾‹ï¼šnums = [1,3,5,4,7]</span></span><br><span class="line"><span class="comment">        nums[i] 1 3 5 4 7</span></span><br><span class="line"><span class="comment">        dp[i]   1 2 3 1 2  </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    DPç®—æ³•</span></span><br><span class="line"><span class="comment">    æ—¶é—´å¤æ‚åº¦O(n)</span></span><br><span class="line"><span class="comment">    ç©ºé—´å¤æ‚åº¦O(n)</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h5 id="è´ªå¿ƒè§£æ³•"><a href="#è´ªå¿ƒè§£æ³•" class="headerlink" title="è´ªå¿ƒè§£æ³•"></a>è´ªå¿ƒè§£æ³•</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">findLengthOfLCIS</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> nums.length;</span><br><span class="line">        <span class="type">int</span> <span class="variable">res</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">curLen</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; n; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (nums[i] &gt; nums[i-<span class="number">1</span>]) &#123;</span><br><span class="line">                curLen++;</span><br><span class="line">                res = Math.max(res, curLen);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                curLen = <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    è´ªå¿ƒç®—æ³•</span></span><br><span class="line"><span class="comment">    æ—¶é—´å¤æ‚åº¦O(n)</span></span><br><span class="line"><span class="comment">    ç©ºé—´å¤æ‚åº¦O(1)</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><h4 id="1035-ä¸ç›¸äº¤çš„çº¿"><a href="#1035-ä¸ç›¸äº¤çš„çº¿" class="headerlink" title="1035. ä¸ç›¸äº¤çš„çº¿"></a><a href="https://leetcode.cn/problems/uncrossed-lines/">1035. ä¸ç›¸äº¤çš„çº¿</a></h4><blockquote><p>åœ¨ä¸¤æ¡ç‹¬ç«‹çš„æ°´å¹³çº¿ä¸ŠæŒ‰ç»™å®šçš„é¡ºåºå†™ä¸‹ nums1 å’Œ nums2 ä¸­çš„æ•´æ•°ã€‚</p><p>ç°åœ¨ï¼Œå¯ä»¥ç»˜åˆ¶ä¸€äº›è¿æ¥ä¸¤ä¸ªæ•°å­— nums1[i] å’Œ nums2[j] çš„ç›´çº¿ï¼Œè¿™äº›ç›´çº¿éœ€è¦åŒæ—¶æ»¡è¶³ï¼š</p><blockquote><p> nums1[i] == nums2[j]<br>ä¸”ç»˜åˆ¶çš„ç›´çº¿ä¸ä¸ä»»ä½•å…¶ä»–è¿çº¿ï¼ˆéæ°´å¹³çº¿ï¼‰ç›¸äº¤ã€‚</p></blockquote><p>è¯·æ³¨æ„ï¼Œè¿çº¿å³ä½¿åœ¨ç«¯ç‚¹ä¹Ÿä¸èƒ½ç›¸äº¤ï¼šæ¯ä¸ªæ•°å­—åªèƒ½å±äºä¸€æ¡è¿çº¿ã€‚</p><p>ä»¥è¿™ç§æ–¹æ³•ç»˜åˆ¶çº¿æ¡ï¼Œå¹¶è¿”å›å¯ä»¥ç»˜åˆ¶çš„æœ€å¤§è¿çº¿æ•°ã€‚</p><p>ç¤ºä¾‹1ï¼š</p><blockquote><p>è¾“å…¥ï¼šnums1 = [1,4,2], nums2 = [1,2,4]<br>è¾“å‡ºï¼š2<br>è§£é‡Šï¼šå¯ä»¥ç”»å‡ºä¸¤æ¡ä¸äº¤å‰çš„çº¿ï¼Œå¦‚ä¸Šå›¾æ‰€ç¤ºã€‚<br>ä½†æ— æ³•ç”»å‡ºç¬¬ä¸‰æ¡ä¸ç›¸äº¤çš„ç›´çº¿ï¼Œå› ä¸ºä» nums1[1]=4 åˆ° nums2[2]=4 çš„ç›´çº¿å°†ä¸ä» nums1[2]=2 åˆ° nums2[1]=2 çš„ç›´çº¿ç›¸äº¤ã€‚</p></blockquote></blockquote><p><img src="http://cdn.leef.fun/typora/s3/img/142.png" alt="1035ç¤ºä¾‹ä¸€çš„å›¾ç‰‡" style="zoom: 25%;"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">maxUncrossedLines</span><span class="params">(<span class="type">int</span>[] nums1, <span class="type">int</span>[] nums2)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">n1</span> <span class="operator">=</span> nums1.length, n2 = nums2.length;</span><br><span class="line">        <span class="type">int</span>[][] dp = <span class="keyword">new</span> <span class="title class_">int</span>[n1 + <span class="number">1</span>][n2 + <span class="number">1</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= n1; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">1</span>; j &lt;= n2; j++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (nums1[i-<span class="number">1</span>] == nums2[j-<span class="number">1</span>]) &#123;</span><br><span class="line">                    dp[i][j] = dp[i-<span class="number">1</span>][j-<span class="number">1</span>] + <span class="number">1</span>;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    dp[i][j] = Math.max(dp[i-<span class="number">1</span>][j], dp[i][j-<span class="number">1</span>]);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// System.out.print(dp[i][j] + &quot; &quot;);</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// System.out.println();</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dp[n1][n2];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    1.å«ä¹‰ï¼šé•¿åº¦ä¸ºi-1çš„nums1å’Œé•¿åº¦ä¸ºj-1çš„nums2çš„ä¸ç›¸äº¤çº¿æ•°ä¸ºdp[i][j]</span></span><br><span class="line"><span class="comment">    2.é€’æ¨å¼ï¼šif nums[i-1]==nums[j-1]</span></span><br><span class="line"><span class="comment">                    dp[i][j] = dp[i-1][j-1] + 1 </span></span><br><span class="line"><span class="comment">             else</span></span><br><span class="line"><span class="comment">                    dp[i][j] = max(dp[i-1][j], dp[i][j-1])</span></span><br><span class="line"><span class="comment">    3.åˆå§‹åŒ–ï¼šdp[0][j] = dp[i][0] = 0</span></span><br><span class="line"><span class="comment">    4.è®¡ç®—é¡ºåºï¼šå¤–å±‚nums1ï¼Œå†…å±‚nums2ï¼Œåä¹‹äº¦è¡Œã€‚</span></span><br><span class="line"><span class="comment">    5.ä¸¾ä¾‹ï¼šnums1 = [1,4,2], nums2 = [1,2,4]</span></span><br><span class="line"><span class="comment">            nums2   1 2 4</span></span><br><span class="line"><span class="comment">    nums1     0     0 0 0      </span></span><br><span class="line"><span class="comment">      1       0     1 1 1    </span></span><br><span class="line"><span class="comment">      4       0     1 1 2</span></span><br><span class="line"><span class="comment">      2       0     1 2 2</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><blockquote><p>æ³¨ï¼šè¿™é“é¢˜ä»£ç å’Œ <strong>1143.æœ€é•¿å…¬å…±å­åºåˆ— </strong>ä¸€æ¨¡ä¸€æ ·ã€‚</p></blockquote><h4 id="53-æœ€å¤§å­æ•°ç»„å’Œ"><a href="#53-æœ€å¤§å­æ•°ç»„å’Œ" class="headerlink" title="53. æœ€å¤§å­æ•°ç»„å’Œ"></a><a href="https://leetcode.cn/problems/maximum-subarray/">53. æœ€å¤§å­æ•°ç»„å’Œ</a></h4><blockquote><p>ç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ nums ï¼Œè¯·ä½ æ‰¾å‡ºä¸€ä¸ªå…·æœ‰æœ€å¤§å’Œçš„è¿ç»­å­æ•°ç»„ï¼ˆå­æ•°ç»„æœ€å°‘åŒ…å«ä¸€ä¸ªå…ƒç´ ï¼‰ï¼Œè¿”å›å…¶æœ€å¤§å’Œã€‚<strong>å­æ•°ç»„</strong> æ˜¯æ•°ç»„ä¸­çš„ä¸€ä¸ªè¿ç»­éƒ¨åˆ†ã€‚</p><p>ç¤ºä¾‹1ï¼š</p><p>è¾“å…¥ï¼šnums = [-2,1,-3,4,-1,2,1,-5,4]<br>è¾“å‡ºï¼š6<br>è§£é‡Šï¼šè¿ç»­å­æ•°ç»„ [4,-1,2,1] çš„å’Œæœ€å¤§ï¼Œä¸º 6 ã€‚</p></blockquote><h5 id="DPè§£æ³•-1"><a href="#DPè§£æ³•-1" class="headerlink" title="DPè§£æ³•"></a>DPè§£æ³•</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">maxSubArray</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> nums.length;</span><br><span class="line">        <span class="type">int</span>[] dp = <span class="keyword">new</span> <span class="title class_">int</span>[n];</span><br><span class="line">        dp[<span class="number">0</span>] = nums[<span class="number">0</span>];</span><br><span class="line">        <span class="type">int</span> <span class="variable">res</span> <span class="operator">=</span> dp[<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; n; i++) &#123;</span><br><span class="line">            dp[i] = Math.max(nums[i], dp[i-<span class="number">1</span>] + nums[i]);</span><br><span class="line">            res = Math.max(res, dp[i]);</span><br><span class="line">            <span class="comment">// System.out.print(dp[i] + &quot; &quot;);</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    1.å«ä¹‰ï¼šä»¥ä¸‹æ ‡iä¸ºç»“å°¾çš„æœ€å¤§å­æ•°ç»„å’Œä¸ºdp[i]</span></span><br><span class="line"><span class="comment">    2.é€’æ¨å¼ï¼šdp[i] = max(nums[i], dp[i-1] + nums[i])</span></span><br><span class="line"><span class="comment">    3.åˆå§‹åŒ–ï¼šdp[0] = nums[0]</span></span><br><span class="line"><span class="comment">    4.è®¡ç®—é¡ºåºï¼šä»å°åˆ°å¤§</span></span><br><span class="line"><span class="comment">    5.ä¸¾ä¾‹ï¼šnums = [-2,1,-3,4,-1,2,1,-5,4]</span></span><br><span class="line"><span class="comment">        -2 1 -3 4 -1 2 1 -5 4</span></span><br><span class="line"><span class="comment">        -2 1 -2 4  3 5 6  1 5</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure><h5 id="åˆ†æ²»è§£æ³•"><a href="#åˆ†æ²»è§£æ³•" class="headerlink" title="åˆ†æ²»è§£æ³•"></a>åˆ†æ²»è§£æ³•</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">maxSubArray</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> getMaxSubArray(nums, <span class="number">0</span>, nums.length - <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getMaxSubArray</span><span class="params">(<span class="type">int</span>[] nums, <span class="type">int</span> l, <span class="type">int</span> r)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (l == r) <span class="keyword">return</span> nums[l]; <span class="comment">// é€€å‡ºæ¡ä»¶ï¼šæ•°ç»„é•¿åº¦ä¸º1</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">mid</span> <span class="operator">=</span> l + (r - l) / <span class="number">2</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">l_sum</span> <span class="operator">=</span> getMaxSubArray(nums, l, mid); <span class="comment">// å­é—®é¢˜nums[l...mid]çš„æœ€å¤§å­æ•°ç»„å’Œ</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">r_sum</span> <span class="operator">=</span> getMaxSubArray(nums, mid + <span class="number">1</span>, r); <span class="comment">// å­é—®é¢˜nums[mid+1...r]çš„æœ€å¤§å­æ•°ç»„å’Œ</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">m_sum</span> <span class="operator">=</span> merge(nums, l, mid, r); <span class="comment">// ä¸¤ä¸ªå­é—®é¢˜åˆå¹¶åå¯èƒ½çš„æœ€å¤§å­æ•°ç»„å’Œ</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ±‚l_sum l_sum m_sum ä¸‰è€…ä¸­çš„æœ€å¤§å€¼ï¼Œå³ä¸ºå°†ä¸¤ä¸ªå­é—®é¢˜åˆå¹¶åçš„ç­”æ¡ˆ</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">res</span> <span class="operator">=</span> Math.max(l_sum, r_sum);</span><br><span class="line">        res = Math.max(res, m_sum);</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆå¹¶nums[l...mid]å’Œnums[mid+1...r]</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">merge</span><span class="params">(<span class="type">int</span>[] nums, <span class="type">int</span> l, <span class="type">int</span> mid, <span class="type">int</span> r)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">left_sum</span> <span class="operator">=</span> <span class="number">0</span>, left_res = Integer.MIN_VALUE;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> mid; i &gt;= l; i--) &#123;</span><br><span class="line">            left_sum += nums[i];</span><br><span class="line">            left_res = Math.max(left_res, left_sum);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> <span class="variable">right_sum</span> <span class="operator">=</span> <span class="number">0</span>, right_res = Integer.MIN_VALUE;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> mid + <span class="number">1</span>; i &lt;= r; i++) &#123;</span><br><span class="line">            right_sum += nums[i];</span><br><span class="line">            right_res = Math.max(right_res, right_sum);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> left_res + right_res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ç¼–è¾‘è·ç¦»ç±»é—®é¢˜"><a href="#ç¼–è¾‘è·ç¦»ç±»é—®é¢˜" class="headerlink" title="ç¼–è¾‘è·ç¦»ç±»é—®é¢˜"></a>ç¼–è¾‘è·ç¦»ç±»é—®é¢˜</h2><h4 id="392-åˆ¤æ–­å­åºåˆ—"><a href="#392-åˆ¤æ–­å­åºåˆ—" class="headerlink" title="392. åˆ¤æ–­å­åºåˆ—"></a><a href="https://leetcode.cn/problems/is-subsequence/">392. åˆ¤æ–­å­åºåˆ—</a></h4><blockquote><p>ç»™å®šå­—ç¬¦ä¸² <strong>s</strong> å’Œ <strong>t</strong> ï¼Œåˆ¤æ–­ <strong>s</strong> æ˜¯å¦ä¸º <strong>t</strong> çš„å­åºåˆ—ã€‚</p><p>ç¤ºä¾‹1ï¼š</p><blockquote><p>è¾“å…¥ï¼šs = â€œabcâ€, t = â€œahbgdcâ€</p><p>è¾“å‡ºï¼štrue</p></blockquote></blockquote><h5 id="åŒæŒ‡é’ˆè§£æ³•"><a href="#åŒæŒ‡é’ˆè§£æ³•" class="headerlink" title="åŒæŒ‡é’ˆè§£æ³•"></a>åŒæŒ‡é’ˆè§£æ³•</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isSubsequence</span><span class="params">(String s, String t)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>, count = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; s.length(); i++) &#123;</span><br><span class="line">            <span class="type">char</span> <span class="variable">cur</span> <span class="operator">=</span> s.charAt(i);</span><br><span class="line">            <span class="keyword">while</span> (j &lt; t.length()) &#123;</span><br><span class="line">                <span class="keyword">if</span> (t.charAt(j++) == cur) &#123;</span><br><span class="line">                    count ++;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> count == s.length();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    æœ€å·®æ—¶é—´å¤æ‚åº¦ï¼šO(n+m) å…¶ä¸­n = s.length, m = t.length</span></span><br><span class="line"><span class="comment">    ç©ºé—´å¤æ‚åº¦ï¼šO(1)</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><h5 id="DPè§£æ³•-2"><a href="#DPè§£æ³•-2" class="headerlink" title="DPè§£æ³•"></a>DPè§£æ³•</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isSubsequence</span><span class="params">(String s, String t)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> s.length(), m = t.length();</span><br><span class="line">        <span class="type">int</span>[][] dp = <span class="keyword">new</span> <span class="title class_">int</span>[n + <span class="number">1</span>][m + <span class="number">1</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">1</span>; j &lt;= m; j++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (s.charAt(i-<span class="number">1</span>) == t.charAt(j-<span class="number">1</span>)) &#123;</span><br><span class="line">                    dp[i][j] = dp[i-<span class="number">1</span>][j-<span class="number">1</span>] + <span class="number">1</span>;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    dp[i][j] = dp[i][j-<span class="number">1</span>];</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// System.out.print(dp[i][j] + &quot; &quot;);</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// System.out.println();</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dp[n][m] == n;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    1.å«ä¹‰ï¼šs[0...i-1]å’Œt[0...j-1]çš„æœ€é•¿å…¬å…±å­åºåˆ—é•¿åº¦ä¸ºdp[i][j]</span></span><br><span class="line"><span class="comment">    2.é€’æ¨å¼ï¼šif s[i-1] == s[j-1]</span></span><br><span class="line"><span class="comment">                dp[i][j] = dp[i-1][j-1] + 1</span></span><br><span class="line"><span class="comment">             else</span></span><br><span class="line"><span class="comment">                dp[i][j] = dp[i][j-1]</span></span><br><span class="line"><span class="comment">    3.åˆå§‹åŒ–ï¼šdp[0][j] = dp[i][0] = 0</span></span><br><span class="line"><span class="comment">    4.è®¡ç®—é¡ºåºï¼šå¤–å±‚sï¼Œå†…å±‚t</span></span><br><span class="line"><span class="comment">    5.ä¸¾ä¾‹ï¼šs = &quot;abc&quot;, t = &quot;ahbgdc&quot;</span></span><br><span class="line"><span class="comment">        0 a h b g d c</span></span><br><span class="line"><span class="comment">    0   0 0 0 0 0 0 0</span></span><br><span class="line"><span class="comment">    a   0 1 1 1 1 1 1</span></span><br><span class="line"><span class="comment">    b   0 0 0 2 2 2 2</span></span><br><span class="line"><span class="comment">    c   0 0 0 0 0 0 3</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    6.æœ€ç»ˆè¿”å›ç»“æœï¼šdp[n][m] == s.length</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    DPç®—æ³•ï¼š</span></span><br><span class="line"><span class="comment">        æ—¶é—´å¤æ‚åº¦ï¼šO(nm)</span></span><br><span class="line"><span class="comment">        ç©ºé—´å¤æ‚åº¦ï¼šO(nm)</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure><h4 id="115-ä¸åŒçš„å­åºåˆ—"><a href="#115-ä¸åŒçš„å­åºåˆ—" class="headerlink" title="115. ä¸åŒçš„å­åºåˆ—"></a><a href="https://leetcode.cn/problems/distinct-subsequences/">115. ä¸åŒçš„å­åºåˆ—</a></h4><p>ç»™å®šä¸€ä¸ªå­—ç¬¦ä¸² s å’Œä¸€ä¸ªå­—ç¬¦ä¸² t ï¼Œè®¡ç®—åœ¨ s çš„å­åºåˆ—ä¸­ t å‡ºç°çš„ä¸ªæ•°ã€‚</p><p>å­—ç¬¦ä¸²çš„ä¸€ä¸ª å­åºåˆ— æ˜¯æŒ‡ï¼Œé€šè¿‡åˆ é™¤ä¸€äº›ï¼ˆä¹Ÿå¯ä»¥ä¸åˆ é™¤ï¼‰å­—ç¬¦ä¸”ä¸å¹²æ‰°å‰©ä½™å­—ç¬¦ç›¸å¯¹ä½ç½®æ‰€ç»„æˆçš„æ–°å­—ç¬¦ä¸²ã€‚ï¼ˆä¾‹å¦‚ï¼Œâ€ACEâ€ æ˜¯ â€œABCDEâ€ çš„ä¸€ä¸ªå­åºåˆ—ï¼Œè€Œ â€œAECâ€ ä¸æ˜¯ï¼‰</p><p>é¢˜ç›®æ•°æ®ä¿è¯ç­”æ¡ˆç¬¦åˆ 32 ä½å¸¦ç¬¦å·æ•´æ•°èŒƒå›´ã€‚</p><p>ç¤ºä¾‹1ï¼š</p><blockquote><p>è¾“å…¥ï¼šs = â€œrabbbitâ€, t = â€œrabbitâ€<br>è¾“å‡ºï¼š3<br>è§£é‡Šï¼š<br>å¦‚ä¸‹å›¾æ‰€ç¤º, æœ‰ 3 ç§å¯ä»¥ä» s ä¸­å¾—åˆ° â€œrabbitâ€ çš„æ–¹æ¡ˆã€‚<br><u>rabb</u>b<u>it</u><br><u>ra</u>b<u>bbit</u><br><u>rab</u>b<u>bit</u></p></blockquote><p>ç¤ºä¾‹2ï¼š</p><blockquote><p>è¾“å…¥ï¼šs = â€œbabgbagâ€, t = â€œbagâ€<br>è¾“å‡ºï¼š5<br>è§£é‡Šï¼š<br>å¦‚ä¸‹å›¾æ‰€ç¤º, æœ‰ 5 ç§å¯ä»¥ä» s ä¸­å¾—åˆ° â€œbagâ€ çš„æ–¹æ¡ˆã€‚<br><strong>ba</strong>b<strong>g</strong>bag<br><strong>ba</strong>bgba<strong>g</strong><br><strong>b</strong>abgb<strong>ag</strong><br>ba<strong>b</strong>gb<strong>ag</strong><br>babg<strong>bag</strong></p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">numDistinct</span><span class="params">(String s, String t)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> s.length(), m = t.length();</span><br><span class="line">        <span class="type">int</span>[][] dp = <span class="keyword">new</span> <span class="title class_">int</span>[n+<span class="number">1</span>][m+<span class="number">1</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt;= n; i++) &#123;</span><br><span class="line">            dp[i][<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">1</span>; j &lt;= m; j++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (s.charAt(i-<span class="number">1</span>) == t.charAt(j-<span class="number">1</span>)) &#123;</span><br><span class="line">                    dp[i][j] = dp[i-<span class="number">1</span>][j-<span class="number">1</span>] + dp[i-<span class="number">1</span>][j];</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    dp[i][j] = dp[i-<span class="number">1</span>][j];</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// System.out.print(dp[i][j] + &quot; &quot;);</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// System.out.println();</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dp[n][m];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    â€œè®¡ç®—åœ¨ s çš„å­åºåˆ—ä¸­ t å‡ºç°çš„ä¸ªæ•°ã€‚â€è¿™å¥è¯å’Œä¸‹é¢ä¸€å¥è¯æ˜¯ç­‰ä»·çš„</span></span><br><span class="line"><span class="comment">    â€œåœ¨sä¸­åˆ é™¤å…ƒç´ ï¼Œä½¿å¾—ä»–å˜æˆtï¼Œæœ‰å‡ ç§åˆ é™¤çš„æ–¹å¼ï¼Ÿâ€</span></span><br><span class="line"><span class="comment">    1.å«ä¹‰ï¼šs[0...i-1]çš„å­åºåˆ—ä¸­å‡ºç°t[0...j-1]çš„ä¸ªæ•°ä¸ºdp[i][j]</span></span><br><span class="line"><span class="comment">    2.é€’æ¨å¼ï¼šå¦‚æœs[i-1] == t[j-1]: </span></span><br><span class="line"><span class="comment">                dp[i][j] =  dp[i-1][j-1] + dp[i-1][j]</span></span><br><span class="line"><span class="comment">             å¦åˆ™ï¼š</span></span><br><span class="line"><span class="comment">                dp[i][j] = dp[i-1][j]</span></span><br><span class="line"><span class="comment">    å…¶ä¸­dp[i-1][j-1]æ˜¯ç”¨s[i-1]æ¥åŒ¹é…ï¼Œdp[i-1][j-1]æ˜¯ä¸ç”¨s[i-1]æ¥åŒ¹é…ï¼ˆå³åˆ é™¤æ‰s[i-1]ï¼‰</span></span><br><span class="line"><span class="comment">    3.åˆå§‹åŒ–ï¼šdp[0...n-1][0] = 1 è¡¨ç¤ºåªèƒ½åˆ æ‰sçš„æ‰€æœ‰å…ƒç´ æ‰èƒ½å˜æˆtï¼Œå³åŒ…å«1ä¸ªt</span></span><br><span class="line"><span class="comment">                dp[0][1...m-1] = 0 è¡¨ç¤ºsä¸ºç©ºå­—ç¬¦ä¸²ï¼Œä»–ä¸å¯èƒ½åŒ…å«t</span></span><br><span class="line"><span class="comment">    4.è®¡ç®—é¡ºåºï¼šç”±é€’æ¨å¼å¯çŸ¥ï¼Œdp[i][j]æ˜¯ç”±å·¦ä¸Šè¾¹æˆ–è€…ä¸Šè¾¹å¾—æ¥</span></span><br><span class="line"><span class="comment">                ï¼Œæ•…è®¡ç®—é¡ºåºä¸ºå¤–å±‚éå†så†…å±‚éå†tï¼Œä»å°åˆ°å¤§</span></span><br><span class="line"><span class="comment">    5.ä¸¾ä¾‹ï¼š</span></span><br><span class="line"><span class="comment">            0 r a b b i t</span></span><br><span class="line"><span class="comment">        0   1 0 0 0 0 0 0</span></span><br><span class="line"><span class="comment">        r   1 1 0 0 0 0 0</span></span><br><span class="line"><span class="comment">        a   1 1 1 0 0 0 0</span></span><br><span class="line"><span class="comment">        b   1 1 1 1 0 0 0</span></span><br><span class="line"><span class="comment">        b   1 1 1 2 1 0 0</span></span><br><span class="line"><span class="comment">        b   1 1 1 3 3 0 0</span></span><br><span class="line"><span class="comment">        i   1 1 1 3 3 3 0</span></span><br><span class="line"><span class="comment">        t   1 1 1 3 3 3 3</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><blockquote><pre><code>â€œè®¡ç®—åœ¨ s çš„å­åºåˆ—ä¸­ t å‡ºç°çš„ä¸ªæ•°ã€‚â€è¿™å¥è¯å’Œä¸‹é¢ä¸€å¥è¯æ˜¯ç­‰ä»·çš„â€œåœ¨sä¸­åˆ é™¤å…ƒç´ ï¼Œä½¿å¾—ä»–å˜æˆtï¼Œæœ‰å‡ ç§åˆ é™¤çš„æ–¹å¼ï¼Ÿâ€ä¹Ÿå¯ä»¥ç†è§£ä¸ºï¼šä¹‹å‰éƒ½æ˜¯æ±‚ç¼–è¾‘è·ç¦»çš„æœ€å°å€¼ï¼Œè¿™æ¬¡æ˜¯æ±‚ç¼–è¾‘çš„æ–¹å¼æœ‰å¤šå°‘ç§ï¼</code></pre></blockquote><h4 id="583-ä¸¤ä¸ªå­—ç¬¦ä¸²çš„åˆ é™¤æ“ä½œ"><a href="#583-ä¸¤ä¸ªå­—ç¬¦ä¸²çš„åˆ é™¤æ“ä½œ" class="headerlink" title="583. ä¸¤ä¸ªå­—ç¬¦ä¸²çš„åˆ é™¤æ“ä½œ"></a><a href="https://leetcode.cn/problems/delete-operation-for-two-strings/">583. ä¸¤ä¸ªå­—ç¬¦ä¸²çš„åˆ é™¤æ“ä½œ</a></h4><p>ç»™å®šä¸¤ä¸ªå•è¯ <code>word1</code> å’Œ <code>word2</code> ï¼Œè¿”å›ä½¿å¾— <code>word1</code> å’Œ <code>word2</code> <strong>ç›¸åŒ</strong>æ‰€éœ€çš„<strong>æœ€å°æ­¥æ•°</strong>ã€‚</p><p><strong>æ¯æ­¥</strong> å¯ä»¥åˆ é™¤ä»»æ„ä¸€ä¸ªå­—ç¬¦ä¸²ä¸­çš„ä¸€ä¸ªå­—ç¬¦ã€‚</p><p>ç¤ºä¾‹1ï¼š</p><blockquote><p>è¾“å…¥: word1 = â€œseaâ€, word2 = â€œeatâ€<br>è¾“å‡º: 2<br>è§£é‡Š: ç¬¬ä¸€æ­¥å°† â€œseaâ€ å˜ä¸º â€œeaâ€ ï¼Œç¬¬äºŒæ­¥å°† â€œeat â€œå˜ä¸º â€œeaâ€</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">minDistance</span><span class="params">(String word1, String word2)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> word1.length(), m = word2.length();</span><br><span class="line">        <span class="type">int</span>[][] dp = <span class="keyword">new</span> <span class="title class_">int</span>[n+<span class="number">1</span>][m+<span class="number">1</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt;= n; i++) &#123;</span><br><span class="line">            dp[i][<span class="number">0</span>] = i;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt;= m; j++) &#123;</span><br><span class="line">            dp[<span class="number">0</span>][j] = j;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">1</span>; j&lt;= m; j++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (word1.charAt(i-<span class="number">1</span>) == word2.charAt(j-<span class="number">1</span>)) &#123;</span><br><span class="line">                    dp[i][j] = dp[i-<span class="number">1</span>][j-<span class="number">1</span>];</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    dp[i][j] = Math.min(dp[i-<span class="number">1</span>][j]+<span class="number">1</span>, dp[i][j-<span class="number">1</span>]+<span class="number">1</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// System.out.print(dp[i][j] + &quot; &quot;);</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// System.out.println();</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dp[n][m];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    1.å«ä¹‰ï¼šä½¿å¾—word1[0...i-1]å’Œword2[0...j-1]ç›¸åŒæ‰€éœ€æœ€å°æ­¥æ•°ä¸ºdp[i][j]</span></span><br><span class="line"><span class="comment">    2.é€’æ¨å¼ï¼š  å¦‚æœword1[i-1] == word1[j-1]ï¼š</span></span><br><span class="line"><span class="comment">                    dp[i][j] = dp[i-1][j-1]</span></span><br><span class="line"><span class="comment">                å¦åˆ™ï¼š</span></span><br><span class="line"><span class="comment">                    dp[i][j] = min(dp[i-1][j] + 1, dp[i][j-1] + 1)</span></span><br><span class="line"><span class="comment">        å…¶ä¸­dp[i-1][j-1]è¡¨ç¤ºä½¿ç”¨(ä¸åˆ é™¤)word1[i-1]å’Œword2[j-1]</span></span><br><span class="line"><span class="comment">        dp[i-1][j]è¡¨ç¤ºä¸ä½¿ç”¨word1[i-1]ï¼Œå³éœ€è¦åˆ é™¤word1[i-1]ï¼Œæ‰€ä»¥æ­¥æ•°+1</span></span><br><span class="line"><span class="comment">        dp[i][j-1]è¡¨ç¤ºä¸ä½¿ç”¨word2[j-1]ï¼Œå³éœ€è¦åˆ é™¤word2[j-1]ï¼Œæ‰€ä»¥æ­¥æ•°+1</span></span><br><span class="line"><span class="comment">    3.åˆå§‹åŒ–ï¼šdp[0][j] = j, dp[i][0] = i </span></span><br><span class="line"><span class="comment">        å½“æœ‰ä¸€ä¸ªå­—ç¬¦ä¸²ä¸ºç©ºä¸²æ—¶ï¼Œå¦ä¸€ä¸ªå­—ç¬¦ä¸²åªèƒ½åˆ æ‰ä»–çš„æ‰€æœ‰çš„å…ƒç´ ï¼Œæ‰€ä»¥æœ€å°æ­¥æ•°ä¸ºå¦ä¸€ä¸ªå­—ç¬¦ä¸²çš„é•¿åº¦</span></span><br><span class="line"><span class="comment">    4.è®¡ç®—é¡ºåºï¼šå¤–å±‚word1ï¼Œå†…å±‚wordw2ï¼Œä»å°åˆ°å¤§</span></span><br><span class="line"><span class="comment">    5.ä¸¾ä¾‹ï¼šword1 = &quot;sea&quot;, word2 = &quot;eat&quot;</span></span><br><span class="line"><span class="comment">        0 e a t</span></span><br><span class="line"><span class="comment">    0   0 1 2 3</span></span><br><span class="line"><span class="comment">    s   1 2 3 4</span></span><br><span class="line"><span class="comment">    e   2 1 2 3 </span></span><br><span class="line"><span class="comment">    a   3 2 1 2</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><h4 id="72-ç¼–è¾‘è·ç¦»-ç ”ä¸€ç®—æ³•è€ƒè¯•çš„é¢˜ç›®"><a href="#72-ç¼–è¾‘è·ç¦»-ç ”ä¸€ç®—æ³•è€ƒè¯•çš„é¢˜ç›®" class="headerlink" title="72. ç¼–è¾‘è·ç¦»(ç ”ä¸€ç®—æ³•è€ƒè¯•çš„é¢˜ç›®)"></a><a href="https://leetcode.cn/problems/edit-distance/">72. ç¼–è¾‘è·ç¦»</a>(ç ”ä¸€ç®—æ³•è€ƒè¯•çš„é¢˜ç›®)</h4><p>ç»™ä½ ä¸¤ä¸ªå•è¯ word1 å’Œ word2ï¼Œ è¯·è¿”å›å°† word1 è½¬æ¢æˆ word2 æ‰€ä½¿ç”¨çš„æœ€å°‘æ“ä½œæ•°  ã€‚</p><p>ä½ å¯ä»¥å¯¹ä¸€ä¸ªå•è¯è¿›è¡Œå¦‚ä¸‹ä¸‰ç§æ“ä½œï¼š</p><pre><code>æ’å…¥ä¸€ä¸ªå­—ç¬¦åˆ é™¤ä¸€ä¸ªå­—ç¬¦æ›¿æ¢ä¸€ä¸ªå­—ç¬¦</code></pre><p>ç¤ºä¾‹1ï¼š</p><blockquote><p>è¾“å…¥ï¼šword1 = â€œhorseâ€, word2 = â€œrosâ€<br>è¾“å‡ºï¼š3<br>è§£é‡Šï¼š<br>horse -&gt; rorse (å°† â€˜hâ€™ æ›¿æ¢ä¸º â€˜râ€™)<br>rorse -&gt; rose (åˆ é™¤ â€˜râ€™)<br>rose -&gt; ros (åˆ é™¤ â€˜eâ€™)</p></blockquote><p>ç¤ºä¾‹2ï¼š</p><blockquote><p>è¾“å…¥ï¼šword1 = â€œintentionâ€, word2 = â€œexecutionâ€<br>è¾“å‡ºï¼š5<br>è§£é‡Šï¼š<br>intention -&gt; inention (åˆ é™¤ â€˜tâ€™)<br>inention -&gt; enention (å°† â€˜iâ€™ æ›¿æ¢ä¸º â€˜eâ€™)<br>enention -&gt; exention (å°† â€˜nâ€™ æ›¿æ¢ä¸º â€˜xâ€™)<br>exention -&gt; exection (å°† â€˜nâ€™ æ›¿æ¢ä¸º â€˜câ€™)<br>exection -&gt; execution (æ’å…¥ â€˜uâ€™)</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">minDistance</span><span class="params">(String word1, String word2)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> word1.length(), m = word2.length();</span><br><span class="line">        <span class="type">int</span>[][] dp = <span class="keyword">new</span> <span class="title class_">int</span>[n+<span class="number">1</span>][m+<span class="number">1</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt;= n; i++) &#123;</span><br><span class="line">            dp[i][<span class="number">0</span>] = i;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt;= m; j++) &#123;</span><br><span class="line">            dp[<span class="number">0</span>][j] = j;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">1</span>; j&lt;= m; j++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (word1.charAt(i-<span class="number">1</span>) == word2.charAt(j-<span class="number">1</span>)) &#123;</span><br><span class="line">                    dp[i][j] = dp[i-<span class="number">1</span>][j-<span class="number">1</span>];</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    dp[i][j] = Math.min(dp[i-<span class="number">1</span>][j]+<span class="number">1</span>, dp[i][j-<span class="number">1</span>]+<span class="number">1</span>);</span><br><span class="line">                    dp[i][j] = Math.min(dp[i][j], dp[i-<span class="number">1</span>][j-<span class="number">1</span>]+<span class="number">1</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// System.out.print(dp[i][j] + &quot; &quot;);</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// System.out.println();</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dp[n][m];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    1.å«ä¹‰ï¼šword1[0...i-1]è½¬æ¢æˆword2[0...j-1]æ‰€ä½¿ç”¨çš„æœ€å°‘æ“ä½œæ•°ä¸ºdp[i][j]</span></span><br><span class="line"><span class="comment">    2.é€’æ¨å¼ï¼š  å¦‚æœword1[i-1]==word2[j-1]:</span></span><br><span class="line"><span class="comment">                    dp[i][j] = dp[i-1][j-1]</span></span><br><span class="line"><span class="comment">                å¦åˆ™ï¼š</span></span><br><span class="line"><span class="comment">                    dp[i][j] = min(dp[i-1][j-1]+1, dp[i-1][j]+1, dp[i][j-1]+1)</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        å…¶ä¸­dp[i-1][j-1]+1è¡¨ç¤ºè®©word1[i-1]æ›¿æ¢æˆword2[j-1]</span></span><br><span class="line"><span class="comment">        dp[i-1][j]+1è¡¨ç¤ºæŠŠword1[i-1]åˆ é™¤æ‰</span></span><br><span class="line"><span class="comment">        dp[i][j-1]+1è¡¨ç¤ºæŠŠword2[j-1]åˆ é™¤æ‰ï¼ˆç­‰ä»·äºåœ¨word1[i-1]åé¢æ’å…¥ä¸€ä¸ªword2[j-1]ï¼‰</span></span><br><span class="line"><span class="comment">    </span></span><br><span class="line"><span class="comment">    3.åˆå§‹åŒ–ï¼šdp[0][j] = j, dp[i][0] = i </span></span><br><span class="line"><span class="comment">        å½“æœ‰ä¸€ä¸ªå­—ç¬¦ä¸²ä¸ºç©ºä¸²æ—¶ï¼Œå¦ä¸€ä¸ªå­—ç¬¦ä¸²åªèƒ½åˆ æ‰ä»–çš„æ‰€æœ‰çš„å…ƒç´ ï¼Œæ‰€ä»¥æœ€å°æ­¥æ•°ä¸ºå¦ä¸€ä¸ªå­—ç¬¦ä¸²çš„é•¿åº¦</span></span><br><span class="line"><span class="comment">    4.è®¡ç®—é¡ºåºï¼šå¤–å±‚word1ï¼Œå†…å±‚wordw2ï¼Œä»å°åˆ°å¤§</span></span><br><span class="line"><span class="comment">    5.ä¸¾ä¾‹ï¼šword1 = &quot;horse&quot;, word2 = &quot;ros&quot;</span></span><br><span class="line"><span class="comment">        0 r o s</span></span><br><span class="line"><span class="comment">    0   0 1 2 3</span></span><br><span class="line"><span class="comment">    h   1 1 2 3</span></span><br><span class="line"><span class="comment">    o   2 2 1 2</span></span><br><span class="line"><span class="comment">    r   3 2 2 2</span></span><br><span class="line"><span class="comment">    s   4 3 3 2</span></span><br><span class="line"><span class="comment">    e   5 4 4 3</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><h2 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h2><h4 id="647-å›æ–‡å­ä¸²"><a href="#647-å›æ–‡å­ä¸²" class="headerlink" title="647. å›æ–‡å­ä¸²"></a><a href="https://leetcode.cn/problems/palindromic-substrings/">647. å›æ–‡å­ä¸²</a></h4><p>ç»™ä½ ä¸€ä¸ªå­—ç¬¦ä¸² <code>s</code> ï¼Œè¯·ä½ ç»Ÿè®¡å¹¶è¿”å›è¿™ä¸ªå­—ç¬¦ä¸²ä¸­ <strong>å›æ–‡å­ä¸²</strong> çš„æ•°ç›®ã€‚</p><p>ç¤ºä¾‹1ï¼š</p><blockquote><p>è¾“å…¥ï¼šs = â€œabcâ€<br>è¾“å‡ºï¼š3<br>è§£é‡Šï¼šä¸‰ä¸ªå›æ–‡å­ä¸²: â€œaâ€, â€œbâ€, â€œcâ€</p></blockquote><p>ç¤ºä¾‹2ï¼š</p><blockquote><p>è¾“å…¥ï¼šs = â€œaaaâ€<br>è¾“å‡ºï¼š6<br>è§£é‡Šï¼š6ä¸ªå›æ–‡å­ä¸²: â€œaâ€, â€œaâ€, â€œaâ€, â€œaaâ€, â€œaaâ€, â€œaaaâ€</p></blockquote><p>DPè§£æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">countSubstrings</span><span class="params">(String s)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> s.length();</span><br><span class="line">        <span class="type">boolean</span>[][] dp = <span class="keyword">new</span> <span class="title class_">boolean</span>[n][n];</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> n-<span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> i; j &lt; n; j++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (s.charAt(i) == s.charAt(j)) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (i == j) &#123; <span class="comment">// &quot;a&quot;</span></span><br><span class="line">                        dp[i][j] = <span class="literal">true</span>;</span><br><span class="line">                        count++;</span><br><span class="line">                    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (i + <span class="number">1</span> == j) &#123;<span class="comment">// &quot;aa&quot;</span></span><br><span class="line">                        dp[i][j] = <span class="literal">true</span>;</span><br><span class="line">                        count++;</span><br><span class="line">                    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (dp[i+<span class="number">1</span>][j-<span class="number">1</span>]) &#123;<span class="comment">// &quot;aå›æ–‡ä¸²a&quot;</span></span><br><span class="line">                        dp[i][j] = <span class="literal">true</span>;</span><br><span class="line">                        count++;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// for (int i = 0; i &lt; n; i++) &#123;</span></span><br><span class="line">        <span class="comment">//     for (int j = 0; j &lt; n; j++) &#123;</span></span><br><span class="line">        <span class="comment">//         System.out.print(dp[i][j] + &quot; &quot;);</span></span><br><span class="line">        <span class="comment">//     &#125;</span></span><br><span class="line">        <span class="comment">//     System.out.println();</span></span><br><span class="line">        <span class="comment">// &#125;</span></span><br><span class="line">        <span class="keyword">return</span> count;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    1.å«ä¹‰ï¼šdp[i][j]=trueè¡¨ç¤ºs[i..j]æ˜¯å›æ–‡ä¸²ï¼Œfalseè¡¨ç¤ºä¸æ˜¯å›æ–‡ä¸²ã€‚</span></span><br><span class="line"><span class="comment">    2.é€’æ¨å¼ï¼š</span></span><br><span class="line"><span class="comment">            if (s[i] == s[j]) </span></span><br><span class="line"><span class="comment">                if (i==j) dp[i][j] = true  è¿™ç§æƒ…å†µæ˜¯ å•å•ä¸€ä¸ªå­—ç¬¦</span></span><br><span class="line"><span class="comment">                else if (i+1==j) dp[i][j] = true è¿™ç§æƒ…å†µæ˜¯ ä¸¤ä¸ªé‡å¤çš„å­—ç¬¦</span></span><br><span class="line"><span class="comment">                else dp[i][j] = dp[i+1][j-1] å–å†³äºç€ä¸¤ä¸ªç›¸åŒå­—ç¬¦ä¹‹é—´çš„å­—ä¸²æ˜¯ä¸æ˜¯å›æ–‡ä¸²</span></span><br><span class="line"><span class="comment">    3.åˆå§‹åŒ–:dp[i][j] = false</span></span><br><span class="line"><span class="comment">    4.è®¡ç®—é¡ºåºï¼šç”±é€’æ¨å¼çŸ¥ï¼Œdp[i][j]æ˜¯ä»å·¦ä¸‹æ–¹æ¨å‡ºæ¥çš„</span></span><br><span class="line"><span class="comment">            æ‰€ä»¥éå†é¡ºåºä¸ºï¼Œå¤–å±‚i ä»n down to 0, å†…å±‚j ä»0 up to n</span></span><br><span class="line"><span class="comment">    5.ä¸¾ä¾‹ï¼š(æ³¨ï¼ši &gt; j æ˜¯æ— æ„ä¹‰çš„ï¼Œå…¨éƒ½ä¸ºfalse)</span></span><br><span class="line"><span class="comment">    s = &quot;abc&quot;</span></span><br><span class="line"><span class="comment">        a b c</span></span><br><span class="line"><span class="comment">    a   t f f</span></span><br><span class="line"><span class="comment">    b     t f</span></span><br><span class="line"><span class="comment">    c       t</span></span><br><span class="line"><span class="comment">    </span></span><br><span class="line"><span class="comment">    s = &quot;aaa&quot;</span></span><br><span class="line"><span class="comment">        a a a</span></span><br><span class="line"><span class="comment">    a   t t t</span></span><br><span class="line"><span class="comment">    a   f t t</span></span><br><span class="line"><span class="comment">    a   f f t</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">dpè§£æ³•çš„æ—¶é—´å¤æ‚åº¦ï¼šO(nÂ²)</span></span><br><span class="line"><span class="comment">        ç©ºé—´å¤æ‚åº¦ï¼šO(nÂ²)</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><h4 id="516-æœ€é•¿å›æ–‡å­åºåˆ—"><a href="#516-æœ€é•¿å›æ–‡å­åºåˆ—" class="headerlink" title="516. æœ€é•¿å›æ–‡å­åºåˆ—"></a><a href="https://leetcode.cn/problems/longest-palindromic-subsequence/">516. æœ€é•¿å›æ–‡å­åºåˆ—</a></h4><p>ç»™ä½ ä¸€ä¸ªå­—ç¬¦ä¸² s ï¼Œæ‰¾å‡ºå…¶ä¸­æœ€é•¿çš„å›æ–‡å­åºåˆ—ï¼Œå¹¶è¿”å›è¯¥åºåˆ—çš„é•¿åº¦ã€‚</p><p>å­åºåˆ—å®šä¹‰ä¸ºï¼šä¸æ”¹å˜å‰©ä½™å­—ç¬¦é¡ºåºçš„æƒ…å†µä¸‹ï¼Œåˆ é™¤æŸäº›å­—ç¬¦æˆ–è€…ä¸åˆ é™¤ä»»ä½•å­—ç¬¦å½¢æˆçš„ä¸€ä¸ªåºåˆ—ã€‚</p><p>ç¤ºä¾‹1ï¼š</p><blockquote><p>è¾“å…¥ï¼šs = â€œbbbabâ€</p><p>è¾“å‡ºï¼š4</p><p>è§£é‡Šï¼šä¸€ä¸ªå¯èƒ½çš„æœ€é•¿å›æ–‡å­åºåˆ—ä¸º â€œbbbbâ€ ã€‚</p></blockquote><p>DPè§£æ³•1:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">longestPalindromeSubseq</span><span class="params">(String s)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> s.length();</span><br><span class="line">        <span class="type">int</span>[][] dp = <span class="keyword">new</span> <span class="title class_">int</span>[n][n];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> n-<span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> i; j &lt; n; j++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (s.charAt(i) == s.charAt(j)) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (i == j) dp[i][j] = <span class="number">1</span>;</span><br><span class="line">                    <span class="keyword">else</span> <span class="keyword">if</span> (i + <span class="number">1</span> == j) dp[i][j] = <span class="number">2</span>;</span><br><span class="line">                    <span class="keyword">else</span> dp[i][j] = dp[i+<span class="number">1</span>][j-<span class="number">1</span>] + <span class="number">2</span>;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    dp[i][j] = Math.max(dp[i][j-<span class="number">1</span>], dp[i+<span class="number">1</span>][j]);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// for (int i = 0; i &lt; n; i++) &#123;</span></span><br><span class="line">        <span class="comment">//     for (int j = 0; j &lt; n; j++) &#123;</span></span><br><span class="line">        <span class="comment">//         System.out.print(dp[i][j] + &quot; &quot;);</span></span><br><span class="line">        <span class="comment">//     &#125;</span></span><br><span class="line">        <span class="comment">//     System.out.println();</span></span><br><span class="line">        <span class="comment">// &#125;</span></span><br><span class="line">        <span class="keyword">return</span> dp[<span class="number">0</span>][n-<span class="number">1</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    1.å«ä¹‰ï¼šs[i..j]çš„æœ€é•¿å›æ–‡å­åºåˆ—é•¿åº¦ä¸ºdp[i][j]</span></span><br><span class="line"><span class="comment">    2.é€’æ¨å¼ï¼š</span></span><br><span class="line"><span class="comment">        if (s[i] == s[j]) </span></span><br><span class="line"><span class="comment">            if (i==j)   dp[i][j] = 1</span></span><br><span class="line"><span class="comment">            elif (i+1==j) dp[i][j] = 2</span></span><br><span class="line"><span class="comment">            else dp[i][j] = dp[i+1][j-1]+2</span></span><br><span class="line"><span class="comment">        else</span></span><br><span class="line"><span class="comment">            dp[i][j] = max(dp[i][j-1], dp[i+1][j])</span></span><br><span class="line"><span class="comment">    3.åˆå§‹åŒ–ï¼šdp[i][j]] = 0</span></span><br><span class="line"><span class="comment">    4.è®¡ç®—é¡ºåºï¼šç”±é€’æ¨å¼çŸ¥ï¼Œdp[i][j]ç”±å·¦ä¸‹ï¼Œå·¦ï¼Œä¸‹å¾—æ¥ã€‚</span></span><br><span class="line"><span class="comment">            æ‰€ä»¥è®¡ç®—é¡ºåºä¸ºï¼šå¤–å±‚i from n down to 1</span></span><br><span class="line"><span class="comment">                            å†…å±‚j from 0 up to n</span></span><br><span class="line"><span class="comment">    5.ä¸¾ä¾‹ï¼šs = &quot;bbbab&quot;</span></span><br><span class="line"><span class="comment">        b b b a b</span></span><br><span class="line"><span class="comment">    b   1 2 3 3 4</span></span><br><span class="line"><span class="comment">    b   0 1 2 2 3</span></span><br><span class="line"><span class="comment">    b   0 0 1 1 3</span></span><br><span class="line"><span class="comment">    a   0 0 0 1 1</span></span><br><span class="line"><span class="comment">    b   0 0 0 0 1</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><p>DPè§£æ³•2ï¼šå°†åŸé—®é¢˜è½¬æ¢ä¸ºäº†LCSé—®é¢˜</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">longestPalindromeSubseq</span><span class="params">(String s)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> s.length();</span><br><span class="line">        <span class="type">String</span> <span class="variable">t</span> <span class="operator">=</span> reverse(s);</span><br><span class="line">        <span class="type">int</span>[][] dp = <span class="keyword">new</span> <span class="title class_">int</span>[n+<span class="number">1</span>][n+<span class="number">1</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">1</span>; j &lt;= n; j++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (s.charAt(i-<span class="number">1</span>) == t.charAt(j-<span class="number">1</span>)) &#123;</span><br><span class="line">                    dp[i][j] = dp[i-<span class="number">1</span>][j-<span class="number">1</span>] + <span class="number">1</span>;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    dp[i][j] = Math.max(dp[i-<span class="number">1</span>][j], dp[i][j-<span class="number">1</span>]);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// System.out.print(dp[i][j] + &quot; &quot;);</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// System.out.println();</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dp[n][n];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// O(n)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">reverse</span><span class="params">(String s)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> s.length();</span><br><span class="line">        <span class="type">char</span>[] ch = <span class="keyword">new</span> <span class="title class_">char</span>[n];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">            ch[i] = s.charAt(n-i-<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">String</span>(ch);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    é—®é¢˜è½¬æ¢ï¼šå°†sç¿»è½¬å¾—åˆ°tï¼Œæ±‚så’Œtçš„æœ€é•¿å…¬å…±å­åºåˆ—</span></span><br><span class="line"><span class="comment">    å¦‚ï¼Œs = &quot;bbbab&quot;, t = &quot;babbb&quot; ä»–ä»¬çš„LCS = &quot;bbb&quot;å³ä¸ºsçš„æœ€é•¿å›æ–‡å­åºåˆ—</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    1.å«ä¹‰ï¼šs[0...i-1]å’Œt[0...j-1]çš„LCSä¸ºdp[i][j]</span></span><br><span class="line"><span class="comment">    2.é€’æ¨å¼ï¼š</span></span><br><span class="line"><span class="comment">        if (s[i-1]==t[j-1])</span></span><br><span class="line"><span class="comment">            dp[i][j] = dp[i-1][j-1] + 1</span></span><br><span class="line"><span class="comment">        else</span></span><br><span class="line"><span class="comment">            dp[i][j] = Math.max(dp[i-1][j], dp[i][j-1])</span></span><br><span class="line"><span class="comment">    3.åˆå§‹åŒ–ï¼š dp[0][j] = 0, dp[i][0] = 0</span></span><br><span class="line"><span class="comment">    4.è®¡ç®—é¡ºåºï¼šå¤–å±‚sï¼Œå†…å±‚tï¼Œéƒ½æ˜¯ä»å°åˆ°å¤§</span></span><br><span class="line"><span class="comment">    5.ä¸¾ä¾‹ï¼šs = &quot;bbbab&quot;, t = &quot;babbb&quot; </span></span><br><span class="line"><span class="comment">        0 b a b b b</span></span><br><span class="line"><span class="comment">    0   0 0 0 0 0 0</span></span><br><span class="line"><span class="comment">    b   0 1 1 1 1 1</span></span><br><span class="line"><span class="comment">    b   0 1 1 2 2 2</span></span><br><span class="line"><span class="comment">    b   0 1 1 2 3 3</span></span><br><span class="line"><span class="comment">    a   0 1 2 2 3 3</span></span><br><span class="line"><span class="comment">    b   0 1 2 3 3 4</span></span><br><span class="line"><span class="comment">*/</span> </span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ç®—æ³• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> dp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è®¡ç®—æœºç½‘ç»œ</title>
      <link href="/post/3.html"/>
      <url>/post/3.html</url>
      
        <content type="html"><![CDATA[<h1 id="1-UDP"><a href="#1-UDP" class="headerlink" title="1.UDP"></a>1.UDP</h1><ol><li>UDPæ˜¯==æ— è¿æ¥==çš„ï¼Œå‡å°‘å¼€é”€å’Œå‘é€æ•°æ®ä¹‹å‰çš„æ—¶å»¶</li><li>UDPä½¿ç”¨æœ€å¤§åŠªåŠ›äº¤ä»˜ï¼Œå³==ä¸ä¿è¯å¯é äº¤ä»˜==</li><li>UDPæ˜¯==é¢å‘æŠ¥æ–‡çš„==ï¼Œé€‚åˆä¸€æ¬¡æ€§ä¼ è¾“å°‘é‡æ•°æ®çš„ç½‘ç»œåº”ç”¨<ul><li>ï¼ˆåº”ç”¨å±‚ç»™UDPå¤šé•¿çš„æŠ¥æ–‡ï¼ŒUDPå°±å‘é€å¤šé•¿çš„æŠ¥æ–‡ï¼Œå³ä¸€æ¬¡å‘ä¸€ä¸ªå®Œæ•´æŠ¥æ–‡ï¼‰</li></ul></li><li>UDP==æ— æ‹¥å¡æ§åˆ¶==ï¼Œé€‚åˆå¾ˆå¤šå®æ—¶åº”ç”¨ã€‚ä¹Ÿ==ä¸æä¾›æµé‡æ§åˆ¶ã€‚==</li><li>UDPé¦–éƒ¨å¼€é”€å°ã€‚8Bã€‚ï¼ˆTCPæ˜¯20Bï¼‰</li></ol><p><img src="http://cdn.leesin.fun/typora/s3/img/UDPæŠ¥æ–‡ç»“æ„.png" alt="UDPæŠ¥æ–‡ç»“æ„"></p><h1 id="2-TCP"><a href="#2-TCP" class="headerlink" title="2.TCP"></a>2.TCP</h1><ol><li>TCPæ˜¯==é¢å‘è¿æ¥==çš„ä¼ è¾“å±‚åè®®</li><li>æ¯ä¸€æ¡TCPè¿æ¥åªèƒ½æœ‰ä¸¤ä¸ªç«¯ç‚¹ï¼Œåªèƒ½æ˜¯==ç‚¹å¯¹ç‚¹çš„==</li><li>TCPæä¾›==å¯é ==äº¤ä»˜çš„æœåŠ¡ã€‚æ— å·®é”™ã€ä¸ä¸¢å¤±ã€ä¸é‡å¤ã€æŒ‰éœ€åˆ°è¾¾ã€‚</li><li>TCPæä¾›==å…¨åŒå·¥é€šä¿¡==</li><li>TCP==é¢å‘å­—èŠ‚æµ==</li></ol><p><img src="http://cdn.leesin.fun/typora/s3/img/TCPæŠ¥æ–‡æ®µ.png" alt="TCPæŠ¥æ–‡æ®µ"></p><blockquote><p> æ§åˆ¶ä½ä¾æ¬¡æ˜¯URGã€ACKã€PSHã€RSTã€SYNã€FIN</p><p>SYNåªæœ‰åœ¨ä¸¤ç§æƒ…å†µä¸‹ç½®ä¸º1ï¼šâ‘ è¿æ¥è¯·æ±‚  â‘¡è¿æ¥è¯·æ±‚çš„æ¥å—/ç¡®è®¤</p></blockquote><p>TCPè¿æ¥ä¼ è¾“çš„ä¸‰ä¸ªé˜¶æ®µï¼šè¿æ¥å»ºç«‹ â€”â€”&gt; æ•°æ®ä¼ é€ â€”â€”&gt; è¿æ¥é‡Šæ”¾</p><h2 id="2-1-ä¸‰æ¬¡æ¡æ‰‹"><a href="#2-1-ä¸‰æ¬¡æ¡æ‰‹" class="headerlink" title="2.1.ä¸‰æ¬¡æ¡æ‰‹"></a>2.1.ä¸‰æ¬¡æ¡æ‰‹</h2><p><img src="http://cdn.leesin.fun/typora/s3/img/TCPä¸‰æ¬¡æ¡æ‰‹.png" alt="TCPä¸‰æ¬¡æ¡æ‰‹"></p><blockquote><p>ç¬¬ä¸€æ¬¡å’Œç¬¬äºŒæ¬¡ä¸æºå¸¦æ•°æ®ï¼Œç¬¬ä¸‰æ¬¡å¯ä»¥æºå¸¦æ•°æ®ã€‚</p><p>SYNæ´ªèŒƒæ”»å‡»ï¼šæœåŠ¡ç«¯çš„èµ„æºæ˜¯åœ¨ç¬¬äºŒæ¬¡æ¡æ‰‹æ—¶åˆ†é…çš„ï¼Œå¦‚æœæ”»å‡»è€…ä¸æ–­å‘é€ä¸‰æ¬¡æ¡æ‰‹çš„ç¬¬ä¸€ä¸ªæ•°æ®åŒ…ï¼Œå´ä¸å‘é€ç¬¬ä¸‰ä¸ªç¡®è®¤åŒ…ï¼Œé‚£ä¹ˆæœåŠ¡ç«¯çš„èµ„æºå°±ä¼šè¢«æ¶ˆè€—å ç”¨ã€‚</p></blockquote><h2 id="2-2-å››æ¬¡æŒ¥æ‰‹"><a href="#2-2-å››æ¬¡æŒ¥æ‰‹" class="headerlink" title="2.2.å››æ¬¡æŒ¥æ‰‹"></a>2.2.å››æ¬¡æŒ¥æ‰‹</h2><p><img src="http://cdn.leesin.fun/typora/s3/img/TCPå››æ¬¡æŒ¥æ‰‹.png" alt="TCPå››æ¬¡æŒ¥æ‰‹"></p><h2 id="2-3-å¯é ä¼ è¾“"><a href="#2-3-å¯é ä¼ è¾“" class="headerlink" title="2.3.å¯é ä¼ è¾“"></a>2.3.å¯é ä¼ è¾“</h2><h3 id="2-3-1-åºå·"><a href="#2-3-1-åºå·" class="headerlink" title="2.3.1.åºå·"></a>2.3.1.åºå·</h3><p>â€‹    TCPé¦–éƒ¨çš„<strong>åºå·å­—æ®µ</strong>ç”¨æ¥==ä¿è¯æ•°æ®æœ‰åºæäº¤==ç»™åº”ç”¨å±‚ï¼ŒTCPæŠŠæ•°æ®è§†ä¸ºä¸€ä¸ªæ— ç»“æ„ä½†æœ‰åºçš„å­—èŠ‚æµï¼Œå°†å­—èŠ‚æµä¸Šçš„æ¯ä¸€ä¸ªå­—èŠ‚éƒ½ç¼–ä¸Šä¸€ä¸ªåºå·ï¼Œåºå·å­—æ®µçš„å€¼æ˜¯æŒ‡æœ¬æŠ¥æ–‡æ®µæ‰€å‘é€çš„æ•°æ®çš„ç¬¬ä¸€ä¸ªå­—èŠ‚çš„åºå·ã€‚</p><p>â€‹    å¦‚å›¾æ‰€ç¤ºï¼Œç¬¬ä¸€ä¸ªæŠ¥æ–‡åŒ…å«ç¬¬0~2ä¸ªå­—èŠ‚ï¼Œåˆ™è¯¥TCPæŠ¥æ–‡æ®µçš„åºå·æ˜¯0ï¼Œç¬¬äºŒä¸ªæŠ¥æ–‡æ®µçš„åºå·æ˜¯3ã€‚</p><p><img src="http://cdn.leesin.fun/typora/s3/img/Açš„å‘é€ç¼“å­˜åŒºä¸­çš„æ•°æ®åˆ’åˆ†æˆTCPæ®µ.png" alt="Açš„å‘é€ç¼“å­˜åŒºä¸­çš„æ•°æ®åˆ’åˆ†æˆTCPæ®µ"></p><h3 id="2-3-2-ç¡®è®¤"><a href="#2-3-2-ç¡®è®¤" class="headerlink" title="2.3.2.ç¡®è®¤"></a>2.3.2.ç¡®è®¤</h3><ul><li>TCPé¦–éƒ¨çš„<strong>ç¡®è®¤å·</strong>æ˜¯æœŸæœ›æ”¶åˆ°å¯¹æ–¹çš„ä¸‹ä¸€ä¸ªæŠ¥æ–‡æ®µçš„æ•°æ®çš„ç¬¬ä¸€ä¸ªå­—èŠ‚çš„åºå·ã€‚<ul><li>å¦‚ä¸Šå›¾ï¼Œå¦‚æœæ¥æ”¶æ–¹Bå·²æ”¶åˆ°ç¬¬ä¸€ä¸ªæŠ¥æ–‡æ®µï¼Œæ­¤æ—¶Bä¼šå‘é€ç»™Açš„æŠ¥æ–‡ä¸­çš„ç¡®è®¤å·å­—æ®µä¸º3ã€‚</li></ul></li><li>å‘é€æ–¹ä¼šç¼“å­˜é‚£äº›å·²ç»å·²å‘é€ä½†æœªæ”¶åˆ°ç¡®è®¤çš„æŠ¥æ–‡æ®µï¼Œä»¥ä¾¿åœ¨éœ€è¦æ—¶é‡ä¼ ã€‚ï¼ˆæ»‘åŠ¨çª—å£ï¼‰</li><li>TCPé»˜è®¤ä½¿ç”¨<strong>ç´¯ç§¯ç¡®è®¤</strong>ã€‚</li></ul><h3 id="2-3-3-é‡ä¼ "><a href="#2-3-3-é‡ä¼ " class="headerlink" title="2.3.3.é‡ä¼ "></a>2.3.3.é‡ä¼ </h3><p>ä¸¤ç§äº‹ä»¶ä¼šå¯¼è‡´TCPå¯¹æŠ¥æ–‡æ®µè¿›è¡Œé‡ä¼ ï¼š==è¶…æ—¶== å’Œ ==3ä¸ªå†—ä½™ACK==</p><ol><li>è¶…æ—¶</li></ol><p>å¤šä¹…è¶…æ—¶é‡ä¼ ï¼Ÿâ­â­â­TCPä¿ç•™äº†RTTçš„ä¸€ä¸ªåŠ æƒå¹³å‡å¾€è¿”æ—¶é—´RTTsï¼Œå®ƒä¼šéšæ–°æµ‹é‡RTTæ ·æœ¬å€¼çš„å˜åŒ–è€Œå˜åŒ–ã€‚è¶…æ—¶è®¡æ—¶å™¨è®¾ç½®çš„è¶…æ—¶é‡ä¼ æ—¶é—´åº”ç•¥å¤§äºRTTsï¼Œä½†ä¹Ÿä¸èƒ½å¤§å¤ªå¤šï¼Œå¦åˆ™å½“æŠ¥æ–‡æ®µä¸¢å¤±æ—¶ï¼ŒTCPä¸èƒ½å¾ˆå¿«é‡ä¼ ï¼Œå¯¼è‡´æ•°æ®ä¼ è¾“æ—¶å»¶å¤§ã€‚</p><ol><li>å†—ä½™ACK</li></ol><p>è¶…æ—¶é‡ä¼ å­˜åœ¨çš„é—®é¢˜æ˜¯è¶…æ—¶å‘¨æœŸå¾€å¾€å¤ªé•¿äº†ã€‚    </p><p>æ¯”å¦‚Aå‘é€äº†åºå·ä¸º1ã€2ã€3ã€4ã€5çš„TCPæŠ¥æ–‡æ®µï¼Œå…¶ä¸­2å·ä¸¢å¤±äº†ï¼Œå› æ­¤3ã€4ã€5å·æŠ¥æ–‡æ®µå¯¹äºBæ¥è¯´å°±æ˜¯å¤±åºæŠ¥æ–‡æ®µã€‚TCPè§„å®šæ—¶åºæŠ¥æ–‡æ®µåˆ°è¾¾æ—¶ï¼Œå°±å‘é€ä¸€ä¸ªå†—ä½™ACKï¼ŒæŒ‡æ˜ä¸‹ä¸€ä¸ªæœŸå¾…å­—èŠ‚çš„åºå·ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ3ã€4ã€5å·æŠ¥æ–‡æ®µåˆ°è¾¾Bï¼Œé‚£ä¹ˆBå°±ä¼šå‘é€3ä¸ªå¯¹2å·æŠ¥æ–‡æ®µçš„å†—ä½™ACKï¼Œè¡¨æ˜è‡ªå·±å¸Œæœ›æ¥æ”¶åˆ°2å·æŠ¥æ–‡æ®µã€‚ç„¶åAæ¥æ”¶åˆ°äº†3ä¸ªå†—ä½™ACKåï¼ŒAä¼šè®¤ä¸º2å·å·²ç»ä¸¢å¤±äº†ï¼Œä¼šç«‹å³å¯¹2å·æŠ¥æ–‡æ‰§è¡Œé‡ä¼ ï¼Œè¿™ç§æŠ€æœ¯ç§°ä¸º<strong>å¿«é‡ä¼ </strong>ã€‚</p><h2 id="2-4-æµé‡æ§åˆ¶"><a href="#2-4-æµé‡æ§åˆ¶" class="headerlink" title="2.4.æµé‡æ§åˆ¶"></a>2.4.æµé‡æ§åˆ¶</h2><p>â€‹        TCPæä¾›æµé‡æ§åˆ¶æœåŠ¡æ¥æ¶ˆé™¤å‘é€æ–¹ï¼ˆå‘é€é€Ÿç‡å¤ªå¿«ï¼‰ä½¿æ¥æ”¶æ–¹ç¼“å­˜åŒºæº¢å‡ºçš„å¯èƒ½æ€§ï¼Œå› æ­¤å¯ä»¥è¯´==æµé‡æ§åˆ¶æ˜¯ä¸€ä¸ªé€Ÿåº¦åŒ¹é…æœåŠ¡ï¼ˆåŒ¹é…å‘é€æ–¹çš„å‘é€é€Ÿç‡ä¸æ¥æ”¶æ–¹çš„å‘é€é€Ÿç‡ï¼‰==ã€‚</p><p>â€‹        TCPæä¾›ä¸€ç§åŸºäº <strong>æ»‘åŠ¨çª—å£åè®® </strong> çš„æµé‡æ§åˆ¶æœºåˆ¶ã€‚</p><p>â€‹        åœ¨é€šä¿¡è¿‡ç¨‹ä¸­ï¼Œæ¥æ”¶æ–¹æ ¹æ®è‡ªå·±æ¥æ”¶ç¼“å­˜çš„å¤§å°ï¼ŒåŠ¨æ€åœ°è°ƒæ•´å‘é€æ–¹çš„å‘é€çª—å£å¤§å°ï¼Œè¿™ç§°ä¸ºæ¥æ”¶çª—å£rwndï¼Œå³è°ƒæ•´TCPæŠ¥æ–‡æ®µé¦–éƒ¨çš„â€çª—å£â€œå­—æ®µå€¼ï¼Œæ¥é™åˆ¶å‘é€æ–¹å‘ç½‘æ ¼æ³¨å…¥æŠ¥æ–‡çš„é€Ÿç‡ã€‚åŒæ—¶ï¼Œå‘é€æ–¹æ ¹æ®å…¶å¯¹å½“å‰ç½‘ç»œæ‹¥å¡ç¨‹åº¦çš„ä¼°è®¡è€Œç¡®å®šçš„çª—å£ä¹‹ï¼Œç§°ä¸ºæ‹¥å¡çª—å£cwndã€‚å‘é€æ–¹çš„å‘é€çª—å£=min(rwnd, cwnd)</p><p>â€‹        ä¸¾ä¾‹ï¼Œå¦‚å›¾æ‰€ç¤ºã€‚</p><p><img src="http://cdn.leesin.fun/typora/s3/img/TCPæµé‡æ§åˆ¶ä¸¾ä¾‹.png" alt="TCPæµé‡æ§åˆ¶ä¸¾ä¾‹"></p><h2 id="2-5-æ‹¥å¡æ§åˆ¶"><a href="#2-5-æ‹¥å¡æ§åˆ¶" class="headerlink" title="2.5.æ‹¥å¡æ§åˆ¶"></a>2.5.æ‹¥å¡æ§åˆ¶</h2><p>â€‹        ==æ‹¥å¡æ§åˆ¶æ˜¯é˜²æ­¢è¿‡å¤šçš„æ•°æ®æ³¨å…¥ç½‘ç»œï¼Œä¿è¯ç½‘ç»œä¸­çš„è·¯ç”±å™¨æˆ–é“¾è·¯ä¸ä¼šè¿‡è½½ã€‚==</p><h3 id="2-5-1-æ…¢å¼€å§‹å’Œæ‹¥å¡æ§åˆ¶"><a href="#2-5-1-æ…¢å¼€å§‹å’Œæ‹¥å¡æ§åˆ¶" class="headerlink" title="2.5.1.æ…¢å¼€å§‹å’Œæ‹¥å¡æ§åˆ¶"></a>2.5.1.æ…¢å¼€å§‹å’Œæ‹¥å¡æ§åˆ¶</h3><ul><li>cwnd&lt;ssthreshï¼šæ…¢å¼€å§‹ç®—æ³•</li><li>cwnd&gt;ssthreshï¼šæ‹¥å¡é¿å…ç®—æ³•</li></ul><p>ç½‘ç»œæ‹¥å¡çš„å¤„ç†ï¼šæŠŠæ…¢å¼€å§‹é—¨é™ssthreshè®¾ç½®ä¸ºå‡ºç°æ‹¥å¡æ—¶çš„å‘é€æ–¹çš„cwndå€¼çš„ä¸€åŠï¼Œç„¶åå°†cwndè®¾ç½®ä¸º1å¼€å§‹æ…¢å¼€å§‹ç®—æ³•ã€‚</p><p><img src="http://cdn.leesin.fun/typora/s3/img/æ…¢å¼€å§‹å’Œæ‹¥å¡é¿å…ç®—æ³•çš„å®ç°è¿‡ç¨‹.png" alt="æ…¢å¼€å§‹å’Œæ‹¥å¡é¿å…ç®—æ³•çš„å®ç°è¿‡ç¨‹"></p><h3 id="2-5-2-å¿«é‡ä¼ å’Œå¿«æ¢å¤"><a href="#2-5-2-å¿«é‡ä¼ å’Œå¿«æ¢å¤" class="headerlink" title="2.5.2.å¿«é‡ä¼ å’Œå¿«æ¢å¤"></a>2.5.2.å¿«é‡ä¼ å’Œå¿«æ¢å¤</h3><p>å¿«é‡ä¼ å’Œå¿«æ¢å¤ç®—æ³•æ˜¯å¯¹æ…¢å¼€å§‹å’Œæ‹¥å¡é¿å…ç®—æ³•çš„æ”¹è¿›ã€‚</p><ol><li>å¿«é‡ä¼ </li></ol><p>â€‹        åœ¨TCPçš„å¯é ä¼ è¾“æœºåˆ¶ä¸­ï¼Œå¿«é‡ä¼ æŠ€æœ¯ä½¿ç”¨äº†å†—ä½™ACKæ¥æ£€æµ‹ä¸¢åŒ…çš„å‘ç”Ÿã€‚åŒæ ·ï¼Œå†—ä½™ACKä¹Ÿç”¨äºç½‘ç»œæ‹¥å¡çš„æ£€æµ‹ï¼ˆä¸¢åŒ…äº†å½“ç„¶æ„å‘³ç€ç½‘ç»œå¯èƒ½å‡ºç°äº†æ‹¥å¡ï¼‰ã€‚å¿«é‡ä¼ å¹¶éå–æ¶ˆé‡ä¼ è®¡æ—¶å™¨ï¼Œè€Œæ˜¯åœ¨æŸäº›æƒ…å†µä¸‹å¯æ›´æ—©åœ°é‡ä¼ ä¸¢å¤±çš„æŠ¥æ–‡æ®µã€‚</p><p>â€‹        å½“å‘é€æ–¹è¿ç»­æ”¶åˆ°ä¸‰ä¸ªé‡å¤çš„ACKæŠ¥æ–‡æ—¶ï¼Œç›´æ¥é‡ä¼ å¯¹æ–¹å°šæœªæ”¶åˆ°çš„æŠ¥æ–‡æ®µï¼Œ<strong>è€Œä¸å¿…ç­‰å¾…é‚£ä¸ªæŠ¥æ–‡æ®µè®¾ç½®çš„é‡ä¼ è®¡æ—¶å™¨è¶…æ—¶ã€‚</strong></p><ol><li>å¿«æ¢å¤</li></ol><p>â€‹        åŸç†å¦‚ä¸‹ï¼šå½“å‘é€æ–¹è¿ç»­æ”¶åˆ°ä¸‰ä¸ªå†—ä½™ACKæ—¶ï¼Œç›´æ¥å°†æ…¢å¼€å§‹é—¨é™ssthreshè®¾ç½®ä¸ºæ­¤æ—¶å‘é€æ–¹cwndçš„ä¸€åŠã€‚ä»–ä¸æ…¢å¼€å§‹ä¸åŒä¹‹å¤„æ˜¯å®ƒæŠŠcwndä¹Ÿè®¾ç½®ä¸ºå½“å‰cwndçš„ä¸€åŠï¼Œè€Œä¸æ˜¯å°†cwndè®¾ç½®ä¸º1ï¼Œç„¶åå¼€å§‹æ‰§è¡Œæ‹¥å¡é¿å…ç®—æ³•ï¼Œä½¿æ‹¥å¡çª—å£ç¼“æ…¢åœ°çº¿æ€§å¢å¤§ã€‚ç›¸å½“äºæ˜¯è·³è¿‡äº†æ‹¥å¡çª—å£cwndä»1å¼€å§‹çš„æ…¢å¼€å§‹è¿‡ç¨‹ï¼Œæ‰€ä»¥è¢«ç§°ä¸ºå¿«æ¢å¤ã€‚</p><p><img src="http://cdn.leesin.fun/typora/s3/img/å¿«é‡ä¼ å’Œå¿«æ¢å¤ç®—æ³•çš„å®ç°è¿‡ç¨‹.png" alt="å¿«é‡ä¼ å’Œå¿«æ¢å¤ç®—æ³•çš„å®ç°è¿‡ç¨‹"></p><h2 id="2-6-æµé‡æ§åˆ¶å’Œæ‹¥å¡æ§åˆ¶"><a href="#2-6-æµé‡æ§åˆ¶å’Œæ‹¥å¡æ§åˆ¶" class="headerlink" title="2.6.æµé‡æ§åˆ¶å’Œæ‹¥å¡æ§åˆ¶"></a>2.6.æµé‡æ§åˆ¶å’Œæ‹¥å¡æ§åˆ¶</h2><p>â€‹        æ‹¥å¡æ§åˆ¶å’Œæµé‡æ§åˆ¶çš„åŒºåˆ«ï¼šæ‹¥å¡æ§åˆ¶æ˜¯è®©ç½‘ç»œèƒ½å¤Ÿæ‰¿å—ç°æœ‰çš„ç½‘ç»œè´Ÿè·ï¼Œæ˜¯ä¸€ä¸ªå…¨å±€æ€§çš„è¿‡ç¨‹ï¼Œæ¶‰åŠæ‰€æœ‰çš„ä¸»æœºã€æ‰€æœ‰çš„è·¯ç”±å™¨ï¼Œä»¥åŠä¸é™ä½ç½‘ç»œä¼ è¾“æ€§èƒ½æœ‰å…³çš„æ‰€æœ‰å› ç´ ã€‚ç›¸åï¼Œæµé‡æ§åˆ¶å¾€å¾€æ˜¯æŒ‡ç‚¹å¯¹ç‚¹çš„é€šä¿¡é‡çš„æ§åˆ¶ï¼Œæ˜¯ä¸ªç«¯åˆ°ç«¯çš„é—®é¢˜ï¼Œå®ƒæ‰€è¦åšçš„æ˜¯æŠ‘åˆ¶å‘é€ç«¯å‘é€æ•°æ®çš„é€Ÿç‡ï¼Œä»¥ä¾¿ä½¿æ¥æ”¶ç«¯æ¥å¾—åŠæ¥æ”¶ã€‚</p><p>â€‹        å½“ç„¶ï¼Œæ‹¥å¡æ§åˆ¶å’Œæµé‡æ§åˆ¶ä¹Ÿæœ‰ç›¸ä¼¼çš„åœ°æ–¹ï¼Œå³å®ƒä»¬éƒ½é€šè¿‡æ§åˆ¶å‘é€æ–¹å‘é€æ•°æ®çš„é€Ÿç‡æ¥è¾¾åˆ°æ§åˆ¶æ•ˆæœã€‚</p><h1 id="3-HTTP"><a href="#3-HTTP" class="headerlink" title="3.HTTP"></a>3.HTTP</h1><p><img src="http://cdn.leesin.fun/typora/s3/img/HTTPè¯·æ±‚çš„å®Œæ•´è¿‡ç¨‹.png" alt="HTTPè¯·æ±‚çš„å®Œæ•´è¿‡ç¨‹"></p><h2 id="3-1-HTTP-1-1çš„ç¼ºé™·"><a href="#3-1-HTTP-1-1çš„ç¼ºé™·" class="headerlink" title="3.1.HTTP/1.1çš„ç¼ºé™·"></a>3.1.HTTP/1.1çš„ç¼ºé™·</h2><h3 id="3-1-1-é«˜å»¶è¿Ÿ-å¸¦æ¥é¡µé¢åŠ è½½é€Ÿåº¦çš„é™ä½"><a href="#3-1-1-é«˜å»¶è¿Ÿ-å¸¦æ¥é¡µé¢åŠ è½½é€Ÿåº¦çš„é™ä½" class="headerlink" title="3.1.1.é«˜å»¶è¿Ÿ - å¸¦æ¥é¡µé¢åŠ è½½é€Ÿåº¦çš„é™ä½"></a>3.1.1.é«˜å»¶è¿Ÿ - å¸¦æ¥é¡µé¢åŠ è½½é€Ÿåº¦çš„é™ä½</h3><p>ç½‘ç»œå»¶è¿Ÿé—®é¢˜ä¸»è¦ç”±äºé˜Ÿå¤´é˜»å¡ (Head-Of-Line Blocking)äº§ç”Ÿï¼Œå¯¼è‡´å¸¦å®½æ— æ³•è¢«å……åˆ†åˆ©ç”¨ã€‚</p><p>é’ˆå¯¹å¯¹å¤´é˜»å¡ï¼Œæœ‰å°è¯•è¿‡ä»¥ä¸‹è§£å†³æ–¹æ¡ˆï¼š</p><ul><li>å°†åŒä¸€é¡µé¢çš„èµ„æºåˆ†æ•£åˆ°ä¸åŒåŸŸåä¸‹ï¼Œæå‡è¿æ¥ä¸Šé™ã€‚<strong>Chrome æœ‰ä¸ªæœºåˆ¶ï¼Œå¯¹äºåŒä¸€ä¸ªåŸŸåï¼Œé»˜è®¤å…è®¸åŒæ—¶å»ºç«‹ 6 ä¸ª TCP æŒä¹…è¿æ¥ã€‚</strong>ä½¿ç”¨æŒä¹…è¿æ¥æ—¶ï¼Œè™½ç„¶èƒ½å…±ç”¨ä¸€ä¸ª TCP ç®¡é“ï¼Œ<strong>ä½†æ˜¯åœ¨ä¸€ä¸ªç®¡é“ä¸­åŒä¸€æ—¶åˆ»åªèƒ½å¤„ç†ä¸€ä¸ªè¯·æ±‚</strong>ï¼Œåœ¨å½“å‰çš„è¯·æ±‚æ²¡æœ‰ç»“æŸä¹‹å‰ï¼Œå…¶ä»–çš„è¯·æ±‚åªèƒ½å¤„äºé˜»å¡çŠ¶æ€ã€‚å¦å¤–ï¼Œå¦‚æœåœ¨åŒä¸€ä¸ªåŸŸåä¸‹åŒæ—¶æœ‰ 10 ä¸ªè¯·æ±‚å‘ç”Ÿï¼Œé‚£ä¹ˆå…¶ä¸­ 4 ä¸ªè¯·æ±‚ä¼šè¿›å…¥æ’é˜Ÿç­‰å¾…çŠ¶æ€ï¼Œç›´è‡³è¿›è¡Œä¸­çš„è¯·æ±‚å®Œæˆã€‚</li><li>Spriting åˆå¹¶å¤šå¼ å°å›¾ä¸ºä¸€å¼ å¤§å›¾, å†ç”¨ JavaScript æˆ–è€… CSS å°†å°å›¾é‡æ–°â€œåˆ‡å‰²â€å‡ºæ¥çš„æŠ€æœ¯ã€‚</li><li>ç­‰ç­‰</li></ul><h3 id="3-1-2-æ— çŠ¶æ€ç‰¹æ€§-â€“-å¸¦æ¥å·¨å¤§çš„-HTTP-å¤´éƒ¨"><a href="#3-1-2-æ— çŠ¶æ€ç‰¹æ€§-â€“-å¸¦æ¥å·¨å¤§çš„-HTTP-å¤´éƒ¨" class="headerlink" title="3.1.2.æ— çŠ¶æ€ç‰¹æ€§ â€“ å¸¦æ¥å·¨å¤§çš„ HTTP å¤´éƒ¨"></a>3.1.2.æ— çŠ¶æ€ç‰¹æ€§ â€“ å¸¦æ¥å·¨å¤§çš„ HTTP å¤´éƒ¨</h3><p>Header é‡Œæºå¸¦çš„å†…å®¹è¿‡å¤§ï¼Œåœ¨ä¸€å®šç¨‹åº¦ä¸Šå¢åŠ äº†ä¼ è¾“æˆæœ¬ã€‚æ›´è¦å‘½çš„æ˜¯ï¼Œæˆåƒä¸Šä¸‡çš„è¯·æ±‚å“åº”æŠ¥æ–‡é‡Œæœ‰å¾ˆå¤šå­—æ®µå€¼éƒ½æ˜¯é‡å¤çš„ï¼Œéå¸¸æµªè´¹ã€‚</p><h3 id="3-1-3-æ˜æ–‡ä¼ è¾“-â€“-å¸¦æ¥ä¸å®‰å…¨æ€§"><a href="#3-1-3-æ˜æ–‡ä¼ è¾“-â€“-å¸¦æ¥ä¸å®‰å…¨æ€§" class="headerlink" title="3.1.3.æ˜æ–‡ä¼ è¾“ â€“ å¸¦æ¥ä¸å®‰å…¨æ€§"></a>3.1.3.æ˜æ–‡ä¼ è¾“ â€“ å¸¦æ¥ä¸å®‰å…¨æ€§</h3><p>HTTP/1.1 åœ¨ä¼ è¾“æ•°æ®æ—¶ï¼Œæ‰€æœ‰ä¼ è¾“çš„å†…å®¹éƒ½æ˜¯æ˜æ–‡ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯éƒ½æ— æ³•éªŒè¯å¯¹æ–¹çš„èº«ä»½ï¼Œè¿™åœ¨ä¸€å®šç¨‹åº¦ä¸Šæ— æ³•ä¿è¯æ•°æ®çš„å®‰å…¨æ€§ã€‚</p><h3 id="3-1-4-ä¸æ”¯æŒæœåŠ¡å™¨æ¨é€æ¶ˆæ¯"><a href="#3-1-4-ä¸æ”¯æŒæœåŠ¡å™¨æ¨é€æ¶ˆæ¯" class="headerlink" title="3.1.4.ä¸æ”¯æŒæœåŠ¡å™¨æ¨é€æ¶ˆæ¯"></a>3.1.4.ä¸æ”¯æŒæœåŠ¡å™¨æ¨é€æ¶ˆæ¯</h3><p>æœåŠ¡å™¨åªèƒ½è¢«åŠ¨åœ°å“åº”æ¶ˆæ¯</p><h3 id="3-1-5-æ€»ç»“"><a href="#3-1-5-æ€»ç»“" class="headerlink" title="3.1.5.æ€»ç»“"></a>3.1.5.æ€»ç»“</h3><p>å®‰å…¨ä¸è¶³å’Œæ€§èƒ½ä¸é«˜</p><h2 id="3-2-SPDYåè®®"><a href="#3-2-SPDYåè®®" class="headerlink" title="3.2.SPDYåè®®"></a>3.2.SPDYåè®®</h2><p>ä¸Šé¢æˆ‘ä»¬æåˆ°, ç”±äº HTTP/1.x çš„ç¼ºé™·ï¼Œæˆ‘ä»¬ä¼šå¼•å…¥é›ªç¢§å›¾ã€å°†å°å›¾å†…è”ã€ä½¿ç”¨å¤šä¸ªåŸŸåç­‰æ–¹å¼æ¥æé«˜æ€§èƒ½ï¼Œä¸è¿‡è¿™äº›ä¼˜åŒ–éƒ½ç»•å¼€äº†åè®®ã€‚ç›´åˆ° 2009 å¹´ï¼Œè°·æ­Œå…¬å¼€äº†è‡ªè¡Œç ”å‘çš„ SPDY åè®®ï¼Œä¸»è¦è§£å†³ HTTP/1.1 æ•ˆç‡ä¸é«˜çš„é—®é¢˜ã€‚è°·æ­Œæ¨å‡º SPDYï¼Œæ‰ç®—æ˜¯æ­£å¼æ”¹é€  HTTP åè®®æœ¬èº«ã€‚é™ä½å»¶è¿Ÿï¼Œå‹ç¼© header ç­‰ç­‰ï¼ŒSPDY çš„å®è·µè¯æ˜äº†è¿™äº›ä¼˜åŒ–çš„æ•ˆæœï¼Œä¹Ÿæœ€ç»ˆå¸¦æ¥ HTTP/2 çš„è¯ç”Ÿã€‚</p><p><img src="http://cdn.leesin.fun/typora/s3/img/SPDYåè®®.png" alt="SPDYåè®®"></p><h2 id="3-3-HTTP-2æ–°ç‰¹æ€§"><a href="#3-3-HTTP-2æ–°ç‰¹æ€§" class="headerlink" title="3.3.HTTP/2æ–°ç‰¹æ€§"></a>3.3.HTTP/2æ–°ç‰¹æ€§</h2><p><strong>HTTP/2 åŸºäº SPDYï¼Œä¸“æ³¨äºæ€§èƒ½ï¼Œæœ€å¤§çš„ç›®æ ‡æ˜¯åœ¨ç”¨æˆ·å’Œç½‘ç«™é—´åªç”¨ä¸€ä¸ªè¿æ¥ï¼ˆconnec-tionï¼‰</strong>ã€‚ä½¿ç”¨ HTTP/2 èƒ½å¸¦æ¥ 20%~60% çš„æ•ˆç‡æå‡ã€‚</p><h3 id="3-3-1-äºŒè¿›åˆ¶ä¼ è¾“"><a href="#3-3-1-äºŒè¿›åˆ¶ä¼ è¾“" class="headerlink" title="3.3.1.äºŒè¿›åˆ¶ä¼ è¾“"></a>3.3.1.äºŒè¿›åˆ¶ä¼ è¾“</h3><p><strong>HTTP/2 ä¼ è¾“æ•°æ®é‡çš„å¤§å¹…å‡å°‘, ä¸»è¦æœ‰ä¸¤ä¸ªåŸå› : ä»¥äºŒè¿›åˆ¶æ–¹å¼ä¼ è¾“å’Œ Header å‹ç¼©</strong>ã€‚æˆ‘ä»¬å…ˆæ¥ä»‹ç»äºŒè¿›åˆ¶ä¼ è¾“ï¼ŒHTTP/2 é‡‡ç”¨äºŒè¿›åˆ¶æ ¼å¼ä¼ è¾“æ•°æ®ï¼Œè€Œé HTTP/1.x é‡Œçº¯æ–‡æœ¬å½¢å¼çš„æŠ¥æ–‡ ï¼ŒäºŒè¿›åˆ¶åè®®è§£æèµ·æ¥æ›´é«˜æ•ˆã€‚<strong>HTTP/2 å°†è¯·æ±‚å’Œå“åº”æ•°æ®åˆ†å‰²ä¸ºæ›´å°çš„å¸§ï¼Œå¹¶ä¸”å®ƒä»¬é‡‡ç”¨äºŒè¿›åˆ¶ç¼–ç </strong>ã€‚</p><p>å®ƒæŠŠ TCP åè®®çš„éƒ¨åˆ†ç‰¹æ€§æŒªåˆ°äº†åº”ç”¨å±‚ï¼ŒæŠŠåŸæ¥çš„â€Header+Bodyâ€çš„æ¶ˆæ¯â€æ‰“æ•£â€ä¸ºæ•°ä¸ªå°ç‰‡çš„äºŒè¿›åˆ¶â€å¸§â€(Frame), ç”¨â€HEADERSâ€å¸§å­˜æ”¾å¤´æ•°æ®ã€â€DATAâ€å¸§å­˜æ”¾å®ä½“æ•°æ®ã€‚HTTP/2 æ•°æ®åˆ†å¸§åï¼Œâ€œHeader+Bodyâ€çš„æŠ¥æ–‡ç»“æ„å°±å®Œå…¨æ¶ˆå¤±äº†ï¼Œåè®®çœ‹åˆ°çš„åªæ˜¯ä¸€ä¸ªä¸ªâ€ç¢ç‰‡â€ã€‚</p><p><img src="http://cdn.leesin.fun/typora/s3/img/HTTP2çš„å¸§.jpg" alt="HTTP2çš„å¸§"></p><p>HTTP/2 ä¸­ï¼ŒåŒåŸŸåä¸‹æ‰€æœ‰é€šä¿¡éƒ½åœ¨å•ä¸ªè¿æ¥ä¸Šå®Œæˆï¼Œè¯¥è¿æ¥å¯ä»¥æ‰¿è½½ä»»æ„æ•°é‡çš„åŒå‘æ•°æ®æµã€‚æ¯ä¸ªæ•°æ®æµéƒ½ä»¥æ¶ˆæ¯çš„å½¢å¼å‘é€ï¼Œè€Œæ¶ˆæ¯åˆç”±ä¸€ä¸ªæˆ–å¤šä¸ªå¸§ç»„æˆã€‚<strong>å¤šä¸ªå¸§ä¹‹é—´å¯ä»¥ä¹±åºå‘é€ï¼Œæ ¹æ®å¸§é¦–éƒ¨çš„æµæ ‡è¯†å¯ä»¥é‡æ–°ç»„è£…</strong>ã€‚</p><h3 id="3-3-2-Header-å‹ç¼©"><a href="#3-3-2-Header-å‹ç¼©" class="headerlink" title="3.3.2.Header å‹ç¼©"></a>3.3.2.Header å‹ç¼©</h3><p>HTTP/2 å¹¶æ²¡æœ‰ä½¿ç”¨ä¼ ç»Ÿçš„å‹ç¼©ç®—æ³•ï¼Œè€Œæ˜¯å¼€å‘äº†ä¸“é—¨çš„â€HPACKâ€ç®—æ³•ï¼Œåœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¸¤ç«¯å»ºç«‹â€œå­—å…¸â€ï¼Œç”¨ç´¢å¼•å·è¡¨ç¤ºé‡å¤çš„å­—ç¬¦ä¸²ï¼Œè¿˜é‡‡ç”¨<strong>å“ˆå¤«æ›¼ç¼–ç </strong>æ¥å‹ç¼©æ•´æ•°å’Œå­—ç¬¦ä¸²ï¼Œå¯ä»¥è¾¾åˆ° 50%~90% çš„é«˜å‹ç¼©ç‡ã€‚</p><p>å…·ä½“æ¥è¯´ï¼š</p><ul><li>åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯ä½¿ç”¨â€œé¦–éƒ¨è¡¨â€æ¥è·Ÿè¸ªå’Œå­˜å‚¨ä¹‹å‰å‘é€çš„é”® - å€¼å¯¹ï¼Œ<strong>å¯¹äºç›¸åŒçš„æ•°æ®ï¼Œä¸å†é€šè¿‡æ¯æ¬¡è¯·æ±‚å’Œå“åº”å‘é€ã€‚</strong></li><li>é¦–éƒ¨è¡¨åœ¨ HTTP/2 çš„è¿æ¥å­˜ç»­æœŸå†…å§‹ç»ˆå­˜åœ¨ï¼Œç”±å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å…±åŒæ¸è¿›åœ°æ›´æ–° ã€‚</li><li>æ¯ä¸ªæ–°çš„é¦–éƒ¨é”® - å€¼å¯¹è¦ä¹ˆè¢«è¿½åŠ åˆ°å½“å‰è¡¨çš„æœ«å°¾ï¼Œè¦ä¹ˆæ›¿æ¢è¡¨ä¸­ä¹‹å‰çš„å€¼ã€‚</li></ul><p>ä¾‹å¦‚ä¸‹å›¾ä¸­çš„ä¸¤ä¸ªè¯·æ±‚ï¼Œ è¯·æ±‚ä¸€å‘é€äº†æ‰€æœ‰çš„å¤´éƒ¨å­—æ®µï¼Œç¬¬äºŒä¸ªè¯·æ±‚åˆ™åªéœ€è¦å‘é€å·®å¼‚æ•°æ®ï¼Œè¿™æ ·å¯ä»¥å‡å°‘å†—ä½™æ•°æ®ï¼Œé™ä½å¼€é”€ ã€‚</p><p><img src="http://cdn.leesin.fun/typora/s3/img/HTTP2çš„å¸§å’Œå¤´éƒ¨å‹ç¼©ç¤ºä¾‹.jpg" alt="HTTP2çš„å¸§å’Œå¤´éƒ¨å‹ç¼©ç¤ºä¾‹"></p><h3 id="3-3-3-å¤šè·¯å¤ç”¨"><a href="#3-3-3-å¤šè·¯å¤ç”¨" class="headerlink" title="3.3.3.å¤šè·¯å¤ç”¨"></a>3.3.3.å¤šè·¯å¤ç”¨</h3><p>åœ¨ HTTP/2 ä¸­ï¼Œæœ‰äº†äºŒè¿›åˆ¶åˆ†å¸§ä¹‹åï¼ŒHTTP /2 ä¸å†ä¾èµ– TCP é“¾æ¥å»å®ç°å¤šæµå¹¶è¡Œäº†ï¼Œåœ¨ HTTP/2 ä¸­ï¼š</p><ul><li>åŒåŸŸåä¸‹æ‰€æœ‰é€šä¿¡éƒ½åœ¨å•ä¸ªè¿æ¥ä¸Šå®Œæˆã€‚</li><li>å•ä¸ªè¿æ¥å¯ä»¥æ‰¿è½½ä»»æ„æ•°é‡çš„åŒå‘æ•°æ®æµã€‚</li><li>æ•°æ®æµä»¥æ¶ˆæ¯çš„å½¢å¼å‘é€ï¼Œè€Œæ¶ˆæ¯åˆç”±ä¸€ä¸ªæˆ–å¤šä¸ªå¸§ç»„æˆï¼Œå¤šä¸ªå¸§ä¹‹é—´å¯ä»¥ä¹±åºå‘é€ï¼Œå› ä¸ºæ ¹æ®å¸§é¦–éƒ¨çš„æµæ ‡è¯†å¯ä»¥é‡æ–°ç»„è£…ã€‚</li></ul><p>è¿™ä¸€ç‰¹æ€§ä½¿æ€§èƒ½æœ‰äº†æå¤§æå‡ï¼š</p><ul><li>åŒä¸ªåŸŸååªéœ€è¦å ç”¨ä¸€ä¸ª TCP è¿æ¥ï¼Œä½¿ç”¨ä¸€ä¸ªè¿æ¥å¹¶è¡Œå‘é€å¤šä¸ªè¯·æ±‚å’Œå“åº”, è¿™æ ·æ•´ä¸ªé¡µé¢èµ„æºçš„ä¸‹è½½è¿‡ç¨‹åªéœ€è¦ä¸€æ¬¡æ…¢å¯åŠ¨ï¼ŒåŒæ—¶ä¹Ÿé¿å…äº†å¤šä¸ª TCP è¿æ¥ç«äº‰å¸¦å®½æ‰€å¸¦æ¥çš„é—®é¢˜ã€‚</li><li>å¹¶è¡Œäº¤é”™åœ°å‘é€å¤šä¸ªè¯·æ±‚ / å“åº”ï¼Œè¯·æ±‚ / å“åº”ä¹‹é—´äº’ä¸å½±å“ã€‚</li><li>åœ¨ HTTP/2 ä¸­ï¼Œæ¯ä¸ªè¯·æ±‚éƒ½å¯ä»¥å¸¦ä¸€ä¸ª 31bit çš„ä¼˜å…ˆå€¼ï¼Œ0 è¡¨ç¤ºæœ€é«˜ä¼˜å…ˆçº§ï¼Œ æ•°å€¼è¶Šå¤§ä¼˜å…ˆçº§è¶Šä½ã€‚æœ‰äº†è¿™ä¸ªä¼˜å…ˆå€¼ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å°±å¯ä»¥åœ¨å¤„ç†ä¸åŒçš„æµæ—¶é‡‡å–ä¸åŒçš„ç­–ç•¥ï¼Œä»¥æœ€ä¼˜çš„æ–¹å¼å‘é€æµã€æ¶ˆæ¯å’Œå¸§ã€‚</li></ul><p><img src="http://cdn.leesin.fun/typora/s3/img/http2çš„å¤šè·¯å¤ç”¨.png" alt="http2çš„å¤šè·¯å¤ç”¨"></p><p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œå¤šè·¯å¤ç”¨çš„æŠ€æœ¯åªé€šè¿‡ä¸€ä¸ª TCP è¿æ¥å°±å¯ä»¥ä¼ è¾“æ‰€æœ‰çš„è¯·æ±‚æ•°æ®ã€‚</p><h3 id="3-3-4-Server-Push"><a href="#3-3-4-Server-Push" class="headerlink" title="3.3.4.Server Push"></a>3.3.4.Server Push</h3><p>HTTP2 è¿˜åœ¨ä¸€å®šç¨‹åº¦ä¸Šæ”¹å˜äº†ä¼ ç»Ÿçš„â€œè¯·æ±‚ - åº”ç­”â€å·¥ä½œæ¨¡å¼ï¼ŒæœåŠ¡å™¨ä¸å†å®Œå…¨è¢«åŠ¨åœ°å“åº”è¯·æ±‚ï¼Œä¹Ÿå¯ä»¥æ–°å»ºâ€œæµâ€ä¸»åŠ¨å‘å®¢æˆ·ç«¯å‘é€æ¶ˆæ¯ã€‚</p><h3 id="3-3-5-æé«˜å®‰å…¨æ€§"><a href="#3-3-5-æé«˜å®‰å…¨æ€§" class="headerlink" title="3.3.5.æé«˜å®‰å…¨æ€§"></a>3.3.5.æé«˜å®‰å…¨æ€§</h3><p>å‡ºäºå…¼å®¹çš„è€ƒè™‘ï¼ŒHTTP/2 å»¶ç»­äº† HTTP/1 çš„â€œæ˜æ–‡â€ç‰¹ç‚¹ï¼Œå¯ä»¥åƒä»¥å‰ä¸€æ ·ä½¿ç”¨æ˜æ–‡ä¼ è¾“æ•°æ®ï¼Œä¸å¼ºåˆ¶ä½¿ç”¨åŠ å¯†é€šä¿¡ï¼Œä¸è¿‡æ ¼å¼è¿˜æ˜¯äºŒè¿›åˆ¶ï¼Œåªæ˜¯ä¸éœ€è¦è§£å¯†ã€‚</p><p>ä½†ç”±äº HTTPS å·²ç»æ˜¯å¤§åŠ¿æ‰€è¶‹ï¼Œè€Œä¸”ä¸»æµçš„æµè§ˆå™¨ Chromeã€Firefox ç­‰éƒ½å…¬å¼€å®£å¸ƒåªæ”¯æŒåŠ å¯†çš„ HTTP/2ï¼Œ<strong>æ‰€ä»¥â€œäº‹å®ä¸Šâ€çš„ HTTP/2 æ˜¯åŠ å¯†çš„</strong>ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œäº’è”ç½‘ä¸Šé€šå¸¸æ‰€èƒ½è§åˆ°çš„ HTTP/2 éƒ½æ˜¯ä½¿ç”¨â€httpsâ€åè®®åï¼Œè·‘åœ¨ TLS ä¸Šé¢ã€‚HTTP/2 åè®®å®šä¹‰äº†ä¸¤ä¸ªå­—ç¬¦ä¸²æ ‡è¯†ç¬¦ï¼šâ€œh2â€è¡¨ç¤ºåŠ å¯†çš„ HTTP/2ï¼Œâ€œh2câ€è¡¨ç¤ºæ˜æ–‡çš„ HTTP/2ã€‚</p><h2 id="3-4-HTTP-2ç¼ºé™·"><a href="#3-4-HTTP-2ç¼ºé™·" class="headerlink" title="3.4.HTTP/2ç¼ºé™·"></a>3.4.HTTP/2ç¼ºé™·</h2><p>è™½ç„¶ HTTP/2 è§£å†³äº†å¾ˆå¤šä¹‹å‰æ—§ç‰ˆæœ¬çš„é—®é¢˜ï¼Œä½†æ˜¯å®ƒè¿˜æ˜¯å­˜åœ¨ä¸€ä¸ªå·¨å¤§çš„é—®é¢˜ï¼Œ<strong>ä¸»è¦æ˜¯åº•å±‚æ”¯æ’‘çš„ TCP åè®®é€ æˆçš„</strong>ã€‚HTTP/2 çš„ç¼ºç‚¹ä¸»è¦æœ‰ä»¥ä¸‹å‡ ç‚¹ï¼š</p><ul><li><p>TCP å’Œ TCP+TLS å»ºç«‹è¿æ¥çš„å»¶æ—¶</p><p>HTTP/2 æ˜¯ä½¿ç”¨ TCP åè®®æ¥ä¼ è¾“çš„ã€‚å¦‚æœä½¿ç”¨ HTTPS çš„è¯ï¼Œè¿˜éœ€è¦ä½¿ç”¨ TLS åè®®è¿›è¡Œå®‰å…¨ä¼ è¾“ï¼Œè€Œä½¿ç”¨ TLS ä¹Ÿéœ€è¦ä¸€ä¸ªæ¡æ‰‹è¿‡ç¨‹ï¼Œ<strong>è¿™æ ·å°±éœ€è¦æœ‰ä¸¤ä¸ªæ¡æ‰‹å»¶è¿Ÿè¿‡ç¨‹</strong>ï¼š</p><p>â€‹    â‘ åœ¨å»ºç«‹ TCP è¿æ¥çš„æ—¶å€™ï¼Œéœ€è¦å’ŒæœåŠ¡å™¨è¿›è¡Œä¸‰æ¬¡æ¡æ‰‹æ¥ç¡®è®¤è¿æ¥æˆåŠŸï¼Œä¹Ÿå°±æ˜¯è¯´éœ€è¦åœ¨æ¶ˆè€—å®Œ 1.5 ä¸ª RTT ä¹‹åæ‰èƒ½è¿›è¡Œæ•°æ®ä¼ è¾“ã€‚</p><p>â€‹    â‘¡è¿›è¡Œ TLS è¿æ¥ï¼ŒTLS æœ‰ä¸¤ä¸ªç‰ˆæœ¬â€”â€”TLS1.2 å’Œ TLS1.3ï¼Œæ¯ä¸ªç‰ˆæœ¬å»ºç«‹è¿æ¥æ‰€èŠ±çš„æ—¶é—´ä¸åŒï¼Œå¤§è‡´æ˜¯éœ€è¦ 1~2 ä¸ª RTTã€‚</p><p>æ€»ä¹‹ï¼Œåœ¨ä¼ è¾“æ•°æ®ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦èŠ±æ‰ 3ï½4 ä¸ª RTTã€‚</p></li></ul><ul><li><p>TCP çš„é˜Ÿå¤´é˜»å¡å¹¶æ²¡æœ‰å½»åº•è§£å†³</p><p>ä¸Šæ–‡æˆ‘ä»¬æåˆ°åœ¨ HTTP/2 ä¸­ï¼Œå¤šä¸ªè¯·æ±‚æ˜¯è·‘åœ¨ä¸€ä¸ª TCP ç®¡é“ä¸­çš„ã€‚ä½†å½“å‡ºç°äº†ä¸¢åŒ…æ—¶ï¼ŒHTTP/2 çš„è¡¨ç°åå€’ä¸å¦‚ HTTP/1 äº†ã€‚å› ä¸º TCP ä¸ºäº†ä¿è¯å¯é ä¼ è¾“ï¼Œæœ‰ä¸ªç‰¹åˆ«çš„â€œä¸¢åŒ…é‡ä¼ â€æœºåˆ¶ï¼Œä¸¢å¤±çš„åŒ…å¿…é¡»è¦ç­‰å¾…é‡æ–°ä¼ è¾“ç¡®è®¤ï¼ŒHTTP/2 å‡ºç°ä¸¢åŒ…æ—¶ï¼Œæ•´ä¸ª TCP éƒ½è¦å¼€å§‹ç­‰å¾…é‡ä¼ ï¼Œé‚£ä¹ˆå°±ä¼šé˜»å¡è¯¥ TCP è¿æ¥ä¸­çš„æ‰€æœ‰è¯·æ±‚ï¼ˆå¦‚ä¸‹å›¾ï¼‰ã€‚è€Œå¯¹äº HTTP/1.1 æ¥è¯´ï¼Œå¯ä»¥å¼€å¯å¤šä¸ª TCP è¿æ¥ï¼Œå‡ºç°è¿™ç§æƒ…å†µåå€’åªä¼šå½±å“å…¶ä¸­ä¸€ä¸ªè¿æ¥ï¼Œå‰©ä½™çš„ TCP è¿æ¥è¿˜å¯ä»¥æ­£å¸¸ä¼ è¾“æ•°æ®ã€‚</p><p><img src="http://cdn.leesin.fun/typora/s3/img/http2é˜Ÿå¤´é˜»å¡.png" alt="http2é˜Ÿå¤´é˜»å¡"></p></li></ul><h2 id="3-5-HTTP-3æ–°ç‰¹æ€§"><a href="#3-5-HTTP-3æ–°ç‰¹æ€§" class="headerlink" title="3.5.HTTP/3æ–°ç‰¹æ€§"></a>3.5.HTTP/3æ–°ç‰¹æ€§</h2><p>Google åœ¨æ¨ SPDY çš„æ—¶å€™å°±å·²ç»æ„è¯†åˆ°äº†è¿™äº›é—®é¢˜ï¼Œäºæ˜¯å°±å¦èµ·ç‚‰ç¶æäº†ä¸€ä¸ªåŸºäº UDP åè®®çš„â€œQUICâ€åè®®ï¼Œè®© HTTP è·‘åœ¨ QUIC ä¸Šè€Œä¸æ˜¯ TCP ä¸Šã€‚è€Œè¿™ä¸ªâ€œHTTP over QUICâ€å°±æ˜¯ HTTP åè®®çš„ä¸‹ä¸€ä¸ªå¤§ç‰ˆæœ¬ï¼ŒHTTP/3ã€‚å®ƒåœ¨ HTTP/2 çš„åŸºç¡€ä¸Šåˆå®ç°äº†è´¨çš„é£è·ƒï¼ŒçœŸæ­£â€œå®Œç¾â€åœ°è§£å†³äº†â€œé˜Ÿå¤´é˜»å¡â€é—®é¢˜ã€‚</p><p><img src="http://cdn.leesin.fun/typora/s3/img/http123åè®®.jpg" alt="http123åè®®"></p><p>QUIC è™½ç„¶åŸºäº UDPï¼Œä½†æ˜¯åœ¨åŸæœ¬çš„åŸºç¡€ä¸Šæ–°å¢äº†å¾ˆå¤šåŠŸèƒ½ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬é‡ç‚¹ä»‹ç»å‡ ä¸ª QUIC æ–°åŠŸèƒ½ã€‚</p><p>ä¸Šé¢æˆ‘ä»¬æåˆ° QUIC åŸºäº UDPï¼Œè€Œ UDP æ˜¯â€œæ— è¿æ¥â€çš„ï¼Œæ ¹æœ¬å°±ä¸éœ€è¦â€œæ¡æ‰‹â€å’Œâ€œæŒ¥æ‰‹â€ï¼Œæ‰€ä»¥å°±æ¯” TCP æ¥å¾—å¿«ã€‚æ­¤å¤–ï¼ŒQUIC ä¹Ÿå®ç°äº†å¯é ä¼ è¾“ï¼Œä¿è¯æ•°æ®ä¸€å®šèƒ½å¤ŸæŠµè¾¾ç›®çš„åœ°ã€‚å®ƒè¿˜å¼•å…¥äº†ç±»ä¼¼ HTTP/2 çš„â€œæµâ€å’Œâ€œå¤šè·¯å¤ç”¨â€ï¼Œå•ä¸ªâ€œæµâ€æ˜¯æœ‰åºçš„ï¼Œå¯èƒ½ä¼šå› ä¸ºä¸¢åŒ…è€Œé˜»å¡ï¼Œä½†å…¶ä»–â€œæµâ€ä¸ä¼šå—åˆ°å½±å“ã€‚å…·ä½“æ¥è¯´ï¼ŒQUIC åè®®æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š</p><ul><li>å®ç°äº†ç±»ä¼¼ TCP çš„æµé‡æ§åˆ¶ã€ä¼ è¾“å¯é æ€§çš„åŠŸèƒ½ã€‚</li></ul><p>è™½ç„¶ UDP ä¸æä¾›å¯é æ€§çš„ä¼ è¾“ï¼Œä½† QUIC åœ¨ UDP çš„åŸºç¡€ä¹‹ä¸Šå¢åŠ äº†ä¸€å±‚æ¥ä¿è¯æ•°æ®å¯é æ€§ä¼ è¾“ã€‚å®ƒæä¾›äº†æ•°æ®åŒ…é‡ä¼ ã€æ‹¥å¡æ§åˆ¶ä»¥åŠå…¶ä»–ä¸€äº› TCP ä¸­å­˜åœ¨çš„ç‰¹æ€§ã€‚</p><ul><li>å®ç°äº†å¿«é€Ÿæ¡æ‰‹åŠŸèƒ½ã€‚</li></ul><p>ç”±äº QUIC æ˜¯åŸºäº UDP çš„ï¼Œæ‰€ä»¥ QUIC å¯ä»¥å®ç°ä½¿ç”¨ 0-RTT æˆ–è€… 1-RTT æ¥å»ºç«‹è¿æ¥ï¼Œè¿™æ„å‘³ç€ QUIC å¯ä»¥ç”¨æœ€å¿«çš„é€Ÿåº¦æ¥å‘é€å’Œæ¥æ”¶æ•°æ®ï¼Œè¿™æ ·å¯ä»¥å¤§å¤§æå‡é¦–æ¬¡æ‰“å¼€é¡µé¢çš„é€Ÿåº¦ã€‚<strong>0RTT å»ºè¿å¯ä»¥è¯´æ˜¯ QUIC ç›¸æ¯” HTTP2 æœ€å¤§çš„æ€§èƒ½ä¼˜åŠ¿</strong>ã€‚</p><ul><li>é›†æˆäº† TLS åŠ å¯†åŠŸèƒ½ã€‚</li></ul><p>ç›®å‰ QUIC ä½¿ç”¨çš„æ˜¯ TLS1.3ï¼Œç›¸è¾ƒäºæ—©æœŸç‰ˆæœ¬ TLS1.3 æœ‰æ›´å¤šçš„ä¼˜ç‚¹ï¼Œå…¶ä¸­æœ€é‡è¦çš„ä¸€ç‚¹æ˜¯å‡å°‘äº†æ¡æ‰‹æ‰€èŠ±è´¹çš„ RTT ä¸ªæ•°ã€‚</p><ul><li>å¤šè·¯å¤ç”¨ï¼Œå½»åº•è§£å†³ TCP ä¸­é˜Ÿå¤´é˜»å¡çš„é—®é¢˜ã€‚</li></ul><p>å’Œ TCP ä¸åŒï¼ŒQUIC å®ç°äº†åœ¨åŒä¸€ç‰©ç†è¿æ¥ä¸Šå¯ä»¥æœ‰å¤šä¸ªç‹¬ç«‹çš„é€»è¾‘æ•°æ®æµï¼ˆå¦‚ä¸‹å›¾ï¼‰ã€‚å®ç°äº†æ•°æ®æµçš„å•ç‹¬ä¼ è¾“ï¼Œå°±è§£å†³äº† TCP ä¸­é˜Ÿå¤´é˜»å¡çš„é—®é¢˜ã€‚</p><p><img src="http://cdn.leesin.fun/typora/s3/img/QUICåè®®çš„å¤šè·¯å¤ç”¨.png" alt="QUICåè®®çš„å¤šè·¯å¤ç”¨"></p><h2 id="3-6-æ€»ç»“"><a href="#3-6-æ€»ç»“" class="headerlink" title="3.6.æ€»ç»“"></a>3.6.æ€»ç»“</h2><ul><li>HTTP/1.1 æœ‰ä¸¤ä¸ªä¸»è¦çš„ç¼ºç‚¹ï¼šå®‰å…¨ä¸è¶³å’Œæ€§èƒ½ä¸é«˜ã€‚</li><li>HTTP/2 å®Œå…¨å…¼å®¹ HTTP/1ï¼Œæ˜¯â€œæ›´å®‰å…¨çš„ HTTPã€æ›´å¿«çš„ HTTPSâ€ï¼Œå¤´éƒ¨å‹ç¼©ã€å¤šè·¯å¤ç”¨ç­‰æŠ€æœ¯å¯ä»¥å……åˆ†åˆ©ç”¨å¸¦å®½ï¼Œé™ä½å»¶è¿Ÿï¼Œä»è€Œå¤§å¹…åº¦æé«˜ä¸Šç½‘ä½“éªŒã€‚</li><li>QUIC åŸºäº UDP å®ç°ï¼Œæ˜¯ HTTP/3 ä¸­çš„åº•å±‚æ”¯æ’‘åè®®ã€‚è¯¥åè®®åŸºäº UDPï¼Œåˆæ±²å–äº† TCP ä¸­çš„ç²¾åï¼Œå®ç°äº†æ—¢å¿«åˆå¯é çš„åè®®ã€‚</li></ul><p>åŸæ–‡ï¼š<a href="https://www.infoq.cn/article/kU4OkqR8vH123a8dLCCJ">https://www.infoq.cn/article/kU4OkqR8vH123a8dLCCJ</a></p><h1 id="4-HTTPS"><a href="#4-HTTPS" class="headerlink" title="4.HTTPS"></a>4.HTTPS</h1><h1 id="5-åŠ å¯†"><a href="#5-åŠ å¯†" class="headerlink" title="5.åŠ å¯†"></a>5.åŠ å¯†</h1><h2 id="5-1-æ‘˜è¦ç®—æ³•"><a href="#5-1-æ‘˜è¦ç®—æ³•" class="headerlink" title="5.1.æ‘˜è¦ç®—æ³•"></a>5.1.æ‘˜è¦ç®—æ³•</h2><p>æ‘˜è¦ç®—æ³•èƒ½å¤ŸæŠŠä»»æ„é•¿åº¦çš„æ•°æ®â€œå‹ç¼©â€æˆå›ºå®šé•¿åº¦ã€è€Œä¸”ç‹¬ä¸€æ— äºŒçš„â€œæ‘˜è¦â€å­—ç¬¦ä¸²ï¼Œå°±å¥½åƒæ˜¯ç»™è¿™æ®µæ•°æ®ç”Ÿæˆäº†ä¸€ä¸ªæ•°å­—â€œæŒ‡çº¹â€ã€‚ä»»æ„å¾®å°çš„æ•°æ®å·®å¼‚ï¼Œéƒ½å¯ä»¥ç”Ÿæˆå®Œå…¨ä¸åŒçš„æ‘˜è¦ã€‚æ‰€ä»¥å¯ä»¥é€šè¿‡æŠŠæ˜æ–‡ä¿¡æ¯çš„æ‘˜è¦å’Œæ˜æ–‡ä¸€èµ·åŠ å¯†è¿›è¡Œä¼ è¾“ï¼Œæ•°æ®ä¼ è¾“åˆ°å¯¹æ–¹ä¹‹åå†è¿›è¡Œè§£å¯†ï¼Œé‡æ–°å¯¹æ•°æ®è¿›è¡Œæ‘˜è¦ï¼Œå†æ¯”å¯¹å°±èƒ½å‘ç°æ•°æ®æœ‰æ²¡æœ‰è¢«ç®—æ”¹ã€‚è¿™æ ·å°±ä¿è¯äº†æ•°æ®çš„å®Œæ•´æ€§ã€‚</p><p>æ¯”å¦‚ï¼šmd5</p><h2 id="5-2-å¯¹ç§°åŠ å¯†"><a href="#5-2-å¯¹ç§°åŠ å¯†" class="headerlink" title="5.2.å¯¹ç§°åŠ å¯†"></a>5.2.å¯¹ç§°åŠ å¯†</h2><p>å¯¹ç§°å¯†é’¥åŠ å¯†ç®—æ³•ï¼šç¼–ã€è§£ç ä½¿ç”¨ç›¸åŒå¯†é’¥çš„ç®—æ³•ï¼Œå¦‚ (AESï¼ŒRC4ï¼ŒChaCha20 )ã€‚</p><p>ä»¥xorä¸ºä¸¾ä¾‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">1110101010111010åŸæ–‡</span><br><span class="line">0101101101010101å¯†é’¥</span><br><span class="line">1011000111101111åŸæ–‡xorå¯†é’¥-&gt;å¯†æ–‡</span><br><span class="line"></span><br><span class="line">1011000111101111å¯†æ–‡</span><br><span class="line">0101101101010101å¯†é’¥</span><br><span class="line">1110101010111010å¯†æ–‡xorå¯†é’¥-&gt;åŸæ–‡</span><br></pre></td></tr></table></figure><h2 id="5-3-éå¯¹ç§°åŠ å¯†"><a href="#5-3-éå¯¹ç§°åŠ å¯†" class="headerlink" title="5.3.éå¯¹ç§°åŠ å¯†"></a>5.3.éå¯¹ç§°åŠ å¯†</h2><p>å…¬é’¥å¯ä»¥å…¬å¼€ç»™ä»»ä½•äººä½¿ç”¨ï¼Œè€Œç§é’¥å¿…é¡»ä¸¥æ ¼ä¿å¯†ã€‚éå¯¹ç§°åŠ å¯†å¯ä»¥è§£å†³â€œå¯†é’¥äº¤æ¢â€çš„é—®é¢˜ã€‚ç½‘ç«™ç§˜å¯†ä¿ç®¡ç§é’¥ï¼Œåœ¨ç½‘ä¸Šä»»æ„åˆ†å‘å…¬é’¥ï¼Œä½ æƒ³è¦ç™»å½•ç½‘ç«™åªè¦ç”¨å…¬é’¥åŠ å¯†å°±è¡Œäº†ï¼Œå¯†æ–‡åªèƒ½ç”±ç§é’¥æŒæœ‰è€…æ‰èƒ½è§£å¯†ã€‚è€Œé»‘å®¢å› ä¸ºæ²¡æœ‰ç§é’¥ï¼Œæ‰€ä»¥å°±æ— æ³•ç ´è§£å¯†æ–‡ã€‚éå¯¹ç§°å¯†é’¥åŠ å¯†ç³»ç»Ÿé€šå¸¸éœ€è¦å¤§é‡çš„æ•°å­¦è¿ç®—ï¼Œ<strong>æ¯”è¾ƒæ…¢</strong>ã€‚å¦‚ ï¼ˆDHã€DSAã€RSAã€ECC ï¼‰</p><blockquote><p>ä½¿ç”¨å…¬é’¥åŠ å¯†ï¼Œåªèƒ½ä½¿ç”¨ç§é’¥è§£å¯†</p><p>ä½¿ç”¨ç§é’¥åŠ å¯†ï¼Œåªèƒ½ä½¿ç”¨å…¬é’¥è§£å¯†</p></blockquote><h2 id="TLS"><a href="#TLS" class="headerlink" title="TLS"></a>TLS</h2><p>TLS é‡Œä½¿ç”¨çš„æ··åˆåŠ å¯†æ–¹å¼ï¼Œå³æŠŠå¯¹ç§°åŠ å¯†å’Œéå¯¹ç§°åŠ å¯†ç»“åˆèµ·æ¥å‘¢ï¼Œä¸¤è€…äº’ç›¸å–é•¿è¡¥çŸ­ï¼Œå³èƒ½é«˜æ•ˆåœ°åŠ å¯†è§£å¯†ï¼Œåˆèƒ½å®‰å…¨åœ°å¯†é’¥äº¤æ¢ã€‚å¤§è‡´æµç¨‹å¦‚ä¸‹ï¼š</p><ol><li><p>é€šä¿¡å¼€å§‹çš„æ—¶å€™ä½¿ç”¨éå¯¹ç§°ç®—æ³•å¦‚ RSAï¼ŒECDHEå…ˆè§£å†³å¯†é’¥äº¤æ¢çš„é—®é¢˜ã€‚<br><img src="http://cdn.leesin.fun/typora/s3/img/TLSæµç¨‹1.png" alt="TLSæµç¨‹1"></p></li><li><p>ç”¨éšæœºæ•°äº§ç”Ÿå¯¹ç§°ç®—æ³•ä½¿ç”¨çš„â€ä¼šè¯å¯†é’¥â€å†ç”¨å…¬é’¥åŠ å¯†ã€‚ä¼šè¯å¯†é’¥å¾ˆçŸ­ï¼Œæ‰€ä»¥å³ä¾¿ä½¿ç”¨éå¯¹ç§°åŠ å¯†ç®—æ³•ä¹Ÿå¯ä»¥å¾ˆå¿«å®ŒæˆåŠ è§£å¯†ã€‚<br><img src="http://cdn.leesin.fun/typora/s3/img/TLSæµç¨‹2.png" alt="TLSæµç¨‹2"></p></li><li><p>å¯¹æ–¹æ‹¿åˆ°å¯†æ–‡åç”¨ç§é’¥è§£å¯†ï¼Œå–å‡ºä¼šè¯å¯†é’¥ã€‚å®Œæˆå¯¹ç§°å¯†é’¥çš„å®‰å…¨äº¤æ¢ï¼Œåç»­å°±ä½¿ç”¨å¯¹ç§°ç®—æ³•å®Œæˆæ•°æ®äº¤æ¢ã€‚<br><img src="http://cdn.leesin.fun/typora/s3/img/TLSæµç¨‹3.png" alt="TLSæµç¨‹3"></p></li></ol><p><img src="http://cdn.leesin.fun/typora/s3/img/httpsåŠ è§£å¯†å®Œæ•´è¿‡ç¨‹.png" alt="httpsåŠ è§£å¯†å®Œæ•´è¿‡ç¨‹"></p><h2 id="èº«ä»½éªŒè¯"><a href="#èº«ä»½éªŒè¯" class="headerlink" title="èº«ä»½éªŒè¯"></a>èº«ä»½éªŒè¯</h2><h5 id="æ•°å­—è¯ä¹¦ç»„æˆ"><a href="#æ•°å­—è¯ä¹¦ç»„æˆ" class="headerlink" title="æ•°å­—è¯ä¹¦ç»„æˆ"></a>æ•°å­—è¯ä¹¦ç»„æˆ</h5><p>CAä¿¡æ¯ï¼Œå…¬é’¥ç”¨æˆ·ä¿¡æ¯ï¼Œå…¬é’¥ï¼Œæƒå¨æœºæ„çš„ç­¾åï¼Œæœ‰æ•ˆæœŸ</p><h5 id="æ•°å­—è¯ä¹¦ä½œç”¨"><a href="#æ•°å­—è¯ä¹¦ä½œç”¨" class="headerlink" title="æ•°å­—è¯ä¹¦ä½œç”¨"></a>æ•°å­—è¯ä¹¦ä½œç”¨</h5><ol><li>é€šè¿‡æ•°å­—è¯ä¹¦å‘æµè§ˆå™¨è¯æ˜èº«ä»½</li><li>æ•°å­—è¯ä¹¦é‡Œé¢åŒ…å«äº†å…¬é’¥</li></ol><h5 id="æ•°å­—è¯ä¹¦çš„ç”³è¯·å’ŒéªŒè¯"><a href="#æ•°å­—è¯ä¹¦çš„ç”³è¯·å’ŒéªŒè¯" class="headerlink" title="æ•°å­—è¯ä¹¦çš„ç”³è¯·å’ŒéªŒè¯"></a>æ•°å­—è¯ä¹¦çš„ç”³è¯·å’ŒéªŒè¯</h5><p>å¦‚ä½•ç”³è¯·ï¼š<br>1.ç”Ÿæˆè‡ªå·±çš„å…¬é’¥å’Œç§é’¥ï¼ŒæœåŠ¡å™¨è‡ªå·±ä¿ç•™ç§é’¥</p><p>2.å‘CAæœºæ„æäº¤å…¬é’¥ï¼Œå…¬å¸ï¼ŒåŸŸåä¿¡æ¯ç­‰å¾…è®¤è¯</p><p>3.CAæœºæ„é€šè¿‡çº¿ä¸Šï¼Œçº¿ä¸‹å¤šç§é€”å¾„éªŒè¯ä½ æäº¤ä¿¡æ¯çš„çœŸå®æ€§ï¼Œåˆæ³•æ€§</p><p>4.ä¿¡æ¯å®¡æ ¸é€šè¿‡ï¼ŒCAæœºæ„åˆ™ä¼šå‘ä½ ç­¾å‘è®¤è¯çš„æ•°å­—è¯ä¹¦ï¼ŒåŒ…å«äº†å…¬é’¥ï¼Œç»„ç»‡ä¿¡æ¯ï¼ŒCAä¿¡æ¯ï¼Œæœ‰æ•ˆæ—¶é—´ï¼Œè¯ä¹¦åºåˆ—å·ï¼ŒåŒæ—¶ç”Ÿæˆä¸€ä¸ªç­¾å</p><p>ç­¾åæ­¥éª¤ï¼šhashï¼ˆä½ ç”¨äºç”³è¯·è¯ä¹¦æ‰€æäº¤çš„æ˜æ–‡ä¿¡æ¯ï¼‰=ä¿¡æ¯æ‘˜è¦ï¼›CAå†ä½¿ç”¨ç§</p><p>é’¥å¯¹ä¿¡æ¯æ‘˜è¦è¿›è¡ŒåŠ å¯†ï¼Œå¯†æ–‡å°±æ˜¯è¯ä¹¦çš„æ•°å­—ç­¾å</p><p>æµè§ˆå™¨å¦‚ä½•éªŒè¯å‘¢?</p><p>æœ‰äº†CAç­¾åè¿‡çš„æ•°å­—è¯ä¹¦ï¼Œå½“æµè§ˆå™¨è®¿é—®æœåŠ¡å™¨æ—¶ï¼ŒæœåŠ¡å™¨ä¼šè¿”å›æ•°å­—è¯ä¹¦ç»™æµè§ˆå™¨ã€‚æµè§ˆå™¨æ”¶åˆ°è¯ä¹¦åä¼šå¯¹æ•°å­—è¯ä¹¦è¿›è¡ŒéªŒè¯ã€‚</p><p>é¦–å…ˆæµè§ˆå™¨è¯»å–è¯ä¹¦ä¸­ç›¸å…³çš„æ˜æ–‡ä¿¡æ¯ï¼Œé‡‡ç”¨CAç­¾åæ—¶ç›¸åŒçš„hashå‡½æ•°è®¡ç®—å¾—åˆ°ä¿¡æ¯æ‘˜è¦Aï¼Œå†åˆ©ç”¨å¯¹åº”çš„CAå…¬é’¥è§£å¯†æ•°å­—ç­¾åæ•°æ®å¾—åˆ°ä¿¡æ¯æ‘˜è¦Bï¼Œå¦‚æœæ‘˜è¦Aå’Œæ‘˜è¦Bä¸€è‡´ï¼Œåˆ™å¯ä»¥ç¡®è®¤è¯ä¹¦æ—¶åˆæ³•çš„</p><h1 id="6-IOæ¨¡å‹"><a href="#6-IOæ¨¡å‹" class="headerlink" title="6.IOæ¨¡å‹"></a>6.IOæ¨¡å‹</h1><p><img src="http://cdn.leesin.fun/typora/s3/img/IOæ¨¡å‹.png" alt="IOæ¨¡å‹"></p><p>ä¸åŒIOæ¨¡å‹çš„å·®åˆ«å°±æ˜¯åœ¨ ==1. 2. ä¸¤ä¸ªé˜¶æ®µ== çš„å¤„ç†æ–¹å¼çš„å·®åˆ«ã€‚</p><blockquote><p>åœ¨ç¥ä½œã€ŠUNIXç½‘ç»œç¼–ç¨‹ã€‹ä¸€ä¹¦ä¸­ï¼Œæ€»ç»“å½’çº³äº†5ç§IOæ¨¡å‹ï¼š</p><ul><li>é˜»å¡IO ï¼ˆBlocking IOï¼‰</li><li>éé˜»å¡IO (Nonblocking IO)</li><li>IOå¤šè·¯å¤ç”¨ ï¼ˆIO Multiplexingï¼‰</li><li>ä¿¡å·é©±åŠ¨IO ï¼ˆSignal Driver IOï¼‰</li><li>å¼‚æ­¥IO ï¼ˆAsynchronous IOï¼‰</li></ul></blockquote><h2 id="6-1-é˜»å¡IOâ€”â€”â€”BIO"><a href="#6-1-é˜»å¡IOâ€”â€”â€”BIO" class="headerlink" title="6.1.é˜»å¡IOâ€”â€”â€”BIO"></a>6.1.é˜»å¡IOâ€”â€”â€”BIO</h2><p>é¡¾åæ€ä¹‰ï¼Œé˜»å¡IOå°±æ˜¯ä¸¤ä¸ªé˜¶æ®µéƒ½å¿…é¡»é˜»å¡ç­‰å¾…ï¼š</p><p><img src="http://cdn.leesin.fun/typora/s3/img/é˜»å¡IO.png" alt="é˜»å¡IO"></p><p>åœ¨ IO é˜»å¡é€»è¾‘ä¸­ï¼Œå­˜åœ¨ä¸‹é¢ä¸‰ä¸ªé—®é¢˜ï¼š</p><ol><li>è¿›ç¨‹åœ¨ recv çš„æ—¶å€™å¤§æ¦‚ç‡ä¼šè¢«é˜»å¡æ‰ï¼Œå¯¼è‡´ä¸€æ¬¡è¿›ç¨‹åˆ‡æ¢ï¼›</li><li>å½“ TCP è¿æ¥ä¸Šçš„æ•°æ®åˆ°è¾¾æœåŠ¡ç«¯çš„ç½‘å¡ã€å¹¶ä»ç½‘å¡å¤åˆ¶åˆ°å†…æ ¸ç©ºé—´ socket çš„æ•°æ®ç­‰å¾…é˜Ÿåˆ—æ—¶ï¼Œè¿›ç¨‹ä¼šè¢«å”¤é†’ï¼Œåˆæ˜¯ä¸€æ¬¡è¿›ç¨‹åˆ‡æ¢ï¼›å¹¶ä¸”ï¼Œåœ¨ç”¨æˆ·è¿›ç¨‹ç»§ç»­æ‰§è¡Œå®Œ recvfrom() å‡½æ•°ç³»ç»Ÿè°ƒç”¨ï¼Œå°†å†…æ ¸ç©ºé—´çš„æ•°æ®æ‹·è´åˆ°äº†ç”¨æˆ·ç¼“å†²åŒºåï¼Œç”¨æˆ·è¿›ç¨‹æ‰ä¼šçœŸæ­£æ‹¿åˆ°æ‰€éœ€çš„æ•°æ®è¿›è¡Œå¤„ç†ï¼›</li><li>ä¸€ä¸ªè¿›ç¨‹åŒæ—¶åªèƒ½ç­‰å¾…ä¸€æ¡è¿æ¥ï¼Œå¦‚æœæœ‰å¾ˆå¤šå¹¶å‘ï¼Œåˆ™éœ€è¦å¾ˆå¤šè¿›ç¨‹ï¼›</li></ol><p>æ€»ç»“ï¼šä¸€æ¬¡æ•°æ®åˆ°è¾¾ä¼šè¿›è¡Œ<strong>ä¸¤æ¬¡è¿›ç¨‹åˆ‡æ¢ï¼Œ</strong>ä¸€æ¬¡æ•°æ®è¯»å–æœ‰<strong>ä¸¤å¤„é˜»å¡ï¼Œå•è¿›ç¨‹å¯¹å•è¿æ¥</strong>ã€‚</p><h2 id="6-2-éé˜»å¡IOâ€”â€”â€”-NIO"><a href="#6-2-éé˜»å¡IOâ€”â€”â€”-NIO" class="headerlink" title="6.2.éé˜»å¡IOâ€”â€”â€”-NIO"></a>6.2.éé˜»å¡IOâ€”â€”â€”-NIO</h2><p>éé˜»å¡IOçš„ recvfrom æ“ä½œä¼šç«‹å³è¿”å›ç»“æœè€Œä¸æ˜¯é˜»å¡ç”¨æˆ·è¿›ç¨‹ã€‚</p><p><img src="http://cdn.leesin.fun/typora/s3/img/éé˜»å¡IO.png" alt="éé˜»å¡IO"></p><p>å¯ä»¥çœ‹åˆ°ï¼Œéé˜»å¡ IOï¼Œæ˜¯å°†ç­‰å¾…æ•°æ®ä»ç½‘å¡åˆ°è¾¾ socket å†…æ ¸ç©ºé—´è¿™ä¸€éƒ¨åˆ†å˜æˆäº†éé˜»å¡çš„ï¼Œç¬¬äºŒä¸ªé˜¶æ®µä»æ˜¯é˜»å¡çŠ¶æ€ã€‚è™½ç„¶ç¬¬ä¸€é˜¶æ®µæ˜¯éé˜»å¡ï¼Œä½†æ€§èƒ½å¹¶æ²¡æœ‰å¾—åˆ°æé«˜ã€‚è€Œä¸”å¿™ç­‰æœºåˆ¶ä¼šå¯¼è‡´CPUç©ºè½¬ï¼ŒCPUä½¿ç”¨ç‡æš´å¢ã€‚</p><p>éé˜»å¡ IO æ¨¡å‹è§£å†³äº†â€œ<strong>ä¸¤æ¬¡è¿›ç¨‹åˆ‡æ¢ï¼Œä¸¤å¤„é˜»å¡ï¼Œå•è¿›ç¨‹å¯¹å•è¿æ¥</strong>â€ä¸­çš„â€œ<strong>ä¸¤å¤„é˜»å¡</strong>â€é—®é¢˜ï¼Œå°†â€œ<strong>ä¸¤å¤„é˜»å¡</strong>â€å˜æˆäº†â€œ<strong>ä¸€å¤„é˜»å¡</strong>â€ï¼Œä½†ä¾ç„¶å­˜åœ¨â€œ<strong>ä¸¤æ¬¡è¿›ç¨‹åˆ‡æ¢ï¼Œä¸€å¤„é˜»å¡ï¼Œå•è¿›ç¨‹å¯¹å•è¿æ¥</strong>â€çš„é—®é¢˜ã€‚</p><h2 id="6-3-IOå¤šè·¯å¤ç”¨"><a href="#6-3-IOå¤šè·¯å¤ç”¨" class="headerlink" title="6.3.IOå¤šè·¯å¤ç”¨"></a>6.3.IOå¤šè·¯å¤ç”¨</h2><p>æ— è®ºæ˜¯é˜»å¡IOè¿˜æ˜¯éé˜»å¡IOï¼Œç”¨æˆ·åº”ç”¨åœ¨ä¸€é˜¶æ®µéƒ½éœ€è¦è°ƒç”¨recvfromæ¥è·å–æ•°æ®ï¼Œå·®åˆ«åœ¨äºæ— æ•°æ®æ—¶çš„å¤„ç†æ–¹æ¡ˆï¼š</p><ul><li>å¦‚æœè°ƒç”¨recvfromæ—¶ï¼Œæ°å¥½<strong>æ²¡æœ‰</strong>æ•°æ®ï¼Œé˜»å¡IOä¼šä½¿è¿›ç¨‹é˜»å¡ï¼Œéé˜»å¡IOä½¿CPUç©ºè½¬ï¼Œä¸¤è€…éƒ½ä¸èƒ½å……åˆ†å‘æŒ¥CPUçš„ä½œç”¨ã€‚</li><li>å¦‚æœè°ƒç”¨recvfromæ—¶ï¼Œæ°å¥½<strong>æœ‰</strong>æ•°æ®ï¼Œåˆ™ç”¨æˆ·è¿›ç¨‹å¯ä»¥ç›´æ¥è¿›å…¥ç¬¬äºŒé˜¶æ®µï¼Œè¯»å–å¹¶å¤„ç†æ•°æ®ã€‚</li></ul><p>æ¯”å¦‚æœåŠ¡ç«¯å¤„ç†å®¢æˆ·ç«¯Socketè¯·æ±‚æ—¶ï¼Œåœ¨å•çº¿ç¨‹æƒ…å†µä¸‹ï¼Œåªèƒ½ä¾æ¬¡å¤„ç†æ¯ä¸€ä¸ªsocketï¼Œå¦‚æœæ­£åœ¨å¤„ç†çš„socketæ°å¥½æœªå°±ç»ª(æ•°æ®ä¸å¯è¯»æˆ–ä¸å¯å†™)ï¼Œçº¿ç¨‹å°±ä¼šè¢«é˜»å¡ï¼Œæ‰€æœ‰å…¶å®ƒå®¢æˆ·ç«¯socketéƒ½å¿…é¡»ç­‰å¾…ï¼Œæ€§èƒ½è‡ªç„¶ä¼šå¾ˆå·®ã€‚</p><p>è¿™å°±åƒæœåŠ¡å‘˜ç»™é¡¾å®¢ç‚¹é¤ï¼Œåˆ†ä¸¤æ­¥:</p><p>â‘ é¡¾å®¢æ€è€ƒè¦åƒä»€ä¹ˆï¼ˆç­‰å¾…æ•°æ®å°±ç»ªï¼‰</p><p>â‘¡é¡¾å®¢æƒ³å¥½äº†ï¼Œå¼€å§‹ç‚¹é¤ï¼ˆè¯»å–æ•°æ®ï¼‰</p><p><img src="http://cdn.leesin.fun/typora/s3/img/ç‚¹é¤ä¾‹å­.png" alt="ç‚¹é¤ä¾‹å­"></p><p>è¦æé«˜æ•ˆç‡æœ‰å‡ ç§æ–¹æ³•ï¼Ÿ</p><ul><li>æ–¹æ¡ˆä¸€ï¼šå¢åŠ æ›´å¤šæœåŠ¡å‘˜ï¼ˆå¤šçº¿ç¨‹ï¼‰     â€”â€”å¼€é”€å¤§</li><li>æ–¹æ¡ˆäºŒï¼šä¸æ’é˜Ÿï¼Œè°æƒ³å¥½äº†åƒä»€ä¹ˆï¼ˆæ•°æ®å°±ç»ªäº†ï¼‰ï¼ŒæœåŠ¡å‘˜å°±ç»™è°ç‚¹é¤ï¼ˆç”¨äºåº”ç”¨å°±å»è¯»å–æ•°æ®ï¼‰</li></ul><p>é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼šç”¨æˆ·è¿›ç¨‹å¦‚ä½•çŸ¥é“å†…æ ¸ä¸­æ•°æ®æ˜¯å¦å°±ç»ªå‘¢ï¼Ÿ</p><blockquote><p>æ–‡ä»¶æè¿°ç¬¦(File Descriptor)ï¼šç®€ç§°FDï¼Œæ˜¯ä¸€ä¸ªä»0 å¼€å§‹é€’å¢çš„æ— ç¬¦å·æ•´æ•°ï¼Œç”¨æ¥å…³è”Linuxä¸­çš„ä¸€ä¸ªæ–‡ä»¶ã€‚åœ¨Linuxä¸­ï¼Œä¸€åˆ‡çš†æ–‡ä»¶ï¼Œä¾‹å¦‚å¸¸è§„æ–‡ä»¶ã€è§†é¢‘ã€ç¡¬ä»¶è®¾å¤‡ç­‰ï¼Œå½“ç„¶ä¹ŸåŒ…æ‹¬ç½‘ç»œå¥—æ¥å­— (Socket)ã€‚</p></blockquote><p>æœ‰äº†æ–‡ä»¶æè¿°ç¬¦ï¼Œç”¨ä¸€ä¸ªçº¿ç¨‹æ¥ç›‘å¬å¤šä¸ªå®¢æˆ·ç«¯socketçš„æ–¹å¼å°±å¯ä»¥å®ç°äº†ã€‚</p><p>IOå¤šè·¯å¤ç”¨ï¼šæ˜¯åˆ©ç”¨å•ä¸ªçº¿ç¨‹æ¥åŒæ—¶ç›‘å¬å¤šä¸ªFDï¼Œå¹¶åœ¨æŸä¸ªFDå¯è¯»ã€å¯å†™æ—¶å¾—åˆ°é€šçŸ¥ï¼Œä»è€Œé¿å…æ— æ•ˆçš„ç­‰å¾…ï¼Œå……åˆ†åˆ©ç”¨CPUèµ„æºã€‚</p><p>IOå¤šè·¯å¤ç”¨çš„åŸºæœ¬æ€æƒ³ï¼š</p><p><img src="http://cdn.leesin.fun/typora/s3/img/IOå¤šè·¯å¤ç”¨.png" alt="IOå¤šè·¯å¤ç”¨"></p><p>ç›‘å¬FDçš„æ–¹å¼ã€é€šçŸ¥çš„æ–¹å¼åˆæœ‰å¤šç§è½åœ°å®ç°ï¼ŒLinuxå¸¸è§çš„æœ‰ï¼š</p><ul><li>select</li><li>poll</li><li>epoll</li></ul><p>å·®å¼‚ï¼š</p><ul><li><p>selectå’Œpollåªä¼šé€šçŸ¥ç”¨æˆ·è¿›ç¨‹æœ‰FDå°±ç»ªï¼Œä½†ä¸ç¡®å®šå…·ä½“æ˜¯å“ªä¸ªFDï¼Œéœ€è¦ç”¨æˆ·è¿›ç¨‹é€ä¸ªéå†FDæ¥ç¡®è®¤</p></li><li><p>epollåˆ™ä¼šåœ¨é€šçŸ¥ç”¨æˆ·è¿›ç¨‹FDå°±ç»ªçš„åŒæ—¶ï¼ŒæŠŠå·²å°±ç»ªçš„FDå†™å…¥ç”¨æˆ·ç©ºé—´</p></li></ul><h3 id="6-3-1-select"><a href="#6-3-1-select" class="headerlink" title="6.3.1.select"></a>6.3.1.select</h3><p><img src="http://cdn.leesin.fun/typora/s3/img/selectä»£ç .png" alt="selectä»£ç "></p><p>ä¸‹é¢æ¼”ç¤ºä¸€ä¸‹æµç¨‹ï¼šï¼ˆå¯çœ‹<a href="https://www.bilibili.com/video/BV1cr4y1671t?t=221.8&amp;p=164ï¼‰">https://www.bilibili.com/video/BV1cr4y1671t?t=221.8&amp;p=164ï¼‰</a></p><p><img src="http://cdn.leesin.fun/typora/s3/img/selectæ¼”ç¤º1.png" alt="selectæ¼”ç¤º1"></p><p>å¦‚æœæ­¤æ—¶ï¼Œfd=1æ•°æ®å°±ç»ªäº†ï¼Œä¿®æ”¹ä½å›¾ï¼Œå°†å°±ç»ªçš„fdä¿ç•™å€¼ä¸º1ï¼Œæœªå°±ç»ªçš„fdç½®0</p><p><img src="http://cdn.leesin.fun/typora/s3/img/selectæ¼”ç¤º2.png" alt="selectæ¼”ç¤º2"></p><p>ç„¶åï¼Œå°†å°±ç»ªæ•°ä½œä¸ºselectå‡½æ•°çš„è¿”å›å€¼è¿”å›ç»™è°ƒç”¨è€…ï¼Œå‘Šè¯‰ä»–æœ‰å‡ ä¸ªfdå°±ç»ªäº†ã€‚å¹¶ä¸”å°†fd_setçš„ç»“æœæ‹·è´å›ç”¨æˆ·ç©ºé—´ï¼Œè¦†ç›–æ‰åŸæ¥çš„fd_setã€‚</p><p><img src="http://cdn.leesin.fun/typora/s3/img/selectæ¼”ç¤º3.png" alt="selectæ¼”ç¤º3"></p><p>æ­¤æ—¶ï¼Œè°ƒç”¨è€…å·²ç»çŸ¥é“å°±ç»ªçš„fdæœ‰1ä¸ªï¼Œä½†æ˜¯å¹¶ä¸çŸ¥é“æ˜¯å“ªä¸ªfdå°±ç»ªäº†ï¼Œæ‰€ä»¥è¦å¯¹fd_setå†è¿›è¡Œä¸€æ¬¡éå†ã€‚</p><p><img src="http://cdn.leesin.fun/typora/s3/img/selectæ¼”ç¤º4.png" alt="selectæ¼”ç¤º4"></p><p>æ‰¾åˆ°å°±ç»ªfdä¹‹åæ‰§è¡Œç›¸åº”é€»è¾‘æ“ä½œï¼Œæ­¤è½®ç®—æ˜¯ç»“æŸäº†ã€‚ç„¶åç¬¬äºŒè½®æ“ä½œä»1.2.å¼€å§‹ï¼Œå†è¿›è¡Œå¾ªç¯ã€‚</p><p>selectæ¨¡å¼å­˜åœ¨çš„é—®é¢˜ï¼š</p><ul><li>éœ€è¦å°†æ•´ä¸ª fd_set ä»ç”¨æˆ·ç©ºé—´æ‹·è´åˆ°å†…æ ¸ç©ºé—´ï¼Œselectç»“æŸè¿˜è¦å†æ¬¡æ‹·è´å›ç”¨æˆ·ç©ºé—´</li><li>selectæ— æ³•å¾—çŸ¥å…·ä½“æ˜¯å“ªä¸ªfdå°±ç»ªï¼Œéœ€è¦éå†æ•´ä¸ªfd_set</li><li>fd_setç›‘å¬çš„fdæ•°é‡ä¸èƒ½è¶…è¿‡1024ï¼ˆçœ‹ç»“æ„ä½“çš„å®šä¹‰å¾—çŸ¥ï¼‰</li></ul><h3 id="6-3-2-poll"><a href="#6-3-2-poll" class="headerlink" title="6.3.2.poll"></a>6.3.2.poll</h3><p>pollæ¨¡å¼å¯¹selectæ¨¡å¼åšäº†ç®€å•æ”¹è¿›ï¼Œä½†æ€§èƒ½æå‡ä¸æ˜æ˜¾ï¼Œéƒ¨åˆ†å…³é”®ä»£ç å¦‚ä¸‹ï¼š</p><p><img src="http://cdn.leesin.fun/typora/s3/img/pollä»£ç .png" alt="pollä»£ç "></p><p>IOæµç¨‹ï¼š</p><p>â‘  åˆ›å»ºpollfdæ•°ç»„ï¼Œå‘å…¶ä¸­æ·»åŠ å…³æ³¨çš„fdä¿¡æ¯ï¼Œæ•°ç»„å¤§å°è‡ªå®šä¹‰</p><p>â‘¡ è°ƒç”¨pollå‡½æ•°ï¼Œå°†pollfdæ•°ç»„æ‹·è´åˆ°å†…æ ¸ç©ºé—´ï¼Œè½¬é“¾è¡¨å­˜å‚¨ï¼Œæ— ä¸Šé™</p><p>â‘¢ å†…æ ¸éå†fdï¼Œåˆ¤æ–­æ˜¯å¦å°±ç»ª</p><p>â‘£ æ•°æ®å°±ç»ªæˆ–è¶…æ—¶åï¼Œæ‹·è´pollfdæ•°ç»„åˆ°ç”¨æˆ·ç©ºé—´ï¼Œè¿”å›å°±ç»ªfdæ•°é‡n</p><p>â‘¤ ç”¨æˆ·è¿›ç¨‹åˆ¤æ–­næ˜¯å¦å¤§äº0</p><p>â‘¥ å¤§äº0åˆ™éå†pollfdæ•°ç»„ï¼Œæ‰¾åˆ°å°±ç»ªçš„fd</p><p>pollæ¨¡å¼å­˜åœ¨çš„é—®é¢˜ï¼š</p><ul><li>éœ€è¦å°†æ•´ä¸ª pollfd ä»ç”¨æˆ·ç©ºé—´æ‹·è´åˆ°å†…æ ¸ç©ºé—´ï¼Œpollç»“æŸè¿˜è¦å†æ¬¡æ‹·è´å›ç”¨æˆ·ç©ºé—´</li><li>pollæ— æ³•å¾—çŸ¥å…·ä½“æ˜¯å“ªä¸ªfdå°±ç»ªï¼Œéœ€è¦éå†æ•´ä¸ª pollfd</li></ul><p>ä¸selectå¯¹æ¯”ï¼š</p><ul><li>selectæ¨¡å¼ä¸­çš„fd_setå¤§å°å›ºå®šä¸º1024ï¼Œè€Œpollfdåœ¨å†…æ ¸ä¸­é‡‡ç”¨é“¾è¡¨ï¼Œç†è®ºä¸Šæ— ä¸Šé™</li><li>ç›‘å¬FDè¶Šå¤šï¼Œæ¯æ¬¡éå†æ¶ˆè€—æ—¶é—´ä¹Ÿè¶Šä¹…ï¼Œæ€§èƒ½åè€Œä¼šä¸‹é™</li></ul><h3 id="6-3-3-epoll"><a href="#6-3-3-epoll" class="headerlink" title="6.3.3.epoll"></a>6.3.3.epoll</h3><p><img src="http://cdn.leesin.fun/typora/s3/img/epollä»£ç .png" alt="epollä»£ç "></p><p>epollæ¨¡å¼ä¸­å¦‚ä½•è§£å†³è¿™äº›é—®é¢˜çš„?</p><ul><li>åŸºäºepollå®ä¾‹ä¸­çš„çº¢é»‘æ ‘ä¿å­˜è¦ç›‘å¬çš„FDï¼Œç†è®ºä¸Šæ— ä¸Šé™ï¼Œè€Œä¸”å¢åˆ æ”¹æŸ¥æ•ˆç‡éƒ½éå¸¸é«˜</li><li>æ¯ä¸ªFDåªéœ€è¦æ‰§è¡Œä¸€æ¬¡epoll_ctlæ·»åŠ åˆ°çº¢é»‘æ ‘ï¼Œä»¥åæ¯æ¬¡epol_waitæ— éœ€ä¼ é€’ä»»ä½•å‚æ•°ï¼Œæ— éœ€é‡å¤æ‹·è´FDåˆ°å†…æ ¸ç©ºé—´</li><li>å†…æ ¸ä¼šå°†å°±ç»ªçš„FDç›´æ¥æ‹·è´åˆ°ç”¨æˆ·ç©ºé—´çš„æŒ‡å®šä½ç½®ï¼Œç”¨æˆ·è¿›ç¨‹æ— éœ€éå†æ‰€æœ‰FDå°±èƒ½çŸ¥é“å°±ç»ªçš„FDæ˜¯è°</li></ul><h5 id="epollçš„äº‹ä»¶é€šçŸ¥æœºåˆ¶"><a href="#epollçš„äº‹ä»¶é€šçŸ¥æœºåˆ¶" class="headerlink" title="epollçš„äº‹ä»¶é€šçŸ¥æœºåˆ¶"></a>epollçš„äº‹ä»¶é€šçŸ¥æœºåˆ¶</h5><p>å½“FDæœ‰æ•°æ®å¯è¯»æ—¶ï¼Œæˆ‘ä»¬è°ƒç”¨epoll_waitå°±å¯ä»¥å¾—åˆ°é€šçŸ¥ã€‚ä½†æ˜¯äº‹ä»¶é€šçŸ¥çš„æ¨¡å¼æœ‰ä¸¤ç§ï¼š</p><ul><li>LevelTriggeredï¼šç®€ç§°LTã€‚å½“FDè¿˜æœ‰æ•°æ®å¯è¯»æ—¶ï¼Œä¼šé‡å¤é€šçŸ¥å¤šæ¬¡ï¼Œç›´è‡³æ•°æ®å¤„ç†å®Œæˆã€‚æ˜¯Epollçš„é»˜è®¤æ¨¡å¼</li><li>EdgeTriggeredï¼šç®€ç§°ETã€‚å½“FDæœ‰æ•°æ®å¯è¯»æ—¶ï¼Œåªä¼šè¢«é€šçŸ¥ä¸€æ¬¡ï¼Œä¸ç®¡æ•°æ®æ˜¯å¦å¤„ç†å®Œæˆ</li></ul><h5 id="webæœåŠ¡æµç¨‹"><a href="#webæœåŠ¡æµç¨‹" class="headerlink" title="webæœåŠ¡æµç¨‹"></a>webæœåŠ¡æµç¨‹</h5><p><img src="http://cdn.leesin.fun/typora/s3/img/åŸºäºepollæ¨¡å¼çš„webæœåŠ¡çš„åŸºæœ¬æµç¨‹.png" alt="åŸºäºepollæ¨¡å¼çš„webæœåŠ¡çš„åŸºæœ¬æµç¨‹"></p><h2 id="6-4-ä¿¡å·é©±åŠ¨IO"><a href="#6-4-ä¿¡å·é©±åŠ¨IO" class="headerlink" title="6.4.ä¿¡å·é©±åŠ¨IO"></a>6.4.ä¿¡å·é©±åŠ¨IO</h2><p>å¾…å­¦ä¹ </p><h2 id="6-5-å¼‚æ­¥IO"><a href="#6-5-å¼‚æ­¥IO" class="headerlink" title="6.5.å¼‚æ­¥IO"></a>6.5.å¼‚æ­¥IO</h2><p>å¾…å­¦ä¹ </p>]]></content>
      
      
      <categories>
          
          <category> è®¡ç®—æœºåŸºç¡€ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> è®¡ç®—æœºç½‘ç»œ </tag>
            
        </tags>
      
    </entry>
    
    
  
  
    
    
    <entry>
      <title>categories</title>
      <link href="/categories/index.html"/>
      <url>/categories/index.html</url>
      
        <content type="html"><![CDATA[]]></content>
      
    </entry>
    
    
    
    <entry>
      <title>photo</title>
      <link href="/photo/index.html"/>
      <url>/photo/index.html</url>
      
        <content type="html"><![CDATA[<div class="gallery-group-main">  <figure class="gallery-group">  <img class="gallery-group-img no-lightbox" src="http://cdn.leesin.fun/hexo/photo/wallpaper/12.jpg" alt="Group Image Gallery">  <figcaption>  <div class="gallery-group-name">å£çº¸</div>  <p>æ”¶è—çš„ä¸€äº›å£çº¸</p>  <a href="/photo/wallpaper"></a>  </figcaption>  </figure>    <figure class="gallery-group">  <img class="gallery-group-img no-lightbox" src="http://cdn.leesin.fun/hexo/photo/wallpaper/14.jpg" alt="Group Image Gallery">  <figcaption>  <div class="gallery-group-name">æ¸¸æˆ</div>  <p>ä¸€äº›æ¸¸æˆæˆ˜ç»©</p>  <a href="/photo/game"></a>  </figcaption>  </figure>  </div>]]></content>
      
    </entry>
    
    
    
    <entry>
      <title>music</title>
      <link href="/music/index.html"/>
      <url>/music/index.html</url>
      
        <content type="html"><![CDATA[    <div id="aplayer-kmuFxOAq" class="aplayer aplayer-tag-marker meting-tag-marker" data-id="8261498022" data-server="netease" data-type="playlist" data-mode="circulation" data-autoplay="true" data-mutex="false" data-listmaxheight="400px" data-preload="none" data-theme="#ad7a86"></div>    <div id="aplayer-ArNTHSXc" class="aplayer aplayer-tag-marker meting-tag-marker" data-id="6631116215" data-server="netease" data-type="playlist" data-mode="circulation" data-autoplay="false" data-mutex="false" data-listmaxheight="400px" data-preload="none" data-theme="#ad7a86"></div>    <div id="aplayer-CnZASHfH" class="aplayer aplayer-tag-marker meting-tag-marker" data-id="5379001646" data-server="netease" data-type="playlist" data-mode="circulation" data-autoplay="false" data-mutex="false" data-listmaxheight="400px" data-preload="none" data-theme="#ad7a86"></div>]]></content>
      
    </entry>
    
    
    
    <entry>
      <title>wallpaper</title>
      <link href="/photo/wallpaper/index.html"/>
      <url>/photo/wallpaper/index.html</url>
      
        <content type="html"><![CDATA[<div class="gallery">    <div class="fj-gallery  data" data-rowheight="220" data-limit="10">    <span class="gallery-data">[{"url":"http://cdn.leesin.fun/hexo/photo/wallpaper/1.jpg","alt":""},{"url":"http://cdn.leesin.fun/hexo/photo/wallpaper/2.jpg","alt":""},{"url":"http://cdn.leesin.fun/hexo/photo/wallpaper/3.jpg","alt":""},{"url":"http://cdn.leesin.fun/hexo/photo/wallpaper/4.jpg","alt":""},{"url":"http://cdn.leesin.fun/hexo/photo/wallpaper/5.jpg","alt":""},{"url":"http://cdn.leesin.fun/hexo/photo/wallpaper/6.jpg","alt":""},{"url":"http://cdn.leesin.fun/hexo/photo/wallpaper/7.jpg","alt":""},{"url":"http://cdn.leesin.fun/hexo/photo/wallpaper/8.jpg","alt":""},{"url":"http://cdn.leesin.fun/hexo/photo/wallpaper/9.jpg","alt":""},{"url":"http://cdn.leesin.fun/hexo/photo/wallpaper/10.jpg","alt":""},{"url":"http://cdn.leesin.fun/hexo/photo/wallpaper/11.jpg","alt":""},{"url":"http://cdn.leesin.fun/hexo/photo/wallpaper/12.jpg","alt":""},{"url":"http://cdn.leesin.fun/hexo/photo/wallpaper/13.jpg","alt":""},{"url":"http://cdn.leesin.fun/hexo/photo/wallpaper/14.jpg","alt":""},{"url":"http://cdn.leesin.fun/hexo/photo/wallpaper/15.jpg","alt":""},{"url":"http://cdn.leesin.fun/hexo/photo/wallpaper/16.jpg","alt":""},{"url":"http://cdn.leesin.fun/hexo/photo/wallpaper/17.jpg","alt":""}]</span>    </div>    <button class="gallery-load-more"><span>åŠ è½½æ›´å¤š</span><i class="fa-solid fa-arrow-down"></i></button>    </div>]]></content>
      
    </entry>
    
    
    
    <entry>
      <title>about</title>
      <link href="/about/index.html"/>
      <url>/about/index.html</url>
      
        <content type="html"><![CDATA[<p>æ„Ÿè°¢è®¿é—®ï¼</p>]]></content>
      
    </entry>
    
    
    
    <entry>
      <title>tags</title>
      <link href="/tags/index.html"/>
      <url>/tags/index.html</url>
      
        <content type="html"><![CDATA[]]></content>
      
    </entry>
    
    
  
</search>
